define("typescript/dropbox/proto/profile_services_constants/actions_pb",["require","exports","@bufbuild/protobuf"],(function(e,t,r){"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.ProfileServiceAction=void 0,(function(e){e[e.LINK_DIRECTORY_MEMBERS=0]="LINK_DIRECTORY_MEMBERS",e[e.LINK_CALENDAR=1]="LINK_CALENDAR",e[e.LINK_CONTACTS=2]="LINK_CONTACTS",e[e.LINK_HISTORY=3]="LINK_HISTORY",e[e.LINK_TARGET_USER=4]="LINK_TARGET_USER",e[e.LINK_READ_FILES=5]="LINK_READ_FILES",e[e.LOGIN_USER=6]="LOGIN_USER",e[e.CREATE_USER=7]="CREATE_USER",e[e.ACCESS_FILES_AND_WIKI=8]="ACCESS_FILES_AND_WIKI",e[e.ACCESS_FILES=9]="ACCESS_FILES",e[e.PUBLISH=10]="PUBLISH",e[e.NONE=-1]="NONE"})(i=t.ProfileServiceAction||(t.ProfileServiceAction={})),r.proto3.util.setEnumType(i,"profile_service_action.ProfileServiceAction",[{no:0,name:"LINK_DIRECTORY_MEMBERS"},{no:1,name:"LINK_CALENDAR"},{no:2,name:"LINK_CONTACTS"},{no:3,name:"LINK_HISTORY"},{no:4,name:"LINK_TARGET_USER"},{no:5,name:"LINK_READ_FILES"},{no:6,name:"LOGIN_USER"},{no:7,name:"CREATE_USER"},{no:8,name:"ACCESS_FILES_AND_WIKI"},{no:9,name:"ACCESS_FILES"},{no:10,name:"PUBLISH"},{no:-1,name:"NONE"}])})),define("typescript/dropbox/proto/profile_services_constants/permissions_pb",["require","exports","@bufbuild/protobuf"],(function(e,t,r){"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.ProfileServicePermission=void 0,(function(e){e[e.CONTACTS=0]="CONTACTS",e[e.PROFILE=1]="PROFILE",e[e.PHOTO=2]="PHOTO",e[e.EMAIL=3]="EMAIL",e[e.CALENDAR=4]="CALENDAR",e[e.DOCUMENTS=5]="DOCUMENTS",e[e.CHAT=6]="CHAT",e[e.READ_FILES=7]="READ_FILES",e[e.DIRECTORY_MEMBERS=8]="DIRECTORY_MEMBERS",e[e.CHAT_HISTORY_PUBLIC_CHANNEL=9]="CHAT_HISTORY_PUBLIC_CHANNEL",e[e.CHAT_HISTORY_PRIVATE_CHANNEL=10]="CHAT_HISTORY_PRIVATE_CHANNEL",e[e.CHAT_HISTORY_DIRECT=11]="CHAT_HISTORY_DIRECT",e[e.CHAT_HISTORY_GROUP_DIRECT=12]="CHAT_HISTORY_GROUP_DIRECT",e[e.READ_WIKI=13]="READ_WIKI"})(i=t.ProfileServicePermission||(t.ProfileServicePermission={})),r.proto3.util.setEnumType(i,"profile_service_permission.ProfileServicePermission",[{no:0,name:"CONTACTS"},{no:1,name:"PROFILE"},{no:2,name:"PHOTO"},{no:3,name:"EMAIL"},{no:4,name:"CALENDAR"},{no:5,name:"DOCUMENTS"},{no:6,name:"CHAT"},{no:7,name:"READ_FILES"},{no:8,name:"DIRECTORY_MEMBERS"},{no:9,name:"CHAT_HISTORY_PUBLIC_CHANNEL"},{no:10,name:"CHAT_HISTORY_PRIVATE_CHANNEL"},{no:11,name:"CHAT_HISTORY_DIRECT"},{no:12,name:"CHAT_HISTORY_GROUP_DIRECT"},{no:13,name:"READ_WIKI"}])})),define("metaserver/static/js/profile_services/auth_callback_handler",["require","exports","tslib","metaserver/static/js/core/browser","metaserver/static/js/core/notify","metaserver/static/js/core/uri","metaserver/static/js/deprecated_ajax/ajax_jquery","metaserver/static/js/core/i18n"],(function(e,t,r,i,s,n,a,o){"use strict";function c(e,t,r){e.trigger(t,r)}Object.defineProperty(t,"__esModule",{value:!0}),t.handleCalendarLinkResponse=t.handleLoginResponse=t.handleRegisterResponse=void 0,i=r.__importStar(i),a=r.__importStar(a),t.handleRegisterResponse=function(e,t,r,a,_){var l;e.success&&e.user_id?_?_({display_name:e.profile.name,id:e.user_id,email:e.profile.email}):(l=t.loginCont||"/",i.redirect(l)):e.success?(a&&a(),(function(e,t,r){const{profile:s,emailSig:a,refreshToken:o}=e,{given_name:_,family_name:l,email:u,picture_url:d}=s,{registerCont:p,signupTag:m,k:g,eh:f,showMarketingOptIn:h,signupEndpoint:v,signupReferrer:O,signupUrl:S,trackingParams:E}=t,A={cont:p,eh:f,email:u,email_sig:a,fname:_,k:g,lname:l,picture_url:d,refresh_token:o,show_marketing_opt_in:h,signup_endpoint:v,signup_referrer:O,signup_tag:m,signup_url:S,tracking_params:E},C=Object.keys(A).reduce((e,t)=>{const r=A[t];return void 0!==r&&(e[t]=String(r)),e},{});r&&c(r.form,r.newAccount,C);t.canRedirect?i.redirect(new n.URI({path:"/third_party_signup",query:C}).toString()):t.inlineRedirect&&t.inlineRedirect(A)})({emailSig:e.email_sig,refreshToken:e.refresh_token,profile:e.profile},t,r)):(function(e,t,r){if("tfa_required"===e.errMsg){const r={cont:t};null!=e.pairUser&&(r.pair_user=e.pairUser.toString()),null!=e.rememberMe&&(r.remember_me=e.rememberMe.toString()),i.redirect(new n.URI({path:"/verify_code",query:r}).toString())}else if("sso_required"===e.errMsg){const r={email:e.profile.email,cont:t};i.redirect(new n.URI({path:"/login",query:r}).toString())}else"user_exists"===e.errMsg?(r&&c(r.form,r.userExists,{focus:"input[name=login_password]",prefill:{".login-email":e.profile.email,"input[type='hidden'][name=refresh_token]":e.refreshToken,"input[type='hidden'][name=email_sig]":e.emailSig}}),s.Notify.error(o.intl.formatMessage({id:"RAxZa6",defaultMessage:"This email address is already taken. Please sign in."}))):"user_already_invited_to_team"===e.errMsg?s.Notify.error(o.intl.formatMessage({id:"uE2zpB",defaultMessage:"Contact your admin to resend your invite."})):"email_not_verified"===e.errMsg?s.Notify.error(o.intl.formatMessage({id:"S6RuBm",defaultMessage:"Before you can sign in, you’ll need to verify your account with Google {email}"},{email:e.profile.email})):s.Notify.error(o.intl.formatMessage({id:"/5Xr9S",defaultMessage:"Unable to link to Google. Please refresh the page to try again."}))})({errMsg:e.err_msg,rememberMe:e.remember_me,pairUser:e.pair_user,profile:e.profile,emailSig:e.email_sig,refreshToken:e.refresh_token},t.loginCont||"/",r)},t.handleLoginResponse=function(e,t){if(e.success)s.Notify.success(o.intl.formatMessage({id:"pnPTCp",defaultMessage:"Log in successful!"})),a.SilentBackgroundRequest({url:"/profile_services/log",data:{event_name:"login_callback_success",value:"success"}}),t.onSuccess(),t.redirectOnSuccess&&i.redirect(t.cont);else if(a.SilentBackgroundRequest({url:"/profile_services/log",data:{event_name:"login_callback_error",value:e.err_msg}}),"access_denied"===e.err_msg)s.Notify.error(o.intl.formatMessage({id:"4F3Rmj",defaultMessage:"You need to accept Google’s request in order to log in."}));else if("emails_do_not_match"===e.err_msg)s.Notify.error(o.intl.formatMessage({id:"9ZZYrU",defaultMessage:"We couldn’t find a Dropbox account matching that email."}));else if("google_login_not_allowed"===e.err_msg)s.Notify.error(o.intl.formatMessage({id:"hf0hON",defaultMessage:"Google sign in is disabled. Sign in with your Dropbox password or ask your Dropbox admin for help."}));else if("sso_required"===e.err_msg)s.Notify.error(o.intl.formatMessage({id:"/izp8x",defaultMessage:"Your team has single sign-on. Sign in with your Dropbox password or ask your Dropbox admin for help."}));else if("tfa_required"===e.err_msg){const r=new n.URI({path:"/verify_code",query:{cont:t.cont,remember_me:String(e.remember_me),pair_user:String(e.pair_user)}}).toString();i.redirect(r)}else if("disabled_account"===e.err_msg)s.Notify.error(o.intl.formatMessage({id:"ZKpC55",defaultMessage:"This account is disabled."}));else if("invalid_pair_target"===e.err_msg)s.Notify.error(o.intl.formatMessage({id:"b47mh4",defaultMessage:"That account can’t be paired. Paired account must be a personal account."}));else if("already_paired"===e.err_msg)s.Notify.error(o.intl.formatMessage({id:"vbDuY9",defaultMessage:"That account is already paired to another account."}));else if("error_pairing"===e.err_msg)s.Notify.error(o.intl.formatMessage({id:"AH4JT6",defaultMessage:"There was an error pairing."}));else if("not_verified"===e.err_msg){const r=new n.URI({path:"/show_password_form",query:{cont:t.cont,remember_me:String(e.remember_me),pair_user:String(e.pair_user)}}).toString();i.redirect(r)}else"emails_do_not_match_redirect"===e.err_msg?i.redirect(new n.URI({path:"/third_party_signup",query:{email_sig:e.email_sig,email:e.profile.email,fname:e.profile.given_name,lname:e.profile.family_name,refresh_token:e.refresh_token,cont:t.cont}})):s.Notify.error(o.intl.formatMessage({id:"ELzCWG",defaultMessage:"We couldn’t log you in with Google. Try again?"}))},t.handleCalendarLinkResponse=function(e,t){e.success?(s.Notify.success(o.intl.formatMessage({id:"r1Kfvk",defaultMessage:"Successfully connected your Google Calendar"})),t.onSuccess()):s.Notify.error(o.intl.formatMessage({id:"aWO5m4",defaultMessage:"Couldn’t connect your Google Calendar"}))}})),define("metaserver/static/js/profile_services/popup_handler",["require","exports","tslib","lodash"],(function(e,t,r,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.removeAuthCompleteListener=t.addAuthCompleteListener=void 0,i=r.__importStar(i);const s={};t.addAuthCompleteListener=function(e){const t=i.uniqueId(),r=t=>{let r;try{r=JSON.parse(t.data)}catch(e){return}r&&"db:profile_service:auth_complete"===r.type&&e(r.payload)};return window.addEventListener("message",r),s[t]=r,t},t.removeAuthCompleteListener=function(e){const t=s[e];t&&(delete s[e],window.removeEventListener("message",t))}})),define("metaserver/static/js/profile_services/profile_services_constants",["require","exports","metaserver/static/js/core/i18n"],(function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ServiceRequestType=t.ServiceResponseType=void 0,(function(e){e.APPLE="APPLE",e.GOOGLE="GOOGLE"})(t.ServiceResponseType||(t.ServiceResponseType={})),(function(e){e[e.CONTACTS=0]="CONTACTS",e[e.PROFILE=1]="PROFILE",e[e.PHOTO=2]="PHOTO",e[e.EMAIL=3]="EMAIL",e[e.CALENDAR=4]="CALENDAR",e[e.DOCUMENTS=5]="DOCUMENTS",e[e.CHAT=6]="CHAT",e[e.READ_FILES=7]="READ_FILES",e[e.DIRECTORY_MEMBERS=8]="DIRECTORY_MEMBERS"})(t.ServiceRequestType||(t.ServiceRequestType={})),(function(e){e.to_api_v2=function(t){switch(t){case e.CONTACTS:return{".tag":"contacts"};case e.PROFILE:return{".tag":"profile"};case e.PHOTO:return{".tag":"photo"};case e.EMAIL:return{".tag":"email"};case e.CALENDAR:return{".tag":"calendar"};case e.DOCUMENTS:return{".tag":"documents"};case e.CHAT:return{".tag":"chat"};case e.READ_FILES:return{".tag":"read_files"};case e.DIRECTORY_MEMBERS:return{".tag":"directory_members"};default:return{".tag":"other"}}}})(t.ServiceRequestType||(t.ServiceRequestType={}));const i={other:{action:null,permissions:"",landing_page_id:null,learn_more_page:null,img:"",friendly_name:"Other",order:Number.MAX_VALUE},apple:{action:null,permissions:"",landing_page_id:null,learn_more_page:null,img:"/static/metaserver/static/images/index/apple-logo-color.svg",friendly_name:"Apple",order:1},google:{action:"link_contacts",permissions:r.intl.formatMessage({id:"sN1hXL",defaultMessage:"Contacts"}),landing_page_id:null,learn_more_page:null,img:"/static/metaserver/static/images/index/google-logo-color-vflpJqkMT.svg",friendly_name:"Google",order:3},outlook:{action:"link_contacts",permissions:r.intl.formatMessage({id:"Tgwos1",defaultMessage:"Calendar and Contacts"}),landing_page_id:null,learn_more_page:null,img:"/static/metaserver/static/images/thirdparty/outlook_icon-vflzzt-G0.svg",friendly_name:"Outlook",order:4},slack:{action:"link_contacts",permissions:r.intl.formatMessage({id:"reDVDJ",defaultMessage:"Communication"}),landing_page_id:null,learn_more_page:null,img:"/static/metaserver/static/images/thirdparty/slack_icon_transparent-vfljNpDIm.svg",friendly_name:"Slack",order:Number.MAX_VALUE},slack_dropbox:{action:"link_read_files",permissions:r.intl.formatMessage({id:"reDVDJ",defaultMessage:"Communication"}),landing_page_id:"dropbox_slack",learn_more_page:"https://www.dropbox.com/help/desktop-web/slack",img:"/static/metaserver/static/images/thirdparty/slack_icon_transparent-vfljNpDIm.svg",friendly_name:"Slack",order:5},zoom:{action:"link_contacts",permissions:r.intl.formatMessage({id:"reDVDJ",defaultMessage:"Communication"}),landing_page_id:"zoom",learn_more_page:"https://www.dropbox.com/help/desktop-web/zoom",img:"/static/metaserver/static/images/thirdparty/zoom_icon_squircle-vfl-znF5M.svg",friendly_name:"Zoom",order:8},zoom_app:{action:null,permissions:r.intl.formatMessage({id:"reDVDJ",defaultMessage:"Communication"}),landing_page_id:"zoom_app",learn_more_page:null,img:"/static/metaserver/static/images/thirdparty/zoom_icon_squircle-vfl-znF5M.svg",friendly_name:"Dropbox Spaces app for Zoom",order:8},trello:{action:"link_contacts",permissions:r.intl.formatMessage({id:"iiiHMO",defaultMessage:"Project management"}),landing_page_id:"trello",learn_more_page:"https://www.dropbox.com/landing/trello",img:"/static/metaserver/static/images/thirdparty/trello_icon-vfl-FetdA.svg",friendly_name:"Trello",order:6},yahoo:{action:null,permissions:r.intl.formatMessage({id:"sN1hXL",defaultMessage:"Contacts"}),landing_page_id:null,learn_more_page:null,img:"/static/metaserver/static/images/thirdparty/yahoo_icon-vflqXkWjv.svg",friendly_name:"Yahoo! Mail",order:7},yahoo_legacy:{action:null,permissions:r.intl.formatMessage({id:"sN1hXL",defaultMessage:"Contacts"}),landing_page_id:null,learn_more_page:null,img:"/static/metaserver/static/images/thirdparty/yahoo_icon-vflqXkWjv.svg",friendly_name:"Yahoo! Mail",order:Number.MAX_VALUE},facebook_legacy:{action:null,permissions:r.intl.formatMessage({id:"sN1hXL",defaultMessage:"Contacts"}),landing_page_id:null,learn_more_page:null,img:"/static/metaserver/static/images/thirdparty/facebook_icon-vflbyEm0k.svg",friendly_name:"Facebook",order:2},meta:{action:null,permissions:r.intl.formatMessage({id:"VlZABW",defaultMessage:"Publish"}),landing_page_id:null,learn_more_page:null,img:"/static/metaserver/static/images/thirdparty/facebook_icon-vflbyEm0k.svg",friendly_name:"Meta",order:2},hellosign:{action:null,permissions:r.intl.formatMessage({id:"reDVDJ",defaultMessage:"Communication"}),landing_page_id:null,learn_more_page:null,img:"/static/metaserver/static/images/thirdparty/dropbox_sign_icon-vflHa2JH2.svg",friendly_name:"Dropbox Sign",order:9},canvas:{action:"link_contacts",permissions:r.intl.formatMessage({id:"reDVDJ",defaultMessage:"Communication"}),landing_page_id:null,learn_more_page:"https://help.dropbox.com/installs-integrations/third-party/canvas",img:"/static/metaserver/static/images/thirdparty/canvas_icon.svg",friendly_name:"Canvas",order:10}},s={profile_card_v2:{google:{action:"link_calendar",permissions:r.intl.formatMessage({id:"Tgwos1",defaultMessage:"Calendar and Contacts"}),landing_page_id:null,learn_more_page:null,img:"/static/metaserver/static/images/index/google-logo-color-vflpJqkMT.svg",friendly_name:"Google",order:1}}},n={GOOGLE:"1",YAHOO:"2",FACEBOOK_LEGACY:"3",TWITTER:"4",YAHOO_LEGACY:"5",MOBILE:"6",OUTLOOK:"7",SLACK:"8",DOCUSIGN:"9",ZOOM:"10",SLACK_DROPBOX:"11",TRELLO:"12",APPLE:"13",HELLOSIGN:"14",CANVAS:"15",ZOOM_APP:"16",META:"17",NEVER_CONNECTED:0,WAS_CONNECTED:1,IS_CONNECTED:2,VARIOUS:"-1",NONE:"-2",services:()=>[n.GOOGLE,n.YAHOO,n.FACEBOOK_LEGACY,n.TWITTER,n.YAHOO_LEGACY,n.OUTLOOK,n.SLACK,n.DOCUSIGN,n.ZOOM,n.SLACK_DROPBOX,n.TRELLO,n.APPLE,n.HELLOSIGN,n.ZOOM_APP,n.META],get_gated_service_data(e,t){const r=e[".tag"];if(t&&t in s){const e=s[t];if(r in e)return e[r]}},get_service_data(e,t=null){const r=e[".tag"];if(t){const r=n.get_gated_service_data(e,t);if(r)return r}return r in i?i[r]:i.other},importable_contact_services:()=>[n.GOOGLE],to_img_legacy(e){switch(e){case n.GOOGLE:return["/static/metaserver/static/images/contacts/import_icon_google-vflSfFckp.png","/static/metaserver/static/images/contacts/import_icon_google@2x-vfla9_OFL.png"];case n.YAHOO:case n.YAHOO_LEGACY:return["/static/metaserver/static/images/contacts/import_icon_yahoo-vfl5E728M.png","/static/metaserver/static/images/contacts/import_icon_yahoo@2x-vflnVdi5R.png"];case n.FACEBOOK_LEGACY:return["/static/metaserver/static/images/contacts/import_icon_facebook-vfluFbt1j.png","/static/metaserver/static/images/contacts/import_icon_facebook@2x-vfl7Zk5rR.png"];case n.OUTLOOK:return["/static/metaserver/static/images/contacts/import_icon_outlook-vflF1_UKs.png","/static/metaserver/static/images/contacts/import_icon_outlook@2x-vflVjRgD3.png"];case n.SLACK:case n.SLACK_DROPBOX:return["/static/metaserver/static/images/thirdparty/slack_icon-vflKvKltK.svg","/static/metaserver/static/images/thirdparty/slack_icon-vflKvKltK.svg"];case n.ZOOM:case n.ZOOM_APP:return["/static/metaserver/static/images/thirdparty/zoom_icon-vflft17yG.svg","/static/metaserver/static/images/thirdparty/zoom_icon-vflft17yG.svg"];case n.TRELLO:return["/static/metaserver/static/images/thirdparty/trello_icon-vfl-FetdA.svg","/static/metaserver/static/images/thirdparty/trello_icon-vfl-FetdA.svg"];case n.HELLOSIGN:return["/static/metaserver/static/images/thirdparty/dropbox_sign_icon-vflHa2JH2.svg","/static/metaserver/static/images/thirdparty/dropbox_sign_icon-vflHa2JH2.svg"];case n.CANVAS:return["/static/metaserver/static/images/thirdparty/canvas_icon.svg","/static/metaserver/static/images/thirdparty/canvas_icon.svg"];case n.META:return["/static/metaserver/static/images/contacts/import_icon_facebook-vfluFbt1j.png","/static/metaserver/static/images/contacts/import_icon_facebook@2x-vfl7Zk5rR.png"];default:return["",""]}},to_name(e){if(e===n.VARIOUS)return r.intl.formatMessage({id:"hK3Vsp",defaultMessage:"Email"});{const t=n.to_api_service_type(e);return n.get_service_data(t).friendly_name}},logging_identifiers(e){switch(e){case n.GOOGLE:return"google";case n.YAHOO:return"yahoo";case n.FACEBOOK_LEGACY:return"facebook_legacy";case n.VARIOUS:return"email";case n.YAHOO_LEGACY:return"yahoo_legacy";case n.OUTLOOK:return r.intl.formatMessage({id:"DVWR1j",defaultMessage:"outlook"});case n.SLACK:return r.intl.formatMessage({id:"D/5sPh",defaultMessage:"slack"});case n.DOCUSIGN:return"docusign";case n.ZOOM:return"zoom";case n.ZOOM_APP:return"zoom_app";case n.SLACK_DROPBOX:return"slack_dropbox";case n.TRELLO:return"trello";case n.APPLE:return"apple";case n.HELLOSIGN:return"hellosign";case n.CANVAS:return"canvas";case n.META:return"meta";default:return"other"}},to_api_service_type(e){switch(e){case n.GOOGLE:return{".tag":"google"};case n.YAHOO:return{".tag":"yahoo"};case n.FACEBOOK_LEGACY:return{".tag":"facebook_legacy"};case n.OUTLOOK:return{".tag":"outlook"};case n.SLACK:return{".tag":"slack"};case n.ZOOM:return{".tag":"zoom"};case n.ZOOM_APP:return{".tag":"zoom_app"};case n.SLACK_DROPBOX:return{".tag":"slack_dropbox"};case n.TRELLO:return{".tag":"trello"};case n.APPLE:return{".tag":"apple"};case n.HELLOSIGN:return{".tag":"hellosign"};case n.CANVAS:return{".tag":"canvas"};case n.META:return{".tag":"meta"};default:return{".tag":"other"}}},from_api_service_type(e){switch(e[".tag"]){case"google":return n.GOOGLE;case"yahoo":return n.YAHOO;case"facebook_legacy":return n.FACEBOOK_LEGACY;case"outlook":return n.OUTLOOK;case"slack":return n.SLACK;case"zoom":return n.ZOOM;case"zoom_app":return n.ZOOM_APP;case"slack_dropbox":return n.SLACK_DROPBOX;case"trello":return n.TRELLO;case"apple":return n.APPLE;case"hellosign":return n.HELLOSIGN;case"canvas":return n.CANVAS;case"meta":return n.META}return n.VARIOUS},from_api_to_name:e=>n.to_name(n.from_api_service_type(e)),from_api_to_img:e=>n.get_service_data(e).img,oauth_window_dimensions(e){let t=600,r=600;return e===n.ZOOM?t=770:e===n.APPLE?t=700:e===n.CANVAS&&(t=700,r=500),{width:t,height:r}}};t.default=n})),define("metaserver/static/js/profile_services/profile_services_link",["require","exports","tslib","metaserver/static/js/core/assert","metaserver/static/js/core/browser","metaserver/static/js/core/i18n","metaserver/static/js/core/uri","metaserver/static/js/deprecated_ajax/ajax_jquery","metaserver/static/js/clean/analytics","metaserver/static/js/profile_services/popup_handler","metaserver/static/js/profile_services/profile_services_constants","metaserver/static/js/clean/viewer","metaserver/static/js/modules/constants/login_and_register","metaserver/static/js/clean/ui/snackbar","metaserver/static/js/core/browser","typescript/dropbox/proto/profile_services_constants/permissions_pb","typescript/dropbox/proto/profile_services_constants/actions_pb"],(function(e,t,r,i,s,n,a,o,c,_,l,u,d,p,m,g,f){"use strict";var h;Object.defineProperty(t,"__esModule",{value:!0}),t.ProfileServicesLinkingHandler=t.LinkedProfileServices=t.isProfileServiceRequestType=t.isProfileServicesAction=t.AuthWindowOption=void 0,s=r.__importStar(s),o=r.__importStar(o),l=r.__importDefault(l),d=r.__importStar(d),(function(e){e.HIDDEN_IFRAME="hidden_iframe",e.POP_UP="pop_up",e.REDIRECT="redirect"})(h=t.AuthWindowOption||(t.AuthWindowOption={})),t.isProfileServicesAction=function(e){return f.ProfileServiceAction.hasOwnProperty(e.toUpperCase())},t.isProfileServiceRequestType=function(e){return g.ProfileServicePermission.hasOwnProperty(e.toUpperCase())};class v{constructor(e,t=null){this.update_on_auth_event=e=>{if(e.user_id===this.user_id){this.is_updated=!1,this.get_or_update_connected_state(!0);for(const e in this.serviceChangeCallbacks)this.serviceChangeCallbacks.hasOwnProperty(e)&&this.serviceChangeCallbacks[e](this)}},(0,i.assert)(null!==e,"No user id provided"),this.user_id=e,this.connectedServices={},this.is_updated=!1,this.get_or_update_connected_state(!0,t),this.serviceChangeCallbacks={},(0,_.addAuthCompleteListener)(this.update_on_auth_event)}static get_linked_profile_services_for_user(e,t=null){(0,i.assert)(null!==e,"No user_id: LinkedProfileServices.get_linked_profile_services_for_user()");let r=this._LINKED_PROFILE_SERVICES[e];return void 0!==r?r.get_or_update_connected_state(!1,t):(r=new v(e,t),this._LINKED_PROFILE_SERVICES[e]=r),r}get_or_update_connected_state(e=!1,t=null){this.is_updated&&!e?null!==t&&t(this):o.BackgroundRequest({url:"/profile_services/connected_services",subject_user:this.user_id,dataType:"json",success:(e,r,i)=>{this.connectedServices=e,this.is_updated=!0,null!==t&&t(this)}})}connected_accounts_for_service(e){return this.connectedServices[e]?this.connectedServices[e].map(e=>e.source_id):[]}has_connected_services(){for(const e of l.default.services())if(this.service_is_connected(e))return!0;return!1}has_unconnected_services(e=!1){const t=e?l.default.importable_contact_services():l.default.services();for(const e of t)if(e!==l.default.YAHOO_LEGACY&&!this.service_is_connected(e))return!0;return!1}service_is_connected(e){if((0,i.assert)(-1!==l.default.services().indexOf(e),"Not a valid profile service"),null==this.connectedServices[e])return!1;for(const t of this.connectedServices[e])if(t.connection_state===l.default.IS_CONNECTED)return!0;return!1}service_was_connected(e){if((0,i.assert)(-1!==l.default.services().indexOf(e),"Not a valid profile service"),null==this.connectedServices[e])return!1;for(const t of this.connectedServices[e])if(t.connection_state===l.default.WAS_CONNECTED)return!0;return!1}register_for_service_changes(e,t){return this.serviceChangeCallbacks[e]=t}}t.LinkedProfileServices=v,v._LINKED_PROFILE_SERVICES={};function O(e){(0,i.assert)(null!==e,"No user_id provided to auth_service_with_user");const t=u.Viewer.get_viewer().get_user_by_id(e);(0,i.assert)(null!==t,`No user for user_id ${e}`)}function S(e){const t={};return Object.keys(e).forEach(r=>{const i=e[r];null!=i&&(t[r]=i)}),t}t.ProfileServicesLinkingHandler=class{constructor(){this._popup_window=null}static show_import_notifications(e){e.success?(c.TeamsWebActionsLogger.log("import_contacts_complete",{provider:l.default.logging_identifiers(e.provider),path:s.get_uri().getPath()}),p.Snackbar.complete(n.intl.formatMessage({id:"JxBPfw",defaultMessage:"Successfully connected {service_name}"},{service_name:l.default.to_name(e.provider)}),"profile-services-link")):null!==e.err_msg?p.Snackbar.fail(e.err_msg,"profile-services-link"):p.Snackbar.fail(n.intl.formatMessage({id:"J+0ZxM",defaultMessage:"Could not complete connection, try again later"}),"profile-services-link")}_close_popup_window(){null!=this._popup_window&&(this._popup_window.close(),this._popup_window=null)}_wait_for_auth_complete(e){return new Promise((t,r)=>{let i=null;this._close_popup_window();let s=null;const n=(0,_.addAuthCompleteListener)(e=>{if(s=e,!s.settings_config_pending)return(0,_.removeAuthCompleteListener)(n),null!=i&&clearInterval(i),this._close_popup_window(),t(e)}),a=e();if(null==a)return r("window_not_created");this._popup_window=a,i=setInterval(()=>{if(!0===a.closed)return s?t(s):(r("window_closed"),(0,_.removeAuthCompleteListener)(n),void clearInterval(i))},1e3)})}_window_open_features(e){const{width:t,height:r}=l.default.oauth_window_dimensions(e),i={width:t,height:r,resizable:1,scrollbars:1};return Object.keys(i).map((function(e){return`${e}=${i[e]}`})).join(",")}_post_redirect_to_url(e,t,r,i,n=!1){let o;o=i?"/profile_services/redirect_to_identity_provider":e===l.default.CANVAS?"/canvas/select_domain":"/profile_services/start_auth_flow";const c=new a.URI({path:o,query:t}).toString();if(n){const e={success:!0,provider:"",user_id:null,profile:{service_id:"",name:"",given_name:"",family_name:"",email:"",picture_url:"",additional_emails:[],verified_email:!1,organization:""},email_sig:"",refresh_token:"",err_msg:null,localized_error:null,login_info:"",verified_profile_email:!1,should_update_account_photo:!1,remember_me:!1,pair_user:!1,display_name:"",granted_request_types:[],missing_request_types:[],external_service_id:"",dbx_auth:c};return Promise.resolve(e)}return r===h.HIDDEN_IFRAME?this._wait_for_auth_complete(()=>{const e=document.createElement("iframe");return e.src=c,e.style.display="none",e.style.width="0",e.style.height="0",document.body.appendChild(e),e.contentWindow}):r===h.POP_UP?this._wait_for_auth_complete(()=>{const t=l.default.to_name(e),r=this._window_open_features(e);return window.open(c,t,r)}):(s.redirect(c),Promise.reject("redirected"))}_redirect_to_identity_provider(e,t,r,s=null,n=h.POP_UP,a=null,o,c,_,l=!1,u){(0,i.assert)(null!==e,"No service provided to auth_service_with_user");const p={service:e,is_popup:(n===h.POP_UP).toString(),prompt_select:"true",token:d.REDIRECT_WINDOW_TOKEN,extra_state_parameters:o,login_hint:_};null!==r&&(p.user_id=r.toString()),p.referrer=s,null==a?p.is_desktop="false":"desktop"===a.kind?(p.is_desktop="true",p.host_nonce=a.host_nonce,p.login_hint=a.login_hint):(p.is_desktop="false",p.remember_me=a.remember_me.toString(),p.cont=a.cont,p.pair_user=a.pair_user.toString()),u&&(p.perms=JSON.stringify(u)),t&&(p.action=t,p.extra_permissions=void 0!==c?JSON.stringify(c):void 0);const m=S(p);return this._post_redirect_to_url(e,m,n,!1,l)}auth_service_with_user_with_landing_page(e,t){const{landing_page_id:r}=l.default.get_service_data(e);return null!=r?this._wait_for_auth_complete(()=>(0,m.open_tab)(`/landing/${r}?return_to_opener=true`,!0)):null!=t?t():Promise.reject("no_landing_page")}auth_service_with_user(e,t,r=null,i=null,s="link_contacts",n,a,o,c,_){this.auth_service_with_user_promise(e,t,i,s,n,a,o,c,_).then(r)}auth_service_with_user_promise(e,t,r=null,i="link_contacts",s,n,a,o,c,_=!1){return O(t),this._redirect_to_identity_provider(e,i,t,r,void 0!==s?s:h.POP_UP,null,n,a,c,_,o)}auth_service_with_specified_user(e,t,r,i){this.auth_service_with_user_promise(e,t,i,"link_target_user").then(r)}auth_service_create_user_if_needed(e,t=null,r=null,i=h.POP_UP,s=null){this._redirect_to_identity_provider(e,"create_user",null,r,i,s).then(t)}auth_service_login_desktop(e,t,r,i=null){const s={kind:"desktop",host_nonce:r,login_hint:i};this._redirect_to_identity_provider(e,"login_user",null,null,h.POP_UP,s).then(t)}auth_service_login_web(e,t,r,i,s,n,a){const o={kind:"web",remember_me:s,cont:n,pair_user:a};this._redirect_to_identity_provider(e,"login_user",null,r,i,o).then(t)}auth_service_link_calendar(e,t,r,i){return O(t),this._redirect_to_identity_provider(e,"link_calendar",t,i,h.POP_UP).then(r)}continue_auth_flow(e){const{user_id:t,service:r,action:i,referrer:s,cont:n,is_popup:a,pair_user:o,is_desktop:c,is_android:_,remember_me:l,host_nonce:u,login_hint:p,prompt_select:m,pkce_challenge:g,extra_state_parameters:f,perms:v}=e,O={service:r,action:"link_contacts",prompt_select:"true",token:d.REDIRECT_WINDOW_TOKEN};O.action=i,null!=t&&(O.user_id=t.toString()),O.cont=n,O.referrer=s,null!=a&&(O.is_popup=a.toString()),null!=o&&(O.pair_user=o.toString()),null!=c&&(O.is_desktop=c.toString()),null!=_&&(O.is_android=_.toString()),null!=l&&(O.remember_me=l.toString()),O.host_nonce=u,O.login_hint=p,null!=m&&(O.prompt_select=m.toString()),null!=g&&(O.pkce_challenge=g),O.extra_state_parameters=f,null!=v&&(O.perms=JSON.stringify(v));const E=S(O);return this._post_redirect_to_url(r,E,h.REDIRECT,!0)}deauth_service(e,t,r=null,s=null){const n=parseInt(t,10);(0,i.assert)(-1!==l.default.services().indexOf(e),"Not a valid profile service"),(0,i.assert)(null!==n,"No user_id provided"),v.get_linked_profile_services_for_user(n,t=>{t.service_is_connected(e)||null===s?(null!==r&&(0,i.assert)(-1!==t.connected_accounts_for_service(e).indexOf(r),"Service is not currently connected"),o.WebRequest({url:"/profile_services/unlink",subject_user:n,data:{service:e,source_id:r},success:(e,r,i)=>(t.update_on_auth_event({user_id:n}),"function"==typeof s?s(!0):void 0),error:(e,t,r)=>"function"==typeof s?s(!1):void 0})):s(!0)})}}})),define("metaserver/static/js/clean/ui/paging_list",["require","exports","tslib","classnames","react","react-dom","lodash"],(function(e,t,r,i,s,n,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=r.__importDefault(i),s=r.__importDefault(s),n=r.__importStar(n),a=r.__importStar(a);class o extends s.default.Component{constructor(){super(...arguments),this._getScroll=()=>{const e=n.findDOMNode(this.refs.scroller).getBoundingClientRect().top;return n.findDOMNode(this.refs.container).getBoundingClientRect().top-e},this._setScroll=e=>n.findDOMNode(this.refs.container).scrollTop+=e-this._getScroll(),this._getViewportSize=()=>n.findDOMNode(this.refs.container).clientHeight,this._getStartAndEnd=()=>{const e=Math.max(0,this._getScroll()-this.props.threshold);return{start:e,end:e+this._getViewportSize()+2*this.props.threshold}},this.updateFrame=()=>{const{start:e,end:t}=this._getStartAndEnd(),{itemSize:r}=this.props,i=this._constrainFrom(Math.floor(e/r),this.props.children.length),s=this._constrainSize(Math.ceil((t-e)/r)+1,this.props.children,i);return this.setState({from:i,size:s})},this._getSpaceBefore=e=>e*this.props.itemSize,this._constrainFrom=(e,t)=>e?Math.max(Math.min(e,t-1),0):0,this._constrainSize=(e,t,r)=>{const{length:i}=t,{pageSize:s}=this.props;return Math.min(Math.max(e,s),i-r)},this.scrollTo=e=>this._setScroll(this._getSpaceBefore(e)),this.scrollAround=e=>{const t=this._getScroll(),r=this._getSpaceBefore(e);if(t>r)return this._setScroll(r);const i=r-this._getViewportSize()+this.props.itemSize;return t<i?this._setScroll(i):void 0},this._renderItems=()=>{const e=this.state.from+this.state.size-1;return this.props.children.slice(this.state.from,+e+1||void 0)},this.state={from:0,size:this._constrainSize(this.props.pageSize,this.props.children,0)}}UNSAFE_componentWillReceiveProps(e){const t=this._constrainFrom(this.state.from,e.children.length),r=this._constrainSize(this.state.size,e.children,t);return this.setState({from:t,size:r})}componentDidMount(){return window.addEventListener("resize",this.updateFrame),n.findDOMNode(this).addEventListener("scroll",this.updateFrame),this.updateFrame()}shouldComponentUpdate(e,t){return!a.isEqual(e,this.props)||!a.isEqual(t,this.state)}componentDidUpdate(){return this.updateFrame()}componentWillUnmount(){window.removeEventListener("resize",this.updateFrame),n.findDOMNode(this).removeEventListener("scroll",this.updateFrame)}render(){const{listHeight:e}=this.props,t=this._getSpaceBefore(this.props.children.length),r={position:"relative",height:e?Math.min(e,t):t},n=this._getSpaceBefore(this.state.from),a=this.props.useTranslate3d?`translate3d(0px, ${n}px, 0)`:`translate(0px, ${n}px)`,o={MsTransform:a,WebkitTransform:a,transform:a};return s.default.createElement("div",{className:(0,i.default)("paging-list",this.props.customClass),ref:"container"},s.default.createElement("div",{style:r,ref:"scroller"},s.default.createElement("ul",{style:o},this._renderItems())))}}o.displayName="PagingList",o.defaultProps={threshold:100,useTranslate3d:!1},t.default=o}));
//# sourceMappingURL=pkg-profile_services.min.js-vflbVPgzv.map