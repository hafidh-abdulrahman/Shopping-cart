define("metaserver/static/js/clean/marketing_tracker",["require","exports","tslib","metaserver/static/js/core/assert","metaserver/static/js/core/exception","js/proto_utils/unpack","typescript/dropbox/proto/js_init_data/marketing_tracker/marketing_tracker_pb","metaserver/static/js/clean/marketing_tracker_base","metaserver/static/js/clean/marketing_tracker_base"],(function(e,t,n,r,i,a,s,o,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.moduleInit=t.getGAViewData=t.getGAEventData=t.MarketingTracker=t.MARKETING_REGISTER_EVENT=t.MARKETING_LOGIN_EVENT=t.DataLayer=t.EventTypeEnum=t.PushOptions=t.MARKETING_URI=void 0,i=n.__importStar(i),s=n.__importStar(s),t.MARKETING_URI="https://marketing.dropbox.com",Object.defineProperty(t,"PushOptions",{enumerable:!0,get:function(){return c.PushOptions}}),Object.defineProperty(t,"EventTypeEnum",{enumerable:!0,get:function(){return c.EventTypeEnum}}),Object.defineProperty(t,"DataLayer",{enumerable:!0,get:function(){return c.DataLayer}}),Object.defineProperty(t,"MARKETING_LOGIN_EVENT",{enumerable:!0,get:function(){return c.MARKETING_LOGIN_EVENT}}),Object.defineProperty(t,"MARKETING_REGISTER_EVENT",{enumerable:!0,get:function(){return c.MARKETING_REGISTER_EVENT}}),t.MarketingTracker=new o.MarketingTrackerSingleton({marketingUri:t.MARKETING_URI,onException:i.reportException,onReportStack:i.reportStack,inclusionMethod:o.InclusionMethod.BASE}),t.getGAEventData=function(e,t,n,r){const i={ga_eventaction:t,ga_eventCategory:e};return n&&(i.ga_eventLabel=n),r&&(i.ga_eventValue=r),i},t.getGAViewData=function(e,t,n){const i={};return(0,r.assert)(!n||n.startsWith("/virtual"),"virtual pageview page should start with virtual"),e&&(i.title=e),t&&(i.ga_pageview_location=t),n&&(i.ga_pageview_page=n),i};const u=e=>{const t={};for(const[n,r]of Object.entries(e.fields))r.kind.value&&(t[n]=r.kind.value);return t};t.moduleInit=function(e){const n=(0,a.unmarshalProto)(e,s.MarketingTrackerData),{src:r}=n,i={tealium_enabled:n.config.tealiumEnabled,tealium_env:n.config.tealiumEnv,tealium_profile:n.config.tealiumProfile,default_marketing_data:u(n.config.defaultMarketingData),privacy_consent_enabled:n.config.privacyConsentEnabled},o=u(n.dataLayer);t.MarketingTracker.push({src:r,config:i,dataLayer:o})}})),define("metaserver/static/js/clean/marketing_tracker_base",["require","exports","metaserver/static/js/core/assert","metaserver/static/js/clean/lazy_marketing_tracker"],(function(e,t,n,r){"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.MarketingTrackerSingleton=t.InclusionMethod=t.EventTypeEnum=t.MARKETING_REGISTER_EVENT=t.MARKETING_LOGIN_EVENT=void 0,Object.defineProperty(t,"InclusionMethod",{enumerable:!0,get:function(){return r.InclusionMethod}}),t.MARKETING_LOGIN_EVENT="user_login",t.MARKETING_REGISTER_EVENT="user_register",(function(e){e.Link="link",e.View="view"})(i=t.EventTypeEnum||(t.EventTypeEnum={}));class a{constructor(e){if(this.el=null,this.ready=!1,this.readyTimeout=null,this.resetForTesting=()=>{this.el=null,this.ready=!1,this.readyTimeout=null},this.push=({src:e,dataLayer:t,config:a,eventType:s})=>{const o=Object.assign(Object.assign({},t),{_config:a||{},_eventType:s||i.Link});(0,n.assert)(!!e,"MarketingTracker.push requires src"),this.ready?this.el&&this.el.contentWindow&&this.el.contentWindow.postMessage(o,this.args.marketingUri):(this.el||(this.el=this.load(e),this.src=e,a&&(this.config=a),this.readyTimeout=setTimeout(()=>{this.args.onException({err:new Error("Timed-out while waiting for marketing_tracker iframe load event"),severity:"non-critical"})},3e4)),this.el.addEventListener("load",()=>{null!==this.readyTimeout&&(clearTimeout(this.readyTimeout),this.readyTimeout=null),this.el&&this.el.contentWindow?(this.ready=!0,this.el.contentWindow.postMessage(o,this.args.marketingUri),(0,r.registerLogToMarketingTrackerFunction)(e=>{this.pushWithDefaults(e,i.Link)},this.args.inclusionMethod)):this.args.onException({err:new Error("Could not find contentWindow on marketing_tracker iframe element"),severity:"non-critical"})}))},this.load=e=>{const t=document.createElement("iframe");return t.style.display="none",t.hidden=!0,t.src=e,t.setAttribute("sandbox","allow-scripts allow-same-origin"),document.body.appendChild(t),t},this.pushWithDefaults=(e,t)=>{const{config:n,src:r}=this;if(n){const i={config:n,dataLayer:Object.assign(Object.assign({},this.config.default_marketing_data),e),src:r,eventType:t};this.push(i)}else this.args.onReportStack("MarketingTracker.pushWithDefaults requires config, which is undefined. This probably           means there is no MarketingTracker instance on the page.")},this.pushEvent=(e,t,n)=>{const r=Object.assign({event:e,tealium_event:e},n);this.pushWithDefaults(r,t)},this.tryPushEvent=(e,t,n)=>{const{config:r,src:a}=this,s={event:e,tealium_event:e};if(n=n||{},r){const e={config:r,dataLayer:Object.assign(Object.assign(Object.assign({},this.config.default_marketing_data),s),n),src:a,eventType:t||i.Link};this.push(e)}},a.instance)return a.instance;this.args=e,a.instance=this}}t.MarketingTrackerSingleton=a})),define("typescript/dropbox/proto/js_init_data/marketing_tracker/marketing_tracker_pb",["require","exports","@bufbuild/protobuf"],(function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MarketingTrackerData=t.Config=void 0;class r extends n.Message{constructor(e){super(),this.tealiumEnabled=!1,this.tealiumEnv="",this.tealiumProfile="",this.privacyConsentEnabled=!1,n.proto3.util.initPartial(e,this)}static fromBinary(e,t){return(new r).fromBinary(e,t)}static fromJson(e,t){return(new r).fromJson(e,t)}static fromJsonString(e,t){return(new r).fromJsonString(e,t)}static equals(e,t){return n.proto3.util.equals(r,e,t)}}t.Config=r,r.runtime=n.proto3,r.typeName="marketing_tracker.Config",r.fields=n.proto3.util.newFieldList(()=>[{no:3,name:"tealium_enabled",kind:"scalar",T:8},{no:4,name:"tealium_env",kind:"scalar",T:9},{no:5,name:"tealium_profile",kind:"scalar",T:9},{no:6,name:"default_marketing_data",kind:"message",T:n.Struct},{no:7,name:"privacy_consent_enabled",kind:"scalar",T:8}]);class i extends n.Message{constructor(e){super(),this.src="",n.proto3.util.initPartial(e,this)}static fromBinary(e,t){return(new i).fromBinary(e,t)}static fromJson(e,t){return(new i).fromJson(e,t)}static fromJsonString(e,t){return(new i).fromJsonString(e,t)}static equals(e,t){return n.proto3.util.equals(i,e,t)}}t.MarketingTrackerData=i,i.runtime=n.proto3,i.typeName="marketing_tracker.MarketingTrackerData",i.fields=n.proto3.util.newFieldList(()=>[{no:1,name:"src",kind:"scalar",T:9},{no:2,name:"config",kind:"message",T:r},{no:3,name:"data_layer",kind:"message",T:n.Struct}])}));
//# sourceMappingURL=pkg-legacy-ac.min.js-vflDm_B3A.map