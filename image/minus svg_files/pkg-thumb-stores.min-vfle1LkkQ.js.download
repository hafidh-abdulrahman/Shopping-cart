define("metaserver/static/js/flux/flux_store",["require","exports"],(function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.FluxStore=void 0;e.FluxStore=class{constructor(t){this._listeners=[],this._dispatcher=t,this._dispatchToken=this._dispatcher.register(this.__invokeOnDispatch.bind(this)),this.__hasChanged=!1}teardown(){this._dispatcher.unregister(this._dispatchToken)}getDispatcher(){return this._dispatcher}getDispatchToken(){return this._dispatchToken}addListener(t){return this._listeners.push(t),()=>this._listeners=Array.from(this._listeners).filter(e=>e!==t)}hasChanged(){return this.__hasChanged}__emitChange(){this.__hasChanged=!0}__invokeOnDispatch(t){if(this.__hasChanged=!1,this.__onDispatch(t),this.__hasChanged)return Array.from(this._listeners).map(t=>t())}}})),define("metaserver/static/js/photos/thumb_loading/http2_thumb_loader",["require","exports","metaserver/static/js/photos/thumb_loading/utils"],(function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Http2ThumbLoader=void 0;e.Http2ThumbLoader=class{constructor(){this.http2RequestId=0}get_request_id(){return this.http2RequestId+=1,this.http2RequestId.toString()}load_image(t,e,r,i,a,h){r(),(0,s.load_individual_image)(t,1,i,a,h)}cancel_thumb(t){}}})),define("metaserver/static/js/photos/thumb_loading/utils",["require","exports"],(function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.load_individual_image=void 0,e.load_individual_image=function(t,e,s,r,i){const a=new Image;a.onload=()=>s(t),a.onerror=()=>{e>0&&i()?(e-=1,a.src=t):r()},a.src=t}})),define("metaserver/static/js/photos/thumb_loading/generic_thumb_store",["require","exports","metaserver/static/js/photos/thumb_loading/http2_thumb_loader","metaserver/static/js/core/assert"],(function(t,e,s,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.GenericThumbStore=void 0;e.GenericThumbStore=class{constructor(t,e){this.loaderBatches=!1,this.thumbUrlToData={},this.callbackByRequestId={},this.loaderBatches=!!e,this.thumbLoader=t||new s.Http2ThumbLoader}is_batching(){return this.loaderBatches}bind_url(t,e){if((0,r.assert)(!!e.onSuccess,"missing onSuccess handler"),this.thumbUrlToData[t])return e.onRequest&&e.onRequest(!0),e.onSuccess(!0),null;const s=this.thumbLoader.get_request_id();this.callbackByRequestId[s]=e;return this.thumbLoader.load_image(t,s,()=>{const t=this.callbackByRequestId[s];t&&t.onRequest&&t.onRequest(!1)},e=>{this.thumbUrlToData[t]=e;const r=this.callbackByRequestId[s];r&&r.onSuccess(!1)},()=>{const t=this.callbackByRequestId[s];t&&t.onError&&t.onError()},()=>this.callbackByRequestId.hasOwnProperty(s)),s}unbind_url(t){t&&(delete this.callbackByRequestId[t],this.thumbLoader.cancel_thumb(t))}get_thumb(t){return this.thumbUrlToData[t]?this.thumbUrlToData[t]:null}}}));
//# sourceMappingURL=pkg-thumb-stores.min.js-vflr0Va1f.map