define("metaserver/static/js/onboarding_checklist/async_share_button_tooltip",["require","exports","tslib","metaserver/static/js/async/loadable","metaserver/static/js/clean/web_timing_logger","metaserver/static/js/browse/data/store"],(function(e,t,s,n,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AsyncOnboardingChecklistShareButtonTooltip=void 0,t.AsyncOnboardingChecklistShareButtonTooltip=(0,n.Loadable)({loader:()=>s.__awaiter(void 0,void 0,void 0,(function*(){yield(0,i.waitForTTI)();const{OnboardingChecklistShareButtonTooltip:t}=yield new Promise((t,s)=>{e(["metaserver/static/js/onboarding_checklist/share_button_tooltip"],t,s)}).then(s.__importStar);return(0,r.getStoreForBrowse)(),t}))})})),define("metaserver/static/js/pass/action_timestamps",["require","exports","tslib","metaserver/static/js/pass/constants","metaserver/static/js/core/exception"],(function(e,t,s,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ActionTimestampsTracker=void 0,i=s.__importStar(i);const r=[n.LoggingActions.PRESENCE_RECEIVE,n.LoggingActions.TRANSMITTER_TOKEN_BEGIN,n.LoggingActions.TRANSMITTER_TOKEN_RECEIVE,n.LoggingActions.RECEIVER_TOKEN_BEGIN,n.LoggingActions.RECEIVER_TOKEN_RECEIVE,n.LoggingActions.SEEN_STATE_USERS_BEGIN,n.LoggingActions.SEEN_STATE_USERS_RECEIVE];t.ActionTimestampsTracker=new class{constructor(){this.allTimestamps={}}record(e,t){const s=(new Date).getTime()/1e3;this.allTimestamps[t]=this.allTimestamps[t]||{};const n=this.allTimestamps[t];n.hasOwnProperty(e)?this.reportStackForRepeatedAction(n,e,t,s):n[e]=s}get(e){return this.allTimestamps[e]||{}}reportStackForRepeatedAction(e,t,s,n){if(r.indexOf(t)>=0)return;const a=e[t];i.reportStack("Attempted to record action for which there existed a previous record",{severity:i.SEVERITY.NONCRITICAL,tags:["pass:actionTimestampsTracker"],exc_extra:{pass_session_id:s,action:t,oldTimestamp:a,newTimestamp:n}})}}})),define("metaserver/static/js/extensions/utils",["require","exports","metaserver/static/js/clean/web_user_action_events"],(function(e,t,s){"use strict";function n(e,t){return t in e&&"enabled"===e[t].service_availability[".tag"]}Object.defineProperty(t,"__esModule",{value:!0}),t.computeSplitShareMenuReferrer=t.toActionBarValue=t.isTrelloAvailable=t.isZoomAvailable=t.isSlackAvailable=void 0;t.isSlackAvailable=e=>n(e,"slack_dropbox");t.isZoomAvailable=e=>n(e,"zoom");t.isTrelloAvailable=e=>n(e,"trello");t.toActionBarValue=e=>({nodeType:"dropdown",actionType:3,menuItem:e});t.computeSplitShareMenuReferrer=(e,t,n,i)=>{let r=`${t}`;return n&&(r=`${n}`,i&&(r=`${n}_${i}`,i===s.ActionSurfaceLogValue.RIGHT_SIDEBAR&&1===e.length?r=`${n}_${i}_single_file`:i===s.ActionSurfaceLogValue.RIGHT_SIDEBAR&&e.length>1&&(r=`${n}_${i}_multi_file`))),r}})),define("metaserver/static/js/integrations/hellosign_deep_integration/background",["require","exports","tslib","react","metaserver/static/js/components/ui/css"],(function(e,t,s,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BackgroundWithCSS=void 0,n=s.__importDefault(n);const r=e=>{var{dimming:t,centeredContent:i}=e,r=s.__rest(e,["dimming","centeredContent"]);const a=["hs-int-dimmer-background",i?"hs-int-dimmer-background-centered":""],o={};return void 0!==t&&(o.backgroundColor="rgba(0, 0, 0, 0.5)"),n.default.createElement("div",{className:a.join(" "),style:o},r.children)};r.displayName="Background",t.BackgroundWithCSS=(0,i.requireCssWithComponent)(r,["/static/metaserver/static/css/integrations/hellosign_deep_integration-vfl5-fUD0.css"])})),define("metaserver/static/js/integrations/hellosign_deep_integration/container",["require","exports","tslib","react-dom","metaserver/static/js/css/css"],(function(e,t,s,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FullScreenContainer=void 0,n=s.__importStar(n),i=s.__importStar(i);t.FullScreenContainer=class{constructor(e=document.body,t=document,s=window){this.show=()=>{this.anchor.contains(this.container)||this.anchor.appendChild(this.container),this.container.hidden=!1},this.hide=()=>{this.container.hidden=!0},this.reset=()=>{this.anchor.removeChild(this.container),this.container=this.createContainer()},this.renderContent=e=>{n.render(e,this.container)},this.hideOverflow=()=>{this.windowObj.scrollTo(0,0),this.documentEl.documentElement.classList.add("hs-int-hellosign-overflow-hide")},this.removeHideOverflow=()=>{this.documentEl.documentElement.classList.remove("hs-int-hellosign-overflow-hide")},this.createContainer=()=>{const e=document.createElement("div");return e.className="hs-int-full-screen-container",e.hidden=!0,e},this.container=this.createContainer(),this.anchor=e,this.documentEl=t,this.windowObj=s,i.require_css("/static/metaserver/static/css/integrations/hellosign_deep_integration-vfl5-fUD0.css")}}})),define("metaserver/static/js/integrations/hellosign_deep_integration/hellosign",["require","exports","tslib","react","react-intl","metaserver/static/js/components/ui/css","metaserver/static/js/core/i18n","dig-components/typography","metaserver/static/js/integrations/hellosign_deep_integration/channel","dig-components/progress_indicators","metaserver/static/js/modules/constants/page_load","metaserver/static/js/modules/core/langpack","metaserver/static/js/core/exception"],(function(e,t,s,n,i,r,a,o,c,l,_,d,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HelloSignWithCSS=void 0,n=s.__importDefault(n),d=s.__importStar(d);class h extends n.default.Component{constructor(e){super(e),this.setIframeRef=e=>{this.iframeRef=e,this.iframeRef.onload=()=>{this.setState({appInitialized:!0})}},this.getMessageHandlers=()=>({[c.MessageType.APP_INITIALIZE]:this.handleAppInitializedMessage,[c.MessageType.DEEP_INTEGRATION_FINISHED]:this.props.onComplete,[c.MessageType.USER_CREATE_TEMPLATE]:this.props.onComplete,[c.MessageType.USER_SEND_REQUEST]:this.props.onComplete,[c.MessageType.USER_CANCEL_REQUEST]:this.props.onClose,[c.MessageType.USER_PREP_SEND_LOG]:this.props.onLog,[c.MessageType.DEEP_INTEGRATION_WAITING_FOR_RECIPIENTS]:this.handleWaitingForRecipientsMessage}),this.handleWaitingForRecipientsMessage=()=>{if(!this.props.recipientInfo){const e=new Error("No Recipient info provided but was requested by iframe");throw(0,u.reportException)({err:e,severity:u.SEVERITY.CRITICAL,tags:["hellosign_deepintegration","better-together"]}),e}this.channel.sendRecipients(this.props.recipientInfo)},this.handleUnknownMessage=(e,t)=>{console.log(e),console.log(t)},this.handleAppInitializedMessage=()=>{this.setState({appInitialized:!0}),this.props.linkHelloSign()},this.getEditorDomain=()=>{const{url:e}=this.props,t=e.getAuthority();return`${e.getScheme()}://${t}`},this.state={appInitialized:!1}}componentDidMount(){this.channel=c.Channel.new(this.getEditorDomain(),this.iframeRef.contentWindow,this.getMessageHandlers(),this.handleUnknownMessage),this.channel.startListening()}componentWillUnmount(){this.channel.stopListening()}render(){const{url:e}=this.props,t=n.default.createElement(i.IntlProvider,{defaultLocale:"en-US",locale:(0,a.localeToBcp47LangTag)(_.USER_LOCALE),messages:d},n.default.createElement("div",{className:"hs-int-hellosign-loading"},n.default.createElement(l.Spinner,{className:"hs-int-hellosign-spinner","aria-valuetext":"Loading large",size:"large"}),n.default.createElement("div",{className:"hs-int-hellosign-loading-copy"},n.default.createElement(o.Title,{size:"standard"},n.default.createElement(i.FormattedMessage,{id:"JZpfYr",defaultMessage:"Preparing document..."})))));return n.default.createElement("div",{className:"hs-int-hellosign-page"},!this.state.appInitialized&&t,n.default.createElement("iframe",{ref:this.setIframeRef,className:"hs-int-hellosign-page-iframe",src:e.toString()}))}}h.displayName="HelloSign",t.HelloSignWithCSS=(0,r.requireCssWithComponent)(h,["/static/metaserver/static/css/integrations/hellosign_deep_integration-vfl5-fUD0.css"])})),define("metaserver/static/js/integrations/hellosign_deep_integration/launcher",["require","exports","tslib","react","metaserver/static/js/integrations/hellosign_deep_integration/container","dig-components/icons/src","metaserver/static/js/core/browser","metaserver/static/js/core/browser","metaserver/static/js/core/exception","metaserver/static/js/clean/analytics","metaserver/static/js/integrations/hellosign_deep_integration/tos_with_recipients_info","metaserver/static/js/integrations/hellosign_deep_integration/tos","metaserver/static/js/integrations/hellosign_deep_integration/safari_unsupported_modal","metaserver/static/js/integrations/hellosign_deep_integration/background","metaserver/static/js/integrations/hellosign_deep_integration/hellosign","metaserver/static/js/api_v2/noauth_client","metaserver/static/js/clean/active_user","metaserver/static/js/api_v2/default_user_client","metaserver/static/js/integrations/log_event","typescript/component_libraries/deep-integrations/src/instrumentation/constants","metaserver/static/js/core/i18n","lodash","metaserver/static/js/integrations/hellosign_deep_integration/channel","metaserver/static/js/core/uri","metaserver/static/js/dropins_sdk_refactor/src/v2_entry","metaserver/static/js/profile_services/profile_services_link","metaserver/static/js/profile_services/profile_services_constants","metaserver/static/js/clean/ui/snackbar","metaserver/static/js/core/browser_detection","metaserver/static/js/clean/base64","metaserver/static/js/modules/constants/page_load","metaserver/static/js/stormcrow/stormcrow_exposure_logger","metaserver/static/js/stormcrow/gating_factory","js/filepath/filepath","metaserver/static/js/user_survey/user_survey"],(function(e,t,s,n,i,r,a,o,c,l,_,d,u,h,g,E,p,m,f,S,I,T,C,v,N,A,b,O,R,y,M,L,w,P,k){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getLauncher=t.HELLOSIGN_SUPPORTED_EXTENSIONS=void 0,n=s.__importDefault(n),a=s.__importStar(a),T=s.__importStar(T),b=s.__importDefault(b),R=s.__importStar(R),y=s.__importStar(y),P=s.__importStar(P),t.HELLOSIGN_SUPPORTED_EXTENSIONS=[".doc",".docx",".pdf",".ppsx",".ppt",".pptx",".jpg",".jpeg",".png",".xls",".xlsx",".txt",".html",".gif"];const U=()=>{const e=(0,p.getActiveUser)();return e?new m.DefaultUserApiV2Client(e):new E.NoAuthApiV2Client};class D{constructor(e){this.optInRequired=!1,this.init=e=>{let t=e.apiV2Client||this.config.apiV2Client;void 0===e.apiV2Client&&e.user&&e.user!==this.config.user&&(t=new m.DefaultUserApiV2Client(e.user)),this.config.selfSign=!1,this.config=Object.assign(Object.assign(Object.assign({},this.config),e),{apiV2Client:t}),this.recipientInfo=void 0,this.refreshUserSettings(),this.refreshFeatureVariant()},this.launch=()=>{if(!this.readyToLaunch()||!this.sendForSignatureEnabled)throw this.config.logEvent({event_name:S.InstrEventType.Failure,feature_name:S.InstrFeatureType.HelloSignDeepIntegration,extra:Object.assign({action:S.InstrActionType.Start,entry_point:this.config.entryPoint},this.config.source?{source:this.config.source}:{})}),new Error("launcher isn't ready to launch. Make sure you have correctly initialized it.");return this.config.logEvent({event_name:S.InstrEventType.SelectAction,feature_name:S.InstrFeatureType.HelloSignDeepIntegration,extra:Object.assign(Object.assign({action:S.InstrActionType.Start,entry_point:this.config.entryPoint},this.config.source?{source:this.config.source}:{}),{file_extension:this.getFileExtensionForLog(this.config.file)})}),R.msie?(this.config.logEvent({event_name:S.InstrEventType.ActionTaken,feature_name:S.InstrFeatureType.HelloSignDeepIntegration,extra:Object.assign({action:S.InstrActionType.MSIEUnsupported,entry_point:this.config.entryPoint},this.config.source?{source:this.config.source}:{})}),this.showUnsupportedBrowserSnackbar(),Promise.resolve()):Promise.all([this.sendForSignatureEnabled,this.safariFixDisabled]).then(([e,t])=>{if(!e)return this.config.logEvent({event_name:S.InstrEventType.ActionTaken,feature_name:S.InstrFeatureType.HelloSignDeepIntegration,extra:Object.assign({action:S.InstrActionType.FeatureDisabled,entry_point:this.config.entryPoint},this.config.source?{source:this.config.source}:{})}),void this.showTeamDisabledSnackbar();if(this.config.container.show(),R.safari){if(void 0===t)throw"safariFixDisabled is not loaded.";const{variant:e}=t;if("ON"!==e)return this.config.logEvent({event_name:S.InstrEventType.ActionTaken,feature_name:S.InstrFeatureType.HelloSignDeepIntegration,extra:Object.assign({action:S.InstrActionType.SafariUnsupported,entry_point:this.config.entryPoint},this.config.source?{source:this.config.source}:{})}),void this.showSafariUnsupportedModal()}return this.tosAccepted.then(e=>s.__awaiter(this,void 0,void 0,(function*(){e?!R.safari&&!R.mozilla||this.config.hasOwnProperty("file")?yield this.showHelloSignPage():this.showTosChooseFilePage():yield this.showTosAcceptTermsPage()}))).catch(e=>{console.log(e),this.reset(),this.config.logEvent({event_name:S.InstrEventType.Failure,feature_name:S.InstrFeatureType.HelloSignDeepIntegration,extra:Object.assign(Object.assign({action:S.InstrActionType.Start,entry_point:this.config.entryPoint,error:e},this.config.source?{source:this.config.source}:{}),{file_extension:this.getFileExtensionForLog(this.config.file)})})})})},this.hideOverflow=()=>{this.config.hasOwnProperty("file")||this.config.container.hideOverflow()},this.removeHideOverflow=()=>{this.config.hasOwnProperty("file")||this.config.container.removeHideOverflow()},this.show=()=>{this.hideOverflow(),this.config.container.show()},this.hide=()=>{this.removeHideOverflow(),this.config.container.hide()},this.resetWhenCancelled=e=>{if(e.payload&&e.payload.path)switch(e.payload.path){case C.DeepIntegrationSteps.RECIPIENTS_PAGE:k.UserSurvey.trackEvent("hs_exit_who_needs_to_sign_screen","hellosign_deep_integration");break;case C.DeepIntegrationSteps.EDITOR_PAGE:k.UserSurvey.trackEvent("hs_exit_editor","hellosign_deep_integration");break;case C.DeepIntegrationSteps.REVIEW:k.UserSurvey.trackEvent("hs_exit_final_send_for_sig_screen","hellosign_deep_integration")}return this.reset()},this.reset=()=>(this.config.container.reset(),this.removeHideOverflow(),this.recipientInfo=void 0,this.refreshUserSettings()),this.showTosChooseFilePage=()=>s.__awaiter(this,void 0,void 0,(function*(){this.hideOverflow();const e=this.rebrandingVariant?yield this.getVariant(this.rebrandingVariant):"ON",t=!!this.btOldHsTosRebranding&&(yield this.getVariant(this.btOldHsTosRebranding));this.config.container.renderContent(n.default.createElement(h.BackgroundWithCSS,{dimming:!0,centeredContent:!0},n.default.createElement(d.TermsOfServiceWithCSS,{onAcceptTos:this.acceptTosInUserSettings,onClose:this.hide,onStart:this.showHelloSignPage,onChooseFile:this.showHelloSignPage,chooseFileRequired:void 0===this.config.file,logEvent:this.config.logEvent,optInRequired:this.optInRequired,pageNum:2,rebrandingVariant:e,btOldHsTosRebranding:t})))})),this.showTosAcceptTermsPage=()=>s.__awaiter(this,void 0,void 0,(function*(){const e=this.showHelloSignPage;this.hideOverflow();const t=this.config.file;if(this.config.templateFlow||!t||this.config.selfSign){const t=yield this.getVariant(this.rebrandingVariant),s=yield this.getVariant(this.btOldHsTosRebranding);this.config.container.renderContent(n.default.createElement(h.BackgroundWithCSS,{dimming:!0,centeredContent:!0},n.default.createElement(d.TermsOfServiceWithCSS,{onAcceptTos:this.acceptTosInUserSettings,onClose:this.hide,onStart:e,onChooseFile:e,chooseFileRequired:void 0===this.config.file,logEvent:this.config.logEvent,optInRequired:this.optInRequired,rebrandingVariant:t,btOldHsTosRebranding:s})))}else{const s=(null==t?void 0:t.fq_path)?String(null==t?void 0:t.fq_path.split("/").slice(-1)):"",i=yield this.getVariant(this.rebrandingVariant);this.config.container.renderContent(n.default.createElement(h.BackgroundWithCSS,{dimming:!0,centeredContent:!0},n.default.createElement(_.TermsOfServiceWithCSS,{onAcceptTos:this.acceptTosInUserSettings,onContinueWithoutTos:this.updateRecipientsInfo,onStart:e,onClose:this.hide,logEvent:this.config.logEvent,fileName:s,optInRequired:this.optInRequired,userHasSeenModal:!1,rebrandingVariant:i})))}})),this.showSafariUnsupportedModal=()=>{const e=I.intl.formatMessage({id:"WC+meb",defaultMessage:"Couldn’t start signature request"}),t=I.intl.formatMessage({id:"vxnAb7",defaultMessage:"This feature isn’t available on Safari, but will be soon. Please try on a different browser."}),s=I.intl.formatMessage({id:"WAQpuN",defaultMessage:"Close"});this.hideOverflow(),this.config.container.renderContent(n.default.createElement(h.BackgroundWithCSS,{dimming:!0,centeredContent:!0},n.default.createElement(u.SafariUnsupportedModalWithCSS,{title:e,body:t,buttonName:s,learnMoreLink:"https://help.dropbox.com/installs-integrations/third-party/hellosign#sign",onClose:this.reset})))},this.showFileChooser=e=>new Promise((s,n)=>{const i={success:function(e){e.length&&s(e[0]),s(void 0)},cancel:function(){s(void 0)},linkType:"direct",multiselect:!1,extensions:t.HELLOSIGN_SUPPORTED_EXTENSIONS,folderselect:!1,initialNavigationPath:e};N.Dropbox.choose(i)}),this.showHelloSignPage=()=>s.__awaiter(this,void 0,void 0,(function*(){const{fileId:e,filePath:t}=yield this.getFileIdAndPath();if(!e)return;this.hideOverflow();let s=void 0;R.safari&&(s=yield this.getDBXAuthLink());const i=yield this.getHelloSignUrl(e,t,s,this.allowEmailOptedIn),r=yield this.getVariant(this.signaturesTabOnShareVariant),a=yield this.getVariant(this.signaturesHubVariant);this.config.container.renderContent(n.default.createElement(h.BackgroundWithCSS,{centeredContent:!0},n.default.createElement(g.HelloSignWithCSS,{onClose:this.resetWhenCancelled,onComplete:e=>this.handleSignatureRequestComplete(e,r,a),onLog:this.handleLog,recipientInfo:this.getRecipientsPayload(),url:i,linkHelloSign:this.linkHelloSignIfNecessary})))})),this.getRecipientsPayload=()=>{let e;return this.config.selfSign?e={selfSign:this.config.selfSign,signers:[],recipientReassignment:!1,recipientOrder:!1}:this.recipientInfo&&(e=this.recipientInfo),e},this.dbxCollectedRecipientInfo=()=>!!this.config.selfSign||!!this.recipientInfo,this.showTeamDisabledSnackbar=()=>{this.showFailSnackbar(I.intl.formatMessage({id:"7NLYW8",defaultMessage:"The HelloSign integration has been disabled by your admin."}),I.intl.formatMessage({id:"u/p3Pl",defaultMessage:"Close"}))},this.showSendForSignatureSuccessSnackbar=(e,t)=>{switch(this.config.entryPoint){case"landing_page":return void a.redirect("/hellosign/home");case"share_page_signature_tab_default":case"share_page_signature_tab_empty_state":return void a.redirect("/share/signatures");case"signature_hub_self_sign":case"signature_hub":return void a.redirect("/signatures")}switch(this.config.source){case"signature-hub":return void a.redirect("/signatures")}const s=this.config.user;if(!s)throw new Error("User is missing in the config.");const i={name:"track_status",icon:r.SignatureLine,onClick:function(s){const n=["rich_snackbar_click","track_signature_status",e].join("_");let i;l.ProEventsLogger.log(n,{action:"rich_snackbar_click",variant:e}),"V1"===e?i="/hellosign/home":"V2"===e?i="/share/signatures":"V1"===t||"V2"===t?i="/signatures":((0,c.reportException)({err:new Error(`Unexpected click for feature ${S.InstrFeatureType.SignaturesTabOnShare}`+`with variant ${e}`),severity:c.SEVERITY.NONCRITICAL,tags:["rich_snackbar","product-growth"]}),i="/hellosign/home");i+="?_tk=post_signature_send_snackbar",(0,o.redirect)(i)},text:I.intl.formatMessage({id:"6B08Qw",defaultMessage:"Track status"})},_={clickHandlerArgs:{userId:s.id,filePath:""},actions:[i],actionBarAlignment:"left"},d=I.intl.formatMessage({id:"h7GFOm",defaultMessage:"File shared for signature"});O.Snackbar.show(n.default.createElement(O.Snackbar,{id:"track_status_snackbar",title:d,variant:"complete",richSnackbarProps:_,timeoutDelayMs:1e4,forceDig:!0}))},this.showUnsupportedBrowserSnackbar=()=>{this.showFailSnackbar(I.intl.formatMessage({id:"Cl3pwT",defaultMessage:"This feature isn’t available on Internet Explorer. Please try on a different browser."}),I.intl.formatMessage({id:"u/p3Pl",defaultMessage:"Close"}))},this.showFailSnackbar=(e,t)=>{O.Snackbar.show(n.default.createElement(O.Snackbar,{variant:"fail",timeoutDelayMs:1e4,title:e,closeButtonText:t}))},this.showRedirectSnackbar=()=>{O.Snackbar.show(n.default.createElement(O.Snackbar,{variant:"complete",timeoutDelayMs:1e4,title:I.intl.formatMessage({id:"rdpIKz",defaultMessage:"Redirecting you to the file preview."})}))},this.linkHelloSignIfNecessary=()=>s.__awaiter(this,void 0,void 0,(function*(){(yield this.isHelloSignProfileServiceLinked())?this.config.logEvent({event_name:S.InstrEventType.ActionTaken,feature_name:S.InstrFeatureType.HelloSignDeepIntegration,extra:Object.assign(Object.assign({action:S.InstrActionType.Start,entry_point:this.config.entryPoint},this.config.source?{source:this.config.source}:{}),{file_extension:this.getFileExtensionForLog(this.config.file)})}):yield this.linkHelloSign()})),this.getDBXAuthLink=()=>s.__awaiter(this,void 0,void 0,(function*(){if(!this.config.user)throw"launcher isn't ready to launch. Make sure you have correctly initialized it.";if(yield this.isHelloSignProfileServiceLinked())return;const e=new A.ProfileServicesLinkingHandler,t=yield e.auth_service_with_user_promise(b.default.HELLOSIGN,this.config.user.id,null,"link_contacts",A.AuthWindowOption.HIDDEN_IFRAME,void 0,void 0,void 0,void 0,!0);return(null==t?void 0:t.dbx_auth)||void 0})),this.linkHelloSign=()=>s.__awaiter(this,void 0,void 0,(function*(){if(!this.config.user)throw"launcher isn't ready to launch. Make sure you have correctly initialized it.";const e=new A.ProfileServicesLinkingHandler;this.config.logEvent({event_name:S.InstrEventType.ServiceConnectionFlowStart,feature_name:S.InstrFeatureType.HelloSignDeepIntegration,extra:Object.assign(Object.assign({entry_point:this.config.entryPoint},this.config.source?{source:this.config.source}:{}),{file_extension:this.getFileExtensionForLog(this.config.file)})}),yield e.auth_service_with_user_promise(b.default.HELLOSIGN,this.config.user.id,null,"link_contacts",A.AuthWindowOption.HIDDEN_IFRAME).then(({success:e})=>{e?console.log("HelloSign OAuth succeeded"):console.log("HelloSign OAuth failed")}).catch(e=>{console.log(e)}).finally(()=>{this.config.logEvent({event_name:S.InstrEventType.ServiceConnectionFlowEnd,feature_name:S.InstrFeatureType.HelloSignDeepIntegration,extra:Object.assign({entry_point:this.config.entryPoint},this.config.source?{source:this.config.source}:{})})})})),this.isHelloSignProfileServiceLinked=()=>this.config.apiV2Client.ns("profile_services").rpc("list_linked_services",void 0,{}).then(e=>e.linked_services.filter(e=>"hellosign"===e.service_type[".tag"]&&"is_connected"===e.connection_state[".tag"]).length>0),this.getHelloSignUrl=(e,t,n,i)=>s.__awaiter(this,void 0,void 0,(function*(){var s;const r=yield this.helloSignEnvironment;if(!r)throw"launcher has not been initialized, please call init() first";const{user:o,templateFlow:c,templateRoute:l}=this.config;if(!o)throw"launcher has not been initialized with a valid user, please set a user in init() first";n&&(n=y.encode(n));let _=new v.URI;return _.setScheme("https"),_.setAuthority(r.domain),_.setPath("/dropbox/embedded"),_.updateQuery({client_id:r.client_id,user:o.account_id,role:o.role,file_id:e,file_path:t,dbx_auth:n,email_optin:"boolean"==typeof i?String(i):void 0,utm_source:null!==(s=this.config.utmSource)&&void 0!==s?s:"dropbox-deep-integration",dbx_locale:M.USER_LOCALE,di_hs_home:"1",rpbhp:String(this.dbxCollectedRecipientInfo())}),this.isOnDevbox()&&_.updateQuery({parent_url:a.get_origin()}),c&&(_.updateQuery({template:"1"}),l&&(l.startsWith("http")?(_=v.URI.parse(l),_.updateQuery({client_id:r.client_id,parent_url:window.location.href,js_version:"2.0"})):_.setPath(l))),_})),this.isOnDevbox=()=>/^https:\/\/.*\.dev\.corp\.dropbox\.com$/.test(a.get_origin()),this.getFileIdAndPath=()=>s.__awaiter(this,void 0,void 0,(function*(){let e=this.config.file;if(!e){!R.safari&&!R.mozilla&&this.hide();const t=yield this.showFileChooser(this.config.fileChooserInitialNavigationPath);if(!t)return{};!R.safari&&!R.mozilla&&this.show(),e={file_id:t.id}}return e?e.fq_path?{fileId:e.file_id,filePath:e.fq_path.split("/").slice(0,-1).join("/")}:{fileId:e.file_id}:{}})),this.readyToLaunch=()=>!("unknown"===this.config.entryPoint||void 0===this.tosAccepted||!this.config.user),this.refreshUserSettings=()=>{const e=this.config.apiV2Client.ns("integrations").rpc("get_user_settings",{},{});return this.config.logEvent({event_name:S.InstrEventType.APITrace,feature_name:S.InstrFeatureType.HelloSignDeepIntegration,extra:Object.assign({api_name:"get_user_settings",entry_point:this.config.entryPoint},this.config.source?{source:this.config.source}:{})}),e.then(e=>{var t;this.optInRequired=!!(null===(t=e.hellosign_settings)||void 0===t?void 0:t.opt_in_required)}),this.tosAccepted=e.then(e=>{var t;return!!(null===(t=e.hellosign_settings)||void 0===t?void 0:t.tos_accepted)}),this.helloSignEnvironment=e.then(e=>e.hellosign_environment),this.sendForSignatureEnabled=e.then(e=>{var t;return!!(null===(t=e.hellosign_settings)||void 0===t?void 0:t.send_for_signature_enabled)}),this.userSawSignersModal=e.then(e=>{var t;return!!(null===(t=e.hellosign_settings)||void 0===t?void 0:t.user_saw_signers_modal)}),Promise.all([this.tosAccepted,this.helloSignEnvironment,this.sendForSignatureEnabled,this.userSawSignersModal])},this.refreshFeatureVariant=()=>{const e=this.config.apiV2Client.ns("integrations").rpc("are_features_available",{features:[{feature:S.InstrFeatureType.HelloSignDeepIntegrationSafariFixDisabled},{feature:S.InstrFeatureType.SignaturesTabOnShare},{feature:S.InstrFeatureType.TosWithRecipientsInfo},{feature:S.InstrFeatureType.SignaturesHub},{feature:S.InstrFeatureType.DropboxSignRebrand},{feature:S.InstrFeatureType.BtOldHsTosRebranding}]},{});return this.config.logEvent({event_name:S.InstrEventType.APITrace,feature_name:S.InstrFeatureType.HelloSignDeepIntegration,extra:Object.assign({api_name:"are_features_available",entry_point:this.config.entryPoint},this.config.source?{source:this.config.source}:{})}),this.safariFixDisabled=e.then(e=>e.features[0]),this.signaturesTabOnShareVariant=e.then(e=>e.features[1]),this.tosWithRecipientsInfoVariant=e.then(e=>e.features[2]),this.signaturesHubVariant=e.then(e=>e.features[3]),this.rebrandingVariant=e.then(e=>e.features[4]),this.btOldHsTosRebranding=e.then(e=>e.features[5]),Promise.all([this.safariFixDisabled,this.signaturesTabOnShareVariant,this.tosWithRecipientsInfoVariant,this.signaturesHubVariant,this.rebrandingVariant,this.btOldHsTosRebranding])},this.acceptTosInUserSettings=(e,t)=>{t?this.config.apiV2Client.ns("integrations").rpc("set_user_settings",{hellosign_settings:{tos_accepted:!0,user_saw_signers_modal:!0}},{}).then(()=>{this.tosAccepted=Promise.resolve(!0),this.userSawSignersModal=Promise.resolve(!0)}):this.config.apiV2Client.ns("integrations").rpc("set_user_settings",{hellosign_settings:{tos_accepted:!0}},{}).then(()=>{this.tosAccepted=Promise.resolve(!0)}),this.config.logEvent({event_name:S.InstrEventType.APITrace,feature_name:S.InstrFeatureType.HelloSignDeepIntegration,extra:Object.assign({api_name:"set_user_settings",entry_point:this.config.entryPoint},this.config.source?{source:this.config.source}:{})}),this.allowEmailOptedIn=e,this.updateRecipientsInfo(t)},this.updateRecipientsInfo=e=>{const t=null==e?void 0:e.filter(e=>!!e.name);if(t&&t.length>0){const e={selfSign:!1,signers:t,recipientReassignment:!1,recipientOrder:!1};this.recipientInfo=e}else t&&0===t.length&&(this.config.selfSign=!0)},this.getFileExtensionForLog=e=>{if(!e)return"file_not_selected";try{let s;return e.filename?s=P.file_extension(e.filename):e.fq_path&&(s=P.file_extension(P.filename(e.fq_path))),s?t.HELLOSIGN_SUPPORTED_EXTENSIONS.includes("."+s)?s:"not_in_loggable_allowlist":"file_name_unknown"}catch(e){return"error_getting_filename"}},this.handleSignatureRequestComplete=(e,t,s)=>{var n,i;if(this.logSignaturesTabOnShareExposure(S.InstrFeatureType.SignaturesTabOnShare,t),e&&e.payload){this.config.logEvent({event_name:S.InstrEventType.UpdateFile,feature_name:S.InstrFeatureType.HelloSignDeepIntegration,extra:Object.assign(Object.assign({entry_point:this.config.entryPoint},this.config.source?{source:this.config.source}:{}),{file_extension:this.getFileExtensionForLog(this.config.file)})});const n=e.payload.filePath;if((this.isSignaturesTabOnShareExpOn(t)||this.isSignaturesHubOn(s))&&e.type===C.MessageType.DEEP_INTEGRATION_FINISHED)this.showSendForSignatureSuccessSnackbar(t,s);else if(!["signature_hub_create_template","signature_hub_use_template","signature_hub_edit_template","signature_hub_empty_template_tab_create_template","signature_hub_snackbar_use_template"].includes(this.config.entryPoint))if(this.showRedirectSnackbar(),"signature_hub"===this.config.entryPoint||"signature_hub_self_sign"===this.config.entryPoint)a.redirect(v.URI.parse("/signatures").toString());else if(n&&n.includes("/hellosign/home"))a.redirect(v.URI.parse(n).updateQuery("new","1").toString());else if(e.type===C.MessageType.USER_CREATE_TEMPLATE){const t=e.payload.template_guid,s=v.URI.parse("/hellosign/templates");t&&s.updateQuery({guid:t,"use-template-modal":"1"}),a.redirect(s.toString())}else if(e.type===C.MessageType.USER_SEND_REQUEST){const t=v.URI.parse("/hellosign/home"),s=e.payload.signatureRequestId;s&&t.updateQuery({request:s}),a.redirect(t.toString())}else a.redirect(new v.URI({path:`/preview${n}`}).toString())}null===(i=(n=this.config).afterComplete)||void 0===i||i.call(n,e.payload),this.reset()},this.getVariant=e=>s.__awaiter(this,void 0,void 0,(function*(){if(!e)return!1;const t=yield e;if(void 0===t)return!1;const{available:s,variant:n}=t;return"available"===s[".tag"]&&void 0!==n&&"OFF"!==n&&n})),this.config=e,N.Dropbox.init({appKey:"dropbox",productKey:"hellosign"})}handleLog(e){var t;this.config.logEvent({event_name:S.InstrActionType.PrepSendLog,feature_name:S.InstrFeatureType.HelloSignDeepIntegration,extra:Object.assign(Object.assign(Object.assign({entry_point:this.config.entryPoint},null!==(t=null==e?void 0:e.payload)&&void 0!==t?t:{}),this.config.source?{source:this.config.source}:{}),{file_extension:this.getFileExtensionForLog(this.config.file)})})}isSignaturesTabOnShareExpOn(e){return"V1"===e||"V2"===e}isSignaturesHubOn(e){return"V1"===e||"V2"===e}logSignaturesTabOnShareExposure(e,t){if(this.isSignaturesTabOnShareExpOn(t)){(new L.StormcrowExposureLogger).logExposure(e,t);const s={stormcrowVariantInfo:{feature:e,variant:t}};(0,w.getGatingClientSingleton)().logExposure(s)}}}t.getLauncher=T.memoize(()=>{const e={entryPoint:"unknown",container:new i.FullScreenContainer,apiV2Client:U(),logEvent:(0,f.createIntegrationsActionsLogger)().logEvent,user:(0,p.getActiveUser)()};return new D(e)})})),define("metaserver/static/js/integrations/hellosign_deep_integration/tos",["require","exports","tslib","react","metaserver/static/js/components/ui/css","dig-components/controls","spectrum/icon_form/index","typescript/component_libraries/deep-integrations/src/text/text","dig-components/buttons","typescript/component_libraries/deep-integrations/src/instrumentation/function_wrapper","typescript/component_libraries/deep-integrations/src/instrumentation/constants","metaserver/static/js/integrations/hellosign_deep_integration/assets","metaserver/static/js/core/i18n","react-intl","metaserver/static/js/integrations/hellosign_deep_integration/localized_graphic","metaserver/static/js/core/browser_detection"],(function(e,t,s,n,i,r,a,o,c,l,_,d,u,h,g,E){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TermsOfServiceWithCSS=t.PageName=void 0,n=s.__importDefault(n),E=s.__importStar(E);const p={agree:u.intl.formatMessage({id:"k2WBHu",defaultMessage:"Agree"}),cancel:u.intl.formatMessage({id:"fCZlT5",defaultMessage:"Cancel"}),chooseFile:u.intl.formatMessage({id:"SvnKud",defaultMessage:"Choose a File"})};var m;(function(e){e.AcceptPage="accept_page",e.ChooseFilePage="choose_file_page"})(m=t.PageName||(t.PageName={}));const f=({primaryButtonText:e,onClickPrimaryButton:t,primaryButtonDisabled:s,secondaryButtonText:i,onClickSecondaryButton:r,leftColumnContent:o,rightColumnContent:l,onClose:_,blueSide:h})=>{const g=u.intl.formatMessage({id:"9yYWu+",defaultMessage:"Close"}),E=i&&r?n.default.createElement(c.Button,{onClick:r,title:i,variant:"opacity"},i):null,p=n.default.createElement("div",{className:"hs-int-tos-container-right-col-action-buttons"},E,n.default.createElement("div",{style:{width:10}}),n.default.createElement(c.Button,{onClick:t,title:e,variant:"primary",disabled:s,className:"hs-int-tos-accept-button"},e)),[m,f]="left"===h?["hs-int-tos-container-left-col-blue","hs-int-tos-container-right-col"]:["hs-int-tos-container-left-col","hs-int-tos-container-right-col-blue"];return n.default.createElement("div",{className:"hs-int-tos-container"},n.default.createElement("div",{className:m},n.default.createElement("div",{className:"hs-int-tos-container-left-col-logo"},n.default.createElement(d.DropboxLogo,{color:"left"===h?"white":"sapphire"})),n.default.createElement("div",{className:"hs-int-tos-container-left-col-content"},o),"left"===h?null:p),n.default.createElement("div",{className:f},n.default.createElement("div",{className:"hs-int-tos-container-right-col-close-wrapper"},n.default.createElement("div",{className:"hs-int-tos-container-right-col-close"},n.default.createElement(c.Button,{onClick:_,title:g,variant:"transparent",hasNoUnderline:!0},n.default.createElement(a.IconForm,{name:"cancel"})))),n.default.createElement("div",{className:"hs-int-tos-container-right-col-content"},l),"left"===h?p:null))};f.displayName="TermsOfServiceContainer";t.TermsOfServiceWithCSS=(0,i.requireCssWithComponent)(({onAcceptTos:e,onClose:t,onStart:s,onChooseFile:i,chooseFileRequired:a,logEvent:c,optInRequired:d,pageNum:S,rebrandingVariant:I,btOldHsTosRebranding:T})=>{const[C,v]=n.default.useState(S||1),[N,A]=n.default.useState(!1),[b,O]=n.default.useState(!1),R=(0,l.functionWrapperProvider)(c,_.InstrFeatureType.HelloSignDeepIntegrationTOS),y=({title:e,subTitle:t,textColor:s})=>n.default.createElement("div",null,n.default.createElement("div",{className:"hs-int-tos-container-left-col-title"},n.default.createElement(o.Text,{fontWeight:"medium",color:s,size:"xxxlarge"},e)),n.default.createElement("div",{className:"hs-int-tos-container-left-col-subtitle"},n.default.createElement(o.Text,{color:s,size:"large"},t))),M=()=>{const e=m.ChooseFilePage,s=(0,l.onClickWrapper)(R,_.InstrActionType.ChooseFile,i,{extra:{tos_page_name:e}}),[r,a]=[p.chooseFile,s],c=n.default.createElement(n.default.Fragment,null,n.default.createElement(y,{title:u.intl.formatMessage({id:"AzuKe2",defaultMessage:"Simple, secure eSignatures"}),subTitle:u.intl.formatMessage({id:"bBvwr6",defaultMessage:"Send, sign and store your most important documents - all in Dropbox"}),textColor:"text"}),n.default.createElement("ol",{className:"hs-int-tos-info-page-right-col-intro"},[u.intl.formatMessage({id:"hRdISa",defaultMessage:"<bold>Simply add signers</bold> by email address to send out for signature requests."},{bold:(...e)=>n.default.createElement(o.Text,{color:"text",size:"small",fontWeight:"medium"},e)}),u.intl.formatMessage({id:"LTJsAc",defaultMessage:"<bold>Easily prep your document</bold> by placing fields to specify the sections that needs to be signed, dated and more."},{bold:(...e)=>n.default.createElement(o.Text,{color:"text",size:"small",fontWeight:"medium"},e)}),u.intl.formatMessage({id:"swViYV",defaultMessage:"<bold>Choose your Dropbox folder</bold> for your signed copy to be automatically saved and safely stored."},{bold:(...e)=>n.default.createElement(o.Text,{color:"text",size:"small",fontWeight:"medium"},e)})].map((e,t)=>n.default.createElement(o.Text,{color:"text",size:"small",key:t},n.default.createElement("li",null,0!==t?n.default.createElement("div",{style:{height:16}}):null,e))))),d="ON"===I&&"ON"===T?u.intl.formatMessage({id:"P6WV1e",defaultMessage:"Dropbox Sign Deep Integration"}):u.intl.formatMessage({id:"yluH71",defaultMessage:"HelloSign Deep Integration"}),h=n.default.createElement("div",{className:"hs-int-tos-info-page-right-col"},n.default.createElement("img",{src:(0,g.localizedAsset)(),alt:d,className:"hs-int-tos-info-page-right-col-media"}));return n.default.createElement(f,{primaryButtonText:r,onClickPrimaryButton:a,leftColumnContent:c,rightColumnContent:h,onClose:t,blueSide:"right"})};if(1===C)return(()=>{const i=m.AcceptPage,c=(0,l.onClickWrapper)(R,_.InstrActionType.AcceptTOS,()=>{a?v(e=>e+1):s(),e(!d||b)},{extra:{tos_page_name:i}}),g=(0,l.onClickWrapper)(R,_.InstrActionType.CancelFlow,t,{extra:{tos_page_name:i}}),E=(0,l.onClickWrapper)(R,_.InstrActionType.ViewTerms,()=>{},{extra:{tos_page_name:i}}),S=(0,l.onClickWrapper)(R,_.InstrActionType.ViewPrivacyPolicy,()=>{},{extra:{tos_page_name:i}}),C=n.default.createElement(y,{title:"ON"===I&&"ON"===T?u.intl.formatMessage({id:"7httnm",defaultMessage:"Get documents signed with Dropbox Sign"}):u.intl.formatMessage({id:"ljvDJ8",defaultMessage:"Get documents signed with HelloSign— a Dropbox company"}),subTitle:"ON"===I&&"ON"===T?u.intl.formatMessage({id:"4Wcb1b",defaultMessage:"Dropbox Sign lets you request signatures or sign documents right from Dropbox."}):u.intl.formatMessage({id:"+0ofKf",defaultMessage:"HelloSign lets you request signatures or sign documents right from Dropbox."}),textColor:"text-inverted"}),M="ON"===I&&"ON"===T?(0,h.defineMessage)({id:"4DXKsB",defaultMessage:"I agree to the Dropbox Sign <term>Terms</term> and <policy>Privacy Policy</policy>."}):(0,h.defineMessage)({id:"VYh0UK",defaultMessage:"I agree to the HelloSign <term>Terms</term> and <policy>Privacy Policy</policy>."}),L=u.intl.formatMessage(M,{term:e=>n.default.createElement("a",{href:"https://www.hellosign.com/terms",target:"_blank",rel:"noreferrer noopener",onClick:E},e),policy:e=>n.default.createElement("a",{href:"https://www.hellosign.com/privacy",target:"_blank",rel:"noreferrer noopener",onClick:S},e)}),w=u.intl.formatMessage(M,{term:e=>e,policy:e=>e}),P="ON"===I&&"ON"===T?u.intl.formatMessage({id:"uzC4BU",defaultMessage:"Send me Dropbox Sign updates."}):u.intl.formatMessage({id:"gMMLpm",defaultMessage:"Send me HelloSign updates."}),k=n.default.createElement("div",{className:"hs-int-tos-accept-page-right-col-content"},n.default.createElement(o.Text,{color:"text",size:"large"},"ON"===I&&"ON"===T?u.intl.formatMessage({id:"B9nvoc",defaultMessage:"We’ll create a Dropbox Sign account for you automatically."}):u.intl.formatMessage({id:"llnumb",defaultMessage:"We’ll create a HelloSign account for you automatically."}),n.default.createElement("br",null),n.default.createElement("br",null),"ON"===I&&"ON"===T?u.intl.formatMessage({id:"eL77jo",defaultMessage:"If you already have a Dropbox Sign account, we’ll link it to your Dropbox account if the email address for both are the same."}):u.intl.formatMessage({id:"vjbiAf",defaultMessage:"If you already have a HelloSign account, we’ll link it to your Dropbox account if the email address for both are the same."})),n.default.createElement("div",{className:"hs-int-tos-accept-page-right-col-tos-content"},n.default.createElement(o.Text,{color:"text",size:"large"},u.intl.formatMessage({id:"HDZWlz",defaultMessage:"Click Agree to:"})),n.default.createElement("ul",{className:"hs-int-tos-accept-page-right-col-tos-content-list"},n.default.createElement("li",{className:"hs-int-tos-accept-page-right-col-tos-content-list-item"},n.default.createElement(o.Text,{color:"text",size:"large"},"ON"===I&&"ON"===T?u.intl.formatMessage({id:"d0qVW8",defaultMessage:"Give Dropbox Sign full access to your Dropbox account."}):u.intl.formatMessage({id:"faDcx4",defaultMessage:"Give HelloSign full access to your Dropbox account."}))),n.default.createElement("li",{className:"hs-int-tos-accept-page-right-col-tos-content-list-item"},n.default.createElement(o.Text,{color:"text",size:"large"},"ON"===I&&"ON"===T?u.intl.formatMessage({id:"TwhAg2",defaultMessage:"Give Dropbox full access to your Dropbox Sign account."}):u.intl.formatMessage({id:"MFUXPs",defaultMessage:"Give Dropbox full access to your HelloSign account."}))))),n.default.createElement("div",{className:"hs-int-tos-accept-page-right-col-checkbox"},n.default.createElement(r.Checkbox,{onChange:()=>A(e=>!e),checked:N,"aria-label":w,className:"hs-int-tos-accept-page-right-col-checkbox-square"}),n.default.createElement("div",{style:{width:10}}),n.default.createElement(o.Text,{color:"text",size:"medium"},L)),d?n.default.createElement("div",{className:"hs-int-tos-accept-page-right-col-email-promotion-checkbox"},n.default.createElement(r.Checkbox,{onChange:()=>O(e=>!e),checked:b,"aria-label":P,className:"hs-int-tos-accept-page-right-col-email-promotion-checkbox-square"}),n.default.createElement("div",{style:{width:10}}),n.default.createElement(o.Text,{color:"text",size:"medium"},P)):null);return n.default.createElement(f,{primaryButtonText:p.agree,onClickPrimaryButton:c,primaryButtonDisabled:!N,secondaryButtonText:p.cancel,onClickSecondaryButton:g,leftColumnContent:C,rightColumnContent:k,onClose:g,blueSide:"left"})})();if(2===C)return a?E.safari||E.mozilla?M():(i(),null):M();throw`wrong page number in TOS page: ${C}`},["/static/metaserver/static/css/integrations/hellosign_deep_integration-vfl5-fUD0.css","/static/typescript/component_libraries/deep-integrations/src/index.web-vflTFI7Au.css"])})),define("metaserver/static/js/integrations/hellosign_deep_integration/tos_with_recipients_info",["require","exports","tslib","react","metaserver/static/js/components/ui/css","dig-components/controls","dig-components/buttons","typescript/component_libraries/deep-integrations/src/instrumentation/function_wrapper","typescript/component_libraries/deep-integrations/src/instrumentation/constants","metaserver/static/js/core/i18n","react-intl","typescript/libraries/spectrum-content-icon-compatibility/src/index","metaserver/static/js/clean/analytics","dig-components/icons","dig-components/icons/src","dig-components/buttons","dig-components/table","dig-components/text_fields","dig-components/typography"],(function(e,t,s,n,i,r,a,o,c,l,_,d,u,h,g,E,p,m,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TermsOfServiceWithCSS=void 0,n=s.__importDefault(n);const S={nextButton:l.intl.formatMessage({id:"6752Ag",defaultMessage:"Next"}),addSignerButton:l.intl.formatMessage({id:"oXwe58",defaultMessage:"Add signer"}),selfSignButton:l.intl.formatMessage({id:"/dgTxh",defaultMessage:"I’m the only signer"}),subTitle:l.intl.formatMessage({id:"H+e+Nv",defaultMessage:"Who needs to sign"}),emailOptedInStatementPreRebranding:l.intl.formatMessage({id:"gMMLpm",defaultMessage:"Send me HelloSign updates."}),emailOptedInStatementPostRebranding:l.intl.formatMessage({id:"uzC4BU",defaultMessage:"Send me Dropbox Sign updates."}),emailErrorMessage:l.intl.formatMessage({id:"sUFO8F",defaultMessage:"A valid email is required"}),nameErrorMessage:l.intl.formatMessage({id:"QKJ1Bh",defaultMessage:"A valid name is required"}),nameHeader:l.intl.formatMessage({id:"uHIr29",defaultMessage:"Name"}),emailHeader:l.intl.formatMessage({id:"POr9LO",defaultMessage:"Email"})};var I;(function(e){e.EMAIL="email",e.NAME="name"})(I||(I={}));t.TermsOfServiceWithCSS=(0,i.requireCssWithComponent)(({onAcceptTos:e,onStart:t,logEvent:s,fileName:i,onClose:T,optInRequired:C,userHasSeenModal:v,onContinueWithoutTos:N,rebrandingVariant:A})=>{const[b,O]=n.default.useState(!1),R=n.default.useRef(1),[y,M]=n.default.useState([{email:"",name:""}]),[L,w]=n.default.useState(!1),[P,k]=n.default.useState(!1),U=n.default.useRef(new Set),D=n.default.useRef(new Set),[F,j]=n.default.useState(new Set),[x,H]=n.default.useState(new Set),B=(0,o.functionWrapperProvider)(s,c.InstrFeatureType.TosWithRecipientsInfo);n.default.useEffect(()=>{u.ProEventsLogger.log("bt_tos_modal_with_recipients_info_shown")},[]);const V=()=>{K(!1)&&(t(),v?N(y):e(!C||P,y))},G=n.default.createRef(),q=()=>k(e=>!e),W=e=>{const t=e.trim();if(t){const e=t.split("@");if(2!==e.length)return!1;{const[t,s]=e,n=/^[\x00-\x7f]*$/,i=/^[\w!#$%&'*+\-\/=?^`{|}~.]+$/,r=new RegExp("^([a-z0-9][a-z0-9\\-]*\\.)+([a-z]+|xn--[a-z0-9\\-]+)$","i");return!!i.test(t)&&!(!s||n.test(s)&&!r.test(s))}}return!1},K=e=>{if(L)return!0;let t=!0,s=!0;for(const n in y){const i=y[n].email,r=y[n].name;i&&(t=!1,W(i)?U.current.has(n)&&U.current.delete(n):(s=!1,e||(U.current=U.current.add(n))),r||(s=!1,e||(D.current=D.current.add(n)))),r&&(t=!1,r.trim()?D.current.has(n)&&D.current.delete(n):(s=!1,e||(D.current=D.current.add(n))),i||(e||(U.current=U.current.add(n)),s=!1)),r||i||(U.current.has(n)&&U.current.delete(n),D.current.has(n)&&D.current.delete(n))}t&&(D.current=D.current.add("0"),U.current=U.current.add("0"));const n=new Set(U.current);j(n);const i=new Set(D.current);return H(i),!t&&s},Q=(0,o.onClickWrapper)(B,c.InstrActionType.AcceptTOS,V),Y=(0,o.onClickWrapper)(B,c.InstrActionType.ContinueWithSignersModal,V),z=(0,o.onClickWrapper)(B,c.InstrActionType.CancelFlow,T),X=(0,o.onClickWrapper)(B,c.InstrActionType.ViewTerms,()=>{}),$=(0,o.onClickWrapper)(B,c.InstrActionType.ViewPrivacyPolicy,()=>{}),Z=(0,o.onClickWrapper)(B,c.InstrActionType.AddSigner,()=>{if(19===R.current)return;R.current+=1;const e=y.slice();e.push({email:"",name:""}),M(e)}),J=(0,o.onClickWrapper)(B,c.InstrActionType.ToggleSelfSign,()=>{R.current=1,w(e=>!e);M([{email:"",name:""}]),U.current=new Set,D.current=new Set,j(U.current),H(D.current)},{extra:{is_self_sign:L?"OFF":"ON"}}),ee=(0,_.defineMessage)({id:"zY5KbQ",defaultMessage:"I agree to the HelloSign <term>Terms</term> and <policy>Privacy Policy</policy>. We’ll create a HelloSign account with your Dropbox email address if you don’t have one, or link your existing one if you do. Your accounts will be linked across platforms."}),te=(0,_.defineMessage)({id:"Yzyn1+",defaultMessage:"I agree to the Dropbox Sign <term>Terms</term> and <policy>Privacy Policy</policy>. We’ll create a Dropbox Sign account with your Dropbox email address if you don’t have one, or link your existing one if you do. Your accounts will be linked across platforms."}),se=l.intl.formatMessage((0,_.defineMessage)({id:"7KWXXT",defaultMessage:"I understand this is the legal representation of the signature."})),ne="ON"===A?te:ee,ie=l.intl.formatMessage(ne,{term:e=>n.default.createElement("a",{href:"https://www.hellosign.com/terms",target:"_blank",rel:"noreferrer noopener",onClick:X},e),policy:e=>n.default.createElement("a",{href:"https://www.hellosign.com/privacy",target:"_blank",rel:"noreferrer noopener",onClick:$},e)}),re=()=>{O(e=>!e),u.ProEventsLogger.log("toggle_tos_checkbox")},ae=l.intl.formatMessage(ne,{term:e=>e,policy:e=>e}),oe=n.default.createElement(n.default.Fragment,null,n.default.createElement("div",{className:"hs-int-tos-redesign-file-icon-and-file-name"},n.default.createElement(n.default.Fragment,null,n.default.createElement(d.FileIcon,{path:i,"aria-label":i,role:"img",variant:"small",className:"hs-int-tos-redesign-file-icon"}),n.default.createElement(f.Text,{variant:"label",size:"standard",isBold:!0,className:"hs-int-tos-redesign-file-name"},i))),n.default.createElement(E.IconButton,{"aria-label":"close",className:"hs-int-tos-redesign-header-close-button",onClick:()=>{z(),O(!1),R.current=1;M([{email:"",name:""}]),w(!1),k(!1),U.current=new Set,D.current=new Set,j(U.current),H(D.current)},variant:"transparent",size:"small"},n.default.createElement(h.UIIcon,{src:g.CloseLine}))),ce=e=>n.default.createElement("div",{className:"hs-int-tos-redesign-error-message"},n.default.createElement(f.Text,{color:"error"},n.default.createElement(h.UIIcon,{src:g.WarningLine,size:"standard"})),n.default.createElement("div",{style:{width:5}}),n.default.createElement(f.Text,{color:"error"},e)),le=n.default.useCallback((e,t)=>!L&&(t===I.EMAIL?F.has(String(y.indexOf(e))):t===I.NAME&&x.has(String(y.indexOf(e)))),[F,x,y]),_e=n.default.createElement("div",{className:"hs-int-tos-redesign-main-content-container"},n.default.createElement("div",{className:"hs-int-tos-redesign-recipients-info-container"},n.default.createElement(n.default.Fragment,null,n.default.createElement("div",{className:"hs-int-tos-redesign-recipients-info-header-container"},n.default.createElement("div",{className:"hs-int-tos-redesign-recipients-info-header"},n.default.createElement(f.Title,{size:"large",className:"hs-int-tos-redesign-recipients-info-header"},l.intl.formatMessage({id:"PPYUPu",defaultMessage:"Who need to sign?"})),n.default.createElement(f.Text,{color:"faint"},l.intl.formatMessage({id:"CIydf/",defaultMessage:"Step 1 of 3"}))),n.default.createElement("div",{className:"hs-int-tos-redesign-recipients-info-head-button"},n.default.createElement(a.Button,{variant:"transparent",onClick:J,withIconLeft:L?n.default.createElement(h.UIIcon,{src:g.CheckmarkLine,role:"presentation","data-uxa-log":"bt_tos_with_recipients_info_toggle_self_sign"}):null},S.selfSignButton))),n.default.createElement(p.Table,{className:"hs-int-tos-redesign-recipients-table",hasDividers:!1,spacing:"standard",verticalAlign:"top",style:{margin:-15}},n.default.createElement(p.Table.Body,null,y.map(e=>n.default.createElement(p.Table.Row,{key:y.indexOf(e)},n.default.createElement(p.Table.Cell,{width:"50%"},n.default.createElement(f.Text,{isBold:!0,color:L?"disabled":"standard"},S.nameHeader),n.default.createElement("div",{style:{height:10}}),n.default.createElement(m.TextInput,{wrapperProps:le(e,I.NAME)?{className:"hs-int-tos-redesign-recipients-table-input--red"}:void 0,"aria-label":"recipient-name-input",onChange:t=>((e,t)=>{const s=y.slice();s[t].name=e,M(s),K(!0)})(t.target.value,y.indexOf(e)),value:e.name,placeholder:S.nameHeader,ref:G,disabled:L}),le(e,I.NAME)?ce(S.nameErrorMessage):null),n.default.createElement(p.Table.Cell,{width:"50%"},n.default.createElement(f.Text,{isBold:!0,color:L?"disabled":"standard"},S.emailHeader),n.default.createElement("div",{style:{height:10}}),n.default.createElement(m.TextInput,{wrapperProps:le(e,I.EMAIL)?{className:"hs-int-tos-redesign-recipients-table-input--red"}:void 0,"aria-label":"recipient-email-input",onChange:t=>((e,t)=>{const s=y.slice();s[t].email=e,M(s),K(!0)})(t.target.value,y.indexOf(e)),placeholder:S.emailHeader,value:e.email,ref:G,disabled:L}),le(e,I.EMAIL)?ce(S.emailErrorMessage):null),n.default.createElement(p.Table.Cell,{width:"fill-container",className:le(e,I.NAME)||le(e,I.EMAIL)?"hs-int-tos-redesign-recipients-table-delete-button--middle":"hs-int-tos-redesign-recipients-table-delete-button--bottom"},n.default.createElement(E.IconButton,{"aria-label":"delete",className:"hs-int-tos-redesign-recipients-info-delete-button",onClick:()=>(e=>{if(R.current>1){R.current-=1;const t=y.slice();t.splice(e,1),M(t),U.current.has(String(e))&&U.current.delete(String(e));const s=new Set(U.current);for(const t of s)if(Number(t)>e){const e=Number(t)-1;U.current.delete(t),U.current.add(String(e))}j(U.current),D.current.has(String(e))&&D.current.delete(String(e));const n=new Set(D.current);for(const t of n)if(Number(t)>e){D.current.delete(t);const e=Number(t)-1;D.current.add(String(e))}H(D.current)}})(y.indexOf(e)),variant:"transparent",disabled:0===y.indexOf(e)&&1===y.length},n.default.createElement(h.UIIcon,{src:g.DeleteLine,className:0===y.indexOf(e)&&1===y.length?"":"hs-int-tos-redesign-recipients-info-delete-button-icon"})))))))),n.default.createElement("div",{className:"hs-int-tos-redesign-recipients-info-button-section"},n.default.createElement(a.Button,{variant:"outline",size:"large",onClick:Z,disabled:L||19===R.current,"data-uxa-log":"bt_tos_with_recipients_info_add_signer"},S.addSignerButton))),n.default.createElement("div",{className:"hs-int-tos-redesign-checkbox"},(()=>{const e="ON"===A?S.emailOptedInStatementPostRebranding:S.emailOptedInStatementPreRebranding;return v?null:n.default.createElement(n.default.Fragment,null,n.default.createElement("div",{className:"hs-int-tos-redesign-terms-checkbox"},n.default.createElement(r.Checkbox,{onChange:re,checked:b,"aria-label":ae,className:"hs-int-tos-redesign-checkbox-square"}),n.default.createElement(f.Text,{size:"small"},ie," ",n.default.createElement("br",null)," ",se)),C&&!v?n.default.createElement("div",{className:"hs-int-tos-redesign-email-promotion-checkbox"},n.default.createElement(r.Checkbox,{onChange:q,checked:P,"aria-label":e,className:"hs-int-tos-redesign-checkbox-square"}),n.default.createElement(f.Text,{size:"small"},e)):null)})()));return n.default.createElement("div",{className:"hs-int-tos-redesign-container"},n.default.createElement("div",{className:"hs-int-tos-redesign-header-container"},oe),n.default.createElement("div",{className:"hs-int-tos-redesign-scrollable-content-container"},_e),n.default.createElement("div",{className:"hs-int-tos-redesign-main-content-footer-container"},n.default.createElement("div",{className:"hs-int-tos-redesign-action-button"},n.default.createElement(a.Button,{onClick:v?Y:Q,title:S.nextButton,variant:"primary",disabled:!b&&!v,className:"hs-int-tos-accept-button","data-uxa-log":"bt_tos_with_recipients_info_next_button"},S.nextButton))))},["/static/metaserver/static/css/integrations/hellosign_deep_integration-vfl5-fUD0.css","/static/typescript/component_libraries/deep-integrations/src/index.web-vflTFI7Au.css"])})),define("metaserver/static/js/integrations/hellosign_deep_integration/assets",["require","exports","tslib","react"],(function(e,t,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DropboxLogo=void 0,n=s.__importDefault(n);t.DropboxLogo=({color:e})=>{const t="sapphire"===e?"#0d2484":"white";return n.default.createElement("svg",{width:"48",height:"40",viewBox:"0 0 48 40",fill:"none",xmlns:"http://www.w3.org/2000/svg"},n.default.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M11.7061 14.9679L0 7.51017L11.7888 0L23.5682 7.5045L35.3483 0L47.1366 7.51017L35.4305 14.9677L47.1368 22.4256L35.3481 29.9359L23.5683 22.4313L11.7886 29.9359L0 22.4256L11.7061 14.9679ZM23.5682 7.51584L35.2656 14.9679L23.5683 22.4199L11.871 14.9677L23.5682 7.51584ZM23.6531 39.9351L11.8644 32.4247L23.6531 24.9153L35.4419 32.4247L23.6531 39.9351Z",fill:t}))},t.DropboxLogo.displayName="DropboxLogo"})),define("metaserver/static/js/integrations/hellosign_deep_integration/channel",["require","exports"],(function(e,t){"use strict";var s,n;Object.defineProperty(t,"__esModule",{value:!0}),t.Channel=t.SentMessageType=t.DeepIntegrationSteps=t.MessageType=void 0,(function(e){e.APP_CONFIGURE="hellosign:configure",e.APP_ERROR="hellosign:error",e.APP_INITIALIZE="hellosign:initialize",e.DEEP_INTEGRATION_FINISHED="hellosign:deepIntegrationFinished",e.USER_CANCEL_REQUEST="hellosign:userCancelRequest",e.USER_CREATE_TEMPLATE="hellosign:userCreateTemplate",e.USER_DECLINE_REQUEST="hellosign:userDeclineRequest",e.USER_FINISH_REQUEST="hellosign:userFinishRequest",e.USER_PREP_SEND_EDITOR_CONTINUE="hellosign:userPrepSendEditorContinue",e.USER_PREP_SEND_LOG="hellosign:userPrepSendLog",e.USER_REASSIGN_REQUEST="hellosign:userReassignRequest",e.USER_SEND_REQUEST="hellosign:userSendRequest",e.USER_SIGN_REQUEST="hellosign:userSignRequest",e.USER_PREP_SEND_EDITOR_DELETE_DOC="hellosign:userPrepSendEditorDeleteDoc",e.VERIFY_DOMAIN_REQUEST="hellosign:verifyDomainRequest",e.DEEP_INTEGRATION_WAITING_FOR_RECIPIENTS="hellosign:deepIntegrationWaitingForRecipients"})(s=t.MessageType||(t.MessageType={})),(function(e){e.RECIPIENTS_PAGE="recipients",e.EDITOR_PAGE="place-fields",e.SAVE_BACK_LOCATION_SELECTION="dropin",e.REVIEW="review",e.FINAL_LOADING="deep-integration-save-back-loading"})(t.DeepIntegrationSteps||(t.DeepIntegrationSteps={})),(function(e){e.DEEP_INTEGRATION_SEND_RECIPIENTS="dropbox:deepIntegrationSendRecipients"})(n=t.SentMessageType||(t.SentMessageType={}));const i=e=>"object"==typeof e&&"string"==typeof e.type&&(void 0===e.payload||"object"==typeof e.payload),r=e=>!!i(e)&&!(e.type!==s.VERIFY_DOMAIN_REQUEST||!e.payload||"string"!=typeof e.payload.token),a={[s.APP_CONFIGURE]:e=>!!i(e)&&e.type===s.APP_CONFIGURE,[s.APP_ERROR]:e=>!!i(e)&&e.type===s.APP_ERROR,[s.APP_INITIALIZE]:e=>!!i(e)&&e.type===s.APP_INITIALIZE,[s.DEEP_INTEGRATION_FINISHED]:e=>!!i(e)&&!(e.type!==s.DEEP_INTEGRATION_FINISHED||!e.payload||"string"!=typeof e.payload.filePath),[s.USER_CANCEL_REQUEST]:e=>!!i(e)&&e.type===s.USER_CANCEL_REQUEST,[s.USER_CREATE_TEMPLATE]:e=>!!i(e)&&e.type===s.USER_CREATE_TEMPLATE,[s.USER_DECLINE_REQUEST]:e=>!!i(e)&&e.type===s.USER_DECLINE_REQUEST,[s.USER_FINISH_REQUEST]:e=>!!i(e)&&e.type===s.USER_FINISH_REQUEST,[s.USER_PREP_SEND_EDITOR_CONTINUE]:e=>!!i(e)&&e.type===s.USER_PREP_SEND_EDITOR_CONTINUE,[s.USER_PREP_SEND_LOG]:e=>!!i(e)&&e.type===s.USER_PREP_SEND_LOG,[s.USER_REASSIGN_REQUEST]:e=>!!i(e)&&e.type===s.USER_REASSIGN_REQUEST,[s.USER_SEND_REQUEST]:e=>!!i(e)&&e.type===s.USER_SEND_REQUEST,[s.USER_SIGN_REQUEST]:e=>!!i(e)&&e.type===s.USER_SIGN_REQUEST,[s.USER_PREP_SEND_EDITOR_DELETE_DOC]:e=>!!i(e)&&e.type===s.USER_PREP_SEND_EDITOR_DELETE_DOC,[s.VERIFY_DOMAIN_REQUEST]:r,[s.DEEP_INTEGRATION_WAITING_FOR_RECIPIENTS]:e=>!!i(e)&&e.type===s.DEEP_INTEGRATION_WAITING_FOR_RECIPIENTS},o=()=>{},c={[s.APP_CONFIGURE]:o,[s.APP_ERROR]:o,[s.APP_INITIALIZE]:o,[s.DEEP_INTEGRATION_FINISHED]:o,[s.USER_CANCEL_REQUEST]:o,[s.USER_CREATE_TEMPLATE]:o,[s.USER_DECLINE_REQUEST]:o,[s.USER_FINISH_REQUEST]:o,[s.USER_PREP_SEND_EDITOR_CONTINUE]:o,[s.USER_PREP_SEND_LOG]:o,[s.USER_REASSIGN_REQUEST]:o,[s.USER_SEND_REQUEST]:o,[s.USER_SIGN_REQUEST]:o,[s.USER_PREP_SEND_EDITOR_DELETE_DOC]:o,[s.VERIFY_DOMAIN_REQUEST]:o,[s.DEEP_INTEGRATION_WAITING_FOR_RECIPIENTS]:o};class l{constructor(e,t,s={},o){this.startListening=()=>{window&&window.addEventListener("message",this.onMessageHandler)},this.stopListening=()=>{window&&window.removeEventListener("message",this.onMessageHandler)},this.onMessageHandler=e=>{if(!this.canHandleMessage(e))return;const t=e.data;if(!i(t))return void this.unknownMessageHandler("unknown",JSON.stringify(t));if(!(0,a[t.type])(t))return void this.unknownMessageHandler(t.type,JSON.stringify(t));const s=this.externalHandlers[t.type];if(!s)throw`couldn't find messageHandler for message type ${t.type}`;r(t)&&this.respondVerifyDomainRequest(t),s(t)},this.respondVerifyDomainRequest=e=>{this.allowedSource&&this.allowedSource.postMessage({type:"hellosign:verifyDomainResponse",payload:{token:e.payload.token}},this.allowedOrigin)},this.sendRecipients=e=>{this.allowedSource&&this.allowedSource.postMessage({type:n.DEEP_INTEGRATION_SEND_RECIPIENTS,payload:e},this.allowedOrigin)},this.canHandleMessage=e=>e.origin===this.allowedOrigin&&e.source===this.allowedSource,this.allowedOrigin=e,this.allowedSource=t,this.externalHandlers=Object.assign(Object.assign({},c),s),this.unknownMessageHandler=o}static new(e,t,s={},n){return new l(e,t,s,n)}}t.Channel=l})),define("metaserver/static/js/integrations/hellosign_deep_integration/localized_graphic",["require","exports","metaserver/static/js/modules/constants/page_load","metaserver/static/js/clean/static_urls"],(function(e,t,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.localizedAsset=void 0,t.localizedAsset=function(){switch(s.USER_LOCALE||"en_US"){case"da_DK":return(0,n.static_url)("/static/metaserver/static/images/integrations/hellosign/launcher/onboarding-da_DK-vflev2nla.gif");case"de":return(0,n.static_url)("/static/metaserver/static/images/integrations/hellosign/launcher/onboarding-de-vflmTVCdO.gif");case"en_GB":return(0,n.static_url)("/static/metaserver/static/images/integrations/hellosign/launcher/onboarding-en_GB-vflmA_g94.gif");case"es":return(0,n.static_url)("/static/metaserver/static/images/integrations/hellosign/launcher/onboarding-es-vfllHw0PM.gif");case"es_ES":return(0,n.static_url)("/static/metaserver/static/images/integrations/hellosign/launcher/onboarding-es_ES-vflRmKQl4.gif");case"fr":return(0,n.static_url)("/static/metaserver/static/images/integrations/hellosign/launcher/onboarding-fr-vflqcThGf.gif");case"id":return(0,n.static_url)("/static/metaserver/static/images/integrations/hellosign/launcher/onboarding-id-vflT5Hn2D.gif");case"it":return(0,n.static_url)("/static/metaserver/static/images/integrations/hellosign/launcher/onboarding-it-vflOYD-0N.gif");case"ja":return(0,n.static_url)("/static/metaserver/static/images/integrations/hellosign/launcher/onboarding-ja-vfliiIOOL.gif");case"ko":return(0,n.static_url)("/static/metaserver/static/images/integrations/hellosign/launcher/onboarding-ko-vflSPFPmr.gif");case"ms":return(0,n.static_url)("/static/metaserver/static/images/integrations/hellosign/launcher/onboarding-ms-vfli8wwVt.gif");case"nb_NO":return(0,n.static_url)("/static/metaserver/static/images/integrations/hellosign/launcher/onboarding-nb_NO-vflcDuOCP.gif");case"nl_NL":return(0,n.static_url)("/static/metaserver/static/images/integrations/hellosign/launcher/onboarding-nl_NL-vflPQqelQ.gif");case"pl":return(0,n.static_url)("/static/metaserver/static/images/integrations/hellosign/launcher/onboarding-pl-vflwp4_NJ.gif");case"pt_BR":return(0,n.static_url)("/static/metaserver/static/images/integrations/hellosign/launcher/onboarding-pt_BR-vflm25c60.gif");case"ru":return(0,n.static_url)("/static/metaserver/static/images/integrations/hellosign/launcher/onboarding-ru-vfl6KsI3f.gif");case"sv_SE":return(0,n.static_url)("/static/metaserver/static/images/integrations/hellosign/launcher/onboarding-sv_SE-vflPSZhlS.gif");case"th_TH":return(0,n.static_url)("/static/metaserver/static/images/integrations/hellosign/launcher/onboarding-th_TH-vflI-EUYa.gif");case"uk_UA":return(0,n.static_url)("/static/metaserver/static/images/integrations/hellosign/launcher/onboarding-uk_UA-vflCSYd-h.gif");case"zh_CN":return(0,n.static_url)("/static/metaserver/static/images/integrations/hellosign/launcher/onboarding-zh_CN-vfldFx8CJ.gif");case"zh_TW":return(0,n.static_url)("/static/metaserver/static/images/integrations/hellosign/launcher/onboarding-zh_TW-vflbjmtiv.gif");default:return(0,n.static_url)("/static/metaserver/static/images/integrations/hellosign/launcher/onboarding-vfl5F6roQ.gif")}}})),define("metaserver/static/js/integrations/hellosign_deep_integration/safari_unsupported_modal",["require","exports","tslib","react","metaserver/static/js/components/ui/css","dig-components/buttons","dig-components/modal","dig-components/typography","metaserver/static/js/core/browser","metaserver/static/js/core/i18n"],(function(e,t,s,n,i,r,a,o,c,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SafariUnsupportedModalWithCSS=void 0,n=s.__importStar(n),c=s.__importStar(c);t.SafariUnsupportedModalWithCSS=(0,i.requireCssWithComponent)(({title:e,body:t,buttonName:s,learnMoreLink:i,onClose:_})=>{const[d,u]=n.useState(!0),h=()=>{u(e=>!e),_()},g=l.intl.formatMessage({id:"zcHXrL",defaultMessage:"Learn more"});return n.createElement(a.Modal,{className:"hs-int-safari-unspported-modal",open:d,width:"small",isCentered:!0,withCloseButton:"Close",onRequestClose:h},n.createElement(a.Modal.Header,{hasBottomSpacing:"title-standard"},n.createElement(o.Title,null,e)),n.createElement(a.Modal.Body,{hasVerticalSpacing:!1},t),n.createElement(a.Modal.Footer,null,n.createElement(r.Button,{variant:"transparent",onClick:()=>{c.open_tab(i)}},g),n.createElement("div",{style:{display:"none"}},n.createElement(r.Button,{variant:"opacity"},"Button")),n.createElement(r.Button,{variant:"primary",onClick:h},s)))},["/static/metaserver/static/css/integrations/hellosign_deep_integration-vfl5-fUD0.css","/static/typescript/component_libraries/deep-integrations/src/index.web-vflTFI7Au.css"])})),define("metaserver/static/js/integrations/hellosign_deep_integration/send_file_viewer_plugin",["require","exports","tslib","react","metaserver/static/js/file_store/utils","dig-components/icons/src","dig-components/icons","metaserver/static/js/integrations/hellosign_deep_integration/launcher","metaserver/static/js/core/i18n","metaserver/static/js/core/browser_detection","metaserver/static/js/file_viewer/sdk_file_viewer/action_plugins/action_plugin_menu_item","metaserver/static/js/integrations/hellosign_deep_integration/send_file_viewer_plugin_types"],(function(e,t,s,n,i,r,a,o,c,l,_,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.makeSendForSignatureLoader=t.getOverflowItem=void 0,n=s.__importDefault(n);const u=e=>e&&(0,i.isBrowseFile)(e)&&o.HELLOSIGN_SUPPORTED_EXTENSIONS.includes("."+(0,i.getExtension)(e));t.getOverflowItem=(e,t,i,d="preview_workflows_button",h="file_preview_workflows_tab",g="send_signatures_on_workflow")=>{if(!t||!u(e)||(0,l.is_supported_mobile_browser)())return;const E=e=>{i(`send_for_signature_${e}`,d)},p=e=>{i("send_for_signature_failure",d,{reason:e})};return n.default.createElement(_.ActionPluginMenuItem,{key:"send-for-signature-action",withLeftAccessory:n.default.createElement(a.UIIcon,{src:r.SendLine}),withTitle:c.intl.formatMessage({id:"X1C5SI",defaultMessage:"Send for signature"}),"data-testid":"send-for-signature-action","data-uxa-log":g+"_click",onAction:()=>s.__awaiter(void 0,void 0,void 0,(function*(){if(E("click"),t)if(u(e))try{const s=(0,o.getLauncher)();s.init({entryPoint:h,file:e,user:t}),s.launch(),E("launched")}catch(e){p("launcher_error")}else p("invalid_file");else p("invalid_user")}))})};t.makeSendForSignatureLoader=(e,s,n)=>({actionDefinitions:()=>{const{file:i}=e();return{categories:{workflows:[{overflowItem:(0,t.getOverflowItem)(i,s,n.logUserAction),id:d.SEND_FOR_SIGNATURE_ACTION_PLUGIN_ID}]}}}})})),define("metaserver/static/js/integrations/hellosign_deep_integration/self_sign_plugin",["require","exports","tslib","react","metaserver/static/js/file_store/utils","dig-components/icons/src","dig-components/icons","metaserver/static/js/integrations/hellosign_deep_integration/launcher","metaserver/static/js/core/i18n","metaserver/static/js/core/browser_detection","metaserver/static/js/integrations/hellosign_deep_integration/launcher","metaserver/static/js/file_viewer/sdk_file_viewer/action_plugins/action_plugin_menu_item","metaserver/static/js/integrations/hellosign_deep_integration/send_file_viewer_plugin_types"],(function(e,t,s,n,i,r,a,o,c,l,_,d,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.makeSelfSignPlugin=t.getOverflowItem=void 0,n=s.__importDefault(n);const h=e=>e&&(0,i.isBrowseFile)(e)&&_.HELLOSIGN_SUPPORTED_EXTENSIONS.includes("."+(0,i.getExtension)(e));t.getOverflowItem=(e,t,i,_="file_preview_workflows_tab_self_sign",u="preview_workflows_button",g="self_sign_on_workflow")=>{if(!t||!h(e)||(0,l.is_supported_mobile_browser)())return;const E=c.intl.formatMessage({id:"5b2GuK",defaultMessage:"Self-sign"}),p=e=>{i(`self_sign_${e}`,u)},m=e=>{i("self_sign_failure",u,{reason:e})};return n.default.createElement(d.ActionPluginMenuItem,{key:"self-sign-action",withLeftAccessory:n.default.createElement(a.UIIcon,{src:r.SignatureLine}),"data-uxa-log":g+"_click","data-testid":"self-sign-action",withTitle:E,onAction:()=>s.__awaiter(void 0,void 0,void 0,(function*(){if(p("click"),t)if(h(e))try{const s=(0,o.getLauncher)();s.init({entryPoint:_,file:e,user:t,selfSign:!0}),s.launch(),p("launched")}catch(e){m("launcher_error")}else m("invalid_file");else m("invalid_user")}))})};t.makeSelfSignPlugin=(e,s,n)=>({actionDefinitions:()=>{const{file:i}=e();return{categories:{workflows:[{overflowItem:(0,t.getOverflowItem)(i,s,n.logUserAction),id:u.SELF_SIGN_ACTION_PLUGIN_ID}]}}}})})),define("metaserver/static/js/extensions/connect_flow",["require","exports","tslib","metaserver/static/js/integrations/link_service","metaserver/static/js/integrations/log_event","typescript/component_libraries/deep-integrations/src/platform/log_event","typescript/component_libraries/deep-integrations/src/instrumentation/common_context","typescript/component_libraries/deep-integrations/src/instrumentation/constants","typescript/component_libraries/deep-integrations/src/instrumentation/connect_service_flow_wrapper"],(function(e,t,s,n,i,r,a,o,c){"use strict";function l(e,t){return!!e&&t in e&&"is_connected"===e[t].connection_state[".tag"]}function _(e,t,_,d,u,h){return s.__awaiter(this,void 0,void 0,(function*(){if(l(t,d))return!0;const s=(0,r.withDefaults)((0,i.createIntegrationsActionsLogger)().logEvent,{extra:(0,a.getCommonContextExtra)({serviceList:Object.keys(t).map(e=>t[e])})}),g=t[d];g&&s((0,c.buildStartEvent)(g.service_type,g.connection_state,u,o.InstrConnectServiceFlowOutcome.Connected));try{yield(0,n.linkService)(e.id,d,h);const t=l(yield(function(e,t){return new Promise(s=>t({user:e,onRefresh:s}))})(e,_),d);return g&&s(t?(0,c.buildEndEvent)(g.service_type,u,o.InstrConnectServiceFlowOutcome.Connected,o.InstrConnectServiceFlowOutcome.Connected):(0,c.buildEndEvent)(g.service_type,u,o.InstrConnectServiceFlowOutcome.Connected,o.InstrConnectServiceFlowOutcome.Error)),t}catch(e){throw g&&s((0,c.buildEndEvent)(g.service_type,u,o.InstrConnectServiceFlowOutcome.Connected,o.InstrConnectServiceFlowOutcome.Error,{error:JSON.stringify(e)})),e}}))}Object.defineProperty(t,"__esModule",{value:!0}),t.shareInCanvasFlow=t.shareInTrelloFlow=t.shareInSlackFlow=t.presentInZoomFlow=void 0,t.presentInZoomFlow=function(e,t,s,n,i,r,a){_(e,t,s,"zoom",i,r).then(e=>{e&&(a&&a(),n())})},t.shareInSlackFlow=function(t,n,i,r,a,o,c){_(t,n,i,"slack_dropbox",a,o).then(n=>s.__awaiter(this,void 0,void 0,(function*(){if(n){c&&c();const{showSendToSlackModal:n}=yield new Promise((t,s)=>{e(["metaserver/static/js/integrations/send_to_slack"],t,s)}).then(s.__importStar);n(t,r)}})))},t.shareInTrelloFlow=function(t,n,i,r,a,o,c){_(t,n,i,"trello",a,o).then(n=>s.__awaiter(this,void 0,void 0,(function*(){if(n){c&&c();const{showShareToTrelloModal:n}=yield new Promise((t,s)=>{e(["metaserver/static/js/integrations/share_to_trello"],t,s)}).then(s.__importStar);n(t,r)}})))},t.shareInCanvasFlow=function(t,n,i,r,a,o,c){_(t,n,i,"canvas",a,o).then(n=>s.__awaiter(this,void 0,void 0,(function*(){if(n){c&&c();const{showUploadToCanvasModal:n}=yield new Promise((t,s)=>{e(["metaserver/static/js/integrations/canvas/upload_to_canvas"],t,s)}).then(s.__importStar);n(t,r)}})))}})),define("metaserver/static/js/file_viewer/open_button/open_with_helpers",["require","exports","tslib","metaserver/static/js/clean/open_with","metaserver/static/js/file_viewer/sdk_file_viewer/experiments"],(function(e,t,s,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OpenWithHelpers=void 0,n=s.__importDefault(n),t.OpenWithHelpers={canOpenWith:function(e,t){return i.fileViewerConfiguration.wopiButtonVisible&&e.bytes<=n.default.MAX_SUPPORTED_FILE_SIZE_B&&null!==n.default.getWopiOpenWithButtonInfo(e)}}})),define("metaserver/static/js/unity/check_file_cache",["require","exports","metaserver/static/js/unity/features"],(function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class n{static is_cached_and_locally_available(e,t){const n=this._cache[s.UnityFeatures.server_path(e,t)];return null!=n&&n.is_locally_available}static get(e,t){return this._cache[s.UnityFeatures.server_path(e,t)]}static set(e,t){this._cache[e]=t}static set_batch(e){Object.assign(this._cache,e)}static clear(){this._cache={}}}n._cache={};let i=n;s.UnityFeatures.isUnitySupported()||(i=void 0),t.default=i})),define("metaserver/static/js/unity/connection",["require","exports","tslib","lodash","metaserver/static/js/deprecated_ajax/ajax_jquery","metaserver/static/js/unity/connection_error","metaserver/static/js/unity/logger","metaserver/static/js/unity/versions","metaserver/static/js/unity/websocket_config","metaserver/static/js/unity/web_socket","metaserver/static/js/clean/viewer","metaserver/static/js/modules/constants/unity","metaserver/static/js/core/assert","metaserver/static/js/core/uri"],(function(e,t,s,n,i,r,a,o,c,l,_,d,u,h){"use strict";var g,E,p;Object.defineProperty(t,"__esModule",{value:!0}),t.isUnitySupported=t.UnityConnection=t.MAX_PORT=t.MIN_PORT=t.Permissions=t.ConnectionState=t.LastCompletedSecurityHandshakeStep=void 0,i=s.__importStar(i),a=s.__importDefault(a),o=s.__importDefault(o),d=s.__importStar(d),(function(e){e.CONNECTION_OPENED="CONNECTION_OPENED",e.VERSION_CHECK="VERSION_CHECK",e.FETCHING_NONCE="FETCHING_NONCE",e.NONCE_RETURNED_TO_CLIENT="NONCE_RETURNED_TO_CLIENT",e.HANDSHAKE_COMPLETED="HANDSHAKE_COMPLETED"})(g=t.LastCompletedSecurityHandshakeStep||(t.LastCompletedSecurityHandshakeStep={})),(function(e){e.PENDING="PENDING",e.ESTABLISHED="ESTABLISHED",e.CLOSED="CLOSED",e.RETRYING="RETRYING"})(E=t.ConnectionState||(t.ConnectionState={})),(function(e){e.SECURE_PERMISSION="secure",e.INSECURE_WEB_PERMISSION="insecure_web",e.INSECURE_CLIENT_PERMISSION="insecure_client",e.INSECURE_PERMISSION="insecure"})(p=t.Permissions||(t.Permissions={}));t.MIN_PORT=17600,t.MAX_PORT=17602;class m{constructor(){this.client_version=null,this.logger=new a.default,this._on_open_callbacks=[],this._on_open_failed_callbacks=[],this._on_close_callbacks=[],this._pending_callbacks=[],this._response_callbacks={},this._webSocket=null,this._port=null,this._active_ports={},this._connection_state=E.PENDING,this._current_message_id=1,this._permission_level=null,this._on_close=e=>t=>{[1e3,1001,1005,1006].includes(t.code)||this.logger.report_event("unity_failure",{message:`WebSocket closed. Code: ${t.code}. Reason: ${t.reason}`,port:e}),this._close_port(e)},this._on_error=e=>t=>{this.logger.report_event("unity_failure",{message:"WebSocket unknown error",port:e}),this._close_port(e)},this._set_connection_state=e=>{if(e===this._connection_state)return;const t=this._connection_state;if((0,u.assert)(t!==E.CLOSED,"Shouldn't unclose a closed connection."),this._connection_state=e,e===E.ESTABLISHED){(0,u.assert)(this._is_connection_in_progress(t),"Can only establish from pending or retrying."),this.logger.report_event("handshake_complete"),t===E.PENDING&&this._on_open_callbacks.forEach(e=>e());const e=[];for(;this._pending_callbacks.length;){const{callback:t,error_callback:s}=this._pending_callbacks.pop();this.is_ready()?e.push(t()):e.push("function"==typeof s?s(r.UnityConnectionError.UNEXPECTED_ERROR):void 0)}return e}if(e!==E.RETRYING){if(e===E.CLOSED){t===E.PENDING?(this.logger.report_event("connection_not_established"),this._on_open_failed_callbacks.forEach(e=>e())):t===E.RETRYING?(this.logger.report_event("connection_terminated"),this._on_close_callbacks.forEach(e=>e())):(0,u.assert)(!1,"CONNECTION_CLOSED can only be set from PENDING or RETRYING");const e=[];for(;this._pending_callbacks.length;){const{error_callback:t}=this._pending_callbacks.pop();e.push("function"==typeof t?t(r.UnityConnectionError.CONNECTION_CLOSED):void 0)}return e}return(0,u.assert)(!1,"Changing connection_state to CONNECTION_PENDING not supported.")}},this._on_message=e=>t=>{const s=JSON.parse(t.data);if(s.func&&s.header&&s.header.message_id&&void 0!==s.header.should_respond)if(s.header.log_data&&this.logger.update(s.header.log_data),this.logger.update({port:e.port}),"response"===s.func)this._on_response(s.header.message_id,s.data);else{const t=this._routes[s.func];if(null==t)return void this._terminate_handshake(e.ws,"Unknown function.",{function:s.func});const n=this.is_ready()?t(s.data):t(e,s.data);s.header&&s.header.should_respond&&this.send("response",n,null,null,s.header.message_id)}else this._terminate_handshake(e.ws,"Malformed message from client.",{message:t.data})},this._on_response_timeout=e=>()=>{const{error_callback:t}=this._response_callbacks[e];delete this._response_callbacks[e],t&&t(r.UnityConnectionError.CONNECTION_TIMEOUT)},this._check_unity_version=(e,t)=>{if(e.state!==g.CONNECTION_OPENED)return void this._terminate_handshake(e.ws,"Handshake version check at wrong time of protocol.");if(e.state=g.VERSION_CHECK,e.client_version=t.client_version,t.client_version<o.default.UNITY_HANDSHAKE)return void this._terminate_handshake(e.ws,"Client version is too old.");const s=this._web_has_auth();if(!(t.client_version<o.default.PERMISSION_LEVELS)||s)return this.logger.report_event("handshake_version_check"),t.client_version>=o.default.PERMISSION_LEVELS?this._send_with_ws(e.ws,"initiate_handshake",{secure_web:s}):this._send_with_ws(e.ws,"initiate_handshake");this._terminate_handshake(e.ws,"Client version is too old to support insecure web connections.")},this._fetch_unity_nonce=(e,t)=>{e.state===g.VERSION_CHECK?(e.state=g.FETCHING_NONCE,this.logger.report_event("handshake_fetch_nonce"),this._retrieve_unity_nonce(e,t.nonce_key)):this._terminate_handshake(e.ws,"Fetch Unity nonce at wrong time of protocol.")},this._complete_handshake=(e,t)=>{if(e.state===g.NONCE_RETURNED_TO_CLIENT&&t.is_success)if(e.state=g.HANDSHAKE_COMPLETED,this._connection_state===E.CLOSED)this._terminate_handshake(e.ws,"No more handshakes are allowed to complete.");else if(null!=this._webSocket){const t="Only one Unity handshake can succeed! There's likely a MITM attack, so close all connections.";this._terminate_handshake(e.ws,t),this._terminate_handshake(this._webSocket,t),this.client_version=null,this._webSocket=null,this._port=null,this._set_connection_state(E.CLOSED)}else this.client_version=e.client_version,this._webSocket=e.ws,this._port=e.port,this._set_connection_state(E.ESTABLISHED);else this._terminate_handshake(e.ws,"Unable to complete handshake.")},this._routes={check_unity_version:this._check_unity_version,fetch_unity_nonce:this._fetch_unity_nonce,complete_handshake:this._complete_handshake}}start(){c.WebSocketConfig.canUnityConnect()?this._attempt_handshake():(this._set_connection_state(E.CLOSED),this.logger.report_event("unity_failure",{message:"WebSocket creation failed. Not able to create web socket."}))}_getWebSocketURI(e){const t={scheme:"ws",authority:`127.0.0.1:${e.toString()}`,path:"/ws"};return new h.URI(t).toString()}_attempt_handshake(){for(let e=t.MIN_PORT;e<=t.MAX_PORT;e++)try{this._active_ports[e]=!0;const t=l.UnityWebSocket.create(this._getWebSocketURI(e));t.onmessage=this._on_message({ws:t,port:e,state:g.CONNECTION_OPENED,client_version:null,client_has_auth:null}),t.onclose=this._on_close(e),t.onerror=this._on_error(e)}catch(t){this.logger.report_event("unity_failure",{message:`WebSocket creation failed. Message: ${t.message}`,error_name:t.name,port:e}),this._set_connection_state(E.CLOSED)}this.logger.report_event("handshake_started")}_close_port(e){if(e in this._active_ports&&(delete this._active_ports[e],(0,n.isEmpty)(this._active_ports)))return this._connection_state===E.ESTABLISHED?this._retry_connection():this._set_connection_state(E.CLOSED)}_retry_connection(){return this.logger.report_event("connection_retrying"),this._set_connection_state(E.RETRYING),this.client_version=this._webSocket=this._port=null,this._attempt_handshake()}send(e,t=null,s=null,n=null,i=null){if(this._webSocket)return this._send_with_ws(this._webSocket,e,t,s,n,i)}_send_with_ws(e,t,s=null,n=null,i=null,a=null){if(null==a&&(a=this._current_message_id,(0,u.assert)(this._current_message_id%2==1,"Web-initiated message_ids should remain odd"),this._current_message_id+=2),null!==n){const e=window.setTimeout(this._on_response_timeout(a),5e3);this._response_callbacks[a]={response_callback:n,error_callback:i,timeout_id:e}}const o={func:t,header:{message_id:a,should_respond:null!==n,log_data:this.logger.get_log_data_for_client()}};null!=s&&(o.data=s);try{return e.send(JSON.stringify(o))}catch(e){this.logger.report_event("unity_failure",{message:`WebSocket send failed. Message: ${e.message}`,error_name:e.name}),i&&i(r.UnityConnectionError.COULD_NOT_SEND)}}_on_response(e,t){if(e in this._response_callbacks){const{response_callback:s,timeout_id:n}=this._response_callbacks[e];delete this._response_callbacks[e],window.clearTimeout(n),s&&s(t)}}_web_has_auth(){return _.Viewer.get_viewer().is_signed_in}_retrieve_unity_nonce(e,t){return i.WebRequest({url:new h.URI({path:"/retrieve_unity_nonce"}),dataType:"json",data:{nonce_key:t},success:t=>{switch(t.status){case"OK":if(e.state=g.NONCE_RETURNED_TO_CLIENT,(null===e.client_version||e.client_version>=o.default.PORT_CHECK)&&((0,u.assert)(t.message.client_port,`Port check must happen in version ${e.client_version}`),t.message.client_port!==e.port))return void this._terminate_handshake(e.ws,"Mismatched ports.",{client_port:t.message.client_port,web_port:e.port});e.client_has_auth=t.message.client_has_auth;const s=this._web_has_auth();return e.client_has_auth&&s?this._permission_level=m.SECURE_PERMISSION:((0,u.assert)(null===e.client_version||e.client_version>=o.default.PERMISSION_LEVELS,`Insecure connections only supported by client_version >= ${o.default.PERMISSION_LEVELS}.`),this._permission_level=e.client_has_auth?m.INSECURE_WEB_PERMISSION:s?m.INSECURE_CLIENT_PERMISSION:m.INSECURE_PERMISSION),this.logger.update({unity_permission_level:this._permission_level}),this.logger.report_event("handshake_nonce_sent_to_unity_server"),this._send_with_ws(e.ws,"verify_unity_nonce",{nonce:t.message.nonce});case"MISMATCHED_USER_IDS":return this._terminate_handshake(e.ws,"Mismatched user_ids.",{client_user_ids:t.message.client_user_ids,web_user_ids:t.message.web_user_ids});case"INVALID":return this._terminate_handshake(e.ws,"Could not find nonce with given nonce_key.");case"AUTH_REQUIRED":return this._terminate_handshake(e.ws,"Did not have the necessary authentication to retrieve nonce.");case"LOCAL_INFORMATION_PERMISSION_REQUIRED":return this._terminate_handshake(e.ws,"Did not have permission to start a local-information-allowed connection.")}},error:(t,s,n)=>{this._terminate_handshake(e.ws,"Unable to retrieve nonce from server",{status:s,error_string:n})}})}_terminate_handshake(e,t,s={}){const n=Object.assign({message:t},s);d.UNITY_WEB_DEBUG&&console.error(n),this.logger.report_event("unity_failure",n),e&&e.close()}_is_connection_in_progress(e){return e===E.PENDING||e===E.RETRYING}add_on_open_callback(e){this._on_open_callbacks.push(e)}add_on_open_failed_callback(e){this._on_open_failed_callbacks.push(e)}add_on_close_callback(e){this._on_close_callbacks.push(e)}call_when_ready(e,t=null){return this.is_ready()?e():this._is_connection_in_progress(this._connection_state)?this._pending_callbacks.push({callback:e,error_callback:t}):t?t(r.UnityConnectionError.CONNECTION_CLOSED):void 0}is_ready(){return this._webSocket&&this._webSocket.readyState===WebSocket.OPEN&&this._connection_state===E.ESTABLISHED}feature_supported(e,t=[]){return(0,u.assert)(null!==this._permission_level,"Connection is not ready."),!(null!==this.client_version&&this.client_version<e)&&t.includes(this._permission_level)}isUnityServerRunning(e){return new Promise(s=>{setTimeout(()=>s(!1),e);for(let e=t.MIN_PORT;e<=t.MAX_PORT;e++){const t=new WebSocket(this._getWebSocketURI(e));t.onopen=function(){t.close(),s(!0)}}})}}t.UnityConnection=m,m.SECURE_PERMISSION=p.SECURE_PERMISSION,m.INSECURE_WEB_PERMISSION=p.INSECURE_WEB_PERMISSION,m.INSECURE_CLIENT_PERMISSION=p.INSECURE_CLIENT_PERMISSION,m.INSECURE_PERMISSION=p.INSECURE_PERMISSION;t.isUnitySupported=()=>l.UnityWebSocket.web_sockets_supported()})),define("metaserver/static/js/unity/connection_error",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UnityConnectionError=void 0,(function(e){e.CONNECTION_TIMEOUT="connection_timeout",e.CONNECTION_CLOSED="connection_closed",e.COULD_NOT_SEND="could_not_send",e.UNEXPECTED_ERROR="unexpected_error"})(t.UnityConnectionError||(t.UnityConnectionError={}))})),define("metaserver/static/js/unity/features",["require","exports","tslib","metaserver/static/js/deprecated_ajax/ajax_jquery","js/filepath/filepath","metaserver/static/js/unity/connection","metaserver/static/js/unity/versions","metaserver/static/js/core/assert","metaserver/static/js/core/i18n","metaserver/static/js/core/notify","metaserver/static/js/core/uri"],(function(e,t,s,n,i,r,a,o,c,l,_){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UnityFeatures=void 0,n=s.__importStar(n),i=s.__importStar(i),a=s.__importDefault(a),t.UnityFeatures={_uc:new r.UnityConnection,_has_handshake_started:!1,_cached_file_browser_display_name:null,_start_handshake_if_needed(){this._has_handshake_started||(this._uc.start(),this._has_handshake_started=!0)},continue_as_user(e,t,s,n=null){return this._start_handshake_if_needed(),this._uc.call_when_ready(()=>{if(this._uc.feature_supported(a.default.WEB_DESTINY,[r.UnityConnection.INSECURE_WEB_PERMISSION]))return this._uc.logger.report_event("continue_as_user",{browser:e,refresh_token:t}),this._uc.send("continue_as_user",{browser:e,refresh_token:t},s,n)},n)},continue_as_user_direct(e,t=null){return this._start_handshake_if_needed(),this._uc.call_when_ready(()=>{if(this._uc.feature_supported(a.default.WEB_DESTINY_V2,[r.UnityConnection.INSECURE_WEB_PERMISSION]))return this._uc.logger.report_event("continue_as_user_direct"),this._uc.send("continue_as_user_direct",null,e,t)},t)},web_destiny_info(e,t=null){return this._start_handshake_if_needed(),this._uc.call_when_ready(()=>{if(this._uc.feature_supported(a.default.WEB_DESTINY_V2,[r.UnityConnection.INSECURE_WEB_PERMISSION]))return this._uc.logger.report_event("web_destiny_info"),this._uc.send("web_destiny_info",null,e,t)},t)},client_supports_open_in_file_browser(){return this._uc.feature_supported(a.default.OPEN_IN_FILE_BROWSER,[r.UnityConnection.SECURE_PERMISSION])},ensure_unity_ready(){return this._start_handshake_if_needed(),new Promise(e=>this._uc.call_when_ready(()=>{e(!0)},()=>{this._uc=new r.UnityConnection,this._has_handshake_started=!1,e(!1)}))},open_file(e,t,s,c,l=null,d=!1){this._start_handshake_if_needed();const u=this.server_path(e,t);return this._uc.call_when_ready(()=>{if(this._uc.feature_supported(a.default.UNITY_HANDSHAKE,[r.UnityConnection.SECURE_PERMISSION])){this._uc.logger.report_event("open_file",{user_id:s,path_id:u,file_extension:i.file_extension(u),in_file_browser:d}),n.SilentBackgroundRequest({url:new _.URI({path:"/unity_open_log"}),data:{user_id:s,server_path:u,file_extension:i.file_extension(u),in_file_browser:d,unity_session_id:this._uc.logger.unity_session_id(),buildno:this._uc.logger._data.buildno,host_id:this._uc.logger._data.host_id}});const e={server_path:u,user_id:s};this._uc.client_version>=a.default.OPEN_IN_FILE_BROWSER?e.in_file_browser=d:(0,o.assert)(!d,"The connected client doesn't support opening in file browser."),this._uc.send("open_file",e,c,l)}},l)},standard_open_file_handler(e){if(!e)return l.Notify.error(c.intl.formatMessage({id:"9HWjA9",defaultMessage:"Error opening file"}))},check_file(e,t,s,n,o=null){this._start_handshake_if_needed();const c=this.server_path(e,t),l=e=>{this._check_file_deprecated_on_client()&&(e={is_locally_available:e}),n(e)};this._uc.call_when_ready(()=>{if(this._uc.feature_supported(a.default.UNITY_HANDSHAKE,[r.UnityConnection.SECURE_PERMISSION]))return this._uc.logger.report_event("check_file",{user_id:s,path_id:c,file_extension:i.file_extension(c)}),this._uc.send("check_file",{server_path:c,user_id:s},l,o)},o)},add_on_ready_callback(e){return this._uc.call_when_ready(e)},check_file_batch(e,t,s,n=null){return new Promise((o,c)=>{this._start_handshake_if_needed();const l=e.map(e=>this.server_path(e.ns_id,e.ns_path)),_=e=>{if(this._check_file_deprecated_on_client())for(const t in e){const s=e[t];e[t]={is_locally_available:s}}s&&s(e),o(e)},d=function(e){n&&n(e),c(e)};this._uc.call_when_ready(()=>{if(this._uc.feature_supported(a.default.UNITY_HANDSHAKE,[r.UnityConnection.SECURE_PERMISSION]))return this._uc.logger.report_event("check_file_batch",{user_id:t,path_ids:l,file_extensions:l.map(i.file_extension)}),this._uc.send("check_file_batch",{server_paths:l,user_id:t},_,d)},d)})},file_browser_display_name(e,t=null){if(null!=this._cached_file_browser_display_name)return void e(this._cached_file_browser_display_name);const s=t=>(this._cached_file_browser_display_name=t,e(t));this._start_handshake_if_needed();return this._uc.call_when_ready(()=>this._uc.feature_supported(a.default.CHECK_FILE_RETURNS_OBJ,[r.UnityConnection.SECURE_PERMISSION])?(this._uc.logger.report_event("file_browser_display_name"),this._uc.send("file_browser_display_name",null,s,t)):e(null),t)},_check_file_deprecated_on_client(){return a.default.UNITY_HANDSHAKE<=this._uc.client_version&&this._uc.client_version<a.default.CHECK_FILE_RETURNS_OBJ},server_path:(e,t)=>`${e}:${t}`,has_chime(e,t=null){this._start_handshake_if_needed();return this._uc.call_when_ready(()=>{if(this._uc.feature_supported(a.default.CHIME_OPEN,[r.UnityConnection.SECURE_PERMISSION]))return this._uc.logger.report_event("has_chime"),this._uc.send("has_chime",null,e,t)},t)},open_chime(e,t,s=null){this._start_handshake_if_needed();return this._uc.call_when_ready(()=>{if(this._uc.feature_supported(a.default.CHIME_OPEN,[r.UnityConnection.SECURE_PERMISSION]))return this._uc.logger.report_event("open_chime",{parameters:e}),this._uc.send("open_chime",e,t,s)},s)},growth_deep_link(e,t={}){return new Promise((s,n)=>{this._start_handshake_if_needed(),this._uc.call_when_ready(()=>{if(this._uc.feature_supported(a.default.GROWTH_DEEP_LINK,[r.UnityConnection.SECURE_PERMISSION]))return this._uc.logger.report_event("growth_deep_link"),this._uc.send("growth_deep_link",{resource:e,data:t},s,n);n("featured_unsupported")},n)})},can_open_apollo(){return new Promise((e,t)=>(this._start_handshake_if_needed(),this._uc.call_when_ready(()=>{this._uc.feature_supported(a.default.OPEN_COLLAB_BROWSE,[r.UnityConnection.SECURE_PERMISSION,r.UnityConnection.INSECURE_WEB_PERMISSION])&&this._uc.send("can_open_apollo",{},e,t)},t)))},open_apollo_main_window(){return new Promise((e,t)=>(this._start_handshake_if_needed(),this._uc.call_when_ready(()=>{this._uc.feature_supported(a.default.OPEN_COLLAB_BROWSE,[r.UnityConnection.SECURE_PERMISSION,r.UnityConnection.INSECURE_WEB_PERMISSION])&&this._uc.send("open_apollo_main_window",{},e,t)},t)))},isUnityServerRunning(){return this._uc.isUnityServerRunning(200)},isUnitySupported:()=>(0,r.isUnitySupported)()};const d=(0,r.isUnitySupported)()?t.UnityFeatures:void 0;t.default=d})),define("metaserver/static/js/unity/logger",["require","exports","tslib","metaserver/static/js/deprecated_ajax/ajax_jquery","metaserver/static/js/unity/versions","metaserver/static/js/modules/constants/unity","metaserver/static/js/core/uri"],(function(e,t,s,n,i,r,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=s.__importStar(n),i=s.__importDefault(i),r=s.__importStar(r);t.default=class{constructor(){this._data={logging_source:"web",web_unity_version:i.default.LATEST}}update(e){return this._data=Object.assign(Object.assign({},this._data),e),this._data}report_event(e,t=null){if(this._data.event_name=e,this._data.local_ts=(new Date).getTime()/1e3,this._data.extra=JSON.stringify(t||{}),n.SilentBackgroundRequest({url:new a.URI({path:"/unity_connection_log"}),data:this._data}),r.UNITY_WEB_DEBUG)return console.log(this._data)}get_log_data_for_client(){return{web_unity_version:this._data.web_unity_version,user_agent:window.navigator.userAgent}}unity_session_id(){return this._data.unity_session_id}}})),define("metaserver/static/js/unity/versions",["require","exports"],(function(e,t){"use strict";var s;Object.defineProperty(t,"__esModule",{value:!0}),(function(e){e[e.LATEST=16]="LATEST",e[e.INITIAL_UNITY=1]="INITIAL_UNITY",e[e.UNITY_HANDSHAKE=2]="UNITY_HANDSHAKE",e[e.REUNITY=3]="REUNITY",e[e.OPEN_IN_FILE_BROWSER=4]="OPEN_IN_FILE_BROWSER",e[e.CHECK_FILE_RETURNS_OBJ=5]="CHECK_FILE_RETURNS_OBJ",e[e.PERMISSION_LEVELS=6]="PERMISSION_LEVELS",e[e.WEB_DESTINY=7]="WEB_DESTINY",e[e.WEB_DESTINY_V2=8]="WEB_DESTINY_V2",e[e.PORT_CHECK=9]="PORT_CHECK",e[e.CHIME_OPEN=10]="CHIME_OPEN",e[e.GROWTH_DEEP_LINK=15]="GROWTH_DEEP_LINK",e[e.OPEN_COLLAB_BROWSE=16]="OPEN_COLLAB_BROWSE"})(s||(s={})),t.default=s})),define("metaserver/static/js/unity/web_socket",["require","exports","tslib","metaserver/static/js/unity/logger","metaserver/static/js/unity/websocket_config"],(function(e,t,s,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UnityWebSocket=void 0,n=s.__importDefault(n),t.UnityWebSocket={create(e){const t=new n.default;return i.WebSocketConfig.canUnityConnect()&&t.report_event("using_default_web_socket"),new WebSocket(e)},web_sockets_supported:()=>i.WebSocketConfig.canUnityConnect()}})),define("metaserver/static/js/unity/websocket_config",["require","exports","tslib","metaserver/static/js/core/browser_detection"],(function(e,t,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebSocketConfig=void 0,n=s.__importStar(n),t.WebSocketConfig={canUnityConnect:()=>t.WebSocketConfig.canBrowserSupportNonSecureWebsocket(),canBrowserSupportNonSecureWebsocket(){const e=parseInt(n.version,10);return!!(n.safari&&e<9)||(!!(n.mozilla&&e>=55)||(!!(n.chrome&&e>=53)||!!n.edgeChromium()))}},t.default=t.WebSocketConfig})),define("metaserver/static/js/flows/conversions/convert_and_share_submenu",["require","exports","tslib","react","metaserver/static/js/flows/conversions/conversion_actions","dig-components/menu","dig-components/icons/src","dig-components/icons","metaserver/static/js/file_viewer/open_button/types","metaserver/static/js/core/i18n","metaserver/static/js/file_viewer/constants"],(function(e,t,s,n,i,r,a,o,c,l,_){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ConvertAndShareSubmenu=void 0,n=s.__importDefault(n);t.ConvertAndShareSubmenu=({file:e,user:t})=>{const s=(0,i.getConversionActionsForFiles)([e]);if(!s.length)return null;const d=s.map(s=>({handler:()=>{s.convert([e],t,{shouldShareResult:!0,source:"share-button"})},spriteName:null,text:s.actionText,type:c.OpenButtonAction.CONVERT_AND_SHARE,userAction:_.UserAction.ConvertAndShare,iconElement:n.default.createElement(o.UIIcon,{src:s.actionIcon})}));return n.default.createElement(r.Menu.Submenu,{withLeftAccessory:n.default.createElement(o.UIIcon,{src:a.ConvertFileLine}),withTriggerContent:l.intl.formatMessage({id:"jso4WM",defaultMessage:"Share as..."})},n.default.createElement(r.Menu.Segment,null,d.map(e=>n.default.createElement(r.Menu.ActionItem,{key:e.text,value:e,withLeftAccessory:e.iconElement},e.text))))}})),define("metaserver/static/js/file_viewer/file_conversion/file_conversion_options",["require","exports","tslib","dig-components/menu","metaserver/static/js/components/ui/css","metaserver/static/js/file_viewer/open_button/types","react","metaserver/static/js/extensions/utils"],(function(e,t,s,n,i,r,a,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FileConversionOptions=void 0,a=s.__importDefault(a);class c extends a.default.Component{isFileConversionAction(e){return[r.OpenButtonAction.DECOMPRESS_FILE].includes(e.type)}render(){const{openOptions:e,wrapValuesForActionBar:t}=this.props,s=e.filter(this.isFileConversionAction);if(!s.length)return null;const i=s.map(e=>{const s=t?(0,o.toActionBarValue)(e):e;return a.default.createElement(n.Menu.ActionItem,{key:e.text,value:s,withLeftAccessory:e.iconElement},a.default.createElement("span",null,e.text))});return a.default.createElement(n.Menu.Segment,{key:"file-conversions"},i)}}c.displayName="FileConversionOptionsComponent",t.FileConversionOptions=(0,i.requireCssWithComponent)(c,["/static/metaserver/static/css/app_actions/index-vfljPaJWn.css"])})),define("metaserver/static/js/flows/conversions/conversion_plugin",["require","exports","tslib","react","dig-components/buttons","dig-components/icons","dig-components/icons/src","dig-components/menu","metaserver/static/js/core/i18n","metaserver/static/js/file_store/utils","metaserver/static/js/file_viewer/file_conversion/utils","metaserver/static/js/file_viewer/sdk_file_viewer/action_plugins/action_plugin_menu_item","metaserver/static/js/file_viewer/sdk_file_viewer/utils","metaserver/static/js/flows/conversions/conversion_actions","metaserver/static/js/flows/conversions/utils","metaserver/static/js/integrations/hellosign_deep_integration/add_signatures_util","typescript/libraries/file-viewer/src/core/types/auth_modal","metaserver/static/js/admin/registration_source_constants"],(function(e,t,s,n,i,r,a,o,c,l,_,d,u,h,g,E,p,m){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.makeFileConversionsLoader=void 0,n=s.__importDefault(n);const f=({file:e,user:t,action:s,encryptionOptions:n,logUserAction:i,context:r,shareToken:a})=>{if(i("convert_file",r,{conversion_type:s.actionText}),t)s.convert([e],t,{shareToken:a,source:"preview"});else{const e=new URL(window.location.href);e.searchParams.set("save_as","true"),e.searchParams.set("save_as_action",s.actionText),window.history.replaceState(e.href,"",e.href),(0,u.showAuthModal)({mode:p.AuthMode.REGISTER,sharedLinkUrl:e.href,kind:p.LoginOrRegisterKind.POSTSAVEAS,encryptionOptions:n,loggingExtra:{source:"save_as"},signupTag:m.RegistrationSource.SHMODEL_SAVE_AS_REGISTER})}},S=e=>{var{conversionActions:t}=e,l=s.__rest(e,["conversionActions"]);const _=e=>{null==e||e.handler()};return e=>n.default.createElement(o.Menu.Wrapper,{matchContainingWidth:!0,onSelection:_},({getTriggerProps:s,getContentProps:_})=>n.default.createElement(n.default.Fragment,null,n.default.createElement(i.Button,Object.assign({variant:"opacity",withIconLeft:e?null:n.default.createElement(r.UIIcon,{src:a.ConvertFileLine}),withDropdownIcon:!0},s()),c.intl.formatMessage({id:"GAZsDK",defaultMessage:"Save as..."})),n.default.createElement(o.Menu.Content,Object.assign({},_()),n.default.createElement(o.Menu.Segment,null,t.map(e=>n.default.createElement(d.ActionPluginMenuItem,{key:e.actionText,onAction:()=>f(Object.assign(Object.assign({},l),{action:e}))},n.default.createElement("div",{style:{display:"flex"}},n.default.createElement(r.UIIcon,{src:e.actionIcon}),e.actionText)))))))},I=e=>{var{conversionActions:t}=e,i=s.__rest(e,["conversionActions"]);return n.default.createElement(o.Menu.Submenu,{withLeftAccessory:n.default.createElement(r.UIIcon,{src:a.ConvertFileLine}),withTriggerContent:c.intl.formatMessage({id:"N4qajY",defaultMessage:"Save as..."})},n.default.createElement(o.Menu.Segment,null,t.map(e=>n.default.createElement(d.ActionPluginMenuItem,{key:e.actionText,onAction:()=>f(Object.assign(Object.assign({},i),{action:e})),withLeftAccessory:n.default.createElement(r.UIIcon,{src:e.actionIcon})},e.actionText))))};t.makeFileConversionsLoader=(e,t,s,n,i,r)=>class{constructor(){this.actionDefinitions=()=>this.conversionsDefinition(e())}conversionsDefinition(e){const{file:a,sharedLinkInfo:o,sharePermission:c,shareToken:d}=e;if(!(0,g.canConvertFile)(a,c)||!(0,u.canDownloadFile)(o,c))return{};const p={expFlowsManualVideoGifUi:(0,_.isManualVideoGifEnabled)(t)},m=(0,h.getConversionActionsForFiles)([a],p);if(!m.length)return{};const f={file:a,user:t,shareToken:d,conversionActions:m,encryptionOptions:n};return{atTopLevelIfSpace:t&&(0,E.isAddSignatureDropdownEnabled)(i,(0,l.getExtension)(a),r)?[]:[{renderButton:S(Object.assign(Object.assign({},f),{context:"top_level_action_bar",logUserAction:s.logUserAction})),id:"CONVERSION_ACTION"}],alwaysInOverflow:[[{overflowItem:I(Object.assign(Object.assign({},f),{context:"overflow_menu",logUserAction:s.logUserAction})),id:"CONVERSION_ACTION"}]]}}}})),define("metaserver/static/js/sharing/action_types",["require","exports","metaserver/static/js/flux/action_type"],(function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SharingActionTypes=t.ShareModalActionTypes=void 0,t.ShareModalActionTypes=(0,s.withActionNamespace)("share-modal-actions",{SHARE_MODAL_OPEN:"share-modal-open",SHARE_MODAL_CLOSE:"share-modal-close",RESET_MODAL_STATE:"reset-modal-state",OPEN_LINK_SETTINGS_MODAL:"open-link-settings-modal",OPEN_FOLDER_SETTINGS_MODAL:"open-folder-settings-modal",OPEN_SHARED_LINK_MODAL:"open-shared-link-modal",CLOSE_LINK_SETTINGS_MODAL:"close-link-settings-modal",CLOSE_FOLDER_SETTINGS_MODAL:"close-folder-settings-modal",CLOSE_SHARED_LINK_MODAL:"close-shared-link-modal",CLEAR_METADATA:"clear-metadata",FETCH_METADATA_REQUEST:"metadata-request",FETCH_METADATA_SUCCESS:"metadata-success",FETCH_METADATA_FAILURE:"metadata-failure",CLEAR_LINK_METADATA:"clear-link-metadata",FETCH_LINK_METADATA_REQUEST:"link-metadata-request",FETCH_LINK_METADATA_SUCCESS:"link-metadata-success",FETCH_LINK_METADATA_FAILURE:"link-metadata-failure",CLEAR_SHARING_PREFS:"clear-sharing-prefs",FETCH_SHARING_PREFS_REQUEST:"sharing-prefs-request",FETCH_SHARING_PREFS_SUCCESS:"sharing-prefs-success",FETCH_SHARING_PREFS_FAILURE:"sharing-prefs-failure",ERROR_MESSAGE:"error-message",ERROR_MESSAGE_CLEAR:"error-message-clear",CLEAR_FILE_MEMBERSHIP:"clear-file-membership",FETCH_FILE_MEMBERSHIP_REQUEST:"fetch-file-membership-request",FETCH_FILE_MEMBERSHIP_SUCCESS:"fetch-file-membership-success",FETCH_FILE_MEMBERSHIP_FAILURE:"fetch-file-membership-failure",CLEAR_FOLDER_MEMBERSHIP:"clear-folder-membership",FETCH_FOLDER_MEMBERSHIP_REQUEST:"fetch-folder-membership-request",FETCH_FOLDER_MEMBERSHIP_SUCCESS:"fetch-folder-membership-success",FETCH_FOLDER_MEMBERSHIP_FAILURE:"fetch-folder-membership-failure",FETCH_USER_ACCOUNTS_REQUEST:"fetch-user-accounts-request",FETCH_USER_ACCOUNTS_SUCCESS:"fetch-user-accounts-success",FETCH_USER_ACCOUNTS_FAILURE:"fetch-user-accounts-failure",FETCH_USER_ACCOUNTS_CONTINUED_REQUEST:"fetch-user-accounts-continued-request",FETCH_USER_ACCOUNTS_CONTINUED_SUCCESS:"fetch-user-accounts-continued-success",CLEAR_FILE_MEMBERSHIP_LAST_SEEN_INFO:"clear-file-membership-last-seen-info",FETCH_FILE_MEMBER_COUNT_REQUEST:"fetch-file-member-count-request",FETCH_FILE_MEMBER_COUNT_SUCCESS:"fetch-file-member-count-success",CHANGE_RECIPIENTS:"change-recipients",CHANGE_RECIPIENT_MESSAGE:"change-recipient-message",APPEND_TO_RECIPIENT_MESSAGE:"append-to-recipient-message",CHANGE_RECIPIENT_ACCESS:"change-recipient-access",UPDATE_RECIPIENT_VALIDATION:"update-recipient-validation",CREATE_LINK_REQUEST:"create-link-request",CREATE_LINK_SUCCESS:"create-link-success",CREATE_LINK_FAILURE:"create-link-failure",DISPLAY_CONTENT_NAME_INFO:"display-content-name-info",SEND_SHARE_REQUEST:"send-share-request",SEND_SHARE_SUCCESS:"send-share-success",SEND_SHARE_FAILURE:"send-share-failure",SHARE_FOLDER_REQUEST:"share-folder-request",SHARE_FOLDER_SUCCESS:"share-folder-success",SHARE_FOLDER_FAILURE:"share-folder-failure",SEND_FOLDER_SHARE_REQUEST:"send-folder-share-request",SEND_FOLDER_SHARE_SUCCESS:"send-folder-share-success",SEND_FOLDER_SHARE_FAILURE:"send-folder-share-failure",CHANGE_MEMBER_ACCESS_REQUEST:"change-member-access-request",CHANGE_MEMBER_ACCESS_SUCCESS:"change-member-access-success",CHANGE_MEMBER_ACCESS_FAILURE:"change-member-access-failure",MEMBER_ACTION_PENDING:"member-action-pending",MEMBER_ACTION_COMPLETE:"member-action-complete",REMOVE_MEMBER_SUCCESS:"remove-member-success",REMOVE_MEMBER_KEEP_ACCESS:"remove-member-keep-access",TRANSFER_OWNER_SUCCESS:"transfer-owner-success",FETCH_CURRENT_ACCOUNT_REQUEST:"fetch-current-account-request",FETCH_CURRENT_ACCOUNT_SUCCESS:"fetch-current-account-success",FETCH_MEMBER_COUNTS_REQUEST:"fetch-member-counts-request",FETCH_MEMBER_COUNTS_SUCCESS:"fetch-member-counts-success",HANDLE_CONTENT_NAME_CHANGE:"handle-content-name-change",VALIDATE_CONTENT_NAME_SUCCESS:"validate-content-name-success",VALIDATE_CONTENT_NAME_ERROR:"validate-content-name-error",CHANGE_LINK_AUDIENCE_REQUEST:"change-link-audience-request",CHANGE_LINK_AUDIENCE_SUCCESS:"change-link-audience-success",CHANGE_LINK_AUDIENCE_FAILURE:"change-link-audience-failure",UNBLOCK_MEMBER_LIST_ON_PASS_LOAD:"unblock-member-list-on-pass-load",UPDATE_SHARING_SETTINGS_SUCCESS:"update-sharing-settings-success",DELETE_LINK_METADATA_SUCCESS:"delete-link-metadata-success",CHANGE_CREATE_COMMENT_CHECKBOX:"change-create-comment-checkbox",SET_UPSELL_COUNTER_PREF:"set-upsell-counter-pref",SET_UPSELL_COUNTER_PREF_SUCCESS:"set-upsell-counter-pref-success",CHANGE_LINK_AUDIENCE_SELECTION:"change-link-audience-selection",REMOVE_LINK_AUDIENCE_SELECTION:"remove-link-audience-selection",TOGGLE_SEND_APPROVAL:"toggle-send-approval",CHANGE_NEEDS_ALL_APPROVERS:"change-needs-all-approvers",CREATE_APPROVAL_REQUEST:"create-approval-request",CREATE_APPROVAL_SUCCESS:"create-approval-success",CREATE_APPROVAL_FAILURE:"create-approval-failure",TOGGLE_OPEN_AUTOMATIONS:"toggle-open-automations",UPDATE_SHARING_TASKS:"update-sharing-tasks",DOCSEND_ANALYTICS_LINK_REQUEST:"docsend-analytics-link-request",DOCSEND_ANALYTICS_LINK_SUCCESS:"docsend-analytics-link-success",DOCSEND_ANALYTICS_LINK_FAILURE:"docsend-analytics-link-failure"}),t.SharingActionTypes=(0,s.withActionNamespace)("sharing-actions",{CLEAR_EVERYTHING:"clear-everything",FETCH_METADATA_BATCH_ATTEMPT:"fetch-metadata-batch-attempt",FETCH_METADATA_BATCH_SUCCESS:"fetch-metadata-batch-success",FETCH_METADATA_BATCH_FAIL:"fetch-metadata-batch-fail"})})),define("metaserver/static/js/sharing/actions/sharing_actions",["require","exports","metaserver/static/js/flux/dispatcher","metaserver/static/js/sharing/action_types","metaserver/static/js/sharing/api/client","typescript/component_libraries/spectrum-sharing/src/utils/sharing_constants","metaserver/static/js/sharing/share_page/action_types","metaserver/static/js/sharing/stores/sharing_info","metaserver/static/js/core/assert","metaserver/static/js/pass/action_timestamps","metaserver/static/js/pass/constants"],(function(e,t,s,n,i,r,a,o,c,l,_){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SharingActions=void 0,t.SharingActions={loadFileMetadataBatch:(e,t)=>new i.FileShareApiClient({userId:e.id}).getMetadataBatchAlpha({contentIds:t,actions:Object.keys(r.ALPHA_FILE_METADATA_PERMISSIONS)}).then(t=>s.Dispatcher.dispatch({type:n.SharingActionTypes.FETCH_METADATA_BATCH_SUCCESS,user:e,data:t})),loadFileMetadata:({user:e,contentId:t,sourceUrl:c,client:l})=>{const _=o.sharingInfoStore.getSharingInfo(e.id,t);if(_&&_.fetchingMetadataPromise())return _.fetchingMetadataPromise();const d=(l=l||new i.FileShareApiClient({userId:e.id})).getMetadataAlpha({contentId:t,actions:Object.keys(r.ALPHA_FILE_METADATA_PERMISSIONS),sourceURL:c}).then(t=>{s.Dispatcher.dispatch({type:n.SharingActionTypes.FETCH_METADATA_BATCH_SUCCESS,user:e,data:[t]}),s.Dispatcher.dispatch({type:a.SharePageActionTypes.FETCH_METADATA_SUCCESS,metadata:t,user:e})});return s.Dispatcher.dispatch({type:n.ShareModalActionTypes.FETCH_METADATA_REQUEST,contentIds:[t],data:{promise:d},user:e}),d},listMembers:({user:e,contentId:t,isFolder:r,limit:a,url:d,members:u,client:h,includeSeenState:g=!0,passSessionId:E,isNonUserRelativeContext:p=!1})=>{(0,c.assert)(!a||a<=100,"listMembers not implemented for limit > 100");const m=a||9999999,f=o.sharingInfoStore.getSharingInfo(e.id,t);if(f){const e=f.fetchingMembersRequest();if(e&&m<=e.limitNonNull)return e.promise;if(f.hasDisplayableMembers()&&m<f.members().getMemberCount())return Promise.resolve({})}const S=Math.random().toString(),I=!r;h||(h=r?new i.FolderShareApiClient({userId:e.id,isNonUserRelativeContext:p}):new i.FileShareApiClient({userId:e.id,isNonUserRelativeContext:p}));const T=i=>i?(s.Dispatcher.dispatch({type:n.ShareModalActionTypes.FETCH_USER_ACCOUNTS_CONTINUED_REQUEST,contentIds:[t],user:e}),h.listMembersContinue({cursor:i,url:d,isAlpha:I}).then(i=>{s.Dispatcher.dispatch({type:n.ShareModalActionTypes.FETCH_USER_ACCOUNTS_CONTINUED_SUCCESS,contentIds:[t],data:{members:i,requestId:S},user:e}),T(i.cursor)})):Promise.resolve({});let C;return E&&l.ActionTimestampsTracker.record(_.LoggingActions.LIST_MEMBERS_BEGIN,E),C=u?Promise.resolve(u):h.listMembers({contentId:t,url:d,limit:a,isAlpha:I,includeSeenState:g}),C=C.then(i=>{E&&l.ActionTimestampsTracker.record(_.LoggingActions.LIST_MEMBERS_RECEIVE,E),s.Dispatcher.dispatch({type:n.ShareModalActionTypes.FETCH_USER_ACCOUNTS_SUCCESS,contentIds:[t],data:{members:i,requestId:S},user:e}),a||T(i.cursor)}),s.Dispatcher.dispatch({type:n.ShareModalActionTypes.FETCH_USER_ACCOUNTS_REQUEST,contentIds:[t],data:{limitNonNull:m,requestId:S,promise:C},user:e}),C},fetchFileMemberCount:({user:e,contentId:t,limit:r,url:a,client:o,countGroupsAsMembers:c=!1,passSessionId:d,runViewerInfoChecks:u=!1})=>{o=o||new i.FileShareApiClient({userId:e.id}),d&&l.ActionTimestampsTracker.record(_.LoggingActions.MEMBER_COUNTS_BEGIN,d);const h=o.getMemberCounts({contentId:t,limit:r,url:a,countGroupsAsMembers:c,runViewerInfoChecks:u});return s.Dispatcher.dispatch({type:n.ShareModalActionTypes.FETCH_FILE_MEMBER_COUNT_REQUEST,contentIds:[t],user:e}),h.then(i=>{d&&l.ActionTimestampsTracker.record(_.LoggingActions.MEMBER_COUNTS_RECEIVE,d),s.Dispatcher.dispatch({type:n.ShareModalActionTypes.FETCH_FILE_MEMBER_COUNT_SUCCESS,contentIds:[t],data:i,user:e})})},fetchFolderMemberCount:({user:e,contentId:t,client:i})=>(s.Dispatcher.dispatch({type:n.ShareModalActionTypes.FETCH_MEMBER_COUNTS_REQUEST,data:{},contentIds:[t],user:e}),i.getMemberCounts({contentId:t}).then(i=>{s.Dispatcher.dispatch({type:n.ShareModalActionTypes.FETCH_MEMBER_COUNTS_SUCCESS,data:{memberCounts:i},contentIds:[t],user:e})}))}})),define("metaserver/static/js/sharing/content_info",["require","exports","tslib","immutable"],(function(e,t,s,n){"use strict";function i(e){const t=(e.isFolder?e.targetNsId:e.fileId)||e.fqPath;if(null===t)throw new Error("Not enough fields provided for extras");return t}Object.defineProperty(t,"__esModule",{value:!0}),t.ContentInfoExtras=t.ContentInfo=void 0,n=s.__importStar(n);class r extends(n.Record({extras:null,id:null},"ContentInfo")){static createFromParams(e){const t=new a(e);return new r({extras:t,id:i(t)})}setNsId(e){const t=this.setIn(["extras","targetNsId"],e);return t.set("id",i(t.extras))}setFQPath(e){const t=this.setIn(["extras","fqPath"],e);return t.set("id",i(t.extras))}isFolder(){return this.extras.isFolder}isFile(){return!this.isFolder()}isFileFolder(){return this.isFolder()&&!this.isSharedFolder()}isSharedFolder(){return Boolean(this.extras.targetNsId)}isTeamSharedFolder(){return this.extras.isTeamSharedFolder}isFolderInsideTeamFolderTree(){return this.extras.isFolderInsideTeamFolderTree}isInSharedFolder(){return Boolean(this.extras.nsId&&this.extras.nsId!==this.extras.userHomeNs)}isNestedSharedFolder(){return this.isInSharedFolder()&&this.isSharedFolder()}isMounted(){return!this.extras.url}url(){return this.extras.url}pathExists(){return Boolean(this.extras.exists)}name(){return this.displayPath()?this.displayPath().split("/").pop():this.filename()}idForLink(){const e=this.extras.fileId||this.extras.fqPath;if(!e)throw new Error("No identifiers for getting links");return e}sharedFolderId(){const e=this.extras.targetNsId;if(!e)throw new Error("No shared folder ID");return e}displayPath(){return this.extras.fqPath}fileId(){return this.extras.fileId}filename(){return this.extras.filename}nsId(){if(!this.extras.nsId)throw new Error("Can't determine nsId");return this.extras.nsId}nsPath(){if(null===this.extras.nsPath)throw new Error("Can't determine nsPath");return this.extras.nsPath}sjid(){return this.extras.sjid}teamGroupInfo(){return this.extras&&this.extras.teamGroupInfo}}t.ContentInfo=r;class a extends(n.Record({exists:!0,fileId:null,filename:null,fqPath:null,isFolder:null,isTeamSharedFolder:!1,isFolderInsideTeamFolderTree:!1,modalSessionId:null,nsId:null,nsPath:null,origin:null,sjid:null,targetNsId:null,url:null,userHomeNs:null,teamGroupInfo:null},"ContentInfoExtras")){}t.ContentInfoExtras=a})),define("metaserver/static/js/sharing/share_modal/store/modal_info/reducer",["require","exports","tslib","immutable","metaserver/static/js/sharing/content_info","metaserver/static/js/cloud_docs/constants","metaserver/static/js/sharing/action_types","metaserver/static/js/sharing/views/constants","metaserver/static/js/sharing/access_level"],(function(e,t,s,n,i,r,a,o,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.modalInfoReducer=t.initialModalInfoState=void 0,n=s.__importStar(n),t.initialModalInfoState={canRelinquishMembership:!1,contentInfo:i.ContentInfo.createFromParams({fqPath:"",isFolder:!1}),contentNameInputValue:"",contentNameMessageLevel:o.CONTENT_NAME_MESSAGE_LEVELS.INFO,initialProps:{},initialRecipientTokens:[],isContentNameFocused:!1,pendingMemberAction:n.Set(),recipientMessage:"",recipientRawInput:"",recipientTokens:[],recipientValidation:{},referrer:"",shareAsConfidential:!1,uiMode:o.MODES.MEMBERSHIP,fetchMetadataStatus:o.FETCH_METADATA_STATUS.FETCHING,sendApproval:!1,needsAllApprovers:!0,creatingApprovalRequest:!1,automationOptionChecked:!1,sharingTasks:["save_copy"],docsendAnalyticsLink:{status:"initial"}};function l(e,t){return t.shared_folder_id?e.setNsId(t.shared_folder_id):e}t.modalInfoReducer=(e,s)=>{const n=s.payload;switch(s.type){case a.ShareModalActionTypes.CHANGE_CREATE_COMMENT_CHECKBOX:return Object.assign(Object.assign({},e),{isShareMessageAsCommentExplicitlyChecked:n.checked});case a.ShareModalActionTypes.CHANGE_RECIPIENTS:{const t=n.recipientTokens,s=n.recipientRawInput;let i=e.uiMode;return t.length>0||s.length>0?i===o.MODES.MEMBERSHIP&&(i=o.MODES.SHARE):i===o.MODES.SHARE&&(i=o.MODES.MEMBERSHIP),Object.assign(Object.assign({},e),{recipientTokens:t,recipientRawInput:s,uiMode:i})}case a.ShareModalActionTypes.CHANGE_RECIPIENT_ACCESS:return Object.assign(Object.assign({},e),{recipientAccess:n.newAccess});case a.ShareModalActionTypes.CHANGE_RECIPIENT_MESSAGE:return Object.assign(Object.assign({},e),{recipientMessage:n.message});case a.ShareModalActionTypes.APPEND_TO_RECIPIENT_MESSAGE:const s=e.recipientMessage,i=n.messageToAppend;return Object.assign(Object.assign({},e),{recipientMessage:0===s.length?i:s+"\n"+i});case a.ShareModalActionTypes.UPDATE_RECIPIENT_VALIDATION:const _=n.recipientValidation,d=n.resetCurrentValidations?{}:e.recipientValidation,u={};return c.ACCESS_VALUES.forEach(e=>{const t=d[e]||{},s=_[e]||{};u[e]=Object.assign(Object.assign({},t),s)}),Object.assign(Object.assign({},e),{recipientValidation:u});case a.ShareModalActionTypes.FETCH_METADATA_FAILURE:return Object.assign(Object.assign({},e),{uiMode:o.MODES.LINK_ONLY,linkOnlyReason:e.linkOnlyReason!==o.LINK_ONLY_REASON.LINKS_PAGE?n.reason:e.linkOnlyReason,fetchMetadataStatus:o.FETCH_METADATA_STATUS.FAIL,countsExceedNsLimit:n.countExceedNsLimit});case a.ShareModalActionTypes.FETCH_METADATA_SUCCESS:{const t=n.metadata,s=t.path_lower&&(0,r.isPointerByExtension)(t.path_lower)?o.MODES.POINTER:e.uiMode;return Object.assign(Object.assign({},e),{uiMode:s,contentInfo:l(e.contentInfo,t),fetchMetadataStatus:o.FETCH_METADATA_STATUS.SUCCESS})}case a.ShareModalActionTypes.HANDLE_CONTENT_NAME_CHANGE:return Object.assign(Object.assign({},e),{contentNameInputValue:n.name,contentNameMessageLevel:o.CONTENT_NAME_MESSAGE_LEVELS.INFO,contentNameMessage:""===n.name?o.CONTENT_NAME_EMPTY_TOOLTIP:void 0});case a.ShareModalActionTypes.HANDLE_CONTENT_NAME_FOCUS_CHANGE:return Object.assign(Object.assign({},e),{isContentNameFocused:n.focus});case a.ShareModalActionTypes.MEMBER_ACTION_COMPLETE:return Object.assign(Object.assign({},e),{pendingMemberAction:e.pendingMemberAction.delete(n.member.memberKey())});case a.ShareModalActionTypes.MEMBER_ACTION_PENDING:return Object.assign(Object.assign({},e),{pendingMemberAction:e.pendingMemberAction.add(n.member.memberKey())});case a.ShareModalActionTypes.REMOVE_MEMBER_KEEP_ACCESS:case a.ShareModalActionTypes.REMOVE_MEMBER_SUCCESS:return Object.assign(Object.assign({},e),{pendingMemberAction:e.pendingMemberAction.delete(n.member.memberKey())});case a.ShareModalActionTypes.SEND_SHARE_FAILURE:return Object.assign(Object.assign({},e),{uiMode:o.MODES.SHARE});case a.ShareModalActionTypes.SEND_SHARE_REQUEST:return Object.assign(Object.assign({},e),{uiMode:o.MODES.SHARE_SENDING});case a.ShareModalActionTypes.SEND_SHARE_SUCCESS:return Object.assign(Object.assign({},e),{uiMode:o.MODES.SHARE});case a.ShareModalActionTypes.SHARE_FOLDER_SUCCESS:return Object.assign(Object.assign({},e),{contentInfo:l(e.contentInfo,n.metadata)});case a.ShareModalActionTypes.SHARE_MODAL_OPEN:{const s=n.shareModalInfoAttrs.contentInfo,i=n.shareModalInfoAttrs.inLinksPage,a=s.isFolder()&&!s.pathExists(),c=a&&!n.initialProps.initialContentName;let l,_=t.initialModalInfoState.uiMode;return(0,r.isPointerByExtension)(s.displayPath()||"")?_=o.MODES.POINTER:a?_=o.MODES.SHARE:i&&(_=o.MODES.LINK_ONLY,l=o.LINK_ONLY_REASON.LINKS_PAGE),Object.assign(Object.assign({},e),{contentInfo:s,linkOnlyReason:l,uiMode:_,contentNameInputValue:n.initialProps.initialContentName,contentNameMessage:c?o.CONTENT_NAME_EMPTY_TOOLTIP:"",initialProps:n.initialProps,initialRecipientTokens:n.shareModalInfoAttrs.initialRecipientTokens||[],isContentNameFocused:c,onCreateGroupCallback:n.initialProps.onCreateGroupCallback,recipientAccess:n.initialProps.defaultRecipientAccessLevel||void 0,recipientMessage:n.initialProps.recipientMessage||"",recipientTokens:[],recipientValidation:{},referrer:n.initialProps.referrer,experiments:n.initialProps.experiments,sendApproval:!1,needsAllApprovers:!0,creatingApprovalRequest:!1,automationOptionChecked:n.initialProps.automationOptionChecked||!1})}case a.ShareModalActionTypes.SHARE_MODAL_CLOSE:return Object.assign(Object.assign({},e),{initialRecipientTokens:n.tokens||e.initialRecipientTokens||[]});case a.ShareModalActionTypes.VALIDATE_CONTENT_NAME_ERROR:return Object.assign(Object.assign({},e),{contentNameMessage:n.errorMsg,contentNameMessageLevel:o.CONTENT_NAME_MESSAGE_LEVELS.ERROR});case a.ShareModalActionTypes.VALIDATE_CONTENT_NAME_SUCCESS:return Object.assign(Object.assign({},e),{contentInfo:e.contentInfo.setFQPath(n.newFolderPath)});case a.ShareModalActionTypes.TOGGLE_SEND_APPROVAL:return Object.assign(Object.assign({},e),{sendApproval:!e.sendApproval});case a.ShareModalActionTypes.CHANGE_NEEDS_ALL_APPROVERS:return Object.assign(Object.assign({},e),{needsAllApprovers:n.needsAllApprovers});case a.ShareModalActionTypes.CREATE_APPROVAL_REQUEST:return Object.assign(Object.assign({},e),{creatingApprovalRequest:!0});case a.ShareModalActionTypes.CREATE_APPROVAL_SUCCESS:case a.ShareModalActionTypes.CREATE_APPROVAL_FAILURE:return Object.assign(Object.assign({},e),{creatingApprovalRequest:!1});case a.ShareModalActionTypes.TOGGLE_OPEN_AUTOMATIONS:return Object.assign(Object.assign({},e),{automationOptionChecked:!e.automationOptionChecked});case a.ShareModalActionTypes.UPDATE_SHARING_TASKS:return Object.assign(Object.assign({},e),{sharingTasks:n.sharingTasks});case a.ShareModalActionTypes.DOCSEND_ANALYTICS_LINK_REQUEST:return Object.assign(Object.assign({},e),{docsendAnalyticsLink:{status:"loading"}});case a.ShareModalActionTypes.DOCSEND_ANALYTICS_LINK_SUCCESS:return Object.assign(Object.assign({},e),{docsendAnalyticsLink:{status:"ready",linkData:n.linkData}});case a.ShareModalActionTypes.DOCSEND_ANALYTICS_LINK_FAILURE:return Object.assign(Object.assign({},e),{docsendAnalyticsLink:{status:"error"}});default:return e}}})),define("metaserver/static/js/sharing/share_modal/store/sharing_info/reducer",["require","exports","metaserver/static/js/sharing/action_types","metaserver/static/js/sharing/api/types/metadata"],(function(e,t,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sharingInfoReducer=t.initialSharingInfoState=void 0,t.initialSharingInfoState={areMembersFullyLoaded:!1,areSharingPrefsLoaded:!1,hasDisplayableMembers:!1,isLinkMetadataLoaded:!1,isCurrentAccountLoaded:!1,shouldBlockMemberListOnPassLoad:!0,memberCounts:new n.MemberCounts,members:new n.SharingMembership,sharingPrefs:new n.SharingPrefs,sharedLinks:[],selectedAudienceByAccessLevel:{}};function i(e,t){const s=e.metadata,n=t.permissions||s&&s.permissions;return t.set("permissions",n)}t.sharingInfoReducer=(e=t.initialSharingInfoState,r)=>{const a=r.payload;switch(r.type){case s.ShareModalActionTypes.CHANGE_MEMBER_ACCESS_FAILURE:return Object.assign(Object.assign({},e),{members:e.members.setIn([a.member.type(),a.member.memberKey(),"access_type"],a.prevAccess)});case s.ShareModalActionTypes.CHANGE_MEMBER_ACCESS_REQUEST:return Object.assign(Object.assign({},e),{members:e.members.setIn([a.member.type(),a.member.memberKey(),"access_type"],a.newAccess)});case s.ShareModalActionTypes.CLEAR_FILE_MEMBERSHIP_LAST_SEEN_INFO:return Object.assign(Object.assign({},e),{members:e.members.update("users",e=>e.map(e=>e.set("time_last_seen",null)))});case s.ShareModalActionTypes.CREATE_LINK_SUCCESS:return Object.assign(Object.assign({},e),{hasCreatedLink:!0,linkMetadata:a.linkMetadata,sharedLinks:e.sharedLinks.concat(a.linkMetadata)});case s.ShareModalActionTypes.FETCH_MEMBER_COUNTS_SUCCESS:return Object.assign(Object.assign({},e),{memberCounts:a.memberCounts});case s.ShareModalActionTypes.FETCH_METADATA_FAILURE:return Object.assign(Object.assign({},e),{fetchingMetadataPromise:void 0});case s.ShareModalActionTypes.FETCH_METADATA_REQUEST:return Object.assign(Object.assign({},e),{fetchingMetadataPromise:a.promise});case s.ShareModalActionTypes.FETCH_METADATA_SUCCESS:return Object.assign(Object.assign({},e),{metadata:i(e,a.metadata),fetchingMetadataPromise:void 0});case s.ShareModalActionTypes.FETCH_SHARING_PREFS_REQUEST:return Object.assign({},e);case s.ShareModalActionTypes.FETCH_SHARING_PREFS_SUCCESS:return Object.assign(Object.assign({},e),{areSharingPrefsLoaded:!0,sharingPrefs:a.sharingPrefs});case s.ShareModalActionTypes.FETCH_LINK_METADATA_FAILURE:return Object.assign(Object.assign({},e),{isLinkMetadataLoaded:!0,linkMetadata:void 0,sharedLinks:[]});case s.ShareModalActionTypes.FETCH_LINK_METADATA_SUCCESS:return Object.assign(Object.assign({},e),{isLinkMetadataLoaded:!0,linkMetadata:a.sharedLinks.length>0?a.sharedLinks[0]:null,sharedLinks:a.sharedLinks,selectedAudienceByAccessLevel:{}});case s.ShareModalActionTypes.DELETE_LINK_METADATA_SUCCESS:{const t=[];for(const s of e.sharedLinks)s.url!==a.deletedLink.url&&t.push(s);return Object.assign(Object.assign({},e),{hasCreatedLink:!1,hasIncrementedUpsellCounter:!1,linkMetadata:t[0]?t[0]:null,sharedLinks:t})}case s.ShareModalActionTypes.FETCH_USER_ACCOUNTS_REQUEST:return Object.assign(Object.assign({},e),{fetchingMembersRequest:{limitNonNull:a.limitNonNull,promise:a.promise,requestId:a.requestId}});case s.ShareModalActionTypes.FETCH_USER_ACCOUNTS_SUCCESS:return e.fetchingMembersRequest&&e.fetchingMembersRequest.requestId!==a.requestId?e:e.hasDisplayableMembers&&e.fetchingMembersRequest&&e.fetchingMembersRequest.limitNonNull<e.members.getMemberCount()?e:Object.assign(Object.assign({},e),{hasDisplayableMembers:!0,areMembersFullyLoaded:!a.members.cursor,fetchingMembersRequest:a.members.cursor?e.fetchingMembersRequest:void 0,members:a.members});case s.ShareModalActionTypes.FETCH_USER_ACCOUNTS_CONTINUED_SUCCESS:return e.fetchingMembersRequest&&e.fetchingMembersRequest.requestId!==a.requestId?e:Object.assign(Object.assign({},e),{areMembersFullyLoaded:!a.members.cursor,fetchingMembersRequest:a.members.cursor?e.fetchingMembersRequest:void 0,members:e.members.mergeDeep(a.members)});case s.ShareModalActionTypes.FETCH_CURRENT_ACCOUNT_REQUEST:return Object.assign(Object.assign({},e),{isCurrentAccountLoaded:!1});case s.ShareModalActionTypes.FETCH_CURRENT_ACCOUNT_SUCCESS:return Object.assign(Object.assign({},e),{isCurrentAccountLoaded:!0,isFamilyUser:a.isFamilyUser,teamPolicy:a.teamPolicy});case s.ShareModalActionTypes.FETCH_FILE_MEMBER_COUNT_SUCCESS:return Object.assign(Object.assign({},e),{memberCounts:new n.MemberCounts({total_unique_users:a.count,users_outside_team:0,exceeds_count:a.exceeds_limit})});case s.ShareModalActionTypes.REMOVE_MEMBER_KEEP_ACCESS:return Object.assign(Object.assign({},e),{members:e.members.setIn([a.member.type(),a.member.memberKey(),"access_type"],a.access)});case s.ShareModalActionTypes.REMOVE_MEMBER_SUCCESS:return Object.assign(Object.assign({},e),{members:e.members.deleteIn([a.member.type(),a.member.memberKey()])});case s.ShareModalActionTypes.SHARE_FOLDER_FAILURE:return Object.assign(Object.assign({},e),{shareFolderPromise:void 0});case s.ShareModalActionTypes.SHARE_FOLDER_REQUEST:return Object.assign(Object.assign({},e),{shareFolderPromise:a.promise});case s.ShareModalActionTypes.SHARE_FOLDER_SUCCESS:return Object.assign(Object.assign({},e),{metadata:i(e,a.metadata),shareFolderPromise:a.promise});case s.ShareModalActionTypes.TRANSFER_OWNER_SUCCESS:return Object.assign(Object.assign({},e),{metadata:void 0,isLinkMetadataLoaded:!1,hasDisplayableMembers:!1});case s.ShareModalActionTypes.UNBLOCK_MEMBER_LIST_ON_PASS_LOAD:return Object.assign(Object.assign({},e),{shouldBlockMemberListOnPassLoad:!1});case s.ShareModalActionTypes.UPDATE_SHARING_SETTINGS_SUCCESS:return Object.assign(Object.assign({},e),{metadata:i(e,a.metadata)});case s.ShareModalActionTypes.SET_UPSELL_COUNTER_PREF_SUCCESS:return Object.assign(Object.assign({},e),{hasIncrementedUpsellCounter:!0});case s.ShareModalActionTypes.CHANGE_LINK_AUDIENCE_SELECTION:const t=e.selectedAudienceByAccessLevel;return t[a.accessLevel]=a.audience,Object.assign(Object.assign({},e),{selectedAudienceByAccessLevel:t});case s.ShareModalActionTypes.REMOVE_LINK_AUDIENCE_SELECTION:if(e.selectedAudienceByAccessLevel){const t=Object.keys(e.selectedAudienceByAccessLevel).reduce((t,s)=>(e.selectedAudienceByAccessLevel&&s!==a.accessLevel&&(t[s]=e.selectedAudienceByAccessLevel[s]),t),{});return Object.assign(Object.assign({},e),{selectedAudienceByAccessLevel:t})}return e;case s.ShareModalActionTypes.SHARE_MODAL_OPEN:return Object.assign(Object.assign({},e),{selectedAudienceByAccessLevel:{}});default:return e}}})),define("metaserver/static/js/sharing/stores/sharing_info",["require","exports","tslib","metaserver/static/js/modules/constants/python","metaserver/static/js/flux/base_store","metaserver/static/js/sharing/action_types","metaserver/static/js/sharing/api/types/metadata","metaserver/static/js/sharing/share_modal/store/modal_info/reducer","metaserver/static/js/sharing/share_modal/store/sharing_info/reducer","metaserver/static/js/sharing/access_level","metaserver/static/js/sharing/stores/sharing_info_util","metaserver/static/js/sharing/ui_util","metaserver/static/js/core/assert","lodash","typescript/component_libraries/spectrum-sharing/src/share_modal/sharing_settings/utils/link_metadata_types"],(function(e,t,s,n,i,r,a,o,c,l,_,d,u,h,g){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SharingInfo=t.Permissions=t.sharingInfoStore=void 0,n=s.__importStar(n),h=s.__importStar(h);const E=(e,t)=>((t=String(t)).startsWith("id:")||(t=t.toLowerCase()),`${e}::${t}`);class p extends i.Store{constructor(){super(),this.sharingInfoMap={}}getSharingInfo(e,t){return t?this.sharingInfoMap[E(e,t)]:null}mapContentIdsToSharingInfo(e,t,s){for(const n of t)n&&(this.sharingInfoMap[E(e,n)]=s)}_new_payload(e){if(e&&e.action&&e.action.type)switch(e.action.type){case r.SharingActionTypes.CLEAR_EVERYTHING:this.sharingInfoMap={};break;case r.SharingActionTypes.FETCH_METADATA_BATCH_SUCCESS:{const t=e.action.user;e.action.data.forEach(e=>{this._new_payload_for_single_content(r.ShareModalActionTypes.FETCH_METADATA_SUCCESS,t,(0,_.getContentIdsForMetadata)(e),{metadata:e})}),this.emit_change();break}default:if(!e.action.contentIds)return;this._new_payload_for_single_content(e.action.type,e.action.user,e.action.contentIds,e.action.data),this.emit_change()}}_new_payload_for_single_content(e,t,s,n){let i;(0,u.assert)(Boolean(t.id),"valid user needed"),(0,u.assert)(s.length>0,"contentIds cannot be empty");for(const e of s){const s=E(t.id,e);if(s in this.sharingInfoMap){i=this.sharingInfoMap[s];break}}i||(i=new f(t));const r={type:e,payload:n,user:t};return i.setState((0,o.modalInfoReducer)(i.modalInfoState(),r),(0,c.sharingInfoReducer)(i.sharingInfoState(),r)),s.push(i.fqPath()),this.mapContentIdsToSharingInfo(t.id,s,i),i}}t.sharingInfoStore=new p;class m{constructor(e){this.change_options=h.get(e,"change_options.allow",!1),this.edit_contents=h.get(e,"edit_contents.allow",!1),this.invite_editor=h.get(e,"invite_editor.allow",!1),this.invite_viewer=h.get(e,"invite_viewer.allow",!1),this.relinquish_membership=h.get(e,"relinquish_membership.allow",!1),this.leave_a_copy=h.get(e,"leave_a_copy.allow",!1),this.create_edit_link=h.get(e,"create_edit_link.allow"),this.create_view_link=h.get(e,"create_view_link.allow",!1),this.unshare=h.get(e,"unshare.allow",!1),this.update_confidentiality=h.get(e,"update_confidentiality.allow",!1),this.is_file_permissions=e instanceof a.FilePermissions,this.share_message_as_comment=h.get(e,"share_message_as_comment.allow",!1)}canChangeOptions(){return this.change_options}canEdit(){return this.edit_contents}canInviteEditor(){return this.invite_editor}canInviteViewer(){return this.invite_viewer}canInvite(){return this.canInviteViewer()||this.canInviteEditor()}canRelinquishMembership(){return this.relinquish_membership}canCreateEditLink(){return this.is_file_permissions&&this.create_edit_link}canCreateViewLink(){return this.is_file_permissions&&this.create_view_link}canUnshare(){return this.unshare}canUpdateConfidentiality(){return this.update_confidentiality}canLeaveACopy(){return this.leave_a_copy}canShareMessageAsComment(){return this.share_message_as_comment}}t.Permissions=m;class f{constructor(e){this._user=e,this.setState(o.initialModalInfoState,c.initialSharingInfoState)}static createFromParams(e){return new f(e)}setState(e,s){this._modalInfo=e,this._sharingInfoState=s,s.metadata&&t.sharingInfoStore.mapContentIdsToSharingInfo(this._user.id,(0,_.getContentIdsForMetadata)(s.metadata),this)}sharingInfoState(){return this._sharingInfoState}modalInfoState(){return this._modalInfo}user(){return this._user}hasDirectMemberSelf(){const e=this.members();if(e&&1===e.users.count()){return e.users.first().account_id===this._user.account_id}return!1}hasNonSelfMembers(){const e=this.members(),t=e&&e.getMemberCount();if(!t)return!1;if(1===t&&1===e.users.count()){return e.users.first().account_id!==this._user.account_id}return!0}hasNonOwnerMembers(){return this.hasNonSelfMembers()&&this.isOwner()}hasOutsideTeamMembers(){const e=this.memberCounts();return(e?e.users_outside_team:0)>0}memberNum(){const e=this.memberCounts(),t=this.members();return e&&e.total_unique_users?e.total_unique_users:t?t.getMemberCount():void 0}memberCountWithRecipients(){return(this.memberNum()||0)+(0,d.getMemberCountForTokens)(this.recipientTokens())}getInitialProps(){return this.modalInfoState().initialProps}areMembersFullyLoaded(){return this.sharingInfoState().areMembersFullyLoaded}areSharingPrefsLoaded(){return this.sharingInfoState().areSharingPrefsLoaded}sharingPrefs(){return this.sharingInfoState().sharingPrefs}canShareLink(){return!this.isConfidentialFolder()&&!this.isTeamSharedFolder()&&this.contentInfo().pathExists()&&this.contentInfo().isMounted()}canDeleteLink(){const e=this.linkMetadata();return Boolean(e&&e.link_permissions.can_revoke)}contactsError(){return(0,d.validateContacts)(this.recipientTokens(),this._user,this.recipientValidation()[this.recipientAccess()]||{},this.isTeamSharedFolder(),this.isFolderInsideTeamFolderTree(),this.memberCountWithRecipients(),this.recipientAccess(),this.isFolder(),this.sharedLinks())}contentId(){return this.contentInfo().id}contentInfo(){return this.modalInfoState().contentInfo}contentNameInputValue(){return this.modalInfoState().contentNameInputValue}contentNameMessage(){return this.modalInfoState().contentNameMessage}contentNameMessageLevel(){return this.modalInfoState().contentNameMessageLevel}displayPath(){const e=this.metadata();return this.contentInfo().displayPath()||e&&e.path_display||""}parentFolderName(){const e=this.metadata();if(e&&e instanceof a.SharedFileMetadata){const t=e.path_display;if(t){const e=t.split("/");if(e.length>1)return e[e.length-2]}}return e&&e instanceof a.SharedFolderMetadata&&e.parent_folder_name||""}fetchingMembersRequest(){return this.sharingInfoState().fetchingMembersRequest}fetchingMetadataPromise(){return this.sharingInfoState().fetchingMetadataPromise}filePolicy(){const e=this.metadata();return e&&e.file_policy}folderPolicy(){const e=this.metadata();return e&&e.policy}fqPath(){return this.contentInfo().displayPath()}hasDisplayableMembers(){return this.sharingInfoState().hasDisplayableMembers}hasParentSharedFolder(){const e=this.metadata();return!!e&&e.is_inside_team_folder}initialRecipientTokens(){return this.modalInfoState().initialRecipientTokens}isNonUserRelativeContext(){return this.getInitialProps().isInContentManager}isFolder(){return this.contentInfo().isFolder()}isConfidentialFolder(){const e=this.metadata();return Boolean(e&&e.is_confidential)}isContentNameFocused(){return this.modalInfoState().isContentNameFocused}isFolderInsideTeamFolderTree(){const e=this.metadata();return!!e&&e.is_inside_team_folder}isInsideSharedFolder(){const e=this.metadata();return Boolean(e&&e.parent_shared_folder_id||this.contentInfo().isInSharedFolder())}isLinkMetadataLoaded(){return this.sharingInfoState().isLinkMetadataLoaded}isMetadataLoaded(){return Boolean(this.metadata())}isOwner(){const e=this.metadata();return Boolean(e&&e.access_type===l.ACCESS_LEVEL.OWNER)}isOSXPackage(){const e=this.displayPath(),t=e.substr(e.lastIndexOf("."));return n.PACKAGE_EXTS.indexOf(t)>=0}isShareModalUpsellPremiumSharing(){return this.sharingPrefs().in_share_modal_upsell_premium_sharing}shareModalUpsellPremiumSharingVariant(){return this.sharingPrefs().in_share_modal_upsell_premium_sharing_variant}hasSeenUpsellCounter(){return this.sharingPrefs().has_seen_share_modal_upsell_premium_sharing_counter}hasCreatedLink(){return this.sharingInfoState().hasCreatedLink}hasIncrementedUpsellCounter(){return this.sharingInfoState().hasIncrementedUpsellCounter}inviteOrRequestAfterSharingModalVariant(){return this.sharingPrefs().invite_or_request_after_sharing_modal_variant}getExperiments(){return this.modalInfoState().experiments}hasSeenEsignPostSharing(){return this.sharingPrefs().has_seen_esign_post_sharing}isInEsignPostSharingExclusionPeriod(){return this.sharingPrefs().is_in_esign_post_sharing_exclusion_period}isShowingFileUploadToolkitCampaign(){return this.sharingPrefs().is_showing_file_upload_toolkit_campaign}getReferrer(){return this.modalInfoState().referrer}isUserOnOwnerTeam(){const e=this.metadata();return Boolean(e&&e.owner_team&&e.owner_team.id===this._user.team_dbtid)}isCurrentAccountLoaded(){return this.sharingInfoState().isCurrentAccountLoaded}isTeamSharedFolder(){const e=this.metadata();return Boolean(e&&e.is_team_folder||this.contentInfo().isTeamSharedFolder())}isTokenizerEmpty(){return 0===this.recipientRawInput().length&&0===this.recipientTokens().length}linkMetadata(){return this.sharingInfoState().linkMetadata}sharedLinks(){return this.sharingInfoState().sharedLinks||[]}shmodelLink(){return this.sharedLinks().filter(e=>!e.isRighteousLink())[0]}editRighteousLink(){return this.sharedLinks().filter(e=>"editor"===e.link_permissions.link_access_level)[0]}viewRighteousLink(){return this.sharedLinks().filter(e=>"viewer"===e.link_permissions.link_access_level)[0]}linkOnlyReason(){return this.modalInfoState().linkOnlyReason}countsExceedNsLimit(){return this.modalInfoState().countsExceedNsLimit}memberCounts(){return this.sharingInfoState().memberCounts}members(){return this.sharingInfoState().members}metadata(){return this.sharingInfoState().metadata}name(){const e=this.contentInfo(),t=this.metadata();return e&&e.name()||t&&t.name||""}ownerTeam(){const e=this.metadata();return e&&e.owner_team}parentSharedFolderId(){const e=this.metadata();return e&&e.parent_shared_folder_id}pendingMemberAction(){return this.modalInfoState().pendingMemberAction}permissionsObj(){return new m(this.permissions())}permissions(){const e=this.metadata();return e&&e.permissions}recipientAccess(){const e=this.modalInfoState();if(e.recipientAccess)return e.recipientAccess;{const e=this.permissionsObj().canInviteEditor()||this.permissionsObj().canCreateEditLink(),t=this.getDefaultSharingAccessLevel();if(t){const s=t===l.ACCESS_LEVEL.WRITER,n=t===l.ACCESS_LEVEL.READER;if(s&&e||n)return t}return e||this.editRighteousLink()?l.ACCESS_LEVEL.WRITER:l.ACCESS_LEVEL.READER}}recipientMessage(){return this.modalInfoState().recipientMessage}onCreateGroupCallback(){return this.modalInfoState().onCreateGroupCallback}recipientRawInput(){return this.modalInfoState().recipientRawInput}recipientTokens(){return this.modalInfoState().recipientTokens}recipientValidation(){return this.modalInfoState().recipientValidation}shareAsConfidential(){return Boolean(this.getInitialProps().shareAsConfidential)}shareFolderPromise(){return this.sharingInfoState().shareFolderPromise}shouldBlockMemberListOnPassLoad(){return this.sharingInfoState().shouldBlockMemberListOnPassLoad}shouldSyncThisFolder(){return this.getInitialProps()?this.getInitialProps().shouldSyncThisFolder:null}teamPolicy(){return this.sharingInfoState().teamPolicy}isFamilyUser(){return this.sharingInfoState().isFamilyUser}uiMode(){return this.modalInfoState().uiMode}isCloudDoc(){const e=this.metadata();return!(!e||!e.is_cloud_doc)}fetchMetadataStatus(){return this.modalInfoState().fetchMetadataStatus}isShareMessageAsCommentChecked(){const e=this.modalInfoState().isShareMessageAsCommentExplicitlyChecked;return void 0===e?this.permissionsObj().canShareMessageAsComment():e}shouldSuppressRedirectToBrowse(){return this.getInitialProps()?this.getInitialProps().shouldSuppressRedirectToBrowse:null}shouldCloseImmediately(){return this.getInitialProps()?this.getInitialProps().shouldCloseImmediately:null}shouldFetchLinkMetadata(){return this.canShareLink()&&!this.isNonUserRelativeContext()&&this.contentInfo().isMounted()}getSelectedAudienceByAccessLevel(e){return this.sharingInfoState().selectedAudienceByAccessLevel[e]}getEligibleInviteAfterSharingContacts(){return(0,_.getEligibleInviteAfterSharingContactsImpl)(this.recipientTokens(),this.recipientValidation())}sendApproval(){return this.modalInfoState().sendApproval}needsAllApprovers(){return this.modalInfoState().needsAllApprovers}creatingApprovalRequest(){return this.modalInfoState().creatingApprovalRequest}automationOptionChecked(){return this.modalInfoState().automationOptionChecked}isExpBsxOrganizeAroundPeopleEnabled(){return this.sharingPrefs().bsx_organize_around_people}getSharingTasks(){return this.modalInfoState().sharingTasks}getDefaultSharingAccessLevel(){const e=l.DEFAULT_SHARING_ACCESS_LEVEL[this.sharingPrefs().default_sharing_access_level];return e==l.DEFAULT_SHARING_ACCESS_LEVEL[0]?l.ACCESS_LEVEL.WRITER:e}getDefaultSharingLinkAudience(){const e=g.DEFAULT_SHARING_LINK_AUDIENCE[this.sharingPrefs().default_sharing_link_audience];return e==g.DEFAULT_SHARING_LINK_AUDIENCE[0]?g.LINK_AUDIENCE.PUBLIC:e}}t.SharingInfo=f})),define("metaserver/static/js/sharing/stores/sharing_info_util",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getEligibleInviteAfterSharingContactsImpl=t.getContentIdsForContentInfo=t.getContentIdsForMetadata=void 0;t.getContentIdsForMetadata=e=>[e.shared_folder_id,e.id,e.path_lower].filter(e=>!!e);t.getContentIdsForContentInfo=e=>{const t=[];return e.isSharedFolder()?t.push(e.sharedFolderId()):(e.extras.fileId&&t.push(e.extras.fileId),e.extras.nsId&&e.extras.nsPath&&t.push(`ns:${e.nsId()}${e.nsPath()}`)),e.displayPath()&&t.push(e.displayPath()),t};t.getEligibleInviteAfterSharingContactsImpl=(e,t)=>{const s=new Set(e.filter(e=>!e.invalid).map(e=>e.getKey())),n=Object.values(t),i=new Set,r=new Set;for(const e of n)for(const t in e)if(e.hasOwnProperty(t)&&s.has(t)){const s=e[t];if(s&&s.inviteAfterSharingEligibility){const e=s.inviteAfterSharingEligibility[".tag"];"eligible_not_seen"===e?i.add(t):"eligible_seen"===e&&r.add(t)}}return{inviteEligibleNotSeenContacts:e.filter(e=>i.has(e.getKey())&&!e.invalid),inviteEligibleSeenContacts:e.filter(e=>r.has(e.getKey())&&!e.invalid)}}})),define("metaserver/static/js/sharing/views/constants",["require","exports","tslib","lodash","metaserver/static/js/core/i18n"],(function(e,t,s,n,i){"use strict";var r,a,o;Object.defineProperty(t,"__esModule",{value:!0}),t.EXP_LINK_IN_MEMBER_LIST_VARIANT=t.LINK_CREATION_SURFACE=t.CONTENT_NAME_MESSAGE_LEVEL_VALUES=t.BANNER_VALUES=t.MODE_VALUES=t.CONTENT_NAME_EMPTY_TOOLTIP=t.NS_LIMIT_ERROR=t.LINK_ONLY_REASON=t.MODES=t.LinkabilityStates=t.FETCH_METADATA_STATUS=t.CONTENT_NAME_MESSAGE_LEVELS=t.BANNERS=void 0,n=s.__importStar(n),(function(e){e[e.NO_MEMBERS=0]="NO_MEMBERS",e[e.INPUT_CONTENT_NAME=1]="INPUT_CONTENT_NAME"})(r=t.BANNERS||(t.BANNERS={})),(function(e){e[e.INFO=0]="INFO",e[e.ERROR=1]="ERROR"})(a=t.CONTENT_NAME_MESSAGE_LEVELS||(t.CONTENT_NAME_MESSAGE_LEVELS={})),(function(e){e[e.FETCHING=0]="FETCHING",e[e.SUCCESS=1]="SUCCESS",e[e.FAIL=2]="FAIL"})(t.FETCH_METADATA_STATUS||(t.FETCH_METADATA_STATUS={})),(function(e){e.CAN_LINK="CAN_LINK",e.INVITE_NO_LINK="INVITE_NO_LINK",e.NO_INVITE_NO_LINK="NO_INVITE_NO_LINK",e.CANT_LINK_TEAM_FOLDER="CANT_LINK_TEAM_FOLDER",e.ERROR_FETCHING_LINK_INFO="ERROR_FETCHING_LINK_INFO"})(t.LinkabilityStates||(t.LinkabilityStates={})),(function(e){e.LINK_ONLY="link-only",e.LOADING="loading",e.MEMBERSHIP="membership",e.POINTER="pointer",e.SHARE="share",e.SHARE_SENDING="share-sending",e.EVOLUTION="evolution"})(o=t.MODES||(t.MODES={})),(function(e){e.INSIDE_SHARED_FOLDER="inside_shared_folder",e.CONTAINS_SHARED_FOLDER="contains_shared_folder",e.LINKS_PAGE="links_page",e.TOTAL_MOUNTS_EXCEEDED="total_mounts_exceeded",e.HOME_MOUNTS_EXCEEDED="home_mounts_exceeded",e.TREE_SIZE_EXCEEDED="tree_size_exceeded"})(t.LINK_ONLY_REASON||(t.LINK_ONLY_REASON={})),(function(e){e.TOTAL_MOUNTS_EXCEEDED="total_mounts_exceeded",e.HOME_MOUNTS_EXCEEDED="home_mounts_exceeded",e.TREE_SIZE_EXCEEDED="tree_size_exceeded"})(t.NS_LIMIT_ERROR||(t.NS_LIMIT_ERROR={})),t.CONTENT_NAME_EMPTY_TOOLTIP=i.intl.formatMessage({id:"mYGncD",defaultMessage:"Name your shared folder"}),t.MODE_VALUES=n.values(o),t.BANNER_VALUES=n.values(r),t.CONTENT_NAME_MESSAGE_LEVEL_VALUES=n.values(a),(function(e){e.COPY_OR_CREATE_LINK_SECTION="COPY_OR_CREATE_LINK_SECTION"})(t.LINK_CREATION_SURFACE||(t.LINK_CREATION_SURFACE={})),(function(e){e.ON="ON",e.OFF="OFF",e.CONTROL="CONTROL"})(t.EXP_LINK_IN_MEMBER_LIST_VARIANT||(t.EXP_LINK_IN_MEMBER_LIST_VARIANT={}))}));
//# sourceMappingURL=pkg-fvsdk-support.min.js-vflni8hQW.map