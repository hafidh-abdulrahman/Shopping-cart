define(["require","exports","tslib","react","typescript/libraries/file-viewer/src/preview_archive/folder_entry_view","typescript/libraries/file-viewer/src/preview_archive/utils","typescript/libraries/file-viewer/src/preview_archive/file_entry_view","typescript/libraries/file-viewer/src/preview_error/preview_error","typescript/libraries/file-viewer/src/core/logging/actions","typescript/libraries/file-viewer/src/core/data/utils","typescript/libraries/file-viewer/src/core/data/selectors","typescript/libraries/file-viewer/src/core/types/errors","typescript/libraries/file-viewer/src/file_viewer/context_provider","react-intl","react-redux","typescript/libraries/file-viewer/src/hooks/selectors"],(function(e,r,i,t,n,o,l,s,c,a,v,d,w,u,f,h){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.PreviewArchive=r.UnconnectedPreviewArchive=void 0,t=i.__importStar(t);r.UnconnectedPreviewArchive=e=>{const{fileViewerId:r,onRenderFailed:i,onRenderSucceeded:y,height:p,config:P,previewKey:g,loggingSession:F}=e,E=(0,u.useIntl)(),A=(0,f.useDispatch)(),_=(0,h.useParameterizedSelector)(v.getFilePreviewUi,r,g),b=null==_?void 0:_.currentPath,m=t.useRef("initial"),{isLoggedIn:S}=(0,w.useFileViewerContext)(),U=(0,h.useFileViewerSelector)(r,v.getCurrentFile),V=(0,a.filterArchivePreviewRivieraData)((0,h.usePreviewKeySelector)(null==U?void 0:U.previewKey,v.getRivieraData)),D=(0,h.usePreviewKeySelector)(null==U?void 0:U.previewKey,v.getFileMetadata),I=(0,f.useSelector)(e=>e.archiveFiles),R=(0,f.useSelector)(e=>e.filePreviewUi[r]),K=(0,f.useSelector)(e=>e.rivieraData),M=t.useMemo(()=>{if("loaded"===(null==V?void 0:V.rootEntry.state)&&b)return(0,a.getArchiveEntryAtPath)(V.rootEntry.data,b,r,g,A)},[V,b,A,r,g]),j=null==V?void 0:V.rootEntry.state,x=null==U?void 0:U.file_id;if(t.useEffect(()=>{if(j&&j!==m.current){switch(j){case"errored":i();break;case"loaded":y(),A((0,c.logTTI)(r));const e="loaded"===(null==V?void 0:V.rootEntry.state)&&V.rootEntry.data.isPasswordProtected;if(M&&U&&x&&!e){const{entry:e,parent:r}=M;if(!e.isDir&&r&&r.children&&b){const e=b.slice(0,b.length-1),i=(0,o.getFiles)(r.children);(0,o.getArchiveFiles)(e,i,U,A,S)}}}m.current=j}},[r,j,A,i,y,M,U,g,V,x,S,b]),!(V&&"pending"!==(null==V?void 0:V.rootEntry.state)&&M&&x&&U))return null;if("errored"===(null==V?void 0:V.rootEntry.state))return t.createElement(s.PreviewRenderError,Object.assign({},e,{error:new d.FVError(d.FVErrorCode.Unknown)}));if(void 0===b)throw new Error("filePreviewUiData.currentPath is not defined");if(void 0===D)throw new Error("fileMetadata is not defined");const{entry:N}=M;return N.isDir?t.createElement(n.FolderEntryView,{rootEntry:V.rootEntry.data,entry:N,currentPath:b,fileViewerId:r,rootPreviewKey:g,dispatch:A,intl:E,height:p,config:P,rootFileInfo:U,archiveFiles:I,fullFilePreviewUi:R,fullRivieraData:K,loggingSession:F}):V.rootEntry.data.isPasswordProtected||(0,v.getArchiveFilesFetchedPreviewMetadata)(I,x)?t.createElement(t.Fragment,null,t.createElement(l.FileEntryView,Object.assign({},e,{archiveFiles:I,fullFilePreviewUi:R,fullRivieraData:K,loggingSession:F,currentPath:b,rootArchiveFileInformation:{fileName:D.file_name,previewKey:g},isArchiveFilePasswordProtected:V.rootEntry.data.isPasswordProtected,rootFileId:x,entry:N}))):null},r.UnconnectedPreviewArchive.displayName="UnconnectedPreviewArchive",r.UnconnectedPreviewArchive.displayName="UnconnectedPreviewArchive";r.PreviewArchive=e=>{const{fileViewerId:i}=e,n=(0,h.useFileViewerSelector)(i,v.getFilePreviewSession);return n?t.createElement(r.UnconnectedPreviewArchive,Object.assign({},e,{loggingSession:n})):null},r.PreviewArchive.displayName="PreviewArchive"}));
//# sourceMappingURL=preview_archive.min.js-vflbhkVaS.map