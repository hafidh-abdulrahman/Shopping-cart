define("metaserver/static/js/avatar/contact_avatar",["require","exports","tslib","react","metaserver/static/js/avatar/avatar_with_default","metaserver/static/js/avatar/initials_avatar","metaserver/static/js/avatar/size","metaserver/static/js/contacts/types","metaserver/static/js/core/i18n","metaserver/static/js/core/user_i18n"],(function(e,t,s,i,r,n,a,o,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=s.__importDefault(i),r=s.__importDefault(r),o=s.__importDefault(o),c=s.__importStar(c);const d=i.default.createElement;class u extends i.default.Component{render(){let e,t;const{contact:s}=this.props,i=s.name||s.email||"";let u=s.photo_url;s.type===o.default.FB&&(u=`https://graph.facebook.com/${s.fb_id}/picture`);let _="";this.props.dimension!==a.AvatarSize.XSMALL&&(_=c.getInitials(i)),s.type===o.default.NEW_STYLE_GROUP?(e=l.intl.formatMessage({id:"FxoGBv",defaultMessage:"Group"}),t="SQUARE"):(e=l.intl.formatMessage({id:"n4ojia",defaultMessage:"User"}),t="CIRCLE");const p={alt:e,dimension:this.props.dimension,photoUrl:u,shape:t,optionalClass:this.props.optionalClass,defaultAvatar:d(n.InitialsAvatarWithColorDerivedFromName,{alt:e,dimension:this.props.dimension,name:i,initials:_,shape:t,optionalClass:this.props.optionalClass})};return d(r.default,p)}}u.displayName="ContactAvatar",t.default=u})),define("metaserver/static/js/components/title_bubble",["require","exports","tslib","classnames","react","react-dom","prop-types","jquery","metaserver/static/js/components/ui/css"],(function(e,t,s,i,r,n,a,o,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=s.__importDefault(i),r=s.__importDefault(r),n=s.__importStar(n),a=s.__importDefault(a),o=s.__importDefault(o);class c extends r.default.Component{constructor(){super(...arguments),this.state={isChildFocused:!1}}componentDidMount(){(0,o.default)(n.findDOMNode(this)).on("focusin.title-bubble",e=>this.setState({isChildFocused:!0})).on("focusout.title-bubble",e=>this.setState({isChildFocused:!1})).on("mouseenter.title-bubble",()=>"function"==typeof this.props.onMouseEnter?this.props.onMouseEnter():void 0)}componentWillUnmount(){(0,o.default)(n.findDOMNode(this)).off("focusin.title-bubble").off("focusout.title-bubble").off("mouseenter.title-bubble")}render(){const e={"c-title-bubble":!0,"is-child-focused":this.state.isChildFocused,"c-title-bubble--respect-line-break":this.props.respectLineBreaks};return e[`c-title-bubble--${this.props.direction.slice(0,1)}`]=!0,r.default.createElement("div",{className:(0,i.default)([e,this.props.className]),"data-title":this.props.text,onClick:e=>{if(e.detail>0)return this.setState({isChildFocused:!1})},onMouseLeave:()=>this.setState({isChildFocused:!1})},this.props.children)}}c.displayName="TitleBubble",c.propTypes={text:a.default.string.isRequired,direction:a.default.oneOf(["north","south","east","west"]).isRequired,onMouseEnter:a.default.func,respectLineBreaks:a.default.bool,className:a.default.string};const d=(0,l.requireCssWithComponent)(c,["/static/metaserver/static/css/scooter/scooter-scoped-vflhkBqI_.css"]);t.default=d})),define("metaserver/static/js/contacts/bloodhound_contacts_v2",["require","exports","tslib","bloodhound","metaserver/static/js/contacts/config","metaserver/static/js/contacts/contact","metaserver/static/js/profile_services/profile_services_link","metaserver/static/js/clean/viewer","js/browser/cookies"],(function(e,t,s,i,r,n,a,o,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BloodhoundContactsV2=void 0,i=s.__importDefault(i),r=s.__importStar(r),a=s.__importStar(a);const c={};function d(e,t){(function(e,t){if(!(e.id in c))return;const s=c[e.id];t=t.filter(n.ContactCommon.is_valid),s.clearRemoteCache(),s.clear(),s.add(t)})(e,t.includeForUser(e.id).contacts)}function u(e){const t=document.createElement("a");t.href=e;const s=t.hostname||window.location.hostname;if(-1===s.indexOf(".dropbox.com",s.length-".dropbox.com".length))throw new Error("Cannot send the CSRF token to "+s);return e}t.BloodhoundContactsV2={getOrCreateForUser(e){if(e.id in c)return c[e.id];const t=r.getSearchConfigForUser(e);let s;if(t.remoteEndpoint){const i=String(e.id);s={url:u(t.remoteEndpoint),prepare:(e,t)=>(t.type="POST",t.headers={"X-CSRF-Token":l.Cookies.read("__Host-js_csrf"),"X-Dropbox-Uid":i},t.data={query:JSON.stringify(e)},t.data._subject_uid=i,t),rateLimitBy:"debounce",rateLimitWait:t.remoteDebounceWait}}const _=new i.default({datumTokenizer:n.ContactCommon.get_index_tokens,queryTokenizer:i.default.tokenizers.whitespace,identify:n.ContactCommon.get_key,sufficient:t.sufficientResults,sorter:n.ContactCommon.sorter,local:[],remote:s});if(c[e.id]=_,o.Viewer.get_viewer().is_user_signed_in(e)){const s=t.localCacheStore.getOrCreateForUser(e);s.load_contacts(!1,t=>{d(e,t),s.register_for_updates("bloodhound_contacts_v2",t=>{d(e,t)})})}return a.LinkedProfileServices.get_linked_profile_services_for_user(e.id).register_for_service_changes("bloodhound_contacts_v2",e=>{_.clearRemoteCache()}),c[e.id]},search(e,s,i,n){const a=t.BloodhoundContactsV2.getOrCreateForUser(e),o=r.getSearchConfigForUser(e);if(!s)return i([]),void(n&&o.remoteEndpoint&&n([]));const l=o.localCacheStore.getOrCreateForUser(e);l.is_loaded()?a.search(s,i,n):l.load_contacts(!1,e=>{a.search(s,i,n)}),l.refresh_contacts(!1)},getAll:e=>t.BloodhoundContactsV2.getOrCreateForUser(e).all()}})),define("metaserver/static/js/contacts/cache",["require","exports","tslib","metaserver/static/js/deprecated_ajax/ajax_jquery","metaserver/static/js/bolt/bolt_nodeps","metaserver/static/js/contacts/cache_type","metaserver/static/js/contacts/list","metaserver/static/js/clean/viewer","metaserver/static/js/core/assert"],(function(e,t,s,i,r,n,a,o,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PerUserBoltContactsCache=t.ContactsCacheProto=t.BoltContactsCache=void 0,i=s.__importStar(i),r=s.__importStar(r),a=s.__importDefault(a);class c{constructor(e){this.callbacks={},this.one_time_callbacks=[],this.cached_contacts=null,this._cache_download_name=e,this.should_force_refresh=!1,this.request_perf_records=[],this._config=null}static initClass(){this.MAX_REQUEST_PERF_RECORDS=20}register_for_updates(e,t){this.callbacks[e]=t}unregister_for_updates(e){null!=this.callbacks[e]&&delete this.callbacks[e]}get_contacts_count(){return null!=this.cached_contacts?this.cached_contacts.length():0}get_downloaded_time(){const e=window.performance.getEntriesByName(this._get_contacts_downloaded_mark_name());return e&&e.length?e[0].startTime:null}get_request_perf_records(){return this.request_perf_records}_is_contact_get_or_check_ajax_request(e){const{initiatorType:t}=e,{name:s}=e;return"xmlhttprequest"===t&&s.endsWith(this._config.getUrl)}_find_last_perf_entry(e=500){const t=window.performance.getEntriesByType("resource");if(t.length){for(let s=Math.min(t.length-1,e);s>=0;s--)if(this._is_contact_get_or_check_ajax_request(t[s]))return t[s]}return null}_record_perf_stats(e={}){const t=this._find_last_perf_entry();if(t&&(e.ttfb=t.responseStart-t.requestStart,e.downloading_time=t.responseEnd-t.responseStart,e.duration=t.duration,this.request_perf_records.push(e),this.request_perf_records.length>c.MAX_REQUEST_PERF_RECORDS))return this.request_perf_records=this.request_perf_records.slice(this.request_perf_records.length-1)}_get_request_url(){throw new Error("method unimplemented")}_get_request_params(){throw new Error("method unimplemented")}_contacts_loaded_callback(e){throw new Error("method unimplemented")}_fetch_contacts(){return i.BackgroundRequest({url:this._get_request_url(),data:this._get_request_params(),success:(e,t,s)=>{const i=JSON.parse(e);if(this._contacts_loaded_callback(i),this._schedule_fetch)return this._schedule_fetch()}})}_get_versioned_params(e,t=!0){const s={version:e};return t&&(s.force_refresh=this.should_force_refresh,this.should_force_refresh=!1),null!=this.digest&&(s.digest=this.digest),null!=this.limit&&(s.limit=this.limit),s}_get_contacts_downloaded_mark_name(){return`${this._cache_download_name}-${this.instance}`}_is_page_hidden(){return null!=window.document.visibilityState&&window.document.hidden}_add_one_time_callback(e){if(null!=e&&!Array.from(this.one_time_callbacks).includes(e))return this.one_time_callbacks.push(e)}_invoke_all_callbacks(e){return this._invoke_callbacks(this.one_time_callbacks,e,!0),this._invoke_callbacks(this.callbacks,e,!1)}_invoke_one_time_callbacks(e){return this._invoke_callbacks(this.one_time_callbacks,e,!0)}_invoke_callbacks(e,t,s){return(()=>{const i=[];for(const r of Array.from(Object.keys(e)))e[r](t),s?i.push(delete e[r]):i.push(void 0);return i})()}}t.ContactsCacheProto=c,c.initClass();class d extends c{constructor(e,t=null,s=null){super("BoltContactsCache download"),this.bolt_update_callback=this.bolt_update_callback.bind(this),this.bolt_refresh_callback=this.bolt_refresh_callback.bind(this),this.cache_type=e,this.limit=t,this.user_id=s,this.instance=d.INSTANCE++,this.loading_state=d.BOLT_NEED_TO_SEND_REQUEST,this._config=n.CONTACT_CACHE_TYPE_TO_CONFIG[n.ContactCacheType[this.cache_type]],this.current_bolt_states=null,this._notified_states={},this._bolt=null,this._last_refresh_ts=null}static initClass(){this.INSTANCE=0,this.BOLT_NEED_TO_SEND_REQUEST=0,this.BOLT_REQUEST_SENT=1,this.REFRESH_THRESHOLD=36e5}load_contacts(e,t){o.Viewer.get_viewer().is_signed_in&&(this._add_one_time_callback(t),(this.loading_state===d.BOLT_NEED_TO_SEND_REQUEST||e)&&(this.loading_state=d.BOLT_REQUEST_SENT,e&&(this.should_force_refresh=!0),this._fetch_contacts()),!this._should_update_contacts()&&this.is_loaded()&&this._invoke_one_time_callbacks(this.cached_contacts))}refresh_contacts(e=!1){const t=window.performance.now();if(this._last_refresh_ts||(e=!0),!(!e&&this._last_refresh_ts&&t-this._last_refresh_ts<d.REFRESH_THRESHOLD))return i.BackgroundRequest({url:this._get_refresh_url(),data:this._get_refresh_params({force_refresh:e})}),this._last_refresh_ts=t}is_loaded(){return null!=this.cached_contacts}bolt_update_callback(e){for(const t of Array.from(e))(!Array.from(this._notified_states).includes(t.unique_id)||+this._notified_states[t.unique_id].revision<+t.revision)&&(this._notified_states[t.unique_id]=t);return this._should_update_contacts()&&(this.loading_state=d.BOLT_NEED_TO_SEND_REQUEST),this.load_contacts()}bolt_refresh_callback(e){if(null!=this._bolt&&this._bolt.unsubscribe(),this._bolt=null,this.loading_state=d.BOLT_NEED_TO_SEND_REQUEST,!this._is_page_hidden())return this.load_contacts()}_contacts_loaded_callback(e){if(this._is_old_contacts(e.bolt_info))return;const t=this._is_new_contacts(e.bolt_info);return this.current_bolt_states=e.bolt_info,null==this._bolt&&this._subscribe_to_bolt(),t&&(null!=e.contacts?e.contacts.length:void 0)?(this._record_perf_stats({num_contacts:e.contacts.length}),this.digest=e.digest,this._create_contacts_list(e.contacts),this._invoke_all_callbacks(this.cached_contacts),window.performance.mark(this._get_contacts_downloaded_mark_name())):void 0}_create_contacts_list(e){return this.cached_contacts=a.default.create_contacts_list(e)}_subscribe_to_bolt(){const e=[];for(const t in this.current_bolt_states){const s=this.current_bolt_states[t];e.push(new r.SignedChannelState(this._config.boltAppId,t.toString(),s.revision,s.token))}return this._bolt=new r.BoltClient(e,this.bolt_update_callback,this.bolt_refresh_callback),this._bolt.start()}_is_new_contacts(e){return this._first_contacts_are_newer(e,this.current_bolt_states)}_is_old_contacts(e){return this._first_contacts_are_newer(this.current_bolt_states,e)}_first_contacts_are_newer(e,t){if(!t)return!0;for(const s in t){const i=t[s];for(const t in e){const r=e[t];if(t===s&&+i.revision<+r.revision)return!0}}return!1}_should_update_contacts(){return this._is_new_contacts(this._notified_states)}_get_request_params(){return this._get_versioned_params(1)}_get_request_url(){return this._config.getUrl}_get_refresh_params(e={}){return e}_get_refresh_url(){return this._config.refreshUrl}}t.BoltContactsCache=d,d.initClass();t.PerUserBoltContactsCache=class extends d{constructor(e,t){(0,l.assert)(null!=t.id,"user has invalid id"),super(e,null),this.cache_type=e,this.user=t}_get_request_params(){const e=this._get_versioned_params(1);return e._subject_uid=this.user.id,e}_get_refresh_params(e={}){return e._subject_uid=this.user.id,e}_create_contacts_list(e){return this.cached_contacts=a.default.create_per_user_contacts_list(e,this.user.id)}}})),define("metaserver/static/js/contacts/cache_store",["require","exports","tslib","metaserver/static/js/contacts/cache_type","metaserver/static/js/contacts/cache","metaserver/static/js/modules/constants/contacts","metaserver/static/js/clean/viewer"],(function(e,t,s,i,r,n,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IndividualContactsCacheStore=t.LegacyContactsCacheStore=t.DefaultContactsCacheStore=t.PerUserBoltContactsCacheStore=t.PerViewerBoltContactsCacheStore=t.BoltContactsCacheStore=void 0,n=s.__importStar(n);class o{constructor(e){this.cacheType=e}}t.BoltContactsCacheStore=o;class l extends o{getOrCreateForUser(e){if(!a.Viewer.get_viewer().is_uid_associated(e.id))throw new Error("Requested contacts cache for a user not associated with the current viewer.");return this.getOrCreateForViewer()}getOrCreateForViewer(){return null==this.contactsCache&&(this.contactsCache=new r.BoltContactsCache(this.cacheType)),this.contactsCache}}t.PerViewerBoltContactsCacheStore=l;class c extends o{constructor(){super(...arguments),this.uidToContactsCache={}}getOrCreateForUser(e){return e.id in this.uidToContactsCache||(this.uidToContactsCache[e.id]=new r.PerUserBoltContactsCache(this.cacheType,e)),this.uidToContactsCache[e.id]}}t.PerUserBoltContactsCacheStore=c,t.DefaultContactsCacheStore=new l(i.ContactCacheType.ALL);let d=t.DefaultContactsCacheStore;"OFF"!==n.LEGACY_CACHE_LIMIT&&(d=new l(i.ContactCacheType.ALL),d.contactsCache=new r.BoltContactsCache(i.ContactCacheType.ALL,+n.LEGACY_CACHE_LIMIT)),t.LegacyContactsCacheStore=d,t.IndividualContactsCacheStore=new c(i.ContactCacheType.INDIVIDUAL)})),define("metaserver/static/js/contacts/cache_type",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CONTACT_CACHE_TYPE_TO_CONFIG=t.ContactCacheType=void 0,(function(e){e[e.ALL=0]="ALL",e[e.INDIVIDUAL=1]="INDIVIDUAL"})(t.ContactCacheType||(t.ContactCacheType={})),t.CONTACT_CACHE_TYPE_TO_CONFIG={ALL:{getUrl:"/contacts/get",refreshUrl:"/contacts/refresh",boltAppId:"contacts_cache_notify"},INDIVIDUAL:{getUrl:"/contacts/get_individual_for_user",refreshUrl:"/contacts/refresh_individual_for_user",boltAppId:"individual_contacts_cache_notify"}}})),define("metaserver/static/js/contacts/config",["require","exports","tslib","metaserver/static/js/modules/constants/contacts","metaserver/static/js/contacts/cache_store"],(function(e,t,s,i,r){"use strict";var n;function a(e){return i.MERGE_SEARCH_ALLOWED[e.id]?n.INDIVIDUAL_LOCAL_TEAM_REMOTE:n.ALL_LOCAL}Object.defineProperty(t,"__esModule",{value:!0}),t.getSearchConfigForUser=t.getSearchModeForUser=t.CONTACTS_SEARCH_MODE_TO_CONFIG=t.CONTACTS_SEARCH_DEBOUNCE_WAIT=t.CONTACTS_SEARCH_PREEMPTED_THRESHOLD=t.LOCAL_ONLY_SEARCH_MODES=t.ContactsSearchMode=void 0,i=s.__importStar(i),(function(e){e[e.ALL_LOCAL=0]="ALL_LOCAL",e[e.INDIVIDUAL_LOCAL_TEAM_REMOTE=1]="INDIVIDUAL_LOCAL_TEAM_REMOTE"})(n=t.ContactsSearchMode||(t.ContactsSearchMode={})),t.LOCAL_ONLY_SEARCH_MODES=[n.ALL_LOCAL],t.CONTACTS_SEARCH_PREEMPTED_THRESHOLD=300,t.CONTACTS_SEARCH_DEBOUNCE_WAIT=10,t.CONTACTS_SEARCH_MODE_TO_CONFIG={ALL_LOCAL:{localCacheStore:r.DefaultContactsCacheStore,sufficientResults:1e3,remoteDebounceWait:t.CONTACTS_SEARCH_DEBOUNCE_WAIT},INDIVIDUAL_LOCAL_TEAM_REMOTE:{localCacheStore:r.IndividualContactsCacheStore,remoteEndpoint:"/team/search_contacts",remoteBatchEndpoint:"/team/search_contacts_batch",sufficientResults:1e3,remoteDebounceWait:t.CONTACTS_SEARCH_DEBOUNCE_WAIT}},t.getSearchModeForUser=a,t.getSearchConfigForUser=function(e){return t.CONTACTS_SEARCH_MODE_TO_CONFIG[n[a(e)]]}})),define("metaserver/static/js/contacts/contact",["require","exports","tslib","metaserver/static/js/contacts/types","metaserver/static/js/core/assert","metaserver/static/js/validators/validators"],(function(e,t,s,i,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Contact=t.ContactCommon=void 0,i=s.__importDefault(i);class a{static sorter(e,t){return t.domain_contact&&!e.domain_contact?-1:e.domain_contact&&!t.domain_contact?1:e.sort_key||t.sort_key?e.sort_key?t.sort_key?e.sort_key>t.sort_key?-1:e.sort_key<t.sort_key?1:0:-1:1:0}static is_valid(e){return e.dbx_account_id?e.type===i.default.DBX_ID||e.type===i.default.EMAIL:e.group_id?e.type===i.default.NEW_STYLE_GROUP:!!e.email&&e.type===i.default.EMAIL}static get_key(e){return(0,r.assert)(a.is_valid(e),`invalid contact: type: ${e.type}`),e.dbx_account_id?`DBX_USER-${e.dbx_account_id}`:e.group_id?`DBX_GROUP-${e.group_id}`:`CONTACT-${e.type}-${e.email}`}static get_index_tokens(e){let t=[];return e.name&&t.push(e.name),e.email&&t.push(e.email),e.fname&&t.push(e.fname),e.lname&&t.push(e.lname),e.name_tokens&&(t=t.concat(e.name_tokens)),t}}t.ContactCommon=a;class o{constructor({dbx_account_id:e,type:t,name:s,email:i,fb_id:r,group_id:n,group_size:a,photo_url:o,members:l,avatar_url:c,invalid:d,on_team:u,domain_contact:_,dbx_team_id:p,nameMatch:h,emailMatch:m,pending:f,join_state:g,query:v,is_directory_restricted:y=!1,invitability_state:b}){this.dbx_account_id=e,this.type=t,this.name=s,this.email=i,this.fb_id=r,this.group_id=n,this.group_size=a,this.photo_url=o,this.members=l,this.avatar_url=c,this.invalid=d,this.on_team=u,this.domain_contact=_,this.dbx_team_id=p,this.nameMatch=h,this.emailMatch=m,this.pending=f,this.join_state=g,this.query=v,this.is_directory_restricted=!!y,this.team=this.on_team,this.invitability_state=b}static buildFromRawEmail(e){const t=(function(e){return e.toLowerCase()})(e);return new o({name:t,email:t,type:i.default.EMAIL,invalid:!(0,n.validateEmail)(e),on_team:!1,pending:!0,query:t})}getKey(){return a.get_key(this)}getContactID(){switch(this.type){case i.default.FB:return this.fb_id;case i.default.NEW_STYLE_GROUP:return this.group_id;default:return this.email}}}t.Contact=o})),define("metaserver/static/js/contacts/contact_token_state",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ContactTokenState=void 0,(function(e){e.invalid="invalid",e.warn="warn",e.pending="pending",e.ok="ok"})(t.ContactTokenState||(t.ContactTokenState={}))})),define("metaserver/static/js/contacts/data_v2",["require","exports","tslib","metaserver/static/js/deprecated_ajax/ajax_jquery","metaserver/static/js/contacts/bloodhound_contacts_v2","metaserver/static/js/contacts/config","metaserver/static/js/contacts/contact","metaserver/static/js/contacts/types","metaserver/static/js/clean/fuzzy"],(function(e,t,s,i,r,n,a,o,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ContactsDataSourceV2=void 0,i=s.__importStar(i),n=s.__importStar(n),o=s.__importDefault(o),l=s.__importDefault(l);class c{constructor(e,t,s=!0,i=!0){this.query=this.search,this.query_batch=this.searchBatch,this.user=e,this.filterFunc=t,this.excludeDomainContacts=s,this.excludeDirectoryRestrictedContacts=i,this.searchConfig=n.getSearchConfigForUser(e),this.searchMode=n.getSearchModeForUser(e),this.searchModeName=n.ContactsSearchMode[this.searchMode],r.BloodhoundContactsV2.getOrCreateForUser(this.user)}search(e,t,s){if(""===(e=c.normalizeQuery(e)))return t([]),void(s&&s([]));r.BloodhoundContactsV2.search(this.user,e,s=>this.processMatches(s,t,e),t=>this.processMatches(t,s,e))}searchBatch(e,t,s){const i=this.searchConfig.localCacheStore.getOrCreateForUser(this.user);if(i.is_loaded())return this.searchBatchInternal(e,t,s);i.load_contacts(!0,()=>this.searchBatchInternal(e,t,s))}searchBatchInternal(e,t,s){const i=e.map(c.normalizeQuery).filter(e=>e.length>0),n={};for(const e of i){const t=t=>{n[e]=this.processMatches(t,void 0,e)};r.BloodhoundContactsV2.search(this.user,e,t)}if(t(n),!this.searchConfig.remoteBatchEndpoint)return;this.searchRemoteBatch(i,e=>{if(!s)return;const t={};for(const s in e)if(e.hasOwnProperty(s)){const i=n[s].map(a.ContactCommon.get_key),r=e[s].filter(e=>{const t=a.ContactCommon.get_key(e);return i.every(e=>e!==t)});t[s]=this.processMatches(r)}s(t)})}normalizeQuery(e){return e.trim().toLowerCase()}isSearchLocalOnly(){return-1!==n.LOCAL_ONLY_SEARCH_MODES.indexOf(this.searchMode)}getStats(){const e=this.searchConfig.localCacheStore.getOrCreateForUser(this.user);return{numLocalContacts:e.get_contacts_count(),localContactsDownloadedTime:e.get_downloaded_time()}}searchRemoteBatch(e,t){i.WebRequest({url:this.searchConfig.remoteBatchEndpoint,type:"post",subject_user:this.user.id,dataType:"json",data:{queries:JSON.stringify(e)},success:t})}isTeamContact(e){return this.user.is_team&&null!=e.team&&e.team}static isDirectoryRestrictedContact(e,t){const s=!!e.is_directory_restricted,i=t&&t===e.email;return s&&!i}processMatches(e,t,s){const i=[];for(const t of e){s&&(t.nameMatch=l.default.match(s,t.name||""),t.emailMatch=l.default.match(s,t.email||"")),t.on_team=!(t.type===o.default.FB||!this.isTeamContact(t));const e=new a.Contact(t);e.pending=!1;const r=this.excludeDomainContacts&&e.domain_contact,n=this.excludeDirectoryRestrictedContacts&&c.isDirectoryRestrictedContact(e,s);r||n||this.filterFunc&&!this.filterFunc(e)||i.push(e)}return t&&t(i),i}getAll(e){const t=this.searchConfig.localCacheStore.getOrCreateForUser(this.user);if(t.is_loaded()){const t=r.BloodhoundContactsV2.getAll(this.user).map(e=>new a.Contact(e)),s=this.filterFunc?t.filter(this.filterFunc):t;e(s)}else t.load_contacts(!0,t=>{if(t){const s=t.contacts,i=this.filterFunc?s.filter(this.filterFunc):s;e(i)}})}}t.ContactsDataSourceV2=c,c.normalizeQuery=e=>e.trim().toLocaleLowerCase()})),define("metaserver/static/js/contacts/list",["require","exports","tslib","metaserver/static/js/contacts/types"],(function(e,t,s,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=s.__importDefault(i);class r{constructor(e,t){this.filterContacts=this.filterContacts.bind(this),this.length=this.length.bind(this),this.slice=this.slice.bind(this),this.includeForUser=this.includeForUser.bind(this),this.includeForViewer=this.includeForViewer.bind(this),this.excludeByEmail=this.excludeByEmail.bind(this),this.excludeMe=this.excludeMe.bind(this),this.excludeNewStyleGroups=this.excludeNewStyleGroups.bind(this),this.excludeFacebook=this.excludeFacebook.bind(this),this.excludeTeamMembers=this.excludeTeamMembers.bind(this),this.excludePairedUserDuplicates=this.excludePairedUserDuplicates.bind(this),this.excludeNonTeam=this.excludeNonTeam.bind(this),this.excludeNonTeamActive=this.excludeNonTeamActive.bind(this),this.excludeSuspended=this.excludeSuspended.bind(this),this.sortByTeamFirst=this.sortByTeamFirst.bind(this),this._excludeType=this._excludeType.bind(this),this._lowercaseContact=this._lowercaseContact.bind(this),this.contacts=e,this.owningUserId=t,this.lcontacts=Array.from(this.contacts).map(e=>this._lowercaseContact(e))}static create_contacts_list(e){return new r(e,null)}static create_per_user_contacts_list(e,t){return new r(e,t)}filterContacts(e){const t=this.contacts.filter(e);return new r(t,this.owningUserId)}length(){return this.contacts.length}slice(e,t){return new r(this.contacts.slice(e,t),this.owningUserId)}includeForUser(e){if(null!=this.owningUserId)return this.owningUserId===e?this:new r([],e);{const t=this.contacts.filter(t=>t.owning_user_id===e);return new r(t,e)}}includeForViewer(e){const t=e.get_user_ids();return this.filterContacts(e=>Array.from(t).includes(e.owning_user_id))}excludeByEmail(e){return e=e?e.toLowerCase():"",this.filterContacts(t=>!(e===t.email.toLowerCase()))}excludeMe(){return this.filterContacts(e=>!e.is_owner)}excludeNewStyleGroups(){return this._excludeType(i.default.NEW_STYLE_GROUP)}excludeFacebook(){return this._excludeType(i.default.FB)}excludeTeamMembers(){return this.filterContacts(e=>!e.team)}excludePairedUserDuplicates(){return this.filterContacts(e=>!e.paired_user_duplicate)}excludeNonTeam(){return this.filterContacts(e=>e.team)}excludeNonTeamActive(){return this.filterContacts(e=>e.team&&"active"===e.join_state)}excludeSuspended(){return this.filterContacts(e=>"suspended"!==e.join_state)}sortByTeamFirst(){return new r(r.sortContactsByTeamFirst(this.contacts),this.owningUserId)}static sortContactsByTeamFirst(e){const t=[],s=[];for(const i of Array.from(e))i.team?t.push(i):s.push(i);return t.concat(s)}_excludeType(e){return this.filterContacts(t=>t.type!==e)}_lowercaseContact(e){const t={};for(const s in e){let i=e[s];("string"==typeof i||i instanceof String)&&(i=i.toLowerCase()),t[s]=i}return t}}t.default=r})),define("metaserver/static/js/contacts/tokenizer",["require","exports","tslib","classnames","react","prop-types","metaserver/static/js/clean/analytics","metaserver/static/js/avatar/contact_avatar","metaserver/static/js/contacts/config","metaserver/static/js/contacts/contact","metaserver/static/js/contacts/contact_token_state","metaserver/static/js/contacts/data_v2","metaserver/static/js/contacts/typeahead","metaserver/static/js/contacts/types","metaserver/static/js/clean/em_string","metaserver/static/js/clean/tokenizer","metaserver/static/js/validators/validators","metaserver/static/js/core/i18n","dig-components/text_fields","dig-components/buttons","dig-components/icons","dig-components/icons/src","metaserver/static/js/clean/static_urls"],(function(e,t,s,i,r,n,a,o,l,c,d,u,_,p,h,m,f,g,v,y,b,C,S){"use strict";let I,k;Object.defineProperty(t,"__esModule",{value:!0}),t.SLOW_CONTACT_SEARCH_THRESHOLD=t.ContactTokenState=t.ContactTokenValidator=t.ContactsTokenizer=void 0,i=s.__importDefault(i),r=s.__importDefault(r),n=s.__importDefault(n),o=s.__importDefault(o),l=s.__importStar(l),p=s.__importDefault(p),Object.defineProperty(t,"ContactTokenState",{enumerable:!0,get:function(){return d.ContactTokenState}});t.SLOW_CONTACT_SEARCH_THRESHOLD=100;class w extends r.default.Component{constructor(){super(...arguments),this._getTokenName=()=>{switch(this.props.contact.type){case p.default.FB:return"fb_ids";case p.default.EMAIL:return"emails";case p.default.NEW_STYLE_GROUP:return"new_style_group_ids";default:return"invalids"}},this._getTokenValue=()=>{switch(this.props.contact.type){case p.default.FB:return this.props.contact.fb_id;case p.default.NEW_STYLE_GROUP:return this.props.contact.group_id;default:return this.props.contact.email}},this._renderIcon=()=>this.props.contact.type===p.default.FB?r.default.createElement("img",{className:"token-icon",src:(0,S.static_url)("/static/metaserver/static/images/icons/fb_16-vflbiYTkC.png")}):this.props.contact.type===p.default.NEW_STYLE_GROUP||this.props.contact.dbx_account_id||this.props.contact.photo_url?r.default.createElement(o.default,{dimension:16,contact:this.props.contact,optionalClass:"token-icon"}):"",this._renderInput=()=>r.default.createElement("input",{type:"hidden",name:this._getTokenName(),value:this._getTokenValue()}),this._renderText=()=>{const e=this.props.tokenMaxLength||22,t=this.props.contact.name||this.props.contact.email;return h.Emstring.em_snippet(t,e)},this._makeCloseButton=()=>this.props.onRemove?r.default.createElement(y.IconButton,{variant:"transparent",onClick:e=>{e.preventDefault(),e.stopPropagation(),this.props.onRemove(this.props.contact)},size:"small",color:"faint"},r.default.createElement(b.UIIcon,{src:C.CloseLine,size:"small","aria-label":g.intl.formatMessage({id:"eEXkA6",defaultMessage:"Clear contact"})})):""}render(){const e={"tokenizer-token":!0,"contact-token":!0,invalid:this.props.tokenState===d.ContactTokenState.invalid,warned:this.props.tokenState===d.ContactTokenState.warn,pending:this.props.tokenState===d.ContactTokenState.pending};e[this.props.customClass]=null!=this.props.customClass,e[this.props.className]=null!=this.props.className;const t=(0,i.default)(e);return r.default.createElement("a",Object.assign({tabIndex:-1},this.props,{className:t}),this._renderInput(),this._renderIcon(),this._renderText(),this._makeCloseButton())}}w.displayName="ContactsToken",w.propTypes={customClass:n.default.string,className:n.default.string,contact:n.default.object.isRequired,onRemove:n.default.func,tabIndex:n.default.number,tokenState:n.default.string.isRequired,tokenMaxLength:n.default.number};const T={basic(e){const t=e.name&&!e.invalid&&e.email!==e.name;return{state:e.invalid?d.ContactTokenState.invalid:d.ContactTokenState.ok,msg:t?e.email:null}},warn:e=>({state:e.pending?d.ContactTokenState.pending:e.on_team?d.ContactTokenState.ok:e.invalid?d.ContactTokenState.invalid:d.ContactTokenState.warn,msg:null}),forbid:e=>({state:e.pending?d.ContactTokenState.pending:e.on_team?d.ContactTokenState.ok:d.ContactTokenState.invalid,msg:null})};t.ContactTokenValidator=T;class E extends r.default.Component{constructor(e){super(e),this._initContactsDataSource=e=>{const{user:t,customContactFilter:s,excludeDomainContacts:i,customContactsDataSourceFactory:r}=e;return r?r(t,s):new u.ContactsDataSourceV2(t,s,i)},this._validateTokens=(e,t=!1)=>{if((null!=e?e.length:void 0)>0)return(()=>{const s=[];for(const i of Array.from(e))i.type===p.default.EMAIL&&(i.invalid=!(0,f.validateEmail)(i.email)),t?(i.query=i.query||i.email||i.name,s.push(i.pending=!0)):s.push(void 0);return s})()},this.finishLogging=e=>{const t=this.contactsDataSource.getStats().numLocalContacts;if(this._flush_unfinished_queries_cache(),this.props.shouldLogContactSearch)return this.contact_search_logger.log_records(this.props.user.id,e,t)},this._logTokenChangeEvent=(e,t=!1,s={})=>{if(this.contact_search_logger){if(t)return this.contact_search_logger.flag_record_as_removed(e.getContactID());{const t={context:this._getLoggingContext(),contact_type:e.type,contact_id:e.getContactID(),contact_name:e.name,sort_variant:null,event_ts:window.performance.now()};for(I in s)k=s[I],t[I]=k;return this.contact_search_logger.add_record(t)}}},this._logSearchComplete=(e,t,s=!0)=>{if(!this._shouldLogSearch()||!e)return;const i=window.performance.now();let r=this.unfinished_contact_search_queries[e];if(!r)return;const n=r.begin_time;!("ttfr"in r)&&t>0&&(r.ttfr=Math.floor(i-n)),s?(r.local_duration=Math.floor(i-n),r.num_local_results=t):(r.remote_duration=Math.floor(i-n),r.num_additional_remote_results=t),r.num_results+=t;return(()=>this.contactsDataSource.isSearchLocalOnly()&&s||!s)()?(r=this._prepareSearchStatsForLogging(r,e,i,!0),this.contact_search_logger.add_timing_record(r),this.contact_search_logger.count_search(r.is_slow),delete this.unfinished_contact_search_queries[e]):void 0},this._logSearchBegin=e=>{if(!this._shouldLogSearch()||!e)return;const t=window.performance.now();return this._flush_unfinished_queries_cache(t),this.unfinished_contact_search_queries[e]={begin_time:t,num_results:0}},this._shouldLogSearch=()=>this.props.shouldLogContactSearch&&null!=this.contact_search_logger,this._flush_unfinished_queries_cache=e=>{if(this._shouldLogSearch()){null==e&&(e=window.performance.now());for(const t in this.unfinished_contact_search_queries){let s=this.unfinished_contact_search_queries[t];e-s.begin_time<l.CONTACTS_SEARCH_PREEMPTED_THRESHOLD&&(s.is_preempted=!0),s=this._prepareSearchStatsForLogging(s,t,e,!1),this.contact_search_logger.add_timing_record(s),this.contact_search_logger.count_search(s.is_slow)}return this.unfinished_contact_search_queries={}}},this._prepareSearchStatsForLogging=(e,t,s,i)=>{const r=e.begin_time;e.duration=Math.floor(s-r),"ttfr"in e?e.is_slow=e.ttfr>100:i&&0===e.num_results?e.is_slow=!1:e.is_slow=e.duration>100;const n=this.contactsDataSource.getStats().localContactsDownloadedTime;return e.started_before_download=null==n||r<n,"is_preempted"in e||(e.is_preempted=!1),e.context=this._getLoggingContext(),e.query_length=t.length,e.is_finished=i,e},this._getLoggingContext=()=>{let e="react_tokenizer";return null!=this.props.context&&(e+=`_${this.props.context}`),e},this.addExternalContacts=e=>this.refs.tokenizer.addExternalTokens(e),this._renderToken=e=>r.default.createElement(w,{contact:e,tabIndex:this.props.disableAdditionalInput?0:-1,tokenState:this.props.customContactValidator(e).state,tokenMaxLength:this.props.tokenMaxLength}),this._renderTokenHover=e=>this.props.customContactValidator(e).msg,this._autoSelectMatch=(e,t)=>{if(!t||!e)return null;e=this.contactsDataSource.normalizeQuery(e);const s={email:[],name:[]};for(const i of Array.from(t)){const t=i.email?this.contactsDataSource.normalizeQuery(i.email):null,r=i.name?this.contactsDataSource.normalizeQuery(i.name):null;e===t?s.email.push(i):e===r&&s.name.push(i)}for(const e of["email","name"])if(1===s[e].length)return s[e][0];return null},this._queryTokens=(e,t)=>{const s=e.filter(e=>e.pending&&e.query);if(!s.length)return;const i=Array.from(s).map(e=>e.query),r=[],n=s=>{const i=[];e=[];const n=this.serializeInputData(t).tokens;for(const t of Array.from(n)){let n=t;if(t.pending&&t.query){const e=this.contactsDataSource.normalizeQuery(t.query),i=this._autoSelectMatch(e,s[e]);i&&(n=i,r.push(i))}I=n.getKey(),Array.from(i).includes(I)||(i.push(I),e.push(n))}return r.length>0&&Promise.resolve(this._asyncValidateContacts(r)),t.replaceTokens(e)},a=n,o=n;return this.contactsDataSource.searchBatch(i,a,o)},this.tokenizeEmails=(e,t=!1)=>{let s;const i=/[,|;\n]+/,r=e.split(/[,|;\n ]+/);2===r.length&&(0,f.validateEmail)(r[0]+r[1])?(s=[r[0]+r[1]],t=!0):s=2===r.length&&(0,f.validateEmail)(r[0])&&""===r[1]?r:e.split(i);let n="";t||(n=s.pop());const a=[];for(const e of Array.from(s)){const t=e.trim();""!==t&&a.push(new c.Contact({name:t,email:t,type:p.default.EMAIL,invalid:!(0,f.validateEmail)(t),on_team:!1,pending:!0,query:t}))}return Promise.resolve(this._asyncValidateContacts(a)),{tokens:a,value:n}},this._asyncValidateContacts=e=>s.__awaiter(this,void 0,void 0,(function*(){this.props.asyncValidateContacts&&e.length>0&&(yield this.props.asyncValidateContacts(e))})),this._postSelect=e=>{this._asyncValidateContacts([e])},this.getInputValue=e=>(e||this.refs.tokenizer).getInputValue(),this.getContacts=()=>{const{tokens:e,value:t}=this.serializeInputData(),s=this.tokenizeEmails(t,!0);return e.concat(s.tokens)},this.removeAllTokens=()=>{const{tokens:e}=this.serializeInputData();this.refs.tokenizer.removeTokens(e)},this.tokenizeAll=()=>this.refs.tokenizer.tokenizeAll(),this.serializeInputData=this.serializeInputData.bind(this)}componentWillReceiveProps(e){e.user===this.props.user&&e.customContactFilter.toString()===this.props.customContactFilter.toString()||(this.contactsDataSource=this._initContactsDataSource(e)),this._validateTokens(null!=e.populatedInputData?e.populatedInputData.tokens:void 0)}componentWillMount(){this.contactsDataSource=this._initContactsDataSource(this.props),this._validateTokens(null!=this.props.populatedInputData?this.props.populatedInputData.tokens:void 0,!0)}componentDidMount(){const{shouldLogContactSearch:e,populatedInputData:t,onContentsChange:s}=this.props;if(e&&(this.contact_search_logger=new a.ContactSearchLogger(this._getLoggingContext(),this.contactsDataSource.searchModeName),this.unfinished_contact_search_queries={}),t.tokens&&t.tokens.length||t.value&&t.value.length){const{tokens:e,value:t}=this.serializeInputData();"function"==typeof s&&s(e,t)}}render(){return r.default.createElement(m.Tokenizer,{ref:"tokenizer",dataSource:this.contactsDataSource,customClass:this.props.customClass,initialInputText:this.props.populatedInputData.value,placeholderText:this.props.placeholder,renderSelector:()=>r.default.createElement(_.ContactsTypeaheadSelector,{showContactImport:this.props.showContactImport,teamGroupInfo:this.props.teamGroupInfo,user:this.props.user,listHeight:this.props.listHeight}),renderInput:()=>r.default.createElement(v.TextArea,{className:"contacts-tokenizer-input",id:this.props.id,rows:1,"aria-labelledby":`${this.props.label} ${this.props.id}`}),renderToken:this._renderToken,renderTokenHover:this._renderTokenHover,onContentsChange:this.props.onContentsChange,onTokensAdd:this._queryTokens,stringTokenizer:this.tokenizeEmails,populatedTokenData:this.props.populatedInputData.tokens,tabIndex:this.props.tabIndex,tokenSpacing:this.props.tokenSpacing,focusOnMount:this.props.focusOnMount,logSearchBegin:this._logSearchBegin,logSearchComplete:this._logSearchComplete,logTokenChangeEvent:this._logTokenChangeEvent,disableAdditionalInput:this.props.disableAdditionalInput,disabled:this.props.disabled,resetTokenData:this.props.resetTokenData,tokenizeOnOutOfFocus:this.props.tokenizeOnOutOfFocus,postSelect:this._postSelect,validatedTokenMap:this.props.validatedContactMap},this.props.children)}serializeInputData(e){return(e=e||this.refs.tokenizer).serializeInputData()}}t.ContactsTokenizer=E,E.displayName="ContactsTokenizer",E.propTypes={user:n.default.object.isRequired,context:n.default.string,customClass:n.default.string,customContactFilter:n.default.func,excludeDomainContacts:n.default.bool,customContactValidator:n.default.func,focusOnMount:n.default.bool,id:n.default.string,label:n.default.string,onContentsChange:n.default.func,placeholder:n.default.string,populatedInputData:n.default.shape({tokens:n.default.array,value:n.default.string}),tabIndex:n.default.number,showContactImport:n.default.bool,shouldLogContactSearch:n.default.bool,teamGroupInfo:n.default.shape({id:n.default.string,name:n.default.string}),tokenSpacing:n.default.number,disableAdditionalInput:n.default.bool,disabled:n.default.bool,resetTokenData:n.default.bool,customContactsDataSourceFactory:n.default.func,listHeight:n.default.number,tokenizeOnOutOfFocus:n.default.bool,asyncValidateContacts:n.default.func,validatedContactMap:n.default.object,tokenMaxLength:n.default.number},E.defaultProps={customContactFilter:e=>!0,customContactValidator:T.basic,excludeDomainContacts:!0,focusOnMount:!1,id:null,placeholder:g.intl.formatMessage({id:"dpTWyj",defaultMessage:"Invite more people"}),populatedInputData:{tokens:[],value:""},tokenSpacing:4,showContactImport:!1,shouldLogContactSearch:!1,teamGroupInfo:null,disableAdditionalInput:!1,disabled:!1,resetTokenData:!1,tokenizeOnOutOfFocus:!1,asyncValidateContacts:null,validatedContactMap:null,tokenMaxLength:22}})),define("metaserver/static/js/contacts/typeahead",["require","exports","tslib","classnames","create-react-class","react","prop-types","lodash","metaserver/static/js/avatar/contact_avatar","metaserver/static/js/contacts/types","metaserver/static/js/contacts/util","metaserver/static/js/css/css","metaserver/static/js/clean/em_string","metaserver/static/js/profile_services/popup_handler","metaserver/static/js/profile_services/profile_services_constants","metaserver/static/js/profile_services/profile_services_link","metaserver/static/js/clean/ui/flag","metaserver/static/js/clean/ui/image","metaserver/static/js/clean/ui/paging_list","metaserver/static/js/clean/ui/sprite","metaserver/static/js/clean/ui/title_bubble","metaserver/static/js/clean/static_urls","metaserver/static/js/clean/typeahead","metaserver/static/js/core/assert","metaserver/static/js/core/i18n","metaserver/static/js/core/notify","metaserver/static/js/clean/ui/sticky_position"],(function(e,t,s,i,r,n,a,o,l,c,d,u,_,p,h,m,f,g,v,y,b,C,S,I,k,w,T){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ThirdPartyImportOption=t.ExpandImportOption=t.ContactsTypeaheadSelectorOption=t.ContactsTypeaheadSelector=void 0,i=s.__importDefault(i),r=s.__importDefault(r),n=s.__importDefault(n),a=s.__importDefault(a),o=s.__importStar(o),l=s.__importDefault(l),c=s.__importDefault(c),d=s.__importDefault(d),u=s.__importStar(u),h=s.__importDefault(h),f=s.__importStar(f),v=s.__importDefault(v);const E=(e,t)=>o.assignIn({},e,t),A=E(S.TypeaheadSelectorMixin,{getOptions(){if(null==this.props.queryOptions)return[];if(this.state.importsExpanded)return Array.from(h.default.importable_contact_services()).map(e=>new L({provider:e,connected:this.profile_services.service_is_connected(e)}));const e=this.props.queryOptions.slice();return this.props.teamGroupInfo?e.push(d.default.teamGroupInfoToContact(this.props.teamGroupInfo)):(null!=this.profile_services?this.profile_services.has_unconnected_services(!0):void 0)&&e.push(new D),e},renderOption(e){return e instanceof D?n.default.createElement(P,null):e instanceof L?n.default.createElement(x,{import:e}):this.props.renderQueryOption(e)},onSelect(e){if(e instanceof D)return this._changeSelectionIndex(0),this.setState({importsExpanded:!0});if(e instanceof L){let t;if((0,I.assert)((t=e.provider,Array.from(h.default.importable_contact_services()).includes(t)),`invalid party contact provider ${e.provider}`),this.profile_services.service_is_connected(e.provider)){const t=k.intl.formatMessage({id:"68wybz",defaultMessage:"You're already connected to {service_name}"},{service_name:h.default.to_name(e.provider)});return void w.Notify.success(t)}return this.link_handler.auth_service_with_user(e.provider,this.props.user.id,e=>m.ProfileServicesLinkingHandler.show_import_notifications(e))}return this.props.onSelect(e)},reset(){return this._changeSelectionIndex(0),this.setState({importsExpanded:!1})}}),R=(0,r.default)({displayName:"ContactsTypeaheadSelector",mixins:[A],propTypes:{customClass:a.default.string,onSelect:a.default.func.isRequired,queryOptions:a.default.array,renderQueryOption:a.default.func.isRequired,showContactImport:a.default.bool,teamGroupInfo:a.default.shape({id:a.default.string,name:a.default.string}),user:a.default.object.isRequired,listHeight:a.default.number},componentWillMount(){if(this.link_handler=new m.ProfileServicesLinkingHandler,this.profile_services=null,null===this.props.teamGroupInfo&&this.props.showContactImport&&null!=this.props.user)return this.profile_services=m.LinkedProfileServices.get_linked_profile_services_for_user(this.props.user.id)},componentWillReceiveProps(e){return 0===(null!=e.queryOptions?e.queryOptions.length:void 0)?this._changeSelectionIndex(-1):(null!=e.queryOptions?e.queryOptions.length:void 0)>0&&-1===this.state.selectionIndex?this._changeSelectionIndex(0):void 0},shouldComponentUpdate(e,t){return!o.isEqual(e,this.props)||!o.isEqual(t,this.state)},getDefaultProps:()=>({showContactImport:!1,teamGroupInfo:null,onSelect(e){},renderQueryOption:e=>n.default.createElement(M,{contact:e})}),onSelectionIndexChange(e){return null!=this.refs.pagingList?this.refs.pagingList.scrollAround(e):void 0},render(){if(u.require_css("/static/metaserver/static/css/react/contacts_typeahead-vflS2VeQH.css"),!this.getOptions().length)return n.default.createElement("div",null);const e={"typeahead-selector":!0,"contacts-selector":!0};e[this.props.customClass]=null!=this.props.customClass;const{listHeight:t}=this.props;return n.default.createElement(v.default,{customClass:(0,i.default)(e),pageSize:4,itemSize:54,ref:"pagingList",listHeight:t},this.renderOptions())}});t.ContactsTypeaheadSelector=R;class M extends n.default.Component{constructor(){super(...arguments),this._renderPrimary=()=>this._renderMatch(this.props.contact.name,this.props.contact.nameMatch),this._renderSecondary=()=>{switch(this.props.contact.type){case c.default.EMAIL:return this.props.contact.email===this.props.contact.name?"":this._renderMatch(this.props.contact.email,this.props.contact.emailMatch);case c.default.FB:return k.intl.formatMessage({id:"k5ONol",defaultMessage:"Facebook message"});case c.default.NEW_STYLE_GROUP:return this.props.contact.members;default:return""}},this._renderMatch=(e,t)=>{if(e&&(e=_.Emstring.em_snippet(e,22)),!t)return e;const s=e.indexOf("â€¦");let i=0;const r=[];for(const[a,o]of Array.from(t.highlighted)){a>i&&r.push(e.slice(i,a));let t=a+o;t>s&&-1!==s&&(t=s);const l=e.slice(a,t);r.push(n.default.createElement("strong",{key:`highlight-${l}-${a}`},l)),i=t}return i<e.length&&r.push(e.slice(i)),r},this._renderIcon=()=>n.default.createElement("div",{className:"u-pad-right-xs"},n.default.createElement(l.default,{dimension:32,contact:this.props.contact,optionalClass:"contact-icon"})),this._renderDomainTooltip=()=>n.default.createElement("div",{className:"u-pad-right-xs"},n.default.createElement(b.TitleBubble,{content:k.intl.formatMessage({id:"r+IKuD",defaultMessage:"Suggested contact from your domain"}),position:T.StickyPosition.BOTTOM},n.default.createElement(y.Sprite,{group:"web",name:"info",alt:k.intl.formatMessage({id:"0BRgfC",defaultMessage:"Domain contact"})})))}render(){let e;e={"contacts-typeahead-option":!0},e[this.props.customClass]=null!=this.props.customClass,null!=this.props.className&&(e[this.props.className]=!0);let t={primary:this._renderPrimary(),secondary:this._renderSecondary()};return t=o.pickBy(t,e=>""!==e),n.default.createElement("li",Object.assign({},E(this.props,{className:(0,i.default)(e)})),n.default.createElement(f.Flag,{leftAttachment:this._renderIcon(),rightAttachment:this.props.contact.domain_contact?this._renderDomainTooltip():void 0},(()=>{const s=[];for(const r in t){const a=t[r];e={"option-only":1===o.size(t)},e[`option-${r}`]=!0,s.push(n.default.createElement("div",{className:(0,i.default)(e),key:`option-${r}`},a))}return s})()))}}t.ContactsTypeaheadSelectorOption=M,M.displayName="ContactsTypeaheadSelectorOption",M.propTypes={contact:a.default.object.isRequired,customClass:a.default.string};class D{constructor(){}getKey(){return"expand-importer"}}class P extends n.default.Component{render(){const e={"expand-imports-option":!0,"contacts-typeahead-option":!0};return null!=this.props.className&&(e[this.props.className]=!0),n.default.createElement("li",Object.assign({},E(this.props,{className:(0,i.default)(e)})),n.default.createElement(f.Flag,{leftAttachment:n.default.createElement(g.Image,{className:"u-pad-right-xs",src:(0,C.static_url)("/static/metaserver/static/images/icons/icon-import-vflOL9sCs.png"),srcHiRes:(0,C.static_url)("/static/metaserver/static/images/icons/icon-import@2x-vfluE8TBO.png")})},n.default.createElement("div",{className:"option-primary option-only"},k.intl.formatMessage({id:"Zq8VvX",defaultMessage:"Import contacts"}))))}}t.ExpandImportOption=P,P.displayName="ExpandImportOption";class L{constructor({provider:e,connected:t}){this.provider=e,this.connected=t}getKey(){return`third-party-import${this.provider}`}}class x extends n.default.Component{constructor(){super(...arguments),this.state={showSpinner:!1},this.show_contact_import_spinner=e=>{if(this.props.import.provider===e.provider)return this.setState({showSpinner:!0})}}componentDidMount(){return this.authCompleteListenerToken=(0,p.addAuthCompleteListener)(this.show_contact_import_spinner)}componentWillUnmount(){return(0,p.removeAuthCompleteListener)(this.authCompleteListenerToken)}render(){const{provider:e,connected:t}=this.props.import;let s=h.default.to_name(e);!t&&this.state.showSpinner&&(s=k.intl.formatMessage({id:"95l3d4",defaultMessage:"Importing {service_name} Contacts"},{service_name:s}));const r=t?k.intl.formatMessage({id:"wvm3tI",defaultMessage:"Connected"}):"",a={"third-party-option":!0,"contacts-typeahead-option":!0};return null!=this.props.className&&(a[this.props.className]=!0),n.default.createElement("li",Object.assign({},E(this.props,{className:(0,i.default)(a)})),!t&&this.state.showSpinner?n.default.createElement("div",{className:"option-spinner"},n.default.createElement("img",{src:(0,C.static_url)("/static/metaserver/static/images/icons/ajax-loading-small-blue-vflVk_QNP.gif")})):void 0,n.default.createElement(f.Flag,{spacing:"xs",leftAttachment:n.default.createElement(g.Image,{alt:"",src:(0,C.static_url)(h.default.to_img_legacy(e)[0]),srcHiRes:(0,C.static_url)(h.default.to_img_legacy(e)[1])})},n.default.createElement("div",{className:(0,i.default)({"option-primary":!0,"option-only":!t})},s,t?n.default.createElement("div",{className:"option-secondary u-font-meta"},r):void 0)))}}t.ThirdPartyImportOption=x,x.displayName="ThirdPartyImportOption",x.propTypes={import:a.default.object.isRequired}})),define("metaserver/static/js/contacts/types",["require","exports"],(function(e,t){"use strict";var s;Object.defineProperty(t,"__esModule",{value:!0}),(function(e){e[e.EMAIL=0]="EMAIL",e[e.FB=1]="FB",e[e.INVALID_ID=2]="INVALID_ID",e[e.NEW_STYLE_GROUP=4]="NEW_STYLE_GROUP",e[e.DBX_ID=5]="DBX_ID"})(s||(s={})),t.default=s})),define("metaserver/static/js/contacts/util",["require","exports","tslib","metaserver/static/js/contacts/contact","metaserver/static/js/contacts/types"],(function(e,t,s,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r=s.__importDefault(r);t.default=class{static activityUserToContact(e,t=0){return{dbx_account_id:e.unique_id,fname:e.fname,lname:e.lname,name:e.display_name,name_tokens:[e.fname,e.lname],email:e.email,type:r.default.DBX_ID,priority:t,photo_url:e.photo_circle_url}}static teamGroupInfoToContact(e){return new i.Contact({group_id:e.id,group_size:e.group_size,type:r.default.NEW_STYLE_GROUP,name:e.name,on_team:!0,pending:!1})}}})),define("metaserver/static/js/clean/ui/calendar",["require","exports","tslib","classnames","spectrum/dropdown_button/index","react","react-dom","metaserver/static/js/datetime/datetime","metaserver/static/js/components/ui/css","metaserver/static/js/clean/ui/sprite","metaserver/static/js/core/i18n"],(function(e,t,s,i,r,n,a,o,l,c,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Calendar=t.CalendarView=t.CalendarComponent=void 0,i=s.__importDefault(i),n=s.__importDefault(n),a=s.__importStar(a),o=s.__importStar(o);const u=37,_=38,p=39,h=40,m=()=>{};let f=0;const g=(e=new Date)=>{const t=new Date(e.getTime());t.setFullYear(t.getFullYear()-1);const s=new Date(e.getTime());return s.setFullYear(s.getFullYear()+1),{disabled:!1,isMaestroDesign:!1,firstDay:t,lastDay:s,alignAtLeft:!0,onDateChange:m,calendarIsInitiallyVisible:!1}};class v extends n.default.Component{constructor(){super(...arguments),this.state={currentDate:this.props.initDate,calendarIsVisible:this.props.calendarIsInitiallyVisible},this.setCalendarDateViewRef=e=>{this.refCalendarDateView=a.findDOMNode(e)},this.setCalendarViewRef=e=>{this.refCalendarView=a.findDOMNode(e)},this._handleDocumentClick=e=>{if(this.refCalendarView&&this.refCalendarDateView){const t=e.target;!this.state.calendarIsVisible||this.refCalendarView.contains(t)||this.refCalendarDateView.contains(t)||(e.preventDefault(),e.stopPropagation(),this.closeCalendar())}},this.toggleCalendarView=()=>{this.setState({calendarIsVisible:!this.state.calendarIsVisible})},this.handleDateSelected=e=>{this.setState({currentDate:e}),this.props.onDateChange(e),this.closeCalendar()},this.closeCalendar=()=>{this.setState({calendarIsVisible:!1}),this.refCalendarDateView&&this.refCalendarDateView.focus(),this.props.onCalendarClose&&this.props.onCalendarClose()},this._startOfDay=e=>{const t=new Date(e.getTime());return t.setHours(0),t.setMinutes(0),t.setSeconds(0),t.setMilliseconds(0),t},this._getDateViewText=()=>{const e=e=>o.format_date(e,o.localized_date_format);return this.props.placeholderText&&!this.props.initDate?this.props.placeholderText:this.state.currentDate?e(this.state.currentDate):e(new Date)}}componentDidMount(){document.addEventListener("click",this._handleDocumentClick)}componentWillUnmount(){document.removeEventListener("click",this._handleDocumentClick)}render(){const e={"c-datepicker":!0,"scooter-css u-l-fl clearfix":!this.props.isMaestroDesign};let t;return this.state.calendarIsVisible&&(t=n.default.createElement(C,{ref:this.setCalendarViewRef,alignAtLeft:this.props.alignAtLeft,firstDay:this._startOfDay(this.props.firstDay),lastDay:this._startOfDay(this.props.lastDay),initDate:this.state.currentDate||new Date,onDateChange:this.handleDateSelected,onCalendarClose:this.props.onCalendarClose,onEscapePressed:this.closeCalendar})),n.default.createElement("div",{className:(0,i.default)(e)},n.default.createElement(b,{buttonText:this._getDateViewText(),ref:this.setCalendarDateViewRef,calendarVisible:this.state.calendarIsVisible,disabled:this.props.disabled,isMaestroDesign:this.props.isMaestroDesign,onClick:this.toggleCalendarView,label:this.props.label,id:this.props.id}),t)}}function y(e,t){return e.getDate()===t.getDate()&&e.getMonth()===t.getMonth()&&e.getFullYear()===t.getFullYear()}t.CalendarComponent=v,v.displayName="Calendar",v.__updateDefaultProps=e=>{v.defaultProps=g(e)},v.defaultProps=g();class b extends n.default.Component{constructor(){super(...arguments),this.renderLegacyCaret=()=>n.default.createElement(c.Sprite,{group:"web",name:"calendar_view_month",className:"u-l-fr",alt:this.props.description})}render(){const e={"is-active":this.props.calendarVisible,"c-input":!this.props.isMaestroDesign,"filter-item__filter-input":this.props.isMaestroDesign};if(this.props.isMaestroDesign)return n.default.createElement(r.DropdownButton,{disabled:this.props.disabled,onClick:this.props.onClick,"aria-expanded":this.props.calendarVisible,id:this.props.id,"aria-labelledby":`${this.props.label} ${this.props.id}`},this.props.buttonText);{const t=n.default.createElement("span",{className:"c-calendar__date-text"},this.props.buttonText);return n.default.createElement("button",{className:(0,i.default)(e),disabled:this.props.disabled,onClick:this.props.onClick,"aria-expanded":this.props.calendarVisible,id:this.props.id,"aria-labelledby":`${this.props.label} ${this.props.id}`},this.renderLegacyCaret(),t)}}}b.displayName="CalendarDateView",b.defaultProps={isMaestroDesign:!1,calendarVisible:!0,onClick:()=>{},disabled:!1,description:d.intl.formatMessage({id:"iOUGcl",defaultMessage:"Change deadline"})};class C extends n.default.Component{constructor(e){super(e),this.state={viewDate:this.props.initDate,currentlyActiveDate:this.props.initDate},this.clampToFirstLastDate=e=>{e<this.props.firstDay?e.setTime(this.props.firstDay.getTime()):e>this.props.lastDay&&e.setTime(this.props.lastDay.getTime())},this.getDaysInMonth=e=>new Date(e.getFullYear(),e.getMonth()+1,0).getDate(),this.setPrevMonthButtonRef=e=>{this.refPrevButton=e},this.setNextMonthButtonRef=e=>{this.refNextButton=e},this.setCurrentDayButtonRefAndMaintainFocus=e=>{const t=document.activeElement&&document.activeElement.getAttribute("data-day-in-month");this.refCurrentDayButton=e,this.refCurrentDayButton&&t&&this.refCurrentDayButton.focus()},this.handleDayClicked=e=>{const t=e.target,s=parseInt(t.getAttribute("data-day-in-month")||"",10),i=new Date(this.state.viewDate.getFullYear(),this.state.viewDate.getMonth(),s);this.setState({currentlyActiveDate:i}),this.props.onDateChange(i)},this.handleKeyDownOnDay=e=>{if(27===e.which)return this.props.onEscapePressed(),void e.preventDefault();if(9===e.which){let t;const s=this.refNextButton.classList.contains("u-l-dn")?null:this.refNextButton,i=this.refPrevButton.classList.contains("u-l-dn")?null:this.refPrevButton;return t=e.shiftKey?s||i:i||s,t&&t.focus(),void e.preventDefault()}if(-1!==[_,p,h,u].indexOf(e.which)){const t=1,s=this.getDaysInMonth(this.props.initDate),i=(this.state.currentlyActiveDate||this.props.initDate).getDate();let r=null;switch(e.which){case _:r=Math.max(t,i-7);break;case p:r=Math.min(s,i+1);break;case h:r=Math.min(s,i+7);break;case u:r=Math.max(t,i-1)}if(null!=r){const e=new Date(this.state.viewDate.getTime());e.setDate(r),this.clampToFirstLastDate(e),this.setState({currentlyActiveDate:e})}e.preventDefault()}},this.renderDay=(e,t)=>{const s=!t;this.props.lastDay&&(t=t||e>this.props.lastDay),this.props.firstDay&&(t=t||e<this.props.firstDay);const r=y(this.state.currentlyActiveDate,e),a={"button-as-link":!t,"c-calendar__date":!0,"c-calendar__date--disabled":t,"current-month":s,"c-calendar__date--was-initially-active":y(this.props.initDate,e),"c-calendar__date--is-active":r};let o=m;y(this.state.currentlyActiveDate,e)&&(o=this.setCurrentDayButtonRefAndMaintainFocus);const l=`day${e.getDate()}-${e.getMonth()}`,c=d.intl.formatDate(e,{year:"numeric",month:"long",day:"numeric"});return n.default.createElement("td",{key:l},n.default.createElement("button",{className:(0,i.default)(a),disabled:t,onClick:t?void 0:this.handleDayClicked,onKeyDown:this.handleKeyDownOnDay,"data-day-in-month":e.getDate(),"aria-label":c,ref:o},e.getDate()))},this.renderDays=()=>{const e=[],t=new Date(this.state.viewDate.getFullYear(),this.state.viewDate.getMonth(),1);for(let s=t.getDay();s>0;s--){const i=new Date(t.getFullYear(),t.getMonth(),t.getDate());i.setDate(i.getDate()-s),e.push(this.renderDay(i,!0))}let s=new Date(this.state.viewDate.getFullYear(),this.state.viewDate.getMonth(),1);for(;s.getMonth()===this.state.viewDate.getMonth();)e.push(this.renderDay(s)),s=new Date(this.state.viewDate.getFullYear(),this.state.viewDate.getMonth(),s.getDate()+1);let i=new Date(this.state.viewDate.getFullYear(),this.state.viewDate.getMonth()+1,0);for(;6!==i.getDay();)i=new Date(i.getFullYear(),i.getMonth(),i.getDate()+1),e.push(this.renderDay(i,!0));const r=[];let a=[];return e.forEach((e,t)=>{a.push(e),(t+1)%7==0&&(r.push(n.default.createElement("tr",{key:`week-${t}`},a)),a=[])}),r},this.offsetViewDateByMonth=e=>{this.setState({viewDate:new Date(this.state.viewDate.getFullYear(),this.state.viewDate.getMonth()+e,1)})},this.handleClickNextMonth=()=>{this.offsetViewDateByMonth(1)},this.handleClickPrevMonth=()=>{this.offsetViewDateByMonth(-1)},this.handleKeyDownMonthButton=e=>{if(27===e.which)return this.props.onEscapePressed(),void e.preventDefault();if(9===e.which){const t=!e.shiftKey;let s;const i=this.refNextButton.classList.contains("u-l-dn")?null:this.refNextButton,r=this.refPrevButton.classList.contains("u-l-dn")?null:this.refPrevButton,n=this.refCurrentDayButton;s=e.target===this.refPrevButton?t?i||n:n||i:t?n||r:r||n,s&&s.focus(),e.preventDefault()}},this.renderMonthChangers=()=>{const e=[],t=new Date(this.state.viewDate.getFullYear(),this.state.viewDate.getMonth(),1),s=new Date(this.state.viewDate.getFullYear(),this.state.viewDate.getMonth(),this.getDaysInMonth(this.state.viewDate)),r={"arrow-select":!0,"u-l-dn":t<=this.props.firstDay,"ax-focusable":!0,"u-l-fl":!0};e.push(n.default.createElement("button",{className:(0,i.default)(r),onClick:this.handleClickPrevMonth,ref:this.setPrevMonthButtonRef,onKeyDown:this.handleKeyDownMonthButton},n.default.createElement("span",{className:"c-arrow c-arrow--left u-thide"},d.intl.formatMessage({id:"RqKZIV",defaultMessage:"Previous month"}))));const a={"arrow-select":!0,"u-l-dn":s>=this.props.lastDay,"ax-focusable":!0,"u-l-fr":!0};return e.push(n.default.createElement("button",{className:(0,i.default)(a),onClick:this.handleClickNextMonth,ref:this.setNextMonthButtonRef,onKeyDown:this.handleKeyDownMonthButton},n.default.createElement("span",{className:"c-arrow c-arrow--right u-thide"},d.intl.formatMessage({id:"ir988d",defaultMessage:"Next month"})))),e},this.renderWeekdayRows=()=>[d.intl.formatMessage({id:"vF3QRb",defaultMessage:"Sunday"}),d.intl.formatMessage({id:"ky7rEH",defaultMessage:"Monday"}),d.intl.formatMessage({id:"QuQ7YS",defaultMessage:"Tuesday"}),d.intl.formatMessage({id:"Vla5t5",defaultMessage:"Wednesday"}),d.intl.formatMessage({id:"dgMd35",defaultMessage:"Thursday"}),d.intl.formatMessage({id:"0WboRK",defaultMessage:"Friday"}),d.intl.formatMessage({id:"FwY8UG",defaultMessage:"Saturday"})].map(e=>n.default.createElement("th",{key:e},n.default.createElement("abbr",{title:e},e.slice(0,3)))),this.calendarId=++f}componentDidMount(){this.refCurrentDayButton&&this.refCurrentDayButton.focus()}UNSAFE_componentWillUpdate(e,t){if(t.viewDate&&t.viewDate.getMonth()!==this.state.viewDate.getMonth()){const e=new Date(t.viewDate.getTime()),s=this.getDaysInMonth(t.viewDate);e.setDate(Math.min(s,this.state.currentlyActiveDate.getDate())),this.clampToFirstLastDate(e),this.setState({currentlyActiveDate:e})}}render(){const e={"c-calendar":!0,"c-card":!0,"u-pad-xs":!0,"u-left":this.props.alignAtLeft,"u-right":!this.props.alignAtLeft},t=`calendar-header-${++this.calendarId}`,[s,r]=this.renderMonthChangers(),a=n.default.createElement("strong",{id:t,"aria-live":"assertive","aria-atomic":"true"},d.intl.formatDate(this.state.viewDate,{year:"numeric",month:"long"}));return n.default.createElement("div",{className:(0,i.default)(e)},n.default.createElement("div",{className:"c-calendar__nav u-mar-bottom-s u-font-center u-cf"},s,r,a),n.default.createElement("table",{className:"c-calendar__picker"},n.default.createElement("thead",{className:"ax-visually-hidden"},n.default.createElement("tr",null,this.renderWeekdayRows())),n.default.createElement("tbody",null,this.renderDays())))}}t.CalendarView=C,C.displayName="CalendarView",C.defaultProps={onDateChange:m,onEscapePressed:m,alignAtLeft:!1},t.Calendar=(0,l.requireCssWithComponent)(v,["/static/metaserver/static/css/scooter/scooter-scoped-vflhkBqI_.css","/static/metaserver/static/css/components/calendar-vflL_rFOa.css"])})),define("metaserver/static/js/pass/constants",["require","exports"],(function(e,t){"use strict";var s;Object.defineProperty(t,"__esModule",{value:!0}),t.EMPTY_FACEPILE_CLASSNAME=t.PRESENCE_RECEIVED_CLASSNAME=t.FACEPILE_CLASSNAME=t.MAX_OVERFLOW_BUTTON_INDICATOR=t.MAX_FACES_NORMAL=t.fetchingStatusIsError=t.fetchingStatusIsComplete=t.fetchingStatusIsSuccessful=t.fetchingStatusCanLogAsShown=t.fetchingStatusSeenStateIsComplete=t.PassPlatform=t.PassFetchingStatus=t.LoggingActions=t.EventTypes=t.ActionTypes=void 0,t.ActionTypes={PASS_PERMISSION_REQUEST:"PASS_PERMISSION_REQUEST",UPDATE_PERMISSIONS:"UPDATE_PERMISSIONS",FETCH_PASS_CONCLUDED:"FETCH_PASS_CONCLUDED",FETCH_PASS_ERROR:"FETCH_PASS_ERROR",UPDATE_USER_TEAM_INTERACTION_INFO:"UPDATE_USER_TEAM_INTERACTION_INFO",RECEIVE_PRESENCE_DELTA:"RECEIVE_PRESENCE_DELTA",RECEIVE_PRESENCE_SNAPSHOT:"RECEIVE_PRESENCE_SNAPSHOT",RESET_PASS_INFO:"RESET_PASS_INFO",UPDATE_SEEN_STATE_INFO:"UPDATE_SEEN_STATE_INFO",UPDATE_SEEN_STATE_INFO_CONTINUE:"UPDATE_SEEN_STATE_INFO_CONTINUE",DISCONTINUE_SEEN_STATE_INFO:"DISCONTINUE_SEEN_STATE_INFO",UPDATE_SEEN_STATE_UNAVAILABLE:"FETCH_SEEN_STATE_UNAVAILABLE"},t.EventTypes={PASS_CLICK:"PASS_CLICK",PASS_SHOWN:"PASS_SHOWN",PASS_HOVER:"PASS_HOVER"},t.LoggingActions={SEEN_STATE_BEGIN:"seen_state_begin",SEEN_STATE_RECEIVE:"seen_state_receive",SEEN_STATE_USERS_BEGIN:"seen_state_users_begin",SEEN_STATE_USERS_RECEIVE:"seen_state_users_receive",TRANSMITTER_TOKEN_BEGIN:"transmitter_token_begin",TRANSMITTER_TOKEN_RECEIVE:"transmitter_token_receive",RECEIVER_TOKEN_BEGIN:"receiver_token_begin",RECEIVER_TOKEN_RECEIVE:"receiver_token_receive",PRESENCE_RECEIVE:"presence_receive",MEMBER_COUNTS_BEGIN:"member_counts_begin",MEMBER_COUNTS_RECEIVE:"member_counts_receive",LIST_MEMBERS_BEGIN:"list_members_begin",LIST_MEMBERS_RECEIVE:"list_members_receive"},(function(e){e[e.NOT_YET_KNOWN=0]="NOT_YET_KNOWN",e[e.FETCHING=1]="FETCHING",e[e.ERROR=2]="ERROR",e[e.SEEN_STATE_SUCCESS=3]="SEEN_STATE_SUCCESS",e[e.SEEN_STATE_DISALLOWED=4]="SEEN_STATE_DISALLOWED",e[e.PRESENCE_SUCCESS=5]="PRESENCE_SUCCESS",e[e.PASS_SUCCESS=6]="PASS_SUCCESS",e[e.PASS_MIXED_SUCCESS=7]="PASS_MIXED_SUCCESS",e[e.CONCLUDED=8]="CONCLUDED"})(s=t.PassFetchingStatus||(t.PassFetchingStatus={})),(function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.WEB=1]="WEB",e[e.MOBILE=2]="MOBILE",e[e.DESKTOP=3]="DESKTOP"})(t.PassPlatform||(t.PassPlatform={})),t.fetchingStatusSeenStateIsComplete=function(e){return-1!==[s.SEEN_STATE_SUCCESS,s.SEEN_STATE_DISALLOWED,s.PASS_SUCCESS,s.PASS_MIXED_SUCCESS,s.CONCLUDED].indexOf(e)},t.fetchingStatusCanLogAsShown=function(e){return e===s.PASS_SUCCESS||e===s.PASS_MIXED_SUCCESS},t.fetchingStatusIsSuccessful=function(e){return-1!==[s.PASS_SUCCESS,s.PASS_MIXED_SUCCESS,s.CONCLUDED].indexOf(e)},t.fetchingStatusIsComplete=function(e){return-1!==[s.PASS_SUCCESS,s.PASS_MIXED_SUCCESS,s.ERROR,s.CONCLUDED].indexOf(e)},t.fetchingStatusIsError=function(e){return e===s.ERROR},t.MAX_FACES_NORMAL=5,t.MAX_OVERFLOW_BUTTON_INDICATOR=99,t.FACEPILE_CLASSNAME="react-pass__facepile",t.PRESENCE_RECEIVED_CLASSNAME="facepile-presence-received",t.EMPTY_FACEPILE_CLASSNAME="react-pass__facepile--empty"})),define("metaserver/static/js/pass/utils",["require","exports","tslib","lodash","metaserver/static/js/pass/constants","metaserver/static/js/core/user_i18n","metaserver/static/js/core/browser","metaserver/static/js/core/uri"],(function(e,t,s,i,r,n,a,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.navigateToSuggestModal=t.navigateToInviteModal=t.shouldIncrementOverflowBasisForAccessType=t.parsePlatformString=t.AnonymousViewerUtils=void 0,i=s.__importStar(i),n=s.__importStar(n),a=s.__importStar(a),(function(e){function t(e){return e.startsWith("dbafvid:")}e.isAnonymousUserId=t,e.isAnonymousSeenState=function(e){return t(e.seen_state_user.user_id)},e.getAnonymousUserIds=function(e){return i.filter(e,t)},e.filterAnonymousUserIds=function(e){return i.reject(e,t)},e.getAnonymousViewerInitials=function(e){return n.isCjkLocale()&&1===e.split(" ").length?e.substring(0,1):n.getInitials(e)}})(t.AnonymousViewerUtils||(t.AnonymousViewerUtils={})),t.parsePlatformString=function(e){switch(e){case"web":return r.PassPlatform.WEB;case"mobile":return r.PassPlatform.MOBILE;case"desktop":return r.PassPlatform.DESKTOP}return r.PassPlatform.UNKNOWN},t.shouldIncrementOverflowBasisForAccessType=function(e){if(e)switch(e.type){case"link_only":case"view_link_access":case"edit_link_access":return!0;case"view_member_access":case"edit_member_access":return e.value.group_access_only}return!1},t.navigateToInviteModal=function(e=[]){const t={};return e.length>0&&btoa?t.invite_emails=btoa(e.join(",")):t.show_invite_members="1",a.redirect(new o.URI({path:"/team/admin/members",query:t}))},t.navigateToSuggestModal=function(e=[]){const t={suggest_members:"1"};return e.length>0&&btoa&&(t.invite_emails=btoa(e.join(","))),a.redirect(new o.URI({path:"/team",query:t}))}})),define("metaserver/static/js/clean/ui/select",["require","exports","tslib","classnames","react","react-dom","lodash","jquery","ts-keycode-enum","metaserver/static/js/clean/ui/form_error_mixin","metaserver/static/js/clean/ui/hidden","metaserver/static/js/clean/ui/sprite","metaserver/static/js/clean/ui/util","metaserver/static/js/core/dom"],(function(e,t,s,i,r,n,a,o,l,c,d,u,_,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.option=t.input=void 0,i=s.__importDefault(i),r=s.__importDefault(r),n=s.__importStar(n),a=s.__importStar(a),o=s.__importDefault(o),_=s.__importStar(_),p=s.__importStar(p);class h extends r.default.Component{constructor(){super(...arguments),this.state={id:a.uniqueId("option")}}UNSAFE_componentWillReceiveProps(e){if(null!=e.id)return this.setState({id:e.id})}render(){const e={"list-item":!0,"select-option":!0,"select-option-disabled":this.props.disabled};null!=this.props.className&&(e[this.props.className]=!0);const t=this.props.value;return r.default.createElement("div",Object.assign({},this.props,{"data-value":t,id:this.state.id,role:"option",className:(0,i.default)(e),"aria-disabled":this.props.disabled}),this.props.children)}}t.option=h,h.displayName="selectOption";class m extends r.default.Component{constructor(){super(...arguments),this.displayName="selectInput",this.mouseInput=!0,this.state={open:!1,focused:void 0,keyboarsSelectPrefix:"",selectOptionId:a.uniqueId("selected-option"),listboxId:a.uniqueId("listbox"),value:this.props.defaultValue,errorWrapperIdName:a.uniqueId("input-error")},this._getFilteredChildren=()=>a.isArray(this.props.children)?a.filter(this.props.children,e=>e):this.props.children,this.render=()=>{const e={"select-input":!0,"select-input-dropdown-shown":this.state.open,"select-input-disabled":this.props.isDisabled};this.props.variant&&(e[this.props.variant]=!0),this.props.className&&(e[this.props.className]=!0);const t={"list-menu":!0,"select-input-dropdown":!0,"select-input-disable-error":this.props["disable-errors"]},s=r.default.createElement(c.FormError,Object.assign({},this.props,{errorWrapperIdName:this.state.errorWrapperIdName}));let n=this.props.ariaDescriptionId;((null!=this.props.error?this.props.error.message_text:void 0)||null!=(null!=this.props.error?this.props.error.message_html:void 0))&&(n=s.props.id);const a=this.selectedOption();return r.default.createElement("div",{className:(0,i.default)(e),style:this.props.style,ref:"wrapperDiv"},s,r.default.createElement("button",{className:"select-input-button","aria-expanded":this.state.open,"aria-describedby":n,"aria-controls":this.state.listboxId,"aria-labelledby":this.props.ariaLabelId+" "+(null==a?void 0:a.props.id),ref:"selectButton",tabIndex:0,onClick:this.handleClickOnInputButton},r.default.createElement("div",{className:"select-input-input filter-item__filter-input",ref:"label"},a,r.default.createElement("div",{className:"select-input-dropdown-arrow"},r.default.createElement(u.Sprite,{group:"web",name:"arrow-down-gray",alt:""})))),r.default.createElement(d.HiddenSelect,{name:this.props.name,defaultValue:this.props.defaultValue,value:this.getValue(),options:r.default.Children.map(this.props.children,e=>e.props.value)}),r.default.createElement("div",{className:"hidden-option-container"},r.default.createElement("div",{id:this.state.listboxId,className:(0,i.default)(t),role:"listbox",onKeyDown:this.handleKeydown,onMouseMove:this.handleMouseMove,tabIndex:-1,ref:"dropdown"},this.menuChildren())))},this.handleMouseMove=e=>{let t;if(!this.props.isDisabled){e.pageX===s&&e.pageY===t||(this.mouseInput=!0);var s=e.pageX;return e.pageY}},this.sortedOptions=[],this._keyboardSelect=e=>{const t=a.sortedIndexBy(this.sortedOptions,{text:e.toLowerCase()},"text"),s=this.sortedOptions[Math.max(t-1,0)],i=this.sortedOptions[Math.min(t,this.sortedOptions.length-1)];return this._commonPrefixLen(e,s.text)>=this._commonPrefixLen(e,i.text)?this.setState({keyboarsSelectPrefix:e,focused:s.value}):this.setState({keyboarsSelectPrefix:e,focused:i.value})},this.handleKeydown=e=>{if(!this.props.isDisabled){switch(this.mouseInput=!1,e.keyCode){case l.Key.Tab:return this.setState({open:!1,focused:void 0}),!0;case l.Key.Enter:case l.Key.Space:this.state.open&&this.state.focused?(this.setValue(this.state.focused),this.setState({open:!1})):this.toggle();break;case l.Key.Escape:if(this.state.open){const e=this.getValue();this.setValue(e),this.setState({open:!1})}break;case l.Key.UpArrow:this.state.open?this.setState({focused:this.prev(this.state.focused)}):this.setState({open:!0});break;case l.Key.DownArrow:this.state.open?this.setState({focused:this.next(this.state.focused)}):this.setState({open:!0});break;default:if(!this.state.open)return!0;if(!a.values(l.Key).includes(e.keyCode)){const t=String.fromCharCode(e.which),s=this.state.keyboarsSelectPrefix+t;this._keyboardSelect(s),this._keyboardSelect_timeout&&clearTimeout(this._keyboardSelect_timeout),this._keyboardSelect_timeout=setTimeout(()=>(this.setState({keyboarsSelectPrefix:""}),this._keyboardSelect_timeout=void 0),500)}}return!1}},this.prev=e=>{let t=void 0,s=void 0;return r.default.Children.forEach(this.props.children,i=>{s||i.props.disabled||(s=i.props.value),i.props.value===e&&(t=s),i.props.disabled||(s=i.props.value)}),t},this.next=e=>{let t=void 0,s=void 0;return r.default.Children.forEach(this.props.children,i=>{i.props.disabled||(s===e&&(t=i.props.value),s=i.props.value)}),t||s},this.menuChildren=()=>{const e=this.getValue();return r.default.Children.map(this.props.children,t=>r.default.cloneElement(t,{onMouseEnter:()=>{if(p.scroll_lock_document(),this.mouseInput)return this.setState({focused:t.props.value})},onMouseOut:()=>p.scroll_unlock_document(),onClick:()=>{if(!t.props.disabled)return this.setState({open:!1}),this.setValue(t.props.value)},className:(0,i.default)({"focused-option":null!=this.state.focused&&this.state.focused===t.props.value,"selected-option":e===t.props.value},t.props.className)}))},this.componentDidMount=()=>(this.globalMenuCloser=e=>{if(this.state.open){const t=(0,o.default)(e.target).closest(".select-input");if(!t.length||t[0]!==n.findDOMNode(this.refs.wrapperDiv))return this.setState({open:!1,focused:void 0})}},(0,o.default)(document).on("click",this.globalMenuCloser)),this.componentWillUnmount=()=>(0,o.default)(document).off("click",this.globalMenuCloser),this.selectedOption=()=>{let e=null;return null!=this.props.headerElement?this.props.headerElement:(r.default.Children.forEach(this._getFilteredChildren(),t=>{if(e||(e=t),(null!=t?t.props.value:void 0)===this.getValue())return e=t}),e?r.default.cloneElement(e,{id:this.state.selectOptionId}):null)},this.handleClickOnInputButton=e=>(e.preventDefault(),this.toggle()),this.toggle=()=>{if(!this.props.isDisabled)return this.state.open?this.setState({open:!1,focused:null}):this.setState({open:!0,focused:this.getValue()})},this.getValue=()=>{let e,t;return null!=(e=null!=(t=null!=this.props.value?this.props.value:null!=this.props.valueLink?this.props.valueLink.value:void 0)?t:this.state.value)?e:this.props.defaultValue},this.setValue=e=>{const t=this.getValue();if(this.props.valueLink?this.props.valueLink.requestChange(e):this.setState({value:e}),t!==e||null!=this.props.headerElement)return"function"==typeof this.props.onChange?this.props.onChange(t,e):void 0}}_commonPrefixLen(e,t){e=e.trim().toLowerCase(),t=t.trim().toLowerCase();let s=0;for(;s<e.length&&s<t.length&&e.charAt(s)===t.charAt(s);)s++;return s}componentWillMount(){const e=r.default.Children.map(this._getFilteredChildren(),e=>({value:e.props.value,text:_.getText(e).trim().toLowerCase()}));return this.sortedOptions=a.sortBy(e,"text")}componentDidUpdate(e,t){let s;const i=(0,o.default)(n.findDOMNode(this.refs.dropdown)),r=(0,o.default)(n.findDOMNode(this.refs.selectButton));this.state.open&&(s=i.find(`[data-value='${this.state.focused}']`),i.attr("aria-activedescendant",s.attr("id"))),this.state.open&&this.state.focused&&null==this.props.headerElement&&(s=i.find(`[data-value='${this.state.focused}']`),i.attr("aria-activedescendant",s.attr("id")),(function(e,t){const s=e.scrollTop(),i=s+e.height(),r=t.position().top+s,n=r+t.height();r<s?e.scrollTop(r):n>i&&e.scrollTop(n-e.height())})(i,s));const a=t.open&&!this.state.open;if(!t.open&&this.state.open&&i.focus(),a)return r.focus()}}t.input=m,m.defaultProps={errorWrapperClassName:"select-input-error-wrapper",ariaLabelId:"",ariaDescriptionId:"",style:null,headerElement:null},m.displayName="selectInput"})),define("metaserver/static/js/sharing/api/client",["require","exports","tslib","immutable","lodash","metaserver/static/js/api_v2/error","metaserver/static/js/api_v2/types","metaserver/static/js/api_v2/user_client","metaserver/static/js/sharing/api/types/metadata","metaserver/static/js/sharing/api/util/types","metaserver/static/js/sharing/access_level","typescript/component_libraries/spectrum-sharing/src/utils/sharing_constants","metaserver/static/js/clean/viewer","metaserver/static/js/core/assert","metaserver/static/js/modules/constants/sharing"],(function(e,t,s,i,r,n,a,o,l,c,d,u,_,p,h){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ShareApiClient=t.ShareError=t.MockShareApiClient=t.FolderShareApiClient=t.FileShareApiClient=void 0,i=s.__importStar(i),r=s.__importStar(r);class m extends Error{constructor(e){super(),this.message=e,this.name="ShareError",this.stack=(new Error).stack}}t.ShareError=m;class f extends o.UserApiV2Client{constructor({userId:e,isNonUserRelativeContext:t},s){super(s),null==t&&(t=!1),this.userId=e,t&&null==this.teamMemberId&&(this.teamMemberId=_.Viewer.get_viewer().work_user.team_member_id)}static initClass(){this.prototype._getAccountBatchCache={},this.prototype._getCurrentAccountCache=null,this.prototype._getLightweightAccountCache=null}_headers(e){return null!=this.teamMemberId?Object.assign({[a.ApiV2HeaderNames.DropboxApiSelectAdmin]:this.teamMemberId},super._headers(e)):super._headers(e)}targetsSearch(e,t){return this.ns("sharing").rpc("targets/search",e,{signal:t,subjectUserId:this.userId})}validateMembers({contentId:e,accessLevel:t,members:s}){throw new TypeError("Not implemented")}_validateMembers({contentId:e,contentType:t,accessLevel:s,members:i}){return this.ns("sharing").rpc("targets/validate",{access_level:(0,c.accessLevelConstToApi)(s),content_type:t,content_id:e,members:i},{subjectUserId:this.userId})}addMembers({contentId:e,members:t,accessLevel:s,customMessage:i=null,quiet:r=!1,addMessageAsComment:n}){throw new TypeError("Not implemented")}addMembersWithAccessLevel({contentId:e,members:t,customMessage:s=null,quiet:i=!1}){throw new TypeError("Not implemented")}removeMember({contentId:e,memberId:t}){throw new TypeError("Not implemented")}getMetadata({contentId:e,isInSharedFolder:t,actions:s=[]}){throw new TypeError("Not implemented")}getMetadataInternal({contentId:e,actions:t=[]}){throw new TypeError("Not implemented")}getMetadataAlpha({contentId:e,actions:t=[]}){throw new TypeError("Not implemented")}listMembers({contentId:e,isAlpha:t}){throw new TypeError("Not implemented")}listMembersContinue({cursor:e,isAlpha:t}){throw new TypeError("Not implemented")}getMemberCounts({contentId:e}){throw new TypeError("Not implemented")}getParentFolderAccess({contentId:e,memberId:t,accessLevel:s}){throw new TypeError("Not implemented")}updateMember({contentId:e,memberId:t,accessLevel:s}){throw new TypeError("Not implemented")}dismissInviteNotification({contentId:e}){return this.ns("sharing").rpc("dismiss_invite_notification",{content_id:e},{subjectUserId:this.userId})}getSharingPrefs(){return this.ns("users").rpc("get_sharing_prefs",void 0,{subjectUserId:this.userId}).then(c.sharingPrefsApiToRecord)}setSharingPrefs(e){return this.ns("users").rpc("set_sharing_prefs",e,{subjectUserId:this.userId})}claimMembership({contentUrl:e}){return this.ns("sharing").rpc("claim_membership",{content_url:e},{subjectUserId:this.userId})}checkJobStatus({jobId:e}){return this.ns("sharing").rpc("check_job_status",{async_job_id:e},{subjectUserId:this.userId})}getAccountBatch({accountIds:e}){return e.length>0?(h.SHARING_EXPERIMENTS.FIX_MAX_ACCOUNT_BATCH_SIZE&&e.length>300&&(e=e.slice(0,300)),this.ns("users").rpc("get_account_batch",{account_ids:e},{subjectUserId:this.userId}).then(e=>e.map(c.accountInfoApiToRecord))):Promise.resolve([])}getAccountBatchCached({accountIds:e}){const t=this._getAccountBatchCache,[s,i]=Array.from(r.partition(e,e=>e in t)),n=r.values(r.pick(t,s));return this.getAccountBatch({accountIds:i}).then(e=>{const s=r.zipObject(e.map(e=>e.account_id),e);return this._getAccountBatchCache=Object.assign(Object.assign({},t),s),e.concat(n)})}resetGetAccountBatchCache(){return this._getAccountBatchCache={}}getCurrentAccount(e){return this.ns("users").rpc("get_current_account",void 0,{subjectUserId:this.userId}).then(e=>(0,c.fullAccountApiToRecord)(e))}getCurrentAccountCached(e){return null==this._getCurrentAccountCache&&(this._getCurrentAccountCache=this.getCurrentAccount()),this._getCurrentAccountCache}resetGetCurrentAccountCache(){return this._getCurrentAccountCache={}}getLightweightAccount(e){return this.ns("sharing").rpc("get_sharing_account_info",void 0,{subjectUserId:this.userId}).then(e=>(0,c.lightweightAccountApiToRecord)(e))}getLightweightAccountCached(e){return null==this._getLightweightAccountCache&&(this._getLightweightAccountCache=this.getLightweightAccount()),this._getLightweightAccountCache}resetGetLightweightAccountCache(){return this._getLightweightAccountCache={}}requestAccess({contentUrl:e,customMessage:t}){return this.ns("sharing").rpc("request_access",{content_url:e,custom_message:t},{subjectUserId:this.userId})}sharedLinkInfo({fileIdOrPath:e}){return(0,p.assert)(null!=e,"an fqPath or fileId must be present to retrieve shared link info"),this.ns("sharing").rpc("alpha/list_shared_links",{path:e,direct_only:!0},{subjectUserId:this.userId}).then((function(e){return e.links.map(e=>(0,c.linkMetadataApiToRecord)(e))}))}createSharedLinkNonAlpha({fileIdOrPath:e,settings:t}){return(0,p.assert)(null!=e,"an fqPath or fileId must be present to retrieve shared link info"),this.ns("sharing").rpc("create_shared_link_with_settings",{path:e,settings:t},{subjectUserId:this.userId}).then(c.linkMetadataApiToRecord)}createSharedLink({fileIdOrPath:e,settings:t}){return(0,p.assert)(null!=e,"an fqPath or fileId must be present to retrieve shared link info"),this.ns("sharing").rpc("alpha/create_shared_link_with_settings",{path:e,settings:t},{subjectUserId:this.userId}).then(c.linkMetadataApiToRecord)}modifySharedLinkSettings({url:e,settings:t,remove_expiration:s}){return this.ns("sharing").rpc("alpha/modify_shared_link_settings",{url:e,settings:t,remove_expiration:s},{subjectUserId:this.userId}).then(c.linkMetadataApiToRecord)}revokeSharedLink({url:e}){return this.ns("sharing").rpc("revoke_shared_link",{url:e},{subjectUserId:this.userId})}listReceivedContent(e=5,t){return this.ns("sharing").rpc("received",{limit:e,share_type:t},{subjectUserId:this.userId}).then(c.listContentResultApiToRecord)}listReceivedContentContinue(e,t){return this.ns("sharing").rpc("received/continue",{cursor:e,share_type:t},{subjectUserId:this.userId}).then(c.listContentResultApiToRecord)}listSentContent(e=5){return this.ns("sharing").rpc("sent",{limit:e},{subjectUserId:this.userId}).then(c.listContentResultApiToRecord)}listSentContentContinue(e){return this.ns("sharing").rpc("sent/continue",{cursor:e},{subjectUserId:this.userId}).then(c.listContentResultApiToRecord)}createSharingTasks({fileId:e,emails:t,note:s,sharingTasks:i}){const r={file_id:e,emails:t,note:s,sharing_tasks:i},n={subjectUserId:this.userId};return this.ns("sharing_activation").rpc("create_sharing_tasks",r,n)}_addAccountsToMembership(e){return this._addAccountsToMembershipBatch(i.Map([[1,e]])).then(e=>e.get(1))}_addAccountsToMembershipBatch(e){const t=e.valueSeq().flatMap(e=>e.users.valueSeq()).map(e=>e.memberId()).toSet().toArray();return t.length>0?this.getAccountBatchCached({accountIds:t}).then((function(t){const s=i.Map(t.map(e=>[e.account_id,e]));return e.map((e,t)=>e.set("users",e.users.map(e=>{const t=s.get(e.account_id);return null!=t?e.set("account",t):e})))})):Promise.resolve(e)}}t.ShareApiClient=f,f.initClass();t.MockShareApiClient=class extends f{constructor({userId:e,isNonUserRelativeContext:t}){super({userId:e,isNonUserRelativeContext:t}),this.getMetadata=this.getMetadata.bind(this),this.getMetadataInternal=this.getMetadataInternal.bind(this),this.getMetadataAlpha=this.getMetadataAlpha.bind(this),this.validateFqPath=this.validateFqPath.bind(this),this._promises={}}targetsSearch(e,t){return this.createPromise("targetsSearch")}validateMembers({contentId:e,accessLevel:t,members:s}){return this.createPromise("validateMembers")}addMembers({contentId:e,members:t,accessLevel:s,customMessage:i=null,quiet:r=!1,addMessageAsComment:n}){return this.createPromise("addMembers")}addMembersWithAccessLevel({contentId:e,members:t,customMessage:s=null,quiet:i=!1}){return this.createPromise("addMembersWithAccessLevel")}getMetadata({contentId:e,isInSharedFolder:t,actions:s=[]}){return this.createPromise("getMetadata")}getMetadataInternal({contentId:e,actions:t=[]}){return this.createPromise("getMetadataInternal")}getMetadataAlpha({contentId:e,actions:t=[]}){return this.createPromise("getMetadataAlpha")}dismissInviteNotification({contentId:e,cursor:t=null}){return this.createPromise("dismissInviteNotification")}getSharingPrefs(){return this.createPromise("getSharingPrefs")}listMembers({contentId:e,isAlpha:t}){return this.createPromise("listMembers")}listMembersContinue({cursor:e,isAlpha:t}){return this.createPromise("listMembersContinue")}getMemberCounts({contentId:e}){return this.createPromise("getMemberCounts")}getParentFolderAccess({contentId:e,memberId:t,accessLevel:s}){return this.createPromise("getParentFolderAccess")}removeMember({contentId:e,memberId:t}){return this.createPromise("removeMember")}setLinkSettings({linkSettings:e,url:t}){return this.createPromise("setLinkSettings")}share({fqPath:e,memberPolicy:t=null,aclUpdatePolicy:s=null,sharedLinkPolicy:i=null,forceAsync:r=!1}){return this.createPromise("share")}shareInternal({fqPath:e,folderPolicy:t=null,forceAsync:s=!1,confidential:i=!1}){return this.createPromise("shareInternal")}requestAccess({contentUrl:e,customMessage:t}){return this.createPromise("requestAccess")}sharedLinkInfo({fileIdOrPath:e}){return this.createPromise("sharedLinkInfo")}transferContent({contentId:e,memberId:t}){return this.createPromise("transferContent")}createSharedLink({fileIdOrPath:e}){return this.createPromise("createSharedLink")}updateMember(){return this.createPromise("updateMember")}updatePolicyAlpha(){return this.createPromise("updatePolicyAlpha")}validateFqPath({fqPath:e,actions:t=[]}){return this.createPromise("validateFqPath")}getCurrentAccountCached(e){return this.createPromise("getCurrentAccountCached")}getLightweightAccountCached(e){return this.createPromise("getLightweightAccountCached")}modifySharedLinkSettings({url:e,settings:t,remove_expiration:s}){return this.createPromise("modifySharedLinkSettings")}revokeSharedLink({url:e}){return this.createPromise("revokeSharedLink")}relinquishMembership({contentId:e,leaveACopy:t=!1}){return this.createPromise("relinquishMembership")}setConfidentiality({contentId:e,confidential:t,keep_inherited_members:s=!1}){return this.createPromise("setConfidentiality")}validatePathContinue(e,t){return this.createPromise("validatePathContinue")}createPromise(e){let t=this._promises[e];return t&&t.calledBeforeCreatePromise?(this._promises[e]=null,t.promise):(t={},t.promise=new Promise((function(e,s){return t.resolve=e,t.reject=s})),this._promises[e]=t,t.promise)}getPromise(e){return null!=this._promises[e]?this._promises[e].promise:void 0}resolvePromise(e,t,s=!1){this._promises[e]||this.createPromise(e);const i=this._promises[e];return i.calledBeforeCreatePromise=s,i.resolve.apply(null,t),i.promise}rejectPromise(e,t,s=!1){this._promises[e]||this.createPromise(e);const i=this._promises[e];return i.calledBeforeCreatePromise=s,i.reject.apply(null,t),i.promise}};t.FileShareApiClient=class extends f{constructor({userId:e,isNonUserRelativeContext:t}){super({userId:e,isNonUserRelativeContext:t}),this.getMetadata=this.getMetadata.bind(this),this.getMetadataAlpha=this.getMetadataAlpha.bind(this),this.getMetadataBatchAlpha=this.getMetadataBatchAlpha.bind(this)}validateMembers({contentId:e,accessLevel:t,members:s}){return this._validateMembers({accessLevel:t,contentId:e,members:s,contentType:l.ContentTypes.File})}addMembers({contentId:e,members:t,customMessage:s=null,quiet:i=!1,accessLevel:r,addMessageAsComment:n=!1}){null==r&&(r=d.ACCESS_LEVEL.READER);const a=(0,c.accessLevelConstToApi)(r);return 0===(null!=s?s.length:void 0)&&(s=null),this.ns("sharing").rpc("add_file_member",{file:e,members:t,custom_message:s,quiet:i,access_level:a,add_message_as_comment:n},{subjectUserId:this.userId})}removeMember({contentId:e,memberId:t}){return this.ns("sharing").rpc("remove_file_member_2",{file:e,member:(0,c.makeMemberSelector)(t)},{subjectUserId:this.userId}).then(e=>(0,c.memberAccessLevelApiToRecord)(this.userId,e))}getMetadata({contentId:e,isInSharedFolder:t,actions:s=[]}){return this.ns("sharing").rpc("get_file_metadata",{file:e,actions:s},{subjectUserId:this.userId}).then(c.fileMetadataApiToRecord)}getMetadataAlpha({contentId:e,actions:t=[],sourceURL:s}){return this.ns("sharing").rpc("alpha/get_file_metadata",{file:e,actions:t,url:s},{subjectUserId:this.userId}).then(c.fileMetadataApiToRecord)}getMetadataBatchAlpha({contentIds:e,actions:t=[]}){return this.ns("sharing").rpc("alpha/get_file_metadata/batch",{files:e,actions:t},{subjectUserId:this.userId}).then(e=>e.map(e=>(0,c.fileMetadataApiToRecord)(e.result)))}listMembers({contentId:e,url:t=null,limit:s,isAlpha:i=!1,includeSeenState:r}){null==s&&(s=100),null==r&&(r=!0);const n={file:e,actions:u.MEMBER_ACTION.ALL,include_inherited:!0,limit:s,url:i?t:void 0,include_seen_state:r},a=this.ns("sharing");return(i?a.rpc("alpha/list_file_members",n,{subjectUserId:this.userId}):a.rpc("list_file_members",n,{subjectUserId:this.userId})).then(c.membershipApiToRecord).then(this._addAccountsToMembership.bind(this))}listMembersContinue({cursor:e,url:t=null,isAlpha:s=!1}){const i={cursor:e,url:s?t:void 0},r=this.ns("sharing");return(s?r.rpc("alpha/list_file_members/continue",i,{subjectUserId:this.userId}):r.rpc("list_file_members/continue",i,{subjectUserId:this.userId})).then(e=>(0,c.membershipApiToRecord)(e,null)).then(this._addAccountsToMembership.bind(this))}listMembersBatch({contentIds:e,limit:t}){return null==t&&(t=10),this.ns("sharing").rpc("list_file_members/batch",{files:e,limit:t},{subjectUserId:this.userId}).then((function(e){const t={};for(const s of Array.from(e))"result"===s.result[".tag"]&&(t[s.file]=(0,c.membershipApiToRecord)(s.result.members,s.result.member_count));return i.Map(t)})).then(this._addAccountsToMembershipBatch.bind(this))}getMemberCounts({contentId:e,limit:t,countGroupsAsMembers:s=!1,url:i=null,runViewerInfoChecks:r=!1}){return this.ns("sharing").rpc("get_file_member_counts",{file:e,limit:t,count_groups_as_members:s,url:i,run_viewer_info_checks:r},{subjectUserId:this.userId})}getParentFolderAccess({contentId:e,memberId:t,accessLevel:s}){throw new m("Parent folder access points not implemented for files")}relinquishMembership({contentId:e}){return this.ns("sharing").rpc("relinquish_file_membership",{file:String(e)},{subjectUserId:this.userId})}listReceivedFiles({limit:e,actions:t,descending:s}){return null==e&&(e=100),null==t&&(t=[]),null==s&&(s=!1),this.ns("sharing").rpc("list_received_files",{limit:e,actions:t,descending:s},{subjectUserId:this.userId}).then(c.listFilesResultApiToRecord)}listReceivedFilesContinue({cursor:e}){return this.ns("sharing").rpc("list_received_files/continue",{cursor:e},{subjectUserId:this.userId}).then(c.listFilesResultApiToRecord)}updateMember({contentId:e,memberId:t,accessLevel:s}){return this.ns("sharing").rpc("update_file_member",{file:String(e),member:(0,c.makeMemberSelector)(t),access_level:(0,c.accessLevelConstToApi)(s)},{subjectUserId:this.userId}).then(e=>(0,c.memberAccessLevelApiToRecord)(this.userId,e))}updatePolicy({contentId:e,newPolicy:t,actions:s}){const i=(0,c.combinedPolicyDiffToApi)(t);return i.actions=s,i.file=e,this.ns("sharing").rpc("alpha/update_file_policy",i,{subjectUserId:this.userId}).then((function(e){return null!=e.metadata&&({metadata:e}=e),(0,c.fileMetadataApiToRecord)(e)}))}unshare({contentId:e}){return this.ns("sharing").rpc("unshare_file",{file:String(e)},{subjectUserId:this.userId})}};t.FolderShareApiClient=class extends f{constructor({userId:e,isNonUserRelativeContext:t}){super({userId:e,isNonUserRelativeContext:t}),this.getMetadata=this.getMetadata.bind(this),this.validateFqPath=this.validateFqPath.bind(this),this.updatePolicy=this.updatePolicy.bind(this),this.updatePolicyAlpha=this.updatePolicyAlpha.bind(this)}share({fqPath:e,folderPolicy:t,confidential:s=!1,checkFSWs:i=!1,syncSetting:r=null,should_be_new_path:n=null,intervalMs:a=1e3,timeoutMs:o=null}){const l=(0,c.combinedPolicyDiffToApi)(t);return l.path=e,l.confidentiality=s?"confidential":"not_confidential",i&&(l.fsw_request="check"),null!==r&&(l.sync_setting=r),null!==n&&(l.should_be_new_path=n),this.ns("sharing").rpc("alpha/share_folder",l,{subjectUserId:this.userId}).then(e=>("complete"===e[".tag"]?Promise.resolve(e):g(this.checkShareJobStatus.bind(this,{jobId:e.async_job_id}),{interval:a,timeout:o})).then(c.folderMetadataApiToRecord))}shareWithFsws(e){return this.share(Object.assign(Object.assign({},e),{checkFSWs:!0})).then(e=>({metadata:e})).catch((0,n.catchApiError)(e=>{const t=(e,t)=>e&&e[".tag"]&&e[".tag"]===t;if(e&&t(e.error,"bad_path")&&t(e.error.bad_path,"file_system_warnings"))return{fsws:e.error.bad_path.details};throw e}))}shareWithoutFsws(e){return this.share(Object.assign(Object.assign({},e),{checkFSWs:!1})).then(e=>({metadata:e})).catch((0,n.catchApiError)(e=>{throw e}))}checkShareJobStatus({jobId:e}){return this.ns("sharing").rpc("check_share_internal_job_status",{async_job_id:e},{subjectUserId:this.userId})}checkRemoveMemberJobStatus({jobId:e}){return this.ns("sharing").rpc("check_remove_member_job_status",{async_job_id:e},{subjectUserId:this.userId})}validateMembers({contentId:e,accessLevel:t,members:s}){return this._validateMembers({accessLevel:t,contentId:e,members:s,contentType:l.ContentTypes.Folder})}addMembers({contentId:e,members:t,accessLevel:s,customMessage:i=null,quiet:r=!1,addMessageAsComment:n}){const a=(0,c.accessLevelConstToApi)(s),o=Array.from(t).map(e=>({member:e,access_level:a}));return this.addMembersWithAccessLevel({contentId:e,members:o,customMessage:i,quiet:r})}addMembersWithAccessLevel({contentId:e,members:t,customMessage:s=null,quiet:i=!1}){0===(null!=s?s.length:void 0)&&(s=null);const r={shared_folder_id:String(e),members:t,custom_message:s,quiet:i};return null!=this.teamMemberId?this.ns("sharing").rpc("add_folder_member_v2",r,{subjectUserId:this.userId}):this.ns("sharing").rpc("add_folder_member",r,{subjectUserId:this.userId})}fetchNsId(e){return this.ns("files").rpc("get_metadata",{path:e},{subjectUserId:this.userId}).then(e=>null!=e.sharing_info?e.sharing_info.shared_folder_id:void 0)}getMetadata({contentId:e,isInSharedFolder:t,actions:s=[]}){return null==this.teamMemberId||t?this.ns("sharing").rpc("alpha/get_folder_metadata",{shared_folder_id:String(e),actions:s},{subjectUserId:this.userId}).then(c.folderMetadataApiToRecord):this.ns("sharing").rpc("alpha/get_folder_metadata_v2",{shared_folder_id:String(e),actions:s},{subjectUserId:this.userId}).then(c.folderMetadataApiToRecord)}_metadataAndInheritMembers(e){const{members_cursor:t}=e;return t?this.listMembersContinue({cursor:t}).then(t=>({metadata:e,inheritedMembers:t})):{metadata:e,inheritedMembers:new l.SharingMembership}}validateFqPath({fqPath:e,actions:t,listMembersArg:s,shouldParseMetadataFromError:i=!1,shareAsConfidential:r=!1}){null==t&&(t=[]),null==s&&(s={});const n=this.ns("sharing").rpc("validate_folder_path",{path:e,actions:t,list_members_arg:s,confidentiality:r?{".tag":"confidential"}:{".tag":"not_confidential"}},{subjectUserId:this.userId});return this.validatePathContinue(n,i)}validatePathContinue(e,t){return e.catch((0,n.catchApiError)((function(e){var s,i;if("already_shared"===(null===(i=null===(s=e.error)||void 0===s?void 0:s.bad_path)||void 0===i?void 0:i[".tag"]))return e.error.bad_path;if(t&&e instanceof n.AppError&&e.error&&"no_permission"===e.error[".tag"]&&(0,c.hasFolderMetadataRecordInMetadata)(e.error))return e.error;throw e}))).then(c.folderMetadataApiToRecord).then(this._metadataAndInheritMembers.bind(this))}validateFolderPathBatch({paths:e}){return this.ns("sharing").rpc("validate_folder_path/batch",{paths:e},{subjectUserId:this.userId}).then(e=>e.entries.map((function(e){var t,s;const{result:i}=e;let r=null;"metadata"===i[".tag"]?r=i:"no_permission"===(null!=i.path_error?i.path_error[".tag"]:void 0)?r=i.path_error:"already_shared"===(null===(s=null===(t=i.path_error)||void 0===t?void 0:t.bad_path)||void 0===s?void 0:s[".tag"])&&(r=i.path_error.bad_path);let n=null;return r&&r.link_metadata&&(n=(0,c.folderMetadataApiToRecord)(r)),{path:e.path,metadata:n}})))}updatePolicy({contentId:e,newPolicy:t}){const s=t;return s.shared_folder_id=String(e),null!=this.teamMemberId?this.ns("sharing").rpc("update_folder_policy_v2",s,{subjectUserId:this.userId}).then(c.folderMetadataApiToRecord):this.ns("sharing").rpc("update_folder_policy",s,{subjectUserId:this.userId}).then(c.folderMetadataApiToRecord)}updatePolicyAlpha({contentId:e,newPolicy:t}){const s=(0,c.combinedPolicyDiffToApi)(t);return s.shared_folder_id=String(e),null!=this.teamMemberId?this.ns("sharing").rpc("alpha/update_folder_policy_v2",s,{subjectUserId:this.userId}).then(c.folderMetadataApiToRecord):this.ns("sharing").rpc("alpha/update_folder_policy",s,{subjectUserId:this.userId}).then(c.folderMetadataApiToRecord)}unshare({contentId:e,leaveACopy:t=!1}){return this.ns("sharing").rpc("unshare_folder",{shared_folder_id:String(e),leave_a_copy:t},{subjectUserId:this.userId}).then(e=>"complete"===e[".tag"]?Promise.resolve(e):g(this.checkJobStatus.bind(this,{jobId:e.async_job_id})))}listMembers({contentId:e,limit:t,isAlpha:s=!1}){return null==t&&(t=100),this.ns("sharing").rpc("list_folder_members",{shared_folder_id:String(e),actions:u.MEMBER_ACTION.ALL,limit:t},{subjectUserId:this.userId}).then(c.membershipApiToRecord).then(this._addAccountsToMembership.bind(this))}listMembersContinue({cursor:e,isAlpha:t=!1}){return this.ns("sharing").rpc("list_folder_members/continue",{cursor:e},{subjectUserId:this.userId}).then(e=>(0,c.membershipApiToRecord)(e,null)).then(this._addAccountsToMembership.bind(this))}listMountableFolders({limit:e,actions:t}={}){return null==e&&(e=100),null==t&&(t=[]),this.ns("sharing").rpc("list_mountable_folders",{limit:e,actions:t},{subjectUserId:this.userId}).then(c.listFoldersResultApiToRecord)}listMountableFoldersContinue({cursor:e}){return this.ns("sharing").rpc("list_mountable_folders/continue",{cursor:e},{subjectUserId:this.userId}).then(c.listFoldersResultApiToRecord)}listMountableFoldersAlpha({limit:e,actions:t,show_mounted:s,get_invite_data:i}={}){return null==e&&(e=100),null==t&&(t=[]),null==i&&(i=!1),this.ns("sharing").rpc("alpha/list_mountable_folders",{limit:e,actions:t,show_mounted:s,get_invite_data:i},{subjectUserId:this.userId}).then(c.listFoldersResultApiToRecord)}listMountableFoldersContinueAlpha({cursor:e}){return this.ns("sharing").rpc("alpha/list_mountable_folders/continue",{cursor:e},{subjectUserId:this.userId}).then(c.listFoldersResultApiToRecord)}getMemberCounts({contentId:e}){return null!=this.teamMemberId?this.ns("sharing").rpc("get_folder_member_counts_v2",{shared_folder_id:String(e)},{subjectUserId:this.userId}).then(c.memberCountsApiToRecord):this.ns("sharing").rpc("get_folder_member_counts",{shared_folder_id:String(e)},{subjectUserId:this.userId}).then(c.memberCountsApiToRecord)}getParentFolderAccess({contentId:e,memberId:t,accessLevel:s}){return this.ns("sharing").rpc("get_parent_folder_access",{shared_folder_id:String(e),member:(0,c.makeMemberSelector)(t),access_level:null!=s?(0,c.accessLevelConstToApi)(s):void 0},{subjectUserId:this.userId}).then(c.memberAccessLevelApiToRecord.bind(null,this.userId))}relinquishMembership({contentId:e,leaveACopy:t=!1}){return this.ns("sharing").rpc("relinquish_folder_membership",{shared_folder_id:String(e),leave_a_copy:t},{subjectUserId:this.userId}).then(e=>"complete"===e[".tag"]?Promise.resolve():g(this.checkJobStatus.bind(this,{jobId:e.async_job_id})))}removeMember({contentId:e,memberId:t,leaveACopy:s=!1}){let i;return i=null!=this.teamMemberId?this.ns("sharing").rpc("remove_folder_member_v2",{shared_folder_id:String(e),member:(0,c.makeMemberSelector)(t),leave_a_copy:s},{subjectUserId:this.userId}):this.ns("sharing").rpc("remove_folder_member",{shared_folder_id:String(e),member:(0,c.makeMemberSelector)(t),leave_a_copy:s},{subjectUserId:this.userId}),i.then(e=>"complete"===e[".tag"]?Promise.resolve(e):g(this.checkRemoveMemberJobStatus.bind(this,{jobId:e.async_job_id}))).then(e=>(0,c.memberAccessLevelApiToRecord)(this.userId,e))}transferContent({contentId:e,memberId:t}){return null!=this.teamMemberId?this.ns("sharing").rpc("transfer_folder_v2",{shared_folder_id:String(e),to_dropbox_id:t},{subjectUserId:this.userId}):this.ns("sharing").rpc("transfer_folder",{shared_folder_id:String(e),to_dropbox_id:t},{subjectUserId:this.userId})}updateMember({contentId:e,memberId:t,accessLevel:s}){let i;return i=null!=this.teamMemberId?this.ns("sharing").rpc("update_folder_member_v2",{shared_folder_id:String(e),member:(0,c.makeMemberSelector)(t),access_level:(0,c.accessLevelConstToApi)(s)},{subjectUserId:this.userId}):this.ns("sharing").rpc("update_folder_member",{shared_folder_id:String(e),member:(0,c.makeMemberSelector)(t),access_level:(0,c.accessLevelConstToApi)(s)},{subjectUserId:this.userId}),i.then(e=>(0,c.memberAccessLevelApiToRecord)(this.userId,e))}mount({contentId:e}){return this.ns("sharing").rpc("mount_folder",{shared_folder_id:String(e)},{subjectUserId:this.userId}).then(c.folderMetadataApiToRecord)}unmount({contentId:e}){return this.ns("sharing").rpc("unmount_folder",{shared_folder_id:String(e)},{subjectUserId:this.userId})}setConfidentiality({contentId:e,confidential:t,keepInheritedMembers:s=!1}){return this.ns("sharing").rpc("set_access_inheritance",{shared_folder_id:String(e),access_inheritance:t?{".tag":"no_inherit"}:{".tag":"inherit"},keep_inherited_members:s},{subjectUserId:this.userId}).then(e=>"complete"===e[".tag"]?Promise.resolve(e):g(this.checkShareJobStatus.bind(this,{jobId:e.async_job_id}))).then(c.folderMetadataApiToRecord)}checkConfidentialRelocateJobStatus({jobId:e}){return this.ns("sharing").rpc("confidential_relocate/check",{async_job_id:e},{subjectUserId:this.userId})}relocateConfidentially({fromPath:e,toPath:t}){return s.__awaiter(this,void 0,void 0,(function*(){const{result:{async_job_id:s},converted_folder_id:i}=yield this.ns("sharing").rpc("confidential_relocate",{from_path:e,to_path:t},{subjectUserId:this.userId});return{result:yield g(this.checkConfidentialRelocateJobStatus.bind(this,{jobId:s})),convertedFolderId:i}}))}};const g=function(e,t){let s=1e3,i=null;t&&t.interval&&(s=t.interval),t&&t.timeout&&(i=t.timeout);const r=null!=i?Date.now()+i:null,a=function(t,i){return null!=r&&Date.now()>r?i():e().then((function(e){switch(e[".tag"]){case"failed":return i(e);case"complete":return t(e);case"in_progress":return window.setTimeout(a,s,t,i)}})).catch((0,n.catchApiError)(e=>i(e)))};return new Promise(a)}})),define("metaserver/static/js/sharing/api/types/metadata",["require","exports","tslib","immutable","metaserver/static/js/api_v2/types","metaserver/static/js/sharing/access_level","typescript/component_libraries/spectrum-sharing/src/utils/sharing_util"],(function(e,t,s,i,r,n,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ContentTypes=t.AudienceRestrictingSharedFolder=t.SharingPrefs=t.LinkAudienceOption=t.LinkAudienceDisallowedReason=t.LinkVisibilityPolicy=t.LinkPermissions=t.LinkPolicy=t.LinkMetadata=t.MountLimitInfo=t.ParentFolderInfo=t.MemberAccessLevelResult=t.MemberCounts=t.MemberPermissions=t.GroupMembershipInfo=t.InviteeMembershipInfo=t.UserMembershipInfo=t.MembershipType=t.makeMemberKey=t.SharingMembership=t.ListContentResult=t.ListFilesResult=t.FilePolicy=t.FilePermissions=t.SharedFileMetadata=t.ListFoldersResult=t.FolderPermissions=t.FolderPolicy=t.SharedFolderMetadata=t.PermissionSetting=t.LightweightAccount=t.FullAccount=t.BasicAccount=t.TeamSharingPolicies=t.FullTeam=t.TeamMemberInfo=t.Team=t.GroupManagementType=t.LinkAudience=t.DownloadPolicy=t.ViewerInfoPolicy=t.VisibilityDisallowedReason=t.ResolvedVisibilityPolicy=t.RequestedVisibilityPolicy=t.SharedLinkCreatePolicy=t.SharedFolderJoinPolicy=t.SharedFolderMemberMemberPolicy=t.SharedLinkPolicy=t.AclUpdatePolicy=t.MemberPolicy=void 0,i=s.__importStar(i),t.MemberPolicy={team:new r.UnionScalar("team"),anyone:new r.UnionScalar("anyone")},t.AclUpdatePolicy={owner:new r.UnionScalar("owner"),editors:new r.UnionScalar("editors")},t.SharedLinkPolicy={anyone:new r.UnionScalar("anyone"),members:new r.UnionScalar("members")},t.SharedFolderMemberMemberPolicy={team:new r.UnionScalar("team"),anyone:new r.UnionScalar("anyone")},t.SharedFolderJoinPolicy={from_team_only:new r.UnionScalar("from_team_only"),from_anyone:new r.UnionScalar("from_anyone")},t.SharedLinkCreatePolicy={default_public:new r.UnionScalar("default_public"),default_team_only:new r.UnionScalar("default_team_only"),team_only:new r.UnionScalar("team_only"),default_no_one:new r.UnionScalar("default_no_one")},t.RequestedVisibilityPolicy={policy_name:"requested_visibility",password:"password",public:"public",team_only:"team_only"},t.ResolvedVisibilityPolicy={policy_name:"resolved_visibility",only_you:"only_you",password:"password",public:"public",shared_folder_only:"shared_folder_only",team_and_password:"team_and_password",team_only:"team_only"},t.VisibilityDisallowedReason={delete_and_recreate:"delete_and_recreate",restricted_by_shared_folder:"restricted_by_shared_folder",restricted_by_team:"restricted_by_team",user_account_type:"user_account_type",user_not_on_team:"user_not_on_team",permission_denied:"permission_denied"},t.ViewerInfoPolicy={policy_name:"viewer_info_policy",enabled:"enabled",disabled:"disabled"},t.DownloadPolicy={policy_name:"download_policy",allow:"allow",disallow:"disallow"},t.LinkAudience={public:"public",team:"team",password:"password",no_one:"no_one",members:"members"},t.GroupManagementType={user_managed:new r.UnionScalar("user_managed"),company_managed:new r.UnionScalar("company_managed"),system_managed:new r.UnionScalar("system_managed")};class o extends(i.Record({id:null,name:null},"Team")){}t.Team=o;class l extends(i.Record({display_name:null,member_id:null,team_info:null},"TeamMemberInfo")){}t.TeamMemberInfo=l;class c extends(i.Record({id:null,name:null,sharing_policies:null},"FullTeam")){}t.FullTeam=c;class d extends(i.Record({shared_folder_member_policy:null,shared_folder_join_policy:null,shared_link_create_policy:null,group_creation_policy:null},"TeamSharingPolicies")){}t.TeamSharingPolicies=d;class u extends(i.Record({account_id:null,display_name:null,disabled:!1,email:null,email_verified:!1,familiar_name:null,given_name:null,is_teammate:!1,profile_photo_url:null,surname:null,team_member_id:null},"BasicAccount")){}t.BasicAccount=u;class _ extends(i.Record({account_id:null,display_name:null,disabled:!1,email:null,email_verified:!1,familiar_name:null,given_name:null,profile_photo_url:null,surname:null,team:null,team_member_id:null,is_family_user:!1},"FullAccount")){}t.FullAccount=_;class p extends(i.Record({team_policies:null,is_team_member:!1,is_family_user:!1},"LightweightAccount")){}t.LightweightAccount=p;class h extends(i.Record({allow:!1,reason:null},"PermissionSetting")){}t.PermissionSetting=h;class m extends(i.Record({access_type:null,is_confidential:!1,is_inside_team_folder:!1,is_team_folder:!1,link_metadata:null,members_cursor:null,name:null,owner_team:null,parent_shared_folder_id:null,path_lower:null,permissions:null,policy:null,preview_url:null,shared_folder_id:null,time_invited:null,can_mount:null,folder_size:null,invite_info:null,parent_folder_name:null},"SharedFolderMetadata")){contentId(){return this.shared_folder_id||this.path_lower}isFile(){return!1}isFolder(){return!0}isSharedFolder(){return Boolean(this.shared_folder_id)}isNewSharedFolder(){return!this.shared_folder_id}isViewOnly(){return Boolean(this.access_type===n.ACCESS_LEVEL.READER)}nsId(){return this.isSharedFolder()?this.shared_folder_id:void 0}canCreateEditLink(){return!1}canCreateViewLink(){return!(this.is_confidential||this.is_team_folder&&this.isSharedFolder()||null===this.path_lower)}canEditInbandInvite(){return this.permissions&&this.permissions.invite_editor&&this.permissions.invite_editor.get("allow")}canViewInbandInvite(){return this.permissions&&this.permissions.invite_viewer&&this.permissions.invite_viewer.get("allow")}}t.SharedFolderMetadata=m;class f extends(i.Record({acl_update_policy:null,download_policy:null,member_policy:null,viewer_info_policy:null,resolved_member_policy:null,shared_link_policy:null},"FolderPolicy")){}t.FolderPolicy=f;class g extends(i.Record({change_options:null,disable_viewer_info:null,edit_contents:null,enable_viewer_info:null,invite_editor:null,invite_viewer:null,invite_viewer_no_comment:null,leave_a_copy:null,relinquish_membership:null,remove_download_policy:null,set_download_policy:null,update_confidentiality:null,unmount:null,unshare:null,create_link:null},"FolderPermissions")){}t.FolderPermissions=g;class v extends(i.Record({entries:i.Map(),cursor:null},"ListFoldersResult")){}t.ListFoldersResult=v;class y extends(i.Record({access_type:null,id:null,file_policy:null,link_metadata:null,name:null,owner_team:null,policy:null,parent_shared_folder_id:null,path_display:null,path_lower:null,permissions:null,preview_url:null,time_invited:null,is_cloud_doc:null,invite_info:null},"SharedFileMetadata")){contentId(){return this.id}isSharedFolder(){return!1}isNewSharedFolder(){return!1}nsId(){}isFile(){return!0}isFolder(){return!1}canCreateEditLink(){return this.permissions&&this.permissions.create_edit_link&&this.permissions.create_edit_link.get("allow")}canCreateViewLink(){return this.permissions&&this.permissions.create_view_link&&this.permissions.create_view_link.get("allow")}canEditInbandInvite(){return this.permissions&&this.permissions.invite_editor&&this.permissions.invite_editor.get("allow")}canViewInbandInvite(){return this.permissions&&this.permissions.invite_viewer&&this.permissions.invite_viewer.get("allow")}}t.SharedFileMetadata=y;class b extends(i.Record({change_options:null,disable_viewer_info:null,edit_contents:null,enable_viewer_info:null,invite_viewer:null,invite_editor:null,invite_viewer_no_comment:null,relinquish_membership:null,remove_download_policy:null,set_download_policy:null,unshare:null,view_members:null,create_link:null,create_edit_link:null,create_view_link:null,share_message_as_comment:null},"FilePermissions")){}t.FilePermissions=b;class C extends(i.Record({audience:null,download_policy:null,viewer_info_policy:null},"FilePolicy")){}t.FilePolicy=C;class S extends(i.Record({entries:i.Map(),cursor:null},"ListFilesResult")){}t.ListFilesResult=S;class I extends(i.Record({contentEntries:i.Map(),cursor:null},"ListContentResult")){}t.ListContentResult=I;class k extends(i.Record({cursor:null,invitees:i.Map(),groups:i.Map(),users:i.Map(),memberCount:null},"SharingMembership")){getMemberCount(){return this.memberCount||this.invitees.count()+this.groups.count()+this.users.count()}getTotalMemberCount(e=[]){return this.groups.map(e=>e.member_count||1).reduce((e,t)=>e+t,0)+this.invitees.count()+this.users.filter(t=>!e.includes(t.memberId())).count()}isOnlyMemberInAllGroups(){const e=this.groups;return e&&e.every(e=>!(e.member_count>1)&&(0===e.member_count||e.is_member))}hasInheritedUsers(){return this.users.some(e=>e.is_inherited)}}t.SharingMembership=k;var w;t.makeMemberKey=(e,t)=>`${e}:${t}`,(function(e){e.USERS="users",e.GROUPS="groups",e.INVITEES="invitees"})(w=t.MembershipType||(t.MembershipType={}));class T extends(i.Record({access_type:null,inherited_access_type:null,account:null,account_id:null,initials:null,is_inherited:!1,permissions:null,platform_type:null,same_team:null,team_member_id:null,time_last_seen:null},"UserMembershipInfo")){memberId(){return this.account_id}memberKey(){return(0,t.makeMemberKey)(this.is_inherited,this.memberId())}displayName(){return this.account?this.account.display_name:void 0}contactId(){return this.account_id}contactType(){return"dropbox_id"}type(){return w.USERS}email(){return this.account?this.account.email:void 0}}t.UserMembershipInfo=T;class E extends(i.Record({access_type:null,inherited_access_type:null,contact:null,contact_type:null,initials:!1,is_inherited:null,permissions:null,same_team:null},"InviteeMembershipInfo")){memberId(){return`${this.contact_type}:${this.contact}`}memberKey(){return(0,t.makeMemberKey)(this.is_inherited,this.memberId())}displayName(){return this.contact}contactId(){return this.contact}contactType(){return"email"}type(){return w.INVITEES}}t.InviteeMembershipInfo=E;class A extends(i.Record({access_type:null,inherited_access_type:null,group_external_id:null,group_id:null,group_management_type:null,group_name:null,group_type:null,initials:null,is_inherited:!1,is_member:!1,is_owner:!1,member_count:null,permissions:null,same_team:!0},"GroupMembershipInfo")){memberId(){return this.group_id}memberKey(){return(0,t.makeMemberKey)(this.is_inherited,this.memberId())}displayName(){return this.group_name}contactId(){return this.group_id}contactType(){return"dropbox_id"}type(){return w.GROUPS}}t.GroupMembershipInfo=A;class R extends(i.Record({leave_a_copy:null,make_editor:null,make_owner:null,make_viewer:null,make_viewer_no_comment:null,remove:null},"MemberPermissions")){}t.MemberPermissions=R;class M extends(i.Record({total_unique_users:null,total_unique_inherited_members:null,users_outside_team:null,exceeds_count:!1},"MemberCounts")){}t.MemberCounts=M;class D extends(i.Record({access_level:null,warning:null,parentFolders:null},"MemberAccessLevelResult")){}t.MemberAccessLevelResult=D;class P extends(i.Record({name:null,shared_folder_id:null,path:null,permissions:null},"ParentFolderInfo")){}t.ParentFolderInfo=P;class L extends(i.Record({limit:null,current_count:null,new_count:null},"MountLimitInfo")){}t.MountLimitInfo=L;class x extends(i.Record({url:null,client_modified:null,content_owner_team_info:null,expires:null,require_password:null,file_type:null,id:null,link_permissions:null,name:null,path_lower:null,rev:null,server_modified:null,file_size:null,team_member_info:null,preview_type:null},"LinkMetadata")){isFolder(){return"folder"===this.file_type}teamInfo(){return this.content_owner_team_info?this.content_owner_team_info:this.team_member_info?this.team_member_info.team_info:void 0}accessLevel(){return this.link_permissions.link_access_level}isRighteousLink(){return(0,a.isRighteousLink)(this.link_permissions)}canChangePassword(){return Boolean(this.link_permissions&&this.link_permissions.require_password?this.link_permissions.can_remove_password:this.link_permissions.can_set_password)}canChangeExpiration(){return Boolean(null!=this.expires?this.link_permissions.can_remove_expiry:this.link_permissions.can_set_expiry)}canChangeDownload(){return Boolean(this.link_permissions&&this.link_permissions.allow_download?this.link_permissions.can_disallow_download:this.link_permissions.can_allow_download)}}t.LinkMetadata=x;class O extends(i.Record({link_password:null,expires:null,allow_download:null,audience:null,require_password:null,display_expiration_warning:null,display_password_warning:null},"LinkPolicy")){}t.LinkPolicy=O;class N extends(i.Record({allow_comments:null,can_revoke:null,allow_download:null,can_allow_download:null,can_disallow_download:null,can_set_expiry:null,can_remove_expiry:null,can_set_password:null,can_remove_password:null,require_password:null,effective_audience:null,link_access_level:null,requested_visibility:null,resolved_visibility:null,restricting_shared_folder_path:null,revoke_failure_reason:null,team_restricts_comments:null,visibility_policies:null,audience_options:null,can_use_extended_sharing_controls:null,days_to_expire_policy:null,change_shared_link_expiration_policy:null,enforce_shared_link_password_policy:null},"LinkPermissions")){canChangeDownload(){return null!=this.can_disallow_download&&null!=this.can_allow_download&&null!=this.allow_download}}t.LinkPermissions=N;class F extends(i.Record({policy:null,resolved_policy:null,allowed:null,disallowed_reason:null},"LinkVisibilityPolicy")){}t.LinkVisibilityPolicy=F,(function(e){e.DeleteAndRecreate="delete_and_recreate",e.RestrictedBySharedFolder="restricted_by_shared_folder",e.RestrictedByTeam="restricted_by_team",e.UserAccountType="user_account_type",e.UserNotOnTeam="user_not_on_team",e.PermissionDenied="permission_denied"})(t.LinkAudienceDisallowedReason||(t.LinkAudienceDisallowedReason={}));class j extends(i.Record({audience:null,allowed:null,disallowed_reason:null},"LinkAudienceOption")){}t.LinkAudienceOption=j;class U extends(i.Record({in_server_side_contact_validation_settings:!1,in_server_side_contact_search_settings:"OFF",create_nested_shared_folder_variant:"OFF",efl_delay_namespace_creation_enabled:!1,confidential_folder_links_enabled:!1,in_share_modal_upsell_premium_sharing:!1,in_share_modal_upsell_premium_sharing_variant:"OFF",has_seen_share_modal_upsell_premium_sharing_counter:0,invite_or_request_after_sharing_modal_variant:"not_enabled",has_seen_esign_post_sharing:!1,is_in_esign_post_sharing_exclusion_period:!1,sharing_sdk_tokenizer_variant:"OFF",bsx_organize_around_people:!1,core_act_receiver_red_carpet_variant:"OFF",exp_links_in_member_list:"OFF",links_in_member_list_in_paper_share_modal:"OFF",is_showing_file_upload_toolkit_campaign:!1,user_level_sharing_settings_client_variant:"OFF",default_sharing_access_level:0,default_sharing_link_audience:0,capture_sdk_integration_voice_overs_variant:"OFF"},"SharingPrefs")){}t.SharingPrefs=U;class q extends(i.Record({shared_folder_id:null,name:null,audience:null},"AudienceRestrictingSharedFolder")){}t.AudienceRestrictingSharedFolder=q,t.ContentTypes={File:{".tag":"file"},Folder:{".tag":"folder"}}})),define("metaserver/static/js/sharing/api/util/types",["require","exports","tslib","metaserver/static/js/contacts/types","immutable","metaserver/static/js/api_v2/types","metaserver/static/js/pass/utils","metaserver/static/js/sharing/access_level","metaserver/static/js/sharing/link_info","metaserver/static/js/sharing/api/types/metadata"],(function(e,t,s,i,r,n,a,o,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.combinedPolicyDiffToApi=t.createUnionScalar=t.contactsToMembers=t.contactToMember=t.parseSharedLinkMetadata=t.makeMemberSelector=t.sharingPrefsApiToRecord=t.lightweightAccountApiToRecord=t.fullAccountApiToRecord=t.teamSharingPoliciesApiToRecord=t.accountInfoApiToRecord=t.linkMetadataApiToRecord=t.linkPermissionsApiToRecord=t.audienceOptionApiToRecord=t.visibilityPolicyApiToRecord=t.teamMemberInfoApiToRecord=t.memberAccessLevelApiToRecord=t.parentFolderInfoApiToRecord=t.memberCountsApiToRecord=t.membershipApiToRecord=t.userMembershipApiToRecord=t.groupMembershipApiToRecord=t.inviteeMembershipApiToRecord=t.memberPermissionsApiToRecord=t.listContentResultApiToRecord=t.listFilesResultApiToRecord=t.fileMetadataApiToRecord=t.getFilePolicy=t.filePermissionsApiToRecord=t.listFoldersResultApiToRecord=t.folderMetadataApiToRecord=t.folderPermissionsApiToRecord=t.parseFolderPolicy=t.audienceRestrictingSharedFolderToRecord=t.folderPolicyApiToRecord=t.hasFolderMetadataRecordInMetadata=t.platformTypeApiToConst=t.groupManagementTypeApiToConst=t.accessLevelApiToConst=t.rawAccessLevelConstToApi=t.accessLevelConstToApi=void 0,i=s.__importDefault(i),r=s.__importStar(r);t.accessLevelConstToApi=e=>{const s=(0,t.rawAccessLevelConstToApi)(e);return new n.UnionScalar(s[".tag"])};t.rawAccessLevelConstToApi=e=>{switch(e){case o.ACCESS_LEVEL.OWNER:return{".tag":"owner"};case o.ACCESS_LEVEL.WRITER:return{".tag":"editor"};case o.ACCESS_LEVEL.READER:return{".tag":"viewer"};case o.ACCESS_LEVEL.READER_NO_COMMENT:return{".tag":"viewer_no_comment"};default:throw new Error("unknown access level: "+e)}};t.accessLevelApiToConst=e=>{switch(e.type||e){case"owner":return o.ACCESS_LEVEL.OWNER;case"editor":return o.ACCESS_LEVEL.WRITER;case"viewer":return o.ACCESS_LEVEL.READER;case"viewer_no_comment":return o.ACCESS_LEVEL.READER_NO_COMMENT}};t.groupManagementTypeApiToConst=e=>{if(!e)return null;switch(e[".tag"]){case"user_managed":return c.GroupManagementType.user_managed;case"company_managed":return c.GroupManagementType.company_managed;case"system_managed":return c.GroupManagementType.system_managed;default:return}};t.platformTypeApiToConst=e=>(0,a.parsePlatformString)(e.type);t.hasFolderMetadataRecordInMetadata=e=>null!=e.path_lower&&null!=e.access_type&&null!=e.policy;t.folderPolicyApiToRecord=e=>null==e?new c.FolderPolicy:new c.FolderPolicy({acl_update_policy:e.acl_update_policy&&e.acl_update_policy[".tag"],download_policy:e.download_policy&&e.download_policy[".tag"],member_policy:e.member_policy&&e.member_policy[".tag"],resolved_member_policy:e.resolved_member_policy&&e.resolved_member_policy[".tag"],shared_link_policy:e.shared_link_policy&&e.shared_link_policy[".tag"],viewer_info_policy:e.viewer_info_policy&&e.viewer_info_policy[".tag"]});t.audienceRestrictingSharedFolderToRecord=e=>new c.AudienceRestrictingSharedFolder({shared_folder_id:e.shared_folder_id,name:e.name,audience:e.audience[".tag"]}),t.parseFolderPolicy=t.folderPolicyApiToRecord;t.folderPermissionsApiToRecord=e=>{const t=(e=>{const t={};for(const s of e)t[s.action[".tag"]]=new c.PermissionSetting({allow:s.allow,reason:s.reason?s.reason[".tag"]:void 0});return t})(e);return new c.FolderPermissions(t)};t.folderMetadataApiToRecord=e=>new c.SharedFolderMetadata({access_type:(0,t.accessLevelApiToConst)(n.Union.parse(e.access_type)),is_inside_team_folder:e.is_inside_team_folder,is_team_folder:e.is_team_folder,members_cursor:e.members_cursor,name:e.name,owner_team:null!=e.owner_team?new c.Team(e.owner_team):void 0,parent_shared_folder_id:e.parent_shared_folder_id,path_lower:e.path_lower,permissions:null!=e.permissions?(0,t.folderPermissionsApiToRecord)(e.permissions):void 0,policy:(0,t.parseFolderPolicy)(e.policy),preview_url:e.preview_url,shared_folder_id:e.shared_folder_id,time_invited:null!=e.time_invited?new Date(e.time_invited):void 0,is_confidential:null!=e.is_confidential?e.is_confidential:void 0,folder_size:null!=e.folder_size?e.folder_size:void 0,can_mount:null!=e.can_mount?e.can_mount:void 0,invite_info:null!=e.invite_info?e.invite_info:void 0,parent_folder_name:e.parent_folder_name});t.listFoldersResultApiToRecord=e=>new c.ListFoldersResult({entries:r.Map(e.entries.map(t.folderMetadataApiToRecord).map(e=>[e.shared_folder_id,e])),cursor:e.cursor});t.filePermissionsApiToRecord=e=>{const t={};if(e)for(const s of e)t[s.action[".tag"]]=new c.PermissionSetting({allow:s.allow,reason:s.reason&&s.reason[".tag"]});return new c.FilePermissions(t)};t.getFilePolicy=e=>{const t={};return t[c.ViewerInfoPolicy.policy_name]=e&&e.viewer_info_policy&&e.viewer_info_policy[".tag"],t[c.DownloadPolicy.policy_name]=e&&e.download_policy&&e.download_policy[".tag"]||c.DownloadPolicy.allow,new c.FilePolicy(t)};t.fileMetadataApiToRecord=e=>new c.SharedFileMetadata({access_type:null!=e.access_type?(0,t.accessLevelApiToConst)(n.Union.parse(e.access_type)):o.ACCESS_LEVEL.READER,id:e.id,file_policy:(0,t.getFilePolicy)(e.policy),is_cloud_doc:null!=e.is_cloud_doc&&e.is_cloud_doc,name:e.name,owner_team:e.owner_team&&new c.Team(e.owner_team),policy:null!=e.policy?(0,t.parseFolderPolicy)(e.policy):new c.FolderPolicy,parent_shared_folder_id:e.parent_shared_folder_id,path_display:e.path_display,path_lower:e.path_lower,permissions:(0,t.filePermissionsApiToRecord)(e.permissions),preview_url:e.preview_url,time_invited:e.time_invited&&new Date(e.time_invited),invite_info:null!=e.invite_info?e.invite_info:void 0});t.listFilesResultApiToRecord=e=>new c.ListFilesResult({entries:r.Map(e.entries.map(e=>[e.id,(0,t.fileMetadataApiToRecord)(e)])),cursor:e.cursor});t.listContentResultApiToRecord=e=>new c.ListContentResult({contentEntries:r.Map(e.entries.map(e=>e.shared_folder_id?[e.shared_folder_id,(0,t.folderMetadataApiToRecord)(e)]:[e.id,(0,t.fileMetadataApiToRecord)(e)])),cursor:e.has_more?e.cursor:null});t.memberPermissionsApiToRecord=e=>{const t={};if(null!=e)for(const s of e)t[s.action[".tag"]]=new c.PermissionSetting({allow:s.allow,reason:s.reason&&s.reason[".tag"]});return new c.MemberPermissions(t)};t.inviteeMembershipApiToRecord=e=>{let s=void 0;e.inherited_access_type&&(s=(0,t.accessLevelApiToConst)(n.Union.parse(e.inherited_access_type)));const i=e.invitee[".tag"];return new c.InviteeMembershipInfo({access_type:(0,t.accessLevelApiToConst)(n.Union.parse(e.access_type)),inherited_access_type:s,contact:e.invitee[i],contact_type:i,initials:e.initials,is_inherited:e.is_inherited,permissions:(0,t.memberPermissionsApiToRecord)(e.permissions),same_team:Boolean(e.user&&e.user.same_team)})};t.groupMembershipApiToRecord=e=>{let s=void 0;return e.inherited_access_type&&(s=(0,t.accessLevelApiToConst)(n.Union.parse(e.inherited_access_type))),new c.GroupMembershipInfo({access_type:(0,t.accessLevelApiToConst)(n.Union.parse(e.access_type)),inherited_access_type:s,group_external_id:e.group.group_external_id,group_id:e.group.group_id,group_management_type:(0,t.groupManagementTypeApiToConst)(e.group.group_management_type),group_name:e.group.group_name,group_type:e.group.group_type[".tag"],initials:e.initials,is_inherited:e.is_inherited,is_member:e.group.is_member,is_owner:e.group.is_owner,member_count:e.group.member_count,permissions:(0,t.memberPermissionsApiToRecord)(e.permissions),same_team:e.group.same_team})};t.userMembershipApiToRecord=e=>{let s=void 0;return e.inherited_access_type&&(s=(0,t.accessLevelApiToConst)(n.Union.parse(e.inherited_access_type))),new c.UserMembershipInfo({access_type:(0,t.accessLevelApiToConst)(n.Union.parse(e.access_type)),inherited_access_type:s,account_id:e.user.account_id,initials:e.initials,is_inherited:e.is_inherited,permissions:(0,t.memberPermissionsApiToRecord)(e.permissions),platform_type:e.platform_type&&(0,t.platformTypeApiToConst)(n.Union.parse(e.platform_type)),same_team:e.user.same_team,team_member_id:e.user.team_member_id,time_last_seen:e.time_last_seen&&new Date(e.time_last_seen)})};t.membershipApiToRecord=(e,s=null)=>new c.SharingMembership({cursor:e.cursor,invitees:r.Map(e.invitees.map(e=>{const s=(0,t.inviteeMembershipApiToRecord)(e);return[s.memberKey(),s]})),groups:r.Map(e.groups.map(e=>{const s=(0,t.groupMembershipApiToRecord)(e);return[s.memberKey(),s]})),users:r.Map(e.users.map(e=>{const s=(0,t.userMembershipApiToRecord)(e);return[s.memberKey(),s]})),memberCount:s});t.memberCountsApiToRecord=e=>new c.MemberCounts(e);t.parentFolderInfoApiToRecord=e=>new c.ParentFolderInfo({name:e.folder_name,shared_folder_id:e.shared_folder_id,path:e.path,permissions:(0,t.memberPermissionsApiToRecord)(e.permissions)});t.memberAccessLevelApiToRecord=(e,s)=>{if(null==s)return new c.MemberAccessLevelResult;let i;return null!=s.access_details&&(i=s.access_details.map(e=>(0,t.parentFolderInfoApiToRecord)(e))),new c.MemberAccessLevelResult({access_level:s.access_level&&(0,t.accessLevelApiToConst)(n.Union.parse(s.access_level)),warning:s.warning,parentFolders:i})};t.teamMemberInfoApiToRecord=e=>null==e?null:new c.TeamMemberInfo({display_name:e.display_name,member_id:e.member_id,team_info:e.team_info&&new c.Team(e.team_info)});t.visibilityPolicyApiToRecord=e=>new c.LinkVisibilityPolicy({policy:e.policy&&e.policy[".tag"],resolved_policy:e.resolved_policy&&e.resolved_policy[".tag"],allowed:e.allowed,disallowed_reason:e.disallowed_reason&&e.disallowed_reason[".tag"]});t.audienceOptionApiToRecord=e=>new c.LinkAudienceOption({audience:e.audience[".tag"],allowed:e.allowed,disallowed_reason:e.disallowed_reason&&e.disallowed_reason[".tag"]});t.linkPermissionsApiToRecord=e=>null==e?new c.LinkPermissions:new c.LinkPermissions({allow_download:e.allow_download,allow_comments:e.allow_comments,can_allow_download:e.can_allow_download,can_disallow_download:e.can_disallow_download,can_revoke:e.can_revoke,can_set_expiry:e.can_set_expiry,can_remove_expiry:e.can_remove_expiry,can_set_password:e.can_set_password,can_remove_password:e.can_remove_password,require_password:e.require_password,requested_visibility:e.requested_visibility&&e.requested_visibility[".tag"],resolved_visibility:e.resolved_visibility&&e.resolved_visibility[".tag"],restricting_shared_folder_path:e.restricting_shared_folder_path,revoke_failure_reason:e.revoke_failure_reason&&e.revoke_failure_reason[".tag"],team_restricts_comments:e.team_restricts_comments,visibility_policies:e.visibility_policies&&e.visibility_policies.map(t.visibilityPolicyApiToRecord),audience_options:e.audience_options&&e.audience_options.map(t.audienceOptionApiToRecord),effective_audience:e.effective_audience&&e.effective_audience[".tag"],link_access_level:e.link_access_level&&e.link_access_level[".tag"],can_use_extended_sharing_controls:e.can_use_extended_sharing_controls,days_to_expire_policy:e.days_to_expire_policy?e.days_to_expire_policy[".tag"]:"none",change_shared_link_expiration_policy:e.change_shared_link_expiration_policy?e.change_shared_link_expiration_policy[".tag"]:"allowed",enforce_shared_link_password_policy:e.enforce_shared_link_password_policy?e.enforce_shared_link_password_policy[".tag"]:"optional"});t.linkMetadataApiToRecord=e=>new c.LinkMetadata({url:e.url,client_modified:e.client_modified&&new Date(e.client_modified),content_owner_team_info:e.content_owner_team_info&&new c.Team(e.content_owner_team_info),expires:e.expires&&new Date(e.expires),file_type:e[".tag"],id:e.id,link_permissions:(0,t.linkPermissionsApiToRecord)(e.link_permissions),name:e.name,path_lower:e.path_lower,rev:e.rev,server_modified:e.server_modified&&new Date(e.server_modified),file_size:e.size,team_member_info:(0,t.teamMemberInfoApiToRecord)(e.team_member_info),preview_type:e.preview_type});t.accountInfoApiToRecord=e=>new c.BasicAccount({account_id:e.account_id,disabled:e.disabled,display_name:e.name.display_name,email:e.email,email_verified:e.email_verified,familiar_name:e.name.familiar_name,given_name:e.name.given_name,is_teammate:e.is_teammate,profile_photo_url:e.profile_photo_url,surname:e.name.surname,team_member_id:e.team_member_id});t.teamSharingPoliciesApiToRecord=e=>e&&new c.TeamSharingPolicies({shared_folder_member_policy:e.shared_folder_member_policy&&e.shared_folder_member_policy[".tag"],shared_folder_join_policy:e.shared_folder_join_policy&&e.shared_folder_join_policy[".tag"],shared_link_create_policy:e.shared_link_create_policy&&e.shared_link_create_policy[".tag"],group_creation_policy:e.group_creation_policy&&e.group_creation_policy[".tag"]});t.fullAccountApiToRecord=e=>{const s=e.team&&new c.FullTeam({id:e.team.id,name:e.team.name,sharing_policies:(0,t.teamSharingPoliciesApiToRecord)(e.team.sharing_policies)});return new c.FullAccount({account_id:e.account_id,disabled:e.disabled,display_name:e.name.display_name,email:e.email,email_verified:e.email_verified,familiar_name:e.name.familiar_name,given_name:e.name.given_name,profile_photo_url:e.profile_photo_url,surname:e.name.surname,team_member_id:e.team_member_id,team:s,is_family_user:e.is_family_user})};t.lightweightAccountApiToRecord=e=>new c.LightweightAccount({team_policies:(0,t.teamSharingPoliciesApiToRecord)(e.team_policies),is_team_member:e.is_team_member,is_family_user:e.is_family_user});t.sharingPrefsApiToRecord=e=>{var t;return new c.SharingPrefs({in_server_side_contact_validation_settings:Boolean(e.in_server_side_contact_validation_settings),in_server_side_contact_search_settings:e.in_server_side_contact_search_settings,create_nested_shared_folder_variant:e.create_nested_shared_folder_variant,efl_delay_namespace_creation_enabled:e.efl_delay_namespace_creation_enabled,confidential_folder_links_enabled:e.confidential_folder_links_enabled,in_share_modal_upsell_premium_sharing:Boolean(e.in_share_modal_upsell_premium_sharing),in_share_modal_upsell_premium_sharing_variant:e.in_share_modal_upsell_premium_sharing_variant,has_seen_share_modal_upsell_premium_sharing_counter:e.has_seen_share_modal_upsell_premium_sharing_counter,invite_or_request_after_sharing_modal_variant:null===(t=e.invite_or_request_after_sharing_modal_variant)||void 0===t?void 0:t[".tag"],has_seen_esign_post_sharing:e.has_seen_esign_post_sharing,is_in_esign_post_sharing_exclusion_period:e.is_in_esign_post_sharing_exclusion_period,sharing_sdk_tokenizer_variant:e.sharing_sdk_tokenizer_variant,bsx_organize_around_people:e.bsx_organize_around_people,core_act_receiver_red_carpet_variant:e.core_act_receiver_red_carpet_variant,exp_links_in_member_list:e.exp_links_in_member_list,links_in_member_list_in_paper_share_modal:e.links_in_member_list_in_paper_share_modal_variant,is_showing_file_upload_toolkit_campaign:e.is_showing_file_upload_toolkit_campaign,user_level_sharing_settings_client_variant:e.user_level_sharing_settings_client_variant,default_sharing_access_level:e.default_sharing_access_level,default_sharing_link_audience:e.default_sharing_link_audience,capture_sdk_integration_voice_overs_variant:e.capture_sdk_integration_voice_overs_variant})};t.makeMemberSelector=e=>e.startsWith("email:")?new n.UnionScalar("email",e.substr(6)):new n.UnionScalar("dropbox_id",e);t.parseSharedLinkMetadata=e=>{if(null==e)return null;const t=n.Union.parse(e.link_permissions.resolved_visibility).type,s=null!=e.team_member_info?{teamId:e.team_member_info.team_info.id,teamName:e.team_member_info.team_info.name}:{teamId:null,teamName:null},i={isFolder:"folder"===e[".tag"],url:e.url,name:e.name,expires:e.expires&&new Date(e.expires),visibility:t,isPackage:e.is_package};return new l.LinkInfo(Object.assign(Object.assign({},i),s))};t.contactToMember=(e,t=!1)=>{if(e.type===i.default.NEW_STYLE_GROUP)return{".tag":"dropbox_id",dropbox_id:e.getContactID()};if(t&&e.type===i.default.EMAIL&&e.dbx_account_id)return{".tag":"dropbox_id",dropbox_id:e.dbx_account_id};if(e.type!==i.default.INVALID_ID)return{".tag":"email",email:e.getContactID()};throw new Error("Unknown contact type")};t.contactsToMembers=(e,s=!1)=>e.map(e=>(0,t.contactToMember)(e,s));t.createUnionScalar=(e,t)=>new n.UnionScalar(e,t);t.combinedPolicyDiffToApi=e=>{const t={};return e?(null!=e.acl_update_policy&&(t.acl_update_policy=e.acl_update_policy),null!=e.member_policy&&(t.member_policy=e.member_policy),null!=e.shared_link_policy&&(t.shared_link_policy=e.shared_link_policy),null!=e.download_policy&&(t.download_policy=e.download_policy),null!=e.viewer_info_policy&&(t.viewer_info_policy=e.viewer_info_policy),t):t}})),define("metaserver/static/js/sharing/link_info",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LinkInfo=void 0;t.LinkInfo=class{constructor({expires:e,isFolder:t,name:s,teamId:i,teamName:r,url:n,visibility:a,isPackage:o}){this.expires=e,this.isFolder=t,this.name=s,this.teamId=i,this.teamName=r,this.url=n,this.visibility=a,this.isPackage=o}}})),define("metaserver/static/js/teams/admin/api/admin_console_api_client",["require","exports","tslib","metaserver/static/js/api_v2/types","metaserver/static/js/cloud_docs/types","metaserver/static/js/profile_services/profile_services_constants","metaserver/static/js/api_v2/default_team_client","js/filepath/filepath","metaserver/static/js/sharing/api/util/types","metaserver/static/js/clean/viewer","metaserver/static/js/teams/admin/widgets/settings_content_management/constants/constants","metaserver/static/js/api_v2/user_client"],(function(e,t,s,i,r,n,a,o,l,c,d,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.AdminConsoleApiClient=void 0,n=s.__importDefault(n),o=s.__importStar(o);const _=e=>({".tag":"email",email:e});class p{constructor(e=!1){this.isCMForCDM=e;const t=c.Viewer.get_viewer().get_user_by_role("work");t&&(t.team_member_id&&(this.selectAdminParams={headers:{[i.ApiV2HeaderNames.DropboxApiSelectAdmin]:t.team_member_id}}),this.teamClient=new a.DefaultTeamApiV2Client(t))}teamRoutes(){return this.teamClient.ns("team")}domainRoutes(){return this.teamClient.ns("domains")}teamMembersInternal(){return this.teamClient.ns("team_members_internal")}teamInsightsRoutes(){return this.teamClient.ns("team_insights")}teamAdminAlertingRoutes(){return this.teamClient.ns("admin_alerting")}teamLogRoutes(){return this.teamClient.ns("team_log")}usersRoutes(){return this.teamClient.ns("users")}filesRoutes(){return this.teamClient.ns("files")}sharingRoutes(){return this.teamClient.ns("sharing")}federationRoutes(){return this.teamClient.ns("federation")}fileTransfersRoutes(){return this.teamClient.ns("file_transfers")}emailIngestRoutes(){return this.teamClient.ns("email_ingest")}cloudDocsRoutes(){return this.teamClient.ns("cloud_docs")}setPermanentDeletePolicy(e){return this.teamRoutes().rpc("set_permanent_delete_policy",{permanent_delete_enabled:e},{})}setContentAdministrationPolicy(e){const t={".tag":d.ContentAdministrationPolicyValue[e]};return this.teamRoutes().rpc("set_content_administration_policy",{content_administration_policy:t},{})}setRewindPolicy(e){const t={".tag":e};return this.teamRoutes().rpc("set_rewind_policy",{rewind_policy:t},{})}setCloudDocsPolicy(e,t){const s={};if(s[r.CloudDocProviderIntegration.GDD_INTEGRATION.toString()]=e?r.IntegrationCreateAndEdit:r.IntegrationViewOnly,"boolean"==typeof t){s[r.CloudDocProviderIntegration.PAPER_INTEGRATION.toString()]=t?r.IntegrationCreateAndEdit:r.IntegrationViewOnly}return this.cloudDocsRoutes().rpc("team_settings/set",{settings:s},this.selectAdminParams)}setMultipleAccountsPolicy(e){return this.teamRoutes().rpc("set_multiple_accounts_policy",{multiple_accounts_enabled:e},{})}setSendForSignaturePolicy(e){return this.teamRoutes().rpc("set_send_for_signature_policy",{send_for_signature_enabled:e},{})}setSecondaryEmailsPolicy(e){const t=e?{".tag":"enabled"}:{".tag":"disabled"};return this.teamRoutes().rpc("set_secondary_mails_policy",{secondary_mails_policy:t},{})}setClassificationPolicyOld(e){const t=e?{".tag":"enabled"}:{".tag":"disabled"};return this.teamRoutes().rpc("classification/set_classification_policy",{classification_policy:t},{})}setClassificationPolicy(e){const t=e;return this.teamRoutes().rpc("classification/set_classification_policy",{classification_policy:t},{})}generateClassificationReport(){return this.teamRoutes().rpc("classification/generate_report",void 0,{})}setCameraUploadsPolicy(e){const t=e?{".tag":"enabled"}:{".tag":"disabled"};return this.teamRoutes().rpc("set_camera_uploads_policy",{camera_uploads_policy:t},{})}setFileLockingPolicy(e){const t=e?{".tag":"enabled"}:{".tag":"disabled"};return this.teamRoutes().rpc("set_file_locking_policy",{file_locking_policy:t},{})}setSmarterSmartSyncPolicy(e){const t=e?{".tag":"enabled"}:{".tag":"disabled"};return this.teamRoutes().rpc("set_smarter_smart_sync_policy",{smarter_smart_sync_policy:t},{})}setComputerBackupPolicy(e){const t=e?{".tag":"enabled"}:{".tag":"disabled"};return this.teamRoutes().rpc("set_computer_backup_policy",{computer_backup_policy:t},{})}setExternalDriveBackupPolicy(e){const t=e?{".tag":"enabled"}:{".tag":"disabled"};return this.teamRoutes().rpc("set_external_drive_backup_policy",{external_drive_backup_policy:t},{})}setFileProviderMigrationPolicy(e){const t=e?{".tag":"enabled"}:{".tag":"disabled"};return this.teamRoutes().rpc("set_file_provider_migration_policy",{file_provider_migration_policy:t},{})}updateAppActionSettings(e,t){return this.teamRoutes().rpc("app_actions/update_settings",{allow_actions:e,action_state_updates:t.map(e=>({id:e.id,is_enabled:!e.isIndividuallyDisabled}))},{})}updateTeamIntegrationSettings(e){const t={},s=e.find(e=>"zoom"===e.id);s&&s.teamSettings&&(t.zoom_team_settings={meeting_recordings_disabled_by_admin:s.teamSettings.zoomMeetingRecordingsDisabledByAdmin});const i=e.find(e=>"canvas"===e.id);i&&i.teamSettings&&(t.canvas_team_settings={canvas_custom_api_domain:i.teamSettings.canvasCustomApiDomain});const r=[],a=e.find(e=>"google"===e.id);return a&&a.teamSettings&&r.push((new u.UserApiV2Client).ns("domain_contacts").rpc("disconnect",{service:n.default.to_api_service_type(n.default.GOOGLE)},{subjectUserId:c.Viewer.get_viewer().work_user.id})),(t.canvas_team_settings||t.zoom_team_settings)&&r.push(this.teamRoutes().rpc("integrations/set_team_integration_settings",t,{})),Promise.all(r)}updateCanvasIntegrationSettings(e){return this.teamRoutes().rpc("integrations/set_team_integration_settings",{canvas_team_settings:{canvas_custom_api_domain:e}},{})}updateCommunicationAppSettings(e){const t=e.find(e=>"google"===e.id);return t&&((new u.UserApiV2Client).ns("domain_contacts").rpc("set_feature",{service:n.default.to_api_service_type(n.default.GOOGLE),action:{".tag":t.isIndividuallyDisabled?"disable":"enable"}},{subjectUserId:c.Viewer.get_viewer().work_user.id}),t.preventFurtherChanges=!1),this.teamRoutes().rpc("profile_services/set_service_enabled_states",{enabled_state_updates:e.map(e=>({service:{".tag":e.id},is_enabled:!e.isIndividuallyDisabled}))},{})}updateCoordinationAppSettings(e){return this.teamRoutes().rpc("profile_services/set_service_enabled_states",{enabled_state_updates:e.map(e=>({service:{".tag":e.id},is_enabled:!e.isIndividuallyDisabled}))},{})}setFileRequestPolicy(e){return this.teamRoutes().rpc("sharing/set_file_request_policy",{file_request_enabled:e},{})}setCaptureTranscriptPolicy(e){return this.teamRoutes().rpc("ml_platform/set_team_capability_policy",{updated_capability_policies:[{capability:{".tag":"transcription"},product:{".tag":"capture"},opt_policy:{".tag":e?"opt_in":"opt_out"}}]},{})}setDropboxPasswordsPolicy(e){return this.teamRoutes().rpc("dropbox_passwords/set_dropbox_passwords_policy",{dropbox_passwords_policy:{".tag":e?"enabled":"disabled"}},{})}setEmailIngestPolicy(e){return this.emailIngestRoutes().rpc("teams/set_policy",{email_ingest_enabled:e},{})}setOfficeAddInPolicy(e){return this.teamRoutes().rpc("set_office_addin_policy",{office_addin_enabled:e},{})}setSharedLinkPolicy(e,t){const s={sharing_outside_enabled:e};return e&&(s.default_visibility=t),this.teamRoutes().rpc("sharing/set_shared_link_policy",s,{})}setSharedLinkControlPolicy(e,t){const s={days_to_expire_policy:{".tag":e.daysToExpire},change_shared_link_expiration_policy:e.changeSharedLinkExpirationPolicy?{".tag":e.changeSharedLinkExpirationPolicy}:void 0,enforce_shared_link_password_policy:t?{".tag":t}:void 0};return this.teamRoutes().rpc("sharing/set_shared_link_control_policy",s,{})}setSharedFolderSharingPolicy(e,t){return t?this.teamRoutes().rpc("sharing/set_shared_folder_sharing_policy",{sharing_outside_enabled:e,external_sharing_policy:{".tag":t}},{}):this.teamRoutes().rpc("sharing/set_shared_folder_sharing_policy",{sharing_outside_enabled:e},{})}setSharedFolderJoiningPolicy(e){return this.teamRoutes().rpc("sharing/set_shared_folder_joining_policy",{joining_outside_enabled:e},{})}setFileTransfersPolicy(e){return this.fileTransfersRoutes().rpc("teams/set_file_transfers_policy",{file_transfers_enabled:e},{})}setCommentingPolicy(e){return this.teamRoutes().rpc("sharing/set_commenting_policy",{commenting_enabled:e},{})}setPasswordStrength(e,t){const s="enabled"===e?t:"minimal_requirements";return this.teamRoutes().rpc("set_password_requirements",{password_strength_policy:s},{})}resetAllPasswords(){return this.teamRoutes().rpc("reset_all_passwords",void 0,{})}setViewerInfoSetting(e){return this.teamRoutes().rpc("set_viewer_info_policy",{viewer_info_policy:e},{})}setPaperPolicy(e,t,s,i){const r={paper_enabled:e,paper_deployment_mode:{paper_deployment_type:s,enabled_members_update:{users_to_add:this.make_user_selector_list(i.users_to_add),users_to_remove:this.make_user_selector_list(i.users_to_remove)}}};return t&&(r.dropbox_terms="agree"),this.teamRoutes().rpc("paper/set_paper_policy",r,{})}setPaperSharingPolicy(e=!0,t){const s={external_sharing_allowed:void 0===e||e,default_visibility:t};return this.teamRoutes().rpc("paper/set_paper_sharing_policy",s,{})}setPaperDefaultFolderPolicy(e){return this.teamRoutes().rpc("paper/set_paper_default_folder_policy",{default_folder_policy:e},{})}setPaperDesktopPolicy(e){return this.teamRoutes().rpc("paper/set_paper_desktop_policy",{enabled:e},{})}schedulePiFSMigration(e,t){return this.teamRoutes().rpc("paper/schedule_pifs_migration",{scheduled_migration_timestamp:e,admin_wants_team_members_notified:t},{})}removeScheduledPiFSMigration(){return this.teamRoutes().rpc("paper/remove_scheduled_pifs_migration",void 0,{})}setShowcasePolicy(e,t,s){const i={showcase_enabled:e,external_sharing_enabled:t,download_enabled:s};return this.teamRoutes().rpc("showcase/set_showcase_policy",i,{})}setRequestMembershipPolicy(e){return this.teamRoutes().rpc("set_request_membership_policy",{request_membership:e},{})}setSuggestMembersPolicy(e){return this.teamRoutes().rpc("set_suggest_members_policy",{suggest_members_enabled:e},{})}setInviteAcceptanceEmailPolicy(e){return this.teamRoutes().rpc("set_invite_acceptance_email_policy",{enable:e},{})}setMembersSendInvitePolicy(e,t,s,i){const r={member_send_invite_policy:e,can_send_invite_member_list_changes:{users_to_add:t.users_to_add.map(_),users_to_remove:t.users_to_remove.map(_)},source:s,domain_restriction_enabled:i};return this.teamRoutes().rpc("set_member_send_invite_policy",r,{})}setWatermarkingPolicy(e){return this.teamRoutes().rpc("workflows/set_watermarking_policy",{watermarking_policy:{".tag":e?"on":"off"}},{})}deviceManagementGetExcludedUsers(){return this.teamRoutes().rpc("device_management/get_excluded_users",void 0,{})}deviceManagementConfigureSettings(e){return this.teamRoutes().rpc("device_management/configure_settings",e,{})}static mapValueToRolloutMethod(e){return 0===e?"unlink_all":1===e?"unlink_most_inactive":"add_member_to_exceptions"}deviceManagementConfigureSettingsForAcf(e,t,s,i,r){const n={is_enabled:!0,can_user_remove_device:t,rollout_method:{".tag":p.mapValueToRolloutMethod(r)},users_to_add:e.users_to_add,users_to_remove:e.users_to_remove,desktop_devices_limit:-1===s?{".tag":"unlimited"}:{limited:Number(s),".tag":"limited"},mobile_devices_limit:-1===i?{".tag":"unlimited"}:{limited:Number(i),".tag":"limited"}};return this.teamRoutes().rpc("device_management/configure_settings",n,{})}deviceManagementConfigureSettingsDisable(){return this.teamRoutes().rpc("device_management/configure_settings",{is_enabled:!1},{})}deviceManagementRemoveDevice(e,t,s){return this.teamRoutes().rpc("device_management/remove_device",{user_id:e,device_id:t,delete_data:s},{})}deviceManagementRemoveClient(e,t,s,i){return this.teamRoutes().rpc("device_management/remove_client",{user_id:e,device_id:t,client_unique_identifier:s,delete_data:i},{})}webSessionManagementConfigureSettings(e,t,s){return this.teamRoutes().rpc("web_session_management/configure_settings",{remember_session_expires:e,idle_session_timeout:t,number_of_allowed_sessions:s},{})}teamFolderArchive(e,t=!1){return this.teamRoutes().rpc("team_folder/archive",{team_folder_id:String(e),force_async_off:!t},{})}teamFolderUnarchive(e){return this.teamRoutes().rpc("team_folder/activate",{team_folder_id:String(e)},{})}teamFolderCreate(e,t){const s={name:e};return void 0!==t&&(s.sync_setting=t?{".tag":"default"}:{".tag":"not_synced"}),this.teamRoutes().rpc("team_folder/create",s,{})}teamFolderUpdateSyncSetting({teamFolderId:e,syncSetting:t,fileIds:s}){const i={team_folder_id:e},r={".tag":t};return s?i.content_sync_settings=s.map(e=>({id:e,sync_setting:r})):i.sync_setting=r,this.teamRoutes().rpc("team_folder/update_sync_settings",i,{})}teamFoldersList(e=1e3){return this.teamRoutes().rpc("team_folder/list",{limit:e},{})}teamFoldersListContinue(e){return this.teamRoutes().rpc("team_folder/list/continue",{cursor:e},{})}teamNamespacesList(){return this.teamRoutes().rpc("namespaces/list",{filter:{".tag":"eligible_for_cm_top_level_page"}},{})}teamNamespacesListContinue(e){return this.teamRoutes().rpc("namespaces/list/continue",{cursor:e,filter:{".tag":"eligible_for_cm_top_level_page"}},{})}teamFolderRename(e,t){return this.teamRoutes().rpc("team_folder/rename",{team_folder_id:String(e),name:t},{})}teamFolderPermanentlyDelete(e){return this.teamRoutes().rpc("team_folder/permanently_delete",{team_folder_id:String(e)},{})}teamIntegrationSettings(){return this.teamRoutes().rpc("integrations/get_team_integration_settings",void 0,{})}setGroupsCreationPolicy(e){return this.teamRoutes().rpc("groups/set_creation_policy",{group_creation:e},{})}setNTSBlockTrafficPolicy(e){return this.teamRoutes().rpc("nts/set_block_traffic_policy",{block_traffic_enabled:e},{})}setSyncPolicy(e,t){return this.teamRoutes().rpc("set_infinite_policy",{setting:e,admin_sync_defaults_enabled:t},{})}configureSsoAndGoogleLoginPolicy(e,t,s,i,r,n){return this.teamRoutes().rpc("configure_sso_and_google_login_policy",{sso_policy:e,sign_in_url:t,sign_out_url:s,saml_cert:i,saml_nameid_format:r,google_login_enabled:n},{})}configureSso(e,t,s,i,r){return this.teamRoutes().rpc("configure_sso",{sso_policy:e,saml_cert:t,sign_in_url:s,sign_out_url:i,nameid_format:r},{})}configureDirectoryRestrictions(e){const t={users_to_add:e.users_to_add,users_to_remove:e.users_to_remove};return this.teamRoutes().rpc("directory_restrictions/configure_settings",t,{})}configureGoogleLoginPolicy(e){return this.teamRoutes().rpc("configure_google_login_policy",{google_login_enabled:e},{})}setResellerSupportSetting(e){return this.teamRoutes().rpc("change_reseller_support",{reseller_support_enabled:e},{})}setTeamBrandingPolicy(e){return this.teamRoutes().rpc("set_team_branding_policy",{team_branding_policy:{".tag":e?"enabled":"disabled"}},{})}folderCreate(e,t,s){"/"!==t&&(t+="/");const i="ns:"+e+t+s;return this.filesRoutes().rpc("create_folder",{path:i},this.selectAdminParams)}bulkFileDelete(e){const t=[];let s=null;for(let i=0,r=e.length;i<r;i++)s=e[i],t.push({path:"ns:"+s.ns_id+s.ns_path});return this.filesRoutes().rpc("delete_batch_with_changeset_sync",{entries:t},this.selectAdminParams)}fileRename(e,t,s){const i="ns:"+e+t,r="ns:"+e+(t.substring(0,t.lastIndexOf("/"))+"/"+s);return this.filesRoutes().rpc("move",{from_path:i,to_path:r,autorename:!0},this.selectAdminParams)}userUiInfo(e){return this.usersRoutes().rpc("get_user_ui_info",{user_id:e},{})}shareFolder(e,t,s=null,i=!1){const r="ns:"+e+t,n=Object.assign(Object.assign({},(0,l.combinedPolicyDiffToApi)(s)),{confidentiality:i?"confidential":"not_confidential",path:r});return this.sharingRoutes().rpc("alpha/share_folder",n,this.selectAdminParams)}validateFolderPath(e,t,s,i){const r="ns:"+e+t;return this.sharingRoutes().rpc("validate_folder_path",{path:r,actions:s,list_members_arg:i},this.selectAdminParams)}restoreFile(e,t,s){const i="ns:"+e+t;return this.filesRoutes().rpc("restore",{path:i,rev:s},this.selectAdminParams)}restorePaths(e){const t=[];let s;for(const i of e)s="ns:"+i.ns_id+i.ns_path,t.push(s);return this.filesRoutes().rpc("restore_path_batch_sync",{entries:t},this.selectAdminParams)}permanentDeleteFile(e,t){const s="ns:"+e+t;return this.filesRoutes().rpc("permanently_delete",{path:s},this.selectAdminParams)}listRevisions(e,t){const s="ns:"+e+t;return this.filesRoutes().rpc("list_revisions",{path:s},this.selectAdminParams)}setTSDWritePolicy(e,t){const s={is_writable:e};return void 0!==t&&(s.access_type={".tag":t}),this.teamRoutes().rpc("team_folder/set_tsd_writable_setting",s,{})}setInfinitePolicy(e){return this.teamRoutes().rpc("set_infinite_policy",{setting:e},{})}setSmartSyncDesktopPolicy(e){return this.teamRoutes().rpc("set_smart_sync_desktop_policy",{setting:e},{})}getTeamFolderNsPathForFile(e){if(this.isCMForCDM)return e.fq_path;return"/"+e.fq_path.split("/").slice(2).join("/")}bulkFileMove(e,t,s,i,r=null){const n=[];let a,l;for(const r of s)l=this.getTeamFolderNsPathForFile(r),a=o.filename(r.fq_path),n.push({from_path:"ns:"+e+l,to_path:"ns:"+t+i+"/"+a});return this.filesRoutes().rpc("move_batch_sync",{entries:n,autorename:!0,fsw_request:r},this.selectAdminParams)}bulkFileCopy(e,t,s,i,r=null){const n=[];let a,l;for(const r of s)l=this.getTeamFolderNsPathForFile(r),a=o.filename(r.fq_path),n.push({from_path:"ns:"+e+l,to_path:"ns:"+t+i+"/"+a});return this.filesRoutes().rpc("copy_batch_sync",{entries:n,autorename:!0,allow_shared_folder:!0,fsw_request:r},this.selectAdminParams)}setMemberSpaceLimits(e){return this.teamRoutes().rpc("member_space_limits/set_default_limit",{limit_level:e},{})}setMslCapsType(e){return this.teamRoutes().rpc("member_space_limits/set_caps_type",{caps_type:e},{})}setCustomQuota(e,t){return this.teamRoutes().rpc("member_space_limits/set_custom_quota",{users_and_quotas:[{user:this._create_user_selector_json(e),quota_gb:t}]},{})}removeCustomQuota(e){return this.teamRoutes().rpc("member_space_limits/remove_custom_quota",{users:[this._create_user_selector_json(e)]},{})}_create_user_selector_json(e){return{".tag":"email",email:e}}make_user_selector_list(e=[]){return e.map(this._create_user_selector_json)}memberSpaceLimitsUpdateExclusionList(e){const t=this.make_user_selector_list(e.users_to_add),s=this.make_user_selector_list(e.users_to_remove);return this.teamRoutes().rpc("member_space_limits/update_excluded_users",{users_to_add:t,users_to_remove:s},{})}getUserInfos(e){return this.usersRoutes().rpc("get_account_batch",{account_ids:e},this.selectAdminParams)}emmConfigureSettings(e,t){const s={users_to_add:this.make_user_selector_list(t.users_to_add),users_to_remove:this.make_user_selector_list(t.users_to_remove)};return this.teamRoutes().rpc("emm/configure_settings",{emm_policy:{".tag":e},exclusion_list:s},{})}twofaConfigureSettings(e,t){const s={users_to_add:this.make_user_selector_list(t.users_to_add),users_to_remove:this.make_user_selector_list(t.users_to_remove)};return this.teamRoutes().rpc("two_step_verification/configure_settings",{tfa_policy:{".tag":e},exclusion_list:s},{})}twofaSendReminders(){return this.teamRoutes().rpc("two_step_verification/send_a_reminder",void 0,{})}sharingWhitelistConfigureSettings(e){const t={subjects_to_add:e.subjects_to_add,subjects_to_remove:e.subjects_to_remove};return this.teamRoutes().rpc("sharing_whitelist/update",t,{})}emmRefreshToken(){return this.teamRoutes().rpc("emm/refresh_token",void 0,{})}emmGenerateUsageReport(){return this.teamRoutes().rpc("emm/generate_report",{report_type:{".tag":"mobile_app_usage"}},{})}teamContentGetMetadata(e){return this.teamRoutes().rpc("team_content/get_metadata",e,{})}createLegalHoldPolicy(e){return this.teamRoutes().rpc("legal_holds/create",e,{})}updateLegalHoldPolicy(e){return this.teamRoutes().rpc("legal_holds/update",e,{})}legalHoldCreateExport(e){return this.teamRoutes().rpc("legal_holds/export_v2",e,{})}legalHoldExportFetchFolders(e){return this.teamRoutes().rpc("legal_holds/fetch_folders_tree_view",e,{})}releaseLegalHoldPolicy(e){return this.teamRoutes().rpc("legal_holds/release",e,{})}getLegalHoldPolicy(e){return this.teamRoutes().rpc("legal_holds/get",e,{})}listLegalHoldPolicies(){return this.teamRoutes().rpc("legal_holds/list",void 0,{})}listLegalHoldExports(e){return this.teamRoutes().rpc("legal_holds/list_exports",e,{})}cancelLegalHoldExport({legalHoldId:e,exportId:t}){return this.teamRoutes().rpc("legal_holds/export/update",{legal_hold_id:e,export_id:t,status:{".tag":"canceled"}},{})}removeLegalHoldExport({legalHoldId:e,exportId:t}){return this.teamRoutes().rpc("legal_holds/export/update",{legal_hold_id:e,export_id:t,status:{".tag":"removed"}},{})}getExportDownloadsMetadata({legalHoldId:e,exportId:t}){return this.teamRoutes().rpc("legal_holds/export/downloads/metadata",{id:e,export_id:t},{})}sendExportDownloadsLogging(e){return this.teamRoutes().rpc("legal_holds/export/downloads/logging",e,{})}sendLegaLHoldExportDownloadsUrl(e){return this.teamRoutes().rpc("legal_holds/export/downloads/url",e,{})}sendPoliciesExportDownloadsLogging(e){return this.teamRoutes().rpc("policies/export_downloads_logging",e,{})}getLegalHoldInfoz(e){return this.teamRoutes().rpc("legal_holds/infoz",e,{})}createRetentionPolicy(e){return this.teamRoutes().rpc("policies/retention_policy/create",e,{})}modifyRetentionPolicy(e){return this.teamRoutes().rpc("policies/retention_policy/modify",e,{})}getPolicy(e){return this.teamRoutes().rpc("policies/get",e,{})}deletePolicy(e){return this.teamRoutes().rpc("policies/delete",e,{})}createExport(e){return this.teamRoutes().rpc("policies/export",e,{})}hasExistingPolicy(e){return this.teamRoutes().rpc("policies/has_existing_policy",e,{})}createDispositionPolicy(e){return this.teamRoutes().rpc("policies/disposition_policy/create",e,{})}modifyDispositionPolicy(e){return this.teamRoutes().rpc("policies/disposition_policy/modify",e,{})}listPolicies(e){return this.teamRoutes().rpc("policies/list",e,{})}removeOrCancelExport(e){return this.teamRoutes().rpc("policies/remove_export",e,{})}listExports(e){return this.teamRoutes().rpc("policies/list_exports",e,{})}getPoliciesExportDownloadMetadata(e){return this.teamRoutes().rpc("policies/export_downloads_metadata",e,{})}foldersSearch(e){return this.teamRoutes().rpc("policies/folders_search",e,{})}runPoliciesProjectorScript(){return this.teamRoutes().rpc("policies/run_projector_script",void 0,{})}validateMemberImportCsv(e){return this.teamRoutes().rpc("members/validate_import_csv",{csv_file_content:e},{})}checkImportMembersCsvValidationJobStatus(e){return this.teamRoutes().rpc("members/validate_import_csv/job_status/check",{async_job_id:e},{})}checkImportMembersJobStatus(e){return this.teamRoutes().rpc("members/import_from_csv/job_status/check",{async_job_id:e},{})}importMembersFromCsv(e,t){let s={csv_file_content:e};return t&&(s=Object.assign(Object.assign({},s),t)),this.teamRoutes().rpc("members/import_from_csv",s,{})}changeAALOnDomain(e,t){return this.domainRoutes().rpc("change_aal_configuration",{domain_name:e,is_enabled:t},{})}unlockUser(e){return this.teamRoutes().rpc("members/unlock",{account_id:e},{})}validateInviteeEmails(e){return this.teamRoutes().rpc("validate_invitee_emails",e,{})}classificationFeedbackGetFileInfo(e){return this.teamRoutes().rpc("classification_feedback/get_file_info",e,{})}classificationFeedbackSubmit(e){return this.teamRoutes().rpc("classification_feedback/submit",e,{})}inviteAfterSharingMarkSeeingReceivers(e){return this.teamRoutes().rpc("invite_after_sharing/mark_seeing_receivers",e,{})}inviteAfterSharingGetReceiverInfoBatch(e){return this.teamRoutes().rpc("invite_after_sharing/get_receiver_info_batch",e,{})}getAtfTaskStatus(e){return this.teamRoutes().rpc("get_atf_task_status",{task_gid:e},{})}setAdminEmailRemindersPolicy(e){return this.teamRoutes().rpc("set_admin_email_reminders_policy",{enable:e},{})}setFolderLinkRestrictionPolicy(e){return this.teamRoutes().rpc("set_folder_link_restriction_policy",{enable:e},{})}}t.AdminConsoleApiClient=p,t.default=p})),define("metaserver/static/js/teams/admin/widgets/settings_content_management/constants/constants",["require","exports","metaserver/static/js/core/i18n","metaserver/static/js/teams/admin/widgets/settings_content_management/constants/constants_util"],(function(e,t,s,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ContentAdministrationPolicyValue=t.AdminInfos=t.Breadcrumbs=t.ContentManagementSettingsWarning=t.ContentManagementSettingsItem=t.View=void 0,t.View={viewName:s.intl.formatMessage({id:"1UW9bf",defaultMessage:"Content Management"})},t.ContentManagementSettingsItem={title:s.intl.formatMessage({id:"fBoVqZ",defaultMessage:"Content management"}),description:i.ContentManagementSettingsDescription,isDescriptionReactFormat:!0},t.ContentManagementSettingsWarning={check:s.intl.formatMessage({id:"V8LEQk",defaultMessage:"They'll be able to do things like access, manage, or delete any team folder."}),uncheck:s.intl.formatMessage({id:"NDGMY8",defaultMessage:"They'll no longer be able to do things like manage, delete, or automatically access team folders."})},t.Breadcrumbs=[{name:s.intl.formatMessage({id:"P/IvMW",defaultMessage:"Settings"}),url:"/team/admin/settings"},{name:s.intl.formatMessage({id:"BRMB6V",defaultMessage:"Content management"})}],t.AdminInfos=[{adminType:"teamAdmin",label:s.intl.formatMessage({id:"8OW3yL",defaultMessage:"Team admins"}),disabled:!0,value:0,hasPermission:!0},{adminType:"userManagementAdmin",label:s.intl.formatMessage({id:"rgYQhy",defaultMessage:"User management admins"}),disabled:!1,value:1},{adminType:"supportAdmin",label:s.intl.formatMessage({id:"YETueY",defaultMessage:"Support admins"}),disabled:!1,value:2}],t.ContentAdministrationPolicyValue=["default","user_management_admin_only","support_admin_only","both_admins"]})),define("metaserver/static/js/teams/admin/widgets/settings_content_management/constants/constants_util",["require","exports","tslib","metaserver/static/js/core/i18n","react"],(function(e,t,s,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ContentManagementSettingsDescription=void 0,r=s.__importDefault(r),t.ContentManagementSettingsDescription=i.intl.formatMessage({id:"TYc4E/",defaultMessage:"Choose which admin roles can access the <a>Content</a> page to manage your teamâ€™s content. <b>More about admin roles</b>"},{a:e=>r.default.createElement("a",{"aria-label":"content",href:"/team/admin/content?role=work",target:"_blank",rel:"noopener noreferrer"},e),b:e=>r.default.createElement("a",{"aria-label":"admin roles",href:"https://help.dropbox.com/teams-admins/admin/change-admin-rights",target:"_blank",rel:"noopener noreferrer"},e)})})),define("metaserver/static/js/clean/tokenizer",["require","exports","tslib","classnames","create-react-class","react","react-dom","prop-types","lodash","jquery","ts-key-enum","metaserver/static/js/clean/typeahead"],(function(e,t,s,i,r,n,a,o,l,c,d,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tokenizer=t.Token=void 0,i=s.__importDefault(i),r=s.__importDefault(r),n=s.__importDefault(n),a=s.__importStar(a),o=s.__importDefault(o),l=s.__importStar(l),c=s.__importDefault(c);class _ extends n.default.Component{constructor(){super(...arguments),this._makeCloseButton=()=>this.props.onRemove?n.default.createElement("span",{className:"tokenizer-token-close",onClick:()=>(this.props.onRemove(),!1),dangerouslySetInnerHTML:{__html:"&nbsp;"}}):""}render(){const e={"tokenizer-token":!0};return e[this.props.className]=!0,n.default.createElement("a",Object.assign({tabIndex:-1},this.props,{className:(0,i.default)(e)}),String(this.props.data),this._makeCloseButton())}}t.Token=_,_.displayName="Token",_.propTypes={className:o.default.string,data:o.default.any,onRemove:o.default.func};const p=(0,r.default)({displayName:"Tokenizer",propTypes:{customClass:o.default.string,dataSource:o.default.object.isRequired,initialInputText:o.default.string,logSearchBegin:o.default.func,logSearchComplete:o.default.func,logTokenChangeEvent:o.default.func,onContentsChange:o.default.func,onTokensAdd:o.default.func,onTokenRemove:o.default.func,placeholderText:o.default.string,populatedTokenData:o.default.array,renderToken:o.default.func.isRequired,renderTokenHover:o.default.func,renderInput:o.default.func.isRequired,renderSelector:o.default.func.isRequired,stringTokenizer:o.default.func.isRequired,tokenSpacing:o.default.number,focusOnMount:o.default.bool,tabIndex:o.default.number,disableAdditionalInput:o.default.bool,disabled:o.default.bool,resetTokenData:o.default.bool,tokenizeOnOutOfFocus:o.default.bool,postSelect:o.default.func,validatedTokenMap:o.default.object},getDefaultProps:()=>({initialInputText:"",renderInput:()=>n.default.createElement("input",null),renderSelector:()=>n.default.createElement(u.TypeaheadSelector,null),renderToken:e=>n.default.createElement(_,{data:e}),stringTokenizer(e,t){const s=e.split(","),i=t?"":s.pop();return{tokens:s,value:i}},tokenSpacing:3,focusOnMount:!1,logSearchBegin:null,logSearchComplete:null,disableAdditionalInput:!1,disabled:!1,resetTokenData:!1,tokenizeOnOutOfFocus:!1}),getInitialState(){return this.tokenData=[],this.queryResults=null,{queryResults:this.queryResults,tokenData:this.tokenData,selectedTokenIndex:null,inputWidth:150,numLines:1}},componentDidMount(){if(setTimeout(this._resizeTokenizerInput,0),a.findDOMNode(this.refs.input).value=this.props.initialInputText,(0,c.default)(a.findDOMNode(this.refs.tokenizer_input)).on("keydown",this._proxyKeys),this.props.tokenizeOnOutOfFocus&&(0,c.default)(a.findDOMNode(this.refs.tokenizer_input)).on("focusout",this._tokenizeIfHasInput),document.addEventListener("click",this._handleDocumentClick,!1),this.props.focusOnMount&&setTimeout(()=>{const e=a.findDOMNode(this.refs.input);e&&e.focus()}),"function"==typeof this.props.dataSource.registerForUpdates&&this.props.dataSource.registerForUpdates(this._dataUpdatedCallback),this.props.populatedTokenData&&this.props.populatedTokenData.length)return this._addTokens(this.props.populatedTokenData,!1,null)},componentWillUnmount(){return(0,c.default)(a.findDOMNode(this.refs.tokenizer_input)).off("keydown",this._proxyKeys),document.removeEventListener("click",this._handleDocumentClick,!1)},componentDidUpdate(e,t){const{populatedTokenData:s,resetTokenData:i}=this.props;return i&&!e.resetTokenData&&0!==this.tokenData.length&&this.removeTokens(this.tokenData),(null!=s?s.length:void 0)!==(null!=e.populatedTokenData?e.populatedTokenData.length:void 0)&&(s.length>e.populatedTokenData.length?this._addTokens(s,!1,null):s.length<e.populatedTokenData.length&&(this.removeTokens(this.tokenData),this._addTokens(s))),this._resizeTokenizerInput()},componentWillReceiveProps(e){var t;if(e.validatedTokenMap&&this.props.validatedTokenMap!==e.validatedTokenMap&&this.tokenData){const s=e.validatedTokenMap;this.tokenData.forEach((e,t)=>{if(e&&"function"==typeof e.getKey&&s.has(e.getKey())){const i=s.get(e.getKey()),r=this.tokenData.slice(0,t).concat([i]).concat(this.tokenData.slice(t+1));this.tokenData=r}}),this.setState({tokenData:this.tokenData}),"function"==typeof this.props.onContentsChange&&this.props.onContentsChange(this.tokenData,null===(t=a.findDOMNode(this.refs.input))||void 0===t?void 0:t.value)}},render(){const e={"react-tokenizer":!0};null!=this.props.customClass&&(e[this.props.customClass]=null!=this.props.customClass);const t={padding:this.props.tokenSpacing,paddingRight:0,maxHeight:this.props.tokenSpacing+3*(this.props.tokenSpacing+29)+14+2},s=(0,i.default)({"tokenizer-input":!0,"tokenizer-input-disabled":this.props.disabled,"tokenizer-input-additionalInputDisabled":this.props.disableAdditionalInput});return this.state.numLines>3&&(t.overflowY="auto",t.overflowX="visible"),n.default.createElement("div",{onClick:this._handleMyClick,className:(0,i.default)(e)},n.default.createElement("div",{className:s,ref:"tokenizer_input",style:t},n.default.createElement("div",{className:"token-container",style:{marginLeft:-this.props.tokenSpacing,marginBottom:-this.props.tokenSpacing}},this._renderTokens(),this._renderInput())),this._renderSelector())},getInputValue(){return a.findDOMNode(this.refs.input).value},serializeInputData(){return{tokens:this.tokenData,value:this.getInputValue()}},tokenizeAll(){const e=a.findDOMNode(this.refs.input),{tokens:t}=this.props.stringTokenizer(e.value,!0);return t.length>0&&this._addTokens(t,!1),e.value="",this.refs.selector.close()},addExternalTokens(e){this._addTokens(e,!1,null),this.refs.selector.close()},_getCurrentValue(){const e=a.findDOMNode(this.refs.input),{value:t}=this.props.stringTokenizer(e.value);return t},queryDataSource(e){const t=t=>{let s;e||(t=null);const i=e=>("function"==typeof e.getKey?e.getKey():void 0)||String(e),r=l.map(this.tokenData,i);return t=null!=t?t.filter(e=>(s=i(e),!Array.from(r).includes(s))):null};return this.props.dataSource.query(e,s=>(s=t(s),this.queryResults=s,this.setState({queryResults:this.queryResults}),"function"==typeof this.props.logSearchComplete?this.props.logSearchComplete(e,(null!=s?s.length:void 0)||0,!0):void 0),s=>(e===this._getCurrentValue()&&(s=t(s))&&s.length&&(this.queryResults=this.queryResults?this.queryResults.concat(s):s,this.setState({queryResults:this.queryResults})),"function"==typeof this.props.logSearchComplete?this.props.logSearchComplete(e,(null!=s?s.length:void 0)||0,!1):void 0))},_dataUpdatedCallback(){if(this.isMounted()){const i=Boolean(this.state.queryResults);return e=this.refs.selector,t="reset",s=e=>e.reset(),null!=e&&"function"==typeof e[t]&&s(e,t),i&&a.findDOMNode(this.refs.input).focus(),this.queryDataSource(this.getInputValue())}var e,t,s},_addTokens(e,t=!1,s=null){var i;const r=e=>("function"==typeof e.getKey?e.getKey():void 0)||String(e),n=l.map(this.tokenData,r),o=[];for(const t of Array.from(e)){const e=r(t);Array.from(n).includes(e)||(o.push(t),n.push(e))}this.tokenData=this.tokenData.concat(o),this.setState({tokenData:this.tokenData}),"function"==typeof this.props.onTokensAdd&&this.props.onTokensAdd(o,this),"function"==typeof this.props.onContentsChange&&this.props.onContentsChange(this.tokenData,null===(i=a.findDOMNode(this.refs.input))||void 0===i?void 0:i.value);const c=t?{search_expr:s,selected_pos:(null!=this.refs.selector?this.refs.selector.state.selectionIndex:void 0)||0,num_query_results:null!=this.state.queryResults?this.state.queryResults.length:void 0,did_select_suggestion:!0}:{did_select_suggestion:!1};return(()=>{const e=[];for(const t of Array.from(o))e.push("function"==typeof this.props.logTokenChangeEvent?this.props.logTokenChangeEvent(t,!1,c):void 0);return e})()},_addToken(e,t=!1,s=null){return this._addTokens([e],t,s)},removeTokens(e){let{selectedTokenIndex:t}=this.state;const s=[];for(const i of Array.from(e)){const e=this.tokenData.indexOf(i);-1!==e&&(t===e?t=null:t>e&&(t-=1),this.tokenData.splice(e,1),s.push(i))}const i=a.findDOMNode(this.refs.input);i.focus(),this._setSelectedToken(t),this.queryResults=null,this.setState({tokenData:this.tokenData,queryResults:this.queryResults});for(const e of Array.from(s))"function"==typeof this.props.onTokenRemove&&this.props.onTokenRemove(e);for(const e of Array.from(s))"function"==typeof this.props.logTokenChangeEvent&&this.props.logTokenChangeEvent(e,!0);return"function"==typeof this.props.onContentsChange?this.props.onContentsChange(this.tokenData,i.value):void 0},removeToken(e){return this.removeTokens([e])},replaceTokens(e){var t;const s=e=>("function"==typeof e.getKey?e.getKey():void 0)||String(e);if(e.length!==this.tokenData.length||!l.every(l.zip(this.tokenData,e),(function(...e){const[t,i]=Array.from(e[0]);return s(t)===s(i)})))return this.tokenData=e,this.setState({tokenData:e}),"function"==typeof this.props.onContentsChange?this.props.onContentsChange(this.tokenData,null===(t=a.findDOMNode(this.refs.input))||void 0===t?void 0:t.value):void 0},_renderTokens(){const e=[],t=e=>("function"==typeof e.getKey?e.getKey():void 0)||String(e);for(let s=0;s<this.state.tokenData.length;s++){const r=this.state.tokenData[s],a=this.props.renderToken(r),o=this.state.selectedTokenIndex===s,l="function"==typeof this.props.renderTokenHover?this.props.renderTokenHover(r):void 0,c=[{selected:o,"c-title-bubble":null!=l,"c-title-bubble--s":null!=l}];e.push(n.default.cloneElement(a,{ref:`token${s}`,key:`token${t(r)}`,style:{margin:`0 0 ${this.props.tokenSpacing}px ${this.props.tokenSpacing}px`},className:(0,i.default)(c,a.props.className),"data-title":l,onClick:this._setSelectedToken.bind(this,s),onRemove:this.removeToken.bind(this,r),tokenSpacing:this.props.tokenSpacing}))}return e},_renderSelector(){return n.default.cloneElement(this.props.renderSelector(),{ref:"selector",queryOptions:this.state.queryResults,onSelect:this._onSelect,onClose:this._clearResults})},_renderInput(){const e=this.state.tokenData.length?"":this.props.placeholderText;return n.default.cloneElement(this.props.renderInput(),{ref:"input",style:{width:this.state.inputWidth,marginLeft:this.props.tokenSpacing,marginBottom:this.props.tokenSpacing},onChange:this._textUpdated,placeholder:e,tabIndex:this.props.tabIndex,onClick:this._setSelectedToken.bind(this,null),disabled:this.props.disabled||this.props.disableAdditionalInput})},_getTokenizerInput(){return this.refs.tokenizer_input},_getTokenComponents(){return(function(e,t,s){const i=[],r=e<t,n=s?r?t+1:t-1:t;for(let t=e;r?t<n:t>n;r?t++:t--)i.push(t);return i})(0,this.state.tokenData.length,!1).map(e=>this.refs[`token${e}`]).filter(e=>e)},_setSelectedToken(e){return null!=e?(a.findDOMNode(this.refs[`token${e}`]).focus(),this.refs.selector.close()):a.findDOMNode(this.refs.input).focus(),this.setState({selectedTokenIndex:e})},_resizeTokenizerInput(){const e=e=>{var t;return null===(t=a.findDOMNode(e))||void 0===t?void 0:t.clientWidth},t=e(this._getTokenizerInput());if(null==t)return;const s=this.props.tokenSpacing+2,i=this.props.tokenSpacing;let r=0;const n=this._getTokenComponents();let o=1;for(const a of Array.from(n)){const n=e(a)+s;r+n+i>t&&(o+=1,r=0),r+=n}let l=t-r-i-2;return l<80&&(o+=1,l=t-i),l!==this.state.inputWidth&&this.setState({inputWidth:l}),o!==this.state.numLines?this.setState({numLines:o}):void 0},_onSelect(e){const t=a.findDOMNode(this.refs.input);return t.focus(),this._addToken(e,!0,t.value),t.value="",this.queryResults=null,"function"==typeof this.props.postSelect&&this.props.postSelect(e),this.setState({queryResults:this.queryResults})},_handleMyClick:e=>"function"==typeof e.nativeEvent.stopImmediatePropagation?e.nativeEvent.stopImmediatePropagation():void 0,_handleDocumentClick(e){return this.refs.selector.close()},_proxyKeys(e){if(e.key===d.Key.Backspace&&""===this._getCurrentValue()&&e.preventDefault(),this._shouldListenForTokenNavigation()){const t=this.state.selectedTokenIndex;switch(e.key){case d.Key.Backspace:return void(null===t?(this._setSelectedToken(this.state.tokenData.length-1),a.findDOMNode(this.refs.input).focus()):this.removeToken(this.state.tokenData[t]));case d.Key.ArrowLeft:return void(null===t?this._setSelectedToken(this.state.tokenData.length-1):t>0&&this._setSelectedToken(t-1));case d.Key.ArrowRight:if(null!==t)return void(t>=this.state.tokenData.length-1?this._setSelectedToken(null):this._setSelectedToken(t+1));break;case d.Key.Delete:if(null!==t)return void this.removeToken(this.state.tokenData[t])}}this.refs.selector.onKeyDown(e),e.isDefaultPrevented()||e.key===d.Key.Tab&&""!==this.getInputValue()&&this.tokenizeAll()},_tokenizeIfHasInput(e){if(""!==this.getInputValue())return this.tokenizeAll(),e.preventDefault()},_shouldListenForTokenNavigation(){if(!this.state.tokenData.length)return!1;const e=a.findDOMNode(this.refs.input);return 0===e.selectionStart&&0===e.selectionEnd},_textUpdated(e){const t=a.findDOMNode(this.refs.input),s=e.target.value,{tokens:i,value:r}=this.props.stringTokenizer(s);return"function"==typeof this.props.logSearchBegin&&this.props.logSearchBegin(r),r!==s&&(t.value=r,r||this.refs.selector.close()),i.length>0?this._addTokens(i,!1):"function"==typeof this.props.onContentsChange&&this.props.onContentsChange(this.tokenData,r),this.queryDataSource(r)},_clearResults(){return this.queryResults=null,this.setState({queryResults:this.queryResults})}});t.Tokenizer=p})),define("metaserver/static/js/clean/typeahead",["require","exports","tslib","classnames","create-react-class","react","react-dom","prop-types","lodash","metaserver/static/js/clean/fuzzy","ts-key-enum"],(function(e,t,s,i,r,n,a,o,l,c,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TypeaheadSelectorMixin=t.TypeaheadSelector=t.DataSource=t.Autocomplete=void 0,i=s.__importDefault(i),r=s.__importDefault(r),n=s.__importDefault(n),a=s.__importStar(a),o=s.__importDefault(o),l=s.__importStar(l),c=s.__importDefault(c);t.DataSource=class{constructor({local:e}={}){this.local=null!=e?e:[]}filterAndSort(e){return c.default.filter(e,this.local,{extract:e=>e})}query(e,t){return t(l.map(this.filterAndSort(e),e=>e.original))}};const u={getInitialState:()=>({selectionIndex:0}),getOptions(){if(!this.props.queryOptions)return[];const e=this.props.maxVisible||this.props.queryOptions.length;return this.props.queryOptions.slice(0,e)},renderOptions(){const e=[],t=this.getOptions(),s=e=>("function"==typeof e.getKey?e.getKey():void 0)||String(e);for(let r=0;r<t.length;r++){const a=t[r],o={selected:this.state.selectionIndex===r,"typeahead-option":!0,"u-pad-xs":!0},l=this.renderOption(a);e.push(n.default.cloneElement(l,{className:(0,i.default)(o,l.props.className),key:`option${s(a)}`,onMouseEnter:this._hover.bind(this,r),onClick:this.onSelect.bind(this,a)}))}return e},onSelect(e){return this.props.onSelect(e),this.reset()},renderOption(e){return this.props.renderQueryOption(e)},onKeyDown(e){switch(e.key){case d.Key.ArrowUp:return this._navigate(-1),e.preventDefault();case d.Key.ArrowDown:return this._navigate(1),e.preventDefault();case d.Key.Enter:return this._selectSelectionIndex(e);case d.Key.Escape:if(Boolean(this.props.queryOptions))return this.close(),e.preventDefault();break;case d.Key.Tab:return this._selectSelectionIndex(e);default:return this.reset()}},_selectSelectionIndex(e){const t=this.getOptions();if(!t.length)return;const s=this.state.selectionIndex;return-1!==s?(this.onSelect(t[s]),e.preventDefault()):void 0},reset(){return this._changeSelectionIndex(0)},close(){return"function"==typeof this.props.onClose&&this.props.onClose(),this.reset()},_hover(e){return this._changeSelectionIndex(e)},_navigate(e){const{length:t}=this.getOptions();if(!t)return;let s=this.state.selectionIndex+e;const i=t+1;return s<-1?s+=i:s>=t&&(s-=i),this._changeSelectionIndex(s)},_changeSelectionIndex(e){return e!==this.state.selectionIndex&&"function"==typeof this.onSelectionIndexChange&&this.onSelectionIndexChange(e),this.setState({selectionIndex:e})}};t.TypeaheadSelectorMixin=u;class _ extends n.default.Component{constructor(){super(...arguments),this.state={queryResults:null,value:this.props.value,focus:!1},this._onMouseOver=()=>this.setState({focus:!0}),this._onMouseLeave=()=>this.setState({focus:!1}),this._onBlur=()=>{if(this.props.onBlur(),!this.state.focus)return this._clearResults()},this._onFocus=()=>(this._queryDataSource(this.state.value),this.refs.selector.reset()),this._renderInput=()=>{const e=this.props.renderInput();return n.default.cloneElement(e,{ref:"input",onChange:t=>(null!=e.props.onChange&&e.props.onChange(t),this._inputChanged(t)),onKeyDown:t=>(null!=e.props.onKeyDown&&e.props.onKeyDown(t),this._proxyKeys(t)),onBlur:t=>(null!=e.props.onBlur&&e.props.onBlur(t),this._onBlur(t)),onFocus:t=>(null!=e.props.onFocus&&e.props.onFocus(t),this._onFocus(t)),placeholder:this.props.placeholder,value:this.state.value,name:this.props.name,autoComplete:"off",disabled:this.props.disabled})},this._renderSelector=()=>n.default.cloneElement(this.props.renderSelector(),{ref:"selector",queryOptions:this.state.queryResults,onSelect:this._autocomplete,onClose:this._clearResults,maxVisible:this.props.maxVisible}),this._inputChanged=e=>{const{value:t}=e.target;return this.setState({value:e.target.value}),this.props.onChange(t),this._queryDataSource(t),this.refs.selector.reset()},this._getCurrentValue=()=>a.findDOMNode(this.refs.input).value,this._queryDataSource=e=>{const t=e=>(this.queryResults=e,this.setState({queryResults:this.queryResults}));return this.props.dataSource.query(e,t,s=>{if(e===this._getCurrentValue()&&s&&s.length){const e=this.queryResults?this.queryResults.concat(s):s;return t(e)}})},this._proxyKeys=e=>this.refs.selector.onKeyDown(e),this._autocomplete=e=>(a.findDOMNode(this.refs.input).focus(),e=this.props.renderCompletionText(e),this.setState({value:e}),this.props.onSelect(e),this._clearResults()),this._clearResults=()=>(this.queryResults=null,this.setState({queryResults:this.queryResults}))}render(){const e={};return e[this.props.customClass]=null!=this.props.customClass,n.default.createElement("div",{className:(0,i.default)(e),onMouseOver:this._onMouseOver,onMouseLeave:this._onMouseLeave},this._renderInput(),this._renderSelector())}componentWillReceiveProps(e){return this.setState({value:e.value})}}t.Autocomplete=_,_.displayName="Autocomplete",_.propTypes={customClass:o.default.string,maxVisible:o.default.number,dataSource:o.default.object.isRequired,onBlur:o.default.func,onSelect:o.default.func,onChange:o.default.func,placeholder:o.default.string,renderCompletionText:o.default.func.isRequired,renderInput:o.default.func.isRequired,renderSelector:o.default.func.isRequired,value:o.default.string,name:o.default.string,disabled:o.default.bool},_.defaultProps={value:"",maxVisible:7,onBlur(){},onSelect(e){},onChange(e){},renderCompletionText:e=>String(e),renderInput:()=>n.default.createElement("input",null),renderSelector:()=>n.default.createElement(p,null),disabled:!1};const p=(0,r.default)({displayName:"TypeaheadSelector",mixins:[u],propTypes:{customClass:o.default.string,maxVisible:o.default.number,onClose:o.default.func.isRequired,onSelect:o.default.func.isRequired,queryOptions:o.default.array,renderQueryOption:o.default.func.isRequired},getDefaultProps:()=>({maxVisible:7,onClose(){},onSelect(e){},renderQueryOption:e=>n.default.createElement("li",null,String(e))}),render(){if(!this.getOptions().length)return n.default.createElement("div",null);const e={"typeahead-selector":!0};return e[this.props.customClass]=null!=this.props.customClass,n.default.createElement("ul",{className:(0,i.default)(e)},this.renderOptions())}});t.TypeaheadSelector=p}));
//# sourceMappingURL=pkg-sharing-core.min.js-vflD7TxSc.map