define("metaserver/static/js/pass/integration/profile_card_popover",["require","exports","tslib","react","react-redux","metaserver/static/js/core/user_i18n","typescript/component_libraries/deep-integrations/src/platform/server/service_selection_menu","typescript/component_libraries/deep-integrations/src/platform/server/tooltip","metaserver/static/js/integrations/profile_card","metaserver/static/js/redux/namespaces","metaserver/static/js/redux/selectors","reselect","metaserver/static/js/core/browser","metaserver/static/js/pass/tooltip_helpers","metaserver/static/js/integrations/email","metaserver/static/js/integrations/notify","metaserver/static/js/integrations/url_adapter","metaserver/static/js/core/i18n"],(function(e,t,s,a,i,r,n,o,l,c,u,d,m,p,f,h,g,_){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ProfileCardPopover=t.ProfileCardPopoverComponent=void 0,a=s.__importDefault(a),r=s.__importStar(r);class v extends a.default.Component{constructor(e){super(e)}render(){const e=this.props,{userInfo:t,fileInfo:i}=e,c=s.__rest(e,["userInfo","fileInfo"]);let u="dbx_user";return t.isViewer?u="viewer":-1!==t.key.indexOf("@")?u="unverified_email":t.key.startsWith("dbafvid:")&&(u="guest"),a.default.createElement(l.StatefulProfileCardWithWrapper,Object.assign({targetUser:{account_id:t.key,display_name:t.displayName,type:u,email:t.email},file:i,intl:_.intl,seenState:(0,p.buildSeenStateMessage)(t),isActive:t.isActive,initials:r.getInitials(t.displayName),photoUrl:t.photoUrl,tooltip:o.WebTooltip,platform:"web",urlBuilder:g.UrlAdapter,openDropboxUrl:m.open_tab,openExternalUrl:m.unsafe_open_tab,openEmailLink:f.composeEmail,serviceSelectionMenu:n.DefaultServiceSelectionMenu,notify:h.notify},c))}}t.ProfileCardPopoverComponent=v,v.displayName="ProfileCardPopoverComponent";const S=(0,d.createSelector)([e=>(0,u.getStateAtNamespace)(e,c.INTEGRATIONS_NAMESPACE_KEY)],e=>e),y=(0,i.connect)(e=>({listServices:S(e).listServices,featureGates:{}}));t.ProfileCardPopover=y(v)})),define("metaserver/static/js/pass/event_emitter",["require","exports","tslib","eventemitter3"],(function(e,t,s,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.passEventEmitter=void 0,a=s.__importDefault(a),t.passEventEmitter=new a.default})),define("metaserver/static/js/pass/avatars",["require","exports","tslib","react","metaserver/static/js/core/i18n","metaserver/static/js/pass/integration/profile_card_popover","react-redux","metaserver/static/js/integrations/app_store_lite_modal","metaserver/static/js/integrations/link_service","metaserver/static/js/pass/tooltip_helpers","metaserver/static/js/integrations/data/actions","metaserver/static/js/integrations/profile_card_tooltip","metaserver/static/js/integrations/data/selectors","typescript/component_libraries/deep-integrations/src/async","spectrum/avatar/index","typescript/libraries/file-viewer/src/titlebar/truncate"],(function(e,t,s,a,i,r,n,o,l,c,u,d,m,p,f,h){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UserAvatarActiveTooltipContent=t.UserAvatarPassiveTooltipContent=void 0,a=s.__importDefault(a);t.UserAvatarPassiveTooltipContent=e=>{const{colorSeed:t,integrationStore:s,userInfo:r,userInfo:{displayName:o}}=e,l=(0,h.truncateStringByLength)(o,22);return a.default.createElement(n.Provider,{store:s},a.default.createElement("div",{className:"rich-facepile-tooltip-content--passive"},a.default.createElement(d.StatefulProfileCardTooltipContent,{displayName:l,seenState:(0,c.buildSeenStateMessage)(r),avatarColor:(0,f.avatarColorForUserIdentifier)(t),intl:i.intl})))},t.UserAvatarPassiveTooltipContent.displayName="UserAvatarPassiveTooltipContent";class g extends a.default.Component{constructor(){super(...arguments),this.connectService=e=>{const{integrationStore:t,integrationInfo:{userId:s}}=this.props,a=(0,m.isConnectServiceLandingPagesEnabled)(t.getState());return(0,l.linkService)(s,e,a).then(()=>{t.dispatch((0,u.fetchListServices)())})},this.showAppStoreLiteModal=()=>{window.dispatchEvent(new Event("resize")),(0,o.showAppStoreLiteModal)(this.props.integrationInfo.userId)}}render(){const{colorSeed:e,integrationInfo:{fileId:t,fileName:s},integrationStore:i,logEvent:o,performanceTimer:l,reportError:c,userInfo:u,teamExpandButtonText:d,teamExpandPrimaryText:m,teamExpandReasonsText:h,teamExpandButtonHandler:g,showCompanyIcon:_,isTeamExpandButtonDisabled:v}=this.props;return a.default.createElement(n.Provider,{store:i},a.default.createElement("div",{className:"rich-facepile-tooltip-content--active"},a.default.createElement(r.ProfileCardPopover,{userInfo:u,fileInfo:{".tag":"file",id:(0,p.fulfilled)(t),name:s},avatarColor:(0,f.avatarColorForUserIdentifier)(e),onConnectService:this.connectService,onConnectServices:this.showAppStoreLiteModal,logEvent:o,entryPoint:"file_preview",performanceTimer:l,reportError:c,teamExpandPrimaryText:m,teamExpandReasonsText:h,teamExpandButtonText:d,teamExpandButtonHandler:g,showCompanyIcon:_,isTeamExpandButtonDisabled:v})))}}t.UserAvatarActiveTooltipContent=g,g.displayName="UserAvatarActiveTooltipContent"})),define("metaserver/static/js/pass/pass_facepile_logger",["require","exports","tslib","metaserver/static/js/deprecated_ajax/ajax_jquery","metaserver/static/js/pass/constants","metaserver/static/js/pass/action_timestamps"],(function(e,t,s,a,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.passFacepileLogger=void 0,a=s.__importStar(a);const n={};n[i.EventTypes.PASS_SHOWN]="pass_shown",n[i.EventTypes.PASS_HOVER]="pass_hover",n[i.EventTypes.PASS_CLICK]="pass_click";t.passFacepileLogger=new class{constructor(){this.eventToHandlerStack={};for(const e of[i.EventTypes.PASS_SHOWN,i.EventTypes.PASS_HOVER,i.EventTypes.PASS_CLICK])this.eventToHandlerStack[e]=[]}_log(e,t,s,i,o){const l=t?"BROWSE_FILE_FACEPILE":"PREVIEW_PAGE_FACEPILE";let c={};t||o&&(i.pass_session_id=o,c=r.ActionTimestampsTracker.get(o));const u=new Date,d={event_name:n[e],file_ns_id:s.ns_id,file_sjid:s.sjid,origin:l,product_surface:t?"browse":"file_preview",extra:JSON.stringify(i),action_timestamps:JSON.stringify(c),client_ts:u.getTime()/1e3};a.SilentBackgroundRequest({url:"/log/pass_facepile",data:d})}listenTo(e){this._unlistenToTopOfHandlersStack(e),this._pushHandlers(),this._listenToTopOfHandlersStack(e)}unlistenTo(e){this._unlistenToTopOfHandlersStack(e),this._popHandlers(),this._listenToTopOfHandlersStack(e)}_unlistenToTopOfHandlersStack(e){for(const t in this.eventToHandlerStack)if(this.eventToHandlerStack.hasOwnProperty(t)){if(0===this.eventToHandlerStack[t].length)continue;const s=this.eventToHandlerStack[t].slice(-1)[0];e.removeListener(t,s)}}_listenToTopOfHandlersStack(e){for(const t in this.eventToHandlerStack)if(this.eventToHandlerStack.hasOwnProperty(t)){if(0===this.eventToHandlerStack[t].length)continue;const s=this.eventToHandlerStack[t].slice(-1)[0];e.addListener(t,s)}}_pushHandlers(){for(const e in this.eventToHandlerStack)if(this.eventToHandlerStack.hasOwnProperty(e)){const t=this._createHandlerFn(e);this.eventToHandlerStack[e].push(t)}}_popHandlers(){for(const e in this.eventToHandlerStack)this.eventToHandlerStack.hasOwnProperty(e)&&this.eventToHandlerStack[e].pop()}_createHandlerFn(e){return(t,s,a,i)=>{this._log(e,t,s,{num_accessors:a.numAccessors,num_current_viewers:a.numCurrentViewers,num_viewers:a.numViewers,num_guests:a.numGuests,num_in_team_editors:a.numInTeamEditors,num_in_team_viewers:a.numInTeamViewers,num_non_team_editors:a.numNonTeamEditors,num_non_team_viewers:a.numNonTeamViewers,can_see_viewer_history:a.canSeeViewerHistory},i)}}}})),define("metaserver/static/js/teams/ui/team_discovery/data/reducer",["require","exports","metaserver/static/js/teams/ui/team_discovery/data/action","metaserver/static/js/teams/ui/team_discovery/data/model"],(function(e,t,s,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TeamDiscoveryReducer=t.DEFAULT_STATE=void 0,t.DEFAULT_STATE={currentPage:a.Pages.Suggest,joinableTeams:[],domainName:"",userEmail:"",userId:0,userToJoinableTeam:[]},t.TeamDiscoveryReducer=function(e=t.DEFAULT_STATE,i){switch(i.type){case s.ActionType.FetchInitData:return Object.assign(Object.assign({},e),{currentPage:a.Pages.Suggest,joinableTeams:i.payload.joinableTeams,domainName:i.payload.domainName});case s.ActionType.AskToJoinTeam:return Object.assign(Object.assign({},e),{currentPage:a.Pages.Confirm});case s.ActionType.PopulateServerProps:return Object.assign(Object.assign({},e),{userEmail:i.payload.userEmail,userId:i.payload.userId});case s.ActionType.UpdateRequestState:return Object.assign(Object.assign({},e),{joinableTeams:e.joinableTeams.map(e=>i.payload.teamId===e.id?Object.assign(Object.assign({},e),{requestState:i.payload.requestState}):e)});case s.ActionType.LoadUserData:return e.userToJoinableTeam.find(e=>e.userId===i.payload.userId)||e.userToJoinableTeam.push({userId:i.payload.userId,teamId:i.payload.teamId}),Object.assign({},e);case s.ActionType.LoadCurrentAccountData:return Object.assign(Object.assign({},e),{suggestMembersEnabled:i.payload.suggestMembersEnabled});default:return e}}})),define("metaserver/static/js/pass/seen_state_facepile_spectrumized",["require","exports","tslib","classnames","react","prop-types","lodash","typescript/component_libraries/deep-integrations/src/data/user_settings","metaserver/static/js/file_store/utils","metaserver/static/js/pass/pass_facepile_logger","metaserver/static/js/integrations/data/store","metaserver/static/js/components/ui/css","metaserver/static/js/file_viewer/share_helpers","metaserver/static/js/pass/tooltip_helpers","metaserver/static/js/clean/static_urls","metaserver/static/js/clean/analytics","metaserver/static/js/pass/avatars","metaserver/static/js/pass/constants","metaserver/static/js/pass/event_emitter","metaserver/static/js/pass/empty_seen_state_facepile","metaserver/static/js/pass/utils","metaserver/static/js/pass/types","metaserver/static/js/size_class/constants","typescript/component_libraries/spectrum-sharing/src/utils/sharing_constants","metaserver/static/js/clean/viewer","metaserver/static/js/core/user_i18n","typescript/libraries/comments2/src/components/rich_facepile/index","spectrum/facepile/index","metaserver/static/js/teams/ui/team_discovery/data/model","dig-components/typography","metaserver/static/js/teams/pending_member_context","metaserver/static/js/core/i18n"],(function(e,t,s,a,i,r,n,o,l,c,u,d,m,p,f,h,g,_,v,S,y,I,E,T,b,C,P,w,j,M,A,x){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SeenStateFacepileSpectrumized=t.SeenStateFacepileComponentSpectrumized=void 0,a=s.__importDefault(a),i=s.__importDefault(i),r=s.__importDefault(r),n=s.__importStar(n),m=s.__importStar(m),C=s.__importStar(C);class F extends i.default.Component{constructor(){super(...arguments),this.state={newPresentUserIds:[]},this.hasPassShownBeenLogged=!1,this.onAvatarHover=e=>{this.logPassEvent(_.EventTypes.PASS_HOVER),e!==P.OVERFLOW&&this.hasTeamExpandInfo(e.memberKey)&&h.TeamsWebActionsLogger.log("team_expand_info_shown",{user_id:e.memberKey})},this.hasTeamExpandInfo=e=>{const{fetchUserJoinableTeam:t,user:s,userToJoinableTeam:a}=this.props;s.is_team||(null==a?void 0:a.find(t=>t.userId===e))||!t||t(e);const i=this.getUserInfoList().find(({key:t})=>t===e);return Boolean(i&&this.getTeamExpandForUserInfo(i).teamExpandButtonText)},this.openShareModal=()=>{m.share(this.props.file,b.Viewer.get_viewer().get_user_by_id(this.props.user.id),this.props.url||null,{origin:T.SHARE_ACTION_ORIGIN_TYPE.PREVIEW_PAGE_FACEPILE})},this.onAvatarClick=e=>{this.logPassEvent(_.EventTypes.PASS_CLICK);const t=this.context.getIntegrationStore(),s=this.getPromptsToDismiss(t);s.length>0&&(0,u.wrapDispatch)(t.dispatch)((0,o.dismissPrompts)(s)),e===P.OVERFLOW&&this.openShareModal()},this.onTooltipChange=({activeMode:e,displayInfo:t},{activeMode:s,displayInfo:a})=>{null!==a&&t!==a&&this.onAvatarHover(a)},this.canShowPASS=()=>{const{isPassPermissionsPending:e,passFetchingStatus:t,passPermissions:s}=this.props;return!e&&t!==_.PassFetchingStatus.ERROR&&null!==s&&(s.canReadPresence||s.canReadSeenState)},this.canShowMembershipInfo=()=>{const{sharingStorePassInfo:e}=this.props;return e.isLoaded&&null!==e.data&&e.data.users.length>0},this.getTeamExpandForUserInfo=e=>{var t;const{joinableTeams:s,joinTeamHandler:a,user:i,userToJoinableTeam:r,suggestMembersEnabled:n}=this.props,o=b.Viewer.get_viewer();let l=[];if(this.props.userTeamInteractionInfo&&e.userId in this.props.userTeamInteractionInfo){const t=this.props.userTeamInteractionInfo[e.userId];if(null!==t){const s=(0,A.getTopContext)(t,e.email,3);for(const[e,t]of s)l.push((0,A.createContextDescription)(e,t))}else l=(0,p.buildTeamExpandReasons)(e)}if(i.is_team_admin&&!1===e.same_team&&!1===e.is_guest)return Object.assign(Object.assign({},(0,p.buildInviteToTeamProps)(e,i,o)),{teamExpandReasonsText:l});if(i.is_team&&!1===e.same_team&&!1===e.is_guest&&n)return Object.assign(Object.assign({},(0,p.buildSuggestToJoinProps)(e,i,o)),{teamExpandReasonsText:l});if(!i.is_team&&s&&a&&r){const n=null===(t=r.find(t=>t.userId===e.userId))||void 0===t?void 0:t.teamId,o=s.find(e=>e.requestState===j.RequestState.PendingApproval),l=(void 0!==o?[o]:s).find(e=>e.dbxTeamId===n);return(0,p.buildRequestJoinProps)(e,i,l,a)}return{}}}UNSAFE_componentWillMount(){this.resetLogging(),c.passFacepileLogger.listenTo(v.passEventEmitter)}componentDidMount(){this.logFacepileShownEvents()}UNSAFE_componentWillReceiveProps(e){if((0,l.areFilesEqual)(this.props.file,e.file)){if(null==e.presence||null==this.props.presence)return;const t=n.difference(e.presence,this.props.presence),s=n.difference(this.props.presence,e.presence);this.updateNewPresentUserIds(t,s)}else this.setState({newPresentUserIds:[]}),this.resetLogging()}componentDidUpdate(e){this.logFacepileShownEvents()}componentWillUnmount(){c.passFacepileLogger.unlistenTo(v.passEventEmitter)}updateNewPresentUserIds(e,t){const s=n.filter(this.state.newPresentUserIds,e=>-1===t.indexOf(e));this.setState({newPresentUserIds:[...e,...s]})}computeOverflowBasis(e){if(!this.props.uniqueMemberCountInfo.data)return e.length;let t=this.props.uniqueMemberCountInfo.data;return e.forEach(e=>{e.incrementOverflowBasis&&++t}),Math.max(t,e.length)}resetLogging(){this.hasPassShownBeenLogged=!1}logFacepileShownEvents(){if(!this.hasPassShownBeenLogged&&this.dataSufficientForLoggingHasLoaded()){const e=this.getUserInfoList();this.haveSeenStateDataToShow(e)&&(this.logPassEvent(_.EventTypes.PASS_SHOWN,e),this.hasPassShownBeenLogged=!0)}}logPassEvent(e,t){const{anonymousPresenceInfo:{length:s},file:a,passSessionId:i,passPermissions:r}=this.props,{numViewers:n,numInTeamEditors:o,numInTeamViewers:l,numNonTeamEditors:c,numNonTeamViewers:u}=this.getViewerCountByAccessLevel(),d=this.computeOverflowBasis(t||this.getUserInfoList());return v.passEventEmitter.emit(e,!1,a,{numAccessors:d,numViewers:n,numCurrentViewers:this.getNumCurrentViewers(),canSeeViewerHistory:r&&r.canReadSeenState,numGuests:s,numInTeamEditors:o,numInTeamViewers:l,numNonTeamEditors:c,numNonTeamViewers:u},i)}getViewerCountByAccessLevel(){let e,t,s=0,a=0,i=0,r=0;if(this.shouldHardcodeCurrentViewer()){t=this.seenStateDataWithViewerFiltered(this.getSeenStates());const a=this.getSeenStates().filter(e=>e.seen_state_user.user_id===this.props.user.account_id);if(a.length>0){e=0;const s=a[0];s.when_last_seen=1,t.push(s)}else e=1,s++}else e=0,t=this.getSeenStates();for(const n of t)if(null!=n.when_last_seen){e++;const t=n.seen_state_user;t.in_owners_team?t.sharing_access_type&&"edit_member_access"===t.sharing_access_type.type?s++:a++:t.sharing_access_type&&"edit_member_access"===t.sharing_access_type.type?i++:r++}return{numViewers:e,numInTeamEditors:s,numInTeamViewers:a,numNonTeamEditors:i,numNonTeamViewers:r}}getNumCurrentViewers(){if(!this.props.presence)return 0;if(this.shouldHardcodeCurrentViewer()){return 1+this.props.presence.filter(e=>e!==this.props.user.account_id).map(e=>e).length}return this.props.presence.length}userIsAnonymous(e){return n.map(this.props.anonymousPresenceInfo,e=>e.seen_state_user.user_id).indexOf(e.user_id)>=0}userIsOnline(e){return null!=this.props.presence&&this.props.presence.indexOf(e.user_id)>=0}buildUserInfo(e){const{platform_type:t,seen_state_user:s,seen_state_user:{access_level:a,display_name:i,email:r,photo_circle_url:n,sharing_access_type:o,user_id:l,same_team:c},when_last_seen:u}=e,d=l||i,m=(0,y.shouldIncrementOverflowBasisForAccessType)(o),p=this.userIsAnonymous(s),h=!c&&this.props.user.is_team&&!p;return new I.UserInfo(d,i,this.userIsOnline(s),!1,m,r,a,u,h?(0,f.static_url)("/static/metaserver/static/images/team_success/pass/nonteam_member_white-vflnM3nw0.svg"):n,l,t,c,p)}seenStateDataWithViewerFiltered(e){return n.filter(e,e=>e.seen_state_user.user_id!==this.props.user.account_id)}partitionUserInfoLists(e){const t=[],s=[],a=[],i=[],r=[],n={};for(const t of e){const e=this.buildUserInfo(t);this.userIsOnline(t.seen_state_user)?this.isNewPresentUser(e)?n[e.key]=e:this.userIsAnonymous(t.seen_state_user)?a.push(e):s.push(e):null!=t.when_last_seen?i.push(e):r.push(e)}for(const e of this.state.newPresentUserIds){const s=n[e];s&&t.push(s)}return{newPresentUserInfoList:t,presentUserInfoList:s,anonymousUserInfoList:a,offlineUserInfoList:i,neverViewedUserInfoList:r}}getUserInfoList(){let e;const t=[],s=this.getMergedSeenStateData();if(this.shouldHardcodeCurrentViewer()){e=this.seenStateDataWithViewerFiltered(s);const a=this.props.user.account_id,i=e.length<s.length&&this.getSeenStates().some(({seen_state_user:e})=>e.user_id===a&&(0,y.shouldIncrementOverflowBasisForAccessType)(e.sharing_access_type)),r=b.Viewer.get_viewer().get_user_by_id(this.props.user.id);t.push(new I.UserInfo(this.props.user.account_id,r.display_name,this.canShowPASS(),!0,i,r.email,void 0,void 0,r.photo_url,this.props.user.account_id,void 0,!0,!1))}else e=s;const a=this.partitionUserInfoLists(e),{newPresentUserInfoList:i,presentUserInfoList:r,anonymousUserInfoList:n,offlineUserInfoList:o,neverViewedUserInfoList:l}=a;return r.sort((e,t)=>e.displayName.toLowerCase().localeCompare(t.displayName.toLowerCase())),l.sort((e,t)=>e.displayName.toLowerCase().localeCompare(t.displayName.toLowerCase())),[...t,...i,...r,...n,...o,...l]}isNewPresentUser(e){return this.state.newPresentUserIds.indexOf(e.key)>=0}getMergedSeenStateData(){const e=this.getSeenStates(),t=e.map(e=>e.seen_state_user.user_id);if(this.props.sharingStorePassInfo.data){for(const s of this.props.sharingStorePassInfo.data.users){const a=s.seen_state_user.user_id;-1!==t.indexOf(a)||a===this.props.user.account_id&&this.shouldHardcodeCurrentViewer()||e.push(s)}return[...e,...this.props.anonymousPresenceInfo,...this.props.sharingStorePassInfo.data.invitees]}return[...e,...this.props.anonymousPresenceInfo]}shouldHardcodeCurrentViewer(){const e=!b.Viewer.get_viewer().is_assume_user_session,t=null!=this.props.presence&&this.props.presence.indexOf(this.props.user.account_id)>=0;return e||t}getSeenStates(){return this.props.identifiedSeenStateInfo&&this.props.identifiedSeenStateInfo.seen_states?[...this.props.identifiedSeenStateInfo.seen_states]:[]}haveSeenStateDataToShow(e){const t=e.length;return t>=2||1===t&&e[0].key!==this.props.user.account_id}dataSufficientForLoggingHasLoaded(){return this.sharingAndCountInfoHasLoaded()&&(0,_.fetchingStatusCanLogAsShown)(this.props.passFetchingStatus)}dataSufficientForDisplayHasLoaded(){return this.sharingAndCountInfoHasLoaded()&&(0,_.fetchingStatusSeenStateIsComplete)(this.props.passFetchingStatus)}sharingAndCountInfoHasLoaded(){const{sharingStorePassInfo:e,uniqueMemberCountInfo:t}=this.props;return e.isLoaded&&t.isLoaded}getPromptsToDismiss(e){return[{".tag":"tooltip_click_for_more"},{".tag":"tooltip_click_for_more_auto_display"}].filter(t=>!(0,u.isPromptDismissed)(e.getState(),t[".tag"]))}render(){const{isCollapsed:e,source:t}=this.props;if(!this.canShowPASS()&&!this.canShowMembershipInfo())return this.renderEmptyFacepile();if(!this.dataSufficientForDisplayHasLoaded())return i.default.createElement("div",null);const s=this.getUserInfoList();if(this.haveSeenStateDataToShow(s)){if(e)return this.renderCollapsedFacepile(s[0]);const a=this.computeOverflowBasis(s),r=x.intl.formatMessage({id:"6Caba5",defaultMessage:"Shared with"});return i.default.createElement("div",{className:this.facepileClassName(),"aria-label":r},i.default.createElement(P.RichFacepile,{avatarInfoList:this.computeAvatarInfos(s),becomePassiveOnOverflowAvatarClick:!0,passiveShowOnHover:!0,intl:x.intl,onAvatarClick:this.onAvatarClick,onTooltipChange:this.onTooltipChange,source:t,overflowBasis:a,sizeClass:this.getConvertedSizeClass(),sizeClassToCircleCountOverrides:{[P.SizeClass.Small]:0,[P.SizeClass.Medium]:4,[P.SizeClass.Large]:3},tooltipComponent:P.UtilTooltip}))}return this.props.soloAccessText?this.renderSoloAccessText():this.renderEmptyFacepile()}getConvertedSizeClass(){switch(this.props.sizeClass){case E.SizeClass.Small:return P.SizeClass.Small;case E.SizeClass.Medium:return P.SizeClass.Medium;case E.SizeClass.Large:return P.SizeClass.Large;case E.SizeClass.ExtraLarge:return P.SizeClass.ExtraLarge}}renderSoloAccessText(){const e=x.intl.formatMessage({id:"pQM2jx",defaultMessage:"Only you have access"});return i.default.createElement(M.Text,{color:"faint"},e)}renderEmptyFacepile(){return i.default.createElement(S.EmptySeenStateFacepile,{presenceComplete:!this.props.isPassPermissionsPending})}renderCollapsedFacepile(e){const{isActive:t,displayName:s,photoUrl:a}=e;return i.default.createElement(w.FacepileMembersAvatar,{active:t,avatarColorSeed:s,avatarSize:32,initials:C.getInitials(s),photoUrl:a||null,disabled:!0})}facepileClassName(){return(0,a.default)(_.FACEPILE_CLASSNAME,{[_.PRESENCE_RECEIVED_CLASSNAME]:!this.props.isPassPermissionsPending})}computeAvatarInfos(e){if(0===e.length)return[];const t=this.context.getIntegrationStore(),s=this.context.logEvent(),a=this.context.performanceTimer(),r=this.context.reportError(),{file:n,file:{file_id:o},user:{id:c}}=this.props,u=(0,l.getFilename)(n);return e.slice(0,P.MAX_FACES).map(e=>{const{colorSeed:n,initials:l}=(function({userId:e,displayName:t}){return e&&y.AnonymousViewerUtils.isAnonymousUserId(e)?{colorSeed:e,initials:y.AnonymousViewerUtils.getAnonymousViewerInitials(t)}:{colorSeed:t,initials:C.getInitials(t)}})(e),{isActive:d,displayName:m,key:p,userId:f,photoUrl:h}=e,_=this.hasTeamExpandInfo(e.key)?this.getTeamExpandForUserInfo(e):{};return{present:d,displayName:m,avatarColorSeed:n,initials:l,memberKey:p,photoUrl:h||null,userId:f,passiveTooltipContent:i.default.createElement(g.UserAvatarActiveTooltipContent,Object.assign({colorSeed:n,integrationStore:t,integrationInfo:{fileId:o,fileName:u,userId:c},logEvent:s,performanceTimer:a,reportError:r,userInfo:e},_))}})}}t.SeenStateFacepileComponentSpectrumized=F,F.contextTypes={getIntegrationStore:r.default.func,logEvent:r.default.func,performanceTimer:r.default.func,reportError:r.default.func},F.displayName="SeenStateFacepileComponentSpectrumized",t.SeenStateFacepileSpectrumized=(0,d.requireCssWithComponent)(F,["/static/metaserver/static/css/seen_state_facepile-vflLmnR-B.css","/static/typescript/component_libraries/deep-integrations/src/index.web-vflTFI7Au.css","/static/typescript/libraries/comments2/src/index-vfljiK9YC.css"])})),define("metaserver/static/js/pass/empty_seen_state_facepile",["require","exports","tslib","classnames","react","metaserver/static/js/pass/constants"],(function(e,t,s,a,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EmptySeenStateFacepile=void 0,a=s.__importDefault(a),i=s.__importDefault(i);t.EmptySeenStateFacepile=({presenceComplete:e})=>{const t=(0,a.default)(r.FACEPILE_CLASSNAME,r.EMPTY_FACEPILE_CLASSNAME,{[r.PRESENCE_RECEIVED_CLASSNAME]:e});return i.default.createElement("div",{className:t})},t.EmptySeenStateFacepile.displayName="EmptySeenStateFacepile"})),define("metaserver/static/js/pass/tooltip_helpers",["require","exports","tslib","react-intl","metaserver/static/js/core/i18n","metaserver/static/js/datetime/datetime","metaserver/static/js/teams/ui/team_discovery/data/model","metaserver/static/js/clean/analytics","metaserver/static/js/components/ui/modal","metaserver/static/js/pass/utils","react","metaserver/static/js/clean/viewer","metaserver/static/js/api_v2/user_client","metaserver/static/js/pass/actions","metaserver/static/js/teams/let_members_invite/non_admin_invite_modal","metaserver/static/js/loggers/join_flow_logger"],(function(e,t,s,a,i,r,n,o,l,c,u,d,m,p,f,h){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fetchInteractionsInfo=t.buildRequestJoinProps=t.buildSuggestToJoinProps=t.buildInviteToTeamProps=t.buildTeamExpandReasons=t.buildSeenStateMessage=void 0,u=s.__importDefault(u);t.buildSeenStateMessage=e=>e.isActive?i.intl.formatMessage({id:"EhtH9U",defaultMessage:"Viewing now"}):null!=e.whenLastSeen?(function(e){const t=(0,r.ago)(1e3*e.whenLastSeen,!1);return i.intl.formatMessage({id:"03+wm0",defaultMessage:"Viewed {timeAgo}"},{timeAgo:t})})(e):(function(e){switch(e){case"owner":return i.intl.formatMessage({id:"/i1m6q",defaultMessage:"Owner"});case"writer":return i.intl.formatMessage({id:"yH9Gqv",defaultMessage:"Can edit"});case"reader":return i.intl.formatMessage({id:"y7bSVp",defaultMessage:"Can comment"});case"reader_no_comment":case void 0:return i.intl.formatMessage({id:"Xoza1y",defaultMessage:"Can view"})}})(e.accessLevel);const g=(0,a.defineMessage)({id:"cIE9zv",defaultMessage:"Outside {teamname}"}),_=i.intl.formatMessage({id:"L3BzP5",defaultMessage:"Invite to team"}),v=i.intl.formatMessage({id:"XfAovr",defaultMessage:"Join team"}),S=(0,a.defineMessage)({id:"qRTK38",defaultMessage:"Member of {teamname}"}),y=i.intl.formatMessage({id:"DOjvpK",defaultMessage:"Sending request..."}),I=i.intl.formatMessage({id:"FomW4x",defaultMessage:"Request sent"}),E=i.intl.formatMessage({id:"Q6HGJm",defaultMessage:"Joined"});t.buildTeamExpandReasons=e=>{const t=[];return e&&(t.push(i.intl.formatMessage({id:"jDD++i",defaultMessage:"Content stays within the team"})),t.push(i.intl.formatMessage({id:"/a4H7F",defaultMessage:"They’ll get instant access to files"})),t.push(i.intl.formatMessage({id:"LL9D7n",defaultMessage:"Enough space to do their work"}))),t};t.buildInviteToTeamProps=(t,a,r)=>{const{team_name:n,team_id:l}=r;return{teamExpandPrimaryText:i.intl.formatMessage(g,{teamname:n}),teamExpandButtonText:_,teamExpandButtonHandler:()=>s.__awaiter(void 0,void 0,void 0,(function*(){window.dispatchEvent(new Event("resize")),t.email&&(yield new Promise((t,s)=>{e(["metaserver/static/js/teams/invite/modals/invite_confirmation_modal"],t,s)}).then(s.__importStar).then(({showInviteConfirmationModal:e})=>{t.email&&e({emailsToInvite:[t.email],origin:h.Source.PASS_INVITE})})),o.TeamsWebActionsLogger.log("pass_invite_user",{user_id:a.id,team_id:l})}))}};t.buildSuggestToJoinProps=(e,t,s)=>{const{team_id:a,team_type:r,team_name:n,work_user:d}=s;return{teamExpandPrimaryText:i.intl.formatMessage(g,{teamname:n}),teamExpandButtonText:_,teamExpandButtonHandler:()=>{a&&r?(window.dispatchEvent(new Event("resize")),l.Modal.showInstance(u.default.createElement(f.MemberInviteModalWithCSS,{user:d,open:!0,onClose:()=>l.Modal.close(),prepopulatedEmails:e.email?[e.email]:[],source:"pass",isSuggestionMode:!0}))):(0,c.navigateToSuggestModal)(e.email?[e.email]:[]),o.TeamsWebActionsLogger.log("pass_suggested_user",{user_id:t.id,team_id:a,team_type:r})}}};t.buildRequestJoinProps=(e,t,s,a)=>{if(!s)return{};const r=s.requestState;return{teamExpandPrimaryText:i.intl.formatMessage(S,{teamname:s.name}),teamExpandButtonText:r?r===n.RequestState.Sending?y:r===n.RequestState.PendingApproval?I:E:v,teamExpandButtonHandler:()=>{window.dispatchEvent(new Event("resize")),a(s),o.TeamsWebActionsLogger.log("pass_requested_access_to_team",{user_id:t.id,team_id:s.id})},showCompanyIcon:!0,isTeamExpandButtonDisabled:r===n.RequestState.PendingApproval||r===n.RequestState.Sending||r===n.RequestState.Joined}};t.fetchInteractionsInfo=(e,t,a,i)=>s.__awaiter(void 0,void 0,void 0,(function*(){const s=d.Viewer.get_viewer();if(!s.work_user||0===e.length)return;const r=[];for(const s of e){if(s in a)continue;const e=t.seen_states.map(e=>e.seen_state_user).find(e=>e.user_id===s);e&&!e.same_team&&r.push(s)}if(0===r.length)return;const n=(new m.UserApiV2Client).ns("user_to_team");yield n.rpc("get_interaction_info",{dbx_account_ids:r,team_id:s.team_id},{subjectUserId:s.work_user.id}).then(e=>{const t={};if(!e||0===e.result.length)throw Error();for(const s of e.result)t[s.dbx_account_id]=s;p.PassActions.updateUserTeamInteractionInfo(i,t)}).catch(e=>{const t={};for(const e of r)t[e]=null;p.PassActions.updateUserTeamInteractionInfo(i,t)})}))})),define("metaserver/static/js/pass/seen_state_facepile_consumer",["require","exports","tslib","react","metaserver/static/js/pass/empty_seen_state_facepile","metaserver/static/js/pass/seen_state_facepile_spectrumized","metaserver/static/js/pass/seen_state_facepile_context"],(function(e,t,s,a,i,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SeenStateFacepileConsumer=void 0,a=s.__importDefault(a);t.SeenStateFacepileConsumer=({isCollapsed:e})=>a.default.createElement(n.SeenStateFacepileContext.Consumer,null,t=>null===t?a.default.createElement(i.EmptySeenStateFacepile,{presenceComplete:!1}):"sizeClass"in t?a.default.createElement(r.SeenStateFacepileSpectrumized,Object.assign({},t,{isCollapsed:e})):a.default.createElement(i.EmptySeenStateFacepile,Object.assign({},t))),t.SeenStateFacepileConsumer.displayName="SeenStateFacepileConsumer"})),define("metaserver/static/js/teams/ui/team_discovery/data/action",["require","exports","tslib","lodash","metaserver/static/js/core/browser","metaserver/static/js/core/i18n","metaserver/static/js/core/notify","metaserver/static/js/teams/ui/team_discovery/data/model","metaserver/static/js/teams/ui/team_discovery/data/logger","react","metaserver/static/js/clean/ui/snackbar","metaserver/static/js/teams/ui/team_discovery/data/utils"],(function(e,t,s,a,i,r,n,o,l,c,u,d){"use strict";var m;function p(e){const t=c.default.createElement(u.Snackbar,Object.assign({},e,{closeButtonText:"Close",id:"teamDiscovery"}));u.Snackbar.show(t)}Object.defineProperty(t,"__esModule",{value:!0}),t.ActionCreator=t.MEMBER_TO_FETCH_LIMIT=t.showSnackbar=t.ActionType=void 0,a=s.__importStar(a),i=s.__importStar(i),c=s.__importDefault(c),(function(e){e.FetchInitData="FetchInitData",e.AskToJoinTeam="AskToJoinTeam",e.PopulateServerProps="PopulateServerProps",e.UpdateRequestState="UpdateRequestState",e.LoadUserData="LoadUserData",e.LoadCurrentAccountData="LoadCurrentAccountData"})(m=t.ActionType||(t.ActionType={})),t.showSnackbar=p,t.MEMBER_TO_FETCH_LIMIT=5;t.ActionCreator=class{constructor(e,t,s,a,i,r=!1){this.apiClient=e,this.logger=t,this.selector=s,this.contUrl=a||"/install",this.signupTag=i,this.isViralFlow=r}redirectAndNotify(e,t){const s=()=>i.redirect(this.contUrl);e?n.Notify.success(r.intl.formatMessage({id:"5lxkC0",defaultMessage:"Your request to join the team was sent successfully! Redirecting..."}),t,s):n.Notify.error(r.intl.formatMessage({id:"ZPbWOT",defaultMessage:"Something went wrong with your team join request. Redirecting..."}),t,s)}joinTeamAction(e,t,s,a=!0,r,n,c=3){return(u,d)=>{u({type:m.UpdateRequestState,payload:{teamId:e.id,requestState:o.RequestState.Sending}});const f=l.TeamSuggestPageDesign.New;return this.apiClient.ns("team_discovery").rpc("joinable_teams/join",{team_id:e.id,source:t,extra:{design:f,origin:t,signup_tag:void 0===this.signupTag?"":this.signupTag,preselect_team_id:void 0===n?"":n.toString()}},{subjectUserId:s}).then(s=>{let l,h;const g=s?s.result[".tag"]:void 0;switch(g){case o.JoinApiResultEnum.RequestSent:u({type:m.AskToJoinTeam}),l="ask_to_join",h="request_sent",u({type:m.UpdateRequestState,payload:{teamId:e.id,requestState:o.RequestState.PendingApproval}}),a?this.redirectAndNotify(!0,c):p({title:(0,o.JoinApiRetReasonToLabel)(h),variant:"complete"});break;case o.JoinApiResultEnum.RequestNotSent:h=s.result.reason[".tag"],h===o.JoinApiV2RetReason.Conflict?(u({type:m.AskToJoinTeam}),l="ask_to_join",a?this.redirectAndNotify(!0,c):p({title:(0,o.JoinApiRetReasonToLabel)(h),variant:"fail"})):(this.logger.logAskToJoinErrorEvent(e.id,this.selector.getTeamDiscoveryStoreState(d()).userId,g||"unknown",h||"unknown",t),a?this.redirectAndNotify(!1,c):p({title:(0,o.JoinApiRetReasonToLabel)(h),variant:"fail"})),u({type:m.UpdateRequestState,payload:{teamId:e.id}});break;case o.JoinApiResultEnum.CanJoin:l="can_auto_join",h="can_join",a?this.isViralFlow?this.redirectAndNotify(!0,c):i.redirect(s.result.url):p({title:"Joined team",variant:"complete"}),u({type:m.UpdateRequestState,payload:{teamId:e.id,requestState:o.RequestState.Joined}});break;default:this.logger.logAskToJoinErrorEvent(e.id,this.selector.getTeamDiscoveryStoreState(d()).userId,"unknown","other",t),u({type:m.UpdateRequestState,payload:{teamId:e.id}}),a?this.redirectAndNotify(!1,c):p({title:(0,o.JoinApiRetReasonToLabel)("other"),variant:"fail"})}this.logger.logAskToJoinEvent({teamId:e.id,userId:this.selector.getTeamDiscoveryStoreState(d()).userId,joinState:l,reason:h,origin:t,team_index:r,url:"team/discover/suggest",design:f,signupTag:this.signupTag,preselectTeamId:n})})}}fetchInitialData(e,s=t.MEMBER_TO_FETCH_LIMIT,l=!0,c=""){return(t,u)=>(t({type:m.PopulateServerProps,payload:{userEmail:e.userEmail,userId:e.userId}}),this.apiClient.ns("team_discovery").rpc("joinable_teams/list",{member_to_fetch_limit:s,sharer_dbx_team_id:e.sharerDbxTeamId,include_user_collab_teams:!0,include_rejections:!l},{subjectUserId:e.userId}).then(i=>{var r,n,c;const p=a.map(i.values,o.toJoinableTeam);l&&this.logger.logExposedToSETOnSignupPage(this.selector.getTeamDiscoveryStoreState(u()).userId,e.origin,e.signupTag,p.length,null===(r=(0,d.preselectTeam)(p,e.sharerName,e.sharerDbxTeamId))||void 0===r?void 0:r.id,s,null===(n=p[0])||void 0===n?void 0:n.isSameDomain,null===(c=p[0])||void 0===c?void 0:c.isCollaborator),t({type:m.FetchInitData,payload:{joinableTeams:p,domainName:i.domain_name}})}).catch(e=>{if(!c)throw e;{const e=r.intl.formatMessage({id:"/uOUwu",defaultMessage:"We encountered an error trying to fetch teams for you to join. Redirecting to the next page..."}),t=3;n.Notify.error(e,t,()=>i.redirect(c))}}))}fetchUserData(e,t){return(s,a)=>this.apiClient.ns("team_discovery").rpc("joinable_teams/user",{dbx_account_id:t},{subjectUserId:e}).then(e=>{s({type:m.LoadUserData,payload:{userId:t,teamId:e.dbx_team_id}})})}fetchCurrentAccount(e){return(t,s)=>this.apiClient.ns("users").rpc("get_current_account",void 0,{subjectUserId:e}).then(e=>{var s;t({type:m.LoadCurrentAccountData,payload:{suggestMembersEnabled:!!(null===(s=e.team)||void 0===s?void 0:s.team_user_permissions.suggest_members_enabled)}})})}continueToNextPage(e,t){return(s,a)=>{e.preventDefault(),this.logger.logContinueToInstallEvent(this.selector.getTeamDiscoveryStoreState(a()).userId,t),e.metaKey?i.open_tab(this.contUrl):i.redirect(this.contUrl)}}}})),define("metaserver/static/js/pass/seen_state_facepile_controller",["require","exports","tslib","react","metaserver/static/js/pass/seen_state_facepile_consumer","metaserver/static/js/file_store/utils","metaserver/static/js/pass/constants","metaserver/static/js/pass/pass_helpers","metaserver/static/js/pass/seen_state_helpers","metaserver/static/js/pass/store","metaserver/static/js/pass/types","metaserver/static/js/sharing/stores/sharing_info","metaserver/static/js/core/i18n","metaserver/static/js/pass/seen_state_facepile_context","metaserver/static/js/pass/integration/integration_provider","metaserver/static/js/teams/ui/team_discovery/data/store","metaserver/static/js/teams/ui/team_discovery/data/selector","metaserver/static/js/teams/ui/team_discovery/data/logger","metaserver/static/js/api_v2/user_client","metaserver/static/js/teams/ui/team_discovery/data/action","metaserver/static/js/teams/ui/team_discovery/data/logger","metaserver/static/js/pass/tooltip_helpers","typescript/libraries/file-viewer/src/core/utils/uuid"],(function(e,t,s,a,i,r,n,o,l,c,u,d,m,p,f,h,g,_,v,S,y,I,E){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SeenStateFacepileController=t.SeenStateFacepileProvider=t.teamDiscoveryActionCreator=t.teamDiscoverySelector=void 0,a=s.__importDefault(a),I=s.__importStar(I);const T=(0,h.getTeamDiscoveryStore)();t.teamDiscoverySelector=new g.Selector,t.teamDiscoveryActionCreator=new S.ActionCreator(new v.UserApiV2Client,new _.Logger,t.teamDiscoverySelector);class b extends a.default.Component{constructor(e){super(e),this.onUpdateFromStore=()=>{this.setState(this.getStateFromStore())},this.state=this.getStateFromStore(),this.passSessionId=e.passSessionId||(0,E.v4)()}UNSAFE_componentWillMount(){const{user:e,isViewMetadataDisabled:s}=this.props;c.passStore.add_change_listener(this.onUpdateFromStore),d.sharingInfoStore.add_change_listener(this.onUpdateFromStore),this.teamDiscoveryStoreUnsubscribe=T.subscribe(this.onUpdateFromStore),o.PassHelpers.setup({user:e,passSessionId:this.passSessionId,fileData:this.getPassFileData(),skipSharingEndpoints:s,prevFileData:null}),e&&(T.dispatch(t.teamDiscoveryActionCreator.fetchInitialData({origin:y.TeamJoinRequestOrigin.Pass,userId:e.id,userEmail:e.email},100,!1)),T.dispatch(t.teamDiscoveryActionCreator.fetchCurrentAccount(e.id)))}UNSAFE_componentWillReceiveProps(e){(0,r.areFilesEqual)(e.file,this.props.file)||this.setState({passInfo:{anonymousPresence:null,isPassPermissionsPending:!0,passFetchingStatus:n.PassFetchingStatus.FETCHING,passPermissions:null,presence:null,identifiedSeenStateInfo:null,userIdsWithoutSeenStateInfo:[]},sharingInfo:void 0})}UNSAFE_componentWillUpdate(e,t){const s=t.passInfo;if(s.userIdsWithoutSeenStateInfo.length>0&&(0,n.fetchingStatusIsSuccessful)(s.passFetchingStatus)&&e.user){const t=e.file,a=this.urlFromProps(e);l.SeenStateHelpers.fetchSeenStateUsers(e.user.id,s.identifiedSeenStateInfo,s.userIdsWithoutSeenStateInfo,t.file_id,a,this.passSessionId)}const a=t.teamExpandInfo;a&&a.userIdsWithoutTeamInteractionInfo.length>0&&null!==s.identifiedSeenStateInfo&&(0,n.fetchingStatusIsSuccessful)(s.passFetchingStatus)&&e.user&&I.fetchInteractionsInfo(a.userIdsWithoutTeamInteractionInfo,s.identifiedSeenStateInfo,a.userTeamInteractionInfo,e.file.file_id)}componentDidUpdate(e){if(!(0,r.areFilesEqual)(this.props.file,e.file)){const t={file:e.file,url:this.urlFromProps(e)},s=this.props.isViewMetadataDisabled;this.passSessionId=(0,E.v4)(),o.PassHelpers.setup({user:this.props.user,passSessionId:this.passSessionId,fileData:this.getPassFileData(),skipSharingEndpoints:s,prevFileData:t})}}componentWillUnmount(){c.passStore.remove_change_listener(this.onUpdateFromStore),d.sharingInfoStore.remove_change_listener(this.onUpdateFromStore),this.teamDiscoveryStoreUnsubscribe&&this.teamDiscoveryStoreUnsubscribe(),o.PassHelpers.teardown({user:this.props.user,fileData:this.getPassFileData(),async:!0})}getStateFromStore(){const{user:e,file:{file_id:t}}=this.props;return{passInfo:{anonymousPresence:c.passStore.anonymousPresence(t),isPassPermissionsPending:c.passStore.isPassPermissionsPending(t),passFetchingStatus:c.passStore.passFetchingStatus(t),passPermissions:c.passStore.getPassPermissions(t),presence:c.passStore.presence(t),identifiedSeenStateInfo:c.passStore.identifiedSeenStateInfo(t),userIdsWithoutSeenStateInfo:c.passStore.userIdsWithoutSeenStateInfo(t)},sharingInfo:e&&d.sharingInfoStore.getSharingInfo(e.id,t)||void 0,teamExpandInfo:e&&this.getTeamExpandInfo(e.id,t)||void 0}}getTeamExpandInfo(e,s){const{joinableTeams:a,userToJoinableTeam:i,suggestMembersEnabled:r}=t.teamDiscoverySelector.getTeamDiscoveryStoreState(T.getState());return{joinableTeams:a,userToJoinableTeam:i,joinTeamHandler:s=>{T.dispatch(t.teamDiscoveryActionCreator.joinTeamAction(s,y.TeamJoinRequestOrigin.Pass,e,!1,a.indexOf(s)))},fetchUserJoinableTeam:s=>{T.dispatch(t.teamDiscoveryActionCreator.fetchUserData(e,s))},userIdsWithoutTeamInteractionInfo:c.passStore.userIdsWithoutTeamInteractionInfo(s),userTeamInteractionInfo:c.passStore.userTeamInteractionInfo(s),suggestMembersEnabled:!!r}}getAnonymousPassInfo(){return null==this.state.passInfo.anonymousPresence?[]:this.state.passInfo.anonymousPresence.map((function(e){return{seen_state_user:{user_id:e,display_name:m.intl.formatMessage({id:"+s6D7j",defaultMessage:"Guest"})},seen_events:[]}}))}getMemberInfosInPassFormat(e){const t=e.members();return{invitees:t?this.getInviteeMemberInfos(t):[],users:t?this.getUserMemberInfos(t):[]}}getUserMemberInfos(e){return e.users.valueSeq().toArray().reduce((function(e,t){return t.account&&e.push({seen_state_user:{user_id:t.account_id,display_name:t.account.display_name,email:t.email(),photo_circle_url:t.account.profile_photo_url||void 0,access_level:t.access_type,same_team:t.same_team},seen_events:[]}),e}),[])}getInviteeMemberInfos(e){return e.invitees.valueSeq().toArray().map((function(e){return{seen_state_user:{display_name:e.contact,access_level:e.access_type},seen_events:[]}}))}getPassFileData(){return{file:this.props.file,url:this.urlFromProps()}}urlFromProps(e=this.props){return e.sharedLinkInfo?e.sharedLinkInfo.url:void 0}getPropsFromPassInfo(){return{anonymousPresenceInfo:this.getAnonymousPassInfo(),isPassPermissionsPending:this.state.passInfo.isPassPermissionsPending,passFetchingStatus:this.state.passInfo.passFetchingStatus,passPermissions:this.state.passInfo.passPermissions,presence:this.state.passInfo.presence,identifiedSeenStateInfo:this.state.passInfo.identifiedSeenStateInfo}}getPropsFromSharingInfo(){const e={uniqueMemberCountInfo:u.FacepileInfo.createNotLoaded(),sharingStorePassInfo:u.FacepileInfo.createNotLoaded()};return this.state.sharingInfo?(null!=this.state.sharingInfo.memberCounts()&&(e.uniqueMemberCountInfo=u.FacepileInfo.create(this.state.sharingInfo.memberCounts().total_unique_users)),this.state.sharingInfo.hasDisplayableMembers()&&(e.sharingStorePassInfo=u.FacepileInfo.create(this.getMemberInfosInPassFormat(this.state.sharingInfo))),e):e}getPropsFromTeamDiscovery(){return this.state.teamExpandInfo||{}}getPropsFromController(){const{file:e,sizeClass:t,soloAccessText:s}=this.props;return{file:e,sizeClass:t,url:this.urlFromProps(),soloAccessText:s}}render(){const{children:e,isViewingFileSubpath:t,user:s,source:i}=this.props,r=this.getPropsFromPassInfo();return null==s||t?a.default.createElement(p.SeenStateFacepileContext.Provider,{value:{presenceComplete:!r.isPassPermissionsPending}},e):a.default.createElement(p.SeenStateFacepileContext.Provider,{value:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},r),this.getPropsFromSharingInfo()),this.getPropsFromController()),this.getPropsFromTeamDiscovery()),{user:s,passSessionId:this.passSessionId,source:i})},a.default.createElement(f.IntegrationProvider,{user:s},e))}}t.SeenStateFacepileProvider=b,b.displayName="SeenStateFacepileProvider";class C extends a.default.Component{render(){return a.default.createElement(b,Object.assign({},this.props),a.default.createElement(i.SeenStateFacepileConsumer,null))}}t.SeenStateFacepileController=C,C.displayName="SeenStateFacepileController"})),define("metaserver/static/js/pass/seen_state_facepile_context",["require","exports","tslib","react"],(function(e,t,s,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SeenStateFacepileContext=void 0,a=s.__importDefault(a),t.SeenStateFacepileContext=a.default.createContext(null)})),define("metaserver/static/js/pass/integration/integration_provider",["require","exports","tslib","react","prop-types","metaserver/static/js/clean/web_timing_logger","metaserver/static/js/api_v2/default_user_client","metaserver/static/js/integrations/integration_popover","metaserver/static/js/integrations/data/store","metaserver/static/js/integrations/performance_timer","metaserver/static/js/integrations/log_event","metaserver/static/js/integrations/report_error"],(function(e,t,s,a,i,r,n,o,l,c,u,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IntegrationProvider=void 0,a=s.__importDefault(a),i=s.__importDefault(i);class m extends a.default.Component{constructor(e){super(e),this.mounted=!1,this.popoverGroup=new o.IntegrationPopoverGroup,this.getApiV2Client=()=>this.apiV2Client,this.getIntegrationStore=()=>this.state.integrationStore,this.getPopoverGroup=()=>this.popoverGroup,this.shouldAutoDisplayTooltip=()=>this.state.autoDisplayTooltip,this.getPerformanceTimer=()=>this.performanceTimer,this.getLogEvent=()=>this.logEvent,this.getReportError=()=>this.reportError,this.apiV2Client=new n.DefaultUserApiV2Client(this.props.user),this.performanceTimer=c.WebPerformanceTimer;const t=(0,u.createIntegrationsActionsLogger)();this.logEvent=t.logEvent,this.reportError=d.webReportError,this.state={integrationStore:(0,l.initStoreForIntegration)(this.props.user.id),autoDisplayTooltip:!1}}getChildContext(){return{getApiV2Client:this.getApiV2Client,getIntegrationStore:this.getIntegrationStore,getPopoverGroup:this.getPopoverGroup,shouldAutoDisplayTooltip:this.shouldAutoDisplayTooltip,performanceTimer:this.getPerformanceTimer,logEvent:this.getLogEvent,reportError:this.getReportError}}componentDidMount(){this.mounted=!0,(0,r.waitForTTI)().then(()=>s.__awaiter(this,void 0,void 0,(function*(){try{const e=yield this.apiV2Client.ns("integrations").rpc("get_user_settings",{},{});if(this.mounted){const t=e.dismissed_prompts.filter(e=>"tooltip_click_for_more_auto_display"===e[".tag"]).length>0;this.setState({autoDisplayTooltip:!t})}}catch(e){this.reportError(e,"non-critical",["ProfileCard"],{endpoint:"integrations/get_user_settings",entry_point:"file preview"})}})))}componentWillUnmount(){this.mounted=!1}render(){return this.props.children}}t.IntegrationProvider=m,m.childContextTypes={getApiV2Client:i.default.func,getIntegrationStore:i.default.func,getPopoverGroup:i.default.func,shouldAutoDisplayTooltip:i.default.func,performanceTimer:i.default.func,logEvent:i.default.func,reportError:i.default.func},m.displayName="IntegrationProvider"})),define("metaserver/static/js/teams/ui/team_discovery/data/selector",["require","exports","metaserver/static/js/redux/selectors","metaserver/static/js/redux/namespaces"],(function(e,t,s,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Selector=void 0;t.Selector=class{getTeamDiscoveryStoreState(e){const t=(0,s.getStateAtNamespace)(e,a.TEAM_DISCOVERY_NAMESPACE_KEY);if(void 0===t)throw Error("State in Store is undefined!");return t}}})),define("metaserver/static/js/teams/ui/team_discovery/data/store",["require","exports","metaserver/static/js/redux/store","metaserver/static/js/redux/namespaces","metaserver/static/js/teams/ui/team_discovery/data/reducer"],(function(e,t,s,a,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getTeamDiscoveryStore=void 0,t.getTeamDiscoveryStore=function(){return(0,s.getStoreAndRegisterReducers)({[a.TEAM_DISCOVERY_NAMESPACE_KEY]:i.TeamDiscoveryReducer})}})),define("metaserver/static/js/teams/pending_member_context",["require","exports","tslib","react","react-intl","metaserver/static/js/core/i18n"],(function(e,t,s,a,i,r){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.createContextDescription=t.getTopContext=t.PendingMemberContext=void 0,a=s.__importDefault(a),(function(e){e.NumCollaborators="NUM_COLLABORATORS",e.NumSharedFolders="NUM_SHARED_FOLDERS",e.NumSharedFiles="NUM_SHARED_FILES",e.TopCollaborator="TOP_COLLABORATOR",e.SameDomain="SAME_DOMAIN"})(n||(n={}));t.PendingMemberContext=({interactionsInfo:e,email:s})=>{if(void 0===e)return null;const i=(0,t.getTopContext)(e,s,3);return a.default.createElement("div",{className:"context__line-item"},i.map(([e,s])=>a.default.createElement("div",{key:e},a.default.createElement("span",{className:"context__interpunct"},"•"),a.default.createElement("span",null,(0,t.createContextDescription)(e,s)," "))))},t.PendingMemberContext.displayName="PendingMemberContext",t.PendingMemberContext.displayName="PendingMemberContext";t.getTopContext=(e,t,s)=>{const a=[],{num_collaborators:i,num_shared_folders:r,num_shared_files:o,top_collaborator:l,same_domain:c}=e;if(i>0&&a.push([n.NumCollaborators,i]),r>0&&a.push([n.NumSharedFolders,r]),o>0&&a.push([n.NumSharedFiles,o]),c){l&&a.push([n.TopCollaborator,l.name]);const e="@"+t.split("@")[1];a.push([n.SameDomain,e])}return s?a.slice(0,s):a};t.createContextDescription=(e,t)=>{const s=o[e];return r.intl.formatMessage(s,{value:t})};const o=(0,i.defineMessages)({[n.NumCollaborators]:{id:"QeEkkz",defaultMessage:"{value, plural, one{1 member works with them} other{{value} members work with them}}"},[n.NumSharedFolders]:{id:"156+gh",defaultMessage:"{value, plural, one{1 folder shared with your team} other{{value} folders shared with your team}}"},[n.NumSharedFiles]:{id:"CX5lnx",defaultMessage:"{value, plural, one{1 file shared with your team} other{{value} files shared with your team}}"},[n.TopCollaborator]:{id:"/t9NTF",defaultMessage:"{value} regularly works with them"},[n.SameDomain]:{id:"vQ0ZP6",defaultMessage:"Their email is {value}"}})})),define("metaserver/static/js/teams/let_members_invite/non_admin_invite_modal",["require","exports","tslib","react","react-intl","metaserver/static/js/deprecated_ajax/ajax_jquery","classnames","metaserver/static/js/clean/analytics","metaserver/static/js/core/notify","metaserver/static/js/core/i18n","dig-components/modal","dig-components/buttons","dig-components/typography","dig-components/icons","dig-components/icons/src","metaserver/static/js/core/html","metaserver/static/js/contacts/contact","metaserver/static/js/clean/viewer","metaserver/static/js/contacts/contact_token_state","metaserver/static/js/contacts/types","metaserver/static/js/loggers/join_flow_logger","dig-components/progress_indicators","metaserver/static/js/teams/email_checker_store","metaserver/static/js/core/browser","metaserver/static/js/components/ui/css","metaserver/static/js/clean/active_user","metaserver/static/js/contacts/tokenizer_v2"],(function(e,t,s,a,i,r,n,o,l,c,u,d,m,p,f,h,g,_,v,S,y,I,E,T,b,C,P){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MemberInviteModalWithCSS=t.MemberInviteModal=void 0,a=s.__importDefault(a),r=s.__importStar(r),n=s.__importDefault(n),S=s.__importDefault(S),T=s.__importStar(T);const w=_.Viewer.get_viewer();function j({open:e,onClose:t,user:s,numAvailableLicenses:_,source:b,membersSendInviteDomainRestrictionEnabled:j=!1,teamBusinessDomains:A=[],isSuggestionMode:x,prepopulatedEmails:F=[]}){const[D,k]=a.default.useState(!1),[L,O]=a.default.useState(null),[U,N]=a.default.useState([]),[R,q]=a.default.useState(!1),[V]=a.default.useState(new E.EmailCheckerStore("/team/manage/check_can_invite")),[H,B]=a.default.useState(),[W,z]=a.default.useState(),[J,G]=a.default.useState(F?F.map(e=>g.Contact.buildFromRawEmail(e)):[]),[K,$]=a.default.useState(J),[Y,Q]=a.default.useState(""),X=j&&A.length>0,Z=X?A:null;if(!x&&void 0===_)throw"numAvailableLicenses is required in invite mode";function ee(e,t){const s=e.filter(e=>e.type===S.default.EMAIL&&!e.invalid&&!e.on_team),a=s.map(e=>e.email);V.checkEmails(a,()=>{t(s)})}if(L){const s=()=>{G([]),O(null),N([]),B(void 0),z(void 0),t(L)};return a.default.createElement(u.Modal,{open:e,withCloseButton:c.intl.formatMessage({id:"a2rDhR",defaultMessage:"Close"}),onRequestClose:s,className:"suggestion-fallback-modal"},a.default.createElement(u.Modal.Header,{hasBottomSpacing:"title-standard"},a.default.createElement(m.Title,null,c.intl.formatMessage({id:"qn5twm",defaultMessage:"Member requests were sent to the admin"}))),a.default.createElement(u.Modal.Body,{hasVerticalSpacing:!1},a.default.createElement("ul",null,U.map(e=>a.default.createElement("li",{key:e},e)))),a.default.createElement(u.Modal.Footer,null,a.default.createElement(d.Button,{variant:"primary",onClick:s},c.intl.formatMessage({id:"MNcs5F",defaultMessage:"Got it"}))))}const te=()=>{D||(B(void 0),z(void 0),G([]),t())},se=A.map(e=>`@${e}`),ae=c.intl.formatMessage({id:"GoJlu1",defaultMessage:"name"});let ie="";if(X)switch(se.length){case 1:ie=c.intl.formatMessage({id:"m6/l0s",defaultMessage:"Add any email that ends in {oneDomain}"},{oneDomain:se[0]});break;case 2:ie=c.intl.formatMessage({id:"xw8mQ6",defaultMessage:"Add any email that ends in {firstDomain} or {secondDomain}"},{firstDomain:se[0],secondDomain:se[1]});break;default:ie=c.intl.formatMessage({id:"7aBsbD",defaultMessage:"Add any email that ends in {headDomains} or {lastDomain}"},{headDomains:se.slice(0,se.length-1).join(", ")+",",lastDomain:se[se.length-1]})}function re(e,t){const s="invite-validation-message";let i=s,r=f.FailLine;switch(e){case"warn":r=f.WarningLine,i=(0,n.default)(i,`${s}__non-admin-invite-modal-warn-extensions`);break;case"error":i=(0,n.default)(i,`${s}__non-admin-invite-modal-error-extensions`)}return a.default.createElement("div",{className:i},a.default.createElement(p.UIIcon,{size:"small",src:r,className:`${s}__icon`}),a.default.createElement(m.Text,{size:"small",color:"inherit"},t))}return a.default.createElement(i.RawIntlProvider,{value:c.intl},a.default.createElement(u.Modal,{open:e,withCloseButton:c.intl.formatMessage({id:"62wFTu",defaultMessage:"Cancel"}),onRequestClose:te,className:"non-admin-invite-modal"},a.default.createElement(u.Modal.Header,{hasBottomSpacing:"title-standard"},a.default.createElement(m.Title,null,x?c.intl.formatMessage({id:"YF+G2c",defaultMessage:"Request Invite"}):c.intl.formatMessage({id:"veD/Im",defaultMessage:"Invite people to {team_name}"},{team_name:w.team_name}))),a.default.createElement(u.Modal.Body,{hasVerticalSpacing:!1},X&&a.default.createElement("div",{className:"non-admin-invite-modal-team-business-domains"},ie),a.default.createElement(P.ContactsTokenizerV2,{user:s,placeholder:se.length>0?se.map(e=>`${ae}${e}`).join(", "):c.intl.formatMessage({id:"w5JCcS",defaultMessage:"Add an email"}),onContentsChange:function(e){$(e),ee(e,()=>{(function(e){let t=void 0,s=!0,a=void 0;for(const i of e){const{state:e,msg:r}=M(i,V,Z);e!==v.ContactTokenState.ok&&(e===v.ContactTokenState.warn?a=null!=a?a:r:(t=null!=t?t:r,s=!1))}z(a),B(t),q(s)})(e)})},onQueryChange:Q,focusOnMount:!0,initialContacts:J,contactValidator:e=>M(e,V,Z),contactFilter:function(e){return!(e.type!==S.default.EMAIL||e.team||!e.name||e.email===s.email)},disabled:D}),H&&re("error",H),W&&re("warn",W)),a.default.createElement(u.Modal.Footer,null,a.default.createElement(d.Button,{disabled:D,variant:"opacity",onClick:te,"data-testid":"cancel-button"},c.intl.formatMessage({id:"62wFTu",defaultMessage:"Cancel"})),a.default.createElement(d.Button,{variant:"primary",disabled:!R||!!Y,onClick:function(){var e;D||(e=({emails:e})=>{if(!(function(){const e=[v.ContactTokenState.ok,v.ContactTokenState.warn];return 0===K.length||K.every(t=>e.includes(M(t,V,Z).state))})())return;const s=e=>{G([]),t(e)};k(!0),x?(function(e,t,s,a){r.WebRequest({url:"/team/manage/suggest-members",data:{emails:e,url:T.get_href(),source:s},subject_user:(0,C.mustGetActiveUserId)(),complete:()=>a(!1),success:()=>(l.Notify.success(c.intl.formatMessage({id:"lMqVLz",defaultMessage:"{num_suggested, plural, one {Thanks for your suggestion! We’ve sent it to the team admin.} other {Thanks for your suggestions! We’ve sent them to the team admin.}}"},{num_suggested:e.length})),t())})})(e,s,b,k):(function(e,t,s,a,i,n,u){o.TeamsWebActionsLogger.log("invite_member_open_invite_click",{source:a,member_invite_on:!0,invite_count:e.length});const d={emails:e,team_id:w.team_id,invite_source:y.InviteSource.MEMBER_INVITE,poll_events_on_commit:!1,extra:JSON.stringify({member_send_invite_experiment_enabled:!0,origin:a})},m=Array.isArray(e);t<(m?e.length:1)&&(d.charge_for_new_licenses=!0),r.WebRequest({url:"/account/team/add_users",subject_user:w.work_user,data:d,complete:()=>i(!1),success:t=>{t=JSON.parse(t);const a=Object.values(t.users),i=t.num_suggested||0;if(a.length>0||i>0){if(0!==i)return i>0&&a.length>0?(l.Notify.success(`${c.intl.formatMessage({id:"SX0gpY",defaultMessage:"{num_invites, plural, one {Invited # person} other {Invited # people}}."},{num_invites:a.length})} ${c.intl.formatMessage({id:"lbndFp",defaultMessage:"{num_suggested, plural, one {# invite sent to admin} other {# invites sent to admin}}."},{num_suggested:i})}`),u(e.filter(e=>!a.map(e=>e.email).includes(e))),n({num_invited:a.length,invitedUsers:a})):(u(e),n({num_invited:0}));l.Notify.success(c.intl.formatMessage({id:"axSi6e",defaultMessage:"{num_invited, plural, one {Invited.} other {Invited # people.}}"},{num_invited:a.length}))}else l.Notify.error(c.intl.formatMessage({id:"bLA3rA",defaultMessage:"There was a problem completing this request."}));return s({num_invited:a.length,invitedUsers:a})},error:e=>("rate-limit"===e.getResponseHeader("x-dropbox-app-error")?l.Notify.error(new h.HTML(c.intl.formatMessage({id:"hQ0rRo",defaultMessage:"{team_name} has reached the maximum number of team members allowed on Dropbox Basic. Please <a>contact sales</a> to add more members to your team."},{team_name:w.team_name,a:e=>`<a href="/business/contact">${e}</a>`}))):(o.TeamsWebActionsLogger.log("invite_member_open_invite_error",{source:a,member_invite_on:!0,client:!0}),l.Notify.error(c.intl.formatMessage({id:"bLA3rA",defaultMessage:"There was a problem completing this request."}))),s({num_invited:0}))})})(e,_,s,b,k,O,N)},ee(K,t=>{const s=t.map(e=>e.email);e({emails:s})}))},"data-testid":"submit-button"},D?a.default.createElement(I.Spinner,{inverse:!0,size:"small"}):c.intl.formatMessage({id:"rPSCOl",defaultMessage:"Invite to join"})))))}function M(e,t,s){var a;const i=e.email;let r;if(e.invalid)r={state:v.ContactTokenState.invalid,msg:c.intl.formatMessage({id:"iWy49e",defaultMessage:"{email} is not a valid email address."},{email:i})};else if(e.on_team)r={state:v.ContactTokenState.invalid,msg:c.intl.formatMessage({id:"w6S6LE",defaultMessage:"User is already a member of this team."})};else{const e=t.getEmailCheckResult(i);let n=void 0;if(e)if(e.inFlight)r={state:v.ContactTokenState.pending,msg:n};else if(e.canInvite){if(r={state:v.ContactTokenState.ok,msg:n},s){const e=null===(a=i.match(/@(.*)$/))||void 0===a?void 0:a[1];e&&!s.includes(e)&&(r={state:v.ContactTokenState.warn,msg:c.intl.formatMessage({id:"LuEFa+",defaultMessage:"Only approved emails are automatically approved"})})}}else"team_member"===e.reason?n=c.intl.formatMessage({id:"/bTRGP",defaultMessage:"This person is already on another team."}):"already_on_this_team"===e.reason?n=c.intl.formatMessage({id:"gUZ177",defaultMessage:"User is already invited to this team."}):"error"===e.reason&&(n=c.intl.formatMessage({id:"I1RVgD",defaultMessage:"User isn’t eligible to join this team."})),r={state:v.ContactTokenState.invalid,msg:n};else r={state:v.ContactTokenState.invalid,msg:n}}return r}t.MemberInviteModal=j,t.MemberInviteModalWithCSS=(0,b.requireCssWithComponent)(j,["/static/metaserver/static/css/react/contacts_tokenizer-vflR-o-P-.css","/static/metaserver/static/css/teams/let_members_invite-vfllwVROJ.css"])})),define("metaserver/static/js/teams/email_checker_store",["require","exports","tslib","metaserver/static/js/deprecated_ajax/ajax_jquery","metaserver/static/js/clean/active_user"],(function(e,t,s,a,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EmailCheckerStore=t.EmailCheckResult=void 0,a=s.__importStar(a);class r{constructor(){this.inFlight=!0,this.canInvite=!1,this.reason="checking",this.callbacks=[]}whenReady(e){this.inFlight?this.callbacks.push(e):e()}resultArrived(e,t){if(this.inFlight){this.inFlight=!1,this.canInvite=e,this.reason=t;for(const e of this.callbacks)e();this.callbacks=[]}}}t.EmailCheckResult=r;t.EmailCheckerStore=class{constructor(e){this.checkEmails=(e,t)=>{const s={};let n=e.length;if(0===n)return t(s);const o=[];for(const a of e){let e=this.checkedEmails[a];e||(e=this.checkedEmails[a]=new r,o.push(a)),e.whenReady((function(){s[a]=e,0==--n&&t(s)}))}o.length>0&&(e=>{a.WebRequest({url:this.checkUrl,data:{emails:e.join(",")},subject_user:(0,i.mustGetActiveUserId)(),success:e=>{const t=JSON.parse(e);for(const e in t)if(t[e]){const{can_invite:s,reason:a}=t[e];this.checkedEmails[e]&&this.checkedEmails[e].resultArrived(s,a)}},error:()=>{for(const t of e)delete this.checkedEmails[t]}})})(o)},this.checkUrl=e,this.checkedEmails={}}getEmailCheckResult(e){return this.checkedEmails[e]}}})),define("metaserver/static/js/contacts/tokenizer_v2",["require","exports","tslib","react","ts-key-enum","react-intl","dig-components/typeahead","dig-components/text_fields","dig-components/icons","dig-components/icons/src","dig-components/chips","dig-components/tooltips","dig-components/avatar","dig-components/typography","metaserver/static/js/contacts/contact","metaserver/static/js/contacts/data_v2","metaserver/static/js/contacts/contact_token_state","metaserver/static/js/avatar/contact_avatar_dig"],(function(e,t,s,a,i,r,n,o,l,c,u,d,m,p,f,h,g,_){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ContactsTokenizerV2=void 0,a=s.__importDefault(a);const v=({contact:e,contactValidator:t,onDelete:s})=>{var i;const r=null==t?void 0:t(e),n={size:"small",onDelete:s,withIconLeft:e.photo_url?a.default.createElement(m.Avatar,{hasNoOutline:!0,size:"small",src:e.photo_url}):void 0,children:null!==(i=e.name)&&void 0!==i?i:e.email},o=(null==r?void 0:r.state)===g.ContactTokenState.warn?a.default.createElement(u.InputChip,Object.assign({},n,{isWarning:!0})):(null==r?void 0:r.state)===g.ContactTokenState.invalid?a.default.createElement(u.InputChip,Object.assign({},n,{isAlert:!0})):a.default.createElement(u.InputChip,Object.assign({},n));return(null==r?void 0:r.msg)?a.default.createElement(d.Tooltip,{title:r.msg},o):o};v.displayName="ContactChip";const S=({string:e,match:t})=>{if(!t||0===t.highlighted.length)return a.default.createElement(p.Text,null,e);const s=t.highlighted;return a.default.createElement(p.Text,null,s.map(([t,i],r)=>{const n=0===r?0:s[r-1][1];return a.default.createElement(a.default.Fragment,{key:r},e.slice(n,t),a.default.createElement(p.Text,{isBold:!0},e.slice(t,i)))}),e.slice(s[s.length-1][1]))};S.displayName="MatchedString";const y=({contact:e})=>a.default.createElement(n.Typeahead.Row,{key:e.getKey(),value:e,withTitle:a.default.createElement(S,{string:e.name,match:e.nameMatch}),withSubtitle:e.email&&a.default.createElement(S,{string:e.email,match:e.emailMatch}),withLeftAccessory:a.default.createElement(_.ContactAvatar,{contact:e})});y.displayName="ContactSuggestion";const I=e=>e.email||e.getKey(),E=e=>a.default.createElement(y,{contact:e}),T=(e,t)=>{let s=!1;const a=e.map(e=>{var a;if(!e.pending||!e.query)return e;const i=h.ContactsDataSourceV2.normalizeQuery(e.query),r=null===(a=t[i])||void 0===a?void 0:a.find(t=>t.email===e.email);return s=s||!!r,null!=r?r:e});return s?a:e};t.ContactsTokenizerV2=({user:e,contactFilter:t,placeholder:s,initialContacts:u,disabled:d,onContentsChange:m,contactValidator:p,onQueryChange:g,focusOnMount:_})=>{const S=a.default.useRef(null),y=a.default.useRef(null),[b,C]=a.default.useState([]),[P,w]=a.default.useState(null!=u?u:[]),[j,M]=a.default.useState(""),A=a.default.useRef(j),x=(0,r.useIntl)(),F=a.default.useMemo(()=>new h.ContactsDataSourceV2(e,t),[e,t]);a.default.useEffect(()=>null==m?void 0:m(P),[P]),a.default.useEffect(()=>{null==g||g(j),A.current=j},[j]),a.default.useEffect(()=>{var e;_&&(null===(e=y.current)||void 0===e||e.focus())},[]);const D=a.default.useCallback((e,t="")=>{w(e),M(t)},[]),k=a.default.useCallback((e,t)=>D(P.concat(e.split(/[, ]/).map(e=>e.trim()).filter(e=>!!e).map(f.Contact.buildFromRawEmail)),t),[P]);a.default.useEffect(()=>{const e=(e=>{const t=new Set(e.map(I));return e=>e.filter(e=>!t.has(I(e)))})(P);F.search(j,t=>e(t),t=>{A.current===j&&C(s=>s.concat(e(t)))})},[F,P,j]),a.default.useEffect(()=>{const e=P.reduce((e,t)=>t.pending&&t.query?[...e,t.query]:e,[]);0!==e.length&&F.searchBatch(e,e=>w(T(P,e)),e=>w(t=>T(t,e)))},[P,F]);const L=a.default.useCallback(e=>D(P.concat(e)),[P]),O=a.default.useCallback(e=>D(P.filter(t=>t.name!==e.name&&t.email!==e.email)),[P]),U=a.default.useCallback(e=>{const t=e.currentTarget.value,s=Math.max(t.lastIndexOf(","),t.lastIndexOf(" "));if(s>0){const e=s+1,a=t.slice(0,e),i=e<t.length?t.slice(e):"";k(a,i)}else M(t)},[P]),N=a.default.useCallback(e=>{e.key===i.Key.Backspace&&""===j&&P.length>0?(D(P.slice(0,-1)),e.stopPropagation()):e.key!==i.Key.Enter&&" "!==e.key||""===j||(k(j),e.stopPropagation())},[j,P]);return a.default.createElement(n.Typeahead.Wrapper,{onSelection:L},({getTriggerProps:e,getContentProps:t})=>a.default.createElement(a.default.Fragment,null,a.default.createElement(o.TextInput.Container,{ref:S},a.default.createElement(o.TextInput.Accessory,null,a.default.createElement(l.UIIcon,{src:c.SearchLine,role:"presentation"})),a.default.createElement(o.TextInput.ChipsContainer,null,!!P.length&&P.map((e,t)=>a.default.createElement(v,{key:t,contact:e,onDelete:()=>O(e),contactValidator:p})),a.default.createElement(o.TextInput.Input,Object.assign({ref:y,placeholder:s,"aria-label":x.formatMessage({id:"sZaLAU",defaultMessage:"Contact input"}),value:j,disabled:d},e({onChange:U,onKeyDown:N}))))),a.default.createElement(n.Typeahead.Container,Object.assign({},t(),{triggerRef:S}),a.default.createElement(n.Typeahead.Results,{results:b,renderRow:E}))))},t.ContactsTokenizerV2.displayName="ContactsTokenizerV2"})),define("metaserver/static/js/avatar/contact_avatar_dig",["require","exports","tslib","react","dig-components/avatar","metaserver/static/js/contacts/types","metaserver/static/js/core/user_i18n"],(function(e,t,s,a,i,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ContactAvatar=void 0,a=s.__importDefault(a),r=s.__importDefault(r);t.ContactAvatar=({contact:e,size:t})=>{const s=e.name||e.email||"";let o=e.photo_url;e.type===r.default.FB&&(o=`https://graph.facebook.com/${e.fb_id}/picture`);let l=(0,n.getInitials)(s);return o?a.default.createElement(i.Avatar,{size:t,src:o}):a.default.createElement(i.Avatar,{size:t,backgroundColor:(0,i.avatarColorForUserIdentifier)(l)},l)},t.ContactAvatar.displayName="ContactAvatar"}));
//# sourceMappingURL=pkg-pass.min.js-vfl3wFQTw.map