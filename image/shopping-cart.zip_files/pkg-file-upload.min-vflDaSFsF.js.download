define("js/pap-events/search/select_search_view_mode",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PAP_Select_SearchViewMode=void 0,t.PAP_Select_SearchViewMode=function(e){return{class:"search",action:"select",object:"search_view_mode",properties:e}}})),define("js/pap-events/search/select_search_view_mode_dropdown",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PAP_Select_SearchViewModeDropdown=void 0,t.PAP_Select_SearchViewModeDropdown=function(e){return{class:"search",action:"select",object:"search_view_mode_dropdown",properties:e}}})),define("js/pap-events/search/edit_search_filetype_filter",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PAP_Edit_SearchFiletypeFilter=void 0,t.PAP_Edit_SearchFiletypeFilter=function(e){return{class:"search",action:"edit",object:"search_filetype_filter",properties:e}}})),define("js/pap-events/search/create_search_query_history",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PAP_Create_SearchQueryHistory=void 0,t.PAP_Create_SearchQueryHistory=function(e){return{class:"search",action:"create",object:"search_query_history",properties:e}}})),define("js/pap-events/search/delete_search_query_history",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PAP_Delete_SearchQueryHistory=void 0,t.PAP_Delete_SearchQueryHistory=function(e){return{class:"search",action:"delete",object:"search_query_history",properties:e}}})),define("js/pap-events/search/select_search_query_history",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PAP_Select_SearchQueryHistory=void 0,t.PAP_Select_SearchQueryHistory=function(e){return{class:"search",action:"select",object:"search_query_history",properties:e}}})),define("js/pap-events/search/start_search_query",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PAP_Start_SearchQuery=void 0,t.PAP_Start_SearchQuery=function(e){return{class:"search",action:"start",object:"search_query",properties:e}}})),define("js/pap-events/search/finish_search_query",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PAP_Finish_SearchQuery=void 0,t.PAP_Finish_SearchQuery=function(e){return{class:"search",action:"finish",object:"search_query",properties:e}}})),define("js/pap-events/search/input_search_query",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PAP_Input_SearchQuery=void 0,t.PAP_Input_SearchQuery=function(e){return{class:"search",action:"input",object:"search_query",properties:e}}})),define("js/pap-events/search/delete_search_query",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PAP_Delete_SearchQuery=void 0,t.PAP_Delete_SearchQuery=function(e){return{class:"search",action:"delete",object:"search_query",properties:e}}})),define("js/pap-events/search/click_search_query",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PAP_Click_SearchQuery=void 0,t.PAP_Click_SearchQuery=function(e){return{class:"search",action:"click",object:"search_query",properties:e}}})),define("js/pap-events/search/log_dwell_time",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PAP_Log_DwellTime=void 0,t.PAP_Log_DwellTime=function(e){return{class:"search",action:"log",object:"dwell_time",properties:e}}})),define("js/pap-events/search/log_enriched_media_data",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PAP_Log_EnrichedMediaData=void 0,t.PAP_Log_EnrichedMediaData=function(e){return{class:"search",action:"log",object:"enriched_media_data",properties:e}}})),define("js/pap-events/search/select_search_box",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PAP_Select_SearchBox=void 0,t.PAP_Select_SearchBox=function(e){return{class:"search",action:"select",object:"search_box",properties:e}}})),define("js/pap-events/search/select_search_filters_reset",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PAP_Select_SearchFiltersReset=void 0,t.PAP_Select_SearchFiltersReset=function(e){return{class:"search",action:"select",object:"search_filters_reset",properties:e}}})),define("js/pap-events/filesystem_item_actions/star_file",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PAP_Star_File=void 0,t.PAP_Star_File=function(e){return{class:"filesystem_item_actions",action:"star",object:"file",properties:e}}})),define("js/pap-events/search/click_suggestion",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PAP_Click_Suggestion=void 0,t.PAP_Click_Suggestion=function(e){return{class:"search",action:"click",object:"suggestion",properties:e}}})),define("js/pap-events/search/fetch_suggestion",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PAP_Fetch_Suggestion=void 0,t.PAP_Fetch_Suggestion=function(e){return{class:"search",action:"fetch",object:"suggestion",properties:e}}})),define("js/pap-events/search/dismiss_suggestion",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PAP_Dismiss_Suggestion=void 0,t.PAP_Dismiss_Suggestion=function(e){return{class:"search",action:"dismiss",object:"suggestion",properties:e}}})),define("js/pap-events/search/fail_suggestion",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PAP_Fail_Suggestion=void 0,t.PAP_Fail_Suggestion=function(e){return{class:"search",action:"fail",object:"suggestion",properties:e}}})),define("js/pap-events/search/shown_suggestion",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PAP_Shown_Suggestion=void 0,t.PAP_Shown_Suggestion=function(e){return{class:"search",action:"shown",object:"suggestion",properties:e}}})),define("js/pap-events/search/click_filter",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PAP_Click_Filter=void 0,t.PAP_Click_Filter=function(e){return{class:"search",action:"click",object:"filter",properties:e}}})),define("js/pap-events/search/select_filter",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PAP_Select_Filter=void 0,t.PAP_Select_Filter=function(e){return{class:"search",action:"select",object:"filter",properties:e}}})),define("js/pap-events/search/remove_filter",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PAP_Remove_Filter=void 0,t.PAP_Remove_Filter=function(e){return{class:"search",action:"remove",object:"filter",properties:e}}})),define("js/pap-events/search/load_search_empty_state",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PAP_Load_SearchEmptyState=void 0,t.PAP_Load_SearchEmptyState=function(e){return{class:"search",action:"load",object:"search_empty_state",properties:e}}})),define("js/pap-events/search/click_spell_correct",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PAP_Click_SpellCorrect=void 0,t.PAP_Click_SpellCorrect=function(e){return{class:"search",action:"click",object:"spell_correct",properties:e}}})),define("js/pap-events/search/shown_spell_correct",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PAP_Shown_SpellCorrect=void 0,t.PAP_Shown_SpellCorrect=function(e){return{class:"search",action:"shown",object:"spell_correct",properties:e}}})),define("js/pap-events/search/change_search_right_rail",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PAP_Change_SearchRightRail=void 0,t.PAP_Change_SearchRightRail=function(e){return{class:"search",action:"change",object:"search_right_rail",properties:e}}})),define("js/pap-events/search/open_search_right_rail",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PAP_Open_SearchRightRail=void 0,t.PAP_Open_SearchRightRail=function(e){return{class:"search",action:"open",object:"search_right_rail",properties:e}}})),define("metaserver/static/js/api_v2/transport/xhr",["require","exports","metaserver/static/js/api_v2/error","metaserver/static/js/api_v2/transport/fetch","@dropbox/ttvc"],(function(e,t,s,i,a){"use strict";function r(e){const t={};return e.trim().split(/[\r\n]+/).forEach(e=>{const[s,i]=e.split(/: /);void 0!==s&&void 0!==i&&(t[s.trim()]=i.trim())}),t}Object.defineProperty(t,"__esModule",{value:!0}),t.XhrTransport=void 0;t.XhrTransport=class{constructor({onProgress:e}){this.onProgress=e}executeRpc(e,t,i,o){return(0,a.incrementAjaxCount)(),new Promise((a,n)=>{const l=new XMLHttpRequest;l.withCredentials=!0;const c=()=>s.ApiError.parseResponse(l.status,r(l.getAllResponseHeaders()),l.responseText);l.onreadystatechange=()=>{if(l.readyState===XMLHttpRequest.DONE){if(0===l.status||200===l.status)return""===l.responseText?n(s.ApiError.parseResponse(0,{},"")):a({headers:r(l.getAllResponseHeaders()),result:JSON.parse(l.responseText)});n(c())}},l.onerror=()=>{n(c())},l.upload&&void 0!==this.onProgress&&(l.upload.onprogress=this.onProgress),l.onload=()=>{l.status>=400&&n(c())},l.open("POST",e.toString(),!0);for(const[e,s]of Object.entries(t))l.setRequestHeader(e,s);l.setRequestHeader("Content-Type",o),l.send(i)}).finally(a.decrementAjaxCount)}executeBinaryRpc(e,t,s,a){return(new i.FetchAsyncTransport).executeBinaryRpc(e,t,s,a)}}})),define("metaserver/static/js/business_space/browse/data/selectors",["require","exports","metaserver/static/js/redux/namespaces","metaserver/static/js/redux/selectors","metaserver/static/js/business_space/browse/data/reducer"],(function(e,t,s,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isBusinessSpaceFound=t.selectContextMenuFileBusinessSpaceInfo=t.selectSelectedFileBusinessSpaceInfo=t.selectBusinessSpaceInfo=void 0;const r=e=>(0,i.getStateAtNamespace)(e,s.CLIENT_PORTAL_NAMESPACE_KEY)||a.defaultClientPortalState;t.selectBusinessSpaceInfo=e=>r(e).businessSpaceInfo;t.selectSelectedFileBusinessSpaceInfo=e=>r(e).selectedFileBusinessSpaceInfo;t.selectContextMenuFileBusinessSpaceInfo=e=>r(e).contextMenuFileBusinessSpaceInfo;t.isBusinessSpaceFound=e=>r(e).businessSpaceInfo.found})),define("metaserver/static/js/file_imports/components/file_imports_icon",["require","exports","tslib","react","metaserver/static/js/clean/static_urls"],(function(e,t,s,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OneDriveIcon=t.GoogleDriveIcon=void 0,i=s.__importDefault(i);t.GoogleDriveIcon=({width:e})=>i.default.createElement("img",{"aria-hidden":"true",src:(0,a.static_url)("/static/metaserver/static/images/file_imports/google_drive_icon-vfl1z5-Cq.svg"),width:e});t.OneDriveIcon=({width:e})=>i.default.createElement("img",{"aria-hidden":"true",src:(0,a.static_url)("/static/metaserver/static/images/file_imports/microsoft_onedrive_icon-vflLR7ql-.svg"),width:e})})),define("metaserver/static/js/browse/global_actions/browse_global_actions_labels",["require","exports","metaserver/static/js/core/i18n"],(function(e,t,s){"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.VAULT_BLOCK_LIST=t.getLabel=t.Label=void 0,(function(e){e[e.UploadFiles=1]="UploadFiles",e[e.UploadFolder=2]="UploadFolder",e[e.Upload=3]="Upload",e[e.Files=4]="Files",e[e.Folder=5]="Folder",e[e.NewPaperDoc=6]="NewPaperDoc",e[e.NewFolder=7]="NewFolder",e[e.RestoreFolder=8]="RestoreFolder",e[e.ReAddSharedFolder=9]="ReAddSharedFolder",e[e.ShowDeletedFiles=10]="ShowDeletedFiles",e[e.HideDeletedFiles=11]="HideDeletedFiles",e[e.NewSharedFolder=12]="NewSharedFolder",e[e.ShareFolder=13]="ShareFolder",e[e.ShareFolderAbbreviated=14]="ShareFolderAbbreviated",e[e.ManageAsAdmin=15]="ManageAsAdmin",e[e.NewTeamFolder=16]="NewTeamFolder",e[e.RequestFiles=17]="RequestFiles",e[e.FolderHistory=18]="FolderHistory",e[e.RewindFolder=19]="RewindFolder",e[e.RewindDropbox=20]="RewindDropbox"})(i=t.Label||(t.Label={}));const a={};t.getLabel=e=>(e in a||(a[e]=(e=>{switch(e){case i.UploadFiles:return s.intl.formatMessage({id:"Qayhb5",defaultMessage:"Upload files"});case i.UploadFolder:return s.intl.formatMessage({id:"53oUlv",defaultMessage:"Upload folder"});case i.Upload:return s.intl.formatMessage({id:"i98Ff5",defaultMessage:"Upload"});case i.FolderHistory:return s.intl.formatMessage({id:"BxyH89",defaultMessage:"Folder history"});case i.RewindFolder:return s.intl.formatMessage({id:"4Wq7Cq",defaultMessage:"Rewind this folder"});case i.RewindDropbox:return s.intl.formatMessage({id:"hiHRLr",defaultMessage:"Rewind Dropbox"});case i.Files:return s.intl.formatMessage({id:"bObFEu",defaultMessage:"Files"});case i.Folder:return s.intl.formatMessage({id:"MLqiSW",defaultMessage:"Folder"});case i.NewPaperDoc:return s.intl.formatMessage({id:"Jfm8Pe",defaultMessage:"New Paper Document"});case i.NewFolder:return s.intl.formatMessage({id:"pxGZm3",defaultMessage:"New folder"});case i.RestoreFolder:return s.intl.formatMessage({id:"gx89em",defaultMessage:"Restore folder"});case i.ReAddSharedFolder:return s.intl.formatMessage({id:"1YhtdU",defaultMessage:"Re-add shared folder"});case i.ShowDeletedFiles:return s.intl.formatMessage({id:"WR5EDI",defaultMessage:"Show deleted files"});case i.HideDeletedFiles:return s.intl.formatMessage({id:"j500HF",defaultMessage:"Hide deleted files"});case i.NewSharedFolder:return s.intl.formatMessage({id:"J9ZdWw",defaultMessage:"New shared folder"});case i.ShareFolder:return s.intl.formatMessage({id:"aHwEwV",defaultMessage:"Share folder"});case i.ShareFolderAbbreviated:return s.intl.formatMessage({id:"CcpVyl",defaultMessage:"Share"});case i.ManageAsAdmin:return s.intl.formatMessage({id:"SrWnn5",defaultMessage:"View in admin console"});case i.NewTeamFolder:return s.intl.formatMessage({id:"dYs+4Q",defaultMessage:"New team folder"});case i.RequestFiles:return s.intl.formatMessage({id:"QeqSyk",defaultMessage:"Request files"})}})(e)),a[e]),t.VAULT_BLOCK_LIST=new Set([(0,t.getLabel)(i.UploadFiles),(0,t.getLabel)(i.UploadFolder),(0,t.getLabel)(i.NewFolder),(0,t.getLabel)(i.RequestFiles)])})),define("metaserver/static/js/business_space/browse/constants",["require","exports"],(function(e,t){"use strict";var s;Object.defineProperty(t,"__esModule",{value:!0}),t.BsxClientSpaceUploadVariant=t.NotificationTypes=t.ClientPortalBrowseActions=t.LinkLoadingStates=t.BSX_CLIENT_SPACE_ENABLED_VARIANT=t.BsxClientSpaceVariant=void 0,(function(e){e.OFF="OFF",e.CONTROL="CONTROL",e.V0="V0"})(s=t.BsxClientSpaceVariant||(t.BsxClientSpaceVariant={})),t.BSX_CLIENT_SPACE_ENABLED_VARIANT=s.V0,(function(e){e.CLICKABLE="CLICKABLE",e.LOADING="LOADING",e.CONFIRMATION="CONFIRMATION",e.ERROR="ERROR",e.NEEDS_PRELOAD="NEEDS_PRELOAD"})(t.LinkLoadingStates||(t.LinkLoadingStates={})),(function(e){e.CREATE="CREATE",e.DELETE="DELETE",e.UPDATE_VISIBILITY="UPDATE_VISIBILITY",e.ENABLE_UPLOADS="ENABLE_UPLOADS",e.DISABLE_UPLOADS="DISABLE_UPLOADS"})(t.ClientPortalBrowseActions||(t.ClientPortalBrowseActions={})),(function(e){e.SUCCESS="SUCCESS",e.ERROR="ERROR",e.IN_PROGRESS="IN_PROGRESS"})(t.NotificationTypes||(t.NotificationTypes={})),(function(e){e.OFF="OFF",e.CONTROL="CONTROL",e.V0="V0"})(t.BsxClientSpaceUploadVariant||(t.BsxClientSpaceUploadVariant={}))})),define("metaserver/static/js/activation/data/selectors",["require","exports","reselect","metaserver/static/js/redux/namespaces","metaserver/static/js/activation/data/types","metaserver/static/js/gg_to_cdm_migration/data/types","metaserver/static/js/activation/data/types","metaserver/static/js/browse/data/selectors"],(function(e,t,s,i,a,r,o,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isDefaultRightClickContextMenuDisabled=t.shouldModifyActionMenu=t.isDefaultContextMenuEnabled=t.isValidEnhancedRightClickVariant=t.shouldShowShareButtonTooltip=t.hasFinishedFetchingSharedFolders=t.isAnyFolderBeingMounted=t.getSharedFolderData=t.isAddSharedFoldersDismissed=t.initialSuggestedItemsToMoveCount=t.shouldShowGgToCdmModal=t.shouldShowGgToCdmTooltips=t.getGgToCdmMigrationHasRestrictedTeamFoldersState=void 0;const l=e=>e[i.ACTIVATION_NAMESPACE_KEY]||o.defaultActivationState,c=(0,s.createSelector)(l,e=>e.activationPostTTIData),d=(0,s.createSelector)(c,e=>{switch(e.isFetching){case a.FetchState.NOT_STARTED:case a.FetchState.PENDING:return!0;default:return!1}}),u=(0,s.createSelector)(l,e=>e.ggToCdmMigration),p=(0,s.createSelector)(u,e=>null==e?void 0:e.onboardingState);t.getGgToCdmMigrationHasRestrictedTeamFoldersState=(0,s.createSelector)(u,e=>null==e?void 0:e.hasRestrictedTeamFolders),t.shouldShowGgToCdmTooltips=(0,s.createSelector)(p,e=>({showTooltipOne:e===r.GgToCdmMigrationOnboardingState.SHOWING_TOOLTIP_1,showTooltipTwo:e===r.GgToCdmMigrationOnboardingState.SHOWING_TOOLTIP_2,showTooltipThree:e===r.GgToCdmMigrationOnboardingState.SHOWING_TOOLTIP_3,showTooltipFour:e===r.GgToCdmMigrationOnboardingState.SHOWING_TOOLTIP_4})),t.shouldShowGgToCdmModal=(0,s.createSelector)(p,n.getBrowseState,(e,t)=>{var s;return e===r.GgToCdmMigrationOnboardingState.SHOWING_MODAL&&!0===(null===(s=t.user)||void 0===s?void 0:s.is_team_admin)});const g=(0,s.createSelector)(l,e=>e.suggestedItemsToMove);t.initialSuggestedItemsToMoveCount=(0,s.createSelector)(g,e=>{var t;return null!==(t=null==e?void 0:e.initialSuggestedItemsToMoveCount)&&void 0!==t?t:null});const h=(0,s.createSelector)(c,e=>e.addSharedFoldersInfo);t.isAddSharedFoldersDismissed=(0,s.createSelector)(h,e=>!!(null==e?void 0:e.has_dismissed_all));const _=(0,s.createSelector)(l,e=>e.addSharedFolders);t.getSharedFolderData=(0,s.createSelector)(_,h,(e,t)=>{var s,i,a;const r=null!==(s=null==e?void 0:e.data)&&void 0!==s?s:[],o=null!==(i=null==t?void 0:t.dismissed_folder_ns_ids)&&void 0!==i?i:[],n=null!==(a=null==e?void 0:e.hiddenFolderIds)&&void 0!==a?a:[];return r.filter(e=>{const t=e.nsId;return!n.includes(t)&&!o.includes(t)})}),t.isAnyFolderBeingMounted=(0,s.createSelector)(_,e=>(null==e?void 0:e.folderMountingState)===a.FolderMountingState.MOUNTING),t.hasFinishedFetchingSharedFolders=(0,s.createSelector)(_,e=>(null==e?void 0:e.fetchState)===a.FetchState.COMPLETE);const m=(0,s.createSelector)(l,e=>e.onboardingChecklistState);t.shouldShowShareButtonTooltip=(0,s.createSelector)(m,e=>Boolean(null==e?void 0:e.shouldShowShareButtonTooltip));const f=(0,s.createSelector)(c,e=>e.showEnhancedRightClick),S=(0,s.createSelector)(f,e=>{var t;return null!==(t=null==e?void 0:e.variant)&&void 0!==t?t:"OFF"});t.isValidEnhancedRightClickVariant=(0,s.createSelector)(S,e=>["V1"].includes(e)),t.isDefaultContextMenuEnabled=(0,s.createSelector)(f,t.isValidEnhancedRightClickVariant,(e,t)=>!0===(null==e?void 0:e.user_has_disabled)||!t);const v=(0,s.createSelector)(n.overflowMenuCoordinates,e=>void 0!==e),E=(0,s.createSelector)(n.selectedFiles,e=>0===(null==e?void 0:e.size));t.shouldModifyActionMenu=(0,s.createSelector)(v,t.isValidEnhancedRightClickVariant,E,(e,t,s)=>e&&t&&s),t.isDefaultRightClickContextMenuDisabled=(0,s.createSelector)(d,t.isDefaultContextMenuEnabled,(e,t)=>e||!t)})),define("metaserver/static/js/activation/data/types",["require","exports","metaserver/static/js/gg_to_cdm_migration/data/types"],(function(e,t,s){"use strict";var i,a;Object.defineProperty(t,"__esModule",{value:!0}),t.defaultActivationState=t.defaultAddSharedFolders=t.FolderMountingState=t.FetchState=void 0,(function(e){e.NOT_STARTED="not-started",e.PENDING="pending",e.COMPLETE="complete",e.ERROR="error"})(i=t.FetchState||(t.FetchState={})),(function(e){e.MOUNTING="mounting",e.IDLE="idle"})(a=t.FolderMountingState||(t.FolderMountingState={})),t.defaultAddSharedFolders={data:[],hiddenFolderIds:[],folderMountingState:a.IDLE,fetchState:i.NOT_STARTED},t.defaultActivationState={activationPostTTIData:{isFetching:i.NOT_STARTED},ggToCdmMigration:{onboardingState:s.GgToCdmMigrationOnboardingState.NOT_STARTED,hasRestrictedTeamFolders:!1},suggestedItemsToMove:{initialSuggestedItemsToMoveCount:null},addSharedFolders:t.defaultAddSharedFolders,onboardingChecklistState:{shouldShowShareButtonTooltip:!1}}})),define("metaserver/static/js/gg_to_cdm_migration/data/types",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GgToCdmMigrationOnboardingState=void 0,(function(e){e[e.NOT_STARTED=0]="NOT_STARTED",e[e.SHOWING_TOOLTIP_1=1]="SHOWING_TOOLTIP_1",e[e.SHOWING_TOOLTIP_2=2]="SHOWING_TOOLTIP_2",e[e.SHOWING_TOOLTIP_3=3]="SHOWING_TOOLTIP_3",e[e.SHOWING_TOOLTIP_4=4]="SHOWING_TOOLTIP_4",e[e.SHOWING_MODAL=5]="SHOWING_MODAL",e[e.FINISHED=6]="FINISHED"})(t.GgToCdmMigrationOnboardingState||(t.GgToCdmMigrationOnboardingState={}))})),define("metaserver/static/js/logging/hive/schemas/search-web_search_activity",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SearchWebSearchActivityRow=void 0;t.SearchWebSearchActivityRow=class{constructor(e){this.category="search-web_search_activity",this.active_user_id=null,this.anon_ip=null,this.authed_user_ids=null,this.country=null,this.identity_gid=null,this.locale_browser_header=null,this.locale_user_selected=null,this.referrer=null,this.session_id=null,this.team_id=null,this.team_type=null,this.ua_browser_name=null,this.ua_browser_version=null,this.ua_dist_name=null,this.ua_dist_version=null,this.ua_os_name=null,this.ua_os_version=null,this.user_agent=null,this.user_id=null,e.hasOwnProperty("action_type")&&void 0!==e.action_type&&(this.action_type=e.action_type),e.hasOwnProperty("active_user_id")&&void 0!==e.active_user_id&&(this.active_user_id=e.active_user_id),e.hasOwnProperty("anon_ip")&&void 0!==e.anon_ip&&(this.anon_ip=e.anon_ip),e.hasOwnProperty("authed_user_ids")&&void 0!==e.authed_user_ids&&(this.authed_user_ids=e.authed_user_ids),e.hasOwnProperty("country")&&void 0!==e.country&&(this.country=e.country),e.hasOwnProperty("deleted_filter")&&void 0!==e.deleted_filter&&(this.deleted_filter=e.deleted_filter),e.hasOwnProperty("deleted")&&void 0!==e.deleted&&(this.deleted=e.deleted),e.hasOwnProperty("event_name")&&void 0!==e.event_name&&(this.event_name=e.event_name),e.hasOwnProperty("extra")&&void 0!==e.extra&&(this.extra=e.extra),e.hasOwnProperty("failure_type")&&void 0!==e.failure_type&&(this.failure_type=e.failure_type),e.hasOwnProperty("file_extension")&&void 0!==e.file_extension&&(this.file_extension=e.file_extension),e.hasOwnProperty("file_is_shared")&&void 0!==e.file_is_shared&&(this.file_is_shared=e.file_is_shared),e.hasOwnProperty("file_last_edited")&&void 0!==e.file_last_edited&&(this.file_last_edited=e.file_last_edited),e.hasOwnProperty("file_name")&&void 0!==e.file_name&&(this.file_name=e.file_name),e.hasOwnProperty("file_nsid")&&void 0!==e.file_nsid&&(this.file_nsid=e.file_nsid),e.hasOwnProperty("file_path")&&void 0!==e.file_path&&(this.file_path=e.file_path),e.hasOwnProperty("file_size")&&void 0!==e.file_size&&(this.file_size=e.file_size),e.hasOwnProperty("file_sjid")&&void 0!==e.file_sjid&&(this.file_sjid=e.file_sjid),e.hasOwnProperty("file_type_filters")&&void 0!==e.file_type_filters&&(this.file_type_filters=e.file_type_filters),e.hasOwnProperty("identity_gid")&&void 0!==e.identity_gid&&(this.identity_gid=e.identity_gid),e.hasOwnProperty("latency")&&void 0!==e.latency&&(this.latency=null!==e.latency?e.latency.toString():null),e.hasOwnProperty("locale_browser_header")&&void 0!==e.locale_browser_header&&(this.locale_browser_header=e.locale_browser_header),e.hasOwnProperty("locale_user_selected")&&void 0!==e.locale_user_selected&&(this.locale_user_selected=e.locale_user_selected),e.hasOwnProperty("match_type")&&void 0!==e.match_type&&(this.match_type=e.match_type),e.hasOwnProperty("paper_folder_id")&&void 0!==e.paper_folder_id&&(this.paper_folder_id=e.paper_folder_id),e.hasOwnProperty("paper_pad_id")&&void 0!==e.paper_pad_id&&(this.paper_pad_id=e.paper_pad_id),e.hasOwnProperty("path_scoped")&&void 0!==e.path_scoped&&(this.path_scoped=null!==e.path_scoped?e.path_scoped.toString():null),e.hasOwnProperty("position")&&void 0!==e.position&&(this.position=null===e.position?null:e.position.toString()),e.hasOwnProperty("preview_request_id")&&void 0!==e.preview_request_id&&(this.preview_request_id=e.preview_request_id),e.hasOwnProperty("query_string")&&void 0!==e.query_string&&(this.query_string=e.query_string),e.hasOwnProperty("query_suggestion_count")&&void 0!==e.query_suggestion_count&&(this.query_suggestion_count=e.query_suggestion_count),e.hasOwnProperty("query_suggestion_strings")&&void 0!==e.query_suggestion_strings&&(this.query_suggestion_strings=e.query_suggestion_strings),e.hasOwnProperty("recent_history_map")&&void 0!==e.recent_history_map&&(this.recent_history_map=e.recent_history_map),e.hasOwnProperty("referrer")&&void 0!==e.referrer&&(this.referrer=e.referrer),e.hasOwnProperty("request_id")&&void 0!==e.request_id&&(this.request_id=e.request_id),e.hasOwnProperty("result_count")&&void 0!==e.result_count&&(this.result_count=null!==e.result_count?e.result_count.toString():null),e.hasOwnProperty("result_id")&&void 0!==e.result_id&&(this.result_id=e.result_id),e.hasOwnProperty("session_id")&&void 0!==e.session_id&&(this.session_id=e.session_id),e.hasOwnProperty("search_session_id")&&void 0!==e.search_session_id&&(this.search_session_id=e.search_session_id),e.hasOwnProperty("search_session_query_id")&&void 0!==e.search_session_query_id&&(this.search_session_query_id=e.search_session_query_id),e.hasOwnProperty("source")&&void 0!==e.source&&(this.source=e.source),e.hasOwnProperty("start")&&void 0!==e.start&&(this.start=null!==e.start?e.start.toString():null),e.hasOwnProperty("team_id")&&void 0!==e.team_id&&(this.team_id=e.team_id),e.hasOwnProperty("team_type")&&void 0!==e.team_type&&(this.team_type=e.team_type),e.hasOwnProperty("timestamp")&&void 0!==e.timestamp&&(this.timestamp=e.timestamp),e.hasOwnProperty("timezone_offset")&&void 0!==e.timezone_offset&&(this.timezone_offset=e.timezone_offset),e.hasOwnProperty("type")&&void 0!==e.type&&(this.type=e.type),e.hasOwnProperty("typeahead_session_id")&&void 0!==e.typeahead_session_id&&(this.typeahead_session_id=e.typeahead_session_id),e.hasOwnProperty("ua_browser_name")&&void 0!==e.ua_browser_name&&(this.ua_browser_name=e.ua_browser_name),e.hasOwnProperty("ua_browser_version")&&void 0!==e.ua_browser_version&&(this.ua_browser_version=e.ua_browser_version),e.hasOwnProperty("ua_dist_name")&&void 0!==e.ua_dist_name&&(this.ua_dist_name=e.ua_dist_name),e.hasOwnProperty("ua_dist_version")&&void 0!==e.ua_dist_version&&(this.ua_dist_version=e.ua_dist_version),e.hasOwnProperty("ua_os_name")&&void 0!==e.ua_os_name&&(this.ua_os_name=e.ua_os_name),e.hasOwnProperty("ua_os_version")&&void 0!==e.ua_os_version&&(this.ua_os_version=e.ua_os_version),e.hasOwnProperty("user_agent")&&void 0!==e.user_agent&&(this.user_agent=e.user_agent),e.hasOwnProperty("user_id")&&void 0!==e.user_id&&(this.user_id=e.user_id),e.hasOwnProperty("view_type")&&void 0!==e.view_type&&(this.view_type=e.view_type),e.hasOwnProperty("viewport")&&void 0!==e.viewport&&(this.viewport=e.viewport),e.hasOwnProperty("search_scoped_to_account_id")&&void 0!==e.search_scoped_to_account_id&&(this.search_scoped_to_account_id=e.search_scoped_to_account_id),e.hasOwnProperty("action_source")&&void 0!==e.action_source&&(this.action_source=e.action_source),e.hasOwnProperty("tag_suggestions_strings")&&void 0!==e.tag_suggestions_strings&&(this.tag_suggestions_strings=e.tag_suggestions_strings),e.hasOwnProperty("tag_suggestions_count")&&void 0!==e.tag_suggestions_count&&(this.tag_suggestions_count=e.tag_suggestions_count),e.hasOwnProperty("dimension_filter")&&void 0!==e.dimension_filter&&(this.dimension_filter=e.dimension_filter),e.hasOwnProperty("timestamp_ms")&&void 0!==e.timestamp_ms&&(this.timestamp_ms=e.timestamp_ms),Object.seal(this)}}})),define("metaserver/static/js/search/search_results/view",["require","exports","tslib","immutable","lodash","react","resize-observer-polyfill","classnames","dig-components/typography","spectrum/media_table/index","spectrum/table/index","spectrum/tip_card/index","js/filepath/filepath","metaserver/static/js/clean/history","metaserver/static/js/async/loadable","metaserver/static/js/browse/element_width","metaserver/static/js/browse/models","metaserver/static/js/files_view/column_helpers","metaserver/static/js/files_view/constants","metaserver/static/js/files_view/controller","metaserver/static/js/files_view/resizing/column_size_context","metaserver/static/js/files_view/types","metaserver/static/js/files_view/sort_types","metaserver/static/js/files_view/view_type","metaserver/static/js/search/constants","metaserver/static/js/search/search_helpers","metaserver/static/js/search/search_exposure_logging","metaserver/static/js/search/types","metaserver/static/js/core/i18n","metaserver/static/js/files_view/file_thumbnail"],(function(e,t,s,i,a,r,o,n,l,c,d,u,p,g,h,_,m,f,S,v,E,y,T,w,b,F,C,I,R,D){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SearchResultsView=void 0,i=s.__importStar(i),a=s.__importStar(a),r=s.__importDefault(r),o=s.__importDefault(o),n=s.__importDefault(n),p=s.__importStar(p),g=s.__importDefault(g),E=s.__importStar(E),b=s.__importStar(b),F=s.__importStar(F),C=s.__importStar(C);class O extends r.default.Component{constructor(e){super(e),this.updateScrollContainerWidth=()=>{this.props.scrollContainer&&null!==this.props.scrollContainer.current&&this.setState({scrollContainerWidth:(0,_.getWidthOfElement)(this.props.scrollContainer.current)})},this._handleScroll=()=>{this.props.onScroll()},this._ensureFileViewerClosedIfNotPreviewing=()=>{const{qargs:e}=g.default.deconstruct_url();this.props.ensureFileViewerClosedIfNotPreviewing(e)},this._handleRemoveAllFilters=e=>{e.preventDefault(),this.props.onSearchFiltersChanged({path:"/",fileCategories:Object.assign({},b.FILE_CATEGORIES_UNCHECKED),dateTaken:I.DateRange.Any,selectedDimensions:[]})},this._getRemoveAllFiltersViewUrl=()=>{const{user:e,latestQuery:t,typeaheadSessionId:s}=this.props;return F.buildSearchURL({user:e,searchPath:"/",normalizedQuery:t,typeaheadSessionId:s,searchToken:F.getSearchCsrfToken(),qargs:{file_categories:void 0}}).toString()},this._renderEmptyFolderSubtitle=()=>{const{path:e,fileCategories:t}=this.props;return p.paths_are_equal(e,"/")&&!F.fileCategoriesSet(t)?R.intl.formatMessage({id:"PtdLen",defaultMessage:"Try different keywords"}):R.intl.formatMessage({id:"00FN2D",defaultMessage:"Try <LinkScope>resetting all filters</LinkScope>"},{LinkScope:e=>r.default.createElement("a",{href:this._getRemoveAllFiltersViewUrl(),onClick:this._handleRemoveAllFilters},e)})},this._renderEmptyFolderView=()=>{const e=R.intl.formatMessage({id:"ZY55+d",defaultMessage:"No results found"});return r.default.createElement("div",null,r.default.createElement("div",{className:"u-font-center u-pad-top-xl"},r.default.createElement("div",{className:"search__view--illustration"},r.default.createElement(M,null)),r.default.createElement(l.Title,{className:"u-font-strong empty-folder-table-title"},e),r.default.createElement(l.Text,null,this._renderEmptyFolderSubtitle())))},this.state={viewTypeColumns:this._generateViewTypeColumns(),searchResultsWithUserDefinedItem:this._generateSearchResultsWithUserDefinedItem(e.searchResults)},this.resizeObserver=new o.default(this.updateScrollContainerWidth)}componentDidMount(){window.addEventListener("scroll",this._handleScroll),this.props.isColumnResizingEnabled&&(this.updateScrollContainerWidth(),window.addEventListener("resize",this.updateScrollContainerWidth));const e=document.querySelector(".maestro-secondary-sidebar-v2");e&&this.resizeObserver.observe(e),C.logSearchExperimentExposure("search_experiment_serp_design",this.props.searchResultsExperiments.expSearchSerpDesign||"UNKNOWN")}componentDidUpdate(){this.props.isColumnResizingEnabled&&!this.state.scrollContainerWidth&&this.updateScrollContainerWidth()}componentWillReceiveProps(e){const{currentSort:t,searchResults:s}=this.props,{viewType:i,currentSort:a,searchResults:r}=e,{viewTypeColumns:o}=this.state;t&&a&&o&&!F.areSortOrdersEqual(t,a)&&this.setState({viewTypeColumns:this._updateViewTypeColumns(o,i,a)}),s!==r&&this.setState({searchResultsWithUserDefinedItem:this._generateSearchResultsWithUserDefinedItem(r)})}componentWillUnmount(){window.removeEventListener("scroll",this._handleScroll),g.default.remove_callback("/search",this._ensureFileViewerClosedIfNotPreviewing),this.props.isColumnResizingEnabled&&window.removeEventListener("resize",this.updateScrollContainerWidth),this.resizeObserver.disconnect()}_getLoadingState(){const{loadingState:e}=this.props;return e===b.SearchLoadingState.LOADING_FIRST_PAGE?y.LoadingState.LOADING_FIRST_PAGE:e===b.SearchLoadingState.LOADING_ADDITIONAL_PAGE?y.LoadingState.LOADING_REMAINING_PAGES:y.LoadingState.LOADED}_getFilesViewControllerOverrides(){const e={};return"V1"===this.props.searchResultsExperiments.expSearchSerpListviewThumbnails&&(e.isExtensionThumbnailableFn=L),"V1"===this.props.searchResultsExperiments.expSearchSerpListviewBigthumbs&&(e.defaultListviewIconSize=S.LISTVIEW_LARGE_ICON_SIZE_PX,e.isRetinaThumbnailEnabled=!0),"V1"===this.props.searchResultsExperiments.expSearchSerpRedesign&&(e.isBoldFileNamesEnabled=!0,e.isMoveFilePathBelowSnippetEnabled=!0),e}_renderSearchResultItems(e){const{getOverflowMenuActions:t,onFocusSearchBar:s,onLocationLinkClick:i,onNavigateToFileOrFolder:o,onNavigateToParentFolder:n,onOpenFileSharedWithMe:l,onOpenPaper:c,context:d,fileRename:u,searchResults:p,getIsFileJumping:g,isFileViewerShown:h,arePostTTIModulesLoaded:_,onSelectionChange:m,selectedFiles:f,selection:T,setFileUploaderPath:w,user:F,path:C,filesViewActionHandlers:I,renderSharedWithController:R,hrefForFile:D,onStarClick:O,sharingServiceInfo:M,currentSort:L,onSortChange:P,onRangeInView:N,scrollContainer:j,filteredContactName:x,isColumnResizingEnabled:k,useSkinnyCheckboxes:U,isSearchTopRightSortEnabled:H}=this.props,{viewTypeColumns:W}=this.state;return r.default.createElement(v.FilesViewController,Object.assign({id:b.SEARCH_FILES_VIEW_ID},I,{getOverflowMenuActions:t,onLocationLinkClick:i,onNavigateToFileOrFolder:o,onNavigateToParentFolder:n,onOpenFileSharedWithMe:l,onOpenPaper:c,context:d,customEmptyFolderView:this._renderEmptyFolderView,createNewFolderState:y.NewFolderCreationState.CREATE_FOLDER_INACTIVE,fileRename:u,getIsFileJumping:g,isFileViewerShown:h,isSearchMode:!0,isSearchTopRightSortEnabled:H,arePostTTIModulesLoaded:_,loadingState:this._getLoadingState(),onComponentTTI:a.noop,onSelectionChange:m,onFocusSearchBar:s,path:C,selectedFiles:f,selection:T,setFileUploaderPath:w,user:F,totalNumFiles:p.size,responsive:e,columns:this._generateColumns(e),renderSharedWithController:R,hrefForFile:D,viewTypes:b.SearchViewTypes,viewTypeScope:S.VIEW_TYPE_SCOPE_TEXT_SEARCH,stickyOffsetTop:-1,sharingServiceInfo:M,onStarClick:O,items:this._generateFilesViewItems(),isStickyColumnHeader:!0,viewTypeColumns:W,onColumnsChanged:a.noop,currentSort:L,onSortChange:P,highDensity:"V1"!==this.props.searchResultsExperiments.expSearchSerpListviewBigthumbs,onRangeInView:N,scrollContainer:j,filteredContactName:x,isActionBarEnabled:!0,inlineActionBar:A,enableUnity:!0,isColumnResizingEnabled:k,columnResizeStorageSetting:E.noStorage,scrollContainerWidth:this.state.scrollContainerWidth,expManualTagging:this.props.searchResultsExperiments.expManualTagging,useSkinnyCheckboxes:U,mediaFiltersVariant:this.props.mediaFiltersVariant,overrides:this._getFilesViewControllerOverrides()}))}_generateColumns(e){const{viewType:t}=this.props,{viewTypeColumns:s}=this.state;return s?s[t]:S.SEARCH_LIST_VIEW_COLUMNS}_generateViewTypeColumns(){const{viewType:e,currentSort:t,isSearchTopRightSortEnabled:s}=this.props,i={[w.ViewType.List]:S.SEARCH_LIST_VIEW_SORT_ENABLED_COLUMNS,[w.ViewType.Grid]:S.SEARCH_GRID_VIEW_SORT_ENABLED_COLUMNS,[w.ViewType.LargeGrid]:S.SEARCH_GRID_VIEW_SORT_ENABLED_COLUMNS};return s?(i[w.ViewType.List]=S.SEARCH_LIST_VIEW_TOP_RIGHT_SORT_COLUMNS,i):t?this._updateViewTypeColumns(i,e,t):i}_isDeletedFile(e){return e instanceof m.File&&e.isDeleted}_generateSearchResultsWithUserDefinedItem(e){const t=e.filter(e=>this._isDeletedFile(e));if(t.size>0){const s=e.filter(e=>!this._isDeletedFile(e)),i=e=>{const{rowIndex:t,topOffset:s}=e;return r.default.createElement(c.CulledMediaRow,{"aria-rowindex":void 0!==t?t+1:void 0,className:"brws-user-defined-item-row",topOffset:s},r.default.createElement(d.TableCell,{key:"checkboxCell",className:"brws-checkbox-cell"}),r.default.createElement(d.TableCell,{className:"mc-media-cell"},r.default.createElement(u.TipCard,{className:"search-results__deleted-files-notice","non-dismissible":!0},R.intl.formatMessage({id:"GYhJ5f",defaultMessage:"Deleted content isn’t sorted by last modified"}))))},a=new m.UserDefinedItem({renderUserDefinedItemRow:i});return s.concat([a]).concat(t)}return i.List()}_generateFilesViewItems(){const{searchResults:e,viewType:t,currentSort:s}=this.props,i=e.filter(e=>this._isDeletedFile(e));return t===w.ViewType.List&&s&&s.sortField!==T.SortField.RELEVANCE&&i.size>0?this.state.searchResultsWithUserDefinedItem:e}_updateViewTypeColumns(e,t,s){const i=e[t];if(t===w.ViewType.List)return Object.assign(Object.assign({},e),{[t]:(0,f.swapColumns)(i,i[1].sortField,s.sortField)});{const a=e[w.ViewType.List];return Object.assign(Object.assign({},e),{[t]:(0,f.swapColumns)(i,i[0].sortField,s.sortField),[w.ViewType.List]:(0,f.swapColumns)(a,a[1].sortField,s.sortField)})}}render(){const{responsive:e}=this.props,t=(0,n.default)({"search-results":!0,"big-listview-icons-enabled":"V1"===this.props.searchResultsExperiments.expSearchSerpListviewBigthumbs});return r.default.createElement("div",{className:t},this._renderSearchResultItems(e))}}t.SearchResultsView=O,O.displayName="SearchResultsView";const A=(0,h.Loadable)({loader:()=>s.__awaiter(void 0,void 0,void 0,(function*(){const{SearchInlineActionBar:t}=yield new Promise((t,s)=>{e(["metaserver/static/js/search/single_page/search_inline_action_bar"],t,s)}).then(s.__importStar);return t}))}),M=(0,h.Loadable)({loader:()=>s.__awaiter(void 0,void 0,void 0,(function*(){const{DogDigsSpot:t}=yield new Promise((t,s)=>{e(["metaserver/static/js/dig-illustrations/spot/dog-digs"],t,s)}).then(s.__importStar);return t}))}),L=e=>(0,D.isExtensionThumbnailableByDefault)(e)||S.DOC_THUMBNAIL_EXTENSIONS.includes(e)})),define("metaserver/static/js/search/single_page/api",["require","exports","metaserver/static/js/api_v2/user_client","metaserver/static/js/contacts/data_v2"],(function(e,t,s,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getPeopleSuggestionFromApi=t.getQuerySuggestions=t.getContactApiClient=void 0;class a{constructor(e){this.filterContact=e=>!e.group_id&&!!e.dbx_account_id,this.fetchContacts=e=>new Promise((t,s)=>{""===e?this.dataSource.getAll(t):this.dataSource.search(e,t)}),this.dataSource=new i.ContactsDataSourceV2(e,this.filterContact)}}let r=null;t.getContactApiClient=function(e){return r||(r=new a(e)),r},t.getQuerySuggestions=function(e,t,i,a){return(new s.UserApiV2Client).ns("files").rpcWithResponseHeaders("get_query_suggestions",{query:t,max_results:i,search_session_id:a},{subjectUserId:e})},t.getPeopleSuggestionFromApi=function(e,t){const i={num_items:t||0,return_team_members_if_empty:!0};return(new s.UserApiV2Client).ns("search_suggestion").rpc("get_people_suggestion",i,{subjectUserId:e})}})),define("metaserver/static/js/search/single_page/data/action_creators/common",["require","exports","tslib","metaserver/static/js/search/single_page/data/selectors/index","metaserver/static/js/search/single_page/data/selectors/experiments","metaserver/static/js/media_filters/gating","metaserver/static/js/search/single_page/data/selectors/experiments","js/filepath/filepath","metaserver/static/js/search/store_helpers","metaserver/static/js/search/search_helpers"],(function(e,t,s,i,a,r,o,n,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.hasSearchChanged=t.apiCommonFields=void 0,i=s.__importStar(i),a=s.__importStar(a),n=s.__importStar(n),l=s.__importStar(l);t.apiCommonFields=e=>({user:i.user(e),path:i.path(e),query:i.normalizedQuery(e),typeaheadSessionId:i.typeaheadSessionId(e),includeBrowseContext:!1,skipLogging:!0,fileCategories:i.fileCategories(e),isPaperEnabled:i.isPaperEnabled(e),sortOrder:i.sortOrder(e),filteredAccountId:i.filteredAccountId(e),searchTags:"OFF"!==a.manualTaggingVariant(e),maxResults:a.maxResultsToFetch(e),searchDocClassification:"OFF"!==a.searchDocClassificationVariant(e),lastModifiedDate:i.lastModifiedDate(e),customLastModifiedDateRange:i.customLastModifiedDateRange(e),dateTaken:i.dateTaken(e),customDateTakenRange:i.customDateTakenRange(e),selectedDimensions:i.selectedDimensions(e),media_filters_enabled:(0,r.isMediaFiltersEnabled)((0,o.mediaFiltersVariant)(e)),media_metadata_search_enable:(0,r.isMediaMetadataSearchEnabled)((0,o.mediaFiltersVariant)(e)),isDropdown:"dropdown"===i.variant(e),enableMSOfficeThumbnails:"V1"===a.searchResultsExperiments(e).expSearchEnableMSOfficeThumbnails,searchResponseIncludeFql:a.isAdvancedSearchOperatorsEnabled(e)});t.hasSearchChanged=(e,{query:t,path:s,filteredAccountId:a,fileCategoriesString:r,lastModifiedDate:o,lastModifiedDateStart:d,lastModifiedDateEnd:u,dateTaken:p,dateTakenStart:g,dateTakenEnd:h,dimensions:_})=>{const m=i.searchArgs(e);return!n.paths_are_equal(s,m.path)||(l.normalize(t)!==m.query||(a!==m.filteredAccountId||(r!==m.fileCategoriesString||(o!==m.lastModifiedDate||d!==m.lastModifiedDateStart||u!==m.lastModifiedDateEnd||(p!==m.dateTaken||g!==m.dateTakenStart||h!==m.dateTakenEnd||(0,c.dimensionsToURLParam)(_)!==(0,c.dimensionsToURLParam)(m.dimensions))))))}})),define("metaserver/static/js/search/single_page/data/action_creators/file_actions",["require","exports","tslib","lodash","immutable","metaserver/static/js/file_actions/metrics","metaserver/static/js/file_actions/strings","metaserver/static/js/metrics/index","metaserver/static/js/clean/ui/async_file_modal_controller","metaserver/static/js/browse/action_logger","metaserver/static/js/browse/logger_util","metaserver/static/js/browse/models","metaserver/static/js/files_view/data/action_creators","metaserver/static/js/files_view/data/selectors/instance_selectors","metaserver/static/js/files_view/file_actions/api_v2","metaserver/static/js/files_view/file_actions/file_from_metadata","metaserver/static/js/files_view/file_actions/rollback","metaserver/static/js/files_view/file_actions/snackbars","metaserver/static/js/files_view/types","metaserver/static/js/files_view/util","metaserver/static/js/clean/ui/selection","metaserver/static/js/clean/ui/snackbar","metaserver/static/js/search/constants","metaserver/static/js/search/single_page/data/action_creators/index","metaserver/static/js/search/single_page/data/selectors/index","metaserver/static/js/tagging/data/action_creators","metaserver/static/js/clean/undo","metaserver/static/js/clean/web_user_action_events","metaserver/static/js/core/i18n"],(function(e,t,s,i,a,r,o,n,l,c,d,u,p,g,h,_,m,f,S,v,E,y,T,w,b,F,C,I,R){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.renameFile=t.renameUndo=t.deleteFiles=t.setIsDeletedOnPathsInResults=void 0,a=s.__importStar(a),l=s.__importStar(l),d=s.__importStar(d),p=s.__importStar(p),g=s.__importStar(g),h=s.__importStar(h),f=s.__importStar(f),b=s.__importStar(b);const D=({state:e,eventName:t,num_files_selected:s,num_folders_selected:i,batch_success_count:a,batch_fail_count:r,lookup_error_type:o,error_summary:n})=>{(0,c.logFileAction)({uid:b.user(e).id,action:t,num_files_selected:s,num_folders_selected:i,view_type:g.selectViewType(e,{instanceId:T.SEARCH_FILES_VIEW_ID}),batch_success_count:a,batch_fail_count:r,lookup_error_type:o,error_summary:n})};t.setIsDeletedOnPathsInResults=(e,t,s)=>(0,i.compact)(s.toArray().map(s=>{if((0,v.isFile)(s)&&t.includes(s.fq_path))return new u.File(Object.assign(Object.assign({},s),{isDeleted:e,thumbnail_url_tmpl:e?null:s.thumbnail_url_tmpl}))}));t.deleteFiles=({files:e,checkFSWs:i})=>function(a,c){return s.__awaiter(this,void 0,void 0,(function*(){const u=b.user(c()),p=b.context(c());yield(function({files:e,user:t,context:i}){return s.__awaiter(this,void 0,void 0,(function*(){return new Promise(s=>{l.showDelete(t,e,i,"/",s)})}))})({user:u,files:e,context:p});const g=(0,n.getMetricsReporter)(),_={surface:"search",batchSizeBucket:(0,r.bucketForBatchSize)(e.length),contentType:(0,r.batchContentType)(e)},S=g.createTimer({ns:r.FILE_ACTIONS_AMP_NAMESPACE,name:"delete/batch/latency_total_ms"},_),v=Date.now(),E=g.createStats({ns:r.FILE_ACTIONS_AMP_NAMESPACE,name:"delete/batch/latency_average_ms"},_),T=g.createStats({ns:r.FILE_ACTIONS_AMP_NAMESPACE,name:"delete/batch/completed"},_);y.Snackbar.sync(R.intl.formatMessage(o.deleteSnackbarProgressMessage,{count:e.length}),!0,"browse-action"),D({state:c(),eventName:I.WebUserActionLogEvent.DELETE_REQUEST_ATTEMPT,num_files_selected:e.length,num_folders_selected:0});const F=yield h.deleteFiles(e,u.id,i);if(F.isError&&"path"===F.error[".tag"]&&"file_system_warnings"===F.error.path[".tag"])return void a((({files:e,details:i})=>(a,r)=>s.__awaiter(void 0,void 0,void 0,(function*(){y.Snackbar.close("browse-action"),l.showFileSystemWarningsModal({fsws:i,onFinalAccept:()=>{a((0,t.deleteFiles)({files:e,checkFSWs:!1}))},confirmText:R.intl.formatMessage(o.deleteFswConfirmText)})})))({files:e,details:F.error.path.details}));if(S.record(),E.record((Date.now()-v)/e.length),F.isError)return a((({files:e,result:t})=>(i,a)=>s.__awaiter(void 0,void 0,void 0,(function*(){y.Snackbar.fail(f.deleteError(e.length,t.error),"browse-action");const s=b.selectedFiles(a()),{num_files_selected:i,num_folders_selected:r}=d.countFilesAndFolders(s);D({state:a(),eventName:I.WebUserActionLogEvent.DELETE_REQUEST_FAIL,num_files_selected:i,num_folders_selected:r,batch_success_count:0,batch_fail_count:e.length,error_summary:t.error_summary})})))({files:e,result:F})),void T.record(0);const O=F.result.entries.filter(e=>"success"===e[".tag"]),A=O.map(e=>e.metadata.path_display);a((0,w.updateResults)({results:(0,t.setIsDeletedOnPathsInResults)(!0,A,b.results(c()))}));const M=()=>s.__awaiter(this,void 0,void 0,(function*(){y.Snackbar.close("browse-action"),D({state:c(),eventName:I.WebUserActionLogEvent.DELETE_UNDO,num_files_selected:F.result.changeset_data.length,num_folders_selected:0}),(0,m.rollback)({changeset_data:F.result.changeset_data,userId:u.id,onSuccess:()=>{y.Snackbar.complete(R.intl.formatMessage(o.deleteUndoSnackbarMessage),"browse-action"),D({state:c(),eventName:I.WebUserActionLogEvent.DELETE_UNDO_REQUEST_SUCCESS,num_files_selected:F.result.changeset_data.length,num_folders_selected:0}),a((0,w.updateResults)({results:(0,t.setIsDeletedOnPathsInResults)(!1,A,b.results(c()))}))}})}));(0,C.setHandleUndo)(M);const L=F.result.entries.filter(h.isFailure),P=L[0];let N,j;if(void 0!==P){const e=P.failure;N=e[".tag"],h.isPathLookupFailure(e)&&(j=e.path_lookup[".tag"])}const x=F.result.entries.filter(e=>h.isFailure(e)&&!h.isPathLookupFailure(e.failure)).length;T.record(x>0?0:1),(0,r.recordPathLookupErrors)(L,"delete",_),L.length===F.result.entries.length?(y.Snackbar.fail(f.deleteCompleteError(L),"browse-action"),D({state:c(),eventName:I.WebUserActionLogEvent.DELETE_REQUEST_FAIL,num_files_selected:F.result.changeset_data.length,num_folders_selected:0,batch_success_count:F.result.entries.length-L.length,batch_fail_count:L.length,lookup_error_type:j,error_summary:N})):(y.Snackbar.completeWithUndo(f.deleteCompleteSuccess(e.length,O.length),M,"browse-action"),D({state:c(),eventName:I.WebUserActionLogEvent.DELETE_REQUEST_SUCCESS,num_files_selected:F.result.changeset_data.length,num_folders_selected:0,batch_success_count:F.result.entries.length,batch_fail_count:0,lookup_error_type:j,error_summary:N}))}))};t.renameUndo=({file:e,result:t})=>(i,l)=>s.__awaiter(void 0,void 0,void 0,(function*(){const s=b.user(l()),c=(0,n.getMetricsReporter)(),d={surface:"search",contentType:e.is_dir?"folders":"files",batchSizeBucket:"single"},u={latency:c.createTimer({ns:r.FILE_ACTIONS_AMP_NAMESPACE,name:"undo/latency_ms"},d),completed:c.createStats({ns:r.FILE_ACTIONS_AMP_NAMESPACE,name:"undo/completed"},d)};y.Snackbar.sync(R.intl.formatMessage(o.renameUndoSnackbarProgressMessage),!1,"browse-action"),(yield h.undo(t.result.changeset_data,s)).isError?(y.Snackbar.fail(R.intl.formatMessage(o.renameUndoSnackbarErrorMessage),"browse-action"),u.completed.record(0)):(y.Snackbar.complete(R.intl.formatMessage(o.renameUndoSnackbarSuccessMessage),"browse-action"),i((0,w.updateResults)({results:[e]})),i((0,w.setSelection)({selection:new E.Selection({selected:a.OrderedSet([e.fq_path]),anchor:null}),skipLogging:!0})),u.completed.record(1)),u.latency.record()}));t.renameFile=({file:e,name:i,checkFSWs:c})=>function(d,u){return s.__awaiter(this,void 0,void 0,(function*(){const g=b.user(u()),m=(0,n.getMetricsReporter)(),v={surface:"browse",contentType:e.is_dir?"folders":"files"},T={latency:m.createTimer({ns:r.FILE_ACTIONS_AMP_NAMESPACE,name:"rename/latency_ms"},v),completed:m.createStats({ns:r.FILE_ACTIONS_AMP_NAMESPACE,name:"rename/completed"},v)};if(-1!==i.indexOf("/"))return y.Snackbar.fail(R.intl.formatMessage(o.renameErrorInvalidName),"browse-action"),void d(p.setFileRename({file:e,renameState:null}));d(p.setFileRename({file:e,renameState:S.RenameState.SAVING_INPUT})),y.Snackbar.sync(R.intl.formatMessage(o.renameSnackbarProgressMessage),!1,"browse-action");const I=yield h.renameFile(e.fq_path,i,g.id,{checkFSWs:c});if(I.isError&&"to"===I.error[".tag"]&&"file_system_warnings"===I.error.to[".tag"])return void d((({file:e,name:i,details:a})=>r=>s.__awaiter(void 0,void 0,void 0,(function*(){y.Snackbar.close("browse-action"),l.showFileSystemWarningsModal({fsws:a,onFinalAccept:()=>{r((0,t.renameFile)({file:e,name:i,checkFSWs:!1}))},onAbortAction:()=>{r(p.setFileRename({file:e,renameState:null}))},confirmText:R.intl.formatMessage(o.renameFswConfirmText)})})))({file:e,name:i,details:I.error.to.details}));if(T.latency.record(),I.isError||"success"!==I.result.entries[0][".tag"]){const t=I.isError?I:h.createUndefinedRpcResult();return d((({file:e,result:t})=>(i,a)=>s.__awaiter(void 0,void 0,void 0,(function*(){i(p.setFileRename({file:e,renameState:null})),y.Snackbar.fail(f.renameError(t.error,e.fq_path),"browse-action")})))({file:e,result:t})),void T.completed.record(0)}const D=I.result.entries[0],O=(0,_.fileFromMetadata)(e,D.success);d((0,w.updateResults)({results:[O]})),d((0,w.setSelection)({selection:new E.Selection({selected:a.OrderedSet([O.fq_path]),anchor:null}),skipLogging:!0})),d((0,F.fileRename)({file:e,newFile:O})),d(p.setFileRename({file:e,renameState:null})),T.completed.record(1);const A=()=>{d((0,t.renameUndo)({file:e,result:I}))};(0,C.setHandleUndo)(A),y.Snackbar.completeWithUndo(R.intl.formatMessage(o.renameSnackbarSuccessMessage),A,"browse-action")}))}})),define("metaserver/static/js/search/single_page/data/action_creators/index",["require","exports","tslib","metaserver/static/js/clean/browse_uri_interface","metaserver/static/js/cloud_docs/open_with_utils","metaserver/static/js/cloud_docs/preferred_editor_utils","metaserver/static/js/cloud_docs/types","metaserver/static/js/file_operations/notifications","js/filepath/filepath","metaserver/static/js/clean/ui/async_file_modal_controller","metaserver/static/js/browse/api","metaserver/static/js/core/browser","metaserver/static/js/browse/constants","metaserver/static/js/browse/data/selectors","metaserver/static/js/browse/logger_util","metaserver/static/js/browse/models","metaserver/static/js/extensions/data/store","metaserver/static/js/files_view/data/action_creators","metaserver/static/js/files_view/data/selectors/instance_selectors","metaserver/static/js/files_view/sort_types","metaserver/static/js/files_view/util","metaserver/static/js/clean/ui/selection","metaserver/static/js/search/api","metaserver/static/js/search/api_helpers","metaserver/static/js/search/single_page/logger","metaserver/static/js/search/single_page/logger","metaserver/static/js/search/constants","metaserver/static/js/search/search_helpers","metaserver/static/js/search/single_page/api","metaserver/static/js/search/single_page/constants","metaserver/static/js/search/single_page/data/selectors/experiments","metaserver/static/js/search/single_page/data/selectors/experiments","metaserver/static/js/search/single_page/data/action_creators/common","metaserver/static/js/search/single_page/data/selectors/index","metaserver/static/js/search/single_page/data/types","metaserver/static/js/search/single_page/navigation","metaserver/static/js/search/single_page/utils","metaserver/static/js/search/store_helpers","metaserver/static/js/search/types","metaserver/static/js/core/persistence/storage","metaserver/static/js/clean/web_timing_logger","metaserver/static/js/clean/web_user_action_events","metaserver/static/js/file_viewer/constants","metaserver/static/js/core/exception","metaserver/static/js/tagging/data/action_creators","metaserver/static/js/tagging/data/selectors/index","metaserver/static/js/tagging/experiments","metaserver/static/js/tagging/utils","metaserver/static/js/media_filters/gating","metaserver/static/js/search/single_page/media_filters/media_api","metaserver/static/js/user_survey/user_survey","metaserver/static/js/starred/redux/slice","metaserver/static/js/starred/id_type_pair","metaserver/static/js/clean/ts_utils","metaserver/static/js/metrics/index","metaserver/static/js/uuid/uuid","metaserver/static/js/files_view/view_type","metaserver/static/js/files_view/constants","metaserver/static/js/search/search_exposure_logging"],(function(e,t,s,i,a,r,o,n,l,c,d,u,p,g,h,_,m,f,S,v,E,y,T,w,b,F,C,I,R,D,O,A,M,L,P,N,j,x,k,U,H,W,V,B,q,G,Q,z,K,Y,X,Z,J,$,ee,te,se,ie,ae){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setExpandedBlade=t.onResultSuggestionClick=t.dismissResultSuggestions=t.fetchResultSuggestions=t.redirectToResult=t.handleNavigateToFileOrFolder=t.shouldStartNewSearchSession=t.resetFilters=t.setFilters=t.logQueryCompleted=t.setQueryStartTime=t.setHighlightedRow=t.restoreFiles=t.purgeFiles=t.setIsFiltersUpToDateWithSearchQuery=t.setIsSearchQueryUpToDateWithFilters=t.removeResults=t.updateResults=t.setResults=t.setLastQueryWithTagsSuggestionsLoaded=t.dismissTagsSuggestions=t.fetchTagsSuggestions=t.setLastQueryWithQuerySuggestionsLoaded=t.dismissQuerySuggestions=t.dismissAllSuggestions=t.fetchQuerySuggestions=t.clearAllHistory=t.addQueryToHistory=t.loadHistory=t.stopAndLogDwellTime=t.startDwellTime=t.resetTTI=t.updateFiltersAndSearchQueryFromResponse=t.fetchFirstPage=t._performSearch=t.performSearch=t.setPreviousSearchSessionQueryId=t.setSearchSessionQueryId=t.setSearchSessionId=t.setTypeaheadSessionId=t.setPreviewCommentsThreadId=t.setPreviewFile=t.clearSelection=t.setSelection=t.fetchNextPage=t.updateFromUrl=t.setMediaData=t.setSelectedDimensions=t.setDateTaken=t.setLastModifiedDate=t.dismissPeopleSuggestions=t.fetchPeopleSuggestions=t.fetchPeopleSuggestionsForFilters=t.setFilteredAccountId=t.setSortOrder=t.setFileCategories=t.setPath=t.setQuery=t.setExperiments=t.setUser=t.setVariant=t.clear=t.setAndLogStartSearchSession=void 0,n=s.__importStar(n),l=s.__importStar(l),c=s.__importStar(c),d=s.__importStar(d),u=s.__importStar(u),g=s.__importStar(g),h=s.__importStar(h),f=s.__importStar(f),S=s.__importStar(S),b=s.__importStar(b),O=s.__importStar(O),L=s.__importStar(L),x=s.__importStar(x),q=s.__importStar(q),G=s.__importStar(G);const re=(e,t)=>{t((0,Z.fetchMissingStarredStatuses)(e.map(J.idTypePairFromStarrableItem)))};t.setAndLogStartSearchSession=(e,s)=>{const i=te.UUID.v4(),a=L.searchSessionId(s());a&&b.logStartSearchSessionQuery(a,i),e((0,t.setSearchSessionQueryId)({searchSessionQueryId:i}))};let oe=null,ne=null,le=null,ce=null;t.clear=e=>(s,i)=>{let a="/";try{a=g.path(i())}catch(e){}null!==oe&&clearTimeout(oe),s({type:P.ActionTypes.SET_QUERY,payload:{query:""}}),s({type:P.ActionTypes.CLEAR_RESULTS}),e||s({type:P.ActionTypes.SET_PATH,payload:{path:a}}),s({type:P.ActionTypes.SET_FILE_CATEGORIES,payload:{fileCategories:C.FILE_CATEGORIES_UNCHECKED}}),s(_e({loadingState:C.SearchLoadingState.ZERO_QUERY})),s({type:P.ActionTypes.SET_FILTERED_ACCOUNT_ID,payload:{filteredAccountId:void 0}}),s({type:P.ActionTypes.SET_LAST_MODIFIED_DATE,payload:{lastModifiedDate:k.DateRange.Any,customLastModifiedDateRange:void 0}}),s({type:P.ActionTypes.SET_DATE_TAKEN,payload:{dateTaken:k.DateRange.Any,customDateTakenRange:void 0}}),s({type:P.ActionTypes.SET_SELECTED_DIMENSIONS,payload:{selectedDimensions:[]}}),s((0,t.setTypeaheadSessionId)({typeaheadSessionId:(0,j.generateRandomId)()}))};t.setVariant=({variant:e})=>({type:P.ActionTypes.SET_VARIANT,payload:{variant:e}});t.setUser=({user:e,options:t})=>({type:P.ActionTypes.SET_USER,payload:{user:e,options:t}});t.setExperiments=({experiments:e})=>((0,F.updateSearchEventLoggersConfig)((null==e?void 0:e.search_experiment_serp_csat)||"OFF"),{type:P.ActionTypes.SET_EXPERIMENTS,payload:{experiments:e}});t.setQuery=({query:e,alwaysTriggerSearch:s})=>(i,a)=>{const r=x.normalize(e),o=r!==L.normalizedQuery(a()),n=""===L.normalizedQuery(a())&&o,l=(0,t.shouldStartNewSearchSession)(a(),{query:e}),c=Boolean(L.isSearchAsYouTypeEnabled(a())||s),d=L.user(a()),u=L.variant(a()),p=L.searchSessionQueryId(a()),g=L.previousSearchSessionQueryId(a());if(d&&(i({type:P.ActionTypes.SET_QUERY,payload:{query:e}}),o)){if(i((0,t.setIsFiltersUpToDateWithSearchQuery)({isFiltersUpToDateWithSearchQuery:!1})),l&&i((0,t.setTypeaheadSessionId)({typeaheadSessionId:(0,j.generateRandomId)()})),p===g&&(0,t.setAndLogStartSearchSession)(i,a),b.logQueryTyped(e),""===r&&(i((0,t.setLastQueryWithQuerySuggestionsLoaded)({lastQueryWithQuerySuggestionsLoaded:r})),i(Se({lastQueryWithPeopleSuggestionsLoaded:r})),(0,Q.isTaggingEnabled)(O.manualTaggingVariant(a()))&&i((0,t.setLastQueryWithTagsSuggestionsLoaded)({lastQueryWithTagsSuggestionsLoaded:r}))),c&&(n||l)&&i(_e({loadingState:C.SearchLoadingState.LOADING_FIRST_PAGE})),ve(),c&&L.isFullPage(a())&&N.searchNavigationManager.set(L.searchUrl(a())),de(a,{query:r})&&c)return i(ge()),void i(_e({loadingState:C.SearchLoadingState.ZERO_QUERY}));if(Boolean(r&&"full-page"===u&&!c)){if(i(ue({normalizedQuery:r,querySuggestionsData:{loadingState:k.QuerySuggestionsLoadingState.LOADING}})),i(fe({normalizedQuery:r,peopleSuggestionsData:{loadingState:k.PeopleSuggestionsLoadingState.LOADING}})),i(pe({normalizedQuery:r,tagsSuggestionsData:{loadingState:k.TagsSuggestionsLoadingState.LOADING}})),le=Ee(le),le=setTimeout(()=>{i((0,t.fetchQuerySuggestions)({query:r,maxResults:D.SEARCH_POSTERIOR_QUERY_SUGGESTIONS_CAPACITY})),le=null},D.SEARCH_QUERY_SUGGESTIONS_DEBOUNCE),(0,Q.isTaggingEnabled)(O.manualTaggingVariant(a()))){const s=(0,I.normalizeForTagsSuggestions)(e);i((0,t.fetchTagsSuggestions)({query:s}))}L.filteredAccountId(a())||i((0,t.fetchPeopleSuggestions)({query:r,user:d}));const s=L.searchArgs(a()),o=Ie(r,s);i(Re({searchArgsString:o,resultSuggestionsData:{loadingState:k.ResultSuggestionsLoadingState.LOADING}})),ce=Ee(ce),ce=setTimeout(()=>{i((0,t.fetchResultSuggestions)({normalizedQuery:r})),ce=null},100)}c&&(oe=setTimeout(()=>{(0,t.fetchFirstPage)(i,a),oe=null},D.SEARCH_QUERY_DEBOUNCE))}};t.setPath=({path:e,viewport:s,disablePerformSearch:i})=>(a,r)=>{l.paths_are_equal(e,L.path(r()))||(a({type:P.ActionTypes.SET_PATH,payload:{path:e}}),s&&b.logScopeChipChanged(e,s),i||(a((0,t.setIsSearchQueryUpToDateWithFilters)({isSearchQueryUpToDateWithFilters:!1})),(0,t._performSearch)(a,r)))};t.setFileCategories=({fileCategories:e})=>(s,i)=>{if((0,I.fileCategoriesToString)(e)!==L.fileCategoriesString(i())){if(s({type:P.ActionTypes.SET_FILE_CATEGORIES,payload:{fileCategories:e}}),L.isFullPage(i())&&N.searchNavigationManager.set(L.searchUrl(i()),!0),de(i))return s(ge()),void s(_e({loadingState:C.SearchLoadingState.ZERO_QUERY}));s((0,t.setIsSearchQueryUpToDateWithFilters)({isSearchQueryUpToDateWithFilters:!1})),(0,t._performSearch)(s,i)}};t.setSortOrder=({sortOrder:e,entryPoint:s})=>(i,a)=>{be(e,L.sortOrder(a()))||(i({type:P.ActionTypes.SET_SORT_ORDER,payload:{sortOrder:e}}),b.logSortFilterSelected(e,s),L.isFullPage(a())&&N.searchNavigationManager.set(L.searchUrl(a()),!0),i(_e({loadingState:C.SearchLoadingState.LOADING_FIRST_PAGE})),(0,t._performSearch)(i,a))};t.setFilteredAccountId=({filteredAccountId:e})=>(s,i)=>{if(e!==L.filteredAccountId(i())){if(e||b.logPeopleFilterRemoved(),s({type:P.ActionTypes.SET_FILTERED_ACCOUNT_ID,payload:{filteredAccountId:e}}),L.isFullPage(i())&&N.searchNavigationManager.set(L.searchUrl(i())),de(i,{filteredAccountId:e}))return s(ge()),void s(_e({loadingState:C.SearchLoadingState.ZERO_QUERY}));s((0,t.setIsSearchQueryUpToDateWithFilters)({isSearchQueryUpToDateWithFilters:!1})),(0,t._performSearch)(s,i)}};t.fetchPeopleSuggestionsForFilters=({user:e})=>(t,s)=>{const i=L.peopleSuggestionsForFilters(s());e&&void 0===i&&(0,R.getPeopleSuggestionFromApi)(e.id,D.SEARCH_MAX_NUM_PEOPLE_SUGGESTIONS_TO_FETCH).then(e=>{const s=e.people_suggestions||[];t(me({suggestedPeople:s}))})};t.fetchPeopleSuggestions=({user:e,query:t})=>function(i,a){var r,o;return s.__awaiter(this,void 0,void 0,(function*(){const s=x.normalize(t),n=L.peopleSuggestionsCache(a())[s];if(n){const{loadingState:e,contacts:t}=n;switch(e){case k.PeopleSuggestionsLoadingState.LOADING:if(void 0!==t)return i(fe({normalizedQuery:s,peopleSuggestionsData:{loadingState:k.PeopleSuggestionsLoadingState.LOADED}})),void i(Se({lastQueryWithPeopleSuggestionsLoaded:s}));break;case k.PeopleSuggestionsLoadingState.FAILED:break;case k.PeopleSuggestionsLoadingState.LOADED:case k.PeopleSuggestionsLoadingState.DISMISSED:return void i(Se({lastQueryWithPeopleSuggestionsLoaded:s}));default:(0,$.enforceExhaustive)(e)}}const l=yield(0,R.getContactApiClient)(e).fetchContacts(s);b.logPeopleFilterResponse(l.length);const c={contacts:l};(null!==(o=null===(r=L.peopleSuggestionsCache(a())[s])||void 0===r?void 0:r.loadingState)&&void 0!==o?o:void 0)!==k.PeopleSuggestionsLoadingState.DISMISSED&&(c.loadingState=k.PeopleSuggestionsLoadingState.LOADED),i(fe({normalizedQuery:s,peopleSuggestionsData:c})),i(Se({lastQueryWithPeopleSuggestionsLoaded:s}))}))};t.dismissPeopleSuggestions=({query:e})=>(t,s)=>{var i,a;const r=x.normalize(e);(null!==(a=null===(i=L.peopleSuggestionsCache(s())[r])||void 0===i?void 0:i.loadingState)&&void 0!==a?a:void 0)!==k.PeopleSuggestionsLoadingState.DISMISSED&&t(fe({normalizedQuery:r,peopleSuggestionsData:{loadingState:k.PeopleSuggestionsLoadingState.DISMISSED}}))};t.setLastModifiedDate=({lastModifiedDate:e,customLastModifiedDateRange:s})=>(i,a)=>{if(!(e!==k.DateRange.Custom&&e===L.lastModifiedDate(a())||e===k.DateRange.Custom&&s===L.customLastModifiedDateRange(a()))){if(i({type:P.ActionTypes.SET_LAST_MODIFIED_DATE,payload:{lastModifiedDate:e,customLastModifiedDateRange:e===k.DateRange.Custom?s:void 0}}),b.logLastModifiedFilterSelected(e,s,k.LoggingEntryPoint.SEARCH_RESULTS_PAGE),L.isFullPage(a())&&N.searchNavigationManager.set(L.searchUrl(a())),de(a,{lastModifiedDate:e,lastModifiedDateStart:null==s?void 0:s.startDate,lastModifiedDateEnd:null==s?void 0:s.endDate}))return i(ge()),void i(_e({loadingState:C.SearchLoadingState.ZERO_QUERY}));i((0,t.setIsSearchQueryUpToDateWithFilters)({isSearchQueryUpToDateWithFilters:!1})),(0,t._performSearch)(i,a)}};t.setDateTaken=({dateTaken:e,customDateTakenRange:s})=>(i,a)=>{if(e===L.dateTaken(a())){if(e!==k.DateRange.Custom)return;if(s===L.customDateTakenRange(a()))return}if(i({type:P.ActionTypes.SET_DATE_TAKEN,payload:{dateTaken:e,customDateTakenRange:e===k.DateRange.Custom?s:void 0}}),b.logDateTakenFilterSelected(e,s,k.LoggingEntryPoint.SEARCH_RESULTS_PAGE),L.isFullPage(a())&&N.searchNavigationManager.set(L.searchUrl(a())),de(a,{dateTaken:e}))return i(ge()),void i(_e({loadingState:C.SearchLoadingState.ZERO_QUERY}));i((0,t.setIsSearchQueryUpToDateWithFilters)({isSearchQueryUpToDateWithFilters:!1})),(0,t._performSearch)(i,a)};t.setSelectedDimensions=({selectedDimensions:e})=>(s,i)=>{if((0,I.dimensionsToURLParam)(e)!==(0,I.dimensionsToURLParam)(L.selectedDimensions(i()))){if(s({type:P.ActionTypes.SET_SELECTED_DIMENSIONS,payload:{selectedDimensions:e}}),b.logDimensionFilterSelected(e,k.LoggingEntryPoint.SEARCH_RESULTS_PAGE),L.isFullPage(i())&&N.searchNavigationManager.set(L.searchUrl(i())),de(i,{dimensions:e}))return s(ge()),void s(_e({loadingState:C.SearchLoadingState.ZERO_QUERY}));s((0,t.setIsSearchQueryUpToDateWithFilters)({isSearchQueryUpToDateWithFilters:!1})),(0,t._performSearch)(s,i)}};t.setMediaData=(e,t,i)=>(a,r)=>s.__awaiter(void 0,void 0,void 0,(function*(){const s=yield(0,Y.enrichedMediaDataFromApi)(e,t);if(b.logEnrichedMediaDataReceived((null==s?void 0:s.enriched_media_data)||[],i),void 0===(null==s?void 0:s.enriched_media_data))return;const r=s.enriched_media_data;a({type:P.ActionTypes.SET_MEDIA_DATA,payload:{filesMediaData:r}})}));t.updateFromUrl=({path:e,query:s,typeahead_session_id:i,preview:a,file_categories:r,search_order_by:o,search_reverse_order:n,search_account_id:l,search_from:c,search_last_modified_date:d,search_last_modified_date_start:u,search_last_modified_date_end:p,search_date_taken:g,search_date_taken_start:h,search_date_taken_end:_,search_dimensions:m})=>(f,S)=>{let v=!1;const E=s||"",y=r||"";E!==L.query(S())&&(v=!0,f({type:P.ActionTypes.SET_QUERY,payload:{query:E}})),void 0!==e&&e!==L.path(S())&&(v=!0,f({type:P.ActionTypes.SET_PATH,payload:{path:e}})),y!==L.fileCategoriesString(S())&&(v=!0,f({type:P.ActionTypes.SET_FILE_CATEGORIES,payload:{fileCategories:(0,I.fileCategoriesFromString)(y)}}));const T=Te(c),w={sortField:ye(o),sortDirection:we(n)};if(be(w,L.sortOrder(S()))||(f({type:P.ActionTypes.SET_SORT_ORDER,payload:{sortOrder:w}}),b.logSortFilterSelected(w),v=!0),l!==L.filteredAccountId(S())){v=!0,f({type:P.ActionTypes.SET_FILTERED_ACCOUNT_ID,payload:{filteredAccountId:l}});const e=L.user(S());e&&f((0,t.fetchPeopleSuggestions)({query:"",user:e}))}void 0!==i&&i!==L.typeaheadSessionId(S())&&(v=!0,f((0,t.setTypeaheadSessionId)({typeaheadSessionId:i}))),a!==L.previewFileId(S())&&f({type:P.ActionTypes.SET_PREVIEW_FILE_ID,payload:{previewFileId:""===a?void 0:a}});const F=!!d&&Number(d)!==L.lastModifiedDate(S()),R=L.customLastModifiedDateRange(S()),D=!!u&&u!==(null==R?void 0:R.startDate.toISOString()),O=!!p&&p!==(null==R?void 0:R.endDate.toISOString());if((F||D||O)&&f({type:P.ActionTypes.SET_LAST_MODIFIED_DATE,payload:{lastModifiedDate:Number(d),customLastModifiedDateRange:u&&p?{startDate:new Date(u),endDate:new Date(p)}:void 0}}),void 0!==g&&""!==g&&Number(g)!==L.dateTaken(S())){let e;void 0!==h&&void 0!==_&&(e={startDate:new Date(h),endDate:new Date(_)}),f({type:P.ActionTypes.SET_DATE_TAKEN,payload:{dateTaken:Number(g),customDateTakenRange:e}})}void 0!==m&&""!==m&&(0,I.dimensionsToURLParam)(L.selectedDimensions(S()))!==m&&f({type:P.ActionTypes.SET_SELECTED_DIMENSIONS,payload:{selectedDimensions:(0,I.parseDimensionsUrlParam)(m)}}),v&&(de(S)?(f(ge()),f(_e({loadingState:C.SearchLoadingState.ZERO_QUERY}))):f((e,s)=>(0,t._performSearch)(e,s,T)))};t.fetchNextPage=()=>(e,s)=>{const i=L.user(s()),a=L.searchArgs(s()),r=L.hasMoreResults(s()),o=L.cursor(s()),n=(0,M.apiCommonFields)(s()),l=(0,K.isMediaFiltersEnabled)((0,A.mediaFiltersVariant)(s()));i&&r&&!de(s)&&(L.numResults(s())>0&&e(_e({loadingState:C.SearchLoadingState.LOADING_ADDITIONAL_PAGE})),T.searchApiClient.loadPartialResults(Object.assign(Object.assign({},n),{start:L.nextPageOffset(s()),cursor:o,onSuccess:({searchResults:r})=>{if((0,M.hasSearchChanged)(s(),a))return;e(he({searchResults:r,loadingState:C.SearchLoadingState.LOADED})),(0,Q.isTaggingEnabled)(O.manualTaggingVariant(s()))&&e(q.fetchTagsForFiles({user:i,files:r.results.filter(E.isFile)})),l&&e((0,t.setMediaData)(i,r.results.filter(Fe),a.query)),e((0,t.logQueryCompleted)(!1)),r.results.length&&(0,m.initializeStore)(i,r.results.filter(Fe)),re(r.results,e);const o=D.SEARCH_MIN_PAGE_SIZE;r.hasMore&&r.results.length<o&&e((0,t.fetchNextPage)())},onError:e=>{const t=(new Date).getTime()-L.queryStartTime(s());b.logQueryFailed(t,e,C.SearchOriginPathway.WEB),(0,B.reportException)({err:new Error(e),severity:"non-critical",tags:["js:search"]})}})))};t.setSelection=({selection:e,actionSource:t,skipLogging:s})=>(i,a)=>{if(!s){const s=a(),{event:i,itemId:r}=h.makeSelectionEvent(L.selection(s),e),o=L.selectResultById(s,{id:r});if(o){const{num_files_selected:a,num_folders_selected:r}=h.countFilesAndFolders(L.selectFilesForSelection(s,{selection:e}));b.logResultAction(i,L.resultsList(s),o,void 0,t,{num_files_selected:String(a),num_folders_selected:String(r)})}}i({type:P.ActionTypes.SET_SELECTION,payload:{selection:e,actionSource:t,skipLogging:s}}),Ce(i,a,e)};t.clearSelection=({actionSource:e,skipLogging:s}={})=>(0,t.setSelection)({actionSource:e,skipLogging:s,selection:(0,y.createSelection)()});t.setPreviewFile=({previewFileId:e,previewFileExt:s})=>(i,a)=>{void 0===e?i((0,t.startDwellTime)()):(s&&b.logResultPreviewStarted(s),i((0,t.stopAndLogDwellTime)("open-preview"))),i({type:P.ActionTypes.SET_PREVIEW_FILE_ID,payload:{previewFileId:e,previewFileExt:s}}),L.isFullPage(a())&&N.searchNavigationManager.set(L.searchUrl(a()),!0)};t.setPreviewCommentsThreadId=({previewCommentsThreadId:e})=>({type:P.ActionTypes.SET_PREVIEW_COMMENTS_THREAD_ID,payload:{previewCommentsThreadId:e}});t.setTypeaheadSessionId=({typeaheadSessionId:e})=>({type:P.ActionTypes.SET_TYPEAHEAD_SESSION_ID,payload:{typeaheadSessionId:e}});t.setSearchSessionId=({searchSessionId:e})=>({type:P.ActionTypes.SET_SEARCH_SESSION_ID,payload:{searchSessionId:e}});t.setSearchSessionQueryId=({searchSessionQueryId:e})=>({type:P.ActionTypes.SET_SEARCH_SESSION_QUERY_ID,payload:{searchSessionQueryId:e}});t.setPreviousSearchSessionQueryId=({previousSearchSessionQueryId:e})=>({type:P.ActionTypes.SET_PREVIOUS_SEARCH_SESSION_QUERY_ID,payload:{previousSearchSessionQueryId:e}});function de(e,t={}){const s=(0,K.isMediaFiltersEnabled)((0,A.mediaFiltersVariant)(e())),i=L.searchArgs(e());return(0,w.isSearchArgsInvalid)(s,Object.assign(Object.assign({},i),t))}t.performSearch=()=>(e,s)=>{if(de(s))e(ge()),e(_e({loadingState:C.SearchLoadingState.ZERO_QUERY})),L.isFullPage(s())&&N.searchNavigationManager.set(L.searchUrl(s()));else if(L.isFullPage(s())){N.searchNavigationManager.set(L.searchUrl(s())),b.logQueryPressedEnter();const i=L.searchSessionQueryId(s());L.previousSearchSessionQueryId(s())!==i?(e((0,t.setPreviousSearchSessionQueryId)({previousSearchSessionQueryId:i})),(0,t._performSearch)(e,s,C.SearchOriginPathway.WEB,!1)):(0,t._performSearch)(e,s,C.SearchOriginPathway.WEB,!0)}else u.redirect(L.searchUrl(s()))};t._performSearch=(e,s,i=C.SearchOriginPathway.WEB,a=!0)=>{if(de(s))return;L.isFullPage(s())&&N.searchNavigationManager.set(L.searchUrl(s())),e(_e({loadingState:C.SearchLoadingState.LOADING_FIRST_PAGE})),null!==oe&&clearTimeout(oe),(0,t.fetchFirstPage)(e,s,i);let r=L.searchSessionQueryId(s());a&&((0,t.setAndLogStartSearchSession)(e,s),r=L.searchSessionQueryId(s()),e((0,t.setPreviousSearchSessionQueryId)({previousSearchSessionQueryId:r})))};t.fetchFirstPage=(e,s,i=C.SearchOriginPathway.WEB)=>{const a=L.user(s()),r=L.searchArgs(s()),{query:o}=r,n=L.variant(s()),l=(0,K.isMediaFiltersEnabled)((0,A.mediaFiltersVariant)(s())),c="V1"===O.searchResultsExperiments(s()).expSearchSerpAutoGridView;a&&!de(s)&&(e((0,t.stopAndLogDwellTime)("new-query")),e((0,t.clearSelection)({actionSource:W.ActionSourceValue.SEARCH_RESULTS_PAGE})),e((0,t.setQueryStartTime)({queryStartTime:(new Date).getTime()})),b.logQueryStarted(i),ve(),T.searchApiClient.loadPartialResults(Object.assign(Object.assign({},(0,M.apiCommonFields)(s())),{start:0,includeBrowseContext:"full-page"===n,onSuccess:({searchResults:i,requestId:d,context:u})=>{if((0,t.updateFiltersAndSearchQueryFromResponse)(e),L.isSearchAsYouTypeEnabled(s())&&(0,M.hasSearchChanged)(s(),r))return;e((0,t.setResults)({searchResults:i,context:u,requestId:d}));const p=i.results.slice(0,10);let g=0;for(const e of p){((0,E.isFile)(e)||(0,E.isFswm)(e))&&(e.thumbnail_url_tmpl&&g++)}const h=g/p.length>.5?se.ViewType.Grid:se.ViewType.List;e(f.setViewType({user:a,viewType:h,viewTypeScope:ie.VIEW_TYPE_SCOPE_TEXT_SEARCH,isPlaceholder:!0,isPlaceholderEnabled:c},e=>{var t,i;const a=O.searchResultsExperiments(s()),r=null!==(t=a.expSearchSerpDesign)&&void 0!==t?t:"unknown",o=null!==(i=a.expSearchSerpAutoGridView)&&void 0!==i?i:"unknown";(0,ae.logSearchExperimentExposure)("search_experiment_serp_auto_grid_view",r),b.logSerpSetViewType(Object.assign(Object.assign({},e),{serpDesignVariant:r,autoGridViewVariant:o}))})),(0,Q.isTaggingEnabled)(O.manualTaggingVariant(s()))&&e(q.fetchTagsForFiles({user:a,files:i.results.filter(E.isFile)})),l&&e((0,t.setMediaData)(a,i.results.filter(Fe),o)),i.hasMore||e((0,t.logQueryCompleted)(!0)),"full-page"===n&&(e((0,t.startDwellTime)()),e(f.resetScroll())),"full-page"===n&&i.hasMore?e(_e({loadingState:C.SearchLoadingState.LOADING_ADDITIONAL_PAGE})):e(_e({loadingState:C.SearchLoadingState.LOADED})),"full-page"===n&&(ve(),ne=setTimeout(()=>{(0,M.hasSearchChanged)(s(),r)||e((0,t.fetchNextPage)())},D.SEARCH_SECOND_PAGE_DEBOUNCE),i.results.length&&(0,m.initializeStore)(a,i.results.filter(Fe)),re(i.results,e)),(0,H.get_timer)(D.SEARCH_WEB_TIMER).end()},onError:a=>{const r=(new Date).getTime()-L.queryStartTime(s());b.logQueryFailed(r,a,i),(0,B.reportException)({err:new Error(a),severity:"non-critical",tags:["js:search"]}),e(_e({loadingState:C.SearchLoadingState.LOAD_ERROR})),(0,t.updateFiltersAndSearchQueryFromResponse)(e)}})))};t.updateFiltersAndSearchQueryFromResponse=e=>{e((0,t.setIsSearchQueryUpToDateWithFilters)({isSearchQueryUpToDateWithFilters:!0})),e((0,t.setIsFiltersUpToDateWithSearchQuery)({isFiltersUpToDateWithSearchQuery:!0}))};t.resetTTI=()=>(e,t)=>{(0,H.get_timer)(D.SEARCH_WEB_TIMER).restart(),(0,H.get_timer)(D.SEARCH_WEB_TIMER).initialize({requireTTI:!0,url:D.SEARCH_WEB_TIMER})};t.startDwellTime=({startTime:e}={startTime:Date.now()})=>({type:P.ActionTypes.SET_DWELL_TIME,payload:{dwellStartTime:e}});t.stopAndLogDwellTime=e=>(s,i)=>{const a=i(),r=L.dwellStartTime(a);if(void 0===r)return;const o=Date.now()-r;b.logDwellTime(o,S.selectViewType(a,{instanceId:C.SEARCH_FILES_VIEW_ID}),e),s((0,t.startDwellTime)({startTime:void 0}))};t.loadHistory=()=>(e,t)=>{const s=L.user(t());if(!s)return;const i=U.UserLocalStorage.get(s.id,C.SEARCH_RECENT_HISTORY_STORAGE_KEY)||[];e({type:P.ActionTypes.SET_QUERY_HISTORY,payload:{queryHistory:i}})};t.addQueryToHistory=e=>(t,s)=>{const i=L.user(s());if(!i)return;const a=e?L.normalizedQuery(s()):L.resultQuery(s());if(!a)return;const r=L.queryHistory(s()),o=r.indexOf(r.find(e=>e.rawQuery===a)),n=[{rawQuery:a,normalizedQuery:a},...r.filter(e=>e.rawQuery!==a)].slice(0,C.SEARCH_RECENT_HISTORY_CAPACITY);t({type:P.ActionTypes.SET_QUERY_HISTORY,payload:{queryHistory:n}}),U.UserLocalStorage.set(i.id,C.SEARCH_RECENT_HISTORY_STORAGE_KEY,n),b.logHistoryAdded(o)};t.clearAllHistory=()=>(e,t)=>{const s=L.user(t());s&&(e({type:P.ActionTypes.SET_QUERY_HISTORY,payload:{queryHistory:[]}}),U.UserLocalStorage.delete(s.id,C.SEARCH_RECENT_HISTORY_STORAGE_KEY),b.logHistoryCleared())};t.fetchQuerySuggestions=function({query:e,maxResults:i}){return(a,r)=>s.__awaiter(this,void 0,void 0,(function*(){var s,o,n;const l=L.user(r());if(!l)return;le=null;const c=x.normalize(e),d=L.querySuggestionsCache(r())[c];if(d){const{loadingState:e,suggestions:s}=d;switch(e){case k.QuerySuggestionsLoadingState.LOADING:if(void 0!==s)return a(ue({normalizedQuery:c,querySuggestionsData:{loadingState:k.QuerySuggestionsLoadingState.LOADED}})),void a((0,t.setLastQueryWithQuerySuggestionsLoaded)({lastQueryWithQuerySuggestionsLoaded:c}));break;case k.QuerySuggestionsLoadingState.FAILED:break;case k.QuerySuggestionsLoadingState.DISMISSED:case k.QuerySuggestionsLoadingState.LOADED:return void a((0,t.setLastQueryWithQuerySuggestionsLoaded)({lastQueryWithQuerySuggestionsLoaded:c}));default:(0,$.enforceExhaustive)(e)}}const u=L.typeaheadSessionId(r()),p=performance.now();try{const{result:e,headers:d}=yield(0,R.getQuerySuggestions)(l.id,c,i,u),g=performance.now()-p,h=parseInt(d["x-server-response-time"],10),_=isNaN(h)?void 0:h,m=null!==(s=e.query_suggestions)&&void 0!==s?s:[],f={suggestions:m.filter(e=>e.text!==c)};if((null!==(n=null===(o=L.querySuggestionsCache(r())[c])||void 0===o?void 0:o.loadingState)&&void 0!==n?n:void 0)!==k.QuerySuggestionsLoadingState.DISMISSED&&(f.loadingState=k.QuerySuggestionsLoadingState.LOADED),a(ue({normalizedQuery:c,querySuggestionsData:f})),a((0,t.setLastQueryWithQuerySuggestionsLoaded)({lastQueryWithQuerySuggestionsLoaded:c})),b.logQuerySuggestionsFetched(c,m.length,g),(0,ee.getMetricsReporter)().createStats({ns:D.AMP_NAMESPACE_SEARCH_WEB,name:D.AMP_METRIC_QUERY_SUGGESTION_REQUEST_MS}).record(g),void 0!==_){(0,ee.getMetricsReporter)().createStats({ns:D.AMP_NAMESPACE_SEARCH_WEB,name:D.AMP_METRIC_QUERY_SUGGESTION_SERVER_MS}).record(_);const e=g-_;(0,ee.getMetricsReporter)().createStats({ns:D.AMP_NAMESPACE_SEARCH_WEB,name:D.AMP_METRIC_QUERY_SUGGESTION_NETWORK_MS}).record(e)}}catch(e){const t=e.raw?new Error(e.raw.responseBody):e;(0,B.reportException)({err:t,tags:["search_bar","search_bar_query_suggestions"],severity:"non-critical"}),a(ue({normalizedQuery:c,querySuggestionsData:{loadingState:k.QuerySuggestionsLoadingState.FAILED}})),b.logQuerySuggestionsFailed(c)}}))};t.dismissAllSuggestions=function({query:e}){return(s,i)=>{s((0,t.dismissQuerySuggestions)({query:e})),s((0,t.dismissPeopleSuggestions)({query:e})),(0,Q.isTaggingEnabled)(O.manualTaggingVariant(i()))&&s((0,t.dismissTagsSuggestions)({query:(0,I.normalizeForTagsSuggestions)(e)})),s((0,t.dismissResultSuggestions)({query:e}))}};t.dismissQuerySuggestions=function({query:e}){return(t,s)=>{var i,a;const r=x.normalize(e);(null!==(a=null===(i=L.querySuggestionsCache(s())[r])||void 0===i?void 0:i.loadingState)&&void 0!==a?a:void 0)!==k.QuerySuggestionsLoadingState.DISMISSED&&(t(ue({normalizedQuery:r,querySuggestionsData:{loadingState:k.QuerySuggestionsLoadingState.DISMISSED}})),b.logQuerySuggestionsDismissed(e))}};const ue=({normalizedQuery:e,querySuggestionsData:t})=>({type:P.ActionTypes.UPDATE_QUERY_SUGGESTIONS_CACHE,payload:{normalizedQuery:e,querySuggestionsData:t}});t.setLastQueryWithQuerySuggestionsLoaded=function({lastQueryWithQuerySuggestionsLoaded:e}){return(t,s)=>{t({type:P.ActionTypes.SET_LAST_QUERY_WITH_QUERY_SUGGESTIONS_LOADED,payload:{lastQueryWithQuerySuggestionsLoaded:e}})}};t.fetchTagsSuggestions=function({query:e}){return(i,a)=>s.__awaiter(this,void 0,void 0,(function*(){var s,r;if(!(0,Q.isTaggingEnabled)(O.manualTaggingVariant(a())))return;const o=L.user(a());if(!o)return;const n=G.selectUserGeneratedTagsSuggestions(a());if(void 0===n)return void i(q.fetchAllTagsSuggestions({user:o,onSuccess:()=>{i((0,t.fetchTagsSuggestions)({query:e}))}}));const l=x.normalize(e),c=L.tagsSuggestionsCache(a())[l];if(c){const{loadingState:e,suggestions:s}=c;switch(e){case k.TagsSuggestionsLoadingState.LOADING:if(void 0!==s)return i(pe({normalizedQuery:l,tagsSuggestionsData:{loadingState:k.TagsSuggestionsLoadingState.LOADED}})),void i((0,t.setLastQueryWithTagsSuggestionsLoaded)({lastQueryWithTagsSuggestionsLoaded:l}));break;case k.TagsSuggestionsLoadingState.DISMISSED:case k.TagsSuggestionsLoadingState.LOADED:return void i((0,t.setLastQueryWithTagsSuggestionsLoaded)({lastQueryWithTagsSuggestionsLoaded:l}));case k.TagsSuggestionsLoadingState.FAILED:break;default:(0,$.enforceExhaustive)(e)}}try{const e=7,o=(0,z.getTagsSuggestions)(l,n).slice(0,e),c={suggestions:o};(null!==(r=null===(s=L.tagsSuggestionsCache(a())[l])||void 0===s?void 0:s.loadingState)&&void 0!==r?r:void 0)!==k.TagsSuggestionsLoadingState.DISMISSED&&(c.loadingState=k.TagsSuggestionsLoadingState.LOADED),i(pe({normalizedQuery:l,tagsSuggestionsData:c})),i((0,t.setLastQueryWithTagsSuggestionsLoaded)({lastQueryWithTagsSuggestionsLoaded:l})),b.logTagSuggestionsFetched(l,o.length)}catch(e){const t=e.raw?new Error(e.raw.responseBody):e;(0,B.reportException)({err:t,tags:["search_bar","search_bar_tags_suggestions"],severity:"non-critical"}),i(pe({normalizedQuery:l,tagsSuggestionsData:{loadingState:k.TagsSuggestionsLoadingState.FAILED}})),b.logTagSuggestionsFailed(l)}}))};t.dismissTagsSuggestions=function({query:e}){return(t,s)=>{var i,a;if(!(0,Q.isTaggingEnabled)(O.manualTaggingVariant(s())))return;const r=x.normalize(e);(null!==(a=null===(i=L.tagsSuggestionsCache(s())[r])||void 0===i?void 0:i.loadingState)&&void 0!==a?a:void 0)!==k.TagsSuggestionsLoadingState.DISMISSED&&(t(pe({normalizedQuery:r,tagsSuggestionsData:{loadingState:k.TagsSuggestionsLoadingState.DISMISSED}})),b.logTagSuggestionsDismissed(e))}};const pe=({normalizedQuery:e,tagsSuggestionsData:t})=>({type:P.ActionTypes.UPDATE_TAGS_SUGGESTIONS_CACHE,payload:{normalizedQuery:e,tagsSuggestionsData:t}});t.setLastQueryWithTagsSuggestionsLoaded=function({lastQueryWithTagsSuggestionsLoaded:e}){return(t,s)=>{(0,Q.isTaggingEnabled)(O.manualTaggingVariant(s()))&&t({type:P.ActionTypes.SET_LAST_QUERY_WITH_TAGS_SUGGESTIONS_LOADED,payload:{lastQueryWithTagsSuggestionsLoaded:e}})}};t.setResults=({searchResults:e,requestId:t,context:s})=>({type:P.ActionTypes.SET_RESULTS,payload:{searchResults:e,requestId:t,context:s}});t.updateResults=({results:e})=>({type:P.ActionTypes.UPDATE_RESULTS,payload:{results:e}});t.removeResults=({results:e})=>({type:P.ActionTypes.REMOVE_RESULTS,payload:{results:e}});t.setIsSearchQueryUpToDateWithFilters=({isSearchQueryUpToDateWithFilters:e})=>({type:P.ActionTypes.SET_IS_SEARCH_QUERY_UP_TO_DATE_WITH_FILTERS,payload:{isSearchQueryUpToDateWithFilters:e}});t.setIsFiltersUpToDateWithSearchQuery=({isFiltersUpToDateWithSearchQuery:e})=>({type:P.ActionTypes.SET_IS_FILTERS_UP_TO_DATE_WITH_SEARCH_QUERY,payload:{isFiltersUpToDateWithSearchQuery:e}});t.purgeFiles=({files:i,user:a,context:r})=>function(o,n){return s.__awaiter(this,void 0,void 0,(function*(){const{purgeByPathBatch:n}=yield new Promise((t,s)=>{e(["metaserver/static/js/trash/actions"],t,s)}).then(s.__importStar);c.showPurgeModal({userId:a.id,context:r,files:i,onPurge:()=>n(a.id,i,e=>{o((0,t.removeResults)({results:i}))})})}))};t.restoreFiles=({files:e,user:i,context:a})=>function(r,o){return s.__awaiter(this,void 0,void 0,(function*(){c.showUnifiedTrashModal({userId:i.id,context:a,files:e,onRestore:(e,s)=>{d.restoreFiles({files:s,userId:i.id,onSuccess:()=>{n.notifyRestoreSuccess(s),(e=>{const s=e.map(e=>e.fq_path),i=L.results(o()).reduce((e,t)=>(0,E.isFile)(t)&&s.includes(t.fq_path)?[...e,new _.File(Object.assign(Object.assign({},t),{isDeleted:!1}))]:e,[]);r((0,t.updateResults)({results:i}))})(s)},isSearchMode:!1})}})}))};const ge=()=>({type:P.ActionTypes.CLEAR_RESULTS}),he=({searchResults:e,loadingState:t})=>({type:P.ActionTypes.APPEND_RESULTS,payload:{searchResults:e,loadingState:t}}),_e=({loadingState:e})=>({type:P.ActionTypes.SET_LOADING_STATE,payload:{loadingState:e}}),me=({suggestedPeople:e})=>({type:P.ActionTypes.SET_SUGGESTED_PEOPLE_FOR_FILTERS,payload:{suggestedPeople:e}}),fe=({normalizedQuery:e,peopleSuggestionsData:t})=>({type:P.ActionTypes.UPDATE_PEOPLE_SUGGESTIONS_CACHE,payload:{normalizedQuery:e,peopleSuggestionsData:t}}),Se=({lastQueryWithPeopleSuggestionsLoaded:e})=>({type:P.ActionTypes.SET_LAST_QUERY_WITH_PEOPLE_SUGGESTIONS_LOADED,payload:{lastQueryWithPeopleSuggestionsLoaded:e}});t.setHighlightedRow=({index:e})=>({type:P.ActionTypes.SET_HIGHLIGHTED_ROW,payload:{index:e}});t.setQueryStartTime=({queryStartTime:e})=>({type:P.ActionTypes.SET_QUERY_START_TIME,payload:{queryStartTime:e}});t.logQueryCompleted=e=>function(i,a){return s.__awaiter(this,void 0,void 0,(function*(){const s=L.queryStartTime(a());if(s){const r=(0,K.isMediaMetadataSearchEnabled)(O.mediaFiltersVariant(a()));if((0,Q.isTaggingEnabled)(O.manualTaggingVariant(a()))){const t=L.query(a()),i=G.selectAllTagsSuggestions(a()),{numOfTags:o,typeOfTagToCount:n}=(0,z.getTagsInQuery)(t,i);e&&o>0&&X.UserSurvey.trackEvent("search_tag","search"),b.logQueryCompleted((new Date).getTime()-s,r,o,n,"search bar")}else b.logQueryCompleted((new Date).getTime()-s,r);i((0,t.setQueryStartTime)({queryStartTime:void 0}))}}))};const ve=()=>{oe=Ee(oe),ne=Ee(ne)},Ee=e=>(null!==e&&clearTimeout(e),null),ye=e=>{switch(e){case p.SEARCH_ORDER_BY_TYPE.LAST_MODIFIED_TIME:return v.SortField.MODIFIED;case p.SEARCH_ORDER_BY_TYPE.RELEVANCE:default:return v.SortField.RELEVANCE}},Te=e=>{switch(e){case C.SearchOriginPathway.ASSISTANT:return C.SearchOriginPathway.ASSISTANT;case C.SearchOriginPathway.COLLAB_BROWSE:return C.SearchOriginPathway.COLLAB_BROWSE;default:return C.SearchOriginPathway.WEB}},we=e=>{switch(e){case p.SEARCH_REVERSE_ORDER_TYPE.TRUE:return v.SortDirection.ASCENDING;case p.SEARCH_REVERSE_ORDER_TYPE.FALSE:default:return v.SortDirection.DESCENDING}},be=(e,t)=>!e&&!t||!(!e||!t)&&(e.sortField===t.sortField&&e.sortDirection===t.sortDirection);t.setFilters=({path:e,fileCategories:s,filteredAccountId:i,lastModifiedDate:a,customLastModifiedDateRange:r,dateTaken:o,customDateTakenRange:n,selectedDimensions:c})=>(d,u)=>{e&&!l.paths_are_equal(e,L.path(u()))&&d((0,t.setPath)({path:e,viewport:"view"})),s&&d((0,t.setFileCategories)({fileCategories:s})),null===i&&d((0,t.setFilteredAccountId)({filteredAccountId:void 0})),void 0!==a&&d((0,t.setLastModifiedDate)({lastModifiedDate:a,customLastModifiedDateRange:r})),void 0!==o&&d((0,t.setDateTaken)({dateTaken:o,customDateTakenRange:n})),void 0!==c&&d((0,t.setSelectedDimensions)({selectedDimensions:c}))};t.resetFilters=()=>e=>{e((0,t.setFilters)({path:"/",fileCategories:C.FILE_CATEGORIES_UNCHECKED,filteredAccountId:null,lastModifiedDate:k.DateRange.Any,dateTaken:k.DateRange.Any,selectedDimensions:[]})),b.logFiltersReset(k.LoggingEntryPoint.SEARCH_RESULTS_PAGE)};const Fe=e=>e instanceof _.File;t.shouldStartNewSearchSession=(e,{query:t})=>!L.typeaheadSessionId(e)||(!(!L.normalizedQuery(e)||t)||L.normalizedQuery(e).length>=3&&1===t.length);const Ce=(e,t,i)=>s.__awaiter(void 0,void 0,void 0,(function*(){if(!i||0===i.selected.count())return;const s=L.results(t()),a=null==s?void 0:s.filter(e=>(0,E.isFile)(e)&&i.selected.has(e.fq_path)&&!e.thumbnail_url_tmpl),r=[];if(null==a||a.forEach(e=>{(0,E.isFile)(e)&&r.push({file_id:e.file_id,sj_id:e.sjid,ns_id:e.ns_id})}),r.length>0){const s=L.user(t());s&&e(f.loadPreviewThumbnails(r,s.id,C.SEARCH_FILES_VIEW_ID))}}));t.handleNavigateToFileOrFolder=(e,s={})=>(n,l)=>{const{actionSource:c}=s,d=L.user(l()),p=L.context(l()),g=c===W.ActionSourceValue.SEARCH_SUGGESTIONS_DROPDOWN,h=g?L.cachedResultSuggestionsForSearchArgs(l()):L.resultsList(l());if(n((0,t.addQueryToHistory)(g)),n((0,t.stopAndLogDwellTime)("navigate-to-file-or-folder")),e instanceof _.FileSharedWithMe)return b.logResultAction(W.WebUserActionLogEvent.FILE_VIEW,h,e,void 0,c),void u.redirect(e.href);if(e.isDeleted)n((0,t.restoreFiles)({files:[e],user:d,context:p}));else{if(e.is_dir)return b.logResultAction(W.WebUserActionLogEvent.FOLDER_OPEN,h,e,void 0,c),void N.searchNavigationManager.set((0,i.href_for_file)(d,e));if(b.logResultAction(W.WebUserActionLogEvent.FILE_VIEW,h,e,void 0,c),e.is_cloud_doc)(0,a.openCloudDoc)(e,d,o.WebSearchSource);else if((0,r.hasPreferredEditorSupport)(e)){const s=L.preferredEditors(l());(0,r.openInPreferredEditor)(d,e,s,()=>{n((0,t.setPreviewFile)({previewFileId:e.file_id,previewFileExt:e.ext}))},{fileViewOrigin:V.FileViewOriginType.SEARCH})}else n((0,t.setPreviewFile)({previewFileId:e.file_id,previewFileExt:e.ext}))}};t.redirectToResult=({result:e,shouldOpenTabOnNavigate:s,actionSurface:a,actionSource:r})=>(o,n)=>{const l=L.user(n()),c=r===W.ActionSourceValue.SEARCH_SUGGESTIONS_DROPDOWN,d=c?L.cachedResultSuggestionsForSearchArgs(n()):L.resultsList(n()),p=e instanceof _.Paper||(e instanceof _.File||e instanceof _.FileSharedWithMe)&&!!e.is_cloud_doc,g=s||p?u.open_tab:u.redirect;o((0,t.addQueryToHistory)(c)),b.logRedirectToResult(d,e,a,r),e instanceof _.File?g((0,i.href_for_file)(l,e)):e instanceof _.Paper||e instanceof _.PaperFolder?g(e.url):e instanceof _.FileSharedWithMe&&g(e.href)};const Ie=(e,t)=>{const s=Object.assign(Object.assign({},t),{query:e});return Object.values(s).toString()},Re=({searchArgsString:e,resultSuggestionsData:t})=>({type:P.ActionTypes.UPDATE_RESULT_SUGGESTIONS_CACHE,payload:{searchArgsString:e,resultSuggestionsData:t}});t.fetchResultSuggestions=({normalizedQuery:e})=>function(t,i){return s.__awaiter(this,void 0,void 0,(function*(){if(de(i,{query:e}))return;const s=performance.now(),a=O.dropdownSuggestionLatencyVariant(i()),r=O.isHttp3ShadowSearchRequestEnabled(i()),o=L.searchArgs(i()),n=Ie(e,o),l=L.resultSuggestionsCache(i())[n];if(l){const{loadingState:e,suggestions:i}=l;switch(e){case k.ResultSuggestionsLoadingState.LOADING:if(void 0!==i)return t(Re({searchArgsString:n,resultSuggestionsData:{loadingState:k.ResultSuggestionsLoadingState.LOADED}})),void b.recordResultSuggestionLoadTime(s,"cache",a);break;case k.ResultSuggestionsLoadingState.DISMISSED:case k.ResultSuggestionsLoadingState.LOADED:return;default:(0,$.enforceExhaustive)(e)}}const c=Object.assign(Object.assign({},(0,M.apiCommonFields)(i())),{maxResults:5,start:0,isDropdown:!0,isForResultSuggestions:!0,excludeSharedDocs:"V3"===a,filenameOnly:"V2"===a||"V7"===a,includeHighlights:!1,includeSnippets:!1}),d=performance.now();T.searchApiClient.loadPartialResults(Object.assign(Object.assign({},c),{useHttp3:!1,onSuccess:({searchResults:l,requestId:u,serverTimeMs:p})=>{var g,h;const _=performance.now()-d,m=p,f=m?_-m:void 0;if(b.logResultSuggestionsFetched(_,m,f),b.logResultSuggestionsLatencyToAmp(_,m,f,a,void 0),(0,M.hasSearchChanged)(i(),Object.assign(Object.assign({},o),{query:e})))return;const S={suggestions:l.results,requestId:u};if((null!==(h=null===(g=L.resultSuggestionsCache(i())[n])||void 0===g?void 0:g.loadingState)&&void 0!==h?h:void 0)!==k.ResultSuggestionsLoadingState.DISMISSED&&(S.loadingState=k.ResultSuggestionsLoadingState.LOADED),t(Re({searchArgsString:n,resultSuggestionsData:S})),b.recordResultSuggestionLoadTime(s,"search_v2",a),r){if((0,M.hasSearchChanged)(i(),Object.assign(Object.assign({},o),{query:e})))return;const t=performance.now();T.searchApiClient.loadPartialResults(Object.assign(Object.assign({},c),{useHttp3:!0,onSuccess:({serverTimeMs:e})=>{const s=performance.now()-t,i=e,r=i?s-i:void 0;b.logResultSuggestionsLatencyToAmp(_,m,f,a,"http2"),b.logResultSuggestionsLatencyToAmp(s,i,r,a,"http3");const o=i&&m?i-m:void 0,n=r&&f?r-f:void 0;b.logResultSuggestionsLatencyToAmp(s-_,o,n,a,"http3-http2_delta")},onError:e=>{(0,B.reportException)({err:new Error(e),severity:"non-critical",tags:["js:search_http3"]})}}))}},onError:e=>{(0,B.reportException)({err:new Error(e),severity:"non-critical",tags:["js:search"]})}}))}))};t.dismissResultSuggestions=({query:e})=>(t,s)=>{var i,a;const r=x.normalize(e),o=L.searchArgs(s()),n=Ie(r,o);(null!==(a=null===(i=L.resultSuggestionsCache(s())[n])||void 0===i?void 0:i.loadingState)&&void 0!==a?a:void 0)!==k.ResultSuggestionsLoadingState.DISMISSED&&t(Re({searchArgsString:n,resultSuggestionsData:{loadingState:k.ResultSuggestionsLoadingState.DISMISSED}}))};t.onResultSuggestionClick=({result:e})=>(s,i)=>{e instanceof _.File||e instanceof _.FileSharedWithMe?s((0,t.handleNavigateToFileOrFolder)(e,{actionSource:W.ActionSourceValue.SEARCH_SUGGESTIONS_DROPDOWN})):s((0,t.redirectToResult)({result:e,actionSource:W.ActionSourceValue.SEARCH_SUGGESTIONS_DROPDOWN}))};t.setExpandedBlade=e=>({type:P.ActionTypes.SET_EXPANDED_BLADE,payload:{expandedBlade:e}})})),define("metaserver/static/js/search/single_page/data/reducer",["require","exports","tslib","immutable","metaserver/static/js/browse/models","metaserver/static/js/files_view/sort_types","metaserver/static/js/clean/ui/selection","metaserver/static/js/search/constants","metaserver/static/js/search/single_page/data/types","metaserver/static/js/search/single_page/utils","metaserver/static/js/search/store_helpers","metaserver/static/js/search/types"],(function(e,t,s,i,a,r,o,n,l,c,d,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.searchReducer=t.defaultSearchState=void 0,i=s.__importStar(i),t.defaultSearchState={variant:"full-page",loadingState:n.SearchLoadingState.ZERO_QUERY,results:i.OrderedMap(),query:"",resultQuery:"",path:"/",typeaheadSessionId:"",selection:(0,o.createSelection)(),queryHistory:[],previewFileId:void 0,sortOrder:{sortField:r.SortField.RELEVANCE,sortDirection:r.SortDirection.DESCENDING},fileCategories:n.FILE_CATEGORIES_UNCHECKED,context:new a.BrowseContext,imageSuggestionCount:0,imageSuggestionQuery:"",imageSuggestionRequestId:void 0,imageSuggestionResults:i.OrderedMap(),filteredAccountId:void 0,peopleSuggestionsForFilters:void 0,peopleSuggestionsCache:{},lastQueryWithPeopleSuggestionsLoaded:void 0,querySuggestionsCache:{},spellCorrection:void 0,isCreatingSharedLinkMap:i.Map(),tagsSuggestionsCache:{},lastModifiedDate:u.DateRange.Any,selectedDimensions:[],dateTaken:u.DateRange.Any,mediaData:{},suggestionSectionOrder:n.defaultSuggestionSectionOrder,resultSuggestionsCache:{},expandedBlade:n.DEFAULT_BLADE,isSearchQueryUpToDateWithFilters:!0,isFiltersUpToDateWithSearchQuery:!0};const p=e=>Object.assign(Object.assign({},e),{results:e.results.clear(),resultQuery:"",hasMoreResults:!0,selection:(0,o.createSelection)(),imageSuggestionCount:0,imageSuggestionQuery:"",imageSuggestionRequestId:void 0,spellCorrection:void 0}),g=(e,t)=>Object.assign(Object.assign({},e),{results:e.results.concat(t.searchResults.results.map(e=>[(0,c.getIdForSearchResult)(e),e])),cursor:t.searchResults.cursor,resultQuery:(0,d.normalize)(e.query),hasMoreResults:t.searchResults.hasMore,loadingState:t.loadingState||e.loadingState}),h=(e,t)=>Object.assign(Object.assign({},e),{spellCorrection:t.searchResults.spellCorrection}),_=(e,t)=>Object.assign(Object.assign({},e),{requestId:t.requestId});t.searchReducer=function(e=t.defaultSearchState,s){switch(s.type){case l.ActionTypes.SET_VARIANT:return((e,t)=>Object.assign(Object.assign({},e),{variant:t.variant}))(e,s.payload);case l.ActionTypes.SET_USER:return((e,t)=>Object.assign(Object.assign({},e),{user:t.user,userOptions:t.options}))(e,s.payload);case l.ActionTypes.SET_EXPERIMENTS:return((e,t)=>Object.assign(Object.assign({},e),{experiments:t.experiments}))(e,s.payload);case l.ActionTypes.SET_PATH:return((e,t)=>Object.assign(Object.assign({},e),{path:t.path}))(e,s.payload);case l.ActionTypes.SET_FILE_CATEGORIES:return((e,t)=>Object.assign(Object.assign({},e),{fileCategories:t.fileCategories}))(e,s.payload);case l.ActionTypes.SET_LOADING_STATE:return((e,t)=>Object.assign(Object.assign({},e),{loadingState:t.loadingState}))(e,s.payload);case l.ActionTypes.SET_QUERY:return((e,t)=>Object.assign(Object.assign({},e),{query:t.query,highlightedRow:void 0}))(e,s.payload);case l.ActionTypes.SET_RESULTS:return((e,{searchResults:t,requestId:s,context:i})=>{let a=Object.assign(Object.assign({},e),{context:i||e.context});return a=p(a),a=g(a,{searchResults:t}),a=_(a,{requestId:s}),a=h(a,{searchResults:t}),a})(e,s.payload);case l.ActionTypes.CLEAR_RESULTS:return p(e);case l.ActionTypes.APPEND_RESULTS:return g(e,s.payload);case l.ActionTypes.SET_TYPEAHEAD_SESSION_ID:return((e,t)=>Object.assign(Object.assign({},e),{typeaheadSessionId:t.typeaheadSessionId}))(e,s.payload);case l.ActionTypes.SET_SEARCH_SESSION_ID:return((e,t)=>Object.assign(Object.assign({},e),{searchSessionId:t.searchSessionId}))(e,s.payload);case l.ActionTypes.SET_SEARCH_SESSION_QUERY_ID:return((e,t)=>Object.assign(Object.assign({},e),{searchSessionQueryId:t.searchSessionQueryId}))(e,s.payload);case l.ActionTypes.SET_PREVIOUS_SEARCH_SESSION_QUERY_ID:return((e,t)=>Object.assign(Object.assign({},e),{previousSearchSessionQueryId:t.previousSearchSessionQueryId}))(e,s.payload);case l.ActionTypes.SET_REQUEST_ID:return _(e,s.payload);case l.ActionTypes.SET_SELECTION:return((e,t)=>Object.assign(Object.assign({},e),{selection:t.selection}))(e,s.payload);case l.ActionTypes.SET_PREVIEW_FILE_ID:return((e,t)=>Object.assign(Object.assign({},e),{previewFileId:t.previewFileId}))(e,s.payload);case l.ActionTypes.SET_PREVIEW_COMMENTS_THREAD_ID:return((e,t)=>Object.assign(Object.assign({},e),{previewCommentsThreadId:t.previewCommentsThreadId}))(e,s.payload);case l.ActionTypes.SET_SORT_ORDER:return((e,t)=>Object.assign(Object.assign({},e),{sortOrder:t.sortOrder}))(e,s.payload);case l.ActionTypes.SET_IMAGE_SUGGESTION:return((e,t)=>{const s=e.imageSuggestionResults.clear();return Object.assign(Object.assign({},e),{imageSuggestionResults:s.concat(t.results.map(e=>[(0,c.getIdForSearchResult)(e),e])),imageSuggestionCount:t.results.length,imageSuggestionQuery:t.query,imageSuggestionRequestId:t.requestId})})(e,s.payload);case l.ActionTypes.SET_DWELL_TIME:return((e,t)=>Object.assign(Object.assign({},e),{dwellStartTime:t.dwellStartTime}))(e,s.payload);case l.ActionTypes.UPDATE_RESULTS:return((e,t)=>{const s=e.results.map(e=>{const s=t.results.find(t=>(0,c.getIdForSearchResult)(e)===(0,c.getIdForSearchResult)(t));return void 0===s?e:s});return Object.assign(Object.assign({},e),{results:s})})(e,s.payload);case l.ActionTypes.REMOVE_RESULTS:return((e,t)=>{const s=t.results.map(e=>(0,c.getIdForSearchResult)(e)),i=e.results.filter(e=>!s.includes((0,c.getIdForSearchResult)(e)));return Object.assign(Object.assign({},e),{results:i})})(e,s.payload);case l.ActionTypes.SET_QUERY_HISTORY:return((e,t)=>{const{queryHistory:s}=t;return Object.assign(Object.assign({},e),{queryHistory:s})})(e,s.payload);case l.ActionTypes.SET_HIGHLIGHTED_ROW:return((e,t)=>Object.assign(Object.assign({},e),{highlightedRow:t.index}))(e,s.payload);case l.ActionTypes.UPDATE_QUERY_SUGGESTIONS_CACHE:return((e,t)=>{const{normalizedQuery:s,querySuggestionsData:i}=t;return Object.assign(Object.assign({},e),{querySuggestionsCache:Object.assign(Object.assign({},e.querySuggestionsCache),{[s]:Object.assign(Object.assign({},e.querySuggestionsCache[s]),i)})})})(e,s.payload);case l.ActionTypes.SET_LAST_QUERY_WITH_QUERY_SUGGESTIONS_LOADED:return((e,t)=>{const{lastQueryWithQuerySuggestionsLoaded:s}=t;return Object.assign(Object.assign({},e),{lastQueryWithQuerySuggestionsLoaded:s})})(e,s.payload);case l.ActionTypes.SET_FILTERED_ACCOUNT_ID:return((e,t)=>Object.assign(Object.assign({},e),{filteredAccountId:t.filteredAccountId}))(e,s.payload);case l.ActionTypes.UPDATE_PEOPLE_SUGGESTIONS_CACHE:return((e,t)=>{const{normalizedQuery:s,peopleSuggestionsData:i}=t;return Object.assign(Object.assign({},e),{peopleSuggestionsCache:Object.assign(Object.assign({},e.peopleSuggestionsCache),{[s]:Object.assign(Object.assign({},e.peopleSuggestionsCache[s]),i)})})})(e,s.payload);case l.ActionTypes.SET_LAST_QUERY_WITH_PEOPLE_SUGGESTIONS_LOADED:return((e,t)=>Object.assign(Object.assign({},e),{lastQueryWithPeopleSuggestionsLoaded:t.lastQueryWithPeopleSuggestionsLoaded}))(e,s.payload);case l.ActionTypes.SET_QUERY_START_TIME:return((e,t)=>Object.assign(Object.assign({},e),{queryStartTime:t.queryStartTime}))(e,s.payload);case l.ActionTypes.SET_IS_CREATING_SHARED_LINK:return(function(e,t){return Object.assign(Object.assign({},e),{isCreatingSharedLinkMap:e.isCreatingSharedLinkMap.set(t.payload.fileIdOrPath,t.payload.isCreatingSharedLink)})})(e,s);case l.ActionTypes.UPDATE_TAGS_SUGGESTIONS_CACHE:return((e,t)=>{const{normalizedQuery:s,tagsSuggestionsData:i}=t;return Object.assign(Object.assign({},e),{tagsSuggestionsCache:Object.assign(Object.assign({},e.tagsSuggestionsCache),{[s]:Object.assign(Object.assign({},e.tagsSuggestionsCache[s]),i)})})})(e,s.payload);case l.ActionTypes.SET_LAST_QUERY_WITH_TAGS_SUGGESTIONS_LOADED:return((e,t)=>{const{lastQueryWithTagsSuggestionsLoaded:s}=t;return Object.assign(Object.assign({},e),{lastQueryWithTagsSuggestionsLoaded:s})})(e,s.payload);case l.ActionTypes.SET_LAST_MODIFIED_DATE:return((e,t)=>{const{lastModifiedDate:s,customLastModifiedDateRange:i}=t;return Object.assign(Object.assign({},e),{lastModifiedDate:s,customLastModifiedDateRange:i})})(e,s.payload);case l.ActionTypes.SET_DATE_TAKEN:return((e,t)=>{const{dateTaken:s,customDateTakenRange:i}=t;return Object.assign(Object.assign({},e),{dateTaken:s,customDateTakenRange:i})})(e,s.payload);case l.ActionTypes.SET_SELECTED_DIMENSIONS:return((e,t)=>{const{selectedDimensions:s}=t;return Object.assign(Object.assign({},e),{selectedDimensions:s})})(e,s.payload);case l.ActionTypes.SET_MEDIA_DATA:return((e,{filesMediaData:t})=>{const s={};return t.forEach(e=>{void 0!==e.file_id_or_path&&(s[e.file_id_or_path]=e)}),e.mediaData&&Object.values(e.mediaData).forEach(e=>{void 0!==e.file_id_or_path&&(s[e.file_id_or_path]=e)}),Object.assign(Object.assign({},e),{mediaData:s})})(e,s.payload);case l.ActionTypes.SET_SUGGESTED_PEOPLE_FOR_FILTERS:return((e,t)=>Object.assign(Object.assign({},e),{peopleSuggestionsForFilters:t.suggestedPeople}))(e,s.payload);case l.ActionTypes.UPDATE_RESULT_SUGGESTIONS_CACHE:return((e,t)=>{const{searchArgsString:s,resultSuggestionsData:i}=t;return Object.assign(Object.assign({},e),{resultSuggestionsCache:Object.assign(Object.assign({},e.resultSuggestionsCache),{[s]:Object.assign(Object.assign({},e.resultSuggestionsCache[s]),i)})})})(e,s.payload);case l.ActionTypes.SET_EXPANDED_BLADE:return(function(e,t){return Object.assign(Object.assign({},e),{expandedBlade:t.expandedBlade})})(e,s.payload);case l.ActionTypes.SET_IS_SEARCH_QUERY_UP_TO_DATE_WITH_FILTERS:return(function(e,t){return Object.assign(Object.assign({},e),{isSearchQueryUpToDateWithFilters:t.isSearchQueryUpToDateWithFilters})})(e,s.payload);case l.ActionTypes.SET_IS_FILTERS_UP_TO_DATE_WITH_SEARCH_QUERY:return(function(e,t){return Object.assign(Object.assign({},e),{isFiltersUpToDateWithSearchQuery:t.isFiltersUpToDateWithSearchQuery})})(e,s.payload);default:return e}}})),define("metaserver/static/js/search/single_page/data/selectors/experiments",["require","exports","tslib","reselect","typescript/dropbox/proto/js_init_data/browse_web/browse_web_pb","metaserver/static/js/browse/models","metaserver/static/js/redux/namespaces","metaserver/static/js/redux/selectors","metaserver/static/js/search/constants","metaserver/static/js/search/single_page/constants","metaserver/static/js/search/single_page/data/selectors/index","metaserver/static/js/media_filters/gating","metaserver/static/js/business_space/browse/constants"],(function(e,t,s,i,a,r,o,n,l,c,d,u,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isSerpPeopleSearchBarEnabled=t.shouldShowDashCampaignOnEmptySearch=t.isAdvancedSearchOperatorsEnabled=t.isSearchTopRightSortEnabled=t.isSearchSerpFiltersResponsivenessEnabled=t.isHttp3ShadowSearchRequestEnabled=t.dropdownSuggestionLatencyVariant=t.searchCollectionsFileAction=t.searchDocClassificationVariant=t.autoTaggingAwarenessVariant=t.flowsAutoTagUiVariant=t.flowsAutomatedFolderUiVariant=t.manualTaggingVariant=t.actionBarExperimentSelector=t.maxResultsToFetch=t.shouldRenderInlineSearchFilters=t.mediaFiltersVariant=t.shouldShowFolderOverview=t.shouldShowSelectionPreviewPane=t.shouldRenderEmptyZeroQueryView=t.shouldRenderHistory=t.browseExperiments=t.searchResultsExperiments=t.experiments=void 0,a=s.__importStar(a),d=s.__importStar(d);t.experiments=e=>(e=>(0,n.getStateAtNamespace)(e,o.SEARCH_NAMESPACE_KEY))(e).experiments||{};const g=(e,t)=>!!e&&!0===e[t];t.searchResultsExperiments=(0,i.createSelector)(t.experiments,e=>({expManualTagging:e.manual_tagging,expFlowsAutomatedFolderUI:e.flows_automated_folder_ui,expFlowsAutoTagUi:e.flows_auto_tag_ui,expAutoTaggingAwarenessVariant:e.auto_tagging_awareness_variant,expSearchSerpCsat:e.search_experiment_serp_csat,expSearchSerpDesign:e.search_experiment_serp_design,expSearchEnableMSOfficeThumbnails:e.search_experiment_enable_msoffice_thumbnails,expSearchSerpListviewThumbnails:e.search_experiment_serp_listview_thumbnails,expSearchSerpListviewBigthumbs:e.search_experiment_serp_listview_bigthumb,expSearchSerpAutoGridView:e.search_experiment_serp_auto_grid_view,expCopyLinkInRightRail:e.copy_link_in_right_rail,expSearchSerpRedesign:e.search_experiment_search_serp_redesign})),t.browseExperiments=(0,i.createSelector)(t.experiments,e=>new a.BrowseExperiments({folderHistoryRollbacks:g(e,"folder_history_rollbacks")})),t.shouldRenderHistory=(0,i.createSelector)(d.loadingState,d.queryHistory,(e,t)=>e===l.SearchLoadingState.ZERO_QUERY&&0!==t.length),t.shouldRenderEmptyZeroQueryView=(0,i.createSelector)(t.shouldRenderHistory,e=>!e);const h=(e,{responsive:t})=>!(!t||!t.isResponsive||t.isMatchedLarge);t.shouldShowSelectionPreviewPane=(0,i.createSelector)(h,d.numResults,(e,t)=>!(e||!(t>0))),t.shouldShowFolderOverview=(0,i.createSelector)(h,d.selectedFiles,(e,t)=>!e&&1===t.size&&t.first().is_dir&&!r.File.isNoAccessSharedFolder(t.first())),t.mediaFiltersVariant=(0,i.createSelector)(t.experiments,e=>e.media_filters||"OFF"),t.shouldRenderInlineSearchFilters=(0,i.createSelector)(d.hasResultQuery,d.filteredAccountId,t.mediaFiltersVariant,(e,t,s)=>Boolean(e||t||(0,u.isMediaFiltersEnabled)(s))),t.maxResultsToFetch=(0,i.createSelector)(d.variant,d.nextPageOffset,d.isSearchAsYouTypeEnabled,(e,t,s)=>t?c.SEARCH_ADDITIONAL_PAGE_SIZE:"dropdown"===e?c.SEARCH_DROPDOWN_PAGE_SIZE:s?c.SEARCH_FIRST_PAGE_SIZE:c.SEARCH_ADDITIONAL_PAGE_SIZE),t.actionBarExperimentSelector=(0,i.createSelector)(t.experiments,e=>({expVaultEnableViewOnlySharing:!1,expSpacesFssDropdown:!1,expFlowsAutomatedFolderUI:!1,expFlowsManualVideoGifUi:!1,expFssEntryPointForSpaces:!1,expCollectionsInBrowse:!1,expBsxClientSpaceUploadsVariant:p.BsxClientSpaceUploadVariant.OFF,expFlowsBrowseBarSaveAsUi:"OFF",expUserLevelSharingSettings:e.user_level_sharing_settings,expCopyLinkInRightRail:e.copy_link_in_right_rail})),t.manualTaggingVariant=(0,i.createSelector)(t.experiments,e=>e.manual_tagging||"OFF"),t.flowsAutomatedFolderUiVariant=(0,i.createSelector)(t.experiments,e=>e.flows_automated_folder_ui||!1),t.flowsAutoTagUiVariant=(0,i.createSelector)(t.experiments,e=>e.flows_auto_tag_ui||!1),t.autoTaggingAwarenessVariant=(0,i.createSelector)(t.experiments,e=>e.auto_tagging_awareness_variant||"OFF"),t.searchDocClassificationVariant=(0,i.createSelector)(t.experiments,e=>e.search_doc_classification||"OFF"),t.searchCollectionsFileAction=(0,i.createSelector)(t.experiments,e=>e.collections_in_search||!1),t.dropdownSuggestionLatencyVariant=(0,i.createSelector)(t.experiments,e=>e.search_experiment_dropdown_suggestion_latency||"OFF"),t.isHttp3ShadowSearchRequestEnabled=(0,i.createSelector)(t.experiments,e=>"ON"===e.search_experiment_dropdown_suggestion_http3),t.isSearchSerpFiltersResponsivenessEnabled=(0,i.createSelector)(t.experiments,e=>"ON"===e.search_serp_filters_responsiveness),t.isSearchTopRightSortEnabled=(0,i.createSelector)(t.experiments,e=>"ON"===e.search_top_right_sort),t.isAdvancedSearchOperatorsEnabled=(0,i.createSelector)(t.experiments,e=>e.search_web_enable_advanced_search_operators||!1),t.shouldShowDashCampaignOnEmptySearch=(0,i.createSelector)(t.experiments,e=>e.core_act_dash_empty_search||!1),t.isSerpPeopleSearchBarEnabled=(0,i.createSelector)(t.experiments,e=>e.search_serp_people_search_bar||!1)})),define("metaserver/static/js/search/single_page/data/selectors/index",["require","exports","tslib","immutable","lodash","reselect","js/filepath/filepath","metaserver/static/js/browse/constants","metaserver/static/js/browse/models","metaserver/static/js/browse/uri_helper","metaserver/static/js/files_view/data/selectors/files_view_selectors","metaserver/static/js/files_view/sort_types","metaserver/static/js/redux/namespaces","metaserver/static/js/redux/selectors","metaserver/static/js/search/api_helpers","metaserver/static/js/search/constants","metaserver/static/js/search/search_helpers","metaserver/static/js/search/single_page/constants","metaserver/static/js/search/single_page/navigation","metaserver/static/js/search/single_page/utils","metaserver/static/js/search/store_helpers","metaserver/static/js/search/types","metaserver/static/js/core/i18n","metaserver/static/js/tagging/utils","metaserver/static/js/tagging/data/selectors/index","metaserver/static/js/tagging/experiments","metaserver/static/js/clean/filetypes","metaserver/static/js/icon/folder_icon","metaserver/static/js/browse/data/selectors"],(function(e,t,s,i,a,r,o,n,l,c,d,u,p,g,h,_,m,f,S,v,E,y,T,w,b,F,C,I,R){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isSearchAsYouTypeEnabled=t.isInsideBackupFolder=t.showViewModeToggle=t.selectResultById=t.highlightedSuggestion=t.suggestions=t.highlightedSuggestionData=t.allSuggestionData=t.tagsSuggestionsLoadingState=t.tagsSuggestions=t.lastQueryWithTagsSuggestionsLoaded=t.tagsSuggestionsCache=t.peopleSuggestionsLoadingState=t.peopleSuggestionsForPeopleFilter=t.peopleSuggestions=t.filteredContactName=t.filteredContact=t.querySuggestionsLoadingState=t.querySuggestions=t.lastQueryWithQuerySuggestionsLoaded=t.querySuggestionsCache=t.hasFiltersSelected=t.previewableFiles=t.previewFile=t.commonLogFieldsForResultSuggestions=t.resultSuggestionsLoadingState=t.idToResultSuggestions=t.cachedResultSuggestionsForSearchArgs=t.resultSuggestionsForSearchArgs=t.resultSuggestionsDataForSearchArgs=t.resultSuggestionsCache=t.searchUrlReset=t.searchUrl=t.searchArgs=t.commonLogFields=t.selectFilesForSelection=t.selectedFilesForSidebar=t.allFilesSelected=t.selectedFiles=t.fileCategoriesLogValue=t.fileCategoriesArray=t.fileCategoriesString=t.preferredEditors=t.isPaperEnabled=t.isNautilusEnabled=t.resultsList=t.results=t.mergeDisplayInfo=t.calculateMediaDataDisplayInfo=t.mediaDataWithHighlights=t.spellCorrection=t.numResults=t.resultsWithTags=t.resultsWithoutTags=t.isCreatingSharedLinkForFile=t.mediaData=t.selectedDimensions=t.dateTakenWithCustomRange=t.customDateTakenRange=t.dateTaken=t.lastModifiedDateWithCustomRange=t.customLastModifiedDateRange=t.lastModifiedDate=t.isFiltersUpToDateWithSearchQuery=t.isSearchQueryUpToDateWithFilters=t.expandedBlade=t.queryStartTime=t.dwellStartTime=t.lastQueryWithPeopleSuggestionsLoaded=t.peopleSuggestionsCache=t.filteredAccountId=t.peopleSuggestionsForFilters=t.selfInSerpPeopleFilterEnabled=t.suggestionSectionOrder=t.highlightedRow=t.context=t.fileCategories=t.sortOrder=t.previewActiveCommentThreadId=t.previewFileId=t.hasMoreResults=t.cursor=t.nextPageOffset=t.queryHistory=t.selection=t.requestId=t.previousSearchSessionQueryId=t.searchSessionQueryId=t.searchSessionId=t.typeaheadSessionId=t.path=t.normalizedQuery=t.hasResultQuery=t.resultQuery=t.query=t.loadingState=t.userOptions=t.user=t.isFullPage=t.variant=void 0,i=s.__importStar(i),o=s.__importStar(o),R=s.__importStar(R);const D=e=>(0,g.getStateAtNamespace)(e,p.SEARCH_NAMESPACE_KEY);t.variant=e=>D(e).variant;t.isFullPage=e=>"full-page"===D(e).variant;t.user=e=>D(e).user;t.userOptions=e=>D(e).userOptions;t.loadingState=e=>D(e).loadingState;t.query=e=>D(e).query;t.resultQuery=e=>D(e).resultQuery;t.hasResultQuery=e=>!!D(e).resultQuery;t.normalizedQuery=e=>(0,E.normalize)(D(e).query);t.path=e=>D(e).path;t.typeaheadSessionId=e=>D(e).typeaheadSessionId;t.searchSessionId=e=>D(e).searchSessionId;t.searchSessionQueryId=e=>D(e).searchSessionQueryId;t.previousSearchSessionQueryId=e=>D(e).previousSearchSessionQueryId;t.requestId=e=>D(e).requestId;t.selection=e=>D(e).selection;t.queryHistory=e=>D(e).queryHistory;t.nextPageOffset=e=>D(e).results.count();t.cursor=e=>D(e).cursor;t.hasMoreResults=e=>D(e).hasMoreResults;t.previewFileId=e=>D(e).previewFileId;t.previewActiveCommentThreadId=e=>D(e).previewCommentsThreadId;t.sortOrder=e=>D(e).sortOrder;t.fileCategories=e=>D(e).fileCategories;t.context=e=>D(e).context;t.highlightedRow=e=>D(e).highlightedRow;t.suggestionSectionOrder=e=>D(e).suggestionSectionOrder;t.selfInSerpPeopleFilterEnabled=e=>{var t;return"ON"===(null===(t=D(e).experiments)||void 0===t?void 0:t.search_experiment_self_in_serp_people_filter)};t.peopleSuggestionsForFilters=e=>D(e).peopleSuggestionsForFilters;t.filteredAccountId=e=>D(e).filteredAccountId;t.peopleSuggestionsCache=e=>D(e).peopleSuggestionsCache;t.lastQueryWithPeopleSuggestionsLoaded=e=>D(e).lastQueryWithPeopleSuggestionsLoaded;t.dwellStartTime=e=>D(e).dwellStartTime;t.queryStartTime=e=>D(e).queryStartTime;t.expandedBlade=e=>D(e).expandedBlade;t.isSearchQueryUpToDateWithFilters=e=>D(e).isSearchQueryUpToDateWithFilters;t.isFiltersUpToDateWithSearchQuery=e=>D(e).isFiltersUpToDateWithSearchQuery;t.lastModifiedDate=e=>D(e).lastModifiedDate;t.customLastModifiedDateRange=e=>D(e).customLastModifiedDateRange,t.lastModifiedDateWithCustomRange=(0,r.createSelector)(t.lastModifiedDate,t.customLastModifiedDateRange,(e,t)=>({lastModifiedDate:e,customLastModifiedDateRange:t}));t.dateTaken=e=>D(e).dateTaken;t.customDateTakenRange=e=>D(e).customDateTakenRange,t.dateTakenWithCustomRange=(0,r.createSelector)(t.dateTaken,t.customDateTakenRange,(e,t)=>({dateTaken:e,customDateTakenRange:t}));t.selectedDimensions=e=>D(e).selectedDimensions;t.mediaData=e=>D(e).mediaData;t.isCreatingSharedLinkForFile=(e,t)=>Boolean(D(e).isCreatingSharedLinkMap.get(t));const O=()=>(0,m.getSearchCsrfToken)();t.resultsWithoutTags=e=>D(e).results;t.resultsWithTags=(0,r.createSelector)(t.resultsWithoutTags,b.selectTagsByFile,e=>{var t;return(0,F.isTaggingEnabled)(null===(t=D(e).experiments)||void 0===t?void 0:t.manual_tagging)},t.normalizedQuery,(e,t,s,i)=>s?e.map(e=>{if(e instanceof l.File){const s=t[(0,w.getFileMapKey)(e)];void 0!==s&&(e=e.set("tags",s.map(e=>({value:e,highlighted:(0,w.queryContainsTag)(i,e.tag_text)}))))}return e}):e),t.numResults=(0,r.createSelector)(t.resultsWithoutTags,e=>e.size),t.spellCorrection=(0,r.createSelector)(t.numResults,e=>D(e).spellCorrection,(e,t)=>t&&(t.isCorrected||e<=10)?t:void 0),t.mediaDataWithHighlights=(0,r.createSelector)(t.mediaData,t.normalizedQuery,(e,s)=>{const i={};for(const a of Object.keys(e))i[a]={data:e[a],display_info:(0,t.calculateMediaDataDisplayInfo)(e[a],s)};return i});const A=["file_id_or_path","image_height","image_width","date_taken"];t.calculateMediaDataDisplayInfo=(e,t)=>{const s=t.split(/[\s,]+/).filter(e=>""!==e&&!e.startsWith("#"));if(0===s.length)return[];const i=s[s.length-1],a=[];for(const[t,r]of Object.entries(e)){if(A.includes(t)||!r)continue;const e=M(s,i,r);if(e.length){const s=P(e,r);a.push({field_name:t,highlights:s})}}return a};t.mergeDisplayInfo=(e,t,s)=>{const i=[];for(const[r,o]of Object.entries(e)){const e=t.find(e=>e.field_name===r),n=s.find(e=>e.field_name===r);if(!e&&!n)continue;const l=Array(o.length);if(e){let t=0;for(const s of e.highlights)for(const e of s.highlight_str)l[t]=s.is_highlighted,t++}if(n){let e=0;for(const t of n.highlights)for(const s of t.highlight_str)l[e]=l[e]||t.is_highlighted,e++}const c=[];let d=0;for(;-1!==d;){const e=(0,a.findIndex)(l,e=>e!==l[d],d);c.push({highlight_str:o.substring(d,-1===e?o.length:e),is_highlighted:l[d]}),d=e}i.push({field_name:r,highlights:c})}return i};const M=(e,t,s)=>{const i=t.toLowerCase(),a=s.toLowerCase(),r=[];for(const t of e){const e=t.toLowerCase(),s=e===i;let o=a.indexOf(e);for(let i=0;i<5&&0<=o;i++){L(e,a,o,s)&&r.push({token:t,index:o}),o=a.indexOf(e,o+1)}}return r},L=(e,t,s,i)=>{const a=s>=0,r=e.length;if(!a||0===r)return!1;const o=s+r===t.length||[" ",","].includes(t[s+r]),n=s>0&&[" ",","].includes(t[s-1]);return(0===s||n)&&(i||o)},P=(e,t)=>{const s=[],i=[...e].sort((e,t)=>e.index-t.index);let a=0;for(const e of i){const{index:i,token:r}=e;if(i<a||t.length<i+r.length)continue;const o=t.substring(i,i+r.length);a===i?s.push({highlight_str:o,is_highlighted:!0}):(s.push({highlight_str:t.substring(a,i),is_highlighted:!1}),s.push({highlight_str:o,is_highlighted:!0})),a=i+o.length}return a<t.length&&s.push({highlight_str:t.substring(a),is_highlighted:!1}),s};t.results=(0,r.createSelector)(t.resultsWithTags,t.mediaDataWithHighlights,(e,t)=>t?e.map(e=>{if(e instanceof l.File&&void 0!==t[e.file_id]){const s=t[e.file_id];e=e.set("media_data",s)}return e}):e),t.resultsList=(0,r.createSelector)(t.results,e=>e.toList()),t.isNautilusEnabled=(0,r.createSelector)(t.userOptions,e=>e&&e.nautilus_enabled),t.isPaperEnabled=(0,r.createSelector)(t.userOptions,e=>e&&e.paper_enabled),t.preferredEditors=(0,r.createSelector)(t.user,t.userOptions,(e,t)=>e?t&&t.preferred_editors?{[e.id]:t.preferred_editors}:{[e.id]:{}}:{}),t.fileCategoriesString=(0,r.createSelector)(t.fileCategories,e=>(0,m.fileCategoriesToString)(e)),t.fileCategoriesArray=(0,r.createSelector)(t.fileCategories,e=>Object.keys(e).filter(t=>"checked"===e[t])),t.fileCategoriesLogValue=(0,r.createSelector)(t.fileCategories,t.isPaperEnabled,(e,t)=>{if((0,m.allCategoriesUnchecked)(e,t))return["all_unchecked"];if((0,m.allCategoriesChecked)(e,t))return["all_checked"];const s=[];return Object.keys(e).forEach(t=>{"checked"===e[t]&&s.push(t)}),s}),t.selectedFiles=(0,r.createSelector)(t.results,t.selection,(e,t)=>N(e,t)),t.allFilesSelected=(0,r.createSelector)(t.results,t.selectedFiles,(e,t)=>e.size===t.size),t.selectedFilesForSidebar=(0,r.createSelector)(t.selectedFiles,d.previewThumbnails,(e,t)=>e.count()>0?e.withMutations(e=>{e.forEach((s,i)=>{var a;if(!s.thumbnail_url_tmpl&&(null===(a=t[s.file_id])||void 0===a?void 0:a.preview_url)){const a=t[s.file_id].preview_url;s instanceof l.File?e.set(i,new l.File(Object.assign(Object.assign({},s),{thumbnail_url_tmpl:a}))):a&&e.set(i,new l.FileSharedWithMe(Object.assign(Object.assign({},s),{thumbnail_url_tmpl:a})))}})}):e);t.selectFilesForSelection=(e,s)=>N((0,t.results)(e),s.selection);const N=(e,t)=>i.OrderedMap(t.selected.toArray().filter(e=>!!e).map(t=>[t,e.find(e=>"fq_path"in e?o.paths_are_equal(e.fq_path,t):e.file_id===t)]).filter(([e,t])=>!!t)),j=(0,r.createSelector)(t.resultsList,t.hasMoreResults,(e,t)=>t?e.count()+1:e.count());t.commonLogFields=(0,r.createSelector)(t.user,t.path,t.query,t.typeaheadSessionId,t.requestId,j,t.fileCategoriesLogValue,t.filteredAccountId,(e,t,s,i,a,r,n,l)=>e?{user_id:e.id,active_user_id:e.id,path_scoped:!o.paths_are_equal(t),type:"single-page",query_string:s,search_session_id:i,typeahead_session_id:i,timezone_offset:(0,h.getCurrentTimezoneOffset)(),request_id:a,result_count:r,file_type_filters:n,search_scoped_to_account_id:l,source:S.searchNavigationManager.source}:{}),t.searchArgs=(0,r.createSelector)(t.normalizedQuery,t.path,t.filteredAccountId,t.fileCategoriesString,t.lastModifiedDateWithCustomRange,t.dateTakenWithCustomRange,t.selectedDimensions,(e,t,s,i,a,r,o)=>{const{lastModifiedDate:n,customLastModifiedDateRange:l}=a,{dateTaken:c,customDateTakenRange:d}=r;return{query:e,path:t,filteredAccountId:s,fileCategoriesString:i,lastModifiedDate:n,lastModifiedDateStart:null==l?void 0:l.startDate,lastModifiedDateEnd:null==l?void 0:l.endDate,dateTaken:c,dateTakenStart:null==d?void 0:d.startDate,dateTakenEnd:null==d?void 0:d.endDate,dimensions:o}}),t.searchUrl=(0,r.createSelector)(t.user,O,t.searchArgs,t.typeaheadSessionId,t.previewFileId,t.sortOrder,t.lastModifiedDateWithCustomRange,t.dateTakenWithCustomRange,(e,t,s,i,a,r,o,l)=>{if(!e)return;const{query:d,path:p,filteredAccountId:g,fileCategoriesString:h,dimensions:_}=s,f=(0,c.getQueryArgs)().search_from,{lastModifiedDate:v,customLastModifiedDateRange:E}=o,{dateTaken:T,customDateTakenRange:w}=l;return(0,m.buildSearchURL)({user:e,searchPath:p,typeaheadSessionId:i,searchToken:t,normalizedQuery:d,qargs:{search_from:f&&-1===S.DESKTOP_FROM_PATHS.indexOf(f)?f:void 0,preview:a,file_categories:h||void 0,search_order_by:r.sortField===u.SortField.MODIFIED?n.SEARCH_ORDER_BY_TYPE.LAST_MODIFIED_TIME:void 0,search_reverse_order:r.sortDirection===u.SortDirection.ASCENDING?n.SEARCH_REVERSE_ORDER_TYPE.TRUE:void 0,search_account_id:g||void 0,search_last_modified_date:v!==y.DateRange.Any?String(v):void 0,search_last_modified_date_start:v===y.DateRange.Custom&&E?E.startDate.toISOString():void 0,search_last_modified_date_end:v===y.DateRange.Custom&&E?E.endDate.toISOString():void 0,search_date_taken:T!==y.DateRange.Any?String(T):void 0,search_date_taken_start:T===y.DateRange.Custom&&w?w.startDate.toISOString():void 0,search_date_taken_end:T===y.DateRange.Custom&&w?w.endDate.toISOString():void 0,search_dimensions:_.length>0?(0,m.dimensionsToURLParam)(_):void 0}}).toString()}),t.searchUrlReset=(0,r.createSelector)(t.user,O,t.normalizedQuery,t.typeaheadSessionId,(e,t,s,i)=>{if(e)return(0,m.buildSearchURL)({user:e,searchPath:"/",typeaheadSessionId:i,searchToken:t,normalizedQuery:s,qargs:{search_from:(0,c.getQueryArgs)().search_from||void 0}}).toString()});t.resultSuggestionsCache=e=>D(e).resultSuggestionsCache;const x=(0,r.createSelector)(t.searchArgs,e=>Object.values(e).toString());t.resultSuggestionsDataForSearchArgs=(0,r.createSelector)(t.resultSuggestionsCache,x,(e,t)=>e[t]),t.resultSuggestionsForSearchArgs=(0,r.createSelector)(t.resultSuggestionsDataForSearchArgs,e=>e&&e.loadingState===y.ResultSuggestionsLoadingState.LOADED?e.suggestions:void 0),t.cachedResultSuggestionsForSearchArgs=(0,r.createSelector)(t.resultSuggestionsDataForSearchArgs,e=>{var t;const s=null!==(t=null==e?void 0:e.suggestions)&&void 0!==t?t:[];return i.List(s)}),t.idToResultSuggestions=(0,r.createSelector)(t.cachedResultSuggestionsForSearchArgs,e=>i.Map(e.map(e=>[(0,v.getIdForSearchResult)(e),e]))),t.resultSuggestionsLoadingState=(0,r.createSelector)(t.resultSuggestionsDataForSearchArgs,e=>{var t;return null!==(t=null==e?void 0:e.loadingState)&&void 0!==t?t:void 0});const k=(e,t)=>t instanceof l.File&&t.file_id===e,U=(0,r.createSelector)(t.previewFileId,t.idToResultSuggestions,(e,t)=>{if(!e)return;const s=t.get(e);return s instanceof l.File?s:void 0});t.commonLogFieldsForResultSuggestions=(0,r.createSelector)(t.resultSuggestionsDataForSearchArgs,t.cachedResultSuggestionsForSearchArgs,(e,t)=>e?{request_id:e.requestId,result_count:t.size}:{}),t.previewFile=(0,r.createSelector)(t.previewFileId,t.results,U,(e,t,s)=>{if(!e)return;return t.find(t=>k(e,t))||s||void 0}),t.previewableFiles=(0,r.createSelector)(t.resultsList,t.previewFile,(e,t)=>{if(!t)return[];const s=e.filter(e=>e instanceof l.File&&!e.isDeleted&&!e.is_cloud_doc&&!e.is_dir).toArray();return s.find(e=>k(t.file_id,e))?s:[t]}),t.hasFiltersSelected=(0,r.createSelector)(t.path,t.filteredAccountId,t.fileCategoriesArray,t.lastModifiedDate,t.dateTaken,t.selectedDimensions,(e,t,s,i,a,r)=>!(o.paths_are_equal(e,"/")&&void 0===t&&0===s.length&&i===y.DateRange.Any&&a===y.DateRange.Any&&0===r.length));t.querySuggestionsCache=e=>D(e).querySuggestionsCache;t.lastQueryWithQuerySuggestionsLoaded=e=>D(e).lastQueryWithQuerySuggestionsLoaded,t.querySuggestions=(0,r.createSelector)(t.querySuggestionsCache,t.normalizedQuery,t.lastQueryWithQuerySuggestionsLoaded,(e,t,s)=>{const i=e[t];return!s||i&&i.loadingState!==y.QuerySuggestionsLoadingState.LOADING?H(e,t):H(e,s)});const H=(e,t)=>{const s=e[t];return s&&s.loadingState===y.QuerySuggestionsLoadingState.LOADED?s.suggestions:void 0};t.querySuggestionsLoadingState=(0,r.createSelector)(t.querySuggestionsCache,t.normalizedQuery,(e,t)=>W(e,t));const W=(e,t)=>{const s=e[t];return s?s.loadingState:void 0};t.filteredContact=(0,r.createSelector)(t.peopleSuggestionsCache,t.filteredAccountId,(e,t)=>{if(!t)return;const s=e[""];return(s&&s.contacts?s.contacts:[]).find(e=>e.dbx_account_id===t)}),t.filteredContactName=(0,r.createSelector)(t.filteredContact,e=>e?e.name:void 0),t.peopleSuggestions=(0,r.createSelector)(t.peopleSuggestionsCache,t.normalizedQuery,t.lastQueryWithPeopleSuggestionsLoaded,(e,t,s)=>{const i=e[t];return!s||i&&i.loadingState!==y.PeopleSuggestionsLoadingState.LOADING?q(e,t):q(e,s)}),t.peopleSuggestionsForPeopleFilter=(0,r.createSelector)(t.user,t.filteredContact,t.peopleSuggestionsForFilters,t.selfInSerpPeopleFilterEnabled,(e,t,s,i)=>{if(i&&s){const i={account_id:e.account_id,display_name:e.display_name,photo_url:e.photo_url,email:e.email},a=s.filter(e=>e.account_id!==i.account_id).slice(0,f.SEARCH_MAX_NUM_PEOPLE_SUGGESTIONS_TO_FETCH-1);return B(i,a,t)}if(!t||!s)return s;return[(0,v.convertFilteredContactToSuggestedUser)(t),...s.filter(e=>!V(e,t)).slice(0,f.SEARCH_MAX_NUM_PEOPLE_SUGGESTIONS_TO_FETCH-1)]});const V=(e,t)=>e.account_id===t.dbx_account_id,B=(e,t,s)=>{if(!s)return[e,...t];if(e.account_id!==s.dbx_account_id){const i=t.filter(e=>!V(e,s));return[(0,v.convertFilteredContactToSuggestedUser)(s),e,...i.slice(0,f.SEARCH_MAX_NUM_PEOPLE_SUGGESTIONS_TO_FETCH-2)]}return[e,...t.slice(0,f.SEARCH_MAX_NUM_PEOPLE_SUGGESTIONS_TO_FETCH-1)]},q=(e,t)=>{const s=e[t];return s&&s.loadingState===y.PeopleSuggestionsLoadingState.LOADED&&s.contacts?s.contacts.slice(0,Math.min(_.SEARCH_CONTACT_SUGGESTION_CAPACITY,s.contacts.length)):void 0};t.peopleSuggestionsLoadingState=(0,r.createSelector)(t.peopleSuggestionsCache,t.normalizedQuery,(e,t)=>{const s=e[t];return s?s.loadingState:void 0});t.tagsSuggestionsCache=e=>D(e).tagsSuggestionsCache;t.lastQueryWithTagsSuggestionsLoaded=e=>D(e).lastQueryWithTagsSuggestionsLoaded,t.tagsSuggestions=(0,r.createSelector)(t.tagsSuggestionsCache,t.normalizedQuery,t.lastQueryWithTagsSuggestionsLoaded,(e,t,s)=>{const i=e[t];return!s||i&&i.loadingState!==y.TagsSuggestionsLoadingState.LOADING?G(e,t):G(e,s)});const G=(e,t)=>{const s=e[t];return s&&s.loadingState===y.TagsSuggestionsLoadingState.LOADED?s.suggestions:void 0};t.tagsSuggestionsLoadingState=(0,r.createSelector)(t.tagsSuggestionsCache,t.normalizedQuery,(e,t)=>Q(e,t));const Q=(e,t)=>{const s=e[t];return s?s.loadingState:void 0};t.allSuggestionData=(0,r.createSelector)(t.tagsSuggestions,t.peopleSuggestions,t.querySuggestions,t.resultSuggestionsForSearchArgs,(e,t,s,i)=>({[y.SuggestionSection.PEOPLE]:t,[y.SuggestionSection.QUERY]:s,[y.SuggestionSection.TAGS]:e,[y.SuggestionSection.RESULT]:i})),t.highlightedSuggestionData=(0,r.createSelector)(t.allSuggestionData,t.highlightedRow,t.suggestionSectionOrder,(e,t,s)=>{if(void 0===t)return;let i=0;for(const a of s){const s=e[a];if(void 0!==s){if(void 0!==s[t-i])return s[t-i];i+=s.length}}}),t.suggestions=(0,r.createSelector)(t.user,t.tagsSuggestions,t.peopleSuggestions,t.querySuggestions,t.resultSuggestionsForSearchArgs,t.resultQuery,(e,t,s,i,a,r)=>{const n=[];return i&&n.push({title:T.intl.formatMessage({id:"A2OQmR",defaultMessage:"Search suggestions"}),suggestionSection:y.SuggestionSection.QUERY,suggestions:i.map(e=>({query:e.text,ariaLabel:T.intl.formatMessage({id:"ZFZrNG",defaultMessage:"Search for {query}"},{query:e.text}),highlightSpans:(e.highlight_spans||[]).map(e=>({string:e.highlight_str,isHighlighted:!!e.is_highlighted}))}))}),s&&n.push({title:T.intl.formatMessage({id:"s3VU9p",defaultMessage:"People"}),suggestionSection:y.SuggestionSection.PEOPLE,suggestions:s.map(e=>({id:e.dbx_account_id,initials:e.name.split(/\s+/).map(e=>"string"==typeof e[0]?e[0].toUpperCase():"").join("").substr(0,2),avatar:e.photo_url||e.avatar_url,name:e.name,nameHighlights:(0,v.getHighlightSpansForName)({name:e.name,query:r})||[],emailAddress:e.email,emailAddressHighlights:(0,v.getHighlightSpansForEmail)({email:e.email,query:r})||[],ariaLabel:T.intl.formatMessage({id:"1q1f/B",defaultMessage:"Search for {name}"},{name:e.name})}))}),t&&n.push({title:T.intl.formatMessage({id:"hI7tD7",defaultMessage:"Tags"}),suggestionSection:y.SuggestionSection.TAGS,suggestions:t.map(e=>({tag:e.tag_text,isSmartTag:(0,w.isSuggestedTag)(e)}))}),e&&a&&n.push({title:T.intl.formatMessage({id:"x6BGYU",defaultMessage:"Results"}),suggestionSection:y.SuggestionSection.RESULT,suggestions:a.map(t=>{var s,i,a;const r=(0,v.getIdForSearchResult)(t),n=(0,m.resultObjectToUrl)(t,e);if(t instanceof l.File){const e=t.type===C.FileTypes.FILE||t.type===C.FileTypes.PACKAGE;return{resultId:r,url:n,resultName:o.filename(t.fq_path),ariaLabel:o.filename(t.fq_path),lastModifiedByPerson:null!==(s=t.last_modified_name)&&void 0!==s?s:null,lastModifiedDateOrTime:(0,m.getLastModifiedDateOrTime)(t.ts?1e3*t.ts:null),iconType:e?"unknown-small":(0,I.convertLegacyFolderIconToSpectrum)(t.icon,"small"),filePath:e?t.fq_path:void 0}}return t instanceof l.FileSharedWithMe?{resultId:r,url:n,resultName:o.filename(t.filename),ariaLabel:o.filename(t.filename),lastModifiedByPerson:null!==(i=t.last_modified_name)&&void 0!==i?i:null,lastModifiedDateOrTime:(0,m.getLastModifiedDateOrTime)(1e3*t.ts),iconType:"unknown-small",filePath:t.filename}:t instanceof l.Paper?{resultId:r,url:n,resultName:t.title,ariaLabel:t.title,lastModifiedByPerson:null!==(a=t.last_editor_name)&&void 0!==a?a:null,lastModifiedDateOrTime:(0,m.getLastModifiedDateOrTime)(t.ts),iconType:"paper-small"}:{resultId:r,url:n,resultName:t.name,ariaLabel:t.name,lastModifiedByPerson:null,lastModifiedDateOrTime:"",iconType:"folder-small"}})}),n}),t.highlightedSuggestion=(0,r.createSelector)(t.suggestions,t.highlightedRow,t.suggestionSectionOrder,(e,t,s)=>{if(void 0===t)return;let i=0;for(const a of s){const s=e.find(e=>e.suggestionSection===a);if(void 0!==s){if(void 0!==s.suggestions[t-i])return s.suggestions[t-i];i+=s.suggestions.length}}});t.selectResultById=(e,s)=>(0,t.resultsList)(e).find(e=>e instanceof l.File?e.fq_path===s.id:e instanceof l.FileSharedWithMe&&e.file_id===s.id);t.showViewModeToggle=e=>!(!(0,t.resultQuery)(e)&&!(0,t.filteredAccountId)(e)||(0,t.resultsList)(e).isEmpty()),t.isInsideBackupFolder=(0,r.createSelector)(R.isInsideBackupFolderByFile,t.selectedFiles,(e,t)=>!!t.count()&&e(t.first())),t.isSearchAsYouTypeEnabled=(0,r.createSelector)(t.isFullPage,e=>!e)})),define("metaserver/static/js/search/single_page/data/store",["require","exports","metaserver/static/js/files_view/data/store","metaserver/static/js/redux/namespaces","metaserver/static/js/redux/store","metaserver/static/js/extensions/data/store","metaserver/static/js/search/single_page/data/reducer","metaserver/static/js/tagging/data/store","metaserver/static/js/starred/redux/store","metaserver/static/js/folder_overview/data/store"],(function(e,t,s,i,a,r,o,n,l,c){"use strict";let d;Object.defineProperty(t,"__esModule",{value:!0}),t.getStoreForSearch=void 0;t.getStoreForSearch=()=>(d||(d=(0,a.getStoreAndRegisterReducers)({[i.SEARCH_NAMESPACE_KEY]:o.searchReducer})),(0,s.getStoreForFilesView)(),(0,r.getStore)(),(0,n.getStoreForTagging)(),(0,l.getStoreForStarred)(),(0,c.getStoreForFolderOverview)(),d)})),define("metaserver/static/js/search/single_page/filters/filters",["require","exports","tslib","classnames","react","react-redux","typescript/component_libraries/retrieval-components/src/file-type-filter/index","metaserver/static/js/files_view/view_type","metaserver/static/js/logging/hive/schemas/web-modal-activity","metaserver/static/js/media_filters/gating","metaserver/static/js/folder_dialog/async","metaserver/static/js/clean/ui/path_filter_button","metaserver/static/js/search/constants","metaserver/static/js/search/single_page/constants","metaserver/static/js/search/single_page/data/action_creators/index","metaserver/static/js/search/single_page/data/selectors/experiments","metaserver/static/js/search/single_page/data/selectors/index","metaserver/static/js/files_view/data/selectors/instance_selectors","metaserver/static/js/search/single_page/logger","metaserver/static/js/search/single_page/filters/last_modified_filter","metaserver/static/js/search/single_page/media_filters/media_filters","metaserver/static/js/search/single_page/people_filters/people_filter","metaserver/static/js/search/single_page/filters/more_filters_modal","metaserver/static/js/search/single_page/filters/top_right_sort","metaserver/static/js/search/types","metaserver/static/js/core/i18n","dig-components/typography"],(function(e,t,s,i,a,r,o,n,l,c,d,u,p,g,h,_,m,f,S,v,E,y,T,w,b,F,C){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SearchFilters=t.SearchFiltersComponent=void 0,i=s.__importDefault(i),a=s.__importDefault(a),h=s.__importStar(h),_=s.__importStar(_),m=s.__importStar(m),f=s.__importStar(f);class I extends a.default.PureComponent{constructor(e){super(e),this.handlePathFilterButtonClick=()=>{const{user:e,path:t,setFilters:s}=this.props;e&&((0,d.showFolderDialog)({ariaLabel:F.intl.formatMessage({id:"t+qFUO",defaultMessage:"Folder selector"}),canSelectReadonly:!0,initialPath:t,modalName:l.ModalName.SEARCH_FILTER,primaryActionLabel:F.intl.formatMessage({id:"hZgiKR",defaultMessage:"Select"}),title:F.intl.formatMessage({id:"BCJrz5",defaultMessage:"Select a folder"}),user:e,onSuccess:e=>{s({path:e||"/"}),(0,S.logFolderFilterSelected)(b.LoggingEntryPoint.SEARCH_RESULTS_PAGE)},useApiV2:!0}),(0,S.logFolderFilterDropdownClicked)(b.LoggingEntryPoint.SEARCH_RESULTS_PAGE))},this.handleFileTypeFilterChange=e=>{const t=Object.assign({},p.FILE_CATEGORIES_UNCHECKED);e.forEach(e=>t[e]="checked"),this.props.setFilters({fileCategories:t}),(0,S.logFileTypeFilterSelected)(e,b.LoggingEntryPoint.SEARCH_RESULTS_PAGE)},this.handleFileTypeFilterDropdownClicked=()=>{this.props.isScreenWidthMobile&&this.setState({fileTypeFilterModalOpen:!0}),(0,S.logFileTypeFilterDropdownClicked)(b.LoggingEntryPoint.SEARCH_RESULTS_PAGE)},this.handleFileTypeFilterModalClose=()=>{this.setState({fileTypeFilterModalOpen:!1})},this.setLastModifiedDate=(e,t)=>{this.props.setFilters({lastModifiedDate:e,customLastModifiedDateRange:t})},this.setDimensions=e=>{this.props.setFilters({selectedDimensions:e})},this.setDateTaken=(e,t)=>{this.props.setFilters({dateTaken:e,customDateTakenRange:t})},this.state={fileTypeFilterModalOpen:!1}}componentDidMount(){(0,d.prewarmFolderDialog)()}get fileTypeFilterEntries(){return this.props.isPaperEnabled?g.FILE_CATEGORIES_PAPER:g.FILE_CATEGORIES_NO_PAPER}render(){const{user:e,path:t,fileCategories:s,isScreenWidthMobile:r,selectedDimensions:l,dateTaken:c,customDateTakenRange:d,shouldShowMediaFilters:p,lastModifiedDateWithCustomRange:g,isSearchSerpFiltersResponsivenessEnabled:h,isSearchTopRightSortEnabled:_,viewType:m}=this.props,f=this.props.isAdvancedSearchOperatorsEnabled&&!this.props.isFiltersUpToDateWithSearchQuery,S={entries:this.fileTypeFilterEntries,checkedCategories:s,onChange:this.handleFileTypeFilterChange,strings:{byType:F.intl.formatMessage({id:"46U2E8",defaultMessage:"Type"}),selectAll:F.intl.formatMessage({id:"Ercy3i",defaultMessage:"Select all"}),clearAll:F.intl.formatMessage({id:"S5TT9D",defaultMessage:"Clear all"})}},{setDateTaken:b,setDimensions:I,setLastModifiedDate:R}=this,D=(0,i.default)("search__filter",{"search__filter--responsive":h});return a.default.createElement("div",{className:"search__filters"},h&&a.default.createElement("div",{className:"search__filter"},a.default.createElement(C.Text,{variant:"paragraph",size:"standard",tagName:"p"},F.intl.formatMessage({id:"sCk2vW",defaultMessage:"Filter by:"}))),a.default.createElement("div",{className:"search__filter search__filter--path"},a.default.createElement(u.PathFilterButton,{path:t,onClick:this.handlePathFilterButtonClick,defaultText:F.intl.formatMessage({id:"mLQMCz",defaultMessage:"Folder"}),dropdownClasses:"search__filter-button",useDigComponents:!0,fullWidth:!0,disabled:f})),a.default.createElement("div",{className:"search__filter search__filter--file-type"},r?a.default.createElement(o.FileTypeFilterButton,Object.assign({},S,{disabled:f,triggerProps:{onClick:this.handleFileTypeFilterDropdownClicked,className:"search__filter-button"}})):a.default.createElement(o.FileTypeFilterDropdown,Object.assign({},S,{disabled:f,triggerProps:{className:"search__filter-button"},onMenuToggle:this.handleFileTypeFilterDropdownClicked})),a.default.createElement(o.FileTypeFilterModal,Object.assign({modalProps:{title:F.intl.formatMessage({id:"197PGq",defaultMessage:"Filter"}),open:this.state.fileTypeFilterModalOpen,onRequestClose:this.handleFileTypeFilterModalClose,withCloseButton:F.intl.formatMessage({id:"2bDlQT",defaultMessage:"Close modal"})}},S))),a.default.createElement("div",{className:D},a.default.createElement(v.LastModifiedFilter,{lastModifiedDate:g.lastModifiedDate,customLastModifiedDateRange:g.customLastModifiedDateRange,setLastModifiedDate:R,disabled:f})),a.default.createElement(y.PeopleFilter,{user:e,className:D,disabled:f}),p&&a.default.createElement("div",{className:D},a.default.createElement(E.MediaFilters,{dateTaken:c,customDateTakenRange:d,setDateTaken:b,selectedDimensions:l,setDimensions:I,disabled:f})),h&&a.default.createElement("div",{className:"search__filter search__filter--more_filters_modal"},a.default.createElement(T.MoreFiltersModal,{lastModifiedDate:g.lastModifiedDate,customLastModifiedDateRange:g.customLastModifiedDateRange,setLastModifiedDate:R,user:e,dateTaken:c,customDateTakenRange:d,setDateTaken:b,selectedDimensions:l,setDimensions:I,disabled:f})),m==n.ViewType.List&&_&&a.default.createElement("div",{className:"search__filter search__filter--sort"},a.default.createElement("div",{className:"search__filter--sort-label"},a.default.createElement(C.Text,{variant:"paragraph",size:"standard",tagName:"p"},F.intl.formatMessage({id:"pljKc/",defaultMessage:"Sort by:"}))),a.default.createElement(w.TopRightSort,null)))}}t.SearchFiltersComponent=I,I.displayName="SearchFiltersComponent";const R={setFilters:h.setFilters},D=(0,r.connect)(e=>({user:m.user(e),path:m.path(e),fileCategories:m.fileCategoriesArray(e),isPaperEnabled:m.isPaperEnabled(e),hasFiltersSelected:m.hasFiltersSelected(e),dateTaken:m.dateTaken(e),customDateTakenRange:m.customDateTakenRange(e),selectedDimensions:m.selectedDimensions(e),shouldShowMediaFilters:(0,c.isMediaFiltersEnabled)(_.mediaFiltersVariant(e)),lastModifiedDateWithCustomRange:m.lastModifiedDateWithCustomRange(e),isSearchSerpFiltersResponsivenessEnabled:_.isSearchSerpFiltersResponsivenessEnabled(e),isSearchTopRightSortEnabled:_.isSearchTopRightSortEnabled(e),viewType:f.selectViewType(e,{instanceId:p.SEARCH_FILES_VIEW_ID}),isFiltersUpToDateWithSearchQuery:m.isFiltersUpToDateWithSearchQuery(e),isAdvancedSearchOperatorsEnabled:_.isAdvancedSearchOperatorsEnabled(e)}),R);t.SearchFilters=D(I)})),define("metaserver/static/js/search/single_page/header",["require","exports","tslib","react-redux","react","metaserver/static/js/search/constants","metaserver/static/js/search/single_page/data/selectors/index","metaserver/static/js/core/i18n","metaserver/static/js/search/single_page/reset_filters","dig-components/typography","metaserver/static/js/search/single_page/search_view_mode_toggle","metaserver/static/js/browse/selection_indicator"],(function(e,t,s,i,a,r,o,n,l,c,d,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SearchHeader=t.SearchHeaderComponent=void 0,a=s.__importDefault(a),o=s.__importStar(o);t.SearchHeaderComponent=({loadingState:e,hasMoreResults:t,numResults:s,showViewModeToggle:i,responsive:o,selectedFiles:p})=>a.default.createElement("header",{className:"search__header search__header--simplified"},a.default.createElement(c.Title,{className:"search__title","aria-live":"polite"},(function(e,t,s){return e===r.SearchLoadingState.ZERO_QUERY?n.intl.formatMessage({id:"luV4IR",defaultMessage:"Filters"}):e===r.SearchLoadingState.LOADING_FIRST_PAGE?n.intl.formatMessage({id:"uitaX8",defaultMessage:"Searching..."}):t?n.intl.formatMessage({id:"i1llDx",defaultMessage:"{count, plural, one{{count}+ results} other{{count}+ results}}"},{count:s}):n.intl.formatMessage({id:"6J0O1e",defaultMessage:"{count, plural, one{{count} result} other{{count} results}}"},{count:s})})(e,t,s)),a.default.createElement(l.ResetFilters,null),a.default.createElement("div",{className:"search-selection-view-mode-container"},a.default.createElement(u.SelectionIndicator,{responsive:o,selectedFilesCount:p.count(),rightRailCollapsed:!1}),i&&a.default.createElement("div",{className:"search-viewmode-toggle-container"},a.default.createElement(d.SearchViewModeToggle,null)))),t.SearchHeaderComponent.displayName="SearchHeaderComponent";t.SearchHeader=(0,i.connect)(e=>({loadingState:o.loadingState(e),hasMoreResults:o.hasMoreResults(e),numResults:o.numResults(e),showViewModeToggle:o.showViewModeToggle(e),selectedFiles:o.selectedFiles(e)}))(t.SearchHeaderComponent)})),define("metaserver/static/js/search/single_page/input/connected",["require","exports","tslib","react-redux","metaserver/static/js/search/single_page/data/action_creators/index","metaserver/static/js/search/single_page/data/selectors/index","metaserver/static/js/search/single_page/data/selectors/experiments","metaserver/static/js/search/single_page/input/component","metaserver/static/js/files_page/data/action_creators"],(function(e,t,s,i,a,r,o,n,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ConnectedSearchInput=void 0,a=s.__importStar(a),r=s.__importStar(r),o=s.__importStar(o),l=s.__importStar(l);const c={setQuery:a.setQuery,setPath:a.setPath,clear:a.clear,setHighlightedRow:a.setHighlightedRow,setFilteredAccountId:a.setFilteredAccountId,onSearch:a.performSearch,setIsActiveInGlobalHeader:l.setIsActiveInGlobalHeader,dismissAllSuggestions:a.dismissAllSuggestions,onResultSuggestionClick:a.onResultSuggestionClick,redirectToResultDispatch:a.redirectToResult};t.ConnectedSearchInput=(0,i.connect)(e=>({query:r.query(e),path:r.path(e),highlightedRow:r.highlightedRow(e),highlightedSuggestionData:r.highlightedSuggestionData(e),highlightedSuggestion:r.highlightedSuggestion(e),allSuggestionData:r.allSuggestionData(e),filteredContact:r.filteredContact(e),results:r.resultsList(e),manualTaggingVariant:o.manualTaggingVariant(e),isSearchAsYouTypeEnabled:r.isSearchAsYouTypeEnabled(e),isSearchQueryUpToDateWithFilters:r.isSearchQueryUpToDateWithFilters(e),isAdvancedSearchOperatorsEnabled:o.isAdvancedSearchOperatorsEnabled(e)}),c)(n.SearchInputComponent)})),define("metaserver/static/js/search/single_page/input/suggestions",["require","exports","tslib","react","react-redux","typescript/component_libraries/retrieval-components/src/search-suggestions/index","metaserver/static/js/search/single_page/data/action_creators/index","metaserver/static/js/search/single_page/data/selectors/experiments","metaserver/static/js/search/single_page/data/selectors/index","metaserver/static/js/search/single_page/logger","metaserver/static/js/search/types","metaserver/static/js/search/search_helpers","metaserver/static/js/tagging/experiments","metaserver/static/js/campaigns/campaign_formats/index_new"],(function(e,t,s,i,a,r,o,n,l,c,d,u,p,g){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ConnectedSearchSuggestions=t.SearchSuggestionsComponent=void 0,i=s.__importDefault(i),o=s.__importStar(o),n=s.__importStar(n),l=s.__importStar(l),c=s.__importStar(c);class h extends i.default.PureComponent{constructor(){super(...arguments),this.dismissSuggestions=()=>{this.props.dismissAllSuggestions({query:this.props.normalizedQuery}),this.props.setHighlightedRow({index:void 0}),this.props.onFocusInput&&this.props.onFocusInput()},this.handleSuggestionClick=e=>{if((0,r.isQuerySuggestion)(e))c.logQuerySuggestionClicked(this.getGroupIndexOfSuggestion(e),this.props.querySuggestions,d.SuggestionSource.SUGGESTIONS_DROPDOWN),this.props.setQuery({query:e.query,alwaysTriggerSearch:!0});else if((0,r.isTagsSuggestion)(e)){c.logTagSuggestionsClicked(this.getGroupIndexOfSuggestion(e),this.props.tagsSuggestions,void 0,d.SuggestionSource.SUGGESTIONS_DROPDOWN);const t=(0,u.updateQueryWithTagsSuggestion)(this.props.normalizedQuery,e.tag);this.props.setQuery({query:t,alwaysTriggerSearch:!0})}else if((0,r.isResultSuggestion)(e)){if(this.props.resultSuggestionsForSearchArgs&&this.props.idToResultSuggestions){const t=this.props.idToResultSuggestions.get(e.resultId);t&&this.props.onResultSuggestionClick({result:t})}}else c.logPeopleFilterClicked(this.getGroupIndexOfSuggestion(e),this.props.peopleSuggestions.length,void 0,d.SuggestionSource.SUGGESTIONS_DROPDOWN),this.props.setFilteredAccountId({filteredAccountId:e.id}),this.props.setQuery({query:"",alwaysTriggerSearch:!0});this.dismissSuggestions()},this.getGroupIndexOfSuggestion=e=>{for(const t of this.props.suggestions)for(let s=0;s<=t.suggestions.length;s+=1)if(t.suggestions[s]===e)return s}}componentDidMount(){this.shouldLogQuerySuggestionsShown()&&c.logQuerySuggestionsDisplayed(this.props.querySuggestions,d.SuggestionSource.SUGGESTIONS_DROPDOWN),this.shouldLogPeopleSuggestionsShown()&&c.logPeopleFilterShown(this.props.peopleSuggestions.length,d.SuggestionSource.SUGGESTIONS_DROPDOWN),this.shouldLogTagsSuggestionsShown()&&c.logTagSuggestionsDisplayed(this.props.tagsSuggestions,d.SuggestionSource.SUGGESTIONS_DROPDOWN),this.shouldLogResultSuggestionsShown()&&c.logResultSuggestionsDisplayed(d.SuggestionSource.SUGGESTIONS_DROPDOWN)}componentDidUpdate(e){!this.shouldLogQuerySuggestionsShown()||this.shouldLogQuerySuggestionsShown(e)&&this.props.normalizedQuery===e.normalizedQuery||c.logQuerySuggestionsDisplayed(this.props.querySuggestions,d.SuggestionSource.SUGGESTIONS_DROPDOWN),!this.shouldLogPeopleSuggestionsShown()||this.shouldLogPeopleSuggestionsShown(e)&&this.props.normalizedQuery===e.normalizedQuery||c.logPeopleFilterShown(this.props.peopleSuggestions.length,d.SuggestionSource.SUGGESTIONS_DROPDOWN),!this.shouldLogTagsSuggestionsShown()||this.shouldLogTagsSuggestionsShown(e)&&this.props.normalizedQuery===e.normalizedQuery||c.logTagSuggestionsDisplayed(this.props.tagsSuggestions,d.SuggestionSource.SUGGESTIONS_DROPDOWN),!this.shouldLogResultSuggestionsShown()||this.shouldLogResultSuggestionsShown(e)&&this.props.normalizedQuery===e.normalizedQuery||c.logResultSuggestionsDisplayed(d.SuggestionSource.SUGGESTIONS_DROPDOWN)}shouldLogQuerySuggestionsShown(e=this.props){return e.querySuggestionsLoadingState===d.QuerySuggestionsLoadingState.LOADED&&this.shouldShowQuerySuggestions(e)}shouldLogPeopleSuggestionsShown(e=this.props){return e.peopleSuggestionsLoadingState===d.PeopleSuggestionsLoadingState.LOADED&&this.shouldShowPeopleSuggestions(e)}shouldShowQuerySuggestions({normalizedQuery:e,querySuggestions:t}=this.props){return!!e&&!!t&&!!t.length}shouldShowPeopleSuggestions({normalizedQuery:e,filteredAccountId:t,peopleSuggestions:s}=this.props){return!(!e||t||!s||!s.length)}shouldLogTagsSuggestionsShown(e=this.props){return e.tagsSuggestionsLoadingState===d.TagsSuggestionsLoadingState.LOADED&&this.shouldShowTagsSuggestions(e)}shouldShowTagsSuggestions({normalizedQuery:e,tagsSuggestions:t,manualTaggingVariant:s}=this.props){return(0,p.isTaggingEnabled)(s)&&!!(0,u.normalizeForTagsSuggestions)(e)&&!!t&&!!t.length}shouldShowResultSuggestions({normalizedQuery:e,resultSuggestionsForSearchArgs:t}=this.props){return!!e.length&&!!(null==t?void 0:t.length)}shouldLogResultSuggestionsShown(e=this.props){return e.resultSuggestionsLoadingState===d.ResultSuggestionsLoadingState.LOADED&&this.shouldShowResultSuggestions(e)}render(){const{suggestions:e,highlightedSuggestion:t,manualTaggingVariant:s,suggestionSectionOrder:a,normalizedQuery:o,shouldShowDashCampaignOnEmptySearch:n}=this.props,l=this.shouldShowQuerySuggestions(),c=this.shouldShowPeopleSuggestions(),d=this.shouldShowTagsSuggestions(),u=this.shouldShowResultSuggestions(),h=0===o.length,_=n&&h;return l||c||d||u?i.default.createElement("div",{className:"search__dropdown"},i.default.createElement(r.SearchSuggestions,{suggestions:e,suggestionSectionOrder:a,onSuggestionClick:this.handleSuggestionClick,ariaLabel:"",highlightedSuggestion:t,showTagsSuggestions:(0,p.isTaggingEnabled)(s)})):_?i.default.createElement(g.CampaignSlot,{slotId:"top_search_dropdown"}):null}}t.SearchSuggestionsComponent=h,h.displayName="SearchSuggestionsComponent";const _={setQuery:o.setQuery,setHighlightedRow:o.setHighlightedRow,setFilteredAccountId:o.setFilteredAccountId,dismissAllSuggestions:o.dismissAllSuggestions,onResultSuggestionClick:o.onResultSuggestionClick},m=(0,a.connect)(e=>({suggestions:l.suggestions(e),highlightedSuggestion:l.highlightedSuggestion(e),suggestionSectionOrder:l.suggestionSectionOrder(e),querySuggestions:l.querySuggestions(e),normalizedQuery:l.normalizedQuery(e),user:l.user(e),querySuggestionsLoadingState:l.querySuggestionsLoadingState(e),peopleSuggestionsLoadingState:l.peopleSuggestionsLoadingState(e),filteredAccountId:l.filteredAccountId(e),peopleSuggestions:l.peopleSuggestions(e),tagsSuggestions:l.tagsSuggestions(e),tagsSuggestionsLoadingState:l.tagsSuggestionsLoadingState(e),manualTaggingVariant:n.manualTaggingVariant(e),mediaFiltersVariant:n.mediaFiltersVariant(e),resultSuggestionsForSearchArgs:l.resultSuggestionsForSearchArgs(e),idToResultSuggestions:l.idToResultSuggestions(e),resultSuggestionsLoadingState:l.resultSuggestionsLoadingState(e),shouldShowDashCampaignOnEmptySearch:n.shouldShowDashCampaignOnEmptySearch(e)}),_);t.ConnectedSearchSuggestions=m(h)})),define("metaserver/static/js/search/single_page/logger",["require","exports","tslib","lodash","js/filepath/filepath","metaserver/static/js/logging/hive/schemas/search-web_search_activity","metaserver/static/js/logging/telemetry","metaserver/static/js/browse/models","metaserver/static/js/edison/ui/router_utils","metaserver/static/js/pap/analytics_client","metaserver/static/js/pap/util","js/pap-events/search/edit_search_filetype_filter","metaserver/static/js/dropbox/proto/pap_events/search/edit_search_media_filters","metaserver/static/js/dropbox/proto/pap_events/search/edit_search_sort_options","js/pap-events/search/create_search_query_history","js/pap-events/search/delete_search_query_history","js/pap-events/search/select_search_query_history","js/pap-events/search/shown_search_query_history","js/pap-events/search/delete_search_query","js/pap-events/search/start_search_query","js/pap-events/search/finish_search_query","js/pap-events/search/input_search_query","metaserver/static/js/dropbox/proto/pap_events/search/fail_search_query","js/pap-events/filesystem_item_actions/star_file","js/pap-events/search/select_search_view_mode","js/pap-events/search/select_search_view_mode_dropdown","js/pap-events/search/click_search_query","js/pap-events/search/log_dwell_time","js/pap-events/search/log_enriched_media_data","js/pap-events/search/select_search_box","js/pap-events/search/select_search_filters_reset","js/pap-events/search/click_suggestion","js/pap-events/search/fetch_suggestion","js/pap-events/search/dismiss_suggestion","js/pap-events/search/fail_suggestion","js/pap-events/search/shown_suggestion","js/pap-events/search/click_filter","js/pap-events/search/select_filter","js/pap-events/search/remove_filter","metaserver/static/js/dropbox/proto/pap_events/search/log_result_action","metaserver/static/js/dropbox/proto/pap_events/search/change_filter","js/pap-events/search/load_search_empty_state","js/pap-events/search/click_spell_correct","js/pap-events/search/shown_spell_correct","js/pap-events/search/change_search_right_rail","js/pap-events/search/open_search_right_rail","metaserver/static/js/dropbox/proto/pap_events/search/fail_search_result_preview","metaserver/static/js/dropbox/proto/pap_events/search/finish_search_result_preview","js/pap-events/search/preview_search_result","metaserver/static/js/search/constants","metaserver/static/js/search/api_helpers","metaserver/static/js/search/types","metaserver/static/js/clean/analytics","metaserver/static/js/clean/web_user_action_events","metaserver/static/js/search/single_page/data/store","metaserver/static/js/search/single_page/data/selectors/index","metaserver/static/js/tagging/utils","metaserver/static/js/search/single_page/utils","metaserver/static/js/search/single_page/constants","metaserver/static/js/metrics/index","metaserver/static/js/user_survey/user_survey","metaserver/static/js/modules/constants/search","metaserver/static/js/files_view/data/selectors/instance_selectors"],(function(e,t,s,i,a,r,o,n,l,c,d,u,p,g,h,_,m,f,S,v,E,y,T,w,b,F,C,I,R,D,O,A,M,L,P,N,j,x,k,U,H,W,V,B,q,G,Q,z,K,Y,X,Z,J,$,ee,te,se,ie,ae,re,oe,ne,le){"use strict";var ce,de,ue,pe;Object.defineProperty(t,"__esModule",{value:!0}),t.logSerpSetViewType=t.logPDFEditImpression=t.logHoverPreviewFailed=t.logHoverPreviewCompleted=t.logHoverPreviewStarted=t.recordResultSuggestionLoadTime=t.logSearchBarDisplayed=t.logResultPreviewStarted=t.logStartSearchSessionQuery=t.logRightRailAutoExpanded=t.logRightRailUserToggled=t.logResultSuggestionsLatencyToAmp=t.logResultSuggestionsFetched=t.logResultSuggestionsDisplayed=t.logQueryPressedEnter=t.logHistoryClickedInEmptyStateExperiment=t.logEmptyStateLoaded=t.logMediaFiltersDropdownClicked=t.logEnrichedMediaDataReceived=t.logDimensionFilterSelected=t.logDateTakenFilterSelected=t.logLastModifiedFilterSelected=t.logLastModifiedFilterDropdownClicked=t.logMoreFiltersModalApplyFiltersButtonClicked=t.logMoreFiltersChipClicked=t.logTagSuggestionsFailed=t.logTagSuggestionsFetched=t.logTagSuggestionsDismissed=t.logTagSuggestionsClicked=t.logTagSuggestionsDisplayed=t.logRedirectToResult=t.logQueryCleared=t.logQueryTyped=t.logSearchBoxFocus=t.logContextMenuClick=t.logPeopleFilterSelected=t.logPeopleFilterDropdownClicked=t.logPeopleFilterRemoved=t.logPeopleFilterClicked=t.logPeopleFilterShown=t.logPeopleFilterResponse=t.logSortFilterSelected=t.logSortFilterDropdownClicked=t.logSearchViewModeSelected=t.logSearchViewModeDropdownClicked=t.logFieldsFromResult=t.logQuerySuggestionsFailed=t.logQuerySuggestionsFetched=t.logQuerySuggestionsDismissed=t.logQuerySuggestionClicked=t.logQuerySuggestionsDisplayed=t.logSpellCorrectionClicked=t.logSpellCorrectionShown=t.logFiltersReset=t.logFileTypeFilterSelected=t.logFileTypeFilterDropdownClicked=t.logFolderFilterSelected=t.logFolderFilterDropdownClicked=t.logDwellTime=t.logScopeChipChanged=t.logHistoryCleared=t.logHistoryClicked=t.logHistoryAdded=t.logHistoryDisplayed=t.logResultAction=t.logQueryFailed=t.logQueryCompleted=t.logQueryStarted=t.updateSearchEventLoggersConfig=t.eventLoggers=t.FilterType=t.SuggestionType=t.MediaFiltersDropdownName=t.SearchLogResultType=t.hiveLogger=void 0,i=s.__importStar(i),o=s.__importStar(o),te=s.__importStar(te),le=s.__importStar(le),t.hiveLogger=new o.HiveLogger,(function(e){e.SHARED_DOC="shared_doc",e.SHARED_CLOUD_DOC="shared_cloud_doc"})(ce=t.SearchLogResultType||(t.SearchLogResultType={})),(function(e){e.DATE_TAKEN="date_taken",e.DIMENSIONS="dimensions",e.IMAGE_PROPERTIES="image_properties"})(t.MediaFiltersDropdownName||(t.MediaFiltersDropdownName={})),(function(e){e.PEOPLE="people",e.QUERY="query",e.RESULT="result",e.TAGS="tags"})(de=t.SuggestionType||(t.SuggestionType={})),(function(e){e.DATE_TAKEN="date_taken",e.DIMENSION="dimension",e.FILE_TYPE="file_type",e.FOLDER="folder",e.LAST_MODIFIED="last_modified",e.PEOPLE="people",e.SORT="sort"})(ue=t.FilterType||(t.FilterType={})),(function(e){e.COLLAPSED="collapsed",e.EXPANDED="expanded"})(pe||(pe={}));const ge=()=>Object.assign(Object.assign({},te.commonLogFields((0,ee.getStoreForSearch)().getState())),{timestamp_ms:Date.now()}),he=()=>te.commonLogFieldsForResultSuggestions((0,ee.getStoreForSearch)().getState()),_e=e=>e!==Y.SearchOriginPathway.WEB?{pathway:e}:void 0;t.eventLoggers={useHiveLogger:!0,usePapLogger:!0,useSprigCsatLogger:!1,hasUsedSprigCsatLogger:!1};t.updateSearchEventLoggersConfig=e=>{t.eventLoggers.useSprigCsatLogger="V1"===e};const me=e=>{t.eventLoggers.useSprigCsatLogger&&(t.eventLoggers.hasUsedSprigCsatLogger||(oe.UserSurvey.trackEvent(e,"search"),t.eventLoggers.hasUsedSprigCsatLogger=!0))};t.logQueryStarted=e=>{var s;const i=ge();t.hiveLogger.log(new r.SearchWebSearchActivityRow(Object.assign(Object.assign({event_name:"query_started"},i),{start:0,result_count:void 0,extra:_e(e)}))),(0,c.logEvent)((0,v.PAP_Start_SearchQuery)({actionSurface:"search",queryId:Number(i.request_id),typeaheadSessionId:null!==(s=i.typeahead_session_id)&&void 0!==s?s:void 0}))};t.logQueryCompleted=(e,i,a,o,n)=>{let l=Object.assign(Object.assign({event_name:"query_completed"},ge()),{latency:e});if(void 0!==a&&void 0!==o&&void 0!==n){const e={};Object.entries(o).forEach(([t,s])=>{e[t]=s.toString()}),l=Object.assign(Object.assign({},l),{extra:Object.assign(Object.assign(Object.assign({},l.extra),{tag_count:a.toString(),tag_action_surface:n}),e)})}if(i){const{extra:e={}}=l,t=s.__rest(l,["extra"]);e.media_metadata_search="ON",l=Object.assign(Object.assign({},t),{extra:e})}t.hiveLogger.log(new r.SearchWebSearchActivityRow(l)),(0,c.logEvent)((0,E.PAP_Finish_SearchQuery)({latency:e}))};t.logQueryFailed=(e,s,i)=>{var a;t.hiveLogger.log(new r.SearchWebSearchActivityRow(Object.assign(Object.assign({event_name:"query_failed"},ge()),{latency:e,failure_type:s,extra:_e(i)})));const o=(0,re.getMetricsReporter)().createCounter({ns:ae.AMP_NAMESPACE_SEARCH_WEB,name:ae.AMP_METRIC_QUERY_FAILED_COUNT});o.increment(),o.record();const n=T.pap_events.search.Fail_SearchQuery.OriginPathway.UNKNOWN_ORIGIN_PATHWAY,l=null!==(a=(0,d.getEnumValueForString)(`${i.toUpperCase()}_ORIGIN_PATHWAY`,T.pap_events.search.Fail_SearchQuery.OriginPathway))&&void 0!==a?a:n;(0,c.logEvent)(T.pap_events.search.Fail_SearchQuery.create({actionSurface:"search",latency:e,failureType:s,originPathway:l}))};t.logResultAction=(e,s,i,a,o,n)=>{var l,d;const u=(0,t.logFieldsFromResult)(i),p=le.selectViewType((0,ee.getStoreForSearch)().getState(),{instanceId:Y.SEARCH_FILES_VIEW_ID});let g=Object.assign(Object.assign(Object.assign({event_name:"result_action"},ge()),u),{action_type:e,position:s.indexOf(i),action_source:o,view_type:p});if(g.extra=Object.assign(Object.assign({},n),g.extra),a&&(g.extra=Object.assign(Object.assign({},g.extra),{action_surface:a})),o===$.ActionSourceValue.SEARCH_SUGGESTIONS_DROPDOWN&&(g=Object.assign(Object.assign({},g),he())),o!==$.ActionSourceValue.SEARCH_SUGGESTIONS_DROPDOWN&&a!==$.ActionSurfaceLogValue.TOP_NAVIGATION&&me("search_serp_csat_success"),t.eventLoggers.useHiveLogger&&t.hiveLogger.log(new r.SearchWebSearchActivityRow(g)),t.eventLoggers.usePapLogger){switch(e){case $.WebUserActionLogEvent.STAR:(0,c.logEvent)((0,w.PAP_Star_File)({actionSurface:a,queryId:Number(g.request_id),typeaheadSessionId:null!==(l=g.typeahead_session_id)&&void 0!==l?l:void 0,searchResultId:null!==(d=g.result_id)&&void 0!==d?d:void 0}))}U.pap_events.search.Log_ResultAction.create({actionType:e,actionSource:o,position:s.indexOf(i).toString(),deleted:u.deleted,lastEdited:u.file_last_edited,nsId:Number(u.file_nsid),sjId:Number(u.file_sjid),fileSize:u.file_size,matchType:u.match_type,searchResultId:g.result_id,typeaheadSessionId:g.typeahead_session_id,queryId:Number(g.request_id)})}};t.logHistoryDisplayed=(e,s)=>{const i=e.map(e=>e.rawQuery).reduce((e,t,s)=>(e[s]=t,e),{});if(s){const e=(0,X.getCurrentTimezoneOffset)(),t={search_session_id:s.typeaheadSessionId,typeahead_session_id:s.typeaheadSessionId,recent_history_map:JSON.stringify(i),timezone_offset:e,viewport:"dropdown-view"};J.SearchClientActivityLogger.log("recent_history_displayed",s.userId,t)}else t.hiveLogger.log(new r.SearchWebSearchActivityRow(Object.assign(Object.assign({event_name:"recent_history_displayed"},ge()),{recent_history_map:i})));(0,c.logEvent)((0,f.PAP_Shown_SearchQueryHistory)({actionSurface:"search"}))};t.logHistoryAdded=e=>{t.hiveLogger.log(new r.SearchWebSearchActivityRow(Object.assign(Object.assign({event_name:"recent_query_stored"},ge()),{position:e}))),(0,c.logEvent)((0,h.PAP_Create_SearchQueryHistory)({actionSurface:"search",recentHistoryQueryPostion:e}))};t.logHistoryClicked=(e,s,i)=>{t.hiveLogger.log(new r.SearchWebSearchActivityRow(Object.assign(Object.assign({event_name:"recent_query_selected"},ge()),{query_string:e,position:s,extra:i?{entry_point:i}:void 0}))),(0,c.logEvent)((0,m.PAP_Select_SearchQueryHistory)({actionSurface:"search",recentHistoryQueryPostion:s}))};t.logHistoryCleared=()=>{t.hiveLogger.log(new r.SearchWebSearchActivityRow(Object.assign({event_name:"recent_history_cleared"},ge()))),(0,c.logEvent)((0,_.PAP_Delete_SearchQueryHistory)({actionSurface:"search"}))};t.logScopeChipChanged=(e,s)=>{var i;t.hiveLogger.log(new r.SearchWebSearchActivityRow(Object.assign(Object.assign({event_name:"scope_chip_changed"},ge()),{file_path:e,viewport:s})));const a=H.pap_events.search.Change_Filter.Viewport.UNKNOWN_VIEWPORT,o=null!==(i=(0,d.getEnumValueForString)(`${s.toUpperCase().replace(/-/g,"_")}_VIEWPORT`,H.pap_events.search.Change_Filter.Viewport))&&void 0!==i?i:a;(0,c.logEvent)(H.pap_events.search.Change_Filter.create({viewport:o,filterType:ue.FOLDER}))};t.logDwellTime=(e,s,i)=>{const a=te.resultQuery((0,ee.getStoreForSearch)().getState());"open-preview"!==i&&"navigate-to-file-or-folder"!==i&&me("search_serp_csat_fail"),t.hiveLogger.log(new r.SearchWebSearchActivityRow(Object.assign(Object.assign({event_name:"dwell_time"},ge()),{query_string:a,view_type:s,extra:{dwell_time:e.toString(),dwell_time_end_event:i}}))),(0,c.logEvent)((0,I.PAP_Log_DwellTime)({actionSurface:"search",viewType:s,dwellTime:e.toString()}))};t.logFolderFilterDropdownClicked=e=>{t.hiveLogger.log(new r.SearchWebSearchActivityRow(Object.assign(Object.assign({event_name:"folder_filter_dropdown_clicked"},ge()),{extra:e?{entry_point:e}:void 0}))),(0,c.logEvent)((0,j.PAP_Click_Filter)({actionSurface:"search",filterType:ue.FOLDER}))};t.logFolderFilterSelected=e=>{t.hiveLogger.log(new r.SearchWebSearchActivityRow(Object.assign(Object.assign({event_name:"folder_filter_selected"},ge()),{extra:e?{entry_point:e}:void 0}))),(0,c.logEvent)((0,x.PAP_Select_Filter)({actionSurface:"search",filterType:ue.FOLDER}))};t.logFileTypeFilterDropdownClicked=e=>{t.hiveLogger.log(new r.SearchWebSearchActivityRow(Object.assign(Object.assign({event_name:"file_type_filter_dropdown_clicked"},ge()),{extra:e?{entry_point:e}:void 0}))),(0,c.logEvent)((0,j.PAP_Click_Filter)({actionSurface:"search",filterType:ue.FILE_TYPE}))};t.logFileTypeFilterSelected=(e,s)=>{t.hiveLogger.log(new r.SearchWebSearchActivityRow(Object.assign(Object.assign({event_name:"file_type_filter_selected"},ge()),{file_type_filters:e,extra:s?{entry_point:s}:void 0}))),(0,c.logEvent)((0,u.PAP_Edit_SearchFiletypeFilter)({actionSurface:"search",fileTypeFilters:JSON.stringify(e)}))};t.logFiltersReset=e=>{t.hiveLogger.log(new r.SearchWebSearchActivityRow(Object.assign(Object.assign({event_name:"filters_reset"},ge()),{extra:e?{entry_point:e}:void 0}))),(0,c.logEvent)((0,O.PAP_Select_SearchFiltersReset)({actionSurface:"search"}))};t.logSpellCorrectionShown=e=>{const s=e.isCorrected;t.hiveLogger.log(new r.SearchWebSearchActivityRow(Object.assign(Object.assign({event_name:"spell_correct_shown"},ge()),{request_id:e.requestId,extra:{is_corrected:s.toString()}}))),(0,c.logEvent)((0,B.PAP_Shown_SpellCorrect)({isCorrected:s}))};t.logSpellCorrectionClicked=e=>{const s=e.isCorrected;t.hiveLogger.log(new r.SearchWebSearchActivityRow(Object.assign(Object.assign({event_name:"spell_correct_clicked"},ge()),{request_id:e.requestId,extra:{is_corrected:s.toString()}}))),(0,c.logEvent)((0,V.PAP_Click_SpellCorrect)({isCorrected:s}))};t.logQuerySuggestionsDisplayed=(e,s)=>{const i=e.map(e=>{var t;return null!==(t=e.text)&&void 0!==t?t:""});t.hiveLogger.log(new r.SearchWebSearchActivityRow(Object.assign(Object.assign({event_name:"query_suggestions_displayed"},ge()),{result_count:e.length,query_suggestion_strings:i}))),(0,c.logEvent)((0,N.PAP_Shown_Suggestion)({resultCount:e.length,suggestionType:de.QUERY,suggestionSource:s}))};t.logQuerySuggestionClicked=(e,s,i)=>{const a=s.map(e=>{var t;return null!==(t=e.text)&&void 0!==t?t:""});t.hiveLogger.log(new r.SearchWebSearchActivityRow(Object.assign(Object.assign({event_name:"query_suggestions_clicked"},ge()),{position:e,result_count:s.length,query_suggestion_strings:a})));const o=s[e];(0,c.logEvent)((0,A.PAP_Click_Suggestion)({position:null==e?void 0:e.toString(),resultCount:s.length,suggestionType:de.QUERY,resultRank:null==o?void 0:o.sort_rank,suggestionSource:i}))};t.logQuerySuggestionsDismissed=e=>{t.hiveLogger.log(new r.SearchWebSearchActivityRow(Object.assign(Object.assign({event_name:"query_suggestions_dismissed"},ge()),{query_string:e}))),(0,c.logEvent)((0,L.PAP_Dismiss_Suggestion)({suggestionType:de.QUERY}))};t.logQuerySuggestionsFetched=(e,s,i)=>{t.hiveLogger.log(new r.SearchWebSearchActivityRow(Object.assign(Object.assign({event_name:"query_suggestions_fetched"},ge()),{query_string:e,result_count:s,latency:i}))),(0,c.logEvent)((0,M.PAP_Fetch_Suggestion)({resultCount:s,latency:i,suggestionType:de.QUERY}))};t.logQuerySuggestionsFailed=e=>{t.hiveLogger.log(new r.SearchWebSearchActivityRow(Object.assign(Object.assign({event_name:"query_suggestions_failed"},ge()),{query_string:e}))),(0,c.logEvent)((0,P.PAP_Fail_Suggestion)({suggestionType:de.QUERY}))};t.logFieldsFromResult=e=>{const t=(0,ie.getIdForSearchResult)(e);return e instanceof n.File?{deleted:e.isDeleted,file_extension:(0,a.file_extension_for_logging)(e.fq_path),file_last_edited:e.ts,file_name:(0,a.filename)(e.fq_path),file_nsid:`${e.ns_id}`,file_size:e.bytes,file_sjid:`${e.sjid}`,match_type:e.match_type,result_id:`${e.ns_id}:${e.sjid}`,extra:{file_id:t}}:e instanceof n.Paper?{paper_pad_id:e.pad_id,result_id:t}:e instanceof n.PaperFolder?{paper_folder_id:e.folder_id,result_id:t}:e instanceof n.FileSharedWithMe?{deleted:!1,file_extension:(0,a.file_extension_for_logging)(e.filename),file_last_edited:e.ts,file_name:(0,a.filename)(e.filename),file_size:e.bytes,match_type:e.match_type,result_id:t,extra:{result_type:e.is_cloud_doc?ce.SHARED_CLOUD_DOC:ce.SHARED_DOC}}:{}};t.logSearchViewModeDropdownClicked=e=>{t.hiveLogger.log(new r.SearchWebSearchActivityRow(Object.assign(Object.assign({event_name:"search_view_mode_dropdown_clicked"},ge()),{view_type:e}))),(0,c.logEvent)((0,F.PAP_Select_SearchViewModeDropdown)({actionSurface:"search",viewType:e}))};t.logSearchViewModeSelected=e=>{t.hiveLogger.log(new r.SearchWebSearchActivityRow(Object.assign(Object.assign({event_name:"search_view_mode_selected"},ge()),{view_type:e}))),(0,c.logEvent)((0,b.PAP_Select_SearchViewMode)({actionSurface:"search",viewType:e}))};t.logSortFilterDropdownClicked=e=>{t.hiveLogger.log(new r.SearchWebSearchActivityRow(Object.assign(Object.assign({event_name:"sort_filter_dropdown_clicked"},ge()),{extra:e?{entry_point:e}:void 0}))),(0,c.logEvent)((0,j.PAP_Click_Filter)({actionSurface:"search",filterType:ue.SORT}))};t.logSortFilterSelected=(e,s)=>{var i;t.hiveLogger.log(new r.SearchWebSearchActivityRow(Object.assign(Object.assign({event_name:"sort_filter_selected"},ge()),{extra:{sort_field:e.sortField,sort_direction:e.sortDirection,entry_point:s||null}})));const a=g.pap_events.search.Edit_SearchSortOptions.SortDirection.UNKNOWN_SORT_DIRECTION,o=null!==(i=(0,d.getEnumValueForString)(`${e.sortDirection}_SORT_DIRECTION`,g.pap_events.search.Edit_SearchSortOptions.SortDirection))&&void 0!==i?i:a;(0,c.logEvent)(g.pap_events.search.Edit_SearchSortOptions.create({actionSurface:"search",sortDirection:o,sortField:e.sortField}))};t.logPeopleFilterResponse=e=>{var s;const i=ge();t.hiveLogger.log(new r.SearchWebSearchActivityRow(Object.assign(Object.assign({event_name:"people_filter_response"},ge()),{result_count:e}))),(0,c.logEvent)((0,M.PAP_Fetch_Suggestion)({resultCount:e,suggestionType:de.PEOPLE,userId:null===(s=i.user_id)||void 0===s?void 0:s.toString()}))};t.logPeopleFilterShown=(e,s)=>{var i;const a=ge();t.hiveLogger.log(new r.SearchWebSearchActivityRow(Object.assign(Object.assign({event_name:"people_filter_shown"},ge()),{result_count:e}))),(0,c.logEvent)((0,N.PAP_Shown_Suggestion)({resultCount:e,suggestionType:de.PEOPLE,userId:null===(i=a.user_id)||void 0===i?void 0:i.toString(),suggestionSource:s}))};t.logPeopleFilterClicked=(e,s,i,a)=>{var o;const n=ge();t.hiveLogger.log(new r.SearchWebSearchActivityRow(Object.assign(Object.assign({event_name:"people_filter_clicked"},ge()),{position:e,result_count:s,extra:i?{entry_point:i}:void 0}))),(0,c.logEvent)((0,A.PAP_Click_Suggestion)({position:null==e?void 0:e.toString(),resultCount:s,suggestionType:de.PEOPLE,suggestionSource:a,userId:null===(o=n.user_id)||void 0===o?void 0:o.toString()}))};t.logPeopleFilterRemoved=()=>{t.hiveLogger.log(new r.SearchWebSearchActivityRow(Object.assign({event_name:"people_filter_removed"},ge()))),(0,c.logEvent)((0,k.PAP_Remove_Filter)({filterType:ue.PEOPLE}))};t.logPeopleFilterDropdownClicked=e=>{t.hiveLogger.log(new r.SearchWebSearchActivityRow(Object.assign(Object.assign({event_name:"people_filter_dropdown_clicked"},ge()),{extra:e?{entry_point:e}:void 0}))),(0,c.logEvent)((0,j.PAP_Click_Filter)({filterType:ue.PEOPLE}))};t.logPeopleFilterSelected=e=>{t.hiveLogger.log(new r.SearchWebSearchActivityRow(Object.assign(Object.assign({event_name:"people_filter_selected"},ge()),{extra:e?{entry_point:e}:void 0}))),(0,c.logEvent)((0,x.PAP_Select_Filter)({filterType:ue.PEOPLE}))};t.logContextMenuClick=()=>{t.hiveLogger.log(new r.SearchWebSearchActivityRow(Object.assign({event_name:"context_menu_click"},ge())))};t.logSearchBoxFocus=e=>{t.hiveLogger.log(new r.SearchWebSearchActivityRow(Object.assign(Object.assign({event_name:"search_box_focus"},ge()),{extra:{variant:e||null}}))),(0,c.logEvent)((0,D.PAP_Select_SearchBox)({actionSurface:"search"}))};t.logQueryTyped=e=>{t.hiveLogger.log(new r.SearchWebSearchActivityRow(Object.assign(Object.assign({event_name:"query_typed"},ge()),{query_string:e}))),(0,c.logEvent)((0,y.PAP_Input_SearchQuery)({}))};t.logQueryCleared=()=>{t.hiveLogger.log(new r.SearchWebSearchActivityRow(Object.assign({event_name:"query_cleared"},ge()))),(0,c.logEvent)((0,S.PAP_Delete_SearchQuery)({actionSurface:"search"}))};t.logRedirectToResult=(e,s,i,a)=>{const r=s instanceof n.Paper||s instanceof n.PaperFolder?$.WebUserActionLogEvent.PAPER_OPEN:s instanceof n.File&&s.is_dir?$.WebUserActionLogEvent.FOLDER_OPEN:$.WebUserActionLogEvent.FILE_VIEW;(0,t.logResultAction)(r,e,s,i,a)};t.logTagSuggestionsDisplayed=(e,s)=>{t.hiveLogger.log(new r.SearchWebSearchActivityRow(Object.assign(Object.assign({event_name:"tag_suggestions_displayed"},ge()),{tag_suggestions_count:e.length.toString(),tag_suggestions_strings:e.map(e=>e.tag_text)}))),(0,c.logEvent)((0,N.PAP_Shown_Suggestion)({suggestionType:de.TAGS,tagSuggestionsCount:e.length,suggestionSource:s}))};t.logTagSuggestionsClicked=(e,s,i,a)=>{const o=s[e],n=(0,se.getTagType)(o);t.hiveLogger.log(new r.SearchWebSearchActivityRow(Object.assign(Object.assign({event_name:"tag_suggestions_clicked"},ge()),{position:e,tag_suggestions_count:s.length.toString(),tag_suggestions_strings:s.map(e=>e.tag_text),extra:{tag_type:n,entry_point:i||null}}))),(0,c.logEvent)((0,A.PAP_Click_Suggestion)({position:e.toString(),tagSuggestionsCount:s.length,tagType:n,suggestionSource:a,suggestionType:de.TAGS}))};t.logTagSuggestionsDismissed=e=>{t.hiveLogger.log(new r.SearchWebSearchActivityRow(Object.assign(Object.assign({event_name:"tag_suggestions_dismissed"},ge()),{query_string:e}))),(0,c.logEvent)((0,L.PAP_Dismiss_Suggestion)({suggestionType:de.TAGS}))};t.logTagSuggestionsFetched=(e,s)=>{t.hiveLogger.log(new r.SearchWebSearchActivityRow(Object.assign(Object.assign({event_name:"tag_suggestions_fetched"},ge()),{query_string:e,tag_suggestions_count:s.toString()}))),(0,c.logEvent)((0,M.PAP_Fetch_Suggestion)({tagSuggestionsCount:s,suggestionType:de.TAGS}))};t.logTagSuggestionsFailed=e=>{t.hiveLogger.log(new r.SearchWebSearchActivityRow(Object.assign(Object.assign({event_name:"tag_suggestions_failed"},ge()),{query_string:e}))),(0,c.logEvent)((0,P.PAP_Fail_Suggestion)({suggestionType:de.TAGS}))};t.logMoreFiltersChipClicked=e=>{t.hiveLogger.log(new r.SearchWebSearchActivityRow(Object.assign(Object.assign({event_name:"more_filters_chip_clicked"},ge()),{extra:e?{entry_point:e}:void 0})))};t.logMoreFiltersModalApplyFiltersButtonClicked=e=>{t.hiveLogger.log(new r.SearchWebSearchActivityRow(Object.assign(Object.assign({event_name:"more_filters_modal_apply_filters_button_clicked"},ge()),{extra:e?{entry_point:e}:void 0})))};t.logLastModifiedFilterDropdownClicked=e=>{t.hiveLogger.log(new r.SearchWebSearchActivityRow(Object.assign(Object.assign({event_name:"last_modified_filter_dropdown_clicked"},ge()),{extra:e?{entry_point:e}:void 0}))),(0,c.logEvent)((0,j.PAP_Click_Filter)({actionSurface:"search",filterType:ue.LAST_MODIFIED}))};t.logLastModifiedFilterSelected=(e,s,i)=>{var a,o;const n=null!==(a=null==s?void 0:s.startDate.toDateString())&&void 0!==a?a:null,l=null!==(o=null==s?void 0:s.endDate.toDateString())&&void 0!==o?o:null,d=String(Z.DateRange[e]);t.hiveLogger.log(new r.SearchWebSearchActivityRow(Object.assign(Object.assign({event_name:"last_modified_filter_selected"},ge()),{extra:{last_modified_date:d,last_modified_date_start:n,last_modified_date_end:l,entry_point:i||null}}))),(0,c.logEvent)((0,x.PAP_Select_Filter)({actionSurface:"search",filterType:ue.LAST_MODIFIED,lastModifiedDate:d,lastModifiedDateStart:null!=n?n:void 0,lastModifiedDateEnd:null!=l?l:void 0}))};t.logDateTakenFilterSelected=(e,s,i)=>{var a,o;const n=null!==(a=null==s?void 0:s.startDate.toDateString())&&void 0!==a?a:null,l=null!==(o=null==s?void 0:s.endDate.toDateString())&&void 0!==o?o:null,d=Z.DateRange[e];t.hiveLogger.log(new r.SearchWebSearchActivityRow(Object.assign(Object.assign({event_name:"date_taken_filter_selected"},ge()),{extra:{date_taken:d,date_taken_start:n,date_taken_end:l,entry_point:i||null}}))),(0,c.logEvent)((0,x.PAP_Select_Filter)({actionSurface:"search",filterType:ue.DATE_TAKEN,dateTaken:d,dateTakenStart:null!=n?n:void 0,dateTakenEnd:null!=l?l:void 0}))};t.logDimensionFilterSelected=(e,s)=>{t.hiveLogger.log(new r.SearchWebSearchActivityRow(Object.assign(Object.assign({event_name:"dimension_filter_selected"},ge()),{dimension_filter:e.map(e=>Z.Dimensions[e]),extra:s?{entry_point:s}:void 0}))),(0,c.logEvent)((0,x.PAP_Select_Filter)({dimensionFilter:e.map(e=>Z.Dimensions[e]).toString(),filterType:ue.DIMENSION}))};t.logEnrichedMediaDataReceived=(e,s)=>{const a=i.sumBy(e,e=>i.isEmpty(te.calculateMediaDataDisplayInfo(e,s))?0:1).toString();t.hiveLogger.log(new r.SearchWebSearchActivityRow(Object.assign(Object.assign({event_name:"enriched_media_data_received"},ge()),{extra:{num_of_results_with_media_data_highlights:a}}))),(0,c.logEvent)((0,R.PAP_Log_EnrichedMediaData)({actionSurface:"search",numMediaDataResults:a}))};t.logMediaFiltersDropdownClicked=(e,s)=>{var i;t.hiveLogger.log(new r.SearchWebSearchActivityRow(Object.assign(Object.assign({event_name:"media_filters_dropdown_clicked"},ge()),{extra:{dropdown_name:String(e),entry_point:s||null}})));const a=p.pap_events.search.Edit_SearchMediaFilters.MediaFiltersDropdownName.UNKNOWN_MEDIA_FILTERS_DROPDOWN_NAME,o=null!==(i=(0,d.getEnumValueForString)(`${e}_MEDIA_FILTERS_DROPDOWN_NAME`,p.pap_events.search.Edit_SearchMediaFilters.MediaFiltersDropdownName))&&void 0!==i?i:a;(0,c.logEvent)(p.pap_events.search.Edit_SearchMediaFilters.create({actionSurface:"search",mediaFiltersDropdownName:o}))};t.logEmptyStateLoaded=()=>{t.hiveLogger.log(new r.SearchWebSearchActivityRow(Object.assign({event_name:"empty_state_loaded"},ge()))),(0,c.logEvent)((0,W.PAP_Load_SearchEmptyState)({actionSurface:"search"}))};t.logHistoryClickedInEmptyStateExperiment=(e,s)=>{(0,t.logHistoryClicked)(e,s,Z.LoggingEntryPoint.EMPTY_STATE_EXPERIMENT)};t.logQueryPressedEnter=()=>{t.hiveLogger.log(new r.SearchWebSearchActivityRow(Object.assign({event_name:"query_pressed_enter"},ge()))),(0,c.logEvent)((0,C.PAP_Click_SearchQuery)({actionSurface:"search"}))};t.logResultSuggestionsDisplayed=e=>{var s;t.hiveLogger.log(new r.SearchWebSearchActivityRow(Object.assign(Object.assign({event_name:"result_suggestions_displayed"},ge()),he()))),(0,c.logEvent)((0,N.PAP_Shown_Suggestion)({resultCount:he()&&null!==(s=he().result_count)&&void 0!==s?s:void 0,suggestionType:de.RESULT,suggestionSource:e}))};t.logResultSuggestionsFetched=(e,s,i)=>{var a;const o=Object.assign(Object.assign({},ge()),he());t.hiveLogger.log(new r.SearchWebSearchActivityRow(Object.assign(Object.assign({event_name:"result_suggestions_fetched"},o),{latency:e,extra:{server_time_ms:s?s.toString():null,network_time_ms:i?i.toString():null}}))),(0,c.logEvent)((0,M.PAP_Fetch_Suggestion)({resultCount:null!==(a=o.result_count)&&void 0!==a?a:void 0,latency:e,suggestionType:de.RESULT}))};t.logResultSuggestionsLatencyToAmp=(e,t,s,i,a)=>{const r=a?{variant:i,protocol:a}:{variant:i},o=a?ae.AMP_METRIC_RESULT_SUGGESTION_REQUEST_MS_BY_PROTOCOL:ae.AMP_METRIC_RESULT_SUGGESTION_SEARCH_QUERY_REQUEST_MS,n=a?ae.AMP_METRIC_RESULT_SUGGESTION_SERVER_MS_BY_PROTOCOL:ae.AMP_METRIC_RESULT_SUGGESTION_SEARCH_QUERY_SERVER_MS,l=a?ae.AMP_METRIC_RESULT_SUGGESTION_NETWORK_MS_BY_PROTOCOL:ae.AMP_METRIC_RESULT_SUGGESTION_SEARCH_QUERY_NETWORK_MS;(0,re.getMetricsReporter)().createStats({ns:ae.AMP_NAMESPACE_SEARCH_WEB,name:o},r).record(e),void 0!==t&&void 0!==s&&((0,re.getMetricsReporter)().createStats({ns:ae.AMP_NAMESPACE_SEARCH_WEB,name:n},r).record(t),(0,re.getMetricsReporter)().createStats({ns:ae.AMP_NAMESPACE_SEARCH_WEB,name:l},r).record(s))};t.logRightRailUserToggled=e=>{t.hiveLogger.log(new r.SearchWebSearchActivityRow(Object.assign(Object.assign({event_name:"right_rail_user_toggled"},ge()),{extra:{right_rail_state:e?pe.COLLAPSED:pe.EXPANDED,entry_point:Z.LoggingEntryPoint.SEARCH_RESULTS_PAGE}}))),(0,c.logEvent)((0,q.PAP_Change_SearchRightRail)({actionSurface:"search",searchRightRailIsCollapsed:e}))};t.logRightRailAutoExpanded=()=>{t.hiveLogger.log(new r.SearchWebSearchActivityRow(Object.assign(Object.assign({event_name:"right_rail_auto_expanded"},ge()),{extra:{entry_point:Z.LoggingEntryPoint.SEARCH_RESULTS_PAGE}}))),(0,c.logEvent)((0,G.PAP_Open_SearchRightRail)({actionSurface:"search"}))};function fe(e,t){const s=e;return Object.assign(Object.assign({},t),{file_nsid:s.ns_id,file_sjid:s.sjid,match_type:s.match_type||void 0})}t.logStartSearchSessionQuery=(e,t)=>{},t.logResultPreviewStarted=function(e){t.hiveLogger.log(new r.SearchWebSearchActivityRow(Object.assign(Object.assign({event_name:"result_preview_started"},ge()),{extra:{file_extension:e,entry_point:Z.LoggingEntryPoint.SEARCH_RESULTS_PAGE}})))},t.logSearchBarDisplayed=function(e){t.hiveLogger.log(new r.SearchWebSearchActivityRow(Object.assign(Object.assign({event_name:"search_bar_displayed"},ge()),{extra:Object.assign({variant:e||null},{is_edison_enabled:String(!!window.RUNNING_IN_EDISON),edison_page_name:window.EDISON_PAGE_NAME||"",is_edison_spa_enabled:String((0,l.shouldUseReactRouter)()),unified_search_variant:ne.UNIFIED_SEARCH_VARIANT})})))},t.recordResultSuggestionLoadTime=function(e,t,s){(0,re.getMetricsReporter)().createStats({ns:ae.AMP_NAMESPACE_SEARCH_WEB,name:ae.AMP_METRIC_RESULT_SUGGESTION_TOTAL_LOAD_TIME_MS},{source:t,variant:s}).record(performance.now()-e)},t.logHoverPreviewStarted=function({typeaheadSessionId:e,result:t,user:s,previewRequestId:i,viewport:a="dropdown-view"}){const r=fe(t,{search_session_id:e,typeahead_session_id:e,preview_request_id:i,timezone_offset:(0,X.getCurrentTimezoneOffset)(),viewport:a});J.SearchClientActivityLogger.log("preview_started",s.id,r),(0,c.logEvent)((0,K.PAP_Preview_SearchResult)({actionSurface:"search",nsId:r.file_nsid,sjId:r.file_sjid,matchType:r.match_type}))},t.logHoverPreviewCompleted=function({typeaheadSessionId:e,result:t,user:s,previewRequestId:i,viewport:a="dropdown-view",latency:r,displayed:o}){var n;const l=(0,X.getCurrentTimezoneOffset)(),u={search_session_id:e,typeahead_session_id:e,preview_request_id:i,timezone_offset:l,viewport:a,latency:r,displayed:o?"true":"false"};J.SearchClientActivityLogger.log("preview_completed",s.id,fe(t,u));const p=z.pap_events.search.Finish_SearchResultPreview.Viewport.UNKNOWN_VIEWPORT;let g=a;g=g.replace(/-/g,"_").toUpperCase();const h=null!==(n=(0,d.getEnumValueForString)(`${g}_VIEWPORT`,z.pap_events.search.Finish_SearchResultPreview.Viewport))&&void 0!==n?n:p;(0,c.logEvent)(z.pap_events.search.Finish_SearchResultPreview.create({searchSessionId:e,previewRequestId:i,timezoneOffset:l,viewport:h,latency:r,previewDisplayed:o}))},t.logHoverPreviewFailed=function({typeaheadSessionId:e,result:t,user:s,previewRequestId:i,viewport:a="dropdown-view",failureType:r}){var o;const n=(0,X.getCurrentTimezoneOffset)(),l={search_session_id:e,typeahead_session_id:e,preview_request_id:i,timezone_offset:n,viewport:a,failure_type:r};J.SearchClientActivityLogger.log("preview_failed",s.id,fe(t,l));const u=Q.pap_events.search.Fail_SearchResultPreview.Viewport.UNKNOWN_VIEWPORT;let p=a;p=p.replace(/-/g,"_").toUpperCase();const g=null!==(o=(0,d.getEnumValueForString)(`${p}_VIEWPORT`,Q.pap_events.search.Fail_SearchResultPreview.Viewport))&&void 0!==o?o:u;(0,c.logEvent)(Q.pap_events.search.Fail_SearchResultPreview.create({searchSessionId:e,previewRequestId:i,timezoneOffset:n,viewport:g,failureType:r}))};t.logPDFEditImpression=(e,s,i)=>{(0,t.logResultAction)($.WebUserActionLogEvent.SHOWN_EDIT_MODE,e,s,i,void 0,{file_ext:s.ext})};t.logSerpSetViewType=({isPlaceholder:e,isPlaceholderEnabled:s,viewType:i,placeholderWouldBeUsed:a,willSetViewType:o,serpDesignVariant:n,autoGridViewVariant:l})=>{t.hiveLogger.log(new r.SearchWebSearchActivityRow(Object.assign(Object.assign({event_name:"serp_set_view_type"},ge()),{extra:{isPlaceholder:e.toString(),isPlaceholderEnabled:s.toString(),viewType:i,placeholderWouldBeUsed:a.toString(),willSetViewType:o.toString(),serpDesignVariant:n,autoGridViewVariant:l}})))}})),define("metaserver/static/js/search/single_page/media_filters/media_api",["require","exports","tslib","metaserver/static/js/api_v2/default_user_client","metaserver/static/js/files_view/util"],(function(e,t,s,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.enrichedMediaDataFromApi=void 0,t.enrichedMediaDataFromApi=function(e,t){return s.__awaiter(this,void 0,void 0,(function*(){const s=t.filter(a.isFile).map(e=>e.file_id);if(0===s.length)return{enriched_media_data:[]};const r=new i.DefaultUserApiV2Client(e),o={file_id_or_paths:s};return yield r.ns("media_tags_search").rpc("get_enriched_media_data",o,{})}))}})),define("metaserver/static/js/search/single_page/preview",["require","exports","tslib","react-redux","react","metaserver/static/js/browse/constants","metaserver/static/js/search/single_page/data/action_creators/index","metaserver/static/js/search/single_page/data/selectors/index","metaserver/static/js/file_viewer/constants","metaserver/static/js/browse/data/selectors","metaserver/static/js/search/single_page/utils"],(function(e,t,s,i,a,r,o,n,l,c,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SearchPreview=t.SearchPreviewComponent=void 0,a=s.__importDefault(a),o=s.__importStar(o),n=s.__importStar(n);class u extends a.default.PureComponent{constructor(){super(...arguments),this.closeFileViewer=()=>{new Promise((t,s)=>{e(["metaserver/static/js/file_viewer/controller"],t,s)}).then(s.__importStar).then(e=>{e.close()})},this.handleFlipNext=()=>{const{previewFile:e,previewableFiles:t,setPreviewFileId:s}=this.props;if(!e||t.length<2)return;let i=t.indexOf(e);i<0||(i+=1,i>=t.length&&(i=0),s({previewFileId:t[i].file_id}))},this.handleFlipPrevious=()=>{const{previewFile:e,previewableFiles:t,setPreviewFileId:s}=this.props;if(!e||t.length<2)return;let i=t.indexOf(e);i<0||(i-=1,i<0&&(i=t.length-1),s({previewFileId:t[i].file_id}))},this.showFileViewer=()=>{const{user:t,previewableFiles:i,setPreviewFileId:a,setPreviewCommentsThreadId:r,previewFile:o,previewActiveCommentThreadId:n,isInsideBackup:c}=this.props;t&&o&&new Promise((t,s)=>{e(["metaserver/static/js/file_viewer/controller"],t,s)}).then(s.__importStar).then(e=>{e.open(i,i.indexOf(o),t,u.containerId,{fileViewOrigin:l.FileViewOriginType.SEARCH,fileViewTarget:l.FileViewTargetType.PRIVATE,skipOuterRouting:!0,disableRouting:!0,onCloseViewer:()=>{r({previewCommentsThreadId:void 0}),a({previewFileId:void 0})},onFlipNext:this.handleFlipNext,onFlipPrevious:this.handleFlipPrevious,activeCommentThreadId:n,isInsideBackup:null==c?void 0:c(o)})})}}componentDidMount(){this.showFileViewer()}componentDidUpdate(e){if(e.previewFile&&!this.props.previewFile)return this.props.setPreviewCommentsThreadId({previewCommentsThreadId:void 0}),void this.closeFileViewer();e.previewFile||!this.props.previewFile?e.previewFile&&this.props.previewFile&&this.props.previewFile.file_id!==e.previewFile.file_id&&this.showFileViewer():this.showFileViewer()}static get containerId(){return document.getElementById("react-file-viewer")?"react-file-viewer":r.BROWSE_FILE_VIEWER_ELEMENT_ID}render(){return null}}t.SearchPreviewComponent=u,u.displayName="SearchPreviewComponent";const p={setPreviewFileId:o.setPreviewFile,setPreviewCommentsThreadId:o.setPreviewCommentsThreadId};t.SearchPreview=(0,i.connect)(e=>({user:n.user(e),previewFile:n.previewFile(e),previewableFiles:n.previewableFiles(e),previewActiveCommentThreadId:n.previewActiveCommentThreadId(e),isInsideBackup:(0,d.handleErrorWithDefault)(c.isInsideBackupFolderByFile,()=>!1)(e)}),p)(u)})),define("metaserver/static/js/search/single_page/utils",["require","exports","tslib","metaserver/static/js/browse/models","metaserver/static/js/search/store_helpers"],(function(e,t,s,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.handleErrorWithDefault=t.convertFilteredContactToSuggestedUser=t.getSuggestedUserWithFilteredAccountId=t.getHighlightSpansForEmail=t.getHighlightSpansForName=t.getEscapedSearchQuery=t.getIdForSearchResult=t.generateRandomId=void 0,a=s.__importStar(a),t.generateRandomId=a.generateRandomId;t.getIdForSearchResult=e=>e instanceof i.File?e.file_id||e.fq_path:e instanceof i.FileSharedWithMe?e.file_id:e instanceof i.Paper?e.pad_id:e instanceof i.PaperFolder?e.folder_id:e.fq_path;t.getEscapedSearchQuery=e=>e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");t.getHighlightSpansForName=({name:e,query:s})=>{if(!s)return;const i=(0,t.getEscapedSearchQuery)(s),a=new RegExp(`(^${i})|(\\s${i})`,"gi"),r=[];let o;for(;null!==(o=a.exec(e));)r.push({start:o.index,end:o.index+o[0].length});if(0===r.length)return;const n=[];let l=0;for(;l<e.length&&r.length>0;){const t=r.shift();l<t.start&&n.push({string:e.substring(l,t.start),isHighlighted:!1}),n.push({string:e.substring(t.start,t.end),isHighlighted:!0}),l=t.end}return l<e.length&&n.push({string:e.substring(l),isHighlighted:!1}),n};t.getHighlightSpansForEmail=({email:e,query:s})=>{if(!e||!s)return;const i=(0,t.getEscapedSearchQuery)(s),a=e.indexOf(i);if(-1===a)return;const r=[];return a>0&&r.push({string:e.substring(0,a),isHighlighted:!1}),r.push({string:e.substring(a,a+i.length),isHighlighted:!0}),a+i.length<e.length&&r.push({string:e.substring(a+i.length),isHighlighted:!1}),r};t.getSuggestedUserWithFilteredAccountId=(e,t)=>null==t?void 0:t.find(t=>t.account_id===e.dbx_account_id);t.convertFilteredContactToSuggestedUser=e=>({account_id:e.dbx_account_id,display_name:e.name,photo_url:e.photo_url});t.handleErrorWithDefault=(e,t)=>(...s)=>{try{return e(...s)}catch(e){return t}}})),define("metaserver/static/js/search/single_page/view",["require","exports","tslib","classnames","lodash","react","react-intl","react-redux","dig-components/typography","metaserver/static/js/search/single_page/constants","metaserver/static/js/clean/browse_uri_interface","js/filepath/filepath","metaserver/static/js/clean/web_timing_logger","metaserver/static/js/media_filters/gating","metaserver/static/js/async/loadable","metaserver/static/js/components/ui/css","metaserver/static/js/extensions/data/selectors","metaserver/static/js/file_viewer/async_controller","metaserver/static/js/files_view/data/action_creators","metaserver/static/js/files_view/data/selectors/files_view_selectors","metaserver/static/js/files_view/data/selectors/instance_selectors","metaserver/static/js/files_view/types","metaserver/static/js/files_view/util","metaserver/static/js/files_view/view_type","metaserver/static/js/search/constants","metaserver/static/js/search/search_results/view","metaserver/static/js/search/single_page/data/action_creators/file_actions","metaserver/static/js/search/single_page/data/action_creators/index","metaserver/static/js/search/single_page/data/selectors/experiments","metaserver/static/js/search/single_page/data/selectors/index","metaserver/static/js/browse/data/selectors","metaserver/static/js/search/single_page/data/store","metaserver/static/js/search/single_page/logger","metaserver/static/js/search/single_page/navigation","metaserver/static/js/search/single_page/preview","metaserver/static/js/search/single_page/search_header_container","metaserver/static/js/search/single_page/zero_query/index","metaserver/static/js/sharing/browse_exports","metaserver/static/js/user_survey/user_survey","metaserver/static/js/clean/web_timing_logger","metaserver/static/js/clean/web_user_action_events","metaserver/static/js/file_viewer/constants","metaserver/static/js/core/i18n","metaserver/static/js/core/uri","metaserver/static/js/sync_everything/constants","metaserver/static/js/files_view/constants","metaserver/static/js/search/single_page/utils"],(function(e,t,s,i,a,r,o,n,l,c,d,u,p,g,h,_,m,f,S,v,E,y,T,w,b,F,C,I,R,D,O,A,M,L,P,N,j,x,k,U,H,W,V,B,q,G,Q){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AsyncErrorComponent=t.SearchView=t.ConnectedSearchViewWithProvider=t.SearchViewComponent=void 0,i=s.__importDefault(i),a=s.__importStar(a),r=s.__importDefault(r),u=s.__importStar(u),m=s.__importStar(m),S=s.__importStar(S),v=s.__importStar(v),E=s.__importStar(E),C=s.__importStar(C),I=s.__importStar(I),R=s.__importStar(R),D=s.__importStar(D),M=s.__importStar(M);class z extends r.default.PureComponent{constructor(t){super(t),this.starredStoreListenerUnsubscribe=()=>{},this.scrollContainer=r.default.createRef(),this.logDwellTimeOnTabChange=()=>{this.props.loadingState!==b.SearchLoadingState.ZERO_QUERY&&("hidden"==document.visibilityState?this.props.stopAndLogDwellTime("tab-hidden"):this.props.startDwellTime())},this.stopAndLogDwellTimeOnAbandon=()=>{this.props.stopAndLogDwellTime("abandon-results")},this.handleGetOverflowMenuActions=(e,t,s)=>[new Array],this.handleRenderSharedWithController=()=>null,this.handleGetIsFileJumping=()=>!1,this.handleIsFileViewerShown=()=>!!this.props.previewFile,this.handleShowShare=(e,t)=>{M.logResultAction(H.WebUserActionLogEvent.SHARE,this.props.results,e),k.UserSurvey.trackEvent("share_item","browse"),(0,x.asyncShowShareModal)(this.props.user,e,{browseContext:this.props.context,origin:t})},this.handleSwitchViewType=e=>{this.props.setViewType({viewType:e,viewTypeScope:G.VIEW_TYPE_SCOPE_TEXT_SEARCH,user:this.props.user})},this.filesViewActionHandlers={onDelete:t=>{new Promise((t,s)=>{e(["metaserver/static/js/browse/file_actions/action_handlers"],t,s)}).then(s.__importStar).then(({handleDelete:e})=>{e({user:this.props.user,files:t,isSearchMode:!0,viewType:this.props.viewType},this.props.context)})},onShowRename:e=>{this.props.setFileRename({file:e,renameState:y.RenameState.PENDING_INPUT})},onSetClipboard:a.noop,onPasteFromClipboard:a.noop,onNewFolderSubmit:a.noop,onNewFolderCancel:a.noop,onRenameSubmit:(e,t)=>{this.props.renameFile({file:e,name:t,checkFSWs:!0})},onRenameCancel:e=>this.props.setFileRename({file:e,renameState:null}),onSwitchViewType:this.handleSwitchViewType,onColumnsChanged:a.noop,onCanDisplayFolderSizesChanged:a.noop,onAddFileJumpKeyCode:a.noop,onResetFileJump:a.noop,onShowShare:this.handleShowShare,onPresentInZoom:e=>{(0,f.asyncOpenPreview)({containerId:P.SearchPreviewComponent.containerId,files:[e],indexOfPreviewFile:0,shouldFocusComment:!1,user:this.props.user,onFileViewerDidMount:()=>{},onFileViewerUnmount:()=>{},fileViewOrigin:W.FileViewOriginType.SEARCH,fileViewTarget:W.FileViewTargetType.PRIVATE,shouldPresentInZoom:!0})}},this.handleSelectionChange=(e,t)=>{this.props.setSelection({selection:e,actionSource:t})},this.handleSearch=(e,t,s)=>{void 0===t||u.paths_are_equal(t,this.props.path)||this.props.setPath({path:t}),e!==this.props.normalizedQuery&&this.props.setQuery({query:e,alwaysTriggerSearch:!0})},this.handleLocationLinkClick=(e,t)=>{M.logResultAction(H.WebUserActionLogEvent.CLICK_PATH_LINK,this.props.results,e),t||L.searchNavigationManager.set((0,d.get_browse_root)(this.props.user)+B.URI.encode_parts(u.parent_dir(e.fq_path)))},this.handleOpenPaper=e=>{this.props.redirectToResult({result:e})},this.handleFileSharedWithMe=e=>{this.props.redirectToResult({result:e})},this.handleRangeInView=(e,t)=>{this.props.loadingState===b.SearchLoadingState.LOADED&&this.props.hasMoreResults&&t===this.props.results.size-(this.props.viewType===w.ViewType.List?1:0)&&this.props.fetchNextPage()},this.handleSortOrderChanged=(e,t)=>{this.props.setSortOrder({sortOrder:{sortField:e,sortDirection:t}})},this.handleFocusSearchBar=()=>{this.props.inputBox.current&&this.props.inputBox.current.focus()},this.handleStarClick=(e,t)=>{M.logResultAction(t?H.WebUserActionLogEvent.STAR:H.WebUserActionLogEvent.REMOVE_STAR,this.props.results,e)},this.onContainerClick=e=>{(0,T.shouldClickDeselect)(e)&&this.props.clearSelection({actionSource:H.ActionSourceValue.WHITESPACE})},this.hrefForFile=(e,t)=>(0,d.href_for_file)(e,t,Object.assign({context:"search"},this.props.isInsideBackup(t)?{[q.BACKUP_QUERY_PARAM]:"true"}:{})),this.state={arePostTTIModulesLoaded:!1,TTIMarked:!1},t.loadViewTypes({user:t.user}),t.loadHistory()}componentDidMount(){return s.__awaiter(this,void 0,void 0,(function*(){yield(0,U.waitForTTI)(),this.setState({arePostTTIModulesLoaded:!0}),window.addEventListener("beforeunload",this.stopAndLogDwellTimeOnAbandon),window.addEventListener("visibilitychange",this.logDwellTimeOnTabChange)}))}componentWillMount(){this.props.resetTTI()}componentDidUpdate(e){this.state.TTIMarked||(this.props.onTTI?this.props.onTTI():(0,p.get_timer)(c.SEARCH_WEB_TIMER).markTimeToInteractive(),this.setState({TTIMarked:!0}))}componentWillUnmount(){window.removeEventListener("beforeunload",this.stopAndLogDwellTimeOnAbandon),window.removeEventListener("visibilitychange",this.logDwellTimeOnTabChange),this.starredStoreListenerUnsubscribe(),this.stopAndLogDwellTimeOnAbandon()}render(){const{user:e,responsive:s,results:n,context:l,loadingState:c,resultQuery:d,path:p,typeaheadSessionId:h,viewType:_,selection:m,selectedFiles:f,filteredContactName:S,inputBox:v,setFilters:E,mediaFiltersVariant:y}=this.props,T=s.isMatchedLarge;if(c===b.SearchLoadingState.LOAD_ERROR)return r.default.createElement(t.AsyncErrorComponent,null);if(c===b.SearchLoadingState.ZERO_QUERY){const e=(0,g.isMediaFiltersEnabled)(y)&&!1,t=!(u.paths_are_equal(p,"/")&&!S);return r.default.createElement("div",null,r.default.createElement(P.SearchPreview,null),e&&r.default.createElement(N.SearchHeaderContainer,{responsive:s}),r.default.createElement(j.ZeroQueryView,{inputBox:v,isFilterInSearch:t,hidePeopleSection:"backup"===L.searchNavigationManager.source,hideTagsSection:"backup"===L.searchNavigationManager.source}))}const w=this.props.results.isEmpty()&&this.props.loadingState===b.SearchLoadingState.LOADED;w&&(0,g.isOrganizedRetrievalSurveyEnabled)(y)&&k.UserSurvey.trackEvent("organized_search_no_results","search_bar"),w&&!d.includes("#")&&k.UserSurvey.trackEvent("generic_search_no_results","search");const C=(0,i.default)("search__view","maestro-content-scroll",{"maestro-content-scroll_scroll-disabled":c===b.SearchLoadingState.LOADING_FIRST_PAGE,"maestro-content-scroll--horizontal-scrollable":T});return r.default.createElement(o.RawIntlProvider,{value:V.intl},r.default.createElement(P.SearchPreview,null),r.default.createElement("div",{className:"search-view-container",onClick:this.onContainerClick},r.default.createElement(N.SearchHeaderContainer,{responsive:s}),r.default.createElement("div",{className:C,ref:this.scrollContainer},r.default.createElement("div",null,w?r.default.createElement(J,{hasFiltersSelected:this.props.hasFiltersSelected,resetFiltersUrl:this.props.searchUrlReset,onResetFilters:this.props.resetFilters}):r.default.createElement("div",{className:"search-view--sticky-hack"},r.default.createElement(F.SearchResultsView,{filesViewActionHandlers:this.filesViewActionHandlers,searchResultsExperiments:this.props.searchResultsExperiments,browseExperiments:this.props.browseExperiments,maestroSearchBarProps:{},onFocusSearchBar:this.handleFocusSearchBar,onSearch:this.handleSearch,onScroll:a.noop,setFileUploaderPath:a.noop,onSelectionChange:this.handleSelectionChange,path:p,user:e,ensureFileViewerClosedIfNotPreviewing:a.noop,getIsFileJumping:this.handleGetIsFileJumping,isFileViewerShown:this.handleIsFileViewerShown,fileRename:this.props.fileRename,arePostTTIModulesLoaded:this.state.arePostTTIModulesLoaded,getOverflowMenuActions:this.handleGetOverflowMenuActions,onLocationLinkClick:this.handleLocationLinkClick,onNavigateToFileOrFolder:this.props.handleNavigateToFileOrFolder,onNavigateToParentFolder:a.noop,onOpenFileSharedWithMe:this.handleFileSharedWithMe,onOpenPaper:this.handleOpenPaper,context:l,hasMoreResults:!!this.props.hasMoreResults,loadingState:c,latestQuery:d,queryForResultsTitle:d,typeaheadSessionId:h,searchResults:n,selection:m,selectedFiles:f,viewType:_,renderSharedWithController:this.handleRenderSharedWithController,hrefForFile:this.hrefForFile,responsive:s,onSearchFiltersChanged:E,fileCategories:this.props.fileCategories,onSortChange:this.handleSortOrderChanged,sharingServiceInfo:this.props.sharingServiceInfo,onRangeInView:this.handleRangeInView,currentSort:this.props.sortOrder,onStarClick:this.handleStarClick,scrollContainer:this.scrollContainer,filteredContactName:S,isColumnResizingEnabled:T,useSkinnyCheckboxes:!0,mediaFiltersVariant:this.props.mediaFiltersVariant,isSearchTopRightSortEnabled:this.props.isSearchTopRightSortEnabled}))))))}}t.SearchViewComponent=z,z.displayName="SearchViewComponent";const K=(0,A.getStoreForSearch)(),Y={setPath:I.setPath,setQuery:I.setQuery,setViewType:S.setViewType,loadViewTypes:S.loadViewTypes,setSelection:I.setSelection,clearSelection:I.clearSelection,loadHistory:I.loadHistory,setPreviewFile:I.setPreviewFile,setFileRename:S.setFileRename,fetchNextPage:I.fetchNextPage,renameFile:C.renameFile,setSortOrder:I.setSortOrder,restoreFiles:I.restoreFiles,setFilters:I.setFilters,resetFilters:I.resetFilters,startDwellTime:I.startDwellTime,stopAndLogDwellTime:I.stopAndLogDwellTime,handleNavigateToFileOrFolder:I.handleNavigateToFileOrFolder,redirectToResult:I.redirectToResult,resetTTI:I.resetTTI},X=(0,n.connect)(e=>({normalizedQuery:D.normalizedQuery(e),resultQuery:D.resultQuery(e),loadingState:D.loadingState(e),results:D.resultsList(e),path:D.path(e),typeaheadSessionId:D.typeaheadSessionId(e),viewType:E.selectViewType(e,{instanceId:b.SEARCH_FILES_VIEW_ID}),selectedFiles:D.selectedFiles(e),selection:D.selection(e),history:D.queryHistory(e),previewFile:D.previewFile(e),extensionsFeatureFlags:m.getFeatureFlags(e),sharingServiceInfo:m.sharingServiceInfo(e),fileCategories:D.fileCategories(e),context:D.context(e),fileRename:v.fileRename(e),hasMoreResults:D.hasMoreResults(e),sortOrder:D.sortOrder(e),searchResultsExperiments:R.searchResultsExperiments(e),browseExperiments:R.browseExperiments(e),hasFiltersSelected:D.hasFiltersSelected(e),searchUrlReset:D.searchUrlReset(e),preferredEditors:D.preferredEditors(e),experiments:R.experiments(e),filteredContactName:D.filteredContactName(e),shouldRenderInlineSearchFilters:R.shouldRenderInlineSearchFilters(e),mediaFiltersVariant:R.mediaFiltersVariant(e),isInsideBackup:(0,Q.handleErrorWithDefault)(O.isInsideBackupFolderByFile,()=>!1)(e),isSearchTopRightSortEnabled:R.isSearchTopRightSortEnabled(e)}),Y)(z);t.ConnectedSearchViewWithProvider=e=>r.default.createElement(n.Provider,{store:K},r.default.createElement(X,Object.assign({},e)));const Z=(0,h.Loadable)({loader:()=>s.__awaiter(void 0,void 0,void 0,(function*(){const{DogDigsSpot:t}=yield new Promise((t,s)=>{e(["metaserver/static/js/dig-illustrations/spot/dog-digs"],t,s)}).then(s.__importStar);return t}))});t.SearchView=(0,_.requireCssWithComponent)(t.ConnectedSearchViewWithProvider,["/static/metaserver/static/css/search/view-vflGi0iLD.css","/static/metaserver/static/css/browse/browse-vflwcdHa4.css","/static/metaserver/static/css/browse/files_view-vfl7RdOKb.css","/static/metaserver/static/css/search/search_results-vflJpdhCg.css","/static/metaserver/static/css/spectrum/index.web-vflJy4G-t.css","/static/metaserver/static/css/dig-illustrations/index.web-vflzrHQEU.css"]);const J=({hasFiltersSelected:e,resetFiltersUrl:t,onResetFilters:s})=>r.default.createElement("div",{className:"search__view search__view--empty",id:"search-view"},r.default.createElement("div",{className:"search__view--illustration"},r.default.createElement(Z,null)),r.default.createElement(l.Title,null,V.intl.formatMessage({id:"ZY55+d",defaultMessage:"No results found"})),r.default.createElement(l.Text,null,e?V.intl.formatMessage({id:"00FN2D",defaultMessage:"Try <LinkScope>resetting all filters</LinkScope>"},{LinkScope:e=>{return r.default.createElement("a",{href:t,onClick:(i=s,e=>{e.preventDefault(),i()})},e);var i}}):V.intl.formatMessage({id:"PtdLen",defaultMessage:"Try different keywords"})));J.displayName="NoResultsView",t.AsyncErrorComponent=(0,h.Loadable)({loader:()=>s.__awaiter(void 0,void 0,void 0,(function*(){const{ErrorComponent:t}=yield new Promise((t,s)=>{e(["metaserver/static/js/browse/components/post_tti/error"],t,s)}).then(s.__importStar);return t})),loading:()=>r.default.createElement("div",null,V.intl.formatMessage({id:"eU2b7o",defaultMessage:"Something went wrong. Please reload the page."})),loadError:()=>r.default.createElement("div",null,V.intl.formatMessage({id:"eU2b7o",defaultMessage:"Something went wrong. Please reload the page."}))})})),define("metaserver/static/js/search/single_page/zero_query/history",["require","exports","tslib","react","react-redux","dig-components/icons","dig-components/icons/src","spectrum/media_table/index","spectrum/table/index","dig-components/typography","ts-key-enum","metaserver/static/js/search/single_page/data/action_creators/index","metaserver/static/js/search/single_page/data/selectors/experiments","metaserver/static/js/search/single_page/data/selectors/index","metaserver/static/js/search/single_page/logger","metaserver/static/js/core/i18n"],(function(e,t,s,i,a,r,o,n,l,c,d,u,p,g,h,_){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SearchHistoryViewInEmptyState=t.SearchHistoryInEmptyStateComponent=t.SearchHistoryRow=void 0,i=s.__importDefault(i),u=s.__importStar(u),p=s.__importStar(p),g=s.__importStar(g),h=s.__importStar(h);class m extends i.default.PureComponent{constructor(){super(...arguments),this.handleClick=()=>{this.props.onClick(this.props.history,this.props.index)},this.handleKeyDown=e=>{switch(e.key){case" ":case d.Key.Enter:this.props.onClick(this.props.history,this.props.index)}}}render(){return i.default.createElement(n.MediaRow,{onClick:this.handleClick,className:"search__history-item",tabIndex:0,onKeyDown:this.handleKeyDown},({isHovered:e})=>[i.default.createElement(n.MediaCell,{key:"text",icon:i.default.createElement(r.UIIcon,{src:o.SearchLine}),title:this.props.history.rawQuery,highlight:e})])}}t.SearchHistoryRow=m,m.displayName="SearchHistoryRow";const f={setQuery:u.setQuery,clearHistory:u.clearAllHistory};t.SearchHistoryInEmptyStateComponent=e=>{const{history:t,inputBox:s,shouldRenderHistory:a}=e;i.default.useEffect(()=>{a&&h.logHistoryDisplayed(t,null)},[]);const r=(t,s)=>{e.setQuery({query:t.normalizedQuery,alwaysTriggerSearch:!0}),o(),h.logHistoryClickedInEmptyStateExperiment(t.normalizedQuery,s)},o=()=>{s.current&&s.current.focus()};return a?i.default.createElement(i.default.Fragment,null,t.length>0&&i.default.createElement(c.Title,{size:"small",className:"search_empty_row_header"},_.intl.formatMessage({id:"5ih958",defaultMessage:"Recent searches"})),i.default.createElement(l.Table,{className:"search__history-emptystate",columnFlex:[10,"70px"],"aria-rowcount":t.length,"aria-describedby":"search__history-header"},i.default.createElement(l.TableBody,null,t.map((e,t)=>i.default.createElement(m,{key:`history-${t}`,history:e,index:t,onClick:r}))))):null},t.SearchHistoryInEmptyStateComponent.displayName="SearchHistoryInEmptyStateComponent",t.SearchHistoryViewInEmptyState=(0,a.connect)(e=>({history:g.queryHistory(e),shouldRenderHistory:p.shouldRenderHistory(e),user:g.user(e)}),f)(t.SearchHistoryInEmptyStateComponent)})),define("metaserver/static/js/search/single_page/zero_query/index",["require","exports","tslib","classnames","react","react-redux","ts-key-enum","metaserver/static/js/search/single_page/logger","dig-components/typography","metaserver/static/js/tagging/components/tags_container","metaserver/static/js/home/recents/components/recent_activity_container","metaserver/static/js/search/single_page/data/selectors/experiments","metaserver/static/js/search/single_page/data/selectors/index","metaserver/static/js/search/types","metaserver/static/js/search/single_page/zero_query/history","metaserver/static/js/search/single_page/people_filters/suggested_people_chips","metaserver/static/js/search/single_page/data/action_creators/index","metaserver/static/js/tagging/experiments","metaserver/static/js/core/i18n","metaserver/static/js/tagging/data/selectors/index","metaserver/static/js/tagging/data/action_creators","metaserver/static/js/tagging/utils","metaserver/static/js/tagging/utils","spectrum/media_table_skeleton/index"],(function(e,t,s,i,a,r,o,n,l,c,d,u,p,g,h,_,m,f,S,v,E,y,T,w){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZeroQueryView=t.ZeroQueryComponent=void 0,i=s.__importDefault(i),a=s.__importDefault(a),n=s.__importStar(n),u=s.__importStar(u),m=s.__importStar(m),y=s.__importStar(y);class b extends a.default.PureComponent{render(){const{inputBox:e,manualTaggingVariant:t,setFilteredAccountId:s,isFilterInSearch:i,hidePeopleSection:r,hideTagsSection:o}=this.props;return a.default.createElement(I,{inputBox:e,manualTaggingEnabled:(0,f.isTaggingEnabled)(t),setFilteredAccountId:s,isFilterInSearch:i,hidePeopleSection:r,hideTagsSection:o})}}t.ZeroQueryComponent=b,b.displayName="ZeroQueryComponent";const F=()=>a.default.createElement("div",{className:"search__view--container"},a.default.createElement(l.Text,{color:"faint"},a.default.createElement(a.default.Fragment,null,S.intl.formatMessage({id:"8g1fAB",defaultMessage:"If you create tags, you'll have quick access to them here."}),a.default.createElement(l.Link,{href:"https://help.dropbox.com/files-folders/sort-preview/dropbox-tags",variant:"primary",hasNoUnderline:!0,target:"_blank",rel:"noopener noreferrer"},S.intl.formatMessage({id:"buAEr/",defaultMessage:"Learn about tags"})))));F.displayName="TagsEmptyStateOneLine";const C=({allTagsSuggestions:e,onTagClick:t})=>void 0===e?a.default.createElement("div",{className:"search__view--loading-section"},a.default.createElement(w.MediaTableSkeletonRow,null)):0===e.length?a.default.createElement(F,null):a.default.createElement(c.TagsContainer,{tags:(0,T.textTagsToUserGeneratedTags)(e.slice(0,5)),onTagClick:t,chipSize:"standard"});C.displayName="TagsSection";const I=({inputBox:t,manualTaggingEnabled:c,setFilteredAccountId:u,isFilterInSearch:m,hidePeopleSection:f,hideTagsSection:T})=>{const w=(0,r.useDispatch)(),b=(0,r.useSelector)(p.user);a.default.useEffect(()=>{n.logEmptyStateLoaded()},[]);const F=(0,r.useSelector)(v.selectUserGeneratedTagsSuggestions),I=F?F.map(e=>e.tag_text):void 0,R=c&&!m&&!T,O=!m&&!f;a.default.useEffect(()=>{b&&w((0,E.fetchAllTagsSuggestions)({user:b}))},[b]),a.default.useEffect(()=>{s.__awaiter(void 0,void 0,void 0,(function*(){const{loadRecentItems:t,loadPaperRecentItems:i}=yield new Promise((t,s)=>{e(["metaserver/static/js/home/recents/store_utils_post_tti"],t,s)}).then(s.__importStar);t(),i(!1)}))},[]);return a.default.createElement("div",{className:(0,i.default)({search__view:!0,"search__view--emptystate":!0,"home-access":!0}),id:"search-view",onKeyDown:e=>{e.key===o.Key.Escape&&t.current&&t.current.focus()}},a.default.createElement(l.Title,{size:"small",className:"search_empty_page_title"},S.intl.formatMessage({id:"JCuJcm",defaultMessage:"More ways to find your files"})),a.default.createElement(h.SearchHistoryViewInEmptyState,{inputBox:t}),O&&a.default.createElement(D,{title:S.intl.formatMessage({id:"L4YihC",defaultMessage:"People"})},a.default.createElement(_.SuggestedPeopleChips,{user:b,onSelect:(e,t,s)=>{n.logPeopleFilterClicked(t,s,g.LoggingEntryPoint.EMPTY_STATE_EXPERIMENT,g.SuggestionSource.EMPTY_STATE_SERP),u({filteredAccountId:e.account_id})}})),R&&a.default.createElement(D,{title:S.intl.formatMessage({id:"W5QoBG",defaultMessage:"Tags"})},a.default.createElement(C,{allTagsSuggestions:I,onTagClick:e=>{var t;const s=null!==(t=null==I?void 0:I.findIndex(t=>t===e.tag_text))&&void 0!==t?t:-1;n.logTagSuggestionsClicked(s,F||[],g.LoggingEntryPoint.SEARCH_EMPTY_STATE,g.SuggestionSource.EMPTY_STATE_SERP),y.redirectToSearchByTag(b,e.tag_text)}})),a.default.createElement(D,{title:S.intl.formatMessage({id:"vLMeBO",defaultMessage:"Recent files"})},a.default.createElement(d.RecentActivityContainerInSearchEmptyState,{className:"search_empty_page_recent_activity",key:"recent-activity-view",now:new Date,canRenderItems:!0,isHiddenByUser:!1,showHeader:!1,showAll:!1,fullItemView:!1,loggedComponentName:"search_empty_state",showSkeletonWhenLoading:!0,skipPrefetch:!0})))};I.displayName="SearchEmptyState";const R={setFilteredAccountId:m.setFilteredAccountId};t.ZeroQueryView=(0,r.connect)(e=>({shouldRenderEmptyZeroQueryView:u.shouldRenderEmptyZeroQueryView(e),manualTaggingVariant:u.manualTaggingVariant(e),mediaFiltersVariant:u.mediaFiltersVariant(e)}),R)(b);const D=({title:e,children:t})=>a.default.createElement("div",null,a.default.createElement(l.Title,{size:"small",className:"search_empty_row_header"},e),t);D.displayName="EmptyStateSection"})),define("metaserver/static/js/dropbox/proto/pap_events/search/edit_search_media_filters",["require","exports","tslib","protobufjs/minimal","metaserver/static/js/dropbox/proto/pap_events/predefined_event"],(function(e,t,s,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.pap_events=void 0;(i=s.__importStar(i)).Reader,i.Writer,i.util;const a=i.roots.default||(i.roots.default={});var r,o;t.default=a,t.pap_events=a.pap_events=((r=a.pap_events||{}).search=((o=r.search||{}).Edit_SearchMediaFilters=(function(e){function e(e){if(e)for(let t=Object.keys(e),s=0;s<t.length;++s)null!=e[t[s]]&&(this[t[s]]=e[t[s]])}return e.prototype.actionSurface="",e.prototype.eventClass=0,e.prototype.mediaFiltersDropdownName=0,e.create=function(t){return new e(t)},e.getTypeUrl=function(){return"type.googleapis.com/pap_events.search.Edit_SearchMediaFilters"},e.EventClass=(function(){const e={},t=Object.create(e);return t[e[0]="SEARCH"]=0,t})(),e.MediaFiltersDropdownName=(function(){const e={},t=Object.create(e);return t[e[0]="UNKNOWN_MEDIA_FILTERS_DROPDOWN_NAME"]=0,t[e[1]="DATE_TAKEN_MEDIA_FILTERS_DROPDOWN_NAME"]=1,t[e[2]="DIMENSIONS_MEDIA_FILTERS_DROPDOWN_NAME"]=2,t[e[3]="IMAGE_PROPERTIES_MEDIA_FILTERS_DROPDOWN_NAME"]=3,t})(),e})(o.Edit_SearchMediaFilters||{}),o),r)})),define("metaserver/static/js/dropbox/proto/pap_events/search/edit_search_sort_options",["require","exports","tslib","protobufjs/minimal","metaserver/static/js/dropbox/proto/pap_events/predefined_event"],(function(e,t,s,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.pap_events=void 0;(i=s.__importStar(i)).Reader,i.Writer,i.util;const a=i.roots.default||(i.roots.default={});var r,o;t.default=a,t.pap_events=a.pap_events=((r=a.pap_events||{}).search=((o=r.search||{}).Edit_SearchSortOptions=(function(e){function e(e){if(e)for(let t=Object.keys(e),s=0;s<t.length;++s)null!=e[t[s]]&&(this[t[s]]=e[t[s]])}return e.prototype.actionSurface="",e.prototype.eventClass=0,e.prototype.sortDirection=0,e.prototype.sortField="",e.create=function(t){return new e(t)},e.getTypeUrl=function(){return"type.googleapis.com/pap_events.search.Edit_SearchSortOptions"},e.EventClass=(function(){const e={},t=Object.create(e);return t[e[0]="SEARCH"]=0,t})(),e.SortDirection=(function(){const e={},t=Object.create(e);return t[e[0]="UNKNOWN_SORT_DIRECTION"]=0,t[e[1]="ASCENDING_SORT_DIRECTION"]=1,t[e[2]="DESCENDING_SORT_DIRECTION"]=2,t[e[3]="NEWEST_TO_OLDEST_SORT_DIRECTION"]=3,t[e[4]="OLDEST_TO_NEWEST_SORT_DIRECTION"]=4,t})(),e})(o.Edit_SearchSortOptions||{}),o),r)})),define("metaserver/static/js/dropbox/proto/pap_events/search/fail_search_query",["require","exports","tslib","protobufjs/minimal","metaserver/static/js/dropbox/proto/pap_events/predefined_event"],(function(e,t,s,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.pap_events=void 0;(i=s.__importStar(i)).Reader,i.Writer,i.util;const a=i.roots.default||(i.roots.default={});var r,o;t.default=a,t.pap_events=a.pap_events=((r=a.pap_events||{}).search=((o=r.search||{}).Fail_SearchQuery=(function(e){function e(e){if(e)for(let t=Object.keys(e),s=0;s<t.length;++s)null!=e[t[s]]&&(this[t[s]]=e[t[s]])}return e.prototype.actionSurface="",e.prototype.eventClass=0,e.prototype.latency=0,e.prototype.failureType="",e.prototype.originPathway=0,e.create=function(t){return new e(t)},e.getTypeUrl=function(){return"type.googleapis.com/pap_events.search.Fail_SearchQuery"},e.EventClass=(function(){const e={},t=Object.create(e);return t[e[0]="SEARCH"]=0,t})(),e.OriginPathway=(function(){const e={},t=Object.create(e);return t[e[0]="UNKNOWN_ORIGIN_PATHWAY"]=0,t[e[1]="ASSISTANT_ORIGIN_PATHWAY"]=1,t[e[2]="COLLAB_BROWSE_ORIGIN_PATHWAY"]=2,t[e[3]="WEB_ORIGIN_PATHWAY"]=3,t})(),e})(o.Fail_SearchQuery||{}),o),r)})),define("metaserver/static/js/dropbox/proto/pap_events/search/log_result_action",["require","exports","tslib","protobufjs/minimal","metaserver/static/js/dropbox/proto/pap_events/predefined_event"],(function(e,t,s,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.pap_events=void 0;(i=s.__importStar(i)).Reader,i.Writer,i.util;const a=i.roots.default||(i.roots.default={});var r,o;t.default=a,t.pap_events=a.pap_events=((r=a.pap_events||{}).search=((o=r.search||{}).Log_ResultAction=(function(e){function e(e){if(e)for(let t=Object.keys(e),s=0;s<t.length;++s)null!=e[t[s]]&&(this[t[s]]=e[t[s]])}return e.prototype.actionSurface="",e.prototype.eventClass=0,e.prototype.actionType="",e.prototype.actionSource="",e.prototype.position="",e.prototype.deleted=!1,e.prototype.extension="",e.prototype.lastEdited=0,e.prototype.fileName="",e.prototype.nsId=0,e.prototype.sjId=0,e.prototype.fileSize=0,e.prototype.matchType="",e.prototype.accessType=0,e.prototype.searchResultId="",e.prototype.fileId="",e.prototype.queryId=0,e.prototype.typeaheadSessionId="",e.create=function(t){return new e(t)},e.getTypeUrl=function(){return"type.googleapis.com/pap_events.search.Log_ResultAction"},e.EventClass=(function(){const e={},t=Object.create(e);return t[e[0]="SEARCH"]=0,t})(),e.AccessType=(function(){const e={},t=Object.create(e);return t[e[0]="UNKNOWN_ACCESS_TYPE"]=0,t[e[1]="OTHER_ACCESS_TYPE"]=1,t[e[2]="REVIEWER_ACCESS_TYPE"]=2,t[e[3]="ADMIN_ACCESS_TYPE"]=3,t[e[4]="OWNER_ACCESS_TYPE"]=4,t})(),e})(o.Log_ResultAction||{}),o),r)})),define("metaserver/static/js/dropbox/proto/pap_events/search/change_filter",["require","exports","tslib","protobufjs/minimal","metaserver/static/js/dropbox/proto/pap_events/predefined_event"],(function(e,t,s,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.pap_events=void 0;(i=s.__importStar(i)).Reader,i.Writer,i.util;const a=i.roots.default||(i.roots.default={});var r,o;t.default=a,t.pap_events=a.pap_events=((r=a.pap_events||{}).search=((o=r.search||{}).Change_Filter=(function(e){function e(e){if(e)for(let t=Object.keys(e),s=0;s<t.length;++s)null!=e[t[s]]&&(this[t[s]]=e[t[s]])}return e.prototype.actionSurface="",e.prototype.eventClass=0,e.prototype.filterType="",e.prototype.resultRank=0,e.prototype.groupRank=0,e.prototype.searchReferrer="",e.prototype.searchResultCount=0,e.prototype.dimensionFilter="",e.prototype.entryPoint="",e.prototype.resultCount=0,e.prototype.filePath="",e.prototype.viewport=0,e.create=function(t){return new e(t)},e.getTypeUrl=function(){return"type.googleapis.com/pap_events.search.Change_Filter"},e.EventClass=(function(){const e={},t=Object.create(e);return t[e[0]="SEARCH"]=0,t})(),e.Viewport=(function(){const e={},t=Object.create(e);return t[e[0]="UNKNOWN_VIEWPORT"]=0,t[e[1]="DROPDOWN_VIEW_VIEWPORT"]=1,t[e[2]="TOP_MENU_DROPDOWN_VIEW_VIEWPORT"]=2,t[e[3]="FULL_VIEW_VIEWPORT"]=3,t[e[4]="RIGHT_RAIL_VIEWPORT"]=4,t})(),e})(o.Change_Filter||{}),o),r)})),define("metaserver/static/js/file_uploader/clean/data/slice",["require","exports","tslib","@reduxjs/toolkit","metaserver/static/js/file_uploader/team_access_levels_definition","metaserver/static/js/file_uploader/constants","metaserver/static/js/clean/viewer","metaserver/static/js/core/assert","metaserver/static/js/file_uploader/utils","metaserver/static/js/file_uploader/clean/data/initial_state","metaserver/static/js/core/exception","@reduxjs/toolkit","metaserver/static/js/deprecated_ajax/ajax_jquery","metaserver/static/js/file_uploader/clean/data/selectors","immutable"],(function(e,t,s,i,a,r,o,n,l,c,d,u,p,g,h){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.reducer=t.uploadActionCreators=t.fetchQuotaUpsell=void 0,p=s.__importStar(p);const _=e=>{const t=[],s=[],i=[];return e.forEach(e=>{e.status!==r.FileStatusType.CANCELLED&&e.status!==r.FileStatusType.FAILED?t.push(e.uploadId):e.status===r.FileStatusType.FAILED?s.push(e.uploadId):i.push(e.uploadId)}),[...t,...s,...i]};t.fetchQuotaUpsell=(0,u.createAsyncThunk)("UPLOAD/fetchQuotaUpsell",(e,t)=>s.__awaiter(void 0,void 0,void 0,(function*(){const e=t.getState(),s=(0,g.getUser)(e);return yield p.SilentBackgroundRequest({url:"/get_info_for_quota_upsell",data:{_subject_uid:s.id}})})));const m=(0,i.createSlice)({name:"UPLOAD",initialState:c.initialUploadState,reducers:{setUser(e,{payload:t}){t&&(e.user=t)},setPath(e,{payload:t}){const{path:s,hasPermissionToUploadToFolder:i=!0,isMovingIntoVault:a=!1,targetSurface:r="none"}=t;e.path=s,e.hasPermissionToUploadToFolder=i,e.isMovingIntoVault=a,e.targetSurface=r},setFolderNsId(e,{payload:t}){e.folderNsId=t},setHasOverquotaError(e,{payload:t}){e.hasOverquotaError=t},addTeamLevelAccess(e,{payload:t}){e.teamAccessLevelsDefinition=e.teamAccessLevelsDefinition.addTeamAccessLevel(t.path,t.accessLevel)},resetTeamAccessLevel(e){e.teamAccessLevelsDefinition=new a.TeamAccessLevelsDefinition},queueUploads(e,{payload:t}){const s={};for(const e of t)s[e.uploadId]=e;e.fileList=(0,h.OrderedMap)(s).merge(e.fileList),e.sortedUploadIds=[...t.map(e=>e.uploadId),...e.sortedUploadIds],1===t.length?e.lastSingleFileUpload=t[0]:e.lastSingleFileUpload=null},readyUploads(e,{payload:t}){for(const s of t)e.fileList=e.fileList.update(s.uploadId,e=>e.set("status",r.FileStatusType.PENDING))},cancelUploads(e,{payload:t}){for(const s of t)e.fileList=e.fileList.update(s.uploadId,e=>e.status===r.FileStatusType.SET_PERMISSIONS||e.status===r.FileStatusType.PENDING||e.status===r.FileStatusType.UPLOADING?e.set("status",r.FileStatusType.CANCELLED):e);e.sortedUploadIds=_(e.fileList)},startUpload(e,{payload:t}){const{file:s}=t;(0,n.assert)(null!=s,"missing file to upload"),(0,n.assert)(e.fileList.has(s.uploadId),"failed to find file in file list"),e.fileList.get(s.uploadId)&&(e.fileList=e.fileList.update(s.uploadId,e=>e.set("status",r.FileStatusType.UPLOADING)),e.allUploadsComplete=!1)},completeUpload(e,{payload:t}){const{uploadId:s}=t,i=e.fileList.get(s);i&&(i.status!==r.FileStatusType.UPLOADING&&i.status!==r.FileStatusType.PENDING&&(0,d.reportStack)("Tried to mark a file upload that is not currently uploading as complete",{exc_extra:{file:i.toString(),fileListLength:e.fileList.count(),uploadId:s}}),e.fileList=e.fileList.update(s,e=>e.set("status",r.FileStatusType.COMPLETE)))},handleUploadError(e,{payload:t}){const{uploadId:s,errorType:i,errorMessage:a}=t,o=e.fileList.get(s);o&&(e.fileList=e.fileList.update(o.uploadId,e=>e.set("status",r.FileStatusType.FAILED).set("errorType",i).set("errorMessage",a))),e.sortedUploadIds=_(e.fileList)},setNumDraggingFiles(e,{payload:t}){const{numDraggingFiles:s,isInternalTransfer:i=!1}=t;e.numDraggingFiles=s,e.isInternalTransfer=i},setIsPermissionsAtUploadModalOpen(e,{payload:t}){e.isPermissionsAtUploadModalOpen=t},setDropzoneActive(e,{payload:t}){const{isActive:s}=t;e.isActive=s},setDraggedPersistentDropzone(e,{payload:t}){const{activeDropzone:s}=t;e.currentlyActivePersistentDropzone=s},clearDraggedPersistentDropzone(e){e.currentlyActivePersistentDropzone=""},clearDraggedOuterDropzone(e){e.currentlyActiveDropzone=""},setCurrentlyDraggedOuterDropzone(e,{payload:t}){const{activeDropzone:s}=t;e.currentlyActiveDropzone=s},addNewFailedFile(e,{payload:t}){const{file:s,errorType:i,errorMessage:a}=t;let o=s;null==o.uploadId&&(o=o.set("uploadId",(0,l.generateUploadId)())),o=o.set("status",r.FileStatusType.FAILED).set("errorType",i).set("errorMessage",a),e.fileList=e.fileList.set(o.uploadId,o),e.sortedUploadIds=_(e.fileList)},confirmFSW(e,{payload:t}){const{fswIds:s,batchId:i}=t;s.forEach(t=>{e.confirmedFSWs.includes(t)||e.confirmedFSWs.push(t)}),i&&!e.confirmedFSWBatchIds.includes(i)&&e.confirmedFSWBatchIds.push(i)},setUploadProgress(e,{payload:t}){const{uploadId:s,percentComplete:i,numSecondsLeft:a,secondsLeftForFile:o}=t;if(s){if(e.fileList=e.fileList.update(s,e=>e.set("percentUploaded",i)),void 0!==a&&(e.numSecondsLeft=a),i>0&&i<100){const t=e.fileList.get(s);t&&t.status!==r.FileStatusType.FAILED&&t.status!==r.FileStatusType.CANCELLED&&(e.fileList=e.fileList.update(s,e=>e.set("status",r.FileStatusType.UPLOADING)))}o&&(e.fileList=e.fileList.update(s,e=>e.set("numSecondsLeft",o)))}},setUploadModalType(e,{payload:t}){e.uploadModalType=t},setLastFileUploadMethod(e,{payload:t}){e.lastFileUploadMethod=t}},extraReducers:e=>{e.addCase(t.fetchQuotaUpsell.fulfilled,(e,t)=>{try{const s=JSON.parse(t.payload),i={userQuotaUsageRatio:s.user_quota_usage_ratio,tsdQuotaUsageRatio:s.tsd_quota_usage_ratio,inExcludedNses:s.in_excluded_nses,promptAdminToUpgradeEmailTemplateUrl:s.prompt_admin_to_upgrade_email_template_url,numTeamMembers:s.num_team_members,numTeamAdmins:s.num_team_admins,teamAdminEmail:s.team_admin_email,teamAdminFname:s.team_admin_fname};e.overQuotaDetails=i,e.overQuotaStatus=(function({path:e,user:t,tsdQuotaUsageRatio:s,inExcludedNses:i,userQuotaUsageRatio:a}){if((0,n.assert)(null!=t,"user is null"),t.paid||i)return r.OverQuotaStatusType.NONE;if("personal"===t.role){if(a>1)return r.OverQuotaStatusType.BASIC_OVER_QUOTA;if(a>.9)return r.OverQuotaStatusType.BASIC_NEAR_QUOTA}if(t.is_team&&o.Viewer.get_viewer().team_is_limited){const i=t.cdm_tmf_path;if(!t.is_cdm_member||i&&e.startsWith(i)){if(a>1)return r.OverQuotaStatusType.LIMITED_TEAM_USER_OVER_QUOTA}else if(s>1)return r.OverQuotaStatusType.LIMITED_TEAM_TSD_OVER_QUOTA}if(t.is_team&&o.Viewer.get_viewer().team_is_locked)return r.OverQuotaStatusType.LOCKED_TEAM_USER_OVER_QUOTA;return r.OverQuotaStatusType.NONE})({user:e.user,path:e.path,tsdQuotaUsageRatio:i.tsdQuotaUsageRatio,inExcludedNses:i.inExcludedNses,userQuotaUsageRatio:i.userQuotaUsageRatio})}catch(e){(0,d.reportException)({err:e,severity:"non-critical",exc_extra:{data:t.payload}})}})}});t.uploadActionCreators=m.actions,t.reducer=m.reducer})),define("metaserver/static/js/file_uploader/clean/data/store",["require","exports","metaserver/static/js/file_uploader/clean/data/slice","metaserver/static/js/redux/namespaces","metaserver/static/js/redux/store"],(function(e,t,s,i,a){"use strict";let r;Object.defineProperty(t,"__esModule",{value:!0}),t.getStoreForUpload=void 0;t.getStoreForUpload=()=>(r||(r=(0,a.getStoreAndRegisterReducers)({[i.UPLOAD_NAMESPACE_KEY]:s.reducer})),r)})),define("metaserver/static/js/file_uploader/api_helper",["require","exports","tslib","metaserver/static/js/browse/crypto_subtle_digest","metaserver/static/js/file_uploader/constants","metaserver/static/js/file_uploader/result_type"],(function(e,t,s,i,a,r){"use strict";function o(e){return e.replace(/\//g,"_").replace(/\+/g,"-")}function n(e){for(;e.endsWith("=");)e=e.slice(0,-1);return e}function l(e){return new Promise(t=>{const s=new FileReader;s.onloadend=function(e){if(!(null!==e&&e.target&&e.target.result instanceof ArrayBuffer))throw new Error;t(e.target.result)},s.readAsArrayBuffer(e)})}Object.defineProperty(t,"__esModule",{value:!0}),t.networkError=t.undefinedRpcError=t.getErrorOnStatus507=t.hashBlobForAppend=t.hashBlob=t.blobToArrayBuffer=t.removeDigestPadding=t.urlSafeEncodeTranslation=t.CHUNK_SIZE=void 0,t.CHUNK_SIZE=4194304,t.urlSafeEncodeTranslation=o,t.removeDigestPadding=n,t.blobToArrayBuffer=l,t.hashBlob=function(e){return s.__awaiter(this,void 0,void 0,(function*(){let t;try{t=yield l(e)}catch(e){return(0,r.error)({type:a.UploadErrorType.FILE_READER_NULL_RESULT_ERROR})}try{const e=yield(0,i.encryptArrayBuffer)(t),s=n(o(btoa(String.fromCharCode.apply(null,new Uint8Array(e)))));return s?(0,r.ok)({hash:s}):(0,r.error)({type:a.UploadErrorType.CLIENT_HASH_EMPTY_ERROR})}catch(e){return(0,r.error)({type:a.UploadErrorType.CLIENT_HASH_DIGEST_ERROR})}}))},t.hashBlobForAppend=function(e,i){return s.__awaiter(this,void 0,void 0,(function*(){let s;try{s=yield l(e)}catch(e){return(0,r.error)({type:a.UploadErrorType.FILE_READER_NULL_RESULT_ERROR})}const o=[];for(let e=0,i=0;e<s.byteLength;e+=t.CHUNK_SIZE,i++)o[i]=s.slice(e,e+t.CHUNK_SIZE);try{const e=yield Promise.all(o.map(i)),t=new Blob(e),s=yield l(t),a=yield i(s),n=Array.from(new Uint8Array(a)).map(e=>e.toString(16).padStart(2,"0")).join("");return(0,r.ok)({hash:n})}catch(e){return(0,r.error)({type:a.UploadErrorType.CLIENT_HASH_DIGEST_ERROR})}}))},t.getErrorOnStatus507=function(e){return"locked_team"===e.error?a.UploadErrorType.LOCKED_TEAM_ERROR:a.UploadErrorType.OVER_QUOTA_ERROR},t.undefinedRpcError={".tag":"undefined_error"},t.networkError={".tag":"network_error"}})),define("metaserver/static/js/file_uploader/api_v2_client",["require","exports","tslib","metaserver/static/js/file_uploader/api_helper","metaserver/static/js/api_v2/user_client","metaserver/static/js/api_v2/transport/xhr","metaserver/static/js/file_uploader/result_type"],(function(e,t,s,i,a,r,o){"use strict";function n(e,t){var r;return s.__awaiter(this,void 0,void 0,(function*(){const s=new a.UserApiV2Client;try{const i=yield s.ns("files").rpc("upload_session/start_batch",e,{subjectUserId:t});return(0,o.ok)(i)}catch(e){return void 0!==(null===(r=null==e?void 0:e.error)||void 0===r?void 0:r[".tag"])?(0,o.error)(e.error):0===e.raw.status?(0,o.error)(i.networkError,{isRetriable:!0,maxRetries:1/0,isNetworkError:!0}):(0,o.error)(i.undefinedRpcError)}}))}Object.defineProperty(t,"__esModule",{value:!0}),t.getSessionIds=t.uploadSessionFinishBatch=t.uploadSessionAppend=t.commitWebUploadTokenBatch=void 0,t.commitWebUploadTokenBatch=function(e,t){const s={entries:t};return(new a.UserApiV2Client).ns("upload_backend").rpc("commit_web_upload_token_batch",s,{subjectUserId:e})},t.uploadSessionAppend=function(e,t,n,l){var c;return s.__awaiter(this,void 0,void 0,(function*(){const s=new a.UserApiV2Client(new r.XhrTransport({onProgress:l}));try{const a=yield(0,i.blobToArrayBuffer)(t),r=yield s.ns("files").upload("upload_session/append_v2",e,a,{subjectUserId:n});return(0,o.ok)(r)}catch(e){return void 0!==(null===(c=null==e?void 0:e.error)||void 0===c?void 0:c[".tag"])?(0,o.error)(e.error):0===e.raw.status?(0,o.error)(i.networkError,{isRetriable:!0,maxRetries:1/0,isNetworkError:!0}):(0,o.error)(i.undefinedRpcError)}}))},t.uploadSessionFinishBatch=function(e,t){return s.__awaiter(this,void 0,void 0,(function*(){const s=new a.UserApiV2Client;try{const i=yield s.ns("files").rpc("upload_session/finish_batch_v2",e,{subjectUserId:t});return(0,o.ok)(i)}catch(e){return 0===e.raw.status?(0,o.error)(i.networkError,{isRetriable:!0,maxRetries:1/0,isNetworkError:!0}):(0,o.error)(i.undefinedRpcError)}}))};const l={".tag":"concurrent"};t.getSessionIds=function(e,t){return s.__awaiter(this,void 0,void 0,(function*(){const s=[];for(;e>1e3;){const i=n({num_sessions:1e3,session_type:l},t);s.push(i),e-=1e3}const i=n({num_sessions:e,session_type:l},t);s.push(i);const a=yield Promise.all(s);let r=[];for(const e of a){if(e.isError)return e;r=r.concat(e.result.session_ids)}return(0,o.ok)(r)}))}})),define("metaserver/static/js/file_uploader/actions_adapter",["require","exports","tslib","eventemitter3","js/filepath/filepath","metaserver/static/js/file_uploader/clean/data/store","metaserver/static/js/file_uploader/clean/data/selectors","metaserver/static/js/file_uploader/constants","metaserver/static/js/upload_kit/lib/types"],(function(e,t,s,i,a,r,o,n,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.convertValidationError=t.convertUploadItem=t.ActionsAdapter=void 0,i=s.__importDefault(i),a=s.__importStar(a);const c=new i.default;t.ActionsAdapter={emit(e,t){c.emit(e,t)},on:(e,t)=>c.on(e,t),removeListener:(e,t)=>c.removeListener(e,t),removeAllListeners(){c.removeAllListeners()},eventNames:()=>c.eventNames()},t.convertUploadItem=function({bytes:e,destPath:t,id:s,parentPath:i,bytesUploaded:l},c={}){const d=(0,o.getUser)((0,r.getStoreForUpload)().getState()).id,u=a.parent_dir(t),p=a.normalize(i)+a.normalize(u);return new n.FileUpload(Object.assign({uploadId:s,dest:p,name:a.filename(t),size:e,userId:d,percentUploaded:e>0?Math.ceil(l/e*100):100},c))},t.convertValidationError=function(e){switch(e){case l.UploadErrorType.EmptyFile:return n.UploadErrorType.EMPTY_OR_FOLDER;case l.UploadErrorType.IgnoredFile:return n.UploadErrorType.IGNORED;case l.UploadErrorType.OverMaxFileSize:return n.UploadErrorType.FILE_SIZE_ERROR;case l.UploadErrorType.PointerFile:case l.UploadErrorType.TemporaryFile:return n.UploadErrorType.INVALID_EXTENSION;case l.UploadErrorType.CloudDoc:case l.UploadErrorType.Unknown:default:return n.UploadErrorType.GENERIC}}})),define("metaserver/static/js/file_uploader/team_access_levels_definition",["require","exports","js/filepath/filepath"],(function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TeamAccessLevelsDefinition=void 0;class i{constructor(e){this.teamAccessLevelsDefinition=e||[]}hasDefinitions(){return!!this.teamAccessLevelsDefinition.length}addTeamAccessLevel(e,t){const s=this.teamAccessLevelsDefinition.filter(t=>t.path!==e);return new i([...s,{path:e,accessLevel:t}])}getTeamAccessLevel(e){if(!this.teamAccessLevelsDefinition.length)return null;const t=this.teamAccessLevelsDefinition.reduce((t,i)=>{const a=(0,s.inSubDirectory)(i.path,e)||(0,s.paths_are_equal)(i.path,e);if(!t)return a?i:null;const r=(0,s.normalize)(t.path),o=(0,s.normalize)(i.path),n=r.length<o.length;return a&&n?i:t},null);return t?t.accessLevel:null}}t.TeamAccessLevelsDefinition=i})),define("metaserver/static/js/file_uploader/processors",["require","exports","tslib","metaserver/static/js/file_uploader/api_v2_client","metaserver/static/js/upload_kit/lib/processors","js/filepath/filepath","metaserver/static/js/file_uploader/utils","metaserver/static/js/upload_kit/lib/types","metaserver/static/js/modules/constants/global_file_upload"],(function(e,t,s,i,a,r,o,n,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.startUploadSessions=t.processFiles=void 0,i=s.__importStar(i),t.processFiles=function(e,t){return s.__awaiter(this,void 0,void 0,(function*(){return e=(0,a.resolveDuplicates)(e),yield(function(e,t){return s.__awaiter(this,void 0,void 0,(function*(){e.length&&(yield(0,o.showInvalidFileWarning)(e.map(({item:e,error:t})=>({name:(0,r.filename)(e.destPath),validationError:t})),t,!0))}))})(t,0===e.length),(function(e){s.__awaiter(this,void 0,void 0,(function*(){e.forEach(e=>{e.file instanceof File&&!(0,n.isChooserFile)(e.file)&&!(0,n.isWebkitFile)(e.file)&&(e.file.webkitRelativePath="/")})}))})(e),e}))};t.startUploadSessions=function(e,t){return s.__awaiter(this,void 0,void 0,(function*(){if(l.UPLOAD_AUTORETRY_OPTIMIZATION){const{response:s}=yield(0,o.newPromiseWithRetries)(()=>i.getSessionIds(t.length,e));return s}{const{response:s}=yield(0,o.legacyPromiseWithRetries)(()=>i.getSessionIds(t.length,e),3);return s}}))}})),define("metaserver/static/js/clean/pagination_manager",["require","exports","tslib","metaserver/static/js/deprecated_ajax/ajax","metaserver/static/js/core/i18n","metaserver/static/js/core/notify","metaserver/static/js/clean/ui/snackbar"],(function(e,t,s,i,a,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PaginationManager=t.LegacyFetchNextFn=t.BasePaginationManager=void 0,i=s.__importStar(i);class n{constructor(e){this.hasMoreItems=e}areAllItemsReady(){return!this.hasMoreItems}invalidateHasMore(){this.hasMoreItems=!0}addDataToAjax(e){}}class l{constructor(e){this.handleNextPageSuccess=e=>{this.nextRequestVoucher=e.next_request_voucher,this.mode.hasMoreItems=e.has_more_items,this.autoFetching&&this.fetchNext(),this.addPage(e.items)},this.newDataCallback=e.newDataAvailableCallback,this.autoFetching=!1,this.mode=e.mode,this.keyName=e.keyName,this.items={},this.pages=[],this.nextRequestVoucher=e.firstPage.next_request_voucher,this.userID=e.userID,this.fqPathPrefix=e.fqPathPrefix?"/"+e.fqPathPrefix:"",this.addPage(e.firstPage.items),this.fetchNextFn=e.fetchNextFn}areAllItemsReady(){return this.mode.areAllItemsReady()}addPage(e){const t=[],s=[];for(const i of e){const e=i[this.keyName];if(null==e)return void r.Notify.warning(a.intl.formatMessage({id:"xlabvw",defaultMessage:"Invalid server response"}));null==this.items[e]&&(this.items[e]=i,s.push(i),t.push(e))}this.pages.push(t),this.newDataCallback(this,s)}startAutoFetching(){this.autoFetching=!0,this.fetchNext()}stopAutoFetching(){this.autoFetching=!1}reSync(e=!1){e&&(this.nextRequestVoucher=null,this.items={},this.pages=[]);const t=this.autoFetching&&this.mode.areAllItemsReady();this.mode.invalidateHasMore(),t&&this.startAutoFetching()}fetchNext(){if(this.mode.areAllItemsReady())return;const e={};this.nextRequestVoucher&&(e.voucher=this.nextRequestVoucher),this.mode.addDataToAjax(e),this.fetchNextFn(this.nextRequestVoucher||"",this.fqPathPrefix,this.userID,e).then(e=>{this.handleNextPageSuccess(e)}).catch(()=>{o.Snackbar.fail(a.intl.formatMessage({id:"bLA3rA",defaultMessage:"There was a problem completing this request."}),"browse")})}loadedPageCount(){return this.pages.length}getLoadedPage(e){const t=this.pages[e];return null==t?null:t.map(e=>this.items[e])}getLastLoadedPage(){return this.getLoadedPage(this.loadedPageCount()-1)}}t.BasePaginationManager=l;t.LegacyFetchNextFn=(e,t)=>(s,a,r,o)=>(s&&(o.voucher=s),new Promise((s,n)=>{i.WebRequest({url:e,data:o,dataType:"text",subject_user:r,success:(e,i)=>{s(t(i,a))},error:n})}));class c extends l{constructor(e){super(Object.assign(Object.assign({},e),{mode:new n(e.firstPage.has_more_items)}))}static create(e){return new c(e)}}t.PaginationManager=c})),define("metaserver/static/js/tagging/components/context_providers",["require","exports","tslib","react"],(function(e,t,s,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TagsContext=void 0,i=s.__importDefault(i),t.TagsContext=i.default.createContext({onSelection:e=>{},onTagDelete:e=>{},fetchAllTagsSuggestions:e=>{},allTagsSuggestions:void 0})})),define("metaserver/static/js/file_uploader/clean/data/initial_state",["require","exports","tslib","metaserver/static/js/file_uploader/team_access_levels_definition","immutable","metaserver/static/js/file_uploader/constants","metaserver/static/js/clean/active_user"],(function(e,t,s,i,a,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.initialUploadState=void 0,a=s.__importStar(a),t.initialUploadState={path:"/",hasPermissionToUploadToFolder:!0,folderNsId:null,user:(0,o.getActiveUser)(),fileList:a.OrderedMap(),sortedUploadIds:[],numDraggingFiles:0,isActive:!1,currentlyActiveDropzone:"",currentlyActivePersistentDropzone:"",isInternalTransfer:!1,isMovingIntoVault:!1,isPermissionsAtUploadModalOpen:!1,numSecondsLeft:0,currentFileNumSecondsLeft:0,confirmedFSWs:[],confirmedFSWBatchIds:[],hasOverquotaError:!1,allUploadsComplete:!1,teamAccessLevelsDefinition:new i.TeamAccessLevelsDefinition,targetSurface:"none",overQuotaStatus:r.OverQuotaStatusType.NONE,uploadModalType:null,lastFileUploadMethod:"upm",lastSingleFileUpload:null}})),define("metaserver/static/js/file_uploader/clean/data/selectors",["require","exports","@reduxjs/toolkit","metaserver/static/js/file_uploader/clean/data/initial_state","metaserver/static/js/redux/namespaces","metaserver/static/js/redux/selectors","metaserver/static/js/file_uploader/constants"],(function(e,t,s,i,a,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getLastSingleFileUploadOptional=t.getLastFileUploadMethod=t.getIsUploadModalOpen=t.getUploadModalType=t.getOverQuotaDetails=t.getOverQuotaStatus=t.getTargetSurface=t.getTeamAccessLevel=t.getTeamAccessLevelsDefinition=t.allUploadsComplete=t.hasOverquotaError=t.getConfirmedFSWBatchIds=t.getConfirmedFSWs=t.getPendingUploads=t.isUploadInProgress=t.isInternalTransfer=t.getCurrentlyActiveOuterDropzone=t.getCurrentlyActivePersistentDropzone=t.getIsDropzoneActive=t.getIsDraggingFiles=t.getNumDraggingFiles=t.getNextUpload=t.hasPermissionToUploadToFolder=t.getFolderNsId=t.isPermissionsAtUploadModalOpen=t.isMovingIntoVault=t.isUploadCancelled=t.getCurrentFileNumSecondsLeft=t.getNumSecondsLeft=t.getUploadById=t.getPath=t.getUser=t.getSortedUploads=t.getSortedIds=t.getFileList=t.getUploadState=void 0;t.getUploadState=e=>(0,r.getStateAtNamespace)(e,a.UPLOAD_NAMESPACE_KEY)||i.initialUploadState;t.getFileList=e=>(0,t.getUploadState)(e).fileList;t.getSortedIds=e=>(0,t.getUploadState)(e).sortedUploadIds,t.getSortedUploads=(0,s.createSelector)(t.getFileList,t.getSortedIds,(e,t)=>t.map(t=>e.get(t)));t.getUser=e=>(0,t.getUploadState)(e).user;t.getPath=e=>(0,t.getUploadState)(e).path;t.getUploadById=(e,s)=>{let i;return s&&(i=(0,t.getFileList)(e).get(s)),i};t.getNumSecondsLeft=e=>(0,t.getUploadState)(e).numSecondsLeft;t.getCurrentFileNumSecondsLeft=e=>(0,t.getUploadState)(e).currentFileNumSecondsLeft;t.isUploadCancelled=(e,s)=>{const i=(0,t.getFileList)(e).get(s);return!!i&&i.status===o.FileStatusType.CANCELLED};t.isMovingIntoVault=e=>(0,t.getUploadState)(e).isMovingIntoVault;t.isPermissionsAtUploadModalOpen=e=>(0,t.getUploadState)(e).isPermissionsAtUploadModalOpen;t.getFolderNsId=e=>(0,t.getUploadState)(e).folderNsId;t.hasPermissionToUploadToFolder=e=>(0,t.getUploadState)(e).hasPermissionToUploadToFolder,t.getNextUpload=(0,s.createSelector)(t.getFileList,e=>e.find(e=>e.status===o.FileStatusType.PENDING));t.getNumDraggingFiles=e=>(0,t.getUploadState)(e).numDraggingFiles;t.getIsDraggingFiles=e=>(0,t.getUploadState)(e).numDraggingFiles>0;t.getIsDropzoneActive=e=>(0,t.getUploadState)(e).isActive;t.getCurrentlyActivePersistentDropzone=e=>(0,t.getUploadState)(e).currentlyActivePersistentDropzone;t.getCurrentlyActiveOuterDropzone=e=>(0,t.getUploadState)(e).currentlyActiveDropzone;t.isInternalTransfer=e=>(0,t.getUploadState)(e).isInternalTransfer,t.isUploadInProgress=(0,s.createSelector)(t.getFileList,e=>e.some(e=>e.status===o.FileStatusType.UPLOADING||e.status===o.FileStatusType.PENDING)),t.getPendingUploads=(0,s.createSelector)(t.getFileList,e=>e.filter(e=>e.status===o.FileStatusType.UPLOADING||e.status===o.FileStatusType.PENDING));t.getConfirmedFSWs=e=>(0,t.getUploadState)(e).confirmedFSWs;t.getConfirmedFSWBatchIds=e=>(0,t.getUploadState)(e).confirmedFSWBatchIds;t.hasOverquotaError=e=>(0,t.getUploadState)(e).hasOverquotaError;t.allUploadsComplete=e=>(0,t.getUploadState)(e).allUploadsComplete;t.getTeamAccessLevelsDefinition=e=>(0,t.getUploadState)(e).teamAccessLevelsDefinition;t.getTeamAccessLevel=(e,s)=>(0,t.getUploadState)(e).teamAccessLevelsDefinition.getTeamAccessLevel(s);t.getTargetSurface=e=>(0,t.getUploadState)(e).targetSurface;t.getOverQuotaStatus=e=>(0,t.getUploadState)(e).overQuotaStatus;t.getOverQuotaDetails=e=>(0,t.getUploadState)(e).overQuotaDetails;t.getUploadModalType=e=>(0,t.getUploadState)(e).uploadModalType;t.getIsUploadModalOpen=e=>null!==(0,t.getUploadState)(e).uploadModalType;t.getLastFileUploadMethod=e=>(0,t.getUploadState)(e).lastFileUploadMethod;t.getLastSingleFileUploadOptional=e=>{var t;return null===(t=e[a.UPLOAD_NAMESPACE_KEY])||void 0===t?void 0:t.lastSingleFileUpload}}));var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,s,i){void 0===i&&(i=s);var a=Object.getOwnPropertyDescriptor(t,s);a&&("get"in a?t.__esModule:!a.writable&&!a.configurable)||(a={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,i,a)}:function(e,t,s,i){void 0===i&&(i=s),e[i]=t[s]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var s in e)"default"!==s&&Object.prototype.hasOwnProperty.call(e,s)&&__createBinding(t,e,s);return __setModuleDefault(t,e),t};define("metaserver/static/js/extensions/split_share_button",["require","exports","metaserver/static/js/async/loadable"],(function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SplitShareButton=void 0,t.SplitShareButton=(0,s.Loadable)({loader:()=>new Promise((t,s)=>{e(["metaserver/static/js/extensions/split_share_button_component"],t,s)}).then(__importStar).then(({SplitShareButton:e})=>e)})})),define("metaserver/static/js/files_view/column_helpers",["require","exports","metaserver/static/js/clean/immutability_helper"],(function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.swapColumns=void 0,t.swapColumns=function(e,t,i){const a=e.map(e=>e.sortField).indexOf(t),r=e.map(e=>e.sortField).indexOf(i);if(a===r||-1===a||-1===r)return e;const o=e[a],n=e[r];return(0,s.splice)((0,s.splice)(e,a,1,n),r,1,o)}})),define("metaserver/static/js/files_view/column_manager",["require","exports","tslib","lodash","react","metaserver/static/js/hooks/usePrevious","spectrum/dimensions/index","metaserver/static/js/clean/immutability_helper","metaserver/static/js/files_view/column_helpers","metaserver/static/js/files_view/resizing/column_size_context","metaserver/static/js/files_view/sort_types","metaserver/static/js/files_view/view_type"],(function(e,t,s,i,a,r,o,n,l,c,d,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ColumnManagerComponent=t.ColumnManager=void 0,i=s.__importStar(i),a=s.__importDefault(a);t.ColumnManager=e=>{var{responsiveContainer:i}=e,r=s.__rest(e,["responsiveContainer"]);return(r.isMatchedLarge||r.isMatchedMedium)&&i?a.default.createElement(o.Dimensions,null,({width:e})=>{const s=Object.assign({},r);return e&&(s.isMatchedLarge=e>824,s.isMatchedMedium=!s.isMatchedLarge&&e>588),a.default.createElement(t.ColumnManagerComponent,Object.assign({},s,{containerWidth:e}))}):a.default.createElement(t.ColumnManagerComponent,Object.assign({},r))},t.ColumnManager.displayName="ColumnManager";t.ColumnManagerComponent=e=>{const[t,s]=a.default.useState(()=>e.preferredColumns?S(e):(function(e){return e.columns.slice(0,T(e))})(e)),[o,p]=a.default.useState(e.viewType),[g,h]=a.default.useState(()=>w(t)),_=a.default.useRef(),m=a.default.useRef(),f=(0,r.usePrevious)(e);function S(e){const{currentSort:t,viewType:s,preferredColumns:i}=e;let a=i;if(s===u.ViewType.Grid||s===u.ViewType.LargeGrid){const e=a.find(e=>e.sortField===t.sortField);a=[e||a[0]]}else a=a.slice(0,T(e));return a}function v(t,i=!1){const a=w(t);s(t),h(a),i?_.current=setTimeout(()=>{E(),e.onCanDisplayFolderSizesChanged(a)}):e.onCanDisplayFolderSizesChanged(a)}a.default.useEffect(()=>{if(!f)return void e.onCanDisplayFolderSizesChanged(g);if(e.viewType!==f.viewType&&p(e.viewType),e.preferredColumns){const s=S(e);return void(i.isEqual(s,t)||v(s,!0))}const{columns:a,currentSort:r}=e,o=T(f),n=T(e);if(i.isEqual(e.columns,f.columns)&&e.viewType===f.viewType){if(n<o)v(t.slice(0,n),!0);else if(n>o){const e=n-t.length,s=i.filter(a,e=>!i.find(t,t=>t.sortField===e.sortField)).slice(0,e);v([...t,...s],!0)}}else if(1===n&&a.length&&r){const{viewType:t,viewTypeColumns:i}=e,o=i?i[u.ViewType.Grid]:void 0;switch(t){case u.ViewType.List:case u.ViewType.CondensedList:v([a[0]],!0);break;case u.ViewType.Grid:case u.ViewType.LargeGrid:if(o){const i=a.find(e=>e.sortField===r.sortField)||a[0];(function(t,i,a){y();const r=w(t);s(t),h(r),m.current=setTimeout(()=>{y(),e.onColumnsChanged({columns:i,viewType:a,canDisplayFolderSizes:r})})})([i],(0,l.swapColumns)(o,o[0].sortField,i.sortField),t)}}}else v(a.slice(0,n),!0)},[e.columns,e.viewType,e.isMatchedLarge,e.isMatchedMedium,e.numVisibleColumns,e.preferredColumns]);const E=()=>{_.current&&(clearTimeout(_.current),_.current=void 0)};function y(){m.current&&(clearTimeout(m.current),m.current=void 0)}function T(e){const{isMatchedLarge:t,isMatchedMedium:s,viewType:i,numVisibleColumns:a,isMoreColumnsEnabled:r,isSearchMode:o}=e;switch(i){case u.ViewType.Grid:case u.ViewType.LargeGrid:return 1;case u.ViewType.List:case u.ViewType.CondensedList:default:return r?o?3:a||3:t?3:s?2:1}}function w(e){return e.some(e=>e.sortField===d.SortField.SIZE)}const{children:b,containerWidth:F}=e;if(!b)return null;let C=b;return"function"==typeof b&&(C=b({visibleColumns:t,canDisplayFolderSizes:g,handleSelection:function(s,i){const{isMoreColumnsEnabled:a,preferredColumns:r,viewType:o}=e;a&&r&&(o===u.ViewType.List||o===u.ViewType.CondensedList)?(function(s,i,a){const{onColumnsChanged:r,viewType:o}=e,l=t.indexOf(s),c=t.includes(i)?t.indexOf(i):t.length-1,d=l>=0?(0,n.splice)(t,l,1):(0,n.splice)(t,c+1,0,s);v(d),r({columns:[...d,...a.filter(e=>!d.includes(e))],viewType:o,canDisplayFolderSizes:w(d),numVisibleColumns:d.length})})(s,i,r):(function(s,i){const{viewType:a,onColumnsChanged:r,viewTypeColumns:o,preferredColumns:c}=e,p=c||(o?o[u.ViewType.List]:void 0),g=o?o[u.ViewType.Grid]:void 0;if(p&&g){const e=t.indexOf(i);if(-1===e||t.includes(s))v(t);else{const o=(0,n.splice)(t,e,1,s);v(o);const h=w(o);a===u.ViewType.List||a===u.ViewType.CondensedList?r({columns:(0,l.swapColumns)(p,i.sortField,s.sortField),viewType:u.ViewType.List,canDisplayFolderSizes:h}):(c||r({columns:(0,l.swapColumns)(g,i.sortField,s.sortField),viewType:a,canDisplayFolderSizes:h}),s.sortField!==d.SortField.FILENAME&&r({columns:(0,l.swapColumns)(p,p[1].sortField,s.sortField),viewType:u.ViewType.List,canDisplayFolderSizes:h}))}}})(s,i)},handleReorder:function(s,i){const{preferredColumns:a,onColumnsChanged:r,viewType:o}=e;if(!a||!t[s]||!t[i])return;const l=(0,n.splice)((0,n.splice)(t,i,1),s,0,t[i]);v(l),r({columns:[...l,...a.filter(e=>!l.includes(e))],viewType:o,canDisplayFolderSizes:w(l),numVisibleColumns:l.length})},containerWidth:F})),a.default.createElement(c.ColumnResizingProvider,{storageSetting:e.columnResizeStorageSetting||c.noStorage,columnResizingEnabled:!!e.isMoreColumnsEnabled,scrollContainerWidth:e.scrollContainerWidth,visibleColumns:t,visibleColumnsViewChange:o,isSearchMode:e.isSearchMode},C)}})),define("metaserver/static/js/files_view/column_headers/column_header_cell",["require","exports","tslib","classnames","react","dig-components/buttons","dig-components/icons","dig-components/icons/src","dig-components/typography","spectrum/table/index","metaserver/static/js/files_view/column_headers/draggable_reorder","metaserver/static/js/files_view/resizing/column_size_context","metaserver/static/js/files_view/sort_types","focus-visible"],(function(e,t,s,i,a,r,o,n,l,c,d,u,p){"use strict";function g(e){return e===p.SortDirection.ASCENDING?"ascending":e===p.SortDirection.DESCENDING?"descending":"none"}Object.defineProperty(t,"__esModule",{value:!0}),t.ColumnHeaderCell=void 0,i=s.__importDefault(i),a=s.__importDefault(a),n=s.__importStar(n);const h=(e,t)=>s=>{s.getModifierState("Alt")&&"ArrowLeft"===s.key&&e(),s.getModifierState("Alt")&&"ArrowRight"===s.key&&t()},_=({column:e,sortDirection:t,setSort:s,onDecreaseSize:c,onIncreaseSize:d})=>{const{columnResizingEnabled:g}=a.default.useContext(u.ColumnResizingContext);return e.isSortDisabled||e.isSortOrderOptionDisabled?a.default.createElement(l.Text,{variant:"label",isBold:void 0!==t,className:(0,i.default)("files-view-column-header-unclickable","files-view-column-header-text",{"column-resizing-enabled":g}),tabIndex:g?0:void 0,onKeyDown:h(c,d)},e.label):a.default.createElement(r.Button,{variant:"transparent",hasNoUnderline:!0,onClick:()=>s(e.sortField,(function(e){switch(e){case p.SortDirection.ASCENDING:return p.SortDirection.DESCENDING;default:return p.SortDirection.ASCENDING}})(t)),className:(0,i.default)("files-view-column-header-text",{"column-resizing-enabled":g}),onKeyDown:h(c,d)},a.default.createElement(l.Text,{variant:"label",isBold:void 0!==t},e.label),t&&a.default.createElement(o.UIIcon,{src:t===p.SortDirection.ASCENDING?n.ArrowUpLine:n.ArrowDownLine,size:"small",className:"files-view-column-header-sort-button"}))};_.displayName="ColumnHeaderCellContent",_.displayName="ColumnHeaderCellContent";const m=e=>{var{index:t,className:r}=e,o=s.__rest(e,["index","className"]);const n=(0,d.useDraggableReorder)(t),{className:l}=n,u=s.__rest(n,["className"]);return a.default.createElement(c.TableHeadCell,Object.assign({className:(0,i.default)(r,l)},o,u))};m.displayName="DraggableTableHeadCell";t.ColumnHeaderCell=({children:e,column:t,index:s,role:i,setSort:r,sortDirection:o,canMove:n,onDecreaseSize:l,onIncreaseSize:d})=>{const p=a.default.useContext(u.ColumnResizingContext);let h;p.columnResizingEnabled&&(h=p.columnSizes[t.sortField]);const f=void 0===h?{}:{width:h,minWidth:h,maxWidth:h},S={key:s,role:i,scope:"col","aria-sort":g(o),className:"files-view-column-header-table-cell",style:f,children:a.default.createElement(a.default.Fragment,null,a.default.createElement(_,{column:t,sortDirection:o,setSort:r,onDecreaseSize:l,onIncreaseSize:d}),e)};return n?a.default.createElement(m,Object.assign({index:s},S)):a.default.createElement(c.TableHeadCell,Object.assign({},S))},t.ColumnHeaderCell.displayName="ColumnHeaderCell",t.ColumnHeaderCell.displayName="ColumnHeaderCell"})),define("metaserver/static/js/files_view/column_headers/column_header_menu",["require","exports","tslib","classnames","react","react-redux","dig-components/buttons","dig-components/icons","dig-components/icons/src","dig-components/menu","metaserver/static/js/core/i18n","metaserver/static/js/browse/data/selectors","metaserver/static/js/tagging/experiments","metaserver/static/js/files_view/column_headers/tags_column_tooltip/index"],(function(e,t,s,i,a,r,o,n,l,c,d,u,p,g){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ColumnHeaderMenu=t.AvailableMoves=void 0,i=s.__importDefault(i),a=s.__importDefault(a);var h;(function(e){e[e.NONE=0]="NONE",e[e.LEFT=1]="LEFT",e[e.RIGHT=2]="RIGHT",e[e.BOTH=3]="BOTH"})(h=t.AvailableMoves||(t.AvailableMoves={}));t.ColumnHeaderMenu=({columns:e,index:t,onSelection:s,onMenuOpen:_,selectedColumns:m,title:f,allowUnchecking:S,availableMoves:v,isSearchMode:E})=>{const y=[h.BOTH,h.LEFT].includes(v),T=[h.BOTH,h.RIGHT].includes(v),w=y||T,[b,F]=a.default.useState(!1),C=(0,r.useSelector)(u.manualTaggingVariant),I=0===t&&!E&&(0,p.isTagsColumnOnBrowseEnabled)(C);return a.default.createElement(c.Menu.Wrapper,{onSelection:e=>s(t,e),onToggle:({isOpen:e})=>e&&_(t,m[t].popoverTriggerLabel)},({getContentProps:t,getTriggerProps:s,triggerRef:r})=>a.default.createElement(a.default.Fragment,null,a.default.createElement(o.IconButton,Object.assign({},s(),{variant:"transparent",size:"small","aria-label":d.intl.formatMessage({id:"+D26UW",defaultMessage:"Change column"}),className:(0,i.default)("files-view-column-header-menu-button",{"files-view-column-header-menu-open":t().open||b}),"data-testid":"files-view-column-header-menu-trigger"}),a.default.createElement(n.UIIcon,{src:l.ChevronDownLine,size:"small"})),a.default.createElement(c.Menu.Content,Object.assign({},t(),{placement:"bottom-end"}),a.default.createElement(c.Menu.Segment,{withLabel:f},e.map(e=>a.default.createElement(c.Menu.SelectItem,{"aria-label":e.popoverTriggerLabel,key:e.popoverTriggerLabel,value:{type:"ColumnSelection",payload:e},selected:m.includes(e),disabled:e.isLocked||!S&&m.includes(e)},e.label))),w&&a.default.createElement(c.Menu.Segment,{withLabel:d.intl.formatMessage({id:"Yzabjr",defaultMessage:"Adjust"})},a.default.createElement(c.Menu.Submenu,{withTriggerContent:d.intl.formatMessage({id:"qKy/7I",defaultMessage:"Column order"})},a.default.createElement(c.Menu.Segment,null,a.default.createElement(c.Menu.ActionItem,{value:{type:"ColumnOrderSelection",payload:"left"},disabled:!y},d.intl.formatMessage({id:"obFNpg",defaultMessage:"Move left"})),a.default.createElement(c.Menu.ActionItem,{value:{type:"ColumnOrderSelection",payload:"right"},disabled:!T},d.intl.formatMessage({id:"7QBrxY",defaultMessage:"Move right"})))))),I&&a.default.createElement(g.TagsColumnTooltip,{showTooltip:b,setShowTooltip:F,triggerRef:r})))},t.ColumnHeaderMenu.displayName="ColumnHeaderMenu"})),define("metaserver/static/js/files_view/column_headers/dig_column_header",["require","exports","tslib","classnames","react","dig-components/controls","spectrum/table/index","metaserver/static/js/files_view/column_headers/column_header_cell","metaserver/static/js/files_view/column_headers/column_header_menu","metaserver/static/js/files_view/column_headers/draggable_reorder","metaserver/static/js/files_view/column_headers/resize_handle","metaserver/static/js/files_view/constants","metaserver/static/js/files_view/fixed_table_head","metaserver/static/js/files_view/resizing/column_size_context","metaserver/static/js/files_view/sticky_table_head","metaserver/static/js/files_view/sort_types","metaserver/static/js/files_view/view_type","metaserver/static/js/core/i18n","metaserver/static/js/campaigns/campaigns_element_id_enum"],(function(e,t,s,i,a,r,o,n,l,c,d,u,p,g,h,_,m,f,S){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ColumnHeader=void 0,i=s.__importDefault(i),a=s.__importDefault(a);const v=(e,t)=>{switch(e){case m.ViewType.Grid:case m.ViewType.LargeGrid:return f.intl.formatMessage({id:"iWzO4p",defaultMessage:"Group by"});case m.ViewType.List:default:return t?f.intl.formatMessage({id:"t3Jo9w",defaultMessage:"Sort by"}):f.intl.formatMessage({id:"IUsgJf",defaultMessage:"Show"})}};t.ColumnHeader=({columnFlex:e,items:t,isCompactMode:s,isSelectMode:m,currentSort:E,selectAllCheckboxState:y="unchecked",showSelectAllCheckbox:T=!0,stickyOffsetHeight:w,stickyOffsetTop:b,columns:F,visibleColumns:C,viewType:I,isSearchMode:R,isSearchTopRightSortEnabled:D,presentationOnly:O,variant:A="fixed",onMenuOpen:M,onSelectAll:L,onDeselectAll:P,onReorder:N,onSort:j,onSelection:x,isMoreColumnsEnabled:k,disableResizing:U})=>{const{resizeColumn:H,resizeColumnToDefault:W,columnSizes:V,columnResizingEnabled:B}=a.default.useContext(g.ColumnResizingContext),q=B&&!U,[G,Q]=a.default.useState(!1),[z,K]=a.default.useState(!1),Y={onMouseEnter:()=>K(!0),onMouseLeave:()=>K(!1)},X=R?u.SEARCH_LIST_VIEW_SORT_ENABLED_COLUMNS:F,Z=X.filter(e=>!e.isLocked),J=!m&&!z&&!s,$=(e,t)=>{if("ColumnSelection"===t.type&&(function(e){return"string"==typeof(null==e?void 0:e.popoverTriggerLabel)})(t.payload)){const s=C[e],i=t.payload;x(i,s,e),R?j(i.sortField,_.SortDirection.DESCENDING):k?C.includes(i)&&(null==E?void 0:E.sortField)===i.sortField&&j(C[0].sortField,_.SortDirection.ASCENDING):(null==E?void 0:E.sortField)===s.sortField&&(i.isSortOrderOptionDisabled?j(C[0].sortField,_.SortDirection.ASCENDING):j(i.sortField,E.sortDirection||_.SortDirection.ASCENDING))}else"ColumnOrderSelection"===t.type&&("right"===t.payload&&e<C.length-1?N(e+1,e):"left"===t.payload&&e>1&&N(e-1,e))},ee=C.map((e,s)=>{const i=(e=>{if(!k)return l.AvailableMoves.NONE;const t=C[e];if(!t||t.isLocked)return l.AvailableMoves.NONE;const s=0!==e&&!C[e-1].isLocked,i=e!==C.length-1&&!C[e+1].isLocked;return s&&i?l.AvailableMoves.BOTH:s?l.AvailableMoves.LEFT:i?l.AvailableMoves.RIGHT:l.AvailableMoves.NONE})(s),r=R&&D,o=k||!(e.isLocked||e.isSortDisabled);return a.default.createElement(n.ColumnHeaderCell,{key:e.popoverTriggerLabel,column:e,index:s,setSort:j,role:O?"presentation":"columnheader",sortDirection:r||(null==E?void 0:E.sortField)!==e.sortField?void 0:E.sortDirection,canMove:i!==l.AvailableMoves.NONE,onIncreaseSize:()=>H(e.sortField,V[e.sortField]+4),onDecreaseSize:()=>H(e.sortField,V[e.sortField]-4)},!r&&o&&a.default.createElement(l.ColumnHeaderMenu,{columns:k?X:Z,index:s,onMenuOpen:M,onSelection:$,selectedColumns:C,title:v(I,!!R),allowUnchecking:k,availableMoves:i,isSearchMode:R}),q&&void 0!==H&&void 0!==W&&void 0!==E&&a.default.createElement(d.ResizeHandle,{onResize:t=>{Q(!0),H(e.sortField,t)},onResizeToDefault:()=>W(e.sortField),onColumnResizeEnd:()=>Q(!1),sortField:e.sortField,items:t}))}),te=a.default.createElement(c.DraggableReorderProvider,{onReorder:N},a.default.createElement(o.TableHeadCell,{className:"files-view-column-header-table-cell brws-checkbox-cell",key:"checkbox-cell",role:O?"presentation":"columnheader",scope:"col"},a.default.createElement("div",{className:"brws-vertically-center"},T&&!J?a.default.createElement(r.Checkbox,{className:(0,i.default)("brws-checkbox",{"brws-checkbox-checked":"checked"===y}),checked:"checked"===y,isIndeterminate:"mixed"===y,onChange:e=>{"unchecked"===y?L():P()},"aria-label":f.intl.formatMessage({id:"YzMs/g",defaultMessage:"Select all"})}):null)),ee),se={"data-campaigns-element-id":S.CampaignsElementIdEnum.BROWSE_VIEW_LIST_HEAD};return"default"===A?a.default.createElement(o.TableHead,Object.assign({className:(0,i.default)("brws-column-header",{"header-column-resize":q,"column-header-is-resizing":G})},Y,{"data-testid":"table-head"},se),te):"fixed"===A?a.default.createElement(p.FixedTableHead,Object.assign({offsetHeight:w},Y,{"data-testid":"fixed-table-head"},se),te):"sticky-native"===A?a.default.createElement(o.TableHead,Object.assign({className:(0,i.default)("brws-column-header brws-column-header--sticky",{"header-column-resize":q,"column-header-is-resizing":G}),style:{top:b}},Y,{"data-testid":"sticky-native-table-head"},se),te):a.default.createElement(h.StickyTableHead,Object.assign({columnFlex:e,offsetHeight:w,offsetTop:b,className:(0,i.default)("brws-column-header",{"header-column-resize":q,"column-header-is-resizing":G})},Y,{"data-testid":"sticky-table-head"},se),te)},t.ColumnHeader.displayName="ColumnHeader",t.ColumnHeader.displayName="ColumnHeader"})),define("metaserver/static/js/files_view/column_headers/resize_handle",["require","exports","tslib","react","metaserver/static/js/clean/em_string","metaserver/static/js/browse/models","metaserver/static/js/files_view/util","metaserver/static/js/files_view/sort_types","metaserver/static/js/files_view/rows/cells/async_folder_size"],(function(e,t,s,i,a,r,o,n,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ResizeHandle=t.SCROLLBAR_WIDTH=void 0,i=s.__importDefault(i);t.SCROLLBAR_WIDTH=16;const c=e=>14*new a.Emstring(e).length;t.ResizeHandle=({items:e,onResize:s,onResizeToDefault:a,onColumnResizeEnd:d,sortField:u})=>{const p=i.default.useRef({type:"not_resizing"}),[g,h]=i.default.useState();i.default.useRef(s).current=s;const _=i.default.useCallback(e=>{if("resizing"===p.current.type){const{startingPageX:t,startingWidth:i}=p.current,a=i-(t-e.pageX);a!==i&&s(a)}},[]),m=i.default.useCallback(e=>{window.removeEventListener("mousemove",_),window.removeEventListener("mouseup",m),p.current={type:"not_resizing"},h(void 0),d()},[]),f=e=>{e.preventDefault(),window.document.removeEventListener("click",f,!0)},S=()=>{let t=0;null==e||e.forEach(e=>{if(e instanceof r.File)switch(u){case n.SortField.CATEGORY:t=Math.max(c(r.File.getCategoryDescription(e)),t);break;case n.SortField.EXTENSION:t=Math.max(c(r.File.getExtension(e)),t);break;case n.SortField.FILENAME:t=Math.max(c((0,o.getFilename)(e)),t);break;case n.SortField.MODIFIED:case n.SortField.RELEVANCE:t=Math.max(c(e.is_dir?"--":e.ago),t);break;case n.SortField.SIZE:t=Math.max(c(e.is_dir?"--":e.size),t)}else if(e instanceof r.FileSharedWithMe)switch(u){case n.SortField.FILENAME:t=Math.max(c((0,o.getFilename)(e)),t);break;case n.SortField.MODIFIED:case n.SortField.RELEVANCE:t=Math.max(c(e.agoFromLastActionByUserTs||e.ago),t);break;case n.SortField.SIZE:t=Math.max(c(e.is_cloud_doc&&(0,l.isCloudDocProviderStored)(e)?"--":e.size),t)}});let s=30;return u===n.SortField.FILENAME&&(s=110),t>0?t+s:0};return i.default.createElement("div",{className:"resize-drag-handle",onMouseDown:e=>{e.preventDefault(),e.stopPropagation(),window.addEventListener("mousemove",_),window.addEventListener("mouseup",m);const s=window.innerHeight-e.currentTarget.getBoundingClientRect().top-4-t.SCROLLBAR_WIDTH;p.current={type:"resizing",startingWidth:e.currentTarget.parentElement.getBoundingClientRect().width,startingPageX:e.pageX},h(s),window.document.addEventListener("click",f,!0)},onDoubleClick:()=>{if(u===n.SortField.SHARED_WITH)a();else{const e=S();e>0?s(e):a()}},"data-testid":"resize-handle"},void 0!==g&&i.default.createElement("div",{className:"resize-vertical-focus-line",style:{height:`${g}px`}}))},t.ResizeHandle.displayName="ResizeHandle",t.ResizeHandle.displayName="ResizeHandle"})),define("metaserver/static/js/files_view/column_headers/draggable_reorder",["require","exports","tslib","classnames","react"],(function(e,t,s,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.useDraggableReorder=t.DraggableReorderProvider=void 0,i=s.__importDefault(i);const r=(a=s.__importStar(a)).default.createContext({draggedIndex:null,setDraggedIndex:()=>{},onReorder:()=>{}});t.DraggableReorderProvider=({onReorder:e,children:t})=>{const[s,i]=(0,a.useState)(null);return a.default.createElement(r.Provider,{value:{draggedIndex:s,setDraggedIndex:i,onReorder:e}},t)},t.DraggableReorderProvider.displayName="DraggableReorderProvider",t.DraggableReorderProvider.displayName="DraggableReorderProvider";t.useDraggableReorder=e=>{const{draggedIndex:t,setDraggedIndex:s,onReorder:o}=(0,a.useContext)(r),[n,l]=(0,a.useState)(!1),c=(0,a.useRef)(null),d=t===e,u=null!==t&&!d;return{draggable:!0,onDragStart:(0,a.useCallback)(t=>{t.dataTransfer&&(t.dataTransfer.effectAllowed="move",t.dataTransfer.dropEffect="move"),s(e)},[e]),onDragEnd:(0,a.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),s(null)},[]),onDragEnter:(0,a.useCallback)(e=>{u&&(e.preventDefault(),e.stopPropagation(),l(!0),c.current=e.target)},[u]),onDragLeave:(0,a.useCallback)(e=>{e.target===c.current&&(e.preventDefault(),e.stopPropagation(),l(!1))},[]),onDrop:(0,a.useCallback)(i=>{u&&null!==t&&(i.preventDefault(),i.stopPropagation(),s(null),l(!1),o(e,t))},[e,u,t,o]),className:(0,i.default)("draggable-reorder",{"draggable-reorder--dragging":d,"draggable-reorder--dragged-over-from-right":n&&null!==t&&t-e>0,"draggable-reorder--dragged-over-from-left":n&&null!==t&&t-e<0})}}})),define("metaserver/static/js/files_view/column_headers/tags_column_tooltip/component",["require","exports","tslib","react","react-intl","dig-components/buttons","dig-components/click_outside","dig-components/typography","dig-components/tooltips","metaserver/static/js/files_view/resizing/column_size_context","metaserver/static/js/files_view/sort_types","metaserver/static/js/files_view/column_headers/tags_column_tooltip/tracker"],(function(e,t,s,i,a,r,o,n,l,c,d,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TagsColumnTooltip=void 0,i=s.__importDefault(i),t.TagsColumnTooltip=i.default.memo(({showTooltip:e,setShowTooltip:t,triggerRef:s})=>{const[p,g]=i.default.useState("bottom"),h=(0,a.useIntl)(),{columnSizes:_}=i.default.useContext(c.ColumnResizingContext),m=i.default.useRef(null),f=_[d.SortField.FILENAME];i.default.useEffect(()=>{var e;null===(e=null==m?void 0:m.current)||void 0===e||e.update()},[f]),i.default.useEffect(()=>{(0,u.fetchTagsColumnTooltipSeen)().then(e=>t(!e))},[t]);const S=()=>{t(!1),g("bottom")};return i.default.createElement(o.ClickOutside,{isActive:e,onClickOutside:S},i.default.createElement(l.Tooltip.Control,{variant:"rich",open:e,ref:m,triggerRef:s,auto:!0,placement:p,onChangePlacement:e=>g(e),onDisplayed:()=>{(0,u.setTagsColumnTooltipSeen)()}},i.default.createElement(n.Title,{size:"standard",inverse:!0},h.formatMessage({id:"+NJwpB",defaultMessage:"Show tags here"})),i.default.createElement(n.Text,{tagName:"p",color:"standard",inverse:!0},h.formatMessage({id:"7uh+Vn",defaultMessage:"To see all these files’ tags at a glance, just click the arrow and choose “tags” from the list."})),i.default.createElement("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end",marginTop:"var(--spacing__unit--2)"}},i.default.createElement(r.Button,{variant:"outline",inverse:!0,onClick:S,autoFocus:!0},h.formatMessage({id:"5LJHki",defaultMessage:"Got it"})))))}),t.TagsColumnTooltip.displayName="TagsColumnTooltip"})),define("metaserver/static/js/files_view/column_headers/tags_column_tooltip/index",["require","exports","metaserver/static/js/files_view/column_headers/tags_column_tooltip/component"],(function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TagsColumnTooltip=void 0,Object.defineProperty(t,"TagsColumnTooltip",{enumerable:!0,get:function(){return s.TagsColumnTooltip}})})),define("metaserver/static/js/files_view/column_headers/tags_column_tooltip/tracker",["require","exports","tslib","metaserver/static/js/growth/user_action/tracker","metaserver/static/js/api_v2/default_user_client","metaserver/static/js/clean/viewer"],(function(e,t,s,i,a,r){"use strict";var o;Object.defineProperty(t,"__esModule",{value:!0}),t.setTagsColumnTooltipSeen=t.fetchTagsColumnTooltipSeen=void 0,(function(e){e.TAGS_COLUMN_TOOLTIP_SEEN="tags_column_tooltip_seen"})(o||(o={}));class n extends i.GrowthUserActionTracker{constructor(){super(...arguments),this.project="manual_tagging"}}t.fetchTagsColumnTooltipSeen=function(){var e;return s.__awaiter(this,void 0,void 0,(function*(){const t=r.Viewer.get_viewer(),s=null!==(e=t.work_user)&&void 0!==e?e:t.personal_user;if(!s)return!0;const i=new a.DefaultUserApiV2Client(s),l=new n(s.id);return(yield i.ns("growth").rpc("performed_user_action",{project:l.project,action:o.TAGS_COLUMN_TOOLTIP_SEEN},{})).has_performed}))},t.setTagsColumnTooltipSeen=function(){var e;return s.__awaiter(this,void 0,void 0,(function*(){const t=r.Viewer.get_viewer(),s=null!==(e=t.work_user)&&void 0!==e?e:t.personal_user;if(s)return new n(s.id).track(o.TAGS_COLUMN_TOOLTIP_SEEN)}))}})),define("metaserver/static/js/files_view/data/selectors/constants",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CONDENSED_LISTVIEW_ICON_SIZE_PX=void 0,t.CONDENSED_LISTVIEW_ICON_SIZE_PX=32})),define("metaserver/static/js/files_view/resizing/column_size_context",["require","exports","tslib","react","lodash","metaserver/static/js/core/browser_detection","metaserver/static/js/files_view/constants","metaserver/static/js/files_view/sort_types","lodash"],(function(e,t,s,i,a,r,o,n,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ColumnResizingProvider=t.localStorage=t.noStorage=t.ColumnResizingContext=void 0,i=s.__importDefault(i),l=s.__importStar(l);const c={columnResizingEnabled:!1,columnSizes:o.COLUMN_DEFAULT_WIDTHS,resizeColumn:function(e,t){},resizeColumnToDefault:function(e){}};function d(e,t){const s=o.COLUMN_MIN_WIDTHS[t],i=o.COLUMN_MAX_WIDTHS[t];return Math.min(Math.max(e,s),i)}function u(e){return l.mapValues(e,(e,t)=>d(e,t))}t.ColumnResizingContext=i.default.createContext(c);const p=(0,a.debounce)((function(e,t){window.localStorage.setItem(e,JSON.stringify(t))}));t.noStorage={type:"no_storage"},t.localStorage={type:"local_storage",localStorageKey:"dbx_files_view_column_sizes"};const g=e=>{const t=i.default.useRef(e);return t.current=e,t};t.ColumnResizingProvider=({children:e,storageSetting:s,columnResizingEnabled:a,scrollContainerWidth:c,visibleColumns:h,visibleColumnsViewChange:_,isSearchMode:m})=>{const[f,S]=i.default.useState(()=>{switch(s.type){case"no_storage":return o.COLUMN_DEFAULT_WIDTHS;case"local_storage":return(function(e){try{const t=window.localStorage.getItem(e),s=JSON.parse(t);return l.mapValues(o.COLUMN_DEFAULT_WIDTHS,(e,t)=>{const i=s[t];return"number"==typeof i?i:e})}catch(e){return o.COLUMN_DEFAULT_WIDTHS}})(s.localStorageKey)}}),v=g(f),E=g(c),y=i.default.useRef("UNFROZEN"),T=i.default.useRef(r.safari);i.default.useEffect(()=>{if(a&&c&&c>0){if(T.current&&!m)return void(T.current=!1);const e=w(f),t="UNFROZEN"===y.current||"OVERFLOW"===y.current&&c>e||"UNDERFLOW"===y.current&&c<e;e>0&&c!==e&&t&&b(n.SortField.FILENAME,c-(e-f[n.SortField.FILENAME]),"DYNAMIC")}},[c,_]);const w=e=>{let t=0;return h.map(e=>e.sortField).forEach(s=>{t+=e[s]}),t},b=i.default.useCallback((e,t,i="MANUAL")=>{if(v.current[e]!==t){const a=Object.assign(Object.assign({},v.current),{[e]:d(t,e)});S(a),"local_storage"===s.type&&p(s.localStorageKey,a),"MANUAL"===i&&E.current?y.current=w(a)>E.current?"OVERFLOW":"UNDERFLOW":"DYNAMIC"===i&&(y.current="UNFROZEN")}},[s,v,E]),F=i.default.useCallback(e=>{const t=o.COLUMN_DEFAULT_WIDTHS[e];b(e,t)},[b]),C=i.default.useMemo(()=>({columnSizes:u(f),resizeColumn:b,resizeColumnToDefault:F,columnResizingEnabled:a}),[f,b,F,a]);return i.default.createElement(t.ColumnResizingContext.Provider,{value:C},e)},t.ColumnResizingProvider.displayName="ColumnResizingProvider",t.ColumnResizingProvider.displayName="ColumnResizingProvider"})),define("metaserver/static/js/files_view/contexts/files_view_context",["require","exports","tslib","react","react-redux","metaserver/static/js/files_view/contexts/callback_context","metaserver/static/js/files_view/contexts/file_thumb_store","metaserver/static/js/files_view/view_type","metaserver/static/js/files_view/data/selectors/instance_selectors","metaserver/static/js/files_view/file_name/renaming_bar_api_v2","metaserver/static/js/files_view/file_name/renaming_bar_modal_overlay","metaserver/static/js/files_view/contexts/override_context"],(function(e,t,s,i,a,r,o,n,l,c,d,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FilesViewContextProvider=void 0,i=s.__importStar(i);t.FilesViewContextProvider=({children:e,props:t,instanceId:p})=>{const{items:g,path:h,user:_,fileHasAutomatedRuleMap:m,expNamingConventionsUploadRenamingBar:f,expNamingConventionsRenamingBarExistingNC:S}=t,v=(0,a.useSelector)((e=>t=>(0,l.selectViewType)(t,{instanceId:e}))(p)),[E,y]=i.useState(!1),[T,w]=i.useState(!1),[b,F]=i.useState(void 0),[C,I]=i.useState(void 0),[R,D]=i.useState(!1),O=null==m?void 0:m.get(h);return i.useEffect(()=>{s.__awaiter(void 0,void 0,void 0,(function*(){const e=yield(0,c.getRules)(_.id,h),t=!!e.rules_struct_v2,s="naming_conventions"===O,i=!!e.rules_struct_v2&&!!e.rules_struct_v2.show_renaming_bar,a=Boolean(t&&e.rules_struct&&!(0,d.isDefaultRules)(e.rules_struct));let{should_show:r,renaming_bar_type:o}=yield(0,c.renamingBarShouldShow)(_.id,t,i);a&&!S&&(r=!1),y(r),F(o),I(e.rules_struct_v2),f&&(!r||t||s||w(!0))}))},[_.id,h,O,f,S]),i.createElement(r.FilesViewCallbackContextProvider,{props:Object.assign(Object.assign({},t),{shouldShowRenamingBar:E,shouldShowUploadRenamingBar:T,isRenamingBarDisabled:R,setRenamingBarDisabled:D,renamingBarType:b,namingConventionsRules:C})},i.createElement(o.ThumbStoreProvider,{shouldPrewarm:v!==n.ViewType.Grid,items:g,path:h},i.createElement(u.FilesViewOverrideContext.Provider,{value:t.overrides||{}},e)))},t.FilesViewContextProvider.displayName="FilesViewContextProvider"})),define("metaserver/static/js/files_view/controller",["require","exports","tslib","react-redux","react","metaserver/static/js/files_view/data/store","metaserver/static/js/files_view/files_view","metaserver/static/js/files_view/data/action_creators","metaserver/static/js/files_view/contexts/files_view_context","metaserver/static/js/flows/types","metaserver/static/js/files_view/legacy_types"],(function(e,t,s,i,a,r,o,n,l,c,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FilesViewController=t.FilesViewWithUpserter=t.splitProps=void 0,a=s.__importDefault(a),s.__exportStar(d,t);const u={arePostTTIModulesLoaded:!0,context:!0,createNewFolderState:!0,items:!0,selection:!0,user:!0,responsive:!0,clipboard:!0,currentSort:!0,disabledMultiselect:!0,dropTargetHighlightMode:!0,enableUnity:!0,expBizFoldersEmptyStateAdmin:!0,expBizFoldersEmptyStateUser:!0,fileRename:!0,filteredContactName:!0,renderFilenameSubtitleAsLink:!0,hideViewFileButton:!0,highDensity:!0,isOverFreeQuota:!0,isSearchMode:!0,loadingState:!0,sharingServiceInfo:!0,starredState:!0,teamFolders:!0,viewTypeScope:!0,viewTypes:!0,eligibleForFirstTaskSubtitle:!0,expVaultEnableViewOnlySharing:!0,isActionBarEnabled:!0,inlineActionBar:!0,expFlowsAutomatedFolderUI:!0,fileHasAutomatedRuleMap:(0,c.FlowsMap)({}),expManualTagging:"OFF",currentFolderInfo:!0,mediaFiltersVariant:"OFF"},p=(e,t,s)=>{t[s]=e[s]};t.splitProps=e=>{const t={},s={};for(const i of Object.keys(e))if(u.hasOwnProperty(i)){const t=i;void 0!==e[t]&&p(e,s,t)}else p(e,t,i);return{ownProps:t,upsertedProps:s}};let g=0;const h=e=>{const{id:s,isActive:r=!0}=e,c=(0,i.useDispatch)(),{ownProps:d,upsertedProps:u}=(0,t.splitProps)(e),p=a.default.useMemo(()=>s||`files-view:${g++}`,[s]),h=p!==s;return c((0,n.upsertInstance)(p,u)),a.default.useEffect(()=>()=>{h&&c((0,n.deleteInstance)(p))},[h,c,p]),a.default.useEffect(()=>{r&&s&&c((0,n.markActiveInstance)(s))},[r,s,c]),a.default.createElement(l.FilesViewContextProvider,{props:e,instanceId:p},a.default.createElement(o.FilesView,Object.assign({},d,{id:p})))};h.displayName="UpsertWrapper",t.FilesViewWithUpserter=(0,i.connect)()(h);const _=(0,r.getStoreForFilesView)();t.FilesViewController=e=>a.default.createElement(i.Provider,{store:_},a.default.createElement(t.FilesViewWithUpserter,Object.assign({},e))),t.FilesViewController.displayName="FilesViewController"})),define("metaserver/static/js/files_view/culled_table_body",["require","exports","tslib","spectrum/table/index","metaserver/static/js/files_view/util","react"],(function(e,t,s,i,a,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.computeOffsetCache=t.scrollTo=t.CulledTableBodyWithScrollToRow=t.CulledTableBodyWithScrollContainer=void 0,r=s.__importDefault(r);t.CulledTableBodyWithScrollContainer=e=>{var{scrollContainer:t}=e,i=s.__rest(e,["scrollContainer"]);const n=r.default.useMemo(()=>(null==t?void 0:t.current)?(0,a.createFakeWindow)(t.current):null,[null==t?void 0:t.current]);return t?t.current&&n?r.default.createElement(o,Object.assign({},i,{shouldUseWindowAsScrollContainer:!0,window:n})):null:r.default.createElement(o,Object.assign({},i))},t.CulledTableBodyWithScrollContainer.displayName="CulledTableBodyWithScrollContainer",t.CulledTableBodyWithScrollContainer.displayName="CulledTableBodyWithScrollContainer";class o extends r.default.PureComponent{constructor(e){super(e),this.updateOffsetCache()}componentDidMount(){this.updateScroll(!0)}componentDidUpdate(e){e.listItemHeight!==this.props.listItemHeight&&this.updateOffsetCache(),e.scrollToRow!==this.props.scrollToRow&&this.updateScroll(void 0===e.scrollToRow||e.scrollToRow<0)}updateOffsetCache({listItemHeight:e}=this.props){this.offsetCache=Array.isArray(e)?(0,t.computeOffsetCache)(e):void 0}updateScroll(e){const{scrollToRow:s,listItemHeight:i,viewportTopOffset:a=0,scrollPositionOffset:r=0,window:o}=this.props;if(void 0!==s&&s>=0){const n=(Array.isArray(i)?this.offsetCache[s]:(s+1)*i)+r,l=n-(Array.isArray(i)?i[s]:i);(0,t.scrollTo)([l,n],a,o,e)}}render(){const e=this.props,{viewportTopOffset:t,scrollToRow:a}=e,o=s.__rest(e,["viewportTopOffset","scrollToRow"]);return r.default.createElement(i.CulledTableBody,Object.assign({viewportHeight:window.innerHeight-t},o))}}t.CulledTableBodyWithScrollToRow=o,o.defaultProps={viewportTopOffset:0},o.displayName="CulledTableBodyWithScrollToRow";t.scrollTo=([e,t],s=0,i=window,a)=>{const r=i.innerHeight-s,o=((e=window)=>"scrollingElement"in e.document&&e.document.scrollingElement?e.document.scrollingElement.scrollTop:e.document.documentElement.scrollTop)(i),n=o+r;e<o?i.scrollTo(0,e):t>n&&(a&&t-e<r/2?i.scrollTo(0,t-r/2):i.scrollTo(0,t-r))};t.computeOffsetCache=e=>e.reduce((e,t)=>(e.push(t+(e[e.length-1]||0)),e),[])})),define("metaserver/static/js/files_view/data/selectors/item_selectors",["require","exports","metaserver/static/js/browse/models","metaserver/static/js/files_view/constants","metaserver/static/js/files_view/data/selectors/instance_selectors","metaserver/static/js/files_view/view_type","metaserver/static/js/files_view/util","metaserver/static/js/core/assert","metaserver/static/js/tagging/experiments","metaserver/static/js/files_view/data/selectors/constants"],(function(e,t,s,i,a,r,o,n,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.selectFlowsBadgePath=t.selectIsCutToClipboard=t.selectIconSize=t.selectShouldShowFirstTaskSubtitle=t.selectSnippetRows=t.selectRowHeight=t.selectShouldShowTags=t.selectShouldShowSnippets=t.selectFirstValidSnippet=t.selectSnippets=t.selectIsTooltipEnabled=t.selectShowCDMUserEducationEffects=t.selectShouldShowStar=t.selectIsNoAccessSharedFolder=t.selectShouldShowSubtitle=t.selectRenameInput=t.selectRenameState=t.selectUserEducationEffectName=t.selectShouldShowUserEducationEffects=t.selectIsCheckboxVisible=t.selectIsItemSelected=t.selectItemSelectionId=t.selectItemAssertFileOrFileSharedWithMe=t.selectItem=void 0;t.selectItem=(e,t)=>{const s=(0,a.selectMainItems)(e,t),i=s&&s.get(t.itemIndex);return(0,n.assert)(!!i,`Item undefined at index: ${t.itemIndex}`),i};t.selectItemAssertFileOrFileSharedWithMe=(e,i)=>{const a=(0,t.selectItem)(e,i);return(0,n.assert)(a instanceof s.File||a instanceof s.FileSharedWithMe,`item must be File or FileSharedWithMe at index: ${i.itemIndex}`),a};t.selectItemSelectionId=(e,i)=>{const a=(0,t.selectItemAssertFileOrFileSharedWithMe)(e,i);return a instanceof s.File?i.fileToId(a):a.file_id};t.selectIsItemSelected=(e,s)=>(0,a.selectSelection)(e,s).selected.has((0,t.selectItemSelectionId)(e,s));t.selectIsCheckboxVisible=(e,t)=>t.isHovered||(0,a.selectHasItemsSelected)(e,t)||(0,a.selectIsCompactMode)(e,t);t.selectShouldShowUserEducationEffects=(e,t)=>{const{rowIndex:s}=t;return 0===s||(0,a.selectUser)(e,t).is_cdm_member&&(2===t.rowIndex||1===t.rowIndex)};t.selectUserEducationEffectName=(e,s)=>(0,t.selectShouldShowUserEducationEffects)(e,s)?"FileNameLabel-"+s.rowIndex:void 0;t.selectRenameState=(e,i)=>{const r=(0,a.selectFileRename)(e,i),o=(0,t.selectItem)(e,i);if(r&&o instanceof s.File)return r.file.fq_path===o.fq_path?r.state:void 0};t.selectRenameInput=(e,t)=>{const s=(0,a.selectFileRename)(e,t);return null==s?void 0:s.input};t.selectShouldShowSubtitle=(e,s)=>!(0,t.selectRenameState)(e,s)&&(0,a.selectViewType)(e,s)!==r.ViewType.CondensedList;t.selectIsNoAccessSharedFolder=(e,i)=>{const a=(0,t.selectItem)(e,i);return a instanceof s.File&&s.File.isNoAccessSharedFolder(a)};t.selectShouldShowStar=(e,s)=>!(0,t.selectIsNoAccessSharedFolder)(e,s)&&!(0,a.selectContext)(e,s).isInsideVaultFolder&&!(0,a.selectIsMobileMode)(e,s);t.selectShowCDMUserEducationEffects=(e,i)=>{const a=(0,t.selectItem)(e,i);return a instanceof s.File&&s.File.isTeamMemberFolder(a)};t.selectIsTooltipEnabled=(e,t)=>(0,a.selectArePostTTIModulesLoaded)(e,t);t.selectSnippets=(e,i)=>{const a=(0,t.selectItem)(e,i);if(a instanceof s.Paper||a instanceof s.File||a instanceof s.FileSharedWithMe)return a.snippets};t.selectFirstValidSnippet=(e,s)=>{const i=(0,t.selectSnippets)(e,s);return i&&i.find(({highlight_spans:e})=>!!e&&e.length>0)};t.selectShouldShowSnippets=(e,s)=>Boolean(!(0,a.selectIsMobileMode)(e,s)&&(0,t.selectFirstValidSnippet)(e,s));t.selectShouldShowTags=(e,i)=>{const r=(0,t.selectItem)(e,i),o=(0,a.selectExpManualTagging)(e,i);return(0,l.isTaggingEnabled)(o)&&r instanceof s.File&&r.tags&&r.tags.length>0};t.selectRowHeight=(e,s)=>{const o=(0,t.selectShouldShowSnippets)(e,s),n=(0,a.selectHighDensity)(e,s),l=(0,a.selectViewType)(e,s),c=(0,t.selectShouldShowTags)(e,s);if(o){const a=(0,t.selectSnippetRows)(e,s);if(!a)return c?i.DEFAULT_ROW_HEIGHT_WITH_SNIPPETS+i.TAGS_HEIGHT:i.DEFAULT_ROW_HEIGHT_WITH_SNIPPETS;const r=i.ROW_VERTICAL_PADDING+i.ROW_TITLE_HEIGHT+i.ROW_SUBTITLE_HEIGHT+i.ROW_SNIPPET_VERTICAL_MARGIN+i.SNIPPET_HEIGHT_PER_ROW*a;return c?r+i.TAGS_HEIGHT:r}return l===r.ViewType.CondensedList?i.DEFAULT_ROW_HEIGHT_CONDENSED_LIST:n?c?i.DEFAULT_ROW_HEIGHT_DENSE+i.TAGS_HEIGHT:i.DEFAULT_ROW_HEIGHT_DENSE:c?i.DEFAULT_ROW_HEIGHT+i.TAGS_HEIGHT:i.DEFAULT_ROW_HEIGHT};t.selectSnippetRows=(e,s)=>{const a=(0,t.selectFirstValidSnippet)(e,s);if(!a||!a.highlight_spans)return 0;const{containerWidth:r,numVisibleColumns:o}=s,n=r?r*i.FILE_NAME_CELL_SEARCH_FLEX_BASIS[o]/100:void 0;if(!n)return 3;const l=a.highlight_spans.map(e=>e.highlight_str).join().length,c=Math.max(n-i.MEDIA_CELL_ICON_WIDTH-i.SNIPPET_HORIZONTAL_PADDING,1),d=6*l;return Math.min(Math.ceil(d/c),3)};t.selectShouldShowFirstTaskSubtitle=(e,t)=>Boolean((0,a.selectEligibleForFirstTaskSubtitle)(e,t)&&d(e,t));const d=(e,i)=>{const r=(0,a.selectContext)(e,i),o=(0,t.selectItem)(e,i),n=(0,a.selectUser)(e,i);return o instanceof s.File&&(r.isInsideMyTeamFolderTree&&r.isCurrentlyInRoot&&o.fq_path===n.cdm_tmf_path)};t.selectIconSize=(e,t,s)=>(0,a.selectViewType)(e,t)===r.ViewType.CondensedList?c.CONDENSED_LISTVIEW_ICON_SIZE_PX:s;t.selectIsCutToClipboard=(e,s)=>{const i=(0,a.selectCutItems)(e,s),r=(0,t.selectItem)(e,s);return(0,o.isCutToClipboard)(r,i)};t.selectFlowsBadgePath=(e,i)=>{const r=(0,t.selectItemAssertFileOrFileSharedWithMe)(e,i);if(!(r instanceof s.FileSharedWithMe)&&r.is_dir)return null!=(0,a.selectFileHasAutomatedRuleMap)(e,i).get(r.fq_path)?r.fq_path:void 0}})),define("metaserver/static/js/files_view/data/selectors/list_selectors",["require","exports","tslib","reselect","metaserver/static/js/browse/models","metaserver/static/js/files_view/constants","metaserver/static/js/files_view/data/selectors/instance_selectors","metaserver/static/js/files_view/file_list_utils","metaserver/static/js/files_view/view_type","metaserver/static/js/files_view/util","metaserver/static/js/tagging/experiments","metaserver/static/js/media_filters/gating","metaserver/static/js/files_view/data/selectors/constants"],(function(e,t,s,i,a,r,o,n,l,c,d,u,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.estimateSnippetRowsNeeded=t.getFileRowHeight=t.shouldShowSnippets=t.getFirstValidSnippet=t.getFilesViewListRowItems=t.selectListItemBuffer=t.selectListItemHeights=t.selectListItems=void 0;t.selectListItems=(e,s)=>{const i=(0,o.selectMainItems)(e,s),a=!!(0,o.selectDisabledMultiselect)(e,s),r=(0,o.selectViewType)(e,s)===l.ViewType.CondensedList,n=(0,o.selectIsActionBarEnabled)(e,s);return(0,t.getFilesViewListRowItems)(Object.assign(Object.assign({},s),{isCheckboxDisabled:a,isCondensedListView:r,items:i,isActionBarEnabled:n}))},t.selectListItemHeights=(0,i.createSelector)(t.selectListItems,e=>e.map(({height:e})=>e));t.selectListItemBuffer=(e,t)=>(0,o.selectViewType)(e,t)===l.ViewType.CondensedList?20:void 0;const g=(0,i.createSelectorCreator)(i.defaultMemoize,(e,t)=>Object.keys(e).length===Object.keys(t).length&&Object.keys(e).every(s=>t.hasOwnProperty(s)&&e[s]===t[s]));t.getFilesViewListRowItems=g(({activeDropTarget:e,arePostTTIModulesLoaded:t,canDisplayFolderSizes:s,context:i,createNewFolderState:a,dropTargetHighlightMode:r,fileRename:o,focusedFileIndex:n,isCheckboxDisabled:l,isCompactMode:c,isSearchMode:d,isSelectMode:u,items:p,selection:g,sharingServiceInfo:h,starredState:_,user:m,visibleColumns:f,responsive:S,containerWidth:v,highDensity:E,isCondensedListView:y,fileToId:T,renderSharedWithController:w,expVaultEnableViewOnlySharing:b,isActionBarEnabled:F,expManualTagging:C,mediaFiltersVariant:I,defaultListviewIconSize:R})=>({activeDropTarget:e,arePostTTIModulesLoaded:t,canDisplayFolderSizes:s,context:i,createNewFolderState:a,dropTargetHighlightMode:r,fileRename:o,focusedFileIndex:n,isCheckboxDisabled:l,isCompactMode:c,isSearchMode:d,isSelectMode:u,items:p,selection:g,sharingServiceInfo:h,starredState:_,user:m,visibleColumns:f,responsive:S,containerWidth:v,highDensity:E,isCondensedListView:y,fileToId:T,renderSharedWithController:w,expVaultEnableViewOnlySharing:b,isActionBarEnabled:F,expManualTagging:C,mediaFiltersVariant:I,defaultListviewIconSize:R}),e=>{const{activeDropTarget:i,context:o,createNewFolderState:l,dropTargetHighlightMode:u,items:g,fileRename:h,focusedFileIndex:_,selection:m,user:f,visibleColumns:S,responsive:v,containerWidth:E,highDensity:y,fileToId:T,isCondensedListView:w,isActionBarEnabled:b,mediaFiltersVariant:F,defaultListviewIconSize:C}=e,I=s.__rest(e,["activeDropTarget","context","createNewFolderState","dropTargetHighlightMode","items","fileRename","focusedFileIndex","selection","user","visibleColumns","responsive","containerWidth","highDensity","fileToId","isCondensedListView","isActionBarEnabled","mediaFiltersVariant","defaultListviewIconSize"]),R=!!e.expVaultEnableViewOnlySharing,D=(0,d.isTaggingEnabled)(e.expManualTagging),O=w?r.DEFAULT_ROW_HEIGHT_CONDENSED_LIST:y?r.DEFAULT_ROW_HEIGHT_DENSE:r.DEFAULT_ROW_HEIGHT,A=w?p.CONDENSED_LISTVIEW_ICON_SIZE_PX:C,M=g.toArray().map((e,s)=>{if(e instanceof a.UserDefinedItem)return{type:"UserDefinedItemRow",props:{userDefinedItem:e},height:O};const l=E?E*r.FILE_NAME_CELL_SEARCH_FLEX_BASIS[S.length]/100:void 0,d=(0,t.shouldShowSnippets)({file:e,responsive:v}),p=(0,t.estimateSnippetRowsNeeded)({snippets:e.snippets,fileNameCellWidth:l}),g=(0,t.getFileRowHeight)({file:e,showSnippets:d,snippetRows:p,highDensity:y,isCondensedListView:w,showTags:D,mediaFiltersVariant:F,fileNameCellWidth:l});if(e instanceof a.Paper)return{type:"PaperRow",props:{isSearchMode:I.isSearchMode,paper:e,visibleColumns:S,arePostTTIModulesLoaded:I.arePostTTIModulesLoaded,showSnippets:d,snippetRows:p,height:g,showStar:I.arePostTTIModulesLoaded&&!(0,c.isMobileMode)(v)},height:g};const C="fq_path"in e?T(e):e.file_id,M=m.selected.has(C);if(e instanceof a.FileSharedWithMe)return{type:"FileSharedWithMeRow",props:{file:e,visibleColumns:S,showSnippets:d,snippetRows:p,height:g,isSelected:M,arePostTTIModulesLoaded:I.arePostTTIModulesLoaded,isSelectMode:I.isSelectMode,isFocused:s===_,iconSize:A},height:g};const L=(0,n.canFileBeHighlightedDropTarget)({file:e,dropTargetHighlightMode:u});return{type:"FileRow",key:`file:${encodeURIComponent(e.file_id)}:${encodeURIComponent(e.fq_path)}`,itemIndex:s,props:Object.assign(Object.assign({},I),{file:e,iconSize:A,isActionBarEnabled:b,isActiveDropTarget:L&&i===e,isAvailableDropTarget:L,isFocused:s===_,isSelected:M,isExtensionsMenuDisabled:!0,isSharingDisabled:(0,n.isSharingDisabledForFile)({context:o,file:e,user:f,expVaultEnableViewOnlySharing:R}),renameState:h&&h.file.fq_path===e.fq_path?h.state:void 0,visibleColumns:S,height:g,containerWidth:E,isCondensedListView:w,responsive:v}),height:g}});return l&&"CREATE_FOLDER_INACTIVE"!==l&&M.unshift({type:"NewFolderRow",props:{createNewFolderState:l,isInsideMyTeamFolderTree:o.isInsideTeamFolderTree,iconSize:A},height:O}),M});t.getFirstValidSnippet=e=>e.find(({highlight_spans:e})=>!!e&&e.length>0);t.shouldShowSnippets=({file:{snippets:e},responsive:s})=>!!e&&!!(0,t.getFirstValidSnippet)(e)&&(s.isMatchedLarge||s.isMatchedMedium);t.getFileRowHeight=({file:e,showSnippets:t,snippetRows:s,highDensity:i,isCondensedListView:a,showTags:o,mediaFiltersVariant:n,fileNameCellWidth:l})=>{const d=o&&(0,c.isFile)(e)&&e.tags&&e.tags.length>0?r.TAGS_HEIGHT:0,u=h({file:e,mediaFiltersVariant:n,fileNameCellWidth:l});if(e.snippets&&t){if(!s)return r.DEFAULT_ROW_HEIGHT_WITH_SNIPPETS+d+u;return r.ROW_VERTICAL_PADDING+r.ROW_TITLE_HEIGHT+r.ROW_SUBTITLE_HEIGHT+r.ROW_SNIPPET_VERTICAL_MARGIN+r.SNIPPET_HEIGHT_PER_ROW*s+d+u}return a?r.DEFAULT_ROW_HEIGHT_CONDENSED_LIST:i?r.DEFAULT_ROW_HEIGHT_DENSE+d+u:r.DEFAULT_ROW_HEIGHT+d+u};const h=({file:e,mediaFiltersVariant:s,fileNameCellWidth:i})=>{var a,o,n,l;const d=(0,c.isFile)(e)&&!!(null===(o=null===(a=e.media_data)||void 0===a?void 0:a.data)||void 0===o?void 0:o.date_taken);if((0,u.isMediaMetadataSearchEnabled)(s)){if((0,c.isFile)(e)){const s=(null!==(l=null===(n=e.media_data)||void 0===n?void 0:n.display_info)&&void 0!==l?l:[]).map(e=>(0,t.estimateSnippetRowsNeeded)({snippets:[{highlight_spans:e.highlights}],fileNameCellWidth:i})).reduce((e,t)=>e+t,0),a=d?s+1:s;return Math.min(a,3)*r.MEDIA_INFO_ITEM_HEIGHT}return 0}return(0,u.isMediaFiltersEnabled)(s)&&d?r.MEDIA_INFO_ITEM_HEIGHT:0};t.estimateSnippetRowsNeeded=({snippets:e,fileNameCellWidth:s})=>{if(!e)return 0;const i=(0,t.getFirstValidSnippet)(e);if(!i||!i.highlight_spans)return 0;if(!s)return 3;const a=i.highlight_spans.map(e=>e.highlight_str).join().length,o=Math.max(s-r.MEDIA_CELL_ICON_WIDTH-r.SNIPPET_HORIZONTAL_PADDING,1),n=6*a;return Math.min(Math.ceil(n/o),3)}})),define("metaserver/static/js/files_view/file_actions/file_media_actions",["require","exports","tslib","react","spectrum/media_table/index","metaserver/static/js/extensions/split_share_button","metaserver/static/js/files_view/overflow_menu","metaserver/static/js/files_view/util","metaserver/static/js/vault/lib/browse_utils","metaserver/static/js/user_survey/user_survey"],(function(e,t,s,i,a,r,o,n,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FileMediaActions=void 0,i=s.__importDefault(i);class d extends i.default.PureComponent{constructor(){super(...arguments),this.state={isActionDropdownOpen:!1},this.onSplitShareDropdownOpen=()=>{this.onActionDropdownOpen()},this.onActionDropdownOpen=()=>{this.setState({isActionDropdownOpen:!0})},this.onActionDropdownClose=()=>{this.setState({isActionDropdownOpen:!1})},this.logSplitShareButton=e=>{c.UserSurvey.trackEvent("share_item","browse"),(0,n.isFile)(this.props.file)&&this.props.file.is_in_vault_folder&&(0,l.logShareFromInsideVault)(this.props.file.is_dir)}}render(){const{arePostTTIModulesLoaded:e,canDisplayFolderSizes:t,file:s,getOverflowMenuActions:n,isCompactMode:l,isHovered:c,isSelectMode:d,isSharingDisabled:u,onPresentInZoom:p,shareButtonLabel:g,showShareButton:h,showBorders:_,user:m,viewportTopOffset:f}=this.props,S=this.props.onShowShare||(()=>{});return d?null:i.default.createElement(a.MediaActions,null,!u&&!1!==h&&i.default.createElement(r.SplitShareButton,{shareButtonLabel:g,onShowShare:S,logShareButtonClick:this.logSplitShareButton,isVisible:c&&!l||this.state.isActionDropdownOpen,user:m,files:[s],onDropdownOpen:this.onSplitShareDropdownOpen,onDropdownClose:this.onActionDropdownClose,onPresentInZoom:p,variant:"opacity",shouldUsePortalPopover:!0}),e&&i.default.createElement(o.FilesViewOverflowMenu,{canDisplayFolderSizes:t,file:s,getOverflowMenuActions:n,showBorders:c||!!_,viewportTopOffset:f,ariaHidden:!0}))}}t.FileMediaActions=d,d.displayName="FileMediaActions"})),define("metaserver/static/js/files_view/file_actions/file_media_actions_v2",["require","exports","tslib","classnames","react","react-redux","metaserver/static/js/files_view/data/selectors/instance_selectors","metaserver/static/js/core/browser_detection"],(function(e,t,s,i,a,r,o,n){"use strict";function l(e){e.stopPropagation()}function c(e){const{FilesViewInlineActionBar:t,file:s,highlighted:r,onHoverLocked:o,isMobile:c}=e,d=(0,i.default)("brws-file-row-inline-action-bar",{"brws-file-row-inline-action-bar--safari":n.safari});return t?a.default.createElement("td",{onClick:l,className:"brws-file-row-inline-action-bar--container"},a.default.createElement(t,{className:d,file:s,highlighted:r,onHoverLocked:o,isMobile:c})):null}Object.defineProperty(t,"__esModule",{value:!0}),t.FileMediaActionsV2=t.FileMediaActionsV2Element=void 0,i=s.__importDefault(i),a=s.__importDefault(a),n=s.__importStar(n),t.FileMediaActionsV2Element=c;t.FileMediaActionsV2=(0,r.connect)((e,t)=>({FilesViewInlineActionBar:(0,o.selectInlineActionBar)(e,t)}))(c)})),define("metaserver/static/js/files_view/file_name/file_name_audio_description",["require","exports","tslib","react","metaserver/static/js/clean/filetypes","metaserver/static/js/browse/models","metaserver/static/js/files_view/util","metaserver/static/js/core/i18n"],(function(e,t,s,i,a,r,o,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FileNameAudioDescription=void 0,i=s.__importDefault(i);t.FileNameAudioDescription=({file:e,isSelected:t})=>{const s=[];return(0,o.isFile)(e)&&e.isDeleted&&s.push(n.intl.formatMessage({id:"RBvabN",defaultMessage:"Deleted"})),t&&s.push(n.intl.formatMessage({id:"mpdvwi",defaultMessage:"Selected"})),(0,o.isFile)(e)&&e.is_dir&&(e.type===a.FileTypes.SHARED_FOLDER?r.File.isReadOnlySharedFolder(e)?s.push(n.intl.formatMessage({id:"513aYe",defaultMessage:"Read-only shared folder"})):s.push(n.intl.formatMessage({id:"r6q13e",defaultMessage:"Shared folder"})):e.type===a.FileTypes.TEAM_SHARED_FOLDER?r.File.isReadOnlySharedFolder(e)?s.push(n.intl.formatMessage({id:"dNfvWF",defaultMessage:"Read-only team shared folder"})):s.push(n.intl.formatMessage({id:"8zuxGM",defaultMessage:"Team shared folder"})):s.push(n.intl.formatMessage({id:"MLqiSW",defaultMessage:"Folder"}))),s.length>0?i.default.createElement("span",{className:"ax-visually-hidden"},`${s.join(" ")}`):null},t.FileNameAudioDescription.displayName="FileNameAudioDescription"})),define("metaserver/static/js/files_view/file_name/file_name_cell",["require","exports","tslib","classnames","react","react-redux","spectrum/dimensions/index","metaserver/static/js/browse/data/selectors","metaserver/static/js/browse/models","metaserver/static/js/files_view/data/selectors/instance_selectors","metaserver/static/js/files_view/data/selectors/item_selectors","metaserver/static/js/files_view/star","metaserver/static/js/files_view/types","metaserver/static/js/clean/ui/selectable_list","metaserver/static/js/files_view/file_name/file_name_cell_contents","metaserver/static/js/flows/components/badge_async","metaserver/static/js/redux/namespaces","metaserver/static/js/files_view/file_name/renaming_bar_modal_overlay","metaserver/static/js/core/browser_detection","metaserver/static/js/files_view/contexts/callback_context","metaserver/static/js/file_uploader/clean/data/selectors","js/filepath/filepath","metaserver/static/js/files_view/file_name/renaming_bar_api_v2","metaserver/static/js/files_view/data/action_creators","metaserver/static/js/files_view/data/store"],(function(e,t,s,i,a,r,o,n,l,c,d,u,p,g,h,_,m,f,S,v,E,y,T,w,b){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FileNameCell=t.FileNameCellComponent=void 0,i=s.__importDefault(i),a=s.__importDefault(a);t.FileNameCellComponent=({mediaActions:e,fileNameCellWidth:t,draggable:s,shouldTruncateMiddleFilename:r,renameState:o,flowsBadgePath:n,showStar:c,file:d,user:m,isMobileMode:E,isSelected:C,showLocation:I,showSnippets:R,shouldShowSubtitle:D,snippetRows:O,onNameClick:A,showUserEducationEffects:M,showHighlights:L,hrefForFile:P,userEducationEffectName:N,isTooltipEnabled:j,showFirstTaskSubtitle:x,renderFilenameSubtitleAsLink:k,onRenameCancel:U,onRenameSubmit:H,isHovered:W,onLocationLinkClick:V,onSelect:B,onDragStart:q,showTags:G,preventSelectionOnDrag:Q,mediaFiltersVariant:z,backupNewLocationHintEnabled:K,isInsideBackupFolder:Y,ggToCdmMigrationVariant:X,renameInput:Z,uploadRenamingBarVariant:J,lastSingleFileUpload:$,backupInfo:ee})=>{const te=(0,i.default)("brws-file-name-cell-text","brws-vertically-center",{"brws-file-name-cell-text-rename":!!o}),se=(0,i.default)("brws-file-name-container",{"brws-file-name-container--action-ui-inline-star":!0}),ie=s=>{let i;return r&&(i=t||s,void 0!==i&&void 0!==e&&(i-=48)),i},ae=e=>{q&&(Q||C||!B||B(g.SelectOptions.DEFAULT,p.FilesViewActionSource.ROW_SINGLE_CLICK),q(e))},re=r&&void 0===t,oe=a.default.useContext(v.FilesViewCallbackContext),[ne,le]=a.default.useState(!1),[ce,de]=a.default.useState(!1),[ue,pe]=a.default.useState(f.RenamingBarDismissState.NOT_DISMISSED),[ge,he]=a.default.useState(!1),[_e,me]=a.default.useState(void 0),[fe,Se]=a.default.useState(void 0),[ve,Ee]=a.default.useState(void 0),ye=e=>{Se(e)},Te=()=>{d instanceof l.File&&((0,b.getStoreForFilesView)().dispatch((0,w.setFileRename)({file:d,renameState:p.RenameState.PENDING_INPUT})),Se(void 0),le(!1))},we=e=>{ve&&(0,T.logFinalFilename)(m.id,e,ve)},be=a.default.useRef(null),[Fe,Ce]=a.default.useState(Z);a.default.useEffect(()=>{!(0,S.is_supported_mobile_browser)()&&d instanceof l.File&&!d.is_dir?(le(!!(null==oe?void 0:oe.shouldShowRenamingBar)&&!(null==oe?void 0:oe.isRenamingBarDisabled)),de(!!(null==oe?void 0:oe.shouldShowUploadRenamingBar)&&!(null==oe?void 0:oe.isRenamingBarDisabled)),me(null==oe?void 0:oe.renamingBarType)):le(!1)},[d,oe]),a.default.useEffect(()=>{Ce(Z)},[Z]);const Ie=()=>Boolean($&&d instanceof l.File&&d.fq_path===(0,y.normalize)($.dest)+(0,y.normalize)($.name));a.default.useEffect(()=>{J&&Ie()&&d instanceof l.File&&!ge&&(0,T.filenameHasDate)(m.id,d.fq_path).then(({has_date:e})=>{he(e)})},[]);const Re=()=>ue!==f.RenamingBarDismissState.DISMISSED&&(ue===f.RenamingBarDismissState.DISMISSED_LAST_RENDER?(pe(f.RenamingBarDismissState.DISMISSED),!0):ue===f.RenamingBarDismissState.DISMISSED_LAST_RENDER_BUT_CONTINUE_TO_APPEAR&&(pe(f.RenamingBarDismissState.DISMISSED_BUT_CONTINUE_TO_APPEAR),!0)),De=()=>{if(!(ne&&ue===f.RenamingBarDismissState.NOT_DISMISSED&&!window.location.pathname.startsWith("/search")&&d instanceof l.File))return;const e={anchorRef:be,userId:m.id,fqPath:d.fq_path,namespaceId:d.ns_id,renameInput:Fe,setRenamingBarDismissState:pe,setRenamingBarDisabled:null==oe?void 0:oe.setRenamingBarDisabled,namingConventionsRules:null==oe?void 0:oe.namingConventionsRules,onRenameSubmit:H,updateMlSuggestedName:ye,file:d,predictionId:ve,setPredictionId:Ee},t=o===p.RenameState.PENDING_INPUT&&Z?"existing_naming_convention"===(null==_e?void 0:_e[".tag"])?f.RenamingBarType.RENAME_EXISTING:"ml_naming_convention"===(null==_e?void 0:_e[".tag"])?f.RenamingBarType.ML_SUGGESTED_NAME:f.RenamingBarType.RENAME_HEURISTIC:J&&ce&&C&&ge&&Ie()?f.RenamingBarType.UPLOAD:void 0;return t?a.default.createElement(f.RenamingBarModalOverlay,Object.assign({},e,{renamingBarType:t,uploadRenamingBarToggle:de})):void 0};return a.default.createElement(a.default.Fragment,null,a.default.createElement(F,{className:se,shouldWrap:re},e=>a.default.createElement("div",{className:se},De(),a.default.createElement("div",{className:te,draggable:s&&o!==p.RenameState.PENDING_INPUT,onDragStart:ae,ref:be},a.default.createElement(h.FileNameCellContents,{file:d,renameState:o,showLocation:I,showSnippets:R,shouldShowSubtitle:D,snippetRows:O,user:m,onNameClick:A,isSelected:C,showUserEducationEffects:M,showHighlights:L,hrefForFile:P,userEducationEffectName:N,isTooltipEnabled:j,showFirstTaskSubtitle:x,renderFilenameSubtitleAsLink:k,onRenameCancel:U,onRenameSubmit:H,isHovered:W,onLocationLinkClick:V,width:ie(e),shouldShowTags:G,mediaFiltersVariant:z,backupNewLocationHintEnabled:K,isInsideBackupFolder:Y,ggToCdmMigrationVariant:X,isRenamingBarEnabled:ne,mlSuggestedName:fe,handleAcceptMlSuggestedName:Te,logFinalFilenameForMLRenamingBar:we,wasRenamingBarDismissedLastRender:Re,backupInfo:ee})),n&&a.default.createElement(_.AsyncBadgeComponent,{isFolderFocused:C,folderFqPath:n}),!o&&c&&a.default.createElement(u.StarContainer,{item:d,user:m,className:"brws-file-name-cell-star",isReadOnly:E,tabIndex:C?0:-1,starButtonClassName:"brws-file-name-star-button",alwaysShowUnstarred:!0}))),e)},t.FileNameCellComponent.displayName="FileNameCellComponent";const F=({children:e,className:t,shouldWrap:s})=>s?a.default.createElement(o.Dimensions,{className:t},({width:t})=>e(t)):e();F.displayName="ConditionalDimensions";t.FileNameCell=(0,r.connect)((e,t)=>{const s=(0,d.selectItemAssertFileOrFileSharedWithMe)(e,t),i=m.BROWSE_NAMESPACE_KEY in e&&"fq_path"in s?(0,n.isInsideBackupFolderByFile)(e)(s):void 0,a=m.BROWSE_NAMESPACE_KEY in e&&"fq_path"in s?(0,n.backupInfoByFile)(e)(s):void 0;return{file:s,flowsBadgePath:(0,d.selectFlowsBadgePath)(e,t),isSelectMode:(0,c.selectHasItemsSelected)(e,t),isSelected:(0,d.selectIsItemSelected)(e,t),renameState:(0,d.selectRenameState)(e,t),renderFilenameSubtitleAsLink:(0,c.selectRenderFilenameSubtitleAsLink)(e,t),isMobileMode:(0,c.selectIsMobileMode)(e,t),showHighlights:(0,c.selectShouldShowFileNameHighlights)(e,t),showLocation:(0,c.selectShouldShowFileNameLocation)(e,t),showStar:(0,d.selectShouldShowStar)(e,t),showUserEducationEffects:(0,d.selectShouldShowUserEducationEffects)(e,t),userEducationEffectName:(0,d.selectUserEducationEffectName)(e,t),isTooltipEnabled:(0,d.selectIsTooltipEnabled)(e,t),user:(0,c.selectUser)(e,t),shouldTruncateMiddleFilename:(0,c.selectArePostTTIModulesLoaded)(e,t),showSnippets:(0,d.selectShouldShowSnippets)(e,t),snippetRows:(0,d.selectSnippetRows)(e,Object.assign(Object.assign({},t),{numVisibleColumns:t.visibleColumns.length})),showFirstTaskSubtitle:(0,d.selectShouldShowFirstTaskSubtitle)(e,t),shouldShowSubtitle:(0,d.selectShouldShowSubtitle)(e,t),backupNewLocationHintEnabled:(0,n.backupNewLocationHintEnabled)(e),isInsideBackupFolder:i,ggToCdmMigrationVariant:(0,n.ggToCdmMigrationVariant)(e),renameInput:(0,d.selectRenameInput)(e,t),uploadRenamingBarVariant:(0,n.selectUploadRenamingBarVariant)(e),lastSingleFileUpload:(0,E.getLastSingleFileUploadOptional)(e),backupInfo:a}})(t.FileNameCellComponent)})),define("metaserver/static/js/files_view/file_name/file_name_cell_contents",["require","exports","tslib","react","spectrum/media_table/index","js/filepath/filepath","metaserver/static/js/files_view/file_snippets","metaserver/static/js/files_view/name_input","metaserver/static/js/files_view/types","metaserver/static/js/files_view/util","metaserver/static/js/files_view/file_name/file_name_subtitle","metaserver/static/js/files_view/file_name/file_name_title","metaserver/static/js/files_view/file_name/file_name_audio_description","metaserver/static/js/core/i18n","metaserver/static/js/browse/models","metaserver/static/js/tagging/logger","metaserver/static/js/tagging/utils","metaserver/static/js/tagging/components/tags_container","metaserver/static/js/media_filters/gating","metaserver/static/js/media_filters/media_search_snippet_loader","metaserver/static/js/browse/data/helpers","dig-components/buttons","dig-components/tooltips","dig-components/icons","dig-components/icons/src","metaserver/static/js/core/browser","metaserver/static/js/sync_everything/constants","metaserver/static/js/tagging/data/selectors/index","metaserver/static/js/sync_everything/utils/deep_link_utils","metaserver/static/js/sync_everything/types","metaserver/static/js/files_view/contexts/override_context"],(function(e,t,s,i,a,r,o,n,l,c,d,u,p,g,h,_,m,f,S,v,E,y,T,w,b,F,C,I,R,D,O){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FileNameCellContents=void 0,i=s.__importDefault(i),r=s.__importStar(r),_=s.__importStar(_),m=s.__importStar(m),F=s.__importStar(F);const A=e=>{null==e||e.stopPropagation()};t.FileNameCellContents=({file:t,renameState:g,showLocation:L,showSnippets:P,shouldShowSubtitle:N,snippetRows:j,user:x,onNameClick:k,isSelected:U,showUserEducationEffects:H,showHighlights:W,hrefForFile:V,userEducationEffectName:B,isTooltipEnabled:q,showFirstTaskSubtitle:G,renderFilenameSubtitleAsLink:Q,onRenameCancel:z,onRenameSubmit:K,isHovered:Y,onLocationLinkClick:X,width:Z,shouldShowTags:J,mediaFiltersVariant:$,backupNewLocationHintEnabled:ee,isInsideBackupFolder:te,ggToCdmMigrationVariant:se,isRenamingBarEnabled:ie,wasRenamingBarDismissedLastRender:ae,mlSuggestedName:re,handleAcceptMlSuggestedName:oe,logFinalFilenameForMLRenamingBar:ne,backupInfo:le})=>{var ce;const de=M(),ue=((e,t)=>s=>{const i=!(0,c.shouldHandleClick)(s);i||(s.preventDefault(),s.stopPropagation()),(0,c.isFile)(e)&&(null==t||t(e,i))})(t,X),pe=()=>{(0,c.isFile)(t)&&(null==z||z(t))},ge=e=>{(0,c.isFile)(t)&&(null==K||K(t,e),null==ne||ne(e))},he=i.default.useContext(O.FilesViewOverrideContext).isMoveFilePathBelowSnippetEnabled,_e=se&&"OFF"!==se?i.default.lazy(()=>s.__awaiter(void 0,void 0,void 0,(function*(){const{MigrationTooltip:t,MigrationTooltipStep:a}=yield new Promise((t,s)=>{e(["metaserver/static/js/gg_to_cdm_migration/migration_tooltip"],t,s)}).then(s.__importStar);return{default:e=>i.default.createElement(t,Object.assign({},e,{step:a.Two}))}}))):void 0,me=se&&"OFF"!==se?i.default.lazy(()=>s.__awaiter(void 0,void 0,void 0,(function*(){const{MigrationTooltip:t,MigrationTooltipStep:a}=yield new Promise((t,s)=>{e(["metaserver/static/js/gg_to_cdm_migration/migration_tooltip"],t,s)}).then(s.__importStar);return{default:e=>i.default.createElement(t,Object.assign({},e,{step:a.Four}))}}))):void 0,fe=i.default.useRef(null),Se=i.default.useMemo(()=>_e?i.default.createElement(_e,{triggerRef:fe,ggToCdmMigrationVariant:se,user:x}):void 0,[fe,se]),ve=i.default.useMemo(()=>me?i.default.createElement(me,{triggerRef:fe,ggToCdmMigrationVariant:se,user:x}):void 0,[fe,se]);if((0,c.isFile)(t)&&g===l.RenameState.PENDING_INPUT)return i.default.createElement(n.NameInput,{defaultValue:re||r.filename(t.fq_path),mlSuggestedName:re,handleAcceptMlSuggestedName:oe,label:t.is_dir?de.renameDirStr:de.renameFileStr,onClick:A,onSubmit:ge,onCancel:pe,ignoreFileExtension:t.is_dir,isRenamingBarEnabled:ie,wasRenamingBarDismissedLastRender:ae});let Ee;Ee=g===l.RenameState.SAVING_INPUT?i.default.createElement(i.default.Fragment,null,de.renamingStr):i.default.createElement(u.FileNameTitle,{file:t,user:x,containerWidth:Z,isSelected:U,onNameClick:k,hrefForFile:V,showHighlights:W,isTooltipEnabled:q,showUserEducationEffects:H,userEducationEffectName:B}),t instanceof h.File&&h.File.isTeamMemberFolder(t)&&Se&&ve&&(Ee=i.default.createElement("span",{ref:fe},Ee,i.default.createElement(i.default.Suspense,{fallback:i.default.createElement(i.default.Fragment,null)},Se,ve)));let ye=null;G?ye=i.default.createElement("span",{className:"first-task-content-subtitle"},de.filesMovedString):L&&(ye=i.default.createElement(d.FileSubtitle,{containerWidth:Z,file:t,onClick:ue,renderAsLink:Q,user:x,focusable:U,isInsideBackupFolder:te}));const Te=i.default.createElement(a.MediaCellText,{key:"subtitle",variant:"subtitle"},ye),we=Z?{width:Z}:void 0,be=(0,S.isMediaFiltersEnabled)($)&&(0,c.isFile)(t)&&t.media_data,Fe=P||J&&(0,c.isFile)(t)||be,Ce=(0,c.isFile)(t)&&t.tags?t.tags.filter(e=>(0,I.isTagUserGenerated)(e.value)):[],Ie=null===(ce=null==le?void 0:le.anchorFolders)||void 0===ce?void 0:ce.filter(e=>"broken"===e.folder_state[".tag"]&&e.folder_name===(0,c.getFilename)(t));return i.default.createElement(i.default.Fragment,null,i.default.createElement(a.MediaCellText,{key:"title",highlight:Y},i.default.createElement("div",{className:"brws-file-name-cell-title-container"},Ee,i.default.createElement(p.FileNameAudioDescription,{file:t,isSelected:U}),ee&&(0,E.isBackupFolder)(t)&&!(0,C.isBackupBrowse)()&&i.default.createElement(T.Tooltip,{title:de.backupNewLocationTooltipStr,placement:"right"},i.default.createElement(y.Button,{className:"brws-file-name-cell-backup-new-location",variant:"transparent",size:"small",withIconLeft:i.default.createElement(w.UIIcon,{src:b.OpenLine,size:"small"}),onClick:t=>{new Promise((t,s)=>{e(["metaserver/static/js/sync_everything/constants"],t,s)}).then(s.__importStar).then(({getBackupUrl:e})=>F.open_tab(e("browse_row"))),t.stopPropagation()}},de.backupNewLocationButtonStr)),(0,C.isBackupBrowse)()&&1===(null==le?void 0:le.nestLevel)&&void 0!==Ie&&(null==Ie?void 0:Ie.length)>0&&i.default.createElement(y.Button,{className:"brws-file-name-cell-backup-finish-setup",variant:"transparent",size:"small",withIconLeft:i.default.createElement(w.UIIcon,{src:b.WarningLine,size:"small"}),onClick:e=>{(0,R.launchBackupOnDesktop)({hostId:null==le?void 0:le.deviceId,action:D.BackupAppDeepLinkAction.CHANGE_DEVICE_FOLDERS}),e.stopPropagation()}},de.backupFinishSetup))),N&&!he&&Te,Fe&&i.default.createElement(a.MediaCellText,{key:"snippets_tags",variant:"subtitle",style:we},i.default.createElement("div",{className:"brws-file-snippets-tags-container"},be&&(0,c.isFile)(t)&&i.default.createElement("span",{className:"brws-file-snippets-media-search",style:we},i.default.createElement(v.AsyncMediaSearchSnippet,{mediaData:t.media_data,mediaFiltersVariant:$})),P&&i.default.createElement(o.FileSnippets,{snippets:t.snippets,lineClamp:j}),J&&Ce.length>0&&i.default.createElement("span",{className:"brws-file-snippets",style:we},i.default.createElement(f.TagsContainer,{tags:Ce.map(e=>e.value),highlightedIndexes:Ce.map((e,t)=>e.highlighted?t:void 0).filter(e=>void 0!==e),onTagClick:(e,s)=>{if(s){!(0,c.shouldHandleClick)(s)||(s.preventDefault(),s.stopPropagation())}(0,c.isFile)(t)&&(_.logTagClick(x,[t],"center_pane",e),m.redirectToSearchByTag(x,e.tag_text))},containerClassName:"brws-file-tags-container",chipClassName:"brws-file-tag",showMoreClassName:"brws-file-tags-show-more",chipSize:"xsmall",containerMaxRows:1,expandable:!1,showMoreWidth:100})))),N&&he&&Te)},t.FileNameCellContents.displayName="FileNameCellContents";const M=()=>({filesMovedString:g.intl.formatMessage({id:"WYezR2",defaultMessage:"Your existing files moved here."}),renameFileStr:g.intl.formatMessage({id:"44Ky+Q",defaultMessage:"Rename file"}),renameDirStr:g.intl.formatMessage({id:"YApL4x",defaultMessage:"Rename directory"}),renamingStr:g.intl.formatMessage({id:"KvygQC",defaultMessage:"Renaming…"}),backupNewLocationButtonStr:g.intl.formatMessage({id:"wX0e+1",defaultMessage:"New location"}),backupNewLocationTooltipStr:g.intl.formatMessage({id:"Pn0YTw",defaultMessage:"Backups have a new home"}),backupFinishSetup:g.intl.formatMessage({id:"n2sso0",defaultMessage:"Finish setup"})})})),define("metaserver/static/js/files_view/file_name/file_name_subtitle",["require","exports","tslib","react","metaserver/static/js/clean/browse_interface","js/filepath/filepath","metaserver/static/js/files_view/util","metaserver/static/js/core/i18n","metaserver/static/js/files_view/file_name/truncation_helpers"],(function(e,t,s,i,a,r,o,n,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FileSubtitle=void 0,i=s.__importDefault(i),r=s.__importStar(r);t.FileSubtitle=({file:e,renderAsLink:t=!0,user:s,containerWidth:c,onClick:d,focusable:u,isInsideBackupFolder:p})=>{const g={notAddedYetString:e=>n.intl.formatMessage({id:"hY0d5Z",defaultMessage:"not added yet, in {location}"},{location:e}),sharedWithYouString:n.intl.formatMessage({id:"FWJkxz",defaultMessage:"Shared with you"}),formattedLocationText:e=>n.intl.formatMessage({id:"yR1l4z",defaultMessage:"in {location}"},{location:e})};if(!(0,o.isFile)(e))return i.default.createElement(i.default.Fragment,null,g.sharedWithYouString);const h=r.parent_dir(e.fq_path),_="/"===h?(0,a.get_browse_root_name)(s):h.slice(1);if(e.is_unmounted)return i.default.createElement(i.default.Fragment,null,g.notAddedYetString(_));const m=(0,l.truncateTextInFilenameCell)(g.formattedLocationText(_),12,6,c);if(!t||e.isDeleted)return i.default.createElement(i.default.Fragment,null,m);const f=(0,a.browse_uri_for_fq_path)(s,h,void 0,{isBackup:p});return i.default.createElement("a",{className:"brws-file-name-cell-location",href:f.toString(),onClick:d,tabIndex:u?0:-1},m)},t.FileSubtitle.displayName="FileSubtitle",t.FileSubtitle.displayName="FileSubtitle"})),define("metaserver/static/js/files_view/file_name/file_name_title",["require","exports","tslib","react","js/filepath/filepath","metaserver/static/js/browse/models","metaserver/static/js/files_view/constants","metaserver/static/js/files_view/util","metaserver/static/js/clean/ui/title_bubble","metaserver/static/js/user_education/react/user_education_effect","metaserver/static/js/clean/ui/sticky_position","typescript/component_libraries/retrieval-components/src/highlighted-truncated-string/index","metaserver/static/js/files_view/file_name/truncation_helpers","metaserver/static/js/pnm/utils","metaserver/static/js/modules/constants/web_experience_constants","metaserver/static/js/files_view/contexts/override_context"],(function(e,t,s,i,a,r,o,n,l,c,d,u,p,g,h,_){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FileNameTitle=void 0,i=s.__importDefault(i),a=s.__importStar(a);const m=e=>e instanceof r.FileSharedWithMe;t.FileNameTitle=({file:e,user:t,hrefForFile:s,showHighlights:f,showUserEducationEffects:S,userEducationEffectName:v,isSelected:E,containerWidth:y,onNameClick:T,isTooltipEnabled:w})=>{const b=e instanceof r.File&&e.is_dir?(0,g.getDisplayedFilename)((0,n.getFilename)(e)):(0,n.getFilename)(e),F=i.default.useRef(null),C=i.default.useMemo(()=>((e,t,s)=>{if(!t||m(e)||!s.current)return!1;const i=s.current,r=a.filename(e.fq_path),o=i.offsetWidth<i.scrollWidth,n=i.textContent!==r;return o||n})(e,w,F),[e,w]),I=i.default.useContext(_.FilesViewOverrideContext);let R,D;if(y)R=i.default.createElement(u.HighlightedTruncatedString,{text:b,className:"brws-file-name-element",fontSize:14,availableWidth:y,highlightSpans:(0,p.getHighlightedSpansForHighlightedTruncatedString)(b,e),cellBuffer:3,isBold:I.isBoldFileNamesEnabled});else{const t=(0,p.truncateTextInFilenameCell)(b,14,3,y);R=f&&(e.highlight_spans||(0,n.isFile)(e)&&e.filename_highlights)?(0,p.getHighlightedSpan)(t,e):i.default.createElement("span",null,t),R=i.default.createElement("div",{className:"brws-file-name-element",ref:F},R)}if(C){const e=b.length<=o.FILE_NAME_TOOLTIP_MAX_LINE_LENGTH?b:i.default.createElement("div",{className:"brws-file-name-cell-tooltip"},b);R=i.default.createElement(l.TitleBubble,{content:e,position:d.StickyPosition.BOTTOM,className:"list-label__title-bubble"},R)}return m(e)?D=e.href:e.is_unmounted||e.isDeleted||(D=null==s?void 0:s(t,e)),void 0!==D&&(R=("V1"===h.WEBXP_IA_RR_PREVIEW_BROWSE||"V2"===h.WEBXP_IA_RR_PREVIEW_BROWSE)&&e instanceof r.File?i.default.createElement("div",{tabIndex:E?0:-1,className:"brws-file-name-cell-filename"},R):i.default.createElement("a",{className:"brws-file-name-cell-filename",href:D,onClick:T,onAuxClick:T,tabIndex:E?0:-1},R)),S&&(R=i.default.createElement(c.UserEducationEffect,{containerName:"FileNameLabel",name:v||"FileNameLabel",useSpan:!0},R)),R},t.FileNameTitle.displayName="FileNameTitle",t.FileNameTitle.displayName="FileNameTitle"})),define("metaserver/static/js/files_view/file_name/truncation_helpers",["require","exports","tslib","react","metaserver/static/js/clean/em_string","metaserver/static/js/clean/filename_highlights","metaserver/static/js/browse/models","metaserver/static/js/files_view/util"],(function(e,t,s,i,a,r,o,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getHighlightedSpansForHighlightedTruncatedString=t.getHighlightedSpan=t.truncateTextInFilenameCell=void 0,i=s.__importDefault(i);t.truncateTextInFilenameCell=function(e,t,s,i){if(i&&i>32){const r=(i-32)/t,o=Math.max(s,r-s);return a.Emstring.em_snippet(e,Math.floor(o),.5)}return e},t.getHighlightedSpan=function(e,t){const s=(0,n.getFilename)(t),a=(function(e,t){let s=0;for(;s<e.length&&e.charAt(s)===t.charAt(s);)++s;return s===e.length||"…"!==e.charAt(s)?[e]:[e.substring(0,s),e.substring(s+1)]})(e,s);if(1===a.length)return(0,n.isFile)(t)&&!t.highlight_spans?(0,r.highlightMatchReact)(e,t.filename_highlights):(0,r.highlightReactFromHighlightSpans)(e,t.highlight_spans);let o,l;return(0,n.isFile)(t)&&!t.highlight_spans?(o=(0,r.highlightMatchReact)(s,t.filename_highlights,0,a[0].length),l=(0,r.highlightMatchReact)(s,t.filename_highlights,s.lastIndexOf(a[1]))):(o=(0,r.highlightReactFromHighlightSpans)(s,t.highlight_spans,0,a[0].length),l=(0,r.highlightReactFromHighlightSpans)(s,t.highlight_spans,s.lastIndexOf(a[1]))),i.default.createElement("span",null,o,"…",l)},t.getHighlightedSpansForHighlightedTruncatedString=function(e,t){if((0,n.isFile)(t)||(e=>e instanceof o.FileSharedWithMe)(t)){if(t.highlight_spans)return t.highlight_spans.map(e=>({string:e.highlight_str,isHighlighted:e.is_highlighted}));if((0,n.isFile)(t)&&t.filename_highlights){return(0,r.highlightMatchSections)(e,t.filename_highlights).map(e=>({string:e.text,isHighlighted:e.isHighlighted}))}}}})),define("metaserver/static/js/files_view/file_name/renaming_bar_modal_overlay",["require","exports","tslib","react","metaserver/static/js/components/ui/css","lodash","dig-components/overlay","dig-components/layer","dig-components/buttons","dig-components/icons/src","dig-components/icons","metaserver/static/js/files_view/data/store","metaserver/static/js/files_view/data/action_creators","metaserver/static/js/files_view/file_name/renaming_bar_api_v2","metaserver/static/js/clean/web_user_action_events","metaserver/static/js/clean/web_user_action_logger","metaserver/static/js/browse/data/store","metaserver/static/js/browse/data/selectors","metaserver/static/js/files_view/file_name/renaming_bar_strings","metaserver/static/js/files_view/util","metaserver/static/js/pap/analytics_client","metaserver/static/js/dropbox/proto/pap_events/naming_conventions/attempt_naming_convention","metaserver/static/js/dropbox/proto/pap_events/naming_conventions/dismiss_renaming_bar","metaserver/static/js/dropbox/proto/pap_events/naming_conventions/shown_naming_conventions_modal","metaserver/static/js/dropbox/proto/pap_events/naming_conventions/shown_renaming_bar","metaserver/static/js/dropbox/proto/pap_events/naming_conventions/select_ml_suggested_name","metaserver/static/js/pap/util"],(function(e,t,s,i,a,r,o,n,l,c,d,u,p,g,h,_,m,f,S,v,E,y,T,w,b,F,C){"use strict";var I,R;Object.defineProperty(t,"__esModule",{value:!0}),t.isDefaultRules=t.RenamingBarModalOverlay=t.RenamingBarModalOverlayComponent=t.RenamingBarDismissState=t.RenamingBarType=void 0,i=s.__importDefault(i),(function(e){e.RENAME_HEURISTIC="RENAME_HEURISTIC",e.RENAME_EXISTING="RENAME_EXISTING",e.ML_SUGGESTED_NAME="ML_SUGGESTED_NAME",e.UPLOAD="UPLOAD"})(I=t.RenamingBarType||(t.RenamingBarType={})),(function(e){e.NOT_DISMISSED="NOT_DISMISSED",e.DISMISSED_LAST_RENDER="DISMISSED_LAST_RENDER",e.DISMISSED_LAST_RENDER_BUT_CONTINUE_TO_APPEAR="DISMISSED_LAST_RENDER_BUT_CONTINUE_TO_APPEAR",e.DISMISSED="DISMISSED",e.DISMISSED_BUT_CONTINUE_TO_APPEAR="DISMISSED_BUT_CONTINUE_TO_APPEAR"})(R=t.RenamingBarDismissState||(t.RenamingBarDismissState={}));const D=new Set([I.RENAME_EXISTING,I.ML_SUGGESTED_NAME]),O=b.pap_events.naming_conventions.Shown_RenamingBar.RenamingBarType,A=y.pap_events.naming_conventions.Attempt_NamingConvention.NamingConventionsOrigin,M=()=>s.__awaiter(void 0,void 0,void 0,(function*(){const[{NamingConventionType:t,DateFormatSelection:i,ConsistentSeparatorSelection:a,NamingConventionOrigin:r,FolderScopeOptions:o},{ncOriginToPapOrigin:n}]=yield Promise.all([new Promise((t,s)=>{e(["metaserver/static/js/naming_conventions/types"],t,s)}).then(s.__importStar),new Promise((t,s)=>{e(["metaserver/static/js/naming_conventions/utils"],t,s)}).then(s.__importStar)]);return{renamingBarTypeToNcOrigin:{[I.RENAME_HEURISTIC]:r.from_heuristic_renaming_bar,[I.RENAME_EXISTING]:r.from_existing_nc_renaming_bar,[I.UPLOAD]:r.from_upload_renaming_bar,[I.ML_SUGGESTED_NAME]:r.from_unknown_nc_origin},renamingBarTypeToPapRenamingBarType:{[I.RENAME_HEURISTIC]:(0,C.getEnumValueForString)("HEURISTIC_RENAMING_BAR_TYPE",O),[I.RENAME_EXISTING]:(0,C.getEnumValueForString)("EXISTING_NC_RENAMING_BAR_TYPE",O),[I.ML_SUGGESTED_NAME]:(0,C.getEnumValueForString)("ML_SUGGESTED_NAME_RENAMING_BAR_TYPE",O),[I.UPLOAD]:(0,C.getEnumValueForString)("UPLOAD_RENAMING_BAR_TYPE",O)},ncOriginToPapOrigin:n,selectedRules:[t.consistent_separators,t.capitalize_all_initials,t.upload_date],change_all_separators_options:a.spaces,start_with_date_options:i.yyyy_mm_dd,subfolderOptions:o.THIS_FOLDER_ONLY}}));class L extends i.default.Component{constructor(){var t;super(...arguments),this.state={suggestedRename:(t=this.props,t.fqPath.substring(t.fqPath.lastIndexOf("/")+1)),isFilenameAlreadyConformed:!1,promptLabel:S.renamingBarHeuristicMsg,applyLabel:S.applyButtonMsg,acceptLabel:S.suggestedNameAcceptButtonMsg,openNCModalLabel:S.moreOptionsButtonMsg},this.onWindowResize=(0,r.throttle)(()=>{this.props.anchorRef.current},500),this.updateSuggestedRename=(e,t,s)=>{let i={component_list:[{".tag":"upload_date",ml_identification:!1,date_format:{".tag":"yyyy_mm_dd"}},{".tag":"original_snippet",original_snippet:{".tag":"original_snippet"}}],capitalize_all_initials:{".tag":"capitalize_all_initials"},change_all_separators:{".tag":"spaces"}};void 0!==this.props.namingConventionsRules&&(i=this.props.namingConventionsRules),(0,g.namingConventionsFilePreview)(e,t,s,i).then(e=>{this.setState({suggestedRename:e.filename_suggestion.length>0?e.filename_suggestion[0].suggested_rename:s,isFilenameAlreadyConformed:e.filename_suggestion.length<=0})})},this.handleClick=e=>{e.preventDefault(),e.stopPropagation()},this.handleApplyToFileClick=()=>s.__awaiter(this,void 0,void 0,(function*(){var t,i;if(this.hideUploadRenamingBarIfShown(),(0,u.getStoreForFilesView)().dispatch((0,p.updateNamingConventionsApplyStatus)({isApplyClicked:!0})),this.state.isFilenameAlreadyConformed){const{showNoTargetSnackbar:t}=yield new Promise((t,s)=>{e(["metaserver/static/js/naming_conventions/actions"],t,s)}).then(s.__importStar);return void t()}const a=this.props.fqPath.substring(0,this.props.fqPath.lastIndexOf("/")),[{applyNamingConventions:r},{renamingBarTypeToNcOrigin:o,ncOriginToPapOrigin:n,change_all_separators_options:l,start_with_date_options:c,selectedRules:d,subfolderOptions:g}]=yield Promise.all([new Promise((t,s)=>{e(["metaserver/static/js/naming_conventions/actions"],t,s)}).then(s.__importStar),M()]);if(_.WebUserActionLog.log(this.props.userId,h.WebUserActionLogEvent.NAMING_CONVENTIONS_APPLY,{ns_id:this.props.namespaceId,start_with_date:1,start_with_date_options:c,change_all_separators:1,change_all_separators_options:l,capitalize_all_initials:1,include_parent_folder_name:0,end_with_keyword:0,origin:o[this.props.renamingBarType],file_count:1,automation:"unchanged"}),this.props.renamingBarType===I.RENAME_EXISTING||this.props.renamingBarType===I.ML_SUGGESTED_NAME)(0,v.isFile)(this.props.file)&&(null===(i=(t=this.props).onRenameSubmit)||void 0===i||i.call(t,this.props.file,this.state.suggestedRename));else{const e={selectedRules:d,dateFormatSelection:c,consistentSeparatorSelection:l,mlFilenameParsing:!1,data:{keyword:""},subfolderOption:g},t={".tag":"renaming_bar"};r({userId:this.props.userId,fqPath:a,nameUpdates:[{file:this.props.fqPath,suggested_rename:this.state.suggestedRename}],reopenModal:void 0,nsId:0,newRules:e,prevRules:e,automationToggled:!1,updateAutomation:!1,isAutomationEligibleFolder:!1,origin:t})}(0,E.logEvent)(y.pap_events.naming_conventions.Attempt_NamingConvention.create({namingConventionsOrigin:n(o[this.props.renamingBarType],A)}))})),this.handleAcceptSuggestedName=()=>{var e,t;this.props.renamingBarType===I.ML_SUGGESTED_NAME&&this.state.suggestedRename&&(null===(t=(e=this.props).updateMlSuggestedName)||void 0===t||t.call(e,this.state.suggestedRename),(0,E.logEvent)(F.pap_events.naming_conventions.Select_MlSuggestedName.create({mlSuggestedNamePredictionId:this.props.predictionId})))},this.handleMoreOptionsClick=()=>s.__awaiter(this,void 0,void 0,(function*(){this.hideUploadRenamingBarIfShown(),(0,u.getStoreForFilesView)().dispatch((0,p.updateNamingConventionsApplyStatus)({isApplyClicked:!0}));const t=this.props.fqPath.substring(0,this.props.fqPath.lastIndexOf("/")),i=(0,f.postTTIExperiments)((0,m.getStoreForBrowse)().getState()).expNamingConventionsPositioning,[{showNamingConventionsModal:a},{renamingBarTypeToNcOrigin:r,ncOriginToPapOrigin:o}]=yield Promise.all([new Promise((t,s)=>{e(["metaserver/static/js/naming_conventions/naming_conventions_modal"],t,s)}).then(s.__importStar),M()]);_.WebUserActionLog.log(this.props.userId,h.WebUserActionLogEvent.NAMING_CONVENTIONS_OPEN_MODAL,{ns_id:this.props.namespaceId,origin:r[this.props.renamingBarType],positioning:i?1:0}),(0,E.logEvent)(w.pap_events.naming_conventions.Shown_NamingConventionsModal.create({namingConventionsOrigin:o(r[this.props.renamingBarType],A)})),a({currentUserId:this.props.userId,targetPath:t,namespaceId:0,origin:r[this.props.renamingBarType]})})),this.hideUploadRenamingBarIfShown=()=>{this.props.uploadRenamingBarToggle(!1)},this.onClose=()=>{var e,t,s,i,a,r;D.has(this.props.renamingBarType)?null===(t=(e=this.props).setRenamingBarDismissState)||void 0===t||t.call(e,R.DISMISSED_LAST_RENDER_BUT_CONTINUE_TO_APPEAR):(null===(i=(s=this.props).setRenamingBarDismissState)||void 0===i||i.call(s,R.DISMISSED_LAST_RENDER),null===(r=(a=this.props).setRenamingBarDisabled)||void 0===r||r.call(a,!0),(0,g.renamingBarDismiss)(this.props.userId)),M().then(({renamingBarTypeToPapRenamingBarType:e})=>{(0,E.logEvent)(T.pap_events.naming_conventions.Dismiss_RenamingBar.create({renamingBarType:e[this.props.renamingBarType],mlSuggestedNamePredictionId:this.props.renamingBarType===I.ML_SUGGESTED_NAME?this.props.predictionId:void 0}))})}}componentDidMount(){if(window.addEventListener("resize",this.onWindowResize),this.props.renamingBarType===I.ML_SUGGESTED_NAME)return this.setState({promptLabel:S.renamingBarSuggestedNameMsg,applyLabel:void 0,openNCModalLabel:void 0,suggestedRename:""}),void(0,g.getMlSuggestedName)(this.props.userId,this.props.fqPath).then(e=>{const t=this.props.fqPath.lastIndexOf("/")+1;e.suggested_name!==this.props.fqPath.substring(t)&&(this.setState({suggestedRename:e.suggested_name}),this.props.setPredictionId(e.prediction_id),M().then(({renamingBarTypeToPapRenamingBarType:e})=>{(0,E.logEvent)(b.pap_events.naming_conventions.Shown_RenamingBar.create({renamingBarType:e[I.ML_SUGGESTED_NAME],mlSuggestedNamePredictionId:this.props.predictionId}))}))});(void 0!==this.props.renameInput&&""!==this.props.renameInput||this.props.renamingBarType===I.UPLOAD)&&this.updateSuggestedRename(this.props.userId,this.props.fqPath,this.state.suggestedRename),this.props.renamingBarType===I.RENAME_EXISTING?this.setState({promptLabel:S.renamingBarExistingNCMsg,applyLabel:S.applyButtonMsg,openNCModalLabel:S.moreOptionsButtonMsg}):this.setState({promptLabel:S.renamingBarHeuristicMsg,applyLabel:S.applyButtonMsg,openNCModalLabel:S.moreOptionsButtonMsg}),M().then(({renamingBarTypeToPapRenamingBarType:e})=>{(0,E.logEvent)(b.pap_events.naming_conventions.Shown_RenamingBar.create({renamingBarType:e[this.props.renamingBarType]}))})}componentDidUpdate(e){this.props.renamingBarType!==I.ML_SUGGESTED_NAME&&e.renameInput!==this.props.renameInput&&void 0!==this.props.renameInput&&""!==this.props.renameInput&&this.updateSuggestedRename(this.props.userId,this.props.fqPath,this.props.renameInput)}componentWillUnmount(){window.removeEventListener("resize",this.onWindowResize)}render(){return this.state.suggestedRename?i.default.createElement(n.Layer,{_elevateByZ:10},i.default.createElement(o.Overlay,{className:"renaming-bar-overlay",anchorRef:this.props.anchorRef,placement:"bottom-start",auto:!0,onClick:this.handleClick,"data-testid":"renaming-bar-overlay",isPortaled:!1},i.default.createElement("div",{className:"renaming-bar-overlay-header"},i.default.createElement("p",{className:"renaming-bar-overlay-header-content"},this.state.promptLabel),i.default.createElement(l.IconButton,{variant:"transparent"},i.default.createElement(d.UIIcon,{src:c.CloseLine,"aria-label":"Close Renaming Bar","data-testid":"renaming-bar-overlay-close-button",onClick:this.onClose}))),i.default.createElement("div",{className:"renaming-bar-overlay-body"},i.default.createElement("div",{className:"renaming-bar-overlay-body-content"},i.default.createElement(l.IconButton,{className:"renaming-bar-overlay-body-content-icon",variant:"transparent"},i.default.createElement(d.UIIcon,{src:c.FileLine,"aria-label":"suggested filename"})),i.default.createElement("div",{className:"renaming-bar-overlay-body-content-filename","data-testid":"suggested-name-label"},this.state.suggestedRename)),this.state.acceptLabel&&this.props.renamingBarType===I.ML_SUGGESTED_NAME&&i.default.createElement(l.Button,{variant:"transparent",onClick:this.handleAcceptSuggestedName},this.state.acceptLabel),this.state.applyLabel&&i.default.createElement(l.Button,{variant:"transparent",onClick:this.handleApplyToFileClick},this.state.applyLabel),this.state.openNCModalLabel&&i.default.createElement(l.Button,{variant:"transparent",className:"renaming-bar-overlay-body-button",onClick:this.handleMoreOptionsClick},this.state.openNCModalLabel)))):null}}t.RenamingBarModalOverlayComponent=L,L.displayName="RenamingBarModalOverlayComponent",t.RenamingBarModalOverlay=(0,a.requireCssWithComponent)(L,["/static/metaserver/static/css/dig-components/index.web-vflD7DS1H.css","/static/metaserver/static/css/files_view/renaming_bar-vflQRtwNV.css"]),t.isDefaultRules=function(e){return e.start_with_date&&"yyyy_mm_dd"===e.start_with_date[".tag"]&&e.change_all_separators&&"spaces"===e.change_all_separators[".tag"]&&e.capitalize_all_initials&&"capitalize_initials"===e.capitalize_all_initials[".tag"]&&!e.data&&!e.end_with_keyword&&!e.include_parent_folder_name&&!e.ml_filename}})),define("metaserver/static/js/files_view/name_input",["require","exports","tslib","react","ts-key-enum","metaserver/static/js/files_view/types","dig-components/text_fields","metaserver/static/js/files_view/data/store","metaserver/static/js/files_view/data/action_creators","metaserver/static/js/files_view/data/selectors/files_view_selectors"],(function(e,t,s,i,a,r,o,n,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NameInput=void 0,i=s.__importDefault(i);const d=()=>{};class u extends i.default.PureComponent{constructor(){super(...arguments),this.inputRef=i.default.createRef(),this.handleDragStart=e=>{e.stopPropagation()},this.handleSubmit=e=>{e.preventDefault(),this.submitIfChanged(r.NameInputActionSource.SUBMIT)},this.handleKeyDown=e=>{e.key===a.Key.Escape?(e.preventDefault(),this.props.onCancel({source:r.NameInputActionSource.ESC})):e.key===a.Key.Enter&&this.handleSubmit(e)},this.handleBlur=e=>{this.props.isRenamingBarEnabled?setTimeout(()=>{var e;null!==(e=this.props.wasRenamingBarDismissedLastRender())&&void 0!==e&&e?this.inputRef.current&&this.inputRef.current.focus():this.submitIfChanged(r.NameInputActionSource.BLUR)},200):this.submitIfChanged(r.NameInputActionSource.BLUR)},this.handleClick=e=>{e.preventDefault(),this.props.onClick(e)},this.handleChange=e=>{(0,n.getStoreForFilesView)().dispatch((0,l.updateFileRenameInput)({renameInput:e.currentTarget.value}))}}componentDidMount(){this.inputRef.current&&this.inputRef.current.focus(),window.requestAnimationFrame(()=>{if(!this.inputRef.current)return;const e=this.inputRef.current.value;let t=this.props.ignoreFileExtension?e.length:e.lastIndexOf(".");t<0&&(t=e.length),this.inputRef.current.setSelectionRange(0,t)})}submitIfChanged(e){var t,s,i;if(this.inputRef.current){const a=this.inputRef.current.value.trim();a===this.props.defaultValue||!0===(null===(t=(0,c.fileRename)((0,n.getStoreForFilesView)().getState()))||void 0===t?void 0:t.isNamingConventionsApplied)||this.props.mlSuggestedName?(this.props.onCancel({source:e}),this.props.mlSuggestedName&&(null===(i=(s=this.props).handleAcceptMlSuggestedName)||void 0===i||i.call(s))):this.props.onSubmit(a)}}render(){return i.default.createElement("form",{className:"u-pad-right-xs",onSubmit:this.handleSubmit},i.default.createElement(o.TextInput,{ref:this.inputRef,defaultValue:this.props.defaultValue,className:this.props.className,onBlur:this.handleBlur,onKeyDown:this.handleKeyDown,onDragStart:this.handleDragStart,"aria-label":this.props.label,onClick:this.handleClick,onChange:this.handleChange}))}}t.NameInput=u,u.defaultProps={className:"",onCancel:d,onClick:d,onSubmit:d,idDir:null},u.displayName="NameInput"})),define("metaserver/static/js/files_view/tile_label_input",["require","exports","tslib","classnames","react","metaserver/static/js/files_view/name_input"],(function(e,t,s,i,a,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TileLabelInput=void 0,i=s.__importDefault(i),a=s.__importDefault(a),t.TileLabelInput=function(e){const t=(0,i.default)("tile-label-input",e.className),s=e.defaultValue||"";return a.default.createElement(r.NameInput,{className:t,defaultValue:s,label:e.label,onCancel:e.onCancel,onClick:e=>{e&&(e.stopPropagation(),e.preventDefault())},onSubmit:e.onSubmit})}})),define("metaserver/static/js/files_view/tile_grid",["require","exports","tslib","classnames","immutable","react","metaserver/static/js/clean/em_string","js/filepath/filepath","metaserver/static/js/clean/filetypes","metaserver/static/js/browse/action_logger","metaserver/static/js/browse/models","metaserver/static/js/files_view/constants","metaserver/static/js/files_view/drag_drop/drag_and_drop","metaserver/static/js/files_view/file_list_utils","metaserver/static/js/files_view/keyboard_shortcuts","metaserver/static/js/files_view/overflow_menu","metaserver/static/js/files_view/star","metaserver/static/js/files_view/tile_label_input","metaserver/static/js/files_view/types","metaserver/static/js/files_view/util","metaserver/static/js/icon/file_folder_icon","metaserver/static/js/files_view/base_tile_grid","metaserver/static/js/clean/ui/selectable_list","metaserver/static/js/clean/ui/sticky_position","metaserver/static/js/clean/ui/title_bubble","metaserver/static/js/clean/web_user_action_events","metaserver/static/js/core/browser","metaserver/static/js/core/i18n"],(function(e,t,s,i,a,r,o,n,l,c,d,u,p,g,h,_,m,f,S,v,E,y,T,w,b,F,C,I){"use strict";function R(e){e.stopPropagation()}Object.defineProperty(t,"__esModule",{value:!0}),t.FilesViewTileGrid=t.TileLabel=void 0,i=s.__importDefault(i),a=s.__importStar(a),r=s.__importDefault(r),n=s.__importStar(n),C=s.__importStar(C);class D extends r.default.PureComponent{render(){const{fileRename:e,arePostTTIModulesLoaded:t,user:s,item:i,createRenameCancelHandler:a,createRenameSubmitHandler:l}=this.props;let c;if(c=i instanceof d.File?n.filename(i.fq_path):i instanceof d.FileSharedWithMe?i.filename:i instanceof d.Paper?i.title:i.name,i instanceof d.File&&e&&n.paths_are_equal(e.file.fq_path,i.fq_path)){if(e.state===S.RenameState.PENDING_INPUT)return r.default.createElement(f.TileLabelInput,{defaultValue:c,label:c,onCancel:a(i),onSubmit:l(i)});if(e.state===S.RenameState.SAVING_INPUT)return r.default.createElement(y.TileItemLabelText,{className:"tile-label__text--saving",label:I.intl.formatMessage({id:"OefYpa",defaultMessage:"Renaming…"})})}const p=o.Emstring.em_snippet(c,14,.5),g=t&&i instanceof d.File&&!d.File.isNoAccessSharedFolder(i);let h=r.default.createElement(y.TileItemLabelText,{key:"label",label:p});if(c!==p){const e=c.length<=u.FILE_NAME_TOOLTIP_MAX_LINE_LENGTH?c:r.default.createElement("div",{className:"tile-label-tooltip"},c);h=r.default.createElement(b.TitleBubble,{content:e,position:w.StickyPosition.BOTTOM,className:"tile-label__title-bubble",key:"tooltip"},h)}const _=r.default.createElement(m.StarContainer,{item:i,user:s,className:"tile-star",key:"tileStar",tabIndex:-1});return r.default.createElement("span",null,[h,g&&!e&&_])}}t.TileLabel=D,D.displayName="TileLabel";class O extends r.default.PureComponent{constructor(){super(...arguments),this.tileGridRef=r.default.createRef(),this.state={inSelectMode:!1,selectedIds:a.Set(),menuOpenId:void 0},this.createRenameCancelHandler=e=>()=>{this.props.onRenameCancel(e)},this.createRenameSubmitHandler=e=>t=>{this.props.onRenameSubmit(e,t)},this.logOverflowMenuOpen=()=>{const{selectedFiles:e,user:t,viewType:s}=this.props,i=e?e.count(e=>e.is_dir):0,a=e?e.count()-i:0;(0,c.logContextMenuClick)({uid:t.id,viewType:s,action_surface:F.ActionSurfaceLogValue.CENTER_PANE,numFilesSelected:a,numFoldersSelected:i})},this.hrefForItem=(e,t)=>t instanceof d.File?this.props.hrefForFile(e,t):t instanceof d.FileSharedWithMe?t.href:t.url,this.getTileItem=(e,t)=>{const{activeDropTarget:s,isCreateFolderUIActive:i,isPhotosPage:a,items:r,selection:o,user:c,viewType:p,focusedFileIndex:g,disabledMultiselect:h,cutItems:_}=this.props,{menuOpenId:m}=this.state,{inSelectMode:f}=this.state;if(i){if(0===e)return this.getCreateFolderTile();e-=1}const y=r.get(e);if(!y){const t=`Placeholder ${e}`;return{altText:t,id:t,isViewOnly:!0,isDraggable:!1,isSelectable:!1}}const T=(0,v.isFile)(y)||(0,v.isFswm)(y),w=y,b=f&&T,F=g===e,C=b&&o.selected.some(e=>w instanceof d.FileSharedWithMe?w.file_id===e:w.fq_path===e),R=this.createToggleSelectHandler(w,C),D=this.createRightClickSelectHandler(w,C),O=this.createClickHandler({item:y,inSelectModeAndIsFile:b,toggleSelectHandler:R}),A=this.createRightClickHandler({item:y,rightClickSelectHandler:D}),M=this.createViewFileHandler(y,S.FilesViewActionSource.ROW_DOUBLE_CLICK),L=this.createViewFileHandler(y,S.FilesViewActionSource.ROW_TITLE),P=(0,v.isFile)(y)||(0,v.isFswm)(y)?this.renderTileOverflowMenu(y,t,a):void 0,N=this.renderLabelElement(e),j=(function(e){let t=e instanceof d.File?n.filename(e.fq_path):(0,v.isFswm)(e)?e.filename:e instanceof d.Paper?e.title:e.name;if(e instanceof d.File)switch(e.type){case l.FileTypes.FOLDER:t=I.intl.formatMessage({id:"C/gp+a",defaultMessage:"Folder, {alt}"},{alt:t});break;case l.FileTypes.PACKAGE:t=I.intl.formatMessage({id:"FhSkpL",defaultMessage:"Package, {alt}"},{alt:t});break;case l.FileTypes.SHARED_FOLDER:t=I.intl.formatMessage({id:"rWEPV0",defaultMessage:"Shared folder, {alt}"},{alt:t});break;case l.FileTypes.SANDBOX:t=I.intl.formatMessage({id:"+vbakm",defaultMessage:"Sandbox, {alt}"},{alt:t});break;case l.FileTypes.TEAM_SHARED_FOLDER:t=I.intl.formatMessage({id:"ZtOyAr",defaultMessage:"Team shared folder, {alt}"},{alt:t});break;case l.FileTypes.TEAM_MEMBER_FOLDER:t=I.intl.formatMessage({id:"1yRjbu",defaultMessage:"Team member folder, {alt}"},{alt:t});break;default:t=I.intl.formatMessage({id:"e8WrLw",defaultMessage:"File, {alt}"},{alt:t})}return t})(y),x=y===s,k=this.hrefForItem(c,y),U=y instanceof d.File||y instanceof d.FileSharedWithMe?(0,E.getThumbnailUrlForItem)(y.thumbnail_url_tmpl,u.ViewTypeThumbnailSizes[p]):void 0;return{file:w,paper:y instanceof d.Paper?y:void 0,fileSharedWithMe:y instanceof d.FileSharedWithMe?y:void 0,id:(0,d.itemId)(y),labelNode:N,altText:j,thumbnailUrl:U,actionNode:P,onClick:O,onRightClick:A,onDoubleClick:M,onLabelClick:L,isDraggable:!a&&(C||!b),isViewOnly:h,isFocused:F,isSelectable:T,handleToggleSelect:R,checkboxAriaText:I.intl.formatMessage({id:"o3Djy2",defaultMessage:"Select tile"}),href:k,onDragEnter:a?void 0:this.createDragEnterHandler(w,C,x),onDragStart:a?void 0:this.createDragStartHandler(w,C,R),onDragEnd:a?void 0:this.createDragEndHandler(),isCheckboxFocusable:a,isCutToClipboard:_&&(0,v.isCutToClipboard)(y,_),className:m===(0,d.itemId)(y)?"tile--hover-forced":void 0}},this.shouldFileBeHighlightedDropTarget=(e,t)=>{const{dropTargetHighlightMode:s}=this.props;return(0,g.canFileBeHighlightedDropTarget)({file:e,dropTargetHighlightMode:s})},this.scrollIntoView=({top:e,bottom:t},s)=>{const{viewportTopOffset:i=0}=this.props,{height:a,scrollTop:r,scrollTo:o}=this.getScrollPane(),n=a-i,l=r+n;e<r?o(0,e):t>l&&o(0,s&&t-e<n/2?t-n/2:t-n)}}UNSAFE_componentWillMount(){this.setState({inSelectMode:this.props.selectedFiles.count()>0}),this.setSelectedTiles(this.props)}componentDidMount(){this.setupExternalDragHandler(),this.setupKeyboardShortcuts()}componentWillUnmount(){this.props.isPhotosPage||(0,h.resetFileJumpKeyboardShortcuts)(T.SELECTABLE_TILE_GRID_KEY_SCOPE),(0,h.resetFilesViewKeyboardShortcuts)(T.SELECTABLE_TILE_GRID_KEY_SCOPE),(0,p.cleanupExternalDragHandler)(T.SELECTABLE_TILE_GRID_KEY_SCOPE)}UNSAFE_componentWillReceiveProps(e){e.selectedFiles!==this.props.selectedFiles&&(this.setSelectedTiles(e),this.setState({inSelectMode:e.selectedFiles.count()>0}))}componentDidUpdate(e){(e.createNewFolderState===S.NewFolderCreationState.PENDING_INPUT&&this.props.createNewFolderState===S.NewFolderCreationState.SAVING_INPUT||e.fileRename!==this.props.fileRename||e.items!==this.props.items||e.starredState!==this.props.starredState)&&this.tileGridRef.current&&this.tileGridRef.current.forceUpdate(),e.isActive!==this.props.isActive&&(this.props.isActive?this.setupKeyboardShortcuts():(0,h.resetFilesViewKeyboardShortcuts)(T.SELECTABLE_TILE_GRID_KEY_SCOPE))}getTotalNumItems(){const{items:e,totalNumItems:t,isCreateFolderUIActive:s}=this.props;let i=Math.max(e.size,t);return s&&(i+=1),i}createToggleSelectHandler(e,t){const s=e instanceof d.FileSharedWithMe?e.file_id:e.fq_path;return e=>{const{onDeselectFile:i,onSelectFile:a}=this.props,r=Boolean(!("keyCode"in e)&&e.shiftKey);t?i(s,r):a(s,r?T.SelectOptions.EXTEND:T.SelectOptions.DEFAULT)}}createRightClickSelectHandler(e,t){const s=e instanceof d.FileSharedWithMe?e.file_id:e.fq_path;return e=>{const{onSelectFile:i}=this.props,a=Boolean(!("keyCode"in e)&&(e.shiftKey||e.metaKey||e.ctrlKey));t||i(s,a?T.SelectOptions.EXTEND:T.SelectOptions.DEFAULT)}}renderTileOverflowMenu(e,t,s){const{getOverflowMenuActions:i,arePostTTIModulesLoaded:a,inlineActions:o}=this.props;return o&&e instanceof d.File?r.default.createElement("div",{onClick:R},r.default.createElement(o,{file:e,className:"tile__action-button--overflow-menu",onHoverLocked:({isOpen:t})=>{this.setState({menuOpenId:t?(0,d.itemId)(e):void 0})}})):a&&r.default.createElement(_.FilesViewOverflowMenu,{file:e,getOverflowMenuActions:i,size:_.OverflowMenuSize.Small,showBorders:!0,ariaHidden:!s,onMenuOpen:this.logOverflowMenuOpen})}renderLabelElement(e){const{items:t,focusedFileIndex:s,user:i,fileRename:a,arePostTTIModulesLoaded:o,isPhotosPage:n}=this.props;if(n)return;const l=t.get(e);if(!l)return;const{inSelectMode:c}=this.state,d=s===e;return r.default.createElement(D,{item:l,user:i,fileRename:a,arePostTTIModulesLoaded:o,inSelectMode:c,isTileFocused:d,createRenameCancelHandler:this.createRenameCancelHandler,createRenameSubmitHandler:this.createRenameSubmitHandler})}createViewFileHandler(e,t){return s=>{if(s.preventDefault(),s.stopPropagation(),"click"===s.type){const t=s;if(0===t.button){const s=this.hrefForItem(this.props.user,e);if((0,v.hasModifierKey)(t))return void C.open_tab(s)}}e instanceof d.File?this.props.onNavigateToFileOrFolder(e,{actionSource:t}):e instanceof d.FileSharedWithMe?this.props.onOpenFileSharedWithMe(e):e instanceof d.Paper&&this.props.onOpenPaper(e)}}createClickHandler({item:e,inSelectModeAndIsFile:t,toggleSelectHandler:s}){const i=e instanceof d.File||e instanceof d.FileSharedWithMe;return t=>{if(i){const i="keyCode"in t;if(t.preventDefault(),i)s(t);else{const i=e instanceof d.FileSharedWithMe?e.file_id:e.fq_path;this.props.onSelectFile&&(t.shiftKey?this.props.onSelectFile(i,T.SelectOptions.EXTEND):t.ctrlKey||t.metaKey?s(t):this.props.onSelectFile(i,T.SelectOptions.ONLY))}}}}createRightClickHandler({item:e,rightClickSelectHandler:t}){const s=e instanceof d.File||e instanceof d.FileSharedWithMe;return i=>{if(!s)return;const a="keyCode"in i;if(i.preventDefault(),a)t(i);else{if(!this.props.onSelectFile)return;const t=e instanceof d.FileSharedWithMe?e.file_id:e.fq_path,s=i.shiftKey||i.ctrlKey||i.metaKey?T.SelectOptions.EXTEND:T.SelectOptions.ONLY;this.props.onSelectFile(t,s)}}}setSelectedTiles(e){const t=a.Set().withMutations(t=>{e.selectedFiles.forEach(e=>{var s;t.add((s=e)instanceof d.FileSharedWithMe?s.file_id:s.fq_path)})});this.setState({selectedIds:t})}setupExternalDragHandler(){(0,p.setupExternalDragHandler)(T.SELECTABLE_TILE_GRID_KEY_SCOPE,()=>!!this.props.isDraggingInternalFiles,()=>!!this.props.isDraggingExternalFiles,this.props.onSetFileUploaderPath,".tile",()=>this.props.activeDropTarget,this.props.onSetDropTarget)}setupKeyboardShortcuts(){const{user:e,viewType:t,onDelete:s,onShowRename:i,deselectAll:a,getIsCurrentPathWriteable:r,getIsFileJumping:o,onAddFileJumpKeyCode:n,onResetFileJump:l,onCopyToClipboard:c,onCutToClipboard:d,onFocusSearchBar:u,onPasteFromClipboard:p,selectAll:g}=this.props,_=(0,h.generateGetIsGlobalEvent)(this),m=_;this.props.isPhotosPage||(0,h.setupFileJumpKeyboardShortcuts)({scope:T.SELECTABLE_TILE_GRID_KEY_SCOPE,getIsFileJumping:o,onAddFileJumpKeyCode:n,onResetFileJump:l}),(0,h.setupFilesViewKeyboardShortcuts)({user:e,viewType:t,getIsGlobalEvent:_,getIsItemEvent:m,getSelectedFiles:()=>this.props.selectedFiles,isCurrentPathWriteable:r,selectAllAction:g,deselectAllAction:a,onCopyToClipboard:c,onCutToClipboard:d,onDelete:s,onFocusSearchBar:u,onPasteFromClipboard:p,onShowRename:i,onNavigateToFileOrFolder:()=>{},onNavigateToParentFolder:()=>{},scope:T.SELECTABLE_TILE_GRID_KEY_SCOPE,onShowHelpMenu:this.props.onOpenKeyboardShortcutModal})}createDragEnterHandler(e,t,s){return i=>{this.props.onDragEnter(i,e,t,s)}}createDragStartHandler(e,t,s){const{preventSelectionOnDrag:i}=this.props;return a=>{t?this.props.onDragStart(a):(i||s(a),this.props.onDragStart(a,[e]))}}createDragEndHandler(){return e=>{this.props.onDragEnd(e)}}getCreateFolderTile(){const{createNewFolderState:e,onNewFolderCancel:t,onNewFolderSubmit:s}=this.props;let i=I.intl.formatMessage({id:"pxGZm3",defaultMessage:"New folder"}),a=r.default.createElement("div",null);return e===S.NewFolderCreationState.PENDING_INPUT?(i=I.intl.formatMessage({id:"ss4CO0",defaultMessage:"Folder name"}),a=r.default.createElement(f.TileLabelInput,{label:i,onCancel:t,onSubmit:s})):e===S.NewFolderCreationState.SAVING_INPUT&&(i=I.intl.formatMessage({id:"p58M12",defaultMessage:"Creating new folder…"}),a=r.default.createElement(y.TileItemLabelText,{className:"tile-label__text--saving",label:i})),{altText:i,id:"New folder tile",isDraggable:!1,isSelectable:!1,labelNode:a}}getScrollPane(){const{scrollContainer:e}=this.props;if(e&&e.current){const{clientHeight:t,scrollTop:s,scrollTo:i}=e.current;return{height:t,scrollTop:s,scrollTo:i?i.bind(e.current):()=>{}}}return{height:window.innerHeight,scrollTop:"scrollingElement"in window.document&&window.document.scrollingElement?window.document.scrollingElement.scrollTop:window.document.documentElement.scrollTop,scrollTo:window.scrollTo?window.scrollTo.bind(window):()=>{}}}getWindow(){const{scrollContainer:e}=this.props;return e&&e.current?(0,v.createFakeWindow)(e.current):window}render(){const{enableMaxHeightGrouping:e,sections:t,viewType:s,viewportTopOffset:a,scrollContainer:o,scrollPositionOffset:n,registerSelectableTile:l,isPhotosPage:c}=this.props,d=(0,i.default)({"file-tile-grid-container":!0,"file-tile-grid-container--show-checkboxes":this.state.inSelectMode,"file-tile-grid-container--click-to-select":!0}),p=new Set;return this.state.selectedIds.forEach(e=>p.add(e)),o&&!o.current?null:r.default.createElement("div",{role:"grid","aria-multiselectable":"true"},r.default.createElement(y.InfiniteTileGrid,{key:"tileGrid",ref:this.tileGridRef,totalNumItems:this.getTotalNumItems(),containerClass:d,rowClass:"file-tile-row",enableMaxHeightGrouping:e,delayRenderFullTile:!this.props.isCreateFolderUIActive,logTileLoading:!0,numThresholdRows:u.FilesViewTileGridConstants.NUM_THRESHOLD_ROWS,scrollDeltaThreshold:u.FilesViewTileGridConstants.SCROLL_DELTA_THRESHOLD,sectionStartIndices:t.sectionStartIndices,sectionLabels:t.sectionLabels,showLabels:!c,contentOffset:a,getTileItem:this.getTileItem,selectedIds:p,handleTTI:this.props.onTTI,onRangeInView:this.props.onRangeInView,tilesPerRow:this.props.tilesPerRow,onTilesPerRowChange:this.props.onTilesPerRowChange,activeDropTarget:this.props.activeDropTarget,maxTileWidth:u.ViewTypeGridSizes[s],tileHeight:u.ViewTypeGridSizes[s],shouldFileBeHighlightedDropTarget:this.shouldFileBeHighlightedDropTarget,scrollToIndex:this.props.focusedFileIndex,scrollIntoView:this.scrollIntoView,scrollPositionOffset:n||0,window:this.getWindow(),registerSelectableTile:l}))}}t.FilesViewTileGrid=O,O.defaultProps={enableMaxHeightGrouping:!1},O.displayName="FilesViewTileGrid"})),define("metaserver/static/js/files_view/rows/file_row",["require","exports","tslib","classnames","metaserver/static/js/files_view/file_actions/file_media_actions_v2","react","metaserver/static/js/flux/dispatcher","metaserver/static/js/browse/constants","spectrum/media_table/index","metaserver/static/js/media_filters/gating","js/filepath/filepath","metaserver/static/js/browse/models","metaserver/static/js/files_view/file_actions/file_media_actions","metaserver/static/js/files_view/file_name/file_name_cell","metaserver/static/js/files_view/rows/cells/file_row_checkbox","metaserver/static/js/files_view/rows/row","metaserver/static/js/files_view/thumbnail_media_cell","metaserver/static/js/files_view/types","metaserver/static/js/files_view/sort_types","metaserver/static/js/files_view/util","metaserver/static/js/core/browser","metaserver/static/js/core/exception","metaserver/static/js/files_view/rows/cells/modified_cell","metaserver/static/js/files_view/rows/cells/async_folder_size","metaserver/static/js/tagging/experiments","metaserver/static/js/browse/data/helpers","typescript/component_libraries/spectrum-sharing/src/utils/sharing_constants","metaserver/static/js/modules/constants/web_experience_constants","metaserver/static/js/browse/shared_with/redux/store","metaserver/static/js/browse/shared_with/redux/slice"],(function(e,t,s,i,a,r,o,n,l,c,d,u,p,g,h,_,m,f,S,v,E,y,T,w,b,F,C,I,R,D){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FileRow=void 0,i=s.__importDefault(i),r=s.__importDefault(r),d=s.__importStar(d),E=s.__importStar(E),y=s.__importStar(y);const O=()=>r.default.createElement("span",{"aria-hidden":!0},"--");class A extends r.default.Component{constructor(){super(...arguments),this.state={isHoverLocked:!1,rowIsDragging:!1},this.handleOpenFileClick=e=>this.handleOpenNewTabOrNavigate(e,f.FilesViewActionSource.ROW_PREVIEW_ICON),this.handleTitleClick=e=>this.handleOpenNewTabOrNavigate(e,f.FilesViewActionSource.ROW_TITLE),this.handleOpenNewTabOrNavigate=(e,t)=>{if(0===e.button||1===e.button){if((0,v.hasModifierKey)(e)&&"A"===e.currentTarget.tagName)return void e.stopPropagation();e.preventDefault(),e.stopPropagation();const s="A"===e.currentTarget.tagName?e.currentTarget.href:void 0;this.onNavigateToItem({openInNewTab:!1,actionSource:t,href:s,middleClick:1===e.button})}},this.onSelect=(e,t)=>{this.props.onSelect&&this.props.onSelect(this.props.fileToId(this.props.file),e,t);const s=this.props.file.fq_path;I.SHARED_WITH_REDUX?(0,R.getStoreForSharedWith)().dispatch((0,D.loadSharedLinkDataForPath)(s)):o.Dispatcher.dispatch({type:n.SharedWithActionType.LOAD_SHARED_LINK_DATA_FOR_PATH,data:{path:s}})},this.onDeselect=(e,t)=>{this.props.onDeselect&&this.props.onDeselect(this.props.fileToId(this.props.file),e,t)},this.onNavigateToItem=({openInNewTab:e,actionSource:t,href:s,middleClick:i})=>{if(e){const{file:e,user:t,hrefForFile:s}=this.props;E.open_tab(s(t,e))}else this.props.onNavigateToFileOrFolder(this.props.file,{actionSource:t,href:s,middleClick:i})},this.onDragEnter=e=>{const{file:t,isSelected:s,isActiveDropTarget:i}=this.props;this.props.onDragEnter(e,t,!!s,!!i)},this.onDragStart=e=>{this.setState({rowIsDragging:!0});const{file:t,isSelected:s,onDragStart:i}=this.props;i&&(s?i(e):i(e,[t]))},this.onDragEnd=e=>{this.setState({rowIsDragging:!1});const{onDragEnd:t}=this.props;t&&t(e)},this.onShowShare=()=>{this.props.onShowShare(this.props.file,C.SHARE_ACTION_ORIGIN_TYPE.BROWSE_FILE_ROW)},this.onPresentInZoom=()=>{this.props.onPresentInZoom&&this.props.onPresentInZoom(this.props.file)},this.handleHoverLocked=({isOpen:e})=>{this.setState({isHoverLocked:e})},this.getAriaLabelForColumn=(e,t)=>{switch(e.sortField){case S.SortField.FILENAME:return e.label+" "+d.filename(t.fq_path);case S.SortField.MODIFIED:return e.label+" "+t.ago;case S.SortField.CATEGORY:return e.label+" "+u.File.getCategoryDescription(t);case S.SortField.EXTENSION:return e.label+" "+u.File.getExtension(t);case S.SortField.SIZE:return e.label+" "+t.size;case S.SortField.SHARED_WITH:default:return}},this.renderMediaActions=(e,t)=>{const{instanceId:s,arePostTTIModulesLoaded:i,canDisplayFolderSizes:o,file:n,getOverflowMenuActions:l,isCompactMode:c,responsive:d,isSelectMode:u,isSelected:g,isSharingDisabled:h,renameState:_,shareButtonLabel:m,showShareButton:f,user:S,viewportTopOffset:v,isActionBarEnabled:E}=this.props,y=!d.isMatchedLarge&&!d.isMatchedMedium;return!(y&&(_||u))?E?e||y?r.default.createElement(a.FileMediaActionsV2,{instanceId:s,file:n,highlighted:g,onHoverLocked:this.handleHoverLocked,isMobile:y}):void 0:r.default.createElement(p.FileMediaActions,{arePostTTIModulesLoaded:i,canDisplayFolderSizes:o,file:n,getOverflowMenuActions:l,isCompactMode:!!c,isHovered:e,isSelectMode:!!u,isSharingDisabled:!!h,onOpenFileClick:this.handleOpenFileClick,onPresentInZoom:this.onPresentInZoom,onShowShare:this.onShowShare,shareButtonLabel:m,showShareButton:f,showBorders:t,user:S,viewportTopOffset:v}):void 0},this.handleRenderPrivacyColumnClientAccessCell=e=>this.props.renderPrivacyColumnClientAccessCell?this.props.renderPrivacyColumnClientAccessCell({file:e,user:this.props.user}):r.default.createElement(r.default.Fragment,null)}renderCell({isHovered:e,sortField:t,renderCell:s}){var i,a;const{instanceId:o,itemIndex:n,rowIndex:d,fileToId:p,visibleColumns:h,containerWidth:_,height:f,file:v,hrefForFile:E,isSearchMode:F,isSelectMode:C,onLocationLinkClick:I,onRenameCancel:R,onRenameSubmit:D,filteredContactName:A,showCDMUserEducationEffects:M,iconSize:L,isCondensedListView:P,columnSizes:N,renderSharedWithController:j,isSelected:x,expManualTagging:k,preventSelectionOnDrag:U,mediaFiltersVariant:H}=this.props;if(s)return s({file:v});const W=null==N?void 0:N[t];switch(t){case S.SortField.FILENAME:return r.default.createElement(m.ThumbnailMediaCell,{key:"fileName",file:v,height:f,width:W,showCDMUserEducationEffects:M,iconSize:L},r.default.createElement(g.FileNameCell,{instanceId:o,itemIndex:n,rowIndex:d,isHovered:e,fileToId:p,visibleColumns:h,containerWidth:_,onLocationLinkClick:I,onRenameCancel:R,onRenameSubmit:D,hrefForFile:E,onNameClick:this.handleTitleClick,onSelect:this.onSelect,onDragStart:this.onDragStart,draggable:!C,showTags:F&&(0,b.isTaggingEnabled)(k),mediaFiltersVariant:F?H:"OFF",preventSelectionOnDrag:U}));case S.SortField.RELEVANCE:case S.SortField.MODIFIED:return r.default.createElement(T.ModifiedCell,{key:"modified",file:v,filteredContactName:A,isSearchMode:Boolean(F),shouldBubbleSubtitle:P,width:W});case S.SortField.SHARED_WITH:case S.SortField.CATEGORY:case S.SortField.EXTENSION:case S.SortField.SIZE:case S.SortField.LOCKED_FILES:case S.SortField.CLIENT_ACCESS:{const e=void 0===W?{}:{width:W,minWidth:W,maxWidth:W},s={[S.SortField.SHARED_WITH]:j(v,x?0:void 0),[S.SortField.CATEGORY]:null,[S.SortField.EXTENSION]:null,[S.SortField.SIZE]:null,[S.SortField.LOCKED_FILES]:null,[S.SortField.CLIENT_ACCESS]:this.handleRenderPrivacyColumnClientAccessCell(v)}[t],o={[S.SortField.SHARED_WITH]:void 0,[S.SortField.CATEGORY]:u.File.getCategoryDescription(v),[S.SortField.EXTENSION]:u.File.getExtension(v),[S.SortField.SIZE]:r.default.createElement(w.SizeCellTitle,{file:v}),[S.SortField.LOCKED_FILES]:void 0,[S.SortField.CLIENT_ACCESS]:void 0}[t],n={[S.SortField.SHARED_WITH]:"sharedWith",[S.SortField.CATEGORY]:"category",[S.SortField.EXTENSION]:"extension",[S.SortField.SIZE]:"size",[S.SortField.LOCKED_FILES]:"locked_files",[S.SortField.CLIENT_ACCESS]:"client_access"}[t],d={[S.SortField.SHARED_WITH]:"brws-file-shared-with-cell",[S.SortField.CATEGORY]:"brws-file-category-cell",[S.SortField.EXTENSION]:"brws-file-extension-cell",[S.SortField.SIZE]:"brws-file-size-cell",[S.SortField.LOCKED_FILES]:"brws-file-size-cell",[S.SortField.CLIENT_ACCESS]:void 0}[t];let p=void 0;if(t===S.SortField.SIZE&&F&&(0,c.isMediaFiltersEnabled)(H)){const e=null===(i=v.media_data)||void 0===i?void 0:i.data.image_width,t=null===(a=v.media_data)||void 0===a?void 0:a.data.image_height;p=e&&t?`${e}x${t} px`:"​"}return r.default.createElement(l.MediaCell,{className:d,subtitle:p,title:o,style:e,key:n},s)}default:return y.reportException({err:new Error("renderCell function for "+t+"is not implemented"),severity:y.SEVERITY.NONCRITICAL,tags:["js:browse"]}),r.default.createElement(O,null)}}render(){const{file:e,fileToId:t,instanceId:s,isActiveDropTarget:a,isSearchMode:o,isSelectMode:n,isSelected:c,itemIndex:d,onDeselect:p,onSelect:g,renameState:m,rowIndex:f,topOffset:S,visibleColumns:v,isCutToClipboard:E,isFocused:y}=this.props,{isHoverLocked:T}=this.state;let w="";v.forEach(t=>{const s=this.getAriaLabelForColumn(t,e);s&&(w+=s+", ")});const b=this.state.rowIsDragging&&!c,C=(0,i.default)({"brws-file-row":!0,"brws-file-row-no-access":u.File.isNoAccessSharedFolder(e)||b,"brws-file-row-hover-forced":T,"brws-file-row-cut":E,"brws-file-row-dragging":b}),I=!(m||o||u.File.isTeamMemberFolder(e)||u.File.isReadOnlySharedFolder(e)||u.File.isNoAccessSharedFolder(e)||(0,F.isBackupFolder)(e)||!c);return r.default.createElement(_.FilesViewRow,{className:C,isActiveDropTarget:a,isSelected:c,isDeleted:e.isDeleted,isDraggable:I,topOffset:S,rowIndex:f,isSelectMode:n,filename:String(e.fq_path.split("/").slice(-1)),ariaLabel:w,onSelect:this.onSelect,onDeselect:this.onDeselect,onNavigateToItem:this.onNavigateToItem,onDragEnter:this.onDragEnter,onDragStart:this.onDragStart,onDragEnd:this.onDragEnd},({isHovered:e,isKeyboardFocused:i})=>(e=e||T,r.default.createElement(r.default.Fragment,null,r.default.createElement(l.MediaCell,{key:"checkboxCell",className:"brws-checkbox-cell"},r.default.createElement(h.FileRowCheckbox,{instanceId:s,itemIndex:d,rowIndex:f,isHovered:e,isFocused:!!y,fileToId:t,onSelect:g,onDeselect:p})),...v.map((t,s)=>this.renderCell({isHovered:e&&!b,sortField:t.sortField,renderCell:t.renderCell})),this.renderMediaActions(e,i))))}}t.FileRow=A,A.defaultProps={topOffset:0,controlsFocusable:!1,fileToId:e=>e.fq_path},A.displayName="FileRow"})),define("metaserver/static/js/files_view/rows/cells/modified_cell",["require","exports","tslib","react","dig-components/tooltips","spectrum/media_table/index","metaserver/static/js/core/i18n"],(function(e,t,s,i,a,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ModifiedCell=void 0,i=s.__importDefault(i);t.ModifiedCell=({file:e,mediaActions:t,filteredContactName:s,isSearchMode:n,shouldBubbleSubtitle:l,width:c})=>{const d=s&&e.agoFromLastActionByUserTs,u=e.is_dir&&!n?void 0:d?e.agoFromLastActionByUserTs:e.ago,p=d?s:e.last_modified_name||void 0,g=p?o.intl.formatMessage({id:"ACVnV9",defaultMessage:"by {modified_by}"},{modified_by:p}):e.is_dir?void 0:o.intl.formatMessage({id:"5794tP",defaultMessage:"by you"}),h=u||i.default.createElement("span",{"aria-hidden":!0},"--"),_=void 0===c?{}:{width:c,minWidth:c,maxWidth:c},m=l&&g?i.default.createElement(a.Tooltip,{title:g},i.default.createElement("span",null,h)):h;return i.default.createElement(r.MediaCell,{className:"brws-file-modified-at-cell",subtitle:l?void 0:g,title:m,style:_},t)},t.ModifiedCell.displayName="ModifiedCell",t.ModifiedCell.displayName="ModifiedCell"})),define("metaserver/static/js/files_view/rows/cells/async_folder_size",["require","exports","tslib","react","metaserver/static/js/cloud_docs/constants","metaserver/static/js/files_view/util","js/filepath/filepath"],(function(e,t,s,i,a,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SizeCellTitle=t.isCloudDocProviderStored=void 0,i=s.__importDefault(i),o=s.__importStar(o);const n=()=>i.default.createElement("span",{"aria-hidden":!0},"--");function l(e){switch((0,r.isFile)(e)?o.split_filename(e.fq_path).ext:e.ext.slice(1)){case a.PaperFileTypes.PAPER:case a.PaperFileTypes.PAPER_TEMPLATE:return!0;default:return!1}}t.isCloudDocProviderStored=l;const c=i.default.lazy(()=>s.__awaiter(void 0,void 0,void 0,(function*(){return{default:(yield new Promise((t,s)=>{e(["metaserver/static/js/files_view/rows/cells/folder_size"],t,s)}).then(s.__importStar)).FolderSizeCell}})));t.SizeCellTitle=e=>{const{file:t}=e;return t.is_dir?i.default.createElement(i.default.Suspense,{fallback:i.default.createElement(n,null)},i.default.createElement(c,{file:t},i.default.createElement(n,null))):t.is_cloud_doc&&l(t)?i.default.createElement(n,null):i.default.createElement("span",null,t.size)}})),define("metaserver/static/js/files_view/rows/cells/file_row_checkbox",["require","exports","tslib","react","classnames","react-redux","dig-components/controls","metaserver/static/js/files_view/data/selectors/instance_selectors","metaserver/static/js/files_view/data/selectors/item_selectors","metaserver/static/js/files_view/types","metaserver/static/js/clean/ui/selectable_list","metaserver/static/js/user_education/react/user_education_effect","metaserver/static/js/core/i18n"],(function(e,t,s,i,a,r,o,n,l,c,d,u,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FileRowCheckbox=t.FileRowCheckboxComponent=void 0,i=s.__importDefault(i),a=s.__importDefault(a);t.FileRowCheckboxComponent=({isSelected:e,isDisabled:t,shouldShowUserEducationEffects:s,isCheckboxVisible:r,onSelect:n,onDeselect:l,selectionId:g,isFocused:h})=>{const _={selectItem:p.intl.formatMessage({id:"MkD8+F",defaultMessage:"Select item"})},m=i.default.useRef(null),f=()=>{var e,t;null===(t=null===(e=m.current)||void 0===e?void 0:e.querySelector("input"))||void 0===t||t.focus()};i.default.useEffect(()=>{h&&f()},[h]),i.default.useEffect(()=>{e&&h&&f()},[e,h]);const S=s=>{n&&l&&!t&&(s.stopPropagation(),e?l(g,s.shiftKey,c.FilesViewActionSource.SINGLE_CHECKBOX):n(g,s.shiftKey?d.SelectOptions.EXTEND:d.SelectOptions.DEFAULT,c.FilesViewActionSource.SINGLE_CHECKBOX))};let v=null;return r&&(v=i.default.createElement(o.Checkbox,{disabled:t,checked:e,onClick:S,"aria-label":_.selectItem,tabIndex:e?0:-1,readOnly:!0})),s&&(v=i.default.createElement(u.UserEducationEffect,{containerName:"FileItemRow",name:"FirstFileSelectCheckbox",useSpan:!0},v||i.default.createElement("div",{style:{width:20,height:20}}))),i.default.createElement("div",{className:(0,a.default)("brws-vertically-center","brws-file-row-checkbox-target",{"brws-file-row-checkbox-background":r}),onClick:S,ref:m},v)},t.FileRowCheckboxComponent.displayName="FileRowCheckboxComponent",t.FileRowCheckboxComponent.displayName="FileRowCheckboxComponent";t.FileRowCheckbox=(0,r.connect)((e,t)=>({isCheckboxDisabled:(0,n.selectDisabledMultiselect)(e,t),isCheckboxVisible:(0,l.selectIsCheckboxVisible)(e,t),isSelected:(0,l.selectIsItemSelected)(e,t),shouldShowUserEducationEffects:(0,l.selectShouldShowUserEducationEffects)(e,t),isDisabled:(0,n.selectDisabledMultiselect)(e,t),selectionId:(0,l.selectItemSelectionId)(e,t)}))(t.FileRowCheckboxComponent)})),define("metaserver/static/js/files_view/rows/file_shared_with_me_row",["require","exports","tslib","classnames","react","react-dom","dig-components/controls","spectrum/media_table/index","spectrum/util/raf_throttle","metaserver/static/js/files_view/file_name/file_name_cell","metaserver/static/js/files_view/rows/cells/async_folder_size","metaserver/static/js/files_view/rows/row","metaserver/static/js/files_view/thumbnail_media_cell","metaserver/static/js/files_view/types","metaserver/static/js/files_view/sort_types","metaserver/static/js/files_view/util","metaserver/static/js/clean/ui/selectable_list","metaserver/static/js/user_education/react/user_education_effect","metaserver/static/js/core/browser","metaserver/static/js/core/exception","metaserver/static/js/core/i18n"],(function(e,t,s,i,a,r,o,n,l,c,d,u,p,g,h,_,m,f,S,v,E){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FileSharedWithMeRow=void 0,i=s.__importDefault(i),a=s.__importDefault(a),r=s.__importStar(r),S=s.__importStar(S),v=s.__importStar(v);const y=()=>a.default.createElement("span",{"aria-hidden":!0},"--"),T=e=>void 0===e?{}:{width:e,minWidth:e,maxWidth:e},w=({file:e})=>e.is_cloud_doc&&(0,d.isCloudDocProviderStored)(e)?a.default.createElement(y,null):a.default.createElement("span",null,e.size);class b extends a.default.PureComponent{constructor(e){super(e),this.setRef=e=>{this.brwsFilenameContainerDiv=e},this.checkboxRef=null,this.handleWindowResize=()=>{this.throttledWindowResize.request()},this.handleResize=()=>{if(this.brwsFilenameContainerDiv){const{brwsFilenameContainerDivWidth:e}=this.state,t=this.brwsFilenameContainerDiv.getBoundingClientRect().width;t&&t!==e&&this.setState({brwsFilenameContainerDivWidth:t})}},this.handleTitleClick=e=>this.handleOpenNewTabOrNavigate(e,g.FilesViewActionSource.ROW_TITLE),this.handleOpenNewTabOrNavigate=(e,t)=>{0===e.button&&(e.preventDefault(),e.stopPropagation(),this.onNavigateToItem({openInNewTab:(0,_.hasModifierKey)(e),actionSource:t}))},this.onSelect=(e,t)=>{this.props.onSelect&&this.props.onSelect(this.props.file.file_id,e,t)},this.onDeselect=(e,t)=>{this.props.onDeselect&&this.props.onDeselect(this.props.file.file_id,e,t)},this.onNavigateToItem=({openInNewTab:e,actionSource:t})=>{e?S.open_tab(this.props.file.href):this.props.onOpenFileSharedWithMe(this.props.file,{actionSource:t})},this.getCheckboxNode=()=>this.checkboxRef&&r.findDOMNode(this.checkboxRef),this.isCheckboxNode=e=>{const t=this.getCheckboxNode();return!!t&&t.contains(e)},this.handleCheckboxChange=e=>{},this.handleCheckboxClick=e=>{e.stopPropagation();const{onSelect:t,onDeselect:s,file:i}=this.props;t&&s&&(e.currentTarget.checked?t(i.file_id,e.shiftKey?m.SelectOptions.EXTEND:m.SelectOptions.DEFAULT,g.FilesViewActionSource.SINGLE_CHECKBOX):s(i.file_id,e.shiftKey,g.FilesViewActionSource.SINGLE_CHECKBOX))},this.setCheckboxRef=e=>{this.checkboxRef=e},this.handleCheckboxTouchTargetClick=e=>{if(this.shouldHandleClick(e)){if(!this.props.isCheckboxDisabled&&this.props.onDeselect&&this.props.onSelect){e.preventDefault();const t=this.props.file.file_id;this.props.isSelected?this.props.onDeselect(t,e.shiftKey,g.FilesViewActionSource.SINGLE_CHECKBOX):this.props.onSelect(t,e.shiftKey?m.SelectOptions.EXTEND:m.SelectOptions.DEFAULT,g.FilesViewActionSource.SINGLE_CHECKBOX)}}else e.preventDefault()},this.renderCheckbox=e=>{const{isCompactMode:t,isSelectMode:s,isSelected:r,showUserEducationEffects:n}=this.props;let l=null;return l=!(e||r||s||t)?null:a.default.createElement(o.Checkbox,{disabled:this.props.isCheckboxDisabled,checked:!!r,className:(0,i.default)("brws-checkbox",{"brws-checkbox-checked":r}),onChange:this.handleCheckboxChange,onClick:this.handleCheckboxClick,ref:this.setCheckboxRef,"aria-label":E.intl.formatMessage({id:"sJRsRx",defaultMessage:"Select item"}),tabIndex:r?0:-1}),n&&(l=a.default.createElement(f.UserEducationEffect,{containerName:"FileSharedWithMeRow",name:"FirstFileSelectCheckbox",useSpan:!0},l||a.default.createElement("div",{style:{width:20,height:20}}))),l},this.state={brwsFilenameContainerDivWidth:void 0},this.throttledWindowResize=new l.RafThrottle(()=>this.handleResize())}componentDidMount(){this.handleWindowResize(),window.addEventListener("resize",this.handleWindowResize)}componentWillUnmount(){window.removeEventListener("resize",this.handleWindowResize)}componentDidUpdate(e){(this.props.isFocused&&!e.isFocused||this.props.isFocused&&this.props.isSelected&&!e.isSelected)&&this.checkboxRef&&Promise.resolve().then(()=>{const e=this.getCheckboxNode();e&&e.focus()})}renderModifiedCell(e,t,s,i){const r=s&&e.agoFromLastActionByUserTs,o=r?e.agoFromLastActionByUserTs:e.ago,l=r?s:e.last_modified_name||void 0,c=l?E.intl.formatMessage({id:"ACVnV9",defaultMessage:"by {modified_by}"},{modified_by:l}):E.intl.formatMessage({id:"5794tP",defaultMessage:"by you"});return a.default.createElement(n.MediaCell,{className:"brws-file-modified-at-cell",key:"modifiedAt",subtitle:c,title:o||a.default.createElement(y,null),style:T(i)},t)}renderCell({isHovered:e,isKeyboardFocused:t,sortField:s,isLastCell:r}){const{arePostTTIModulesLoaded:o,file:l,isSelectMode:d,isSelected:u,responsive:g,user:_,showSnippets:m,snippetRows:f,height:S,filteredContactName:E,iconSize:b,columnSizes:F}=this.props,C=null==F?void 0:F[s];switch(s){case h.SortField.FILENAME:const t={file:l,isHovered:e,isSelectMode:!!d,isSelected:!!u,isMobileMode:!g.isMatchedLarge&&!g.isMatchedMedium,user:_,mediaActions:void 0,flowsBadgePath:void 0,shouldTruncateMiddleFilename:o,showHighlights:!0,showLocation:!0,showStar:!1,showSnippets:!!m,snippetRows:f,onNameClick:this.handleTitleClick,renameState:void 0,renderFilenameSubtitleAsLink:!1,showUserEducationEffects:!1,userEducationEffectName:"",isTooltipEnabled:!1,showFirstTaskSubtitle:!1,shouldShowSubtitle:!0,draggable:!1,backupNewLocationHintEnabled:!1,isInsideBackupFolder:!1,ggToCdmMigrationVariant:"OFF",renameInput:void 0,uploadRenamingBarVariant:!1,lastSingleFileUpload:null,backupInfo:void 0},{brwsFilenameContainerDivWidth:r}=this.state;return a.default.createElement("div",{className:(0,i.default)("brws-file-name-container",{"brws-file-name-container-resizing-enabled":void 0!==C}),ref:this.setRef},a.default.createElement(p.ThumbnailMediaCell,{file:l,height:S,iconSize:b,width:C},a.default.createElement(c.FileNameCellComponent,Object.assign({},t,{fileNameCellWidth:r?r-64:void 0}))));case h.SortField.RELEVANCE:case h.SortField.MODIFIED:return this.renderModifiedCell(l,void 0,E,C);case h.SortField.SIZE:return a.default.createElement(n.MediaCell,{className:"brws-file-size-cell",key:"size",title:a.default.createElement(w,{file:l}),style:T(C)},void 0);default:case h.SortField.CATEGORY:case h.SortField.EXTENSION:case h.SortField.SHARED_WITH:return v.reportException({err:new Error("FileSharedWithMe.renderCell is not implemented for "+s),severity:v.SEVERITY.NONCRITICAL,tags:["js:search"]}),a.default.createElement(n.MediaCell,{key:s,title:a.default.createElement(y,null),style:T(C)})}}shouldHandleClick(e){return!e.defaultPrevented&&!this.isCheckboxNode(e.target)}render(){const{rowIndex:e,topOffset:t,isSelected:s,isSelectMode:i,visibleColumns:r}=this.props;return a.default.createElement(u.FilesViewRow,{className:"brws-filesharedwithme-row",isSelected:s,topOffset:t,rowIndex:e,isSelectMode:i,onSelect:this.onSelect,onDeselect:this.onDeselect,onNavigateToItem:this.onNavigateToItem},({isHovered:e,isKeyboardFocused:t})=>[a.default.createElement(n.MediaCell,{key:"checkboxCell",className:"brws-checkbox-cell"},a.default.createElement("div",{className:"brws-vertically-center brws-file-row-checkbox-target",onClick:this.handleCheckboxTouchTargetClick},this.renderCheckbox(e))),...r.map((s,i)=>this.renderCell({isHovered:e,isKeyboardFocused:t,sortField:s.sortField,isLastCell:i===r.length-1}))])}}t.FileSharedWithMeRow=b,b.displayName="FileSharedWithMeRow"})),define("metaserver/static/js/files_view/file_snippets",["require","exports","tslib","react","metaserver/static/js/clean/filename_highlights","metaserver/static/js/files_view/constants","metaserver/static/js/files_view/data/selectors/list_selectors"],(function(e,t,s,i,a,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FileSnippet=t.FileSnippets=void 0,i=s.__importDefault(i),a=s.__importStar(a);class n extends i.default.PureComponent{render(){const{snippets:e,lineClamp:s}=this.props,a={maxHeight:r.SNIPPET_HEIGHT_PER_ROW*s,WebkitLineClamp:s},n=(0,o.getFirstValidSnippet)(e);return n?i.default.createElement("span",{className:"brws-file-snippets",style:a},i.default.createElement(t.FileSnippet,{snippet:n})):null}}t.FileSnippets=n,n.defaultProps={lineClamp:3},n.displayName="FileSnippets";t.FileSnippet=({snippet:e})=>a.highlightReactFromAllHighlightSpans(e.highlight_spans||[]),t.FileSnippet.displayName="FileSnippet"})),define("metaserver/static/js/files_view/files_view",["require","exports","tslib","classnames","lodash","immutable","react","react-dom","react-redux","spectrum/media_table_skeleton/index","spectrum/table/index","metaserver/static/js/browse/action_logger","metaserver/static/js/browse/models","metaserver/static/js/files_view/column_manager","metaserver/static/js/files_view/constants","metaserver/static/js/files_view/data/action_creators","metaserver/static/js/files_view/data/selectors/instance_selectors","metaserver/static/js/files_view/column_headers/dig_column_header","metaserver/static/js/files_view/drag_drop/drag_and_drop","metaserver/static/js/files_view/file_list_empty_folder_table","metaserver/static/js/files_view/files_view_logging","metaserver/static/js/files_view/list","metaserver/static/js/files_view/scroll_updater","metaserver/static/js/files_view/tile_grid","metaserver/static/js/files_view/types","metaserver/static/js/files_view/view_type","metaserver/static/js/clean/ui/selectable_list","metaserver/static/js/sharing/access_level","metaserver/static/js/clean/web_user_action_events","metaserver/static/js/core/browser_detection","metaserver/static/js/core/i18n","metaserver/static/js/core/notify","metaserver/static/js/files_view/drag_drop/drag_to_select","metaserver/static/js/files_view/data/selectors/files_view_selectors","metaserver/static/js/files_view/unity_listener","metaserver/static/js/async/loadable","js/filepath/filepath","metaserver/static/js/browse/data/helpers"],(function(e,t,s,i,a,r,o,n,l,c,d,u,p,g,h,_,m,f,S,v,E,y,T,w,b,F,C,I,R,D,O,A,M,L,P,N,j,x){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FilesView=t.FilesViewComponent=t.getShouldShowSelectAllCheckbox=void 0,i=s.__importDefault(i),a=s.__importStar(a),r=s.__importStar(r),o=s.__importDefault(o),n=s.__importStar(n),j=s.__importStar(j);const k=(0,N.Loadable)({loader:()=>new Promise((t,s)=>{e(["typescript/component_libraries/files_components/src/file-drag/index"],t,s)}).then(s.__importStar).then(({InternalFileDrag:e})=>e)}),U=[I.NameSpaceAccess.ACCESS_NO_ACCESS,I.NameSpaceAccess.ACCESS_READER,I.NameSpaceAccess.ACCESS_READER_NO_COMMENT],H={keyboard:b.FilesViewActionSource.KEYBOARD,drag_to_select:b.FilesViewActionSource.DRAG_TO_SELECT},W=[];function V(e){return e.some(B)}function B(e){return e instanceof p.File||e instanceof p.FileSharedWithMe}t.getShouldShowSelectAllCheckbox=V;class q extends o.default.Component{constructor(){super(...arguments),this.internalDragStatusRef=o.default.createRef(),this.state={dropTarget:null,tilesPerRow:1,draggedFiles:null},this.handleCopyToClipboard=()=>{const{selectedFiles:e,onSetClipboard:t}=this.props;e.size&&t({files:e.toArray(),action:"copy"})},this.handleCutToClipboard=()=>{const{selectedFiles:e,onSetClipboard:t}=this.props,s=e.filter(e=>!e.read_only);s.size&&t({files:s.toArray(),action:"cut"})},this.handleNewFolderSubmit=e=>{""===e?(this.props.onNewFolderCancel(),this.handleNewFolderCancel({source:b.NameInputActionSource.SUBMIT})):this.props.onNewFolderSubmit(e)},this.handleNewFolderCancel=({source:e})=>{e!==b.NameInputActionSource.ESC&&A.Notify.error(O.intl.formatMessage({id:"9xXIAi",defaultMessage:"Please provide a name for the new folder."})),this.props.onNewFolderCancel()},this.handleSetFileUploaderPath=e=>{const t=e?e.path:this.props.path;let s=this.props.context.isCurrentPathWriteable();e&&e.hasOwnProperty("hasPermissionToUploadToFolder")&&(s=!!e.hasPermissionToUploadToFolder);const i=!!(null==e?void 0:e.isMovingIntoVault);this.props.setFileUploaderPath({path:t,hasPermissionToUploadToFolder:s,isMovingIntoVault:i,targetSurface:"files_view"})},this.handleDragStart=(e,t=[])=>{var s;const{path:i,selectedFiles:r,user:o,preventSelectionOnDrag:l}=this.props;let c=a.keyBy(t,"fq_path");0!==t.length&&l||(c=Object.assign(Object.assign({},c),r.toJS()));const d=a.values(c),{isInsideBackupFolder:u}=this.props;if(u)return void A.Notify.error(O.intl.formatMessage({id:"+HTDO0",defaultMessage:"Backup contents can’t be moved."}));if(null==d?void 0:d.some(e=>(0,x.isBackupFolder)(e)))return void A.Notify.error(O.intl.formatMessage({id:"isN1D3",defaultMessage:"Backups can’t be moved."}));if(d.some(e=>p.File.isTeamSharedFolder(e)))return void A.Notify.error(O.intl.formatMessage({id:"1cIg3V",defaultMessage:"Team folders can’t be moved."}));if(d.some(e=>p.File.isTeamMemberFolder(e)))return void A.Notify.error(O.intl.formatMessage({id:"ZxTpZJ",defaultMessage:"Your member folder can’t be moved."}));const g=e.dataTransfer;if(!g)return;if(this.setState({draggedFiles:d}),g.setDragImage&&(null===(s=this.internalDragStatusRef)||void 0===s?void 0:s.current)){const e=n.findDOMNode(this.internalDragStatusRef.current);e&&g.setDragImage(e,-10,-10)}const h={userId:o.id,fromPath:i,fileInfos:d.map(e=>({target_ns:e.target_ns,file_id:e.file_id,is_dir:e.is_dir,fq_path:e.fq_path}))};g.setData(D.INTERNAL_FILE_DATA_TRANSFER_TYPE,JSON.stringify(h)),g.effectAllowed="copyMove",this.props.onDragStart&&this.props.onDragStart(e,d)},this.handleDragEnter=(e,t,s,i)=>{const{draggedFiles:a}=this.state;a&&(0,x.isBackupFolder)(t)&&A.Notify.error(O.intl.formatMessage({id:"rRI7QJ",defaultMessage:"Files can’t be moved into backups."}));const r=null==a?void 0:a.some(e=>e.fq_path===t.fq_path);(0,S.onFileDragEnterItem)(t,!!this.props.isDraggingExternalFiles,!!this.props.isDraggingInternalFiles,!!r,i,this.props.context,this.handleSetDropTarget,this.handleSetFileUploaderPath)},this.handleDragEnd=e=>{this.setState({draggedFiles:null}),this.props.onDragEnd&&this.props.onDragEnd(e)},this.handleSetDropTarget=e=>{this.setState({dropTarget:e}),this.props.updateDropTarget&&this.props.updateDropTarget(e)},this.handleSelectionChange=(e,t)=>{const s=t?t in C.SelectableListActionSource?H[t]:t:void 0;this.props.onSelectionChange(e,s)},this.onAllCheckboxDeselectAll=()=>{const{selection:e,onSelectionChange:t}=this.props;t(e.set("selected",r.OrderedSet()),b.FilesViewActionSource.ALL_CHECKBOX)},this.onAllCheckboxSelectAll=()=>{const{items:e,selection:t,onSelectionChange:s}=this.props;s(t.set("selected",r.OrderedSet(e.filter(B).map(e=>"fq_path"in e?this.props.fileToId(e):e.file_id))),b.FilesViewActionSource.ALL_CHECKBOX)},this._handleGetOverflowMenuActions=(e,t)=>{const{getOverflowMenuActions:s,responsive:i}=this.props;return s(e,t,i)},this.handleTTI=()=>{this.props.onComponentTTI("FilesViewController")},this.getIsCurrentPathWriteable=()=>this.props.context.isCurrentPathWriteable(),this.onTilesPerRowChange=e=>{this.setState({tilesPerRow:e})},this.onDeselectAll=()=>{this.props.isSearchMode&&this.props.onFocusSearchBar()},this.logRightClick=e=>{const{selectedFiles:t,user:s,viewType:i}=this.props,a=t?t.count(e=>e.is_dir):0,r=t?t.count()-a:0;(0,u.logRightClickItems)({uid:s.id,viewType:i,action_surface:R.ActionSurfaceLogValue.CENTER_PANE,numFilesSelected:r,numFoldersSelected:a})},this.InternalFileDragHelper=()=>{const e=this.state.draggedFiles||W,t=e.length;let s="",i=!1,a="";return t>0&&(s=j.filename(e[0].fq_path),i=e[0].is_dir,a=e[0].icon),o.default.createElement(k,{ref:this.internalDragStatusRef,numberOfFiles:t,firstFileName:s,isFolder:i,icon:a})}}shouldComponentUpdate(e){return e.loadingState!==this.props.loadingState||e.loadingState!==b.LoadingState.LOADING_FIRST_PAGE||(i=e.context,a=this.props.context,!!(i&&a&&i.currentFQPath!==a.currentFQPath||(t=e.items,s=this.props.items,t!==s)));var t,s,i,a}renderEmptyFolderView(){const{context:e,customEmptyFolderView:t,onFocusSearchBar:s,onPasteFromClipboard:i,onNavigateToParentFolder:a,isDraggingExternalFiles:r,isColumnResizingEnabled:n,scrollContainerWidth:l,isInsideBackupFolder:c}=this.props;if(t){const e=t({isDraggingExternalFiles:!!r,handleTTI:this.handleTTI,isColumnResizingEnabled:n,width:l});if(e)return e}const{isInsideSharedFolder:d,currentSharedFolderPermissionRole:u}=e,p=d&&U.includes(u)?void 0:c?O.intl.formatMessage({id:"qgGik0",defaultMessage:"Files added to your device will appear here"}):O.intl.formatMessage({id:"jXqkXG",defaultMessage:"Drag and drop files onto this window to upload."});return o.default.createElement(v.EmptyFolderTable,{title:O.intl.formatMessage({id:"YLBqRL",defaultMessage:"This folder is empty"}),subtitle:p,onTTI:this.handleTTI,onFocusSearchBar:s,onPasteFromClipboard:i,onNavigateToParentFolder:a,onOpenKeyboardShortcutModal:this.props.openKeyboardShortcutsModal})}getSelectAllCheckboxCheckedVariant(){const{selectedFiles:e,items:t}=this.props;let s="unchecked";return e.size===t.filter(B).size?s="checked":e.size&&(s="mixed"),s}isCreateFolderUIActive(){const{createNewFolderState:e}=this.props;return e&&"CREATE_FOLDER_INACTIVE"!==e}shouldShowEmptyFolderView(){return this.props.loadingState===b.LoadingState.LOADED&&!this.props.items.size&&!this.isCreateFolderUIActive()}render(){const{id:e,onDelete:t,onShowRename:s,onRenameSubmit:a,onRenameCancel:r,onSwitchViewType:n,onPasteFromClipboard:l,onColumnsChanged:u,onCanDisplayFolderSizesChanged:p,onFocusSearchBar:_,currentSort:m,createNewFolderState:S,context:v,columns:I,dropTargetHighlightMode:D,fileRename:O,getIsFileJumping:A,onAddFileJumpKeyCode:L,onResetFileJump:N,hideViewFileButton:j,items:x,itemIds:k,isCompactMode:U,isSearchMode:H,isSearchTopRightSortEnabled:W,isDraggingExternalFiles:B,isDraggingInternalFiles:q,isQueryingFolderSizes:G,isFileViewerShown:Q,loadingState:z,onSortChange:K,path:Y,responsive:X,selectedFiles:Z,selection:J,renderSharedWithController:$,onShowShare:ee,onPresentInZoom:te,totalNumFiles:se,user:ie,viewType:ae,viewTypeColumns:re,onLocationLinkClick:oe,onNavigateToFileOrFolder:ne,onNavigateToParentFolder:le,onOpenFileSharedWithMe:ce,onOpenPaper:de,arePostTTIModulesLoaded:ue,scrollContainer:pe,sharingServiceInfo:ge,stickyOffsetTop:he,disabledMultiselect:_e,isStickyColumnHeader:me,onRangeInView:fe,highDensity:Se,filteredContactName:ve,sections:Ee,preferredColumns:ye,isDragToSelectEnabled:Te,cutItems:we,numVisibleColumns:be,isListView:Fe,isActive:Ce,enableUnity:Ie,inlineActionBar:Re,scrollContainerWidth:De,columnResizeStorageSetting:Oe,isColumnResizingEnabled:Ae,expManualTagging:Me,useSkinnyCheckboxes:Le,mediaFiltersVariant:Pe}=this.props,{isMatchedLarge:Ne,isMatchedMedium:je}=X,{dropTarget:xe,tilesPerRow:ke}=this.state;if(z===b.LoadingState.LOADING_FIRST_PAGE)return ue?o.default.createElement(c.MediaTableSkeleton,{numRows:15}):null;const Ue=!!Z.size,He=!!Ae;if(this.shouldShowEmptyFolderView())return o.default.createElement("div",{className:"brws-files-view"},this.renderEmptyFolderView(),Ie&&o.default.createElement(P.UnityListener,{items:this.props.unityItems,userId:ie.id}));const We=Ne?h.DEFAULT_COLUMN_HEADER_HEIGHT:h.COMPACT_COLUMN_HEADER_HEIGHT,Ve=We+he,Be=this.props.scrollPositionOffset||0;return o.default.createElement("div",{className:(0,i.default)("brws-files-view",`brws-files-view--${ae.toLowerCase()}`,{"brws-files-view-condensed-list":ae===F.ViewType.CondensedList}),onContextMenu:this.logRightClick},o.default.createElement(g.ColumnManager,{columns:I,viewTypeColumns:re,currentSort:m,onCanDisplayFolderSizesChanged:p,onColumnsChanged:u,isMatchedLarge:Ne,isMatchedMedium:je,isSearchMode:H,viewType:ae,responsiveContainer:H,preferredColumns:ye,isMoreColumnsEnabled:He,numVisibleColumns:be,scrollContainerWidth:De,columnResizeStorageSetting:Oe},({visibleColumns:c,handleSelection:u,canDisplayFolderSizes:p,containerWidth:g,handleReorder:T})=>{const b=(H?h.LIST_VIEW_SEARCH_MODE_COLUMN_FLEX:h.LIST_VIEW_COLUMN_FLEX)[c.length];Le&&b&&(b[0]=h.CHECKBOX_CELL_FLEX_RIGHT_RAIL);const F={columnFlex:b,currentSort:m,isCompactMode:U,isSelectMode:Ue,onDeselectAll:this.onAllCheckboxDeselectAll,onSelectAll:this.onAllCheckboxSelectAll,onSelection:(e,t,s)=>{var i,a;e.popoverTriggerLabel!==t.popoverTriggerLabel&&(0,E.logEvent)({user:ie,action:R.WebUserActionLogEvent.SWITCH_COLUMN_TYPE,extra:{column_position:(s+1).toString(),selected_column_header:null!==(i=e.loggingLabel)&&void 0!==i?i:e.popoverTriggerLabel,open_from_column_header:null!==(a=e.loggingLabel)&&void 0!==a?a:t.popoverTriggerLabel,action_type:c.includes(e)?"deselected":"selected"}}),u(e,t)},onSort:K,onMenuOpen:(e,t)=>{(0,E.logEvent)({user:ie,action:R.WebUserActionLogEvent.SELECT_COLUMN_MENU,extra:{column_position:(e+1).toString(),column_header:t}})},onReorder:T,onSwitchViewType:n,selectAllCheckboxState:this.getSelectAllCheckboxCheckedVariant(),showSelectAllCheckbox:V(this.props.items),stickyOffsetHeight:We,stickyOffsetTop:he,columns:I,visibleColumns:c,viewType:ae,isSearchMode:H,isSearchTopRightSortEnabled:W,presentationOnly:Fe,isMoreColumnsEnabled:Fe&&He,items:x};return Fe?o.default.createElement(C.SelectableList,{itemIds:k,keyScope:C.SELECTABLE_LIST_KEY_SCOPE,onSelectionChange:this.handleSelectionChange,selection:J,tilesPerRow:ke,onDeselectAll:this.onDeselectAll,isActive:Ce},({focusedFileId:n,handleDeselect:u,handleFocusFile:h,handleSelect:m,isSelectableListEvent:E,updateSelection:T})=>o.default.createElement(M.DragToSelectController,{handleSelect:m,handleDeselect:u,updateSelection:T,selection:J,isDragToSelectEnabled:Te},({registerSelectableItem:T})=>{var w;return o.default.createElement(d.Table,{"aria-rowcount":se,className:(0,i.default)("brws-files-view-list",{"brws-files-view-list-high-density":Se}),columnFlex:b},o.default.createElement(f.ColumnHeader,Object.assign({},F,{variant:pe?"sticky-native":me?"sticky":"fixed"})),o.default.createElement(y.FilesViewList,{onTTI:this.handleTTI,registerListItem:T,instanceId:e,onDelete:t,onShowRename:s,activeDropTarget:xe,context:v,createNewFolderState:S,dropTargetHighlightMode:D,fileRename:O,focusedFileIndex:n?k.indexOf(n):void 0,getOverflowMenuActions:this._handleGetOverflowMenuActions,getIsCurrentPathWriteable:this.getIsCurrentPathWriteable,getIsFileJumping:A,onAddFileJumpKeyCode:L,onResetFileJump:N,isCompactMode:U,hideViewFileButton:!!j,isDraggingExternalFiles:B,isDraggingInternalFiles:q,isFileViewerShown:Q,isSearchMode:H,isSelectMode:Ue,isSelectableListEvent:E,arePostTTIModulesLoaded:ue,keyScope:C.SELECTABLE_LIST_KEY_SCOPE,onCopyToClipboard:this.handleCopyToClipboard,onCutToClipboard:this.handleCutToClipboard,onDragStart:this.handleDragStart,onDragEnter:this.handleDragEnter,onDragEnd:this.handleDragEnd,onDeselectFile:u,onFocusFile:h,onFocusSearchBar:_,onOpenKeyboardShortcutModal:this.props.openKeyboardShortcutsModal,onLocationLinkClick:oe,onNavigateToFileOrFolder:ne,onNavigateToParentFolder:le,onNewFolderCancel:this.handleNewFolderCancel,onNewFolderSubmit:this.handleNewFolderSubmit,onOpenFileSharedWithMe:ce,onOpenPaper:de,onPasteFromClipboard:l,onRenameCancel:r,onRenameSubmit:a,onSelectFile:m,onSetDropTarget:this.handleSetDropTarget,onSetFileUploaderPath:this.handleSetFileUploaderPath,responsive:X,scrollPositionOffset:Be,selectedFiles:Z,selection:J,renderSharedWithController:$,hrefForFile:this.props.hrefForFile,onShowShare:ee,onPresentInZoom:te,user:ie,viewportTopOffset:Ve,visibleColumns:c,canDisplayFolderSizes:p,scrollContainer:pe,shareButtonLabel:this.props.shareButtonLabel,sharingServiceInfo:ge,showShareButton:this.props.showShareButton,starredState:this.props.starredState,onRangeInView:fe,containerWidth:g,highDensity:Se,filteredContactName:ve,fileToId:this.props.fileToId,eligibleForFirstTaskSubtitle:this.props.eligibleForFirstTaskSubtitle,expVaultEnableViewOnlySharing:this.props.expVaultEnableViewOnlySharing,expManualTagging:Me,preventSelectionOnDrag:this.props.preventSelectionOnDrag,mediaFiltersVariant:Pe,renderPrivacyColumnClientAccessCell:this.props.renderPrivacyColumnClientAccessCell,defaultListviewIconSize:null===(w=this.props.overrides)||void 0===w?void 0:w.defaultListviewIconSize}))})):o.default.createElement(C.SelectableList,{itemIds:k,keyScope:C.SELECTABLE_TILE_GRID_KEY_SCOPE,onSelectionChange:this.handleSelectionChange,selection:J,tilesPerRow:ke,sectionStartIndices:Ee.sectionStartIndices,isActive:Ce},({handleDeselect:e,handleDeselectAll:i,handleFocusFile:n,handleSelect:c,handleSelectAll:u,updateSelection:p,focusedFileId:g})=>o.default.createElement(M.DragToSelectController,{handleSelect:c,handleDeselect:e,updateSelection:p,selection:J,isDragToSelectEnabled:Te},({registerSelectableItem:p})=>o.default.createElement(o.default.Fragment,null,o.default.createElement(d.Table,{columnFlex:Le?h.GRID_VIEW_COLUMN_FLEX_RIGHT_RAIL:h.GRID_VIEW_COLUMN_FLEX,role:"presentation",style:pe?{position:"sticky",top:he,zIndex:1}:void 0},o.default.createElement(f.ColumnHeader,Object.assign({},F,{variant:pe?"default":me?"sticky":"fixed",disableResizing:!0}))),o.default.createElement(w.FilesViewTileGrid,{onDelete:t,disabledMultiselect:_e||!1,onShowRename:s,activeDropTarget:xe,arePostTTIModulesLoaded:ue,createNewFolderState:S,context:v,deselectAll:i,dropTargetHighlightMode:D,fileRename:O,getOverflowMenuActions:this._handleGetOverflowMenuActions,getIsCurrentPathWriteable:this.getIsCurrentPathWriteable,getIsFileJumping:A,onAddFileJumpKeyCode:L,onResetFileJump:N,onTTI:this.handleTTI,items:x,isCreateFolderUIActive:this.isCreateFolderUIActive(),isDraggingExternalFiles:B,isDraggingInternalFiles:q,isQueryingFolderSizes:G,isSearchMode:H,onCopyToClipboard:this.handleCopyToClipboard,onCutToClipboard:this.handleCutToClipboard,onDeselectFile:e,onDragEnter:this.handleDragEnter,onDragStart:this.handleDragStart,onDragEnd:this.handleDragEnd,onFocusFile:n,onFocusSearchBar:_,onNewFolderCancel:this.handleNewFolderCancel,onNewFolderSubmit:this.handleNewFolderSubmit,onNavigateToFileOrFolder:ne,onOpenFileSharedWithMe:ce,onOpenPaper:de,onOpenKeyboardShortcutModal:this.props.openKeyboardShortcutsModal,onPasteFromClipboard:l,onRangeInView:fe,onRenameCancel:r,onRenameSubmit:a,onSelectFile:c,onSetDropTarget:this.handleSetDropTarget,onSortChange:K,onTilesPerRowChange:this.onTilesPerRowChange,path:Y,sections:Ee,selectAll:u,selectedFiles:Z,selection:J,onSetFileUploaderPath:this.handleSetFileUploaderPath,tilesPerRow:ke,totalNumItems:se,user:ie,viewportTopOffset:Ve,viewType:ae,starredState:this.props.starredState,hrefForFile:this.props.hrefForFile,focusedFileIndex:g?k.indexOf(g):void 0,scrollContainer:pe,scrollPositionOffset:Be,registerSelectableTile:p,cutItems:we,isActive:Ce,inlineActions:Re,preventSelectionOnDrag:this.props.preventSelectionOnDrag}))))}),o.default.createElement(T.ScrollUpdater,{scrollContainer:pe,path:Y}),this.InternalFileDragHelper(),Ie&&o.default.createElement(P.UnityListener,{items:this.props.unityItems,userId:ie.id}))}}t.FilesViewComponent=q,q.defaultProps={fileToId:e=>e.fq_path},q.displayName="FilesViewComponent";t.FilesView=(0,l.connect)((e,{id:t})=>Object.assign(Object.assign({},(0,m.selectInstance)(e,{instanceId:t})),{itemIds:(0,m.selectItemIds)(e,{instanceId:t}),sections:(0,m.selectSections)(e,{instanceId:t}),responsive:(0,m.selectResponsive)(e,{instanceId:t}),isCompactMode:(0,m.selectIsCompactMode)(e,{instanceId:t}),viewType:(0,m.selectViewType)(e,{instanceId:t}),preferredColumns:(0,m.selectPreferredColumns)(e,{instanceId:t}),cutItems:(0,m.selectCutItems)(e,{instanceId:t}),numVisibleColumns:(0,m.selectNumVisibleColumns)(e,{instanceId:t}),isListView:(0,m.selectIsListView)(e,{instanceId:t}),isActive:(0,L.isActiveFilesView)(e,t),unityItems:(0,m.selectItemsForUnityListener)(e,{instanceId:t})}),(e,{id:t})=>({openKeyboardShortcutsModal:()=>e((0,_.openKeyboardShortcutsModal)({instanceId:t}))}))(q)})),define("metaserver/static/js/files_view/files_view_logging",["require","exports","tslib","metaserver/static/js/browse/logger_util"],(function(e,t,s,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.logEvent=t.logEventWithNumberOfFiles=void 0;t.logEventWithNumberOfFiles=t=>{const{isSearchMode:a,file:r,extra:o,action:n,action_source:l,action_surface:c,user:d}=t;if(a){const t=new Promise((t,s)=>{e(["metaserver/static/js/search/single_page/logger"],t,s)}).then(s.__importStar),a=new Promise((t,s)=>{e(["metaserver/static/js/search/single_page/data/selectors/index"],t,s)}).then(s.__importStar),d=new Promise((t,s)=>{e(["metaserver/static/js/search/single_page/data/store"],t,s)}).then(s.__importStar);Promise.all([t,a,d]).then(([e,t,s])=>{const a=s.getStoreForSearch().getState(),d=t.selectedFiles(a),{num_files_selected:u,num_folders_selected:p}=(0,i.countFilesAndFolders)(d),g=Object.assign(Object.assign({},o),{num_files_selected:u.toString(),num_folders_selected:p.toString()});e.logResultAction(n,t.resultsList(a),r,c,l,g)})}else{const t=new Promise((t,s)=>{e(["metaserver/static/js/browse/action_logger"],t,s)}).then(s.__importStar),a=new Promise((t,s)=>{e(["metaserver/static/js/browse/data/store"],t,s)}).then(s.__importStar),u=new Promise((t,s)=>{e(["metaserver/static/js/browse/data/selectors"],t,s)}).then(s.__importStar);Promise.all([t,a,u]).then(([{logBrowseAction:e},{getStoreForBrowse:t},s])=>{const a=s.selectedFiles(t().getState()),{num_files_selected:u,num_folders_selected:p}=(0,i.countFilesAndFolders)(a);e({uid:d.id,action:n,result:r,num_files_selected:u,num_folders_selected:p,action_surface:c,action_source:l,extra:o})})}};t.logEvent=({user:t,action:i,extra:a})=>s.__awaiter(void 0,void 0,void 0,(function*(){(yield new Promise((t,s)=>{e(["metaserver/static/js/browse/action_logger"],t,s)}).then(s.__importStar)).logWebUserAction({user_id:t.id,event_name:i,extra:a})}))})),define("metaserver/static/js/files_view/fixed_table_head",["require","exports","tslib","spectrum/vertically_fixed/index","spectrum/table/index","react"],(function(e,t,s,i,a,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FixedTableHead=void 0,r=s.__importDefault(r);t.FixedTableHead=e=>{var{children:t,offsetHeight:o,style:n={}}=e,l=s.__rest(e,["children","offsetHeight","style"]);const c=void 0===o?n:Object.assign({flexBasis:o},n);return r.default.createElement("thead",Object.assign({className:"mc-table-head mc-table-head-fixed brws-column-header",style:c},l),r.default.createElement(i.VerticallyFixed,{tag:({style:e})=>r.default.createElement(a.TableRow,{className:"mc-table-head-row mc-table-head-row-fixed",style:Object.assign({height:o},e),role:"presentation"},t)}))}})),define("metaserver/static/js/files_view/legacy_types",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})),define("metaserver/static/js/files_view/list",["require","exports","tslib","react","react-redux","metaserver/static/js/browse/models","metaserver/static/js/files_view/resizing/column_size_context","metaserver/static/js/files_view/culled_table_body","metaserver/static/js/files_view/data/selectors/list_selectors","metaserver/static/js/files_view/data/selectors/instance_selectors","metaserver/static/js/files_view/drag_drop/drag_and_drop","metaserver/static/js/files_view/rows/file_shared_with_me_row","metaserver/static/js/files_view/keyboard_shortcuts","metaserver/static/js/files_view/rows/new_folder_row","metaserver/static/js/files_view/rows/paper_row","metaserver/static/js/files_view/rows/row_container","metaserver/static/js/files_view/types","metaserver/static/js/files_view/view_type","metaserver/static/js/files_view/rows/user_defined_item_row","metaserver/static/js/files_view/data/selectors/files_view_selectors"],(function(e,t,s,i,a,r,o,n,l,c,d,u,p,g,h,_,m,f,S,v){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FilesViewList=t.FilesViewListComponent=t.isGlobalEvent=void 0,i=s.__importDefault(i);const E=()=>{};t.isGlobalEvent=e=>{const t=["menuitem","treeitem"];switch(e.key){case"ArrowLeft":case"ArrowUp":case"ArrowRight":case"ArrowDown":return!(e.target instanceof Element&&t.includes(e.target.getAttribute("role")||""));default:return!0}};class y extends i.default.Component{constructor(){super(...arguments),this.getIsListEvent=e=>this.props.isSelectableListEvent()&&(!(e.target instanceof Element)||"BUTTON"!==e.target.tagName),this.getSelectedFiles=()=>this.props.selectedFiles,this.getActiveDropTarget=()=>this.props.activeDropTarget,this.getIsDraggingInternalFiles=()=>!!this.props.isDraggingInternalFiles,this.getIsDraggingExternalFiles=()=>!!this.props.isDraggingExternalFiles,this.renderRow=(e,t,s)=>{var a,n,l,c;if("NewFolderRow"===e.type)return i.default.createElement(g.NewFolderRow,{createNewFolderState:e.props.createNewFolderState,isInsideMyTeamFolderTree:e.props.isInsideMyTeamFolderTree,onCancel:this.props.onNewFolderCancel,onSubmit:this.props.onNewFolderSubmit,rowIndex:t,topOffset:s,iconSize:e.props.iconSize});if("PaperRow"===e.type)return i.default.createElement(o.ColumnResizingContext.Consumer,null,({columnSizes:a,columnResizingEnabled:r})=>i.default.createElement(h.PaperRow,{paper:e.props.paper,rowIndex:t,topOffset:s,user:this.props.user,visibleColumns:e.props.visibleColumns,onOpenPaper:this.props.onOpenPaper,arePostTTIModulesLoaded:e.props.arePostTTIModulesLoaded,showSnippets:e.props.showSnippets,snippetRows:e.props.snippetRows,height:e.props.height,showStar:e.props.showStar,columnSizes:r?a:void 0}));if("UserDefinedItemRow"===e.type)return i.default.createElement(S.UserDefinedItemRow,{userDefinedItem:e.props.userDefinedItem,rowIndex:t,topOffset:s});const{selection:d}=this.props,p=e.props.file instanceof r.File?d.selected.last()===this.props.fileToId(e.props.file):d.selected.last()===e.props.file.file_id;if("FileSharedWithMeRow"===e.type)return null===(n=(a=this.props).registerListItem)||void 0===n||n.call(a,e.props.file.file_id,{top:s,height:e.props.height,left:0}),i.default.createElement(o.ColumnResizingContext.Consumer,null,({columnSizes:a,columnResizingEnabled:r})=>i.default.createElement(u.FileSharedWithMeRow,{arePostTTIModulesLoaded:this.props.arePostTTIModulesLoaded,file:e.props.file,visibleColumns:this.props.visibleColumns,isCompactMode:e.props.isCompactMode,getOverflowMenuActions:this.props.getOverflowMenuActions,onOpenFileSharedWithMe:this.props.onOpenFileSharedWithMe,rowIndex:t,controlsFocusable:p,topOffset:s,user:this.props.user,responsive:this.props.responsive,showSnippets:e.props.showSnippets,snippetRows:e.props.snippetRows,height:e.props.height,isSelectMode:e.props.isSelectMode,isSelected:e.props.isSelected,onSelect:this.props.onSelectFile,onDeselect:this.props.onDeselectFile,isFocused:e.props.isFocused,filteredContactName:this.props.filteredContactName,iconSize:e.props.iconSize,columnSizes:r?a:void 0}));null===(c=(l=this.props).registerListItem)||void 0===c||c.call(l,this.props.fileToId(e.props.file),{top:s,height:e.props.height,left:0});const m={key:e.key,instanceId:this.props.instanceId,itemIndex:e.itemIndex,containerWidth:e.props.containerWidth,file:e.props.file,sharingServiceInfo:e.props.sharingServiceInfo,getOverflowMenuActions:this.props.getOverflowMenuActions,hideViewFileButton:this.props.hideViewFileButton,isActiveDropTarget:e.props.isActiveDropTarget,isAvailableDropTarget:e.props.isAvailableDropTarget,isCompactMode:e.props.isCompactMode,responsive:e.props.responsive,isExtensionsMenuDisabled:e.props.isExtensionsMenuDisabled,isFocused:e.props.isFocused,isSearchMode:e.props.isSearchMode,isSelectMode:e.props.isSelectMode,isSelected:e.props.isSelected,isSharingDisabled:e.props.isSharingDisabled,onDeselect:this.props.onDeselectFile,onDragStart:this.props.onDragStart,onDragEnter:this.props.onDragEnter,onDragEnd:this.props.onDragEnd,onLocationLinkClick:this.props.onLocationLinkClick,onNavigateToFileOrFolder:this.props.onNavigateToFileOrFolder,onRenameCancel:this.props.onRenameCancel,onRenameSubmit:this.props.onRenameSubmit,onSelect:this.props.onSelectFile,renameState:e.props.renameState,rowIndex:t,controlsFocusable:p,topOffset:s,user:this.props.user,visibleColumns:this.props.visibleColumns,canDisplayFolderSizes:this.props.canDisplayFolderSizes,renderSharedWithController:this.props.renderSharedWithController,hrefForFile:this.props.hrefForFile,onShowShare:this.props.onShowShare,onPresentInZoom:this.props.onPresentInZoom,shareButtonLabel:this.props.shareButtonLabel,showShareButton:this.props.showShareButton,filteredContactName:this.props.filteredContactName,fileToId:this.props.fileToId,isCondensedListView:e.props.isCondensedListView,isActionBarEnabled:e.props.isActionBarEnabled,expManualTagging:this.props.expManualTagging,preventSelectionOnDrag:this.props.preventSelectionOnDrag,mediaFiltersVariant:this.props.mediaFiltersVariant,renderPrivacyColumnClientAccessCell:this.props.renderPrivacyColumnClientAccessCell,iconSize:e.props.iconSize};return i.default.createElement(_.RowContainer,Object.assign({},m))}}componentDidMount(){this.props.onTTI(),this.setupKeyboardShortcuts(),this.setupExternalDragHandler()}componentWillUnmount(){this.cleanupKeyboardShortcuts(),(0,d.cleanupExternalDragHandler)(this.props.keyScope)}componentDidUpdate(e){e.isActive!==this.props.isActive&&(this.props.isActive?this.setupKeyboardShortcuts():this.cleanupKeyboardShortcuts())}cleanupKeyboardShortcuts(){(0,p.resetFilesViewKeyboardShortcuts)(this.props.keyScope),(0,p.resetFileJumpKeyboardShortcuts)(this.props.keyScope)}setupKeyboardShortcuts(){const{user:e,onDelete:t,onShowRename:s,getIsFileJumping:i,onAddFileJumpKeyCode:a,onResetFileJump:r,keyScope:o,onCopyToClipboard:n,onCutToClipboard:l,onNavigateToParentFolder:c,onPasteFromClipboard:d}=this.props;(0,p.setupFileJumpKeyboardShortcuts)({scope:o,getIsFileJumping:i,onAddFileJumpKeyCode:a,onResetFileJump:r}),(0,p.setupFilesViewKeyboardShortcuts)({user:e,viewType:f.ViewType.List,getIsGlobalEvent:this.getIsGlobalEvent(),getIsItemEvent:this.getIsListEvent,getSelectedFiles:this.getSelectedFiles,isCurrentPathWriteable:this.props.getIsCurrentPathWriteable,selectAllAction:E,deselectAllAction:E,onCopyToClipboard:n,onCutToClipboard:l,onDelete:t,onFocusSearchBar:this.props.onFocusSearchBar,onNavigateToFileOrFolder:e=>this.props.onNavigateToFileOrFolder(e,{actionSource:m.FilesViewActionSource.KEYBOARD}),onNavigateToParentFolder:c,onPasteFromClipboard:d,onShowRename:s,scope:o,onShowHelpMenu:()=>this.props.onOpenKeyboardShortcutModal()})}setupExternalDragHandler(){(0,d.setupExternalDragHandler)(this.props.keyScope,this.getIsDraggingInternalFiles,this.getIsDraggingExternalFiles,this.props.onSetFileUploaderPath,".brws-file-row",this.getActiveDropTarget,this.props.onSetDropTarget)}getIsGlobalEvent(){return t.isGlobalEvent}render(){const{scrollPositionOffset:e,viewportTopOffset:t,focusedFileIndex:s,onRangeInView:a,scrollContainer:r,listItems:o,heights:l,itemBuffer:c}=this.props;return i.default.createElement(n.CulledTableBodyWithScrollContainer,{items:o,listItemHeight:l,renderRow:this.renderRow,scrollPositionOffset:e,scrollToRow:s,shouldUseWindowAsScrollContainer:!0,viewportTopOffset:t,onRangeInView:a,scrollContainer:r,itemBuffer:c,id:"files-view-table-container"})}}t.FilesViewListComponent=y,y.defaultProps={isFileViewerShown:()=>!1},y.displayName="FilesViewListComponent";t.FilesViewList=(0,a.connect)((e,t)=>({listItems:(0,l.selectListItems)(e,t),heights:(0,l.selectListItemHeights)(e,t),itemBuffer:(0,l.selectListItemBuffer)(e,t),isActive:(0,v.isActiveFilesView)(e,t.instanceId),isCheckboxDisabled:(0,c.selectDisabledMultiselect)(e,t),cutItems:(0,c.selectCutItems)(e,t)}))(y)})),define("metaserver/static/js/files_view/rows/new_folder_row",["require","exports","tslib","spectrum/media_table/index","spectrum/table/index","react","typescript/libraries/spectrum-content-icon-compatibility/src/index","metaserver/static/js/files_view/name_input","metaserver/static/js/core/i18n"],(function(e,t,s,i,a,r,o,n,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NewFolderIcon=t.NewFolderRow=void 0,r=s.__importDefault(r);t.NewFolderRow=e=>{const{createNewFolderState:s,isInsideMyTeamFolderTree:o=!1,onCancel:c,onSubmit:d,rowIndex:u,topOffset:p,iconSize:g}=e;let h;h="SAVING_INPUT"===s?r.default.createElement("p",{className:"brws-new-folder-row-status",role:"status","aria-live":"polite"},l.intl.formatMessage({id:"p58M12",defaultMessage:"Creating new folder…"})):r.default.createElement(n.NameInput,{defaultValue:"",label:l.intl.formatMessage({id:"ss4CO0",defaultMessage:"Folder name"}),onSubmit:d,onCancel:c});const _=r.default.createElement(t.NewFolderIcon,{isInsideMyTeamFolderTree:o,iconSize:g});return r.default.createElement(i.CulledMediaRow,{"aria-rowindex":void 0!==u?u+1:void 0,className:"brws-new-folder-row",topOffset:p},r.default.createElement(a.TableCell,{className:"brws-checkbox-cell"}),r.default.createElement(i.MediaCell,{icon:_},r.default.createElement("div",{className:"brws-new-folder-row-content brws-vertically-center"},h)),r.default.createElement(a.TableCell,null),r.default.createElement(a.TableCell,null))};t.NewFolderIcon=e=>{const{isInsideMyTeamFolderTree:t,iconSize:s}=e,i=e.className||"",a=s?{width:s,height:s}:{};return r.default.createElement(o.IconContent,Object.assign({className:i,name:t?"folder_team-small":"folder-small"},a))}})),define("metaserver/static/js/files_view/rows/paper_row",["require","exports","tslib","react","classnames","typescript/component_libraries/retrieval-components/src/highlighted-truncated-string/index","spectrum/media_table/index","spectrum/util/raf_throttle","metaserver/static/js/clean/emoji_utils","metaserver/static/js/clean/filename_highlights","metaserver/static/js/clean/paper_formatting_utils","metaserver/static/js/files_view/file_snippets","metaserver/static/js/files_view/star","metaserver/static/js/files_view/sort_types","metaserver/static/js/files_view/util","metaserver/static/js/core/browser","metaserver/static/js/core/i18n","metaserver/static/js/files_view/rows/row"],(function(e,t,s,i,a,r,o,n,l,c,d,u,p,g,h,_,m,f){"use strict";function S(){}Object.defineProperty(t,"__esModule",{value:!0}),t.PaperRow=void 0,i=s.__importDefault(i),a=s.__importDefault(a),l=s.__importStar(l),d=s.__importStar(d),_=s.__importStar(_);const v=e=>void 0===e?{}:{width:e,minWidth:e,maxWidth:e};class E extends i.default.PureComponent{constructor(e){super(e),this.setRef=e=>{this.brwsFilenameContainerDiv=e},this.handleWindowResize=()=>{this.throttledWindowResize.request()},this.handleResize=()=>{if(this.brwsFilenameContainerDiv){const{brwsFilenameContainerDivWidth:e}=this.state,t=this.brwsFilenameContainerDiv.getBoundingClientRect().width;t&&t!==e&&this.setState({brwsFilenameContainerDivWidth:t})}},this.handleOpenNewTabOrNavigate=e=>{0===e.button&&(e.preventDefault(),e.stopPropagation(),this.handleNavigate({openInNewTab:(0,h.hasModifierKey)(e)}))},this.handleNavigate=({openInNewTab:e})=>{const{paper:t,onOpenPaper:s}=this.props;e?_.open_tab(t.url):s(t)},this.throttledWindowResize=new n.RafThrottle(()=>this.handleResize()),this.state=this.calcState(e)}UNSAFE_componentWillReceiveProps(e){if(this.props.paper.title!==e.paper.title||this.props.paper.highlight_spans!==e.paper.highlight_spans){const t=this.calcState(e);this.setState(t)}}componentDidMount(){this.handleResize(),window.addEventListener("resize",this.handleWindowResize)}componentWillUnmount(){window.removeEventListener("resize",this.handleWindowResize)}componentDidUpdate(e){var t,s;(null===(t=e.columnSizes)||void 0===t?void 0:t[g.SortField.FILENAME])!==(null===(s=this.props.columnSizes)||void 0===s?void 0:s[g.SortField.FILENAME])&&this.handleResize()}calcState(e){return{titleParts:d.getPaperDocTitleParts(e.paper,"brws-file-name-cell-icon","brws-file-name-cell-icon-emoji")}}getHighlightedSpansForHighlightedTruncatedString(e){let{title:t,highlight_spans:s,title_highlights:i}=e;const a=s&&s.length>0,r=l.getFirstEmojiFromTitle(t);if(a){if(r){const e={highlight_str:s[0].highlight_str.substr(r.length),is_highlighted:s[0].is_highlighted};s=[e,...s.slice(1)]}return s.map(e=>({string:e.highlight_str,isHighlighted:e.is_highlighted}))}if(i){if(r){t=t.substr(r.length);const e=r.length/2;i=i.slice().map(t=>({pos:t.pos-e,len:t.string.length,string:t.string}))}return(0,c.highlightMatchSections)(t,i).map(e=>({string:e.text,isHighlighted:e.isHighlighted}))}}renderTitleElement(e){const{paper:t,showHighlights:s}=this.props,{title:a,highlightedTitle:o}=this.state.titleParts;if(e){const o=i.default.createElement(r.HighlightedTruncatedString,{text:a,className:"brws-file-name-element",fontSize:14,highlightSpans:this.getHighlightedSpansForHighlightedTruncatedString(t),cellBuffer:3,availableWidth:e});return i.default.createElement("a",{className:"brws-paper-doc-name-cell-title",href:t.url,onClick:this.handleOpenNewTabOrNavigate},s?o:i.default.createElement("span",null,a))}return i.default.createElement("a",{className:"brws-paper-doc-name-cell-title",href:t.url,onClick:this.handleOpenNewTabOrNavigate},s?o:i.default.createElement("span",null,a))}renderPaperCellContent(e,t){const{paper:s,user:a,showSnippets:r,snippetRows:n,showStar:l}=this.props;return i.default.createElement(i.default.Fragment,null,i.default.createElement("div",{className:"brws-paper-doc-name-cell-content brws-vertically-center"},i.default.createElement("div",{className:"brws-paper-doc-name-cell-title-container"},i.default.createElement(o.MediaCellText,{highlight:e,className:"brws-paper-doc-cell-name"},this.renderTitleElement(t))),i.default.createElement(o.MediaCellText,{variant:"subtitle"},m.intl.formatMessage({id:"mvOTrD",defaultMessage:"in Paper"})),r&&i.default.createElement(o.MediaCellText,{key:"snippets",variant:"subtitle"},i.default.createElement("div",{className:"brws-file-snippets-tags-container"},i.default.createElement(u.FileSnippets,{snippets:s.snippets,lineClamp:n})))),l&&i.default.createElement(p.StarContainer,{item:s,user:a,key:"paperStar",className:"brws-file-name-cell-star",starButtonClassName:"brws-file-name-star-button",alwaysShowUnstarred:!0}))}renderDocName(e,t){const{height:s}=this.props,{icon:r}=this.state.titleParts,n={highlight:e,icon:r,style:Object.assign({minHeight:s-1},v(t))},l=(0,a.default)("brws-file-name-container",{"brws-file-name-container--action-ui-inline-star":!0}),{brwsFilenameContainerDivWidth:c}=this.state;return i.default.createElement(o.MediaCell,Object.assign({key:"docName"},n),i.default.createElement("div",{className:l,ref:this.setRef},this.renderPaperCellContent(e,c)))}renderDocInfo(e){const{paper:t}=this.props,s=t.last_modified_date||"",a=t.last_editor_name?m.intl.formatMessage({id:"ACVnV9",defaultMessage:"by {modified_by}"},{modified_by:t.last_editor_name}):m.intl.formatMessage({id:"5794tP",defaultMessage:"by you"});return i.default.createElement(o.MediaCell,{key:"docInfo",subtitle:a,title:s,style:v(e)})}renderCell({isHovered:e,sortField:t}){var s;const a=null===(s=this.props.columnSizes)||void 0===s?void 0:s[t];switch(t){case g.SortField.FILENAME:return this.renderDocName(e,a);case g.SortField.RELEVANCE:case g.SortField.MODIFIED:return this.renderDocInfo(a);default:return i.default.createElement(o.MediaCell,{key:t,title:i.default.createElement("span",{"aria-hidden":!0},"--"),style:v(a)})}}render(){const{rowIndex:e,topOffset:t,visibleColumns:s,paper:a}=this.props;return i.default.createElement(f.FilesViewRow,{className:"brws-paper-row",topOffset:t,rowIndex:e,filename:a.title,ariaLabel:a.title,onSelect:S,onDeselect:S,onNavigateToItem:this.handleNavigate},({isHovered:e})=>[i.default.createElement(o.MediaCell,{key:"checkboxCell",className:"brws-checkbox-cell"}),...s.map(t=>this.renderCell({isHovered:e,sortField:t.sortField}))])}}t.PaperRow=E,E.defaultProps={showHighlights:!0},E.displayName="PaperRow"})),define("metaserver/static/js/files_view/rows/row",["require","exports","tslib","classnames","react","spectrum/media_table/index","metaserver/static/js/files_view/double_click","metaserver/static/js/files_view/types","metaserver/static/js/files_view/util","metaserver/static/js/clean/ui/selectable_list","metaserver/static/js/campaigns/campaigns_element_id_enum"],(function(e,t,s,i,a,r,o,n,l,c,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FilesViewRow=void 0,i=s.__importDefault(i),a=s.__importDefault(a);const u=({className:e,isSelected:t,isDeleted:s,isDraggable:u,isActiveDropTarget:p,rowIndex:g,ariaLabel:h,filename:_,children:m,onDragEnter:f,isSelectMode:S,onDragStart:v,onDragEnd:E,onNavigateToItem:y,onSelect:T,onDeselect:w,topOffset:b=0})=>{const F=e=>{e.defaultPrevented||(e.preventDefault(),e.shiftKey?T(c.SelectOptions.EXTEND,n.FilesViewActionSource.ROW_SINGLE_CLICK):e.ctrlKey||e.metaKey?T(c.SelectOptions.DEFAULT,n.FilesViewActionSource.ROW_SINGLE_CLICK):t||T(c.SelectOptions.ONLY,n.FilesViewActionSource.ROW_SINGLE_CLICK))},C=(e,t)=>{0===e.button&&(e.preventDefault(),e.stopPropagation(),y({openInNewTab:Boolean((0,l.hasModifierKey)(e)),actionSource:t}))};return a.default.createElement(o.WithDoubleClick,{onClick:e=>{e.defaultPrevented||(e.preventDefault(),e.shiftKey?T(c.SelectOptions.EXTEND,n.FilesViewActionSource.ROW_SINGLE_CLICK):e.ctrlKey||e.metaKey?t?w(!1,n.FilesViewActionSource.ROW_SINGLE_CLICK):T(c.SelectOptions.DEFAULT,n.FilesViewActionSource.ROW_SINGLE_CLICK):T(c.SelectOptions.ONLY,n.FilesViewActionSource.ROW_SINGLE_CLICK))},onDoubleClick:e=>{e.defaultPrevented||C(e,n.FilesViewActionSource.ROW_DOUBLE_CLICK)}},({onClick:o})=>a.default.createElement(r.CulledMediaRow,{className:(0,i.default)(e,{"brws-file-row-selected":t,"brws-file-row-deleted":s,"brws-file-row-dragover":p,"brws-row-click-selection-method":!0}),variant:(p?"dragover":t&&"selected")||"default",onClick:o,onContextMenu:F,draggable:u,topOffset:b,onDragEnter:f,onDragStart:t?v:void 0,onDragEnd:E,"aria-rowindex":(g||0)+1,"aria-label":h,"data-filename":_,tabIndex:S?-1:0===g?0:-1,"data-campaigns-element-id":d.CampaignsElementIdEnum.BROWSE_VIEW_LIST_FILE},m))};u.displayName="FilesViewRowUnmemoed",t.FilesViewRow=a.default.memo(u),t.FilesViewRow.displayName="FilesViewRow"})),define("metaserver/static/js/files_view/rows/row_container",["require","exports","tslib","react","react-redux","metaserver/static/js/files_view/resizing/column_size_context","metaserver/static/js/files_view/data/selectors/instance_selectors","metaserver/static/js/files_view/data/selectors/item_selectors","metaserver/static/js/files_view/rows/file_row"],(function(e,t,s,i,a,r,o,n,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RowContainer=t.RowContainerWithoutRedux=void 0,i=s.__importDefault(i),t.RowContainerWithoutRedux=i.default.memo(e=>i.default.createElement(r.ColumnResizingContext.Consumer,null,({columnSizes:t,columnResizingEnabled:s})=>i.default.createElement(l.FileRow,Object.assign({},e,{columnSizes:s?t:void 0})))),t.RowContainerWithoutRedux.displayName="RowContainerWithoutRedux";t.RowContainer=(0,a.connect)((e,t)=>({arePostTTIModulesLoaded:(0,o.selectArePostTTIModulesLoaded)(e,t),context:(0,o.selectContext)(e,t),isCheckboxDisabled:(0,o.selectDisabledMultiselect)(e,t),responsive:(0,o.selectResponsive)(e,t),showCDMUserEducationEffects:(0,n.selectShowCDMUserEducationEffects)(e,t),height:(0,n.selectRowHeight)(e,Object.assign(Object.assign({},t),{numVisibleColumns:t.visibleColumns.length})),iconSize:(0,n.selectIconSize)(e,t,t.iconSize),isCutToClipboard:(0,n.selectIsCutToClipboard)(e,t)}))(t.RowContainerWithoutRedux)})),define("metaserver/static/js/files_view/scroll_updater",["require","exports","tslib","react-redux","react","metaserver/static/js/files_view/data/selectors/files_view_selectors"],(function(e,t,s,i,a,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ScrollUpdater=void 0,a=s.__importDefault(a),r=s.__importStar(r);t.ScrollUpdater=({scrollContainer:e,path:t})=>{const s=(0,i.useSelector)(r.currentScroll),o=t=>{e&&e.current?e.current.scrollTop=t:window.scrollTo(0,t)};return a.default.useEffect(()=>{(()=>{if(!s)return;const{scrollTop:e}=s;o(e)})()},[s]),a.default.useEffect(()=>{o(0)},[t]),null}})),define("metaserver/static/js/files_view/sticky_table_head",["require","exports","tslib","spectrum/dimensions/index","spectrum/table/index","react","metaserver/static/js/sticky/sticky","metaserver/static/js/sticky/container"],(function(e,t,s,i,a,r,o,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StickyTableHead=void 0,r=s.__importDefault(r);t.StickyTableHead=e=>{var{children:t,columnFlex:l,offsetHeight:c,offsetTop:d}=e,u=s.__rest(e,["children","columnFlex","offsetHeight","offsetTop"]);const p=r.default.createElement(i.Dimensions,{tagName:"tr"},({width:e})=>r.default.createElement("td",{className:"brws-sticky-table-cell"},r.default.createElement(n.StickyContainer,{offsetTop:d},r.default.createElement(o.Sticky,null,r.default.createElement(a.Table,{columnFlex:l,style:{width:e}},r.default.createElement(a.TableHead,Object.assign({},u),t))))));return r.default.createElement("thead",{className:"brws-sticky-table-head"},p)}})),define("metaserver/static/js/files_view/thumbnail_media_cell",["require","exports","tslib","react","spectrum/media_table/index","metaserver/static/js/files_view/file_thumbnail"],(function(e,t,s,i,a,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ThumbnailMediaCell=void 0,i=s.__importDefault(i);t.ThumbnailMediaCell=e=>{var{height:t,width:o,children:n}=e,l=s.__rest(e,["height","width","children"]);const c=void 0===o?{}:{width:o,minWidth:o,maxWidth:o};return i.default.createElement(a.MediaCell,{icon:i.default.createElement(r.FileThumbnail,Object.assign({},l)),style:Object.assign({minHeight:t-1},c),children:n})},t.ThumbnailMediaCell.displayName="ThumbnailMediaCell",t.ThumbnailMediaCell.displayName="ThumbnailMediaCell"})),define("metaserver/static/js/files_view/unity_listener",["require","exports","tslib","react","metaserver/static/js/clean/web_timing_logger","metaserver/static/js/core/cancelable_promise","metaserver/static/js/browse/models"],(function(e,t,s,i,a,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UnityListener=void 0,i=s.__importDefault(i),a=s.__importStar(a);t.UnityListener=({items:t,userId:n})=>{const[l,c]=i.default.useState(void 0);return i.default.useEffect(()=>{const t=(0,r.makeCancelable)(s.__awaiter(void 0,void 0,void 0,(function*(){return yield a.waitForTTI(),(yield new Promise((t,s)=>{e(["metaserver/static/js/clean/unity_browse_interface"],t,s)}).then(s.__importStar)).unityBrowseInterface})));return t.then(e=>c(e)),()=>t.cancel()},[]),i.default.useEffect(()=>{null==l||l.browse_visible_change_callback(t.toArray().filter(e=>e instanceof o.File),n,0,t.size-1)},[l,t,n]),null},t.UnityListener.displayName="UnityListener"})),define("metaserver/static/js/files_view/rows/user_defined_item_row",["require","exports","tslib","react"],(function(e,t,s,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UserDefinedItemRow=void 0,i=s.__importDefault(i),t.UserDefinedItemRow=i.default.memo(({rowIndex:e,topOffset:t,userDefinedItem:s})=>s.renderUserDefinedItemRow({rowIndex:e,topOffset:t})),t.UserDefinedItemRow.displayName="UserDefinedItemRow"})),define("metaserver/static/js/flows/components/badge_async",["require","exports","tslib","react"],(function(e,t,s,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AsyncBadgeComponent=void 0,i=s.__importStar(i);const{lazy:a,Suspense:r}=i,o=a(()=>s.__awaiter(void 0,void 0,void 0,(function*(){const{FlowsFolderBadge:t}=yield new Promise((t,s)=>{e(["metaserver/static/js/flows/components/badge"],t,s)}).then(s.__importStar);return{default:t}})));t.AsyncBadgeComponent=({isFolderFocused:e,folderFqPath:t})=>i.createElement(r,{fallback:i.createElement("div",null)},i.createElement(o,{isFolderFocused:e,folderFqPath:t})),t.AsyncBadgeComponent.displayName="AsyncBadgeComponent"})),define("metaserver/static/js/hooks/usePrevious",["require","exports","react"],(function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.usePrevious=void 0,t.usePrevious=function(e){const t=(0,s.useRef)();return(0,s.useEffect)(()=>{t.current=e},[e]),t.current}})),define("metaserver/static/js/search/api",["require","exports","tslib","metaserver/static/js/clean/analytics","metaserver/static/js/api_v2/user_client","metaserver/static/js/browse/models","metaserver/static/js/search/api_helpers","metaserver/static/js/search/search_helpers","metaserver/static/js/search/types","metaserver/static/js/api_v2/error","metaserver/static/js/search/http3_api"],(function(e,t,s,i,a,r,o,n,l,c,d){"use strict";var u;Object.defineProperty(t,"__esModule",{value:!0}),t.searchApiClient=t.SearchApiClient=void 0,n=s.__importStar(n),(function(e){e.DROPDOWN="dropdown",e.SEARCH_RESULTS_PAGE="search_results_page"})(u||(u={}));class p{constructor(){this._activeRequestControllers={[u.SEARCH_RESULTS_PAGE]:null,[u.DROPDOWN]:null}}loadResults({user:e,path:t,query:s,start:i,maxResults:a,typeaheadSessionId:r,nsId:n,fileNameOnly:l,loadDeleted:c,showPaperResults:d,isDropdown:u,isAdminConsole:p,webTimer:g,onSuccess:h,onError:_}){const m={query:s,fq_path:t,ns_id:n,filename_only:!!l,max_results:a,deleted:!!c,show_paper_results:!!d,is_dropdown:!!u,is_admin_console:!!p,show_unmounted_results:!0,timezone_offset:(0,o.getCurrentTimezoneOffset)(),include_browse_context:!0,exclude_shared_docs:!1,include_highlights:!0,include_snippets:!0};this._fetchResults({requestData:m,nextOffset:i,user:e,typeaheadSessionId:r,onSuccess:h,onError:_,webTimer:g})}_getSearchType(e){return e.is_dropdown?"dropdown":e.deleted?"full_page_deleted":"full_page"}loadPartialResults(e){const t=this._prepareSearchApiRequestData(e);this._fetchResults({requestData:t,nextOffset:e.start,user:e.user,typeaheadSessionId:e.typeaheadSessionId,onSuccess:e.onSuccess,onError:e.onError,webTimer:e.webTimer,skipLogging:e.skipLogging})}_fetchResults({requestData:e,nextOffset:t,user:s,typeaheadSessionId:p,onSuccess:g,onError:h,webTimer:_,skipLogging:m}){const f=e.is_dropdown?u.DROPDOWN:u.SEARCH_RESULTS_PAGE;if(this._activeRequestControllers[f]&&(this._activeRequestControllers[f].abort(),this._activeRequestControllers[f]=null),(function(e){var t;return(0,o.isSearchArgsInvalid)(null!==(t=e.media_filters_enabled)&&void 0!==t&&t,(function(e){var t,s,i,a,r,o,n,c;return{query:e.query,path:e.fq_path,filteredAccountId:e.user_filter_account_id,fileCategoriesString:null!==(t=e.file_categories)&&void 0!==t?t:"",lastModifiedDate:null!==(s=e.last_modified_date)&&void 0!==s?s:l.DateRange.Any,lastModifiedDateStart:null===(i=e.custom_last_modified_date_range)||void 0===i?void 0:i.startDate,lastModifiedDateEnd:null===(a=e.custom_last_modified_date_range)||void 0===a?void 0:a.endDate,dateTaken:null!==(r=e.date_taken)&&void 0!==r?r:l.DateRange.Any,dateTakenStart:null===(o=e.custom_date_taken_range)||void 0===o?void 0:o.startDate,dateTakenEnd:null===(n=e.custom_date_taken_range)||void 0===n?void 0:n.endDate,dimensions:null!==(c=e.selected_dimensions)&&void 0!==c?c:[]}})(e))})(e))return;const S=n.fileCategoryStringToLogValue(e.file_categories),v={path_scoped:"/"!==e.fq_path,search_type:this._getSearchType(e),query_string:e.query,start:t,search_session_id:p,typeahead_session_id:p,timezone_offset:e.timezone_offset,file_type_filters:S,user_filter_account_id:e.user_filter_account_id};m||i.SearchClientActivityLogger.log("query_started",s.id,v);let E=void 0;void 0!==window.AbortController&&(E=new AbortController,this._activeRequestControllers[f]=E);const y=new a.UserApiV2Client,T=s=>{const{result:i,headers:a}=s;this._activeRequestControllers[f]=null;const n=a["x-dropbox-request-id"],l=parseInt(a["x-server-response-time"],10),c=isNaN(l)?void 0:l;let d;i.spell_correction&&(d={query:i.spell_correction.query,score:0,isCorrected:i.spell_correction.is_corrected,requestId:n});const u={results:(0,o.extractSearchV2ResultsList)(i.matches,t,n),hasMore:i.has_more,cursor:i.cursor,spellCorrection:d};g({context:new r.BrowseContext({blockHash:i.root_block_hash}),searchResults:u,deleted:!!e.deleted,requestId:n,serverTimeMs:c}),_&&_.end(n||void 0)},w=e=>{if(void 0===E||!E.signal.aborted){let t="",s="";((0,c.isApiError)(e)||(0,c.isBadRequestError)(e)||(0,c.isAuthError)(e)||(0,c.isAppError)(e)||(0,c.isServerError)(e)||(0,c.isRateLimitError)(e))&&(t=e.toString(),e.headers&&(s=e.headers["x-dropbox-request-id"])),"function"==typeof h&&h(t,s)}_&&_.abort()};if(e.cursor)y.ns("files").rpcWithResponseHeaders("search/continue_v2",{cursor:e.cursor},{subjectUserId:s.id,signal:null==E?void 0:E.signal}).then(T).catch(w);else{const t=e.use_http3?new d.Http3UserApiV2Client:y,i=(0,o.convertRequestDataToV2)(e);t.ns("files").rpcWithResponseHeaders("search_v2",i,{subjectUserId:s.id,signal:null==E?void 0:E.signal}).then(T).catch(w)}}_prepareSearchApiRequestData(e){const t=g(e.isPaperEnabled,!0),s=g(e.searchTags,!1),i=g(e.lastModifiedDate,l.DateRange.Any),a=g(e.dateTaken,l.DateRange.Any),r=g(e.selectedDimensions,[]),o=g(e.media_filters_enabled,!1),c=g(e.media_metadata_search_enable,!1),d=g(e.searchDocClassification,!1),u=g(e.isDropdown,!1),p=g(e.isForResultSuggestions,!1),h=g(e.includeHighlights,!0),_=g(e.includeSnippets,!0),m=g(e.filenameOnly,!1),f=g(e.excludeSharedDocs,!1),S=g(e.useHttp3,!1),v=e.fileCategories,E=v&&!n.allCategoriesChecked(v,t)?n.fileCategoriesToString(v):"",y=e.sortOrder?n.sortFieldToOrderBy(e.sortOrder.sortField):"",T=e.sortOrder?n.sortDirectionToReverseOrder(e.sortOrder.sortDirection):"";return Object.assign(Object.assign({query:e.query,fq_path:e.path,cursor:e.cursor,max_results:e.maxResults,show_paper_results:!0,include_browse_context:e.includeBrowseContext,typeahead_session_id:e.typeaheadSessionId},E&&{file_categories:E}),{order_by:y,reverse_order:T,exclude_shared_docs:f,filename_only:m,include_highlights:h,include_snippets:_,user_filter_account_id:e.filteredAccountId,search_tags:s,last_modified_date:i,custom_last_modified_date_range:e.customLastModifiedDateRange,selected_dimensions:r,date_taken:a,custom_date_taken_range:e.customDateTakenRange,media_filters_enabled:o,media_metadata_search_enable:c,search_doc_classification:d,is_dropdown:u,enable_msoffice_thumbnails:e.enableMSOfficeThumbnails,is_for_result_suggestions:p,use_http3:S,search_response_include_fql:e.searchResponseIncludeFql})}}function g(e,t){return void 0===e?t:e}t.SearchApiClient=p,t.searchApiClient=new p})),define("metaserver/static/js/search/http3_api",["require","exports","metaserver/static/js/api_v2/user_client"],(function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Http3UserApiV2Client=void 0;class i extends s.UserApiV2Client{_authority(){return"www2.dropbox.com"}}t.Http3UserApiV2Client=i})),define("metaserver/static/js/vault/lib/browse_utils",["require","exports","tslib","js/filepath/filepath","metaserver/static/js/vault/constants"],(function(e,t,s,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getVaultFqPath=t.isInsideVault=t.logShareFromInsideVault=void 0,i=s.__importStar(i),t.logShareFromInsideVault=function(t){return s.__awaiter(this,void 0,void 0,(function*(){const{logProductAnalyticsEvent:i}=yield new Promise((t,s)=>{e(["metaserver/static/js/vault/lib/api"],t,s)}).then(s.__importStar),{AnalyticsEventAction:a,AnalyticsEventObject:r,AnalyticsEventActionSurface:o}=yield new Promise((t,s)=>{e(["typescript/component_libraries/vault/src/common/logging-types"],t,s)}).then(s.__importStar);i({eventAction:a.SELECT,eventObject:t?r.SHARE_FOLDER:r.SHARE_FILE,actionSurface:o.VAULT_HOME})}))},t.isInsideVault=function(e){const t=e.split("/");return("/"===e[0]?t[1]:t[0])===a.VAULT_NAME},t.getVaultFqPath=function(){return i.normalize(a.VAULT_NAME)}})),define("metaserver/static/js/file_uploader/result_type",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.error=t.ok=void 0,t.ok=function(e){return{isError:!1,result:e}},t.error=function(e,t){const{isRetriable:s,maxRetries:i,isNetworkError:a}=null!=t?t:{};return{isError:!0,error:e,isRetriable:s,maxRetries:i,isNetworkError:a}}})),define("metaserver/static/js/media_filters/gating",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isOrganizedRetrievalSurveyEnabled=t.isMediaMetadataSearchEnabled=t.isMediaFiltersEnabled=t.isMediaInformationEnabled=void 0,t.isMediaInformationEnabled=function(e){return!!e&&["V1","V2","V3","V1_SURVEY","V2_SURVEY","V3_SURVEY"].includes(e)},t.isMediaFiltersEnabled=function(e){return!!e&&["V2","V3","V2_SURVEY","V3_SURVEY"].includes(e)},t.isMediaMetadataSearchEnabled=function(e){return!!e&&["V3","V3_SURVEY"].includes(e)},t.isOrganizedRetrievalSurveyEnabled=function(e){return!!e&&["SURVEY","V1_SURVEY","V2_SURVEY","V3_SURVEY"].includes(e)}})),define("metaserver/static/js/media_filters/media_search_snippet_loader",["require","exports","tslib","metaserver/static/js/async/loadable","react","metaserver/static/js/clean/web_timing_logger"],(function(e,t,s,i,a,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AsyncMediaSearchSnippet=void 0,a=s.__importDefault(a);const o=(0,i.Loadable)({loader:()=>s.__awaiter(void 0,void 0,void 0,(function*(){yield(0,r.waitForTTI)();const{MediaSearchSnippet:t}=yield new Promise((t,s)=>{e(["metaserver/static/js/media_filters/media_search_snippet"],t,s)}).then(s.__importStar);return t}))});t.AsyncMediaSearchSnippet=e=>a.default.createElement(o,Object.assign({},e)),t.AsyncMediaSearchSnippet.displayName="AsyncMediaSearchSnippet"})),define("metaserver/static/js/files_view/contexts/callback_context",["require","exports","tslib","react"],(function(e,t,s,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FilesViewCallbackContextProvider=t.FilesViewCallbackContext=void 0,i=s.__importStar(i),t.FilesViewCallbackContext=i.createContext(void 0);t.FilesViewCallbackContextProvider=({props:{onDelete:e,onShowRename:s,onNewFolderSubmit:a,onNewFolderCancel:r,onRenameSubmit:o,onRenameCancel:n,onSetClipboard:l,onPasteFromClipboard:c,onSwitchViewType:d,onColumnsChanged:u,onCanDisplayFolderSizesChanged:p,onAddFileJumpKeyCode:g,onResetFileJump:h,onShowShare:_,onPresentInZoom:m,onLocationLinkClick:f,onNavigateToFileOrFolder:S,onNavigateToParentFolder:v,onOpenFileSharedWithMe:E,onOpenPaper:y,onSelectionChange:T,onSortChange:w,onStarClick:b,onComponentTTI:F,onFocusSearchBar:C,shouldShowRenamingBar:I,shouldShowUploadRenamingBar:R,isRenamingBarDisabled:D,setRenamingBarDisabled:O,renamingBarType:A,namingConventionsRules:M},children:L})=>{const P=i.useMemo(()=>({onDelete:e,onShowRename:s,onNewFolderSubmit:a,onNewFolderCancel:r,onRenameSubmit:o,onRenameCancel:n,onSetClipboard:l,onPasteFromClipboard:c,onSwitchViewType:d,onColumnsChanged:u,onCanDisplayFolderSizesChanged:p,onAddFileJumpKeyCode:g,onResetFileJump:h,onShowShare:_,onPresentInZoom:m,onLocationLinkClick:f,onNavigateToFileOrFolder:S,onNavigateToParentFolder:v,onOpenFileSharedWithMe:E,onOpenPaper:y,onSelectionChange:T,onSortChange:w,onStarClick:b,onComponentTTI:F,onFocusSearchBar:C,shouldShowRenamingBar:I,shouldShowUploadRenamingBar:R,isRenamingBarDisabled:D,setRenamingBarDisabled:O,renamingBarType:A,namingConventionsRules:M}),[e,s,a,r,o,n,l,c,d,u,p,g,h,_,m,f,S,v,E,y,T,w,b,F,C,I,R,D,O,A,M]);return i.createElement(t.FilesViewCallbackContext.Provider,{value:P},L)},t.FilesViewCallbackContextProvider.displayName="FilesViewCallbackContextProvider"})),define("metaserver/static/js/files_view/drag_drop/drag_and_drop",["require","exports","metaserver/static/js/browse/models","metaserver/static/js/files_view/util","metaserver/static/js/browse/data/helpers"],(function(e,t,s,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.onFileDragEnterItem=t.cleanupExternalDragHandler=t.setupExternalDragHandler=void 0;const r=new i.ScopedEventHandlers(document);t.setupExternalDragHandler=function(e,t,s,i,a,o,n){r.add(e,"dragenter",e=>{(t()||s())&&!e.target.closest(a)&&o()&&(n(null),i())})},t.cleanupExternalDragHandler=function(e){r.remove(e,"dragenter")},t.onFileDragEnterItem=function(e,t,i,r,o,n,l,c){if(!t&&!i)return;if(e.is_dir&&!(r&&i)&&!(0,a.isBackupFolder)(e)){if(o)return;const t=n.isCurrentPathWriteable()&&!s.File.isReadOnlySharedFolder(e);l(e),c({path:e.fq_path,hasPermissionToUploadToFolder:t,isMovingIntoVault:Boolean(e.is_in_vault_folder)})}else l(null),c()}})),define("metaserver/static/js/files_view/drag_drop/drag_to_select",["require","exports","tslib","react","metaserver/static/js/components/ui/css","metaserver/static/js/files_view/types","metaserver/static/js/clean/ui/selectable_list","lodash","metaserver/static/js/modules/constants/web_experience_constants"],(function(e,t,s,i,a,r,o,n,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DragToSelectController=t.shouldMouseDownInitiateDragToSelect=t.isItemInSelectArea=void 0,i=s.__importStar(i);t.isItemInSelectArea=(e,t)=>!(e.top+e.height<t.top||e.top>t.top+t.height||e.left+e.width<t.left||e.left>t.left+t.width);t.shouldMouseDownInitiateDragToSelect=(e,s,i,a)=>!d(e)&&(e.target===e.currentTarget||(null==i||!i.selected||!i.selected.some(e=>a[e]&&(0,t.isItemInSelectArea)(a[e],Object.assign(Object.assign({},s),{height:0,width:0})))));const c=(0,n.throttle)((function(e,s,i,a,n){Object.keys(e).forEach(l=>{(0,t.isItemInSelectArea)(e[l],s)?(null==n?void 0:n.selected.has(l))||i(l,o.SelectOptions.DEFAULT,r.FilesViewActionSource.DRAG_TO_SELECT):(null==n?void 0:n.selected.has(l))&&a(l,!1,r.FilesViewActionSource.DRAG_TO_SELECT)})}),25),d=e=>{let t=e.target;for(;t instanceof Node&&t!==e.currentTarget;){if(!0===t.draggable)return!0;t=t.parentElement}return!1};t.DragToSelectController=(0,a.requireCssWithComponent)(e=>{const[s,a]=i.default.useState(!1),[o,d]=i.default.useState(!1),[u,p]=i.default.useState(0),g=i.default.useRef(null),h=i.default.useRef({}),[_,m]=i.default.useState({top:0,left:0}),[f,S]=i.default.useState({top:0,left:0,width:0,height:0}),v=(e,t)=>{var s;const i=t.top+40,a=null===(s=g.current)||void 0===s?void 0:s.getBoundingClientRect();if(a){const s=t.width||a.width;h.current[e]={top:i,width:s,left:t.left,height:t.height}}};let E=(0,i.useCallback)(v,[]);l.WEBXP_PERF||(E=v),i.default.useEffect(()=>{const e=(0,n.throttle)(y,8);return o&&(window.document.addEventListener("mouseup",T),window.document.addEventListener("mousemove",e)),()=>{window.document.removeEventListener("mousemove",e),window.document.removeEventListener("mouseup",T)}},[o,s]),i.default.useEffect(()=>(window.document.addEventListener("click",w,!0),()=>{window.document.removeEventListener("click",w,!0)}),[u]),i.default.useEffect(()=>{s&&c(h.current,f,e.handleSelect,e.handleDeselect,e.selection)},[s,f,e.selection]);const y=t=>{var i;if(o){if(1!==t.buttons)return d(!1),void a(!1);const o=null===(i=g.current)||void 0===i?void 0:i.getBoundingClientRect();let n=t.clientX-((null==o?void 0:o.left)||0),l=t.clientY-((null==o?void 0:o.top)||0);l<0&&(l=0),n<0&&(n=0),o&&n-10>o.width&&(n=o.width-10),o&&l-20>o.height&&(l=o.height-20);const c={top:Math.min(_.top,l),left:Math.min(_.left,n),height:Math.abs(_.top-l),width:Math.abs(_.left-n)};!s&&c.width<=5&&c.height<=5||(s?s&&S(c):(t.preventDefault(),e.updateSelection([],r.FilesViewActionSource.DRAG_TO_SELECT,!0),S(c),a(!0)))}},T=e=>{o&&(s&&p(Date.now()),a(!1),d(!1),S({top:0,left:0,width:0,height:0}),m({top:0,left:0}),e.preventDefault())},w=e=>{Date.now()-u<50&&e.preventDefault(),window.document.removeEventListener("click",w,!0)};if(!e.isDragToSelectEnabled){const t=(e,t)=>{};return i.default.createElement("div",null,e.children({registerSelectableItem:t}))}return i.default.createElement("div",{className:"files-view_drag-to-select",onMouseDown:s=>{var i;if(!s.isDefaultPrevented()&&!o&&1===s.buttons){const a=null===(i=g.current)||void 0===i?void 0:i.getBoundingClientRect(),r=s.clientX-((null==a?void 0:a.left)||0),o=s.clientY-((null==a?void 0:a.top)||0);(0,t.shouldMouseDownInitiateDragToSelect)(s,{top:o,left:r},e.selection,h.current)&&(m({top:o,left:r}),S({top:o,left:r,width:0,height:0}),d(!0))}},ref:g},i.default.createElement("div",{className:"files-view_drag-to-select-removal"},e.children({registerSelectableItem:E})),s&&i.default.createElement("div",{className:"files-view_select-box",style:{top:f.top+"px",left:f.left+"px",width:f.width+"px",height:f.height+"px"}}))},["/static/metaserver/static/css/files_view/drag_to_select-vfl1pMR5V.css"])})),define("metaserver/static/js/files_view/file_list_utils",["require","exports","metaserver/static/js/clean/filetypes","metaserver/static/js/files_view/types","metaserver/static/js/browse/models"],(function(e,t,s,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isSharingDisabledForFile=t.canFileBeHighlightedDropTarget=void 0,t.canFileBeHighlightedDropTarget=function({file:e,dropTargetHighlightMode:t}){if(t===i.DropTargetHighlightMode.NONE)return!1;if(!e.is_dir)return!1;if(a.File.isReadOnlySharedFolder(e))return!1;if(e.isDeleted)return!1;switch(t){case i.DropTargetHighlightMode.ALL_FOLDERS:return!0;case i.DropTargetHighlightMode.NONSHARED_FOLDERS:return e.type!==s.FileTypes.SHARED_FOLDER;case i.DropTargetHighlightMode.NONSHARED_NONTEAM_FOLDERS:return![s.FileTypes.SHARED_FOLDER,s.FileTypes.TEAM_SHARED_FOLDER].includes(e.type)}return!1},t.isSharingDisabledForFile=function({context:e,file:t,user:i,expVaultEnableViewOnlySharing:r=!1}){const o=t.per_node_metadata,n=!!((null==o?void 0:o.link_node)||(null==o?void 0:o.suppress_ns_partition)||(null==o?void 0:o.suppress_shared_link));return t.isDeleted||a.File.isTeamMemberFolder(t)||!a.File.canViewFileMembers(t,e)||e.isInsideVaultFolder&&!r||t.type===s.FileTypes.VAULT_FOLDER||t.type===s.FileTypes.SANDBOX||n}})),define("metaserver/static/js/files_view/overflow_menu",["require","exports","tslib","react","classnames","dig-components/buttons","dig-components/icons","dig-components/icons/src","dig-components/menu","metaserver/static/js/async/loadable","metaserver/static/js/core/browser_detection","metaserver/static/js/core/i18n"],(function(e,t,s,i,a,r,o,n,l,c,d,u){"use strict";var p;Object.defineProperty(t,"__esModule",{value:!0}),t.FilesViewOverflowMenu=t.OverflowMenuSize=t.AsyncFilesViewMobileOverflowMenu=void 0,i=s.__importDefault(i),a=s.__importDefault(a),n=s.__importStar(n),t.AsyncFilesViewMobileOverflowMenu=(0,c.Loadable)({loader:()=>new Promise((t,s)=>{e(["metaserver/static/js/files_view/mobile_overflow_menu"],t,s)}).then(s.__importStar).then(({FilesViewMobileOverflowMenu:e})=>e)}),(function(e){e[e.Normal=0]="Normal",e[e.Small=1]="Small"})(p=t.OverflowMenuSize||(t.OverflowMenuSize={}));class g extends i.default.Component{constructor(e){super(e),this.handleSelection=e=>{e.performAction()},this.handleMenuToggle=({isOpen:e})=>{if(e&&this.props.onMenuOpen&&this.props.onMenuOpen(),g.isDynamicProps(this.props)&&e){const e=this.props.getOverflowMenuActions(this.props.file,!!this.props.canDisplayFolderSizes);this.setState({actionSection:e})}},this.handlePreventMouseDown=e=>{e.preventDefault(),e.stopPropagation()},this.handleMobileMenuOpen=e=>t=>{this.handlePreventMouseDown(t),this.handleMenuToggle({isOpen:!0}),e()},this.handleClick=e=>t=>{this.handlePreventMouseDown(t),e({})},this.state={actionSection:g.isDynamicProps(e)?[]:e.actionSection}}render(){const{isResponsive:e,size:s,showBorders:r,ariaHidden:o}=this.props,{file:n}=g.isDynamicProps(this.props)?this.props:{},c=e&&(0,d.is_mobile_or_tablet)(),u=s===p.Small?"small":"standard";return i.default.createElement("div",{"aria-hidden":o?"true":void 0,className:"browse-overflow-menu"},c?i.default.createElement(t.AsyncFilesViewMobileOverflowMenu,{trigger:({openMobileMenu:e})=>i.default.createElement(h,{onClick:this.handleMobileMenuOpen(e),showBorders:r,size:u}),file:n,actionSection:this.state.actionSection}):i.default.createElement(l.Menu.Wrapper,{onSelection:this.handleSelection,onToggle:this.handleMenuToggle,onClick:this.handlePreventMouseDown,onDoubleClick:this.handlePreventMouseDown,isPortaled:!1},({getTriggerProps:e,getContentProps:t,openMenu:s})=>i.default.createElement(i.default.Fragment,null,i.default.createElement(h,{triggerProps:e(),onClick:this.handleClick(s),showBorders:r,size:u,tabIndex:o?-1:0}),i.default.createElement(l.Menu.Content,Object.assign({placement:"bottom-end"},t(),{className:"browse-overflow-menu-content"}),this.state.actionSection.map((e,t)=>i.default.createElement(l.Menu.Segment,{key:`action-group-${t}`},e.map((e,t)=>i.default.createElement(l.Menu.ActionItem,{key:`${t}-${e.label}`,value:e,disabled:e.disabled,className:(0,a.default)("browse-overflow-menu-item",e.className)},e.label))))))))}}t.FilesViewOverflowMenu=g,g.isDynamicProps=e=>"file"in e,g.defaultProps={onMenuToggle:()=>{},isResponsive:!0},g.displayName="FilesViewOverflowMenu";const h=({size:e,showBorders:t,onClick:s,tabIndex:a,triggerProps:l})=>{const c=u.intl.formatMessage({id:"oeNPkV",defaultMessage:"More actions"});return i.default.createElement(r.IconButton,Object.assign({},l,{"aria-label":c,onClick:s,size:e,variant:t?"outline":"transparent",tabIndex:a}),i.default.createElement(o.UIIcon,{src:n.MoreHorizontalLine,size:e}))};h.displayName="MenuTrigger"})),define("metaserver/static/js/files_view/star",["require","exports","tslib","react","metaserver/static/js/files_view/contexts/callback_context","metaserver/static/js/browse/models","metaserver/static/js/starred/browse_exports"],(function(e,t,s,i,a,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StarContainer=void 0,i=s.__importDefault(i);t.StarContainer=({item:e,user:t,className:s,isReadOnly:n,tabIndex:l,starButtonClassName:c,alwaysShowUnstarred:d})=>{const{id:u,type:p}=(0,o.idTypePairFromStarrableItem)(e),g=(0,o.itemNameFromStarrableItem)(e),{onStarClick:h}=i.default.useContext(a.FilesViewCallbackContext)||{};return i.default.createElement("div",{className:s},i.default.createElement(o.Star,{id:u,key:"star",idType:p,isDir:Boolean(e.is_dir),user:t,onStarClick:t=>{e instanceof r.File&&(null==h||h(e,t))},source:o.StarredSource.BROWSE,isReadOnly:n,tabIndex:l,starButtonClassName:c,alwaysShowUnstarred:d,itemName:g}))}})),define("metaserver/static/js/files_view/tile_element",["require","exports","tslib","classnames","react","dig-components/controls","ts-key-enum","metaserver/static/js/clean/paper_formatting_utils","metaserver/static/js/files_view/double_click","metaserver/static/js/icon/file_folder_icon","metaserver/static/js/icon/lock_badge","metaserver/static/js/files_view/tile_grid_logger","metaserver/static/js/user_education/react/user_education_effect","metaserver/static/js/files_view/contexts/file_thumb_store","metaserver/static/js/campaigns/campaigns_element_id_enum"],(function(e,t,s,i,a,r,o,n,l,c,d,u,p,g,h){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TileElement=t.TileElementComponentForTests=t.TilePlaceholder=t.TileLabel=void 0,i=s.__importDefault(i),a=s.__importDefault(a),n=s.__importStar(n);const _=()=>null;t.TileLabel=({ariaLabel:e,children:t,onClick:s})=>{if(!t)return null;const i=a.default.createElement("div",{className:"tile-label","aria-hidden":"true"},t);return s?a.default.createElement("a",{onClick:s,tabIndex:-1,"aria-label":e},i):i},t.TileLabel.displayName="TileLabel";t.TilePlaceholder=({leftOffset:e,tileHeight:s,tileWidth:i,thumbNode:r,labelNode:o})=>a.default.createElement("div",{className:"tile",style:{left:e,height:s,width:i,pointerEvents:"none"}},a.default.createElement("div",{className:"tile__thumb-container",style:{height:i,width:i}},r||a.default.createElement("div",{className:"tile__preview--placeholder"})),a.default.createElement(t.TileLabel,null,o)),t.TilePlaceholder.displayName="TilePlaceholder";class m extends a.default.PureComponent{constructor(e){super(e),this.thumbRequestId=null,this.animationRequestIds=[],this.handleThumbnailError=()=>{const{onThumbnailError:e,tileIndex:t}=this.props;this.setState({thumbLoaded:!1}),e&&e(t)},this.logTileInteractive=()=>{const e=!!this.props.thumbnailUrl,t=this.state.thumbLoaded;if(this.props.onThumbnailLoad){const s=window.requestAnimationFrame(()=>{const s=window.requestAnimationFrame(()=>{this.props.onThumbnailLoad(this.props.tileIndex,e,t)});this.animationRequestIds.push(s)});this.animationRequestIds.push(s)}},this.toggleSelect=e=>{e.stopPropagation(),this.props.handleToggleSelect(e)},this.handleKeyDown=e=>{const t=e.key;e.currentTarget!==e.target||" "!==t&&t!==o.Key.Enter||(e.preventDefault(),this.props.onClick(e))},this.handleCheckboxChange=()=>{},this.state=Object.assign({thumbLoaded:m.isThumbLoaded(e)},this.calcPaperTitleState(e))}componentDidMount(){this.props.delayRenderFullTile?this.renderCompleteTileTimeout=setTimeout(()=>{this.renderCompleteTileTimeout=0,this.fetchThumbnail(this.props)},100):this.fetchThumbnail(this.props),this.logTileInteractive()}componentDidUpdate(e,t){if(!e.isFocused&&this.props.isFocused){const e=this.refs.tileContainer;e&&e.focus()}}UNSAFE_componentWillReceiveProps(e){if(e.thumbnailUrl!==this.props.thumbnailUrl&&(this.unbindThumbnailIfNeeded(),this.fetchThumbnail(e)),m.getPaperTitle(this.props)!==m.getPaperTitle(e)){const t=this.calcPaperTitleState(e);this.setState(t)}}static getPaperTitle(e){return e.paper?e.paper.title:null}calcPaperTitleState(e){return e.paper?{paperTitleParts:n.getPaperDocTitleParts(e.paper,"brws-file-name-grid-icon","brws-file-name-grid-icon-emoji",!0)}:{}}componentWillUnmount(){this.unbindThumbnailIfNeeded(),this.renderCompleteTileTimeout&&clearTimeout(this.renderCompleteTileTimeout),this.animationRequestIds.forEach(e=>{window.cancelAnimationFrame(e)}),this.animationRequestIds=[]}fetchThumbnail(e){const{thumbnailUrl:t,thumbStore:s}=e;if(t){const e=Date.now();this.thumbRequestId=s.bind_url(t,{onSuccess:()=>{this.setState({thumbLoaded:!0}),u.InfiniteTileGridLogger.logThumbRTT(Date.now()-e)},onError:()=>{this.handleThumbnailError()}})}}unbindThumbnailIfNeeded(){const{thumbStore:e}=this.props;this.thumbRequestId&&(e.unbind_url(this.thumbRequestId),this.thumbRequestId=null),this.setState({thumbLoaded:!1})}static isThumbLoaded(e){const{thumbStore:t,thumbnailUrl:s}=e;return!(!s||!t.get_thumb(s))}renderCheckbox(){let e=a.default.createElement(r.Checkbox,{className:"tile-checkbox","aria-label":this.props.checkboxAriaText,onClick:this.toggleSelect,onChange:this.handleCheckboxChange,tabIndex:this.props.checkboxTabIndex,checked:this.props.isSelected});return 0===this.props.tileIndex&&(e=a.default.createElement(p.UserEducationEffect,{containerName:"FileItemRow",name:"FirstFileSelectCheckbox"},e)),a.default.createElement("div",{key:"tile-select-checkbox",className:"tile-select-checkbox"},e)}renderActionNode(){return a.default.createElement("div",{key:"tile-action-node",className:"tile__action-button"},this.props.actionNode)}renderThumbnail(){const{thumbnailUrl:e,thumbStore:t,height:s,width:i,isSelected:r}=this.props;if(this.state.thumbLoaded){const o=t.get_thumb(e);if(o){const e=r?i-24:i,t=s||e;return a.default.createElement(d.LockBadge,{file:this.props.file,variant:"preview-large"},a.default.createElement("img",{className:"tile__preview tile__preview--thumb",draggable:!1,src:o,style:{maxHeight:t,maxWidth:e},onError:this.handleThumbnailError,alt:""}))}}return this.renderFileIcon()}renderFileIcon(){const{file:e,paper:t}=this.props;return t?this.state.paperTitleParts.icon:e?a.default.createElement(c.FileOrFolderIcon,Object.assign({className:"tile__preview tile__preview--icon brws-file-name-grid-icon",file:e,variant:"large",showPreview:!1},{"aria-hidden":!0})):a.default.createElement("div",{className:"tile__preview--placeholder"})}render(){const{altText:e,file:s,height:r,href:o,isActiveDropTarget:n,isAvailableDropTarget:c,isCutToClipboard:d,isDraggable:u,isFocused:p,isSelectable:g,isSelected:_,isViewOnly:m,labelHeight:f,labelNode:S,leftOffset:v,onClick:E,onRightClick:y,onDoubleClick:T,onLabelClick:w,onDragEnter:b,onDragStart:F,onDragEnd:C,overrideTabIndex:I,width:R,className:D}=this.props,O=r||R,A=O+f;if(m)return a.default.createElement(t.TilePlaceholder,{leftOffset:v,tileHeight:A,tileWidth:R,thumbNode:this.renderThumbnail(),labelNode:S});const M={left:v,height:A,width:R},L={height:O,width:R},P={className:(0,i.default)("tile",D,{"tile--is-selected":_,"tile--is-dragover":n,"tile--is-droppable":c&&!n,"tile--is-cut":d}),"data-filename":s&&s.name,"data-campaigns-element-id":h.CampaignsElementIdEnum.BROWSE_VIEW_LIST_FILE,style:M,draggable:u,href:o,onDragEnter:b,onDragStart:F,onDragEnd:C,"aria-label":s&&s.name,role:"gridcell"},N=a.default.createElement("div",{className:"tile__thumb-container",style:L},this.renderThumbnail());return a.default.createElement("div",{role:"row",ref:"tileContainer",className:"tile__container",onKeyDown:this.handleKeyDown,tabIndex:I||p?0:-1,"aria-label":e,"aria-selected":_},a.default.createElement(l.WithDoubleClick,{onClick:E,onDoubleClick:T},e=>a.default.createElement("div",Object.assign({},P,{onClick:e.onClick,onContextMenu:y}),N,g&&this.renderCheckbox(),this.renderActionNode(),a.default.createElement(t.TileLabel,{onClick:w,ariaLabel:s&&s.name},S))))}}t.TileElementComponentForTests=m,m.defaultProps={checkboxAriaText:"",checkboxTabIndex:-1,delayRenderFullTile:!0,handleToggleSelect:_,isFocused:!1,isSelected:!1,isViewOnly:!1,onDragEnter:_,onDragStart:_,onClick:_,onRightClick:_},m.displayName="TileElementComponentForTests",t.TileElement=(0,g.withThumbStore)(m)})),define("metaserver/static/js/files_view/base_tile_grid",["require","exports","tslib","classnames","react","resize-observer-polyfill","react-dom","spectrum/culled_list/index","js/filepath/filepath","metaserver/static/js/clean/js_client_stopwatch","metaserver/static/js/files_view/tile_element","metaserver/static/js/files_view/tile_grid_logger"],(function(e,t,s,i,a,r,o,n,l,c,d,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InfiniteTileGrid=t.TileItemLabelText=t.memoizeCallback=void 0,i=s.__importDefault(i),a=s.__importDefault(a),r=s.__importDefault(r),o=s.__importStar(o),l=s.__importStar(l);function p(e){let t=null;return(...s)=>{if(!t||t.length!==s.length||!t.every((e,t)=>e===s[t]))return t=s,e(...s)}}t.memoizeCallback=p,t.TileItemLabelText=function({className:e,label:t}){return e=(0,i.default)("tile-label__text",e),a.default.createElement("div",{className:e},t)};class g extends a.default.PureComponent{constructor(e){if(super(e),this.tileIndexToRowIndex=[],this.rowHeights=[],this.ttiReported=!1,this.itemRangeByRow=[],this.tileLoadLogger=null,this.updateLayout=()=>{this.animationFrameRequestId=window.requestAnimationFrame(()=>{const e=this.getAndUpdateTileLayout();this.props.logTileLoading&&!this.tileLoadLogger&&this.setupTileLogging(this.getRowHeight(),e.tilesPerRow)})},this.updateScroll=e=>{const{scrollToIndex:t,scrollIntoView:s,scrollPositionOffset:i}=this.props;if(void 0!==t&&s){const a=this.tileIndexToRowIndex[t],r=this.rowHeights.slice(0,a).reduce((e,t)=>e+t,i);s({top:r,bottom:r+this.rowHeights[a]},e)}},this.getAndUpdateTileLayout=()=>{const e=this.props.maxTileWidth+this.props.tilePadding,t=o.findDOMNode(this);if(!t||0===t.clientWidth)return{tileWidth:this.state.tileWidth,tilesPerRow:this.props.tilesPerRow};const s=t.clientWidth;let i=Math.max(1,Math.floor(s/e)),a=this.props.maxTileWidth;return s%e>1&&(i++,a=s/i-this.props.tilePadding),this.state.tileWidth!==a&&this.setState({tileWidth:a}),this.props.tilesPerRow!==i&&this.props.onTilesPerRowChange(i),{tileWidth:a,tilesPerRow:i}},this.handleTTI=()=>{this.ttiReported=!0;const{handleTTI:e}=this.props;e&&e()},this.setLastViewedPage=e=>{if(!this.tileLoadLogger)return;const t=document.documentElement.scrollTop||document.body.scrollTop,s=Math.round(t/e);if(this.tileLoadLogger.pruneTrackedPages(),this.tileLoadLogger.logCompletedPages(),!this.tileLoadLogger.pagesCompletedLogging.has(s)&&!this.tileLoadLogger.pagesToLog.has(s))if(s!==this.tileLoadLogger.lastViewedPage){if(this.tileLoadLogger.lastViewedPage=s,this.tileLoadLogger.pageChangeTime=this.tileLoadLogger.getTimeNow(),!this.tileLoadLogger.startTimeByPage.get(s)){const e=this.tileLoadLogger.getTimeNow();this.tileLoadLogger.startTimeByPage.set(s,e)}}else{this.tileLoadLogger.getTimeNow()-this.tileLoadLogger.pageChangeTime>1e3&&this.tileLoadLogger.pagesToLog.add(s)}},this.logTileError=e=>{this.tileLoadLogger&&this.tileLoadLogger.recordTileError(e),this.props.logTileLoading&&u.InfiniteTileGridLogger.logThumbLoadError()},this.logTileLoaded=(e,t,s)=>{this.tileLoadLogger&&this.tileLoadLogger.recordTileLoaded(e,t,s)},this.renderTileElement=(e,t,s,i)=>{var r,o;if(e<0||e>this.props.totalNumItems)return null;const n=this.props.getTileItem(e,s);if(!n)return a.default.createElement(d.TilePlaceholder,{leftOffset:t,tileHeight:this.state.tileWidth,tileWidth:this.state.tileWidth});const c=this.ttiReported&&this.props.delayRenderFullTile,u=n.isSelectable&&!!this.props.selectedIds&&this.props.selectedIds.has(n.id),p=n.file&&this.props.shouldFileBeHighlightedDropTarget(n.file,u),g=p&&n.file===this.props.activeDropTarget;let h,_="";n.fileSharedWithMe?(_=n.fileSharedWithMe.file_id,h={type:n.fileSharedWithMe.type,icon:n.fileSharedWithMe.icon,fq_path:`/${n.fileSharedWithMe.filename}`,thumbnail_url_tmpl:n.fileSharedWithMe.thumbnail_url_tmpl,name:n.fileSharedWithMe.filename}):n.file&&(_=n.file.fq_path,h={type:n.file.type,icon:n.file.icon,fq_path:n.file.fq_path,thumbnail_url_tmpl:n.file.thumbnail_url_tmpl,name:l.filename(n.file.fq_path),isDeleted:n.file.isDeleted,is_locked:n.file.is_locked,is_lockholder:n.file.is_lockholder,lockholder_name:n.file.lockholder_name,lock_info:n.file.lock_info});const m=n.labelNode?this.props.labelHeight:0;null===(o=(r=this.props).registerSelectableTile)||void 0===o||o.call(r,_,{top:i,left:t,width:this.state.tileWidth,height:m+this.state.tileWidth});const f=0===e&&this.props.selectedIds&&0===this.props.selectedIds.size;return a.default.createElement(d.TileElement,{file:h,paper:n.paper,key:n.id,onClick:n.onClick,onRightClick:n.onRightClick,onDoubleClick:n.onDoubleClick,onLabelClick:n.onLabelClick,width:this.state.tileWidth,leftOffset:t,tileIndex:e,labelHeight:m,delayRenderFullTile:c,actionNode:n.actionNode,thumbnailUrl:n.thumbnailUrl,labelNode:n.labelNode,altText:n.altText,onThumbnailError:this.props.logTileLoading?this.logTileError:void 0,onThumbnailLoad:this.props.logTileLoading?this.logTileLoaded:void 0,isDraggable:n.isDraggable,onDragEnter:n.onDragEnter,onDragStart:n.onDragStart,onDragEnd:n.onDragEnd,isFocused:n.isFocused,isSelectable:n.isSelectable,isSelected:u,isViewOnly:n.isViewOnly,isActiveDropTarget:g,isAvailableDropTarget:p,handleToggleSelect:n.handleToggleSelect,checkboxAriaText:n.checkboxAriaText,checkboxTabIndex:n.isCheckboxFocusable?0:-1,href:n.href,overrideTabIndex:f,isCutToClipboard:n.isCutToClipboard,className:n.className})},this.renderRow=(e,t,s)=>{const i=this.getRowHeight(t);if(!e)return a.default.createElement(n.CulledItem,{className:this.props.rowClass,height:i,key:t,tagName:"div",topOffset:s});if(!Array.isArray(e))return a.default.createElement(n.CulledItem,{className:this.props.rowClass,height:i,key:t,tagName:"div",topOffset:s},e);const[r,o]=e,l=this.state.tileWidth+this.props.tilePadding,c=[];let d=4;for(let e=r;e<o;e++)c.push(this.renderTileElement(e,d,c.length,s)),d+=l;return a.default.createElement(n.CulledItem,{className:this.props.rowClass,height:i,key:t,tagName:"div",topOffset:s},c)},this.handleRangeInView=p((e,t)=>{const{onRangeInView:s}=this.props;if(!s)return;if(0===this.props.totalNumItems)return;const[i,a]=this.translateRowRangeToItemRange(e,t);isNaN(i)||isNaN(a)||s(i,a)}),this.props.sectionLabels||this.props.sectionStartIndices){if(!this.props.sectionLabels||!this.props.sectionStartIndices)throw new Error("Included only one of `sectionLabels` or `sectionStartIndices`.");if(this.props.sectionLabels.length!==this.props.sectionStartIndices.length)throw new Error("sectionLabels and sectionStartIndices must be of same length.")}this.state={tileWidth:this.props.maxTileWidth},c.JSStopwatch.create_stopwatch_if_not_exist("infinite_tile_grid_logging"),this.resizeObserver=new r.default(this.updateLayout)}componentDidMount(){window.addEventListener("resize",this.updateLayout),this.updateLayout(),this.updateScroll(!0);const e=document.querySelector(".maestro-secondary-sidebar-v2");e&&this.resizeObserver.observe(e)}componentDidUpdate(e){this.tileLoadLogger&&this.tileLoadLogger.updateNumTiles(this.props.totalNumItems),e.scrollToIndex!==this.props.scrollToIndex&&this.updateScroll(void 0===e.scrollToIndex||e.scrollToIndex<0),e.maxTileWidth!==this.props.maxTileWidth&&this.updateLayout()}componentWillUnmount(){this.resizeObserver.disconnect(),window.removeEventListener("resize",this.updateLayout),this.animationFrameRequestId&&window.cancelAnimationFrame(this.animationFrameRequestId),this.tileLoadLogger&&(clearInterval(this.logTrackingInterval),this.tileLoadLogger=null)}getRowHeight(e){if(void 0!==e&&this.rowHeights)return this.rowHeights[e];let t=this.state.tileWidth+this.props.tilePadding;return this.props.showLabels&&(t+=this.props.labelHeight+4),t}getPageHeight(){const e=(document.documentElement.clientHeight||window.outerHeight)-(this.props.contentOffset||0),t=this.getRowHeight(),s=t*Math.ceil(e/t);return Math.max(s,t)}setupTileLogging(e,t){const s=this.getPageHeight(),i=t*Math.ceil(s/e);this.tileLoadLogger=new u.InfiniteTileGridLogger(this.props.totalNumItems,i,t,this.handleTTI),this.tileLoadLogger.pagesToLog.add(0);const a=this.tileLoadLogger.getTimeNow();this.tileLoadLogger.startTimeByPage.set(0,a),this.logTrackingInterval=setInterval(this.setLastViewedPage,200,s)}translateRowRangeToItemRange(e,t){const{itemRangeByRow:s}=this;return[s[e][0],s[t][1]]}render(){this.itemRangeByRow=[],this.rowHeights=[],this.tileIndexToRowIndex=[];const e=[],t=this.getRowHeight(),{containerClass:s,enableMaxHeightGrouping:i,numThresholdRows:r,scrollDeltaThreshold:o,sectionStartIndices:l,sectionLabels:c,totalNumItems:d,window:u}=this.props;if(l&&l.length>0)l.forEach((s,i)=>{let r=d;i!==l.length-1&&(r=l[i+1]),this.rowHeights.push(32);const o=r-s,n=Math.ceil(o/this.props.tilesPerRow),u=c[i],p=a.default.createElement("div",{className:"tile-section-header",role:"heading","aria-level":2},u);e.push(p),this.itemRangeByRow.push([s,s]);for(let i=0;i<n;i++){const a=s+i*this.props.tilesPerRow,o=Math.min(a+this.props.tilesPerRow,r),n=[a,o];e.push(n),this.itemRangeByRow.push(n);for(let e=a;e<o;e++)this.tileIndexToRowIndex.push(this.rowHeights.length);this.rowHeights.push(t)}});else{const s=Math.ceil(d/this.props.tilesPerRow);for(let i=0;i<s;i++){const s=i*this.props.tilesPerRow,a=Math.min(s+this.props.tilesPerRow,d),r=[s,a];e.push(r),this.itemRangeByRow.push(r);for(let e=s;e<a;e++)this.tileIndexToRowIndex.push(this.rowHeights.length);this.rowHeights.push(t)}}return a.default.createElement(n.CulledList,{enableMaxHeightGrouping:i,items:e,listItemHeight:this.rowHeights,itemBuffer:r,className:s,renderRow:this.renderRow,scrollThreshold:o,shouldUseWindowAsScrollContainer:!0,onRangeInView:this.handleRangeInView,tagName:"div",window:u})}}t.InfiniteTileGrid=g,g.defaultProps={enableMaxHeightGrouping:!1,numThresholdRows:10,tilePadding:16,tileHeight:160,maxTileWidth:160,labelHeight:40,logTileLoading:!1,scrollDeltaThreshold:1,showLabels:!0,getTileItem:()=>null,handleTTI:()=>{}},g.displayName="InfiniteTileGrid"})),define("metaserver/static/js/files_view/tile_grid_logger",["require","exports","metaserver/static/js/clean/js_client_stopwatch"],(function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InfiniteTileGridLogger=void 0;t.InfiniteTileGridLogger=class{constructor(e,t,s,i){this.recordTileError=e=>{const t=Math.floor(e/this.numTilesPerPage);this.pagesWithThumbErrors.has(t)||this.pagesWithThumbErrors.add(t)},this.recordTileLoaded=(e,t,s)=>{if(s){if(this.thumbsLoaded.has(e))return;this.thumbsLoaded.add(e)}else{if(this.iconsLoaded.has(e))return;this.iconsLoaded.add(e)}let i=!1;i=this.numTiles%this.numTilesPerPage==0?e>=this.numTiles-this.numTilesPerPage:e>=this.numTiles-this.numTiles%this.numTilesPerPage;let a=this.numTilesPerPage;if(i){const e=this.numTiles%this.numTilesPerPage;0!==e&&(a=e)}const r=Math.floor(e/this.numTilesPerPage);if(s||!t){const e=this.numTilesFinalizedByPage[r]||0;this.numTilesFinalizedByPage[r]=e+1}if(0===r&&this.handleTTI){!(this.iconsLoaded.has(e)&&this.thumbsLoaded.has(e))&&(this.numTilesLoadedOnFirstPage++,this.numTilesLoadedOnFirstPage===a&&this.handleTTI())}s&&(this.pagesWithThumbs.has(r)||this.pagesWithThumbs.add(r),this.anyThumbLoadedTimeByPage.get(r)||this.anyThumbLoadedTimeByPage.set(r,this.getTimeNow()),this.numTilesFinalizedByPage[r]===a&&this.allThumbsLoadedTimeByPage.set(r,this.getTimeNow()))},this.pruneTrackedPages=()=>{this.startTimeByPage.forEach((e,t)=>{!this.pagesToLog.has(t)&&!this.pagesCompletedLogging.has(t)&&this.getTimeNow()-e>2e3&&this.startTimeByPage.delete(t)})},this.logCompletedPages=()=>{this.pagesToLog.forEach(e=>{const t=this.startTimeByPage.get(e),s=Math.max(this.allThumbsLoadedTimeByPage.get(e),t),i=Math.max(this.anyThumbLoadedTimeByPage.get(e),t);!s||this.pagesWithThumbs.has(e)?this.pagesWithThumbErrors.has(e)?this.handlePageCompletedLogging(e):t&&s&&i&&(this.logPerfStats(e,t,i,s),this.handlePageCompletedLogging(e)):this.handlePageCompletedLogging(e)})},this.numTiles=e,this.numTilesPerPage=t,this.numTilesFinalizedByPage=[],this.numTilesLoadedOnFirstPage=0,this.iconsLoaded=new Set,this.thumbsLoaded=new Set,this.startTimeByPage=new Map,this.allThumbsLoadedTimeByPage=new Map,this.anyThumbLoadedTimeByPage=new Map,this.pagesWithThumbErrors=new Set,this.pagesWithThumbs=new Set,this.pagesCompletedLogging=new Set,this.pagesToLog=new Set,this.handleTTI=i}getTimeNow(){return window.performance.now()}updateNumTiles(e){this.numTiles>=e||(this.numTiles=e)}handlePageCompletedLogging(e){this.pagesCompletedLogging.add(e),this.pagesToLog.delete(e),this.startTimeByPage.delete(e),this.anyThumbLoadedTimeByPage.delete(e),this.allThumbsLoadedTimeByPage.delete(e)}static logThumbLoadError(){s.JSStopwatch.recordTrace("visual_browse_thumb_load_error",{stopwatchName:"infinite_tile_grid_logging",traceTime:0})}static logThumbRTT(e){s.JSStopwatch.recordTrace("visual_browse_thumb_rtt",{stopwatchName:"infinite_tile_grid_logging",traceTime:e})}logPerfStats(e,t,i,a){s.JSStopwatch.recordTrace(`loaded_any_thumbs_page_${e}`,{stopwatchName:"infinite_tile_grid_logging",traceTime:i-t}),s.JSStopwatch.recordTrace(`loaded_all_thumbs_page_${e}`,{stopwatchName:"infinite_tile_grid_logging",traceTime:a-t})}}})),define("metaserver/static/js/teams/components/item_truncation_container/item_truncation_container",["require","exports","tslib","react","classnames","dig-components/chips","dig-components/tooltips","metaserver/static/js/components/ui/css","dig-components/typography","metaserver/static/js/core/i18n","metaserver/static/js/hooks/resize_observer"],(function(e,t,s,i,a,r,o,n,l,c,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ItemTruncationContainer=t.ItemTruncationContainerWithoutCss=t.renderMoreButton=t.createChipsDefault=t.createMoreTooltipDefault=void 0,i=s.__importStar(i),a=s.__importDefault(a);t.createMoreTooltipDefault=e=>e.map(e=>`#${e}`).join(" ");t.createChipsDefault=(e,t,s,a)=>({item:o,ref:n})=>{const l=t?r.InputChip:r.ChoiceChip;return i.default.createElement(l,{key:o,ref:n,className:a,onClick:t=>null==e?void 0:e(o,t),onDelete:()=>null==t?void 0:t(o),size:s||"small"},"#"+o)};t.renderMoreButton=(e,t,s)=>i.default.createElement(l.Text,{size:"small",className:(0,a.default)("itc-show-more-button",{clickable:void 0!==t},s),onClick:t},"+",e);t.ItemTruncationContainerWithoutCss=function(e){const{showMoreWidth:s=60,containerMaxRows:r=2,itemsToMoreTooltipString:n,expandable:u=!0,renderItem:p,items:g,className:h,showMoreClassName:_}=e,[m,f]=i.default.useState(g.length),[S,v]=i.default.useState(!1),E=i.default.useMemo(()=>Array(g.length).fill(0).map(e=>(0,i.createRef)()),[g]),[y,T]=(0,i.useState)(),w=[];if(g.map((e,t)=>{(t<=m||S)&&w.push(p({item:e,ref:E[t],index:t}))}),E.length>m&&!S){const e=n(g.slice(m+1));w.push(i.default.createElement(o.Tooltip,{id:"more-button-tooltip",title:e,key:g.length},(0,t.renderMoreButton)(E.length-(m+1),u?()=>v(!0):void 0,_)))}const[b,F]=(0,d.useResizeObserver)();return i.default.useEffect(()=>{y&&(f(g.length),T(null))},[null==F?void 0:F.contentRect.width]),i.default.useLayoutEffect(()=>{var e,t;if(!E||!E[0]||!y||0===y.clientWidth)return void(m!==g.length&&f(g.length));const i=((null===(t=null===(e=E[0])||void 0===e?void 0:e.current)||void 0===t?void 0:t.offsetHeight)||1)-1,a=(r-1)*i,o=E.findIndex(e=>{const t=e.current;if(t){const e=y.offsetLeft+y.clientWidth-(t.offsetLeft+t.clientWidth),o=t.offsetTop-y.offsetTop;if(e<s&&o>=a||o>=r*i)return!0}return!1});f(o<0?g.length:o-1)},[g.length,y]),i.default.createElement("div",{ref:b,className:(0,a.default)("itc-container",h)},i.default.createElement("div",{key:g.length,className:"itc-items-container",ref:e=>T(e)},w),S&&i.default.createElement(l.Text,{size:"small",key:"show_less",id:"show-less",onClick:()=>v(!1),className:(0,a.default)("itc-show-more-button clickable",_)},c.intl.formatMessage({id:"QSkw6O",defaultMessage:"show less"})))},t.ItemTruncationContainer=(0,n.requireCssWithComponent)(t.ItemTruncationContainerWithoutCss,["/static/metaserver/static/css/teams/admin/components/item_truncation_container-vflnj951-.css"])})),define("metaserver/static/js/tagging/components/tags_container",["require","exports","tslib","react","classnames","dig-components/chips","metaserver/static/js/components/ui/css","metaserver/static/js/teams/components/item_truncation_container/item_truncation_container","metaserver/static/js/tagging/utils","dig-components/icons","dig-components/icons/src","dig-components/tooltips","metaserver/static/js/core/i18n"],(function(e,t,s,i,a,r,o,n,l,c,d,u,p){"use strict";function g(e){return e.map(e=>(0,l.formatTag)(e.tag_text)).join(" ")}Object.defineProperty(t,"__esModule",{value:!0}),t.TagsContainer=void 0,i=s.__importDefault(i),a=s.__importDefault(a);const h=e=>{const{tags:t,highlightedIndexes:s=[],onTagClick:o,onTagDelete:h,containerClassName:_,chipClassName:m,chipSize:f}=e;if(0===t.length)return null;const S=t.filter((e,t)=>!s.includes(t)),v=t.filter((e,t)=>s.includes(t));return i.default.createElement(n.ItemTruncationContainer,Object.assign({items:[...v,...S],itemsToMoreTooltipString:g,renderItem:({item:e,ref:t,index:s})=>{const n=s<v.length,g=h?r.InputChip:r.FilterChip,_=(0,l.isSuggestedTag)(e),S=_?{withIconLeft:i.default.createElement(c.UIIcon,{src:d.Twinkle2Line,size:"small"})}:{},E=i.default.createElement(g,Object.assign({},S,{key:e.tag_text,ref:t,className:(0,a.default)("tag-chip",{highlighted:n},m),onClick:t=>null==o?void 0:o(e,t),onDelete:()=>null==h?void 0:h(e),size:f||"small"}),(0,l.formatTypedTag)(e));return _?i.default.createElement(u.Tooltip,{title:p.intl.formatMessage({id:"NXiDuW",defaultMessage:"Dropbox added this tag"})},E):E},className:(0,a.default)("tags-container",_)},e))};h.displayName="TagsContainerWithoutCss",t.TagsContainer=(0,o.requireCssWithComponent)(h,["/static/metaserver/static/css/tagging/tags_container-vflJUUvlv.css"])})),define("metaserver/static/js/clean/emoji_utils",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getFirstEmojiFromTitle=void 0;let s;t.getFirstEmojiFromTitle=function(e){const t=(function(){s||(s=/(?:[\u2700-\u27bf]|(?:\ud83c[\udde6-\uddff]){2}|[\ud800-\udbff][\udc00-\udfff]|[\u0023-\u0039]\ufe0f?\u20e3|\u3299|\u3297|\u303d|\u3030|\u24c2|\ud83c[\udd70-\udd71]|\ud83c[\udd7e-\udd7f]|\ud83c\udd8e|\ud83c[\udd91-\udd9a]|\ud83c[\udde6-\uddff]|\ud83c[\ude01-\ude02]|\ud83c\ude1a|\ud83c\ude2f|\ud83c[\ude32-\ude3a]|\ud83c[\ude50-\ude51]|\u203c|\u2049|[\u25aa-\u25ab]|\u25b6|\u25c0|[\u25fb-\u25fe]|\u00a9|\u00ae|\u2122|\u2139|\ud83c\udc04|[\u2600-\u26FF]|\u2b05|\u2b06|\u2b07|\u2b1b|\u2b1c|\u2b50|\u2b55|\u231a|\u231b|\u2328|\u23cf|[\u23e9-\u23f3]|[\u23f8-\u23fa]\ufe0f?|\ud83c\udccf|\u2934|\u2935|[\u2190-\u21ff])/g);return s})();t.lastIndex=0;const i=t.exec(e);if(i&&0===i.index){const s=i[0];if("‍"===e[s.length])return"";const a=t.exec(e);return a&&a.index===s.length?"":s||""}return""}})),define("metaserver/static/js/clean/filename_highlights",["require","exports","tslib","classnames","react"],(function(e,t,s,i,a){"use strict";function r(e,t,s,i){if(!t)return[{text:e,isHighlighted:!1}];s||(s=0),i||(i=e.length),t=(function(e,t){if(!t||!t.length)return[];const s=[];let i=0;return t.forEach(t=>{const a=t.pos;a>i&&(i=a);const r=e.indexOf(t.string,i);r>=0&&s.push({pos:r,len:t.string.length,string:t.string})}),s})(e,t);let a=0,r=0;const o=[];for(;a<e.length;){let n,l;const c=t[r];if(r>=t.length?(l=!1,n=a+e.length):c.pos>a?(l=!1,n=c.pos):(l=!0,n=c.pos+c.len),!(a<s&&n<=s||a>=i&&n>=i)){const t=e.substring(Math.max(a,s),Math.min(n,i));o.push({text:t,isHighlighted:l})}a=n,l&&r++}return o}function o(e,t,s,i){if(s||(s=0),i||(i=e.length),!t||!(function(e,t){const s=t.map(e=>e.highlight_str).join("");return e===s})(e,t))return[{text:e.substring(s,i),isHighlighted:!1}];const a=[];let r=0;for(const o of t){const t=e.indexOf(o.highlight_str,r),n=t+o.highlight_str.length;if(r=n,!(t<s&&n<=s||t>=i)){let e=o.highlight_str;t<s&&(e=e.slice(s-t)),i<n&&(e=e.slice(0,-(n-i))),a.push({text:e,isHighlighted:o.is_highlighted})}}return a}function n(e){return a.createElement("span",null,e.map((e,t)=>a.createElement("span",{className:(0,i.default)({highlighted:e.isHighlighted,"is-highlighted":e.isHighlighted}),key:t},e.text)))}Object.defineProperty(t,"__esModule",{value:!0}),t.highlightReactFromAllHighlightSpans=t.highlightReactFromHighlightSpans=t.highlightSectionsFromHighlightSpans=t.highlightMatchReact=t.highlightMatchSections=void 0,i=s.__importDefault(i),a=s.__importStar(a),t.highlightMatchSections=r,t.highlightMatchReact=function(e,t,s,i){return n(r(e,t,s,i))},t.highlightSectionsFromHighlightSpans=o,t.highlightReactFromHighlightSpans=function(e,t,s,i){return n(o(e,t,s,i))},t.highlightReactFromAllHighlightSpans=function(e){return n(e.map(({highlight_str:e,is_highlighted:t})=>({text:e,isHighlighted:t})))}})),define("metaserver/static/js/clean/paper_formatting_utils",["require","exports","tslib","metaserver/static/js/clean/emoji_utils","react","metaserver/static/js/clean/filename_highlights","typescript/libraries/spectrum-content-icon-compatibility/src/index"],(function(e,t,s,i,a,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getPaperDocTitleParts=void 0,i=s.__importStar(i),a=s.__importDefault(a),r=s.__importStar(r),t.getPaperDocTitleParts=function(e,t,s,n){let{title:l,highlight_spans:c,title_highlights:d}=e;const u=c&&c.length>0,p=i.getFirstEmojiFromTitle(l);if(p)if(l=l.substr(p.length),u){const e={highlight_str:c[0].highlight_str.substr(p.length),is_highlighted:c[0].is_highlighted};c=[e,...c.slice(1)]}else if(d){const e=p.length/2;d=d.slice().map(t=>({pos:t.pos-e,len:t.string.length,string:t.string}))}let g;return g=u?r.highlightReactFromHighlightSpans(l,c):r.highlightMatchReact(l,d),{title:l,highlightedTitle:g,icon:(function(e,t,s,i){return e?a.default.createElement("div",{className:"mc-media-cell-icon brws-file-name-icon-emoji-container"},a.default.createElement(o.IconContent,{name:i?"blank-large":"blank-small",className:t}),a.default.createElement("span",{className:s},e)):a.default.createElement(o.IconContent,{name:i?"paper-large":"paper-small",className:t})})(p,t,s,n)}}})),define("metaserver/static/js/files_view/file_name/renaming_bar_api_v2",["require","exports","tslib","metaserver/static/js/api_v2/user_client"],(function(e,t,s,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.logFinalFilename=t.getMlSuggestedName=t.filenameHasDate=t.getRules=t.namingConventionsFilePreview=t.renamingBarDismiss=t.renamingBarShouldShow=void 0;t.renamingBarShouldShow=(e,t,a)=>s.__awaiter(void 0,void 0,void 0,(function*(){const s=new i.UserApiV2Client,r={folder_has_nc_set:t,renaming_bar_setting_enabled:a};return s.ns("naming_conventions").rpc("renaming_bar/should_show",r,{subjectUserId:e})}));t.renamingBarDismiss=e=>s.__awaiter(void 0,void 0,void 0,(function*(){return(new i.UserApiV2Client).ns("naming_conventions").rpc("renaming_bar/dismiss",{reset:!1},{subjectUserId:e})}));t.namingConventionsFilePreview=(e,t,a,r)=>s.__awaiter(void 0,void 0,void 0,(function*(){const s=new i.UserApiV2Client,o={rules_struct:r,original_source_path:t,user_typed_filename:a};return s.ns("naming_conventions").rpc("file_preview",o,{subjectUserId:e})}));t.getRules=(e,t)=>s.__awaiter(void 0,void 0,void 0,(function*(){return t=a(t),(new i.UserApiV2Client).ns("naming_conventions").rpc("get_rules",{source_path:t},{subjectUserId:e})}));t.filenameHasDate=(e,t)=>s.__awaiter(void 0,void 0,void 0,(function*(){return(new i.UserApiV2Client).ns("naming_conventions").rpc("renaming_bar/filename_has_date",{source_path:t},{subjectUserId:e})}));t.getMlSuggestedName=(e,t)=>s.__awaiter(void 0,void 0,void 0,(function*(){const s=new i.UserApiV2Client,a={source_path:t};return s.ns("naming_conventions").rpc("renaming_bar/get_ml_suggested_name",a,{subjectUserId:e})}));const a=e=>"/"===e?"":e;t.logFinalFilename=(e,t,a)=>s.__awaiter(void 0,void 0,void 0,(function*(){const s=new i.UserApiV2Client,r={filename:t,prediction_id:a};return s.ns("naming_conventions").rpc("renaming_bar/log_final_filename",r,{subjectUserId:e})}))})),define("metaserver/static/js/files_view/file_name/renaming_bar_strings",["require","exports","metaserver/static/js/core/i18n","react-intl"],(function(e,t,s,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.moreOptionsButtonMsg=t.applyButtonMsg=t.suggestedNameAcceptButtonMsg=t.renamingBarSuggestedNameMsg=t.renamingBarExistingNCMsg=t.renamingBarHeuristicMsg=void 0,t.renamingBarHeuristicMsg=s.intl.formatMessage((0,i.defineMessage)({id:"ugdNpg",defaultMessage:"Did you know you can set up a naming convention?"})),t.renamingBarExistingNCMsg=s.intl.formatMessage((0,i.defineMessage)({id:"cBEgKg",defaultMessage:"A naming convention has been set for this folder."})),t.renamingBarSuggestedNameMsg=s.intl.formatMessage((0,i.defineMessage)({id:"8Jd/Qh",defaultMessage:"We also found an alternative name for your file. Do you want to accept it?"})),t.suggestedNameAcceptButtonMsg=s.intl.formatMessage((0,i.defineMessage)({id:"X7fFQv",defaultMessage:"Accept"})),t.applyButtonMsg=s.intl.formatMessage((0,i.defineMessage)({id:"ToRA0Q",defaultMessage:"Apply to file"})),t.moreOptionsButtonMsg=s.intl.formatMessage((0,i.defineMessage)({id:"GYmPZs",defaultMessage:"More Options"}))})),define("metaserver/static/js/files_view/double_click",["require","exports","tslib","react"],(function(e,t,s,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WithDoubleClick=void 0,i=s.__importDefault(i);class a extends i.default.PureComponent{constructor(){super(...arguments),this.lastClickTimestamp=0,this.onClick=e=>{const{onDoubleClick:t,onClick:s,threshold:i}=this.props;if(t){const a=(new Date).getTime();a-this.lastClickTimestamp<i?(t(e),this.lastClickTimestamp=0):(this.lastClickTimestamp=a,s(e))}else s(e)}}render(){return this.props.children({onClick:this.onClick})}}t.WithDoubleClick=a,a.defaultProps={onClick:()=>{},threshold:500},a.displayName="WithDoubleClick"})),define("metaserver/static/js/search/api_helpers",["require","exports","metaserver/static/js/browse/models","metaserver/static/js/core/assert","metaserver/static/js/search/types","metaserver/static/js/clean/filetypes","metaserver/static/js/browse/constants"],(function(e,t,s,i,a,r,o){"use strict";function n(e){return Math.floor(e.getTime()/1e3)}Object.defineProperty(t,"__esModule",{value:!0}),t.isSearchArgsInvalid=t.extractSearchV2ResultsList=t.extractDateRange=t.convertRequestDataToV2=t.OneDaySeconds=t.getCurrentTimezoneOffset=void 0,t.getCurrentTimezoneOffset=function(){return(new Date).getTimezoneOffset()},t.OneDaySeconds=86400;const l={[a.DateRange.Today]:t.OneDaySeconds,[a.DateRange.Last7Days]:7*t.OneDaySeconds,[a.DateRange.Last30Days]:30*t.OneDaySeconds,[a.DateRange.Last90Days]:90*t.OneDaySeconds,[a.DateRange.LastYear]:365*t.OneDaySeconds},c={[a.Dimensions.Small]:{".tag":"small"},[a.Dimensions.Medium]:{".tag":"medium"},[a.Dimensions.Large]:{".tag":"large"},[a.Dimensions.XLarge]:{".tag":"extra_large"}};function d(e,t){return e===a.DateRange.Custom?t?{start_date_sec:n(t.startDate),end_date_sec:n(t.endDate)}:void 0:e!==a.DateRange.Any?{start_date_sec:n(new Date)-l[e]}:void 0}function u(e){return new Date(e).getTime()/1e3}function p(e,t,i){var a,r;const o=e.match_type?e.match_type[".tag"]:null,n=m(e.file_type),l=e.highlight_spans?e.highlight_spans:void 0,c=e.metadata.metadata,d=e.internal_metadata,p=e.snippets,g="folder"===c[".tag"];let h=null;const _=!!g&&c.is_backup_folder;"folder"===c[".tag"]&&c.sharing_info&&!c.sharing_info.no_access&&(h=c.sharing_info.traverse_only?["can_view"]:c.sharing_info.read_only?["can_view","can_view_members"]:["can_edit","can_view","can_view_members"]);const f="deleted"!==c[".tag"]&&(null===(a=c.sharing_info)||void 0===a?void 0:a.is_parent_shared_folder_read_only),S="deleted"!==c[".tag"]?c.icon:"",v="deleted"!==c[".tag"]?c.id:"",E="deleted"!==c[".tag"]?c.per_node_metadata:void 0,y=c.client_modified?u(c.client_modified):0,T="deleted"!==c[".tag"]&&c.is_in_backup_folder;let w=0;const b=c.path_display||"",F=!b;let C,I,R,D="",O=!1,A=!1,M=!1,L=!1;if("file"===c[".tag"]){w=c.size,D=c.rev,O=!!c.cloud_doc_info,C=null===(r=c.cloud_doc_info)||void 0===r?void 0:r.open_url,A=!!c.is_in_vault_folder;const e=c.file_lock_info?c.file_lock_info:void 0;R=(null==e?void 0:e.created)?u(null==e?void 0:e.created):void 0,M=!!e,I=e?{is_lockholder:!!(null==e?void 0:e.is_lockholder),lockholder_name:null==e?void 0:e.lockholder_name,ts_locked:R}:void 0,L=!!c.symlink_info}"deleted"===c[".tag"]&&(w=-1);let P=0;d.is_shared_file&&(P=Math.floor(Math.random()*Math.floor(1e11)));const N=d.last_action_by_user_ts?u(d.last_action_by_user_ts):null,j=d.ns_id,x=d.ns_path,k=d.sjid,U=d.url;return{highlight_spans:l,match_type:o,snippets:p,last_action_by_user_ts:N,direct_blockserver_link:"",is_in_team_folder_tree:d.is_in_team_folder_tree,ns_id:j,ns_path:x,sjid:k,thumbnail_url_tmpl:d.thumbnail_url,has_automated_rule:!1,href:U,last_modified_name:d.modified_by,ext:s.File.getExtensionFromPathForServerObject(g,b),is_dir:g,fq_path:b,bytes:w,type:n,mount_access_perms:h,read_only:f,is_cloud_doc:O,open_to_url:C,is_in_vault_folder:A,lock_info:I,is_locked:M,per_node_metadata:E,is_lockholder:!!(null==I?void 0:I.is_lockholder),lockholder_name:null==I?void 0:I.lockholder_name,ts_locked:R,sort_key:t.toString(),sort_rank:t,event_type:0,file_id:v,icon:S,is_symlink:L,is_unmounted:F,is_versionable:!0,revision_id:D,target_ns:P,request_id:i,ts:y,is_backup_folder:_,is_in_backup_folder:T}}function g(e,t,a){const r=e.match_type?e.match_type[".tag"]:null,o=m(e.file_type),n=e.highlight_spans?e.highlight_spans:[],l=e.metadata.metadata,c=e.internal_metadata,d=e.snippets;if((0,i.assert)("file"===l[".tag"],"Search result metadata should be FileMetadataReference for FileSharedWithMe",{tags:["search"]}),"file"!==l[".tag"])throw Error("Search result metadata should be FileMetadataReference for FileSharedWithMe");const p=l.name,g=u(l.client_modified),h=l.icon,_=l.size,f=l.id,S=u(l.server_modified),v=!!l.cloud_doc_info,E=c.last_action_by_user_ts?u(c.last_action_by_user_ts):null,y=c.url,T=c.thumbnail_url;return{bytes:_,ext:s.File.getExtensionFromPathForServerObject(!1,p||""),file_id:f,filename:p,highlight_spans:n,href:y,icon:h,is_cloud_doc:v,last_modified_name:c.modified_by,match_type:r,request_id:a,server_timestamp:S,sort_rank:t,snippets:d,thumbnail_url_tmpl:T,ts:g,type:o,last_action_by_user_ts:E}}function h(e,t,s){const a=e.highlight_spans?e.highlight_spans:[],r=e.metadata.metadata,o=e.internal_metadata,n=e.snippets;if((0,i.assert)("file"===r[".tag"],"Search result metadata should be FileMetadataReference for legacy Paper",{tags:["search"]}),"file"!==r[".tag"])throw Error("Search result metadata should be FileMetadataReference for legacy Paper");const l=r.name,c=r.id,d=r.client_modified,u=o.modified_by;return{title:l,pad_id:c,url:o.url,title_highlights:[],highlight_spans:a,last_editor_name:u,request_id:s,snippets:n,sort_rank:t,last_modified_date:d,ts:d}}function _(e){const t=e.metadata.metadata,s=e.internal_metadata;let i=a.SearchResultTypes.FILE;return s.is_shared_file?i=a.SearchResultTypes.FILE_SHARED_WITH_ME:"file"===t[".tag"]&&"000000000"===t.rev&&(i=a.SearchResultTypes.PAPER),i}function m(e){return void 0===e?0:r.FileTypeMap.get(e[".tag"])||0}t.convertRequestDataToV2=function(e){var t;let s,i;e.order_by===o.SEARCH_ORDER_BY_TYPE.RELEVANCE?s={".tag":"relevance"}:e.order_by===o.SEARCH_ORDER_BY_TYPE.LAST_MODIFIED_TIME&&(s={".tag":"last_modified_time"}),e.reverse_order&&(i=e.reverse_order===o.SEARCH_REVERSE_ORDER_TYPE.TRUE);const r=[];let n;null===(t=e.file_categories)||void 0===t||t.split(",").forEach(e=>{e===a.FileCategory.OTHER?r.push({".tag":"others"}):r.push({".tag":e})}),e.deleted&&(n={".tag":"deleted"});const l=e.last_modified_date?d(e.last_modified_date,e.custom_last_modified_date_range):void 0,u=e.date_taken?d(e.date_taken,e.custom_date_taken_range):void 0;let p,g;void 0!==e.selected_dimensions&&e.selected_dimensions.length>0&&(p=e.selected_dimensions.map(e=>c[e]).filter(e=>void 0!==e)),void 0===u&&void 0===p||(g={date_taken:u,dimensions:p});const h=!!e.media_metadata_search_enable||void 0;return{query:e.query,options:{path:e.fq_path,max_results:e.max_results,filename_only:e.filename_only,file_categories:r.length>0?r:void 0,account_id:e.user_filter_account_id,order_by:s,reverse_order:i,file_status:n,search_tags:e.search_tags,search_doc_classification:e.search_doc_classification,media_filters:g,search_image_metadata:h,last_modified_date_range:l,is_admin_console:e.is_admin_console,exclude_shared_docs:!!e.exclude_shared_docs,enable_msoffice_thumbnails:e.enable_msoffice_thumbnails,is_for_result_suggestions:!!e.is_for_result_suggestions,search_response_include_fql:e.search_response_include_fql},match_field_options:{include_highlights:!!e.include_highlights,include_snippets:!!e.include_snippets},session_id:e.typeahead_session_id,typeahead_session_id:e.typeahead_session_id}},t.extractDateRange=d,t.extractSearchV2ResultsList=function(e,t,r){const o=[];let n=t;for(const t of e){switch((0,i.assert)("other"!==t.metadata[".tag"],"Search result metadata should not be MetadataV2Other type",{tags:["search"]}),_(t)){case a.SearchResultTypes.FILE:o.push(s.File.fromServerObject(p(t,n,r)));break;case a.SearchResultTypes.FILE_SHARED_WITH_ME:o.push(s.FileSharedWithMe.fromServerObject(g(t,n,r)));break;case a.SearchResultTypes.PAPER:o.push(s.Paper.fromServerObject(h(t,n,r)))}n++}return o},t.isSearchArgsInvalid=function(e,{query:t,filteredAccountId:s,lastModifiedDate:i,dateTaken:r,dimensions:o}){const n=i!==a.DateRange.Any,l=e&&(r!==a.DateRange.Any||o.length>0);return""===t&&!s&&!n&&!l}})),define("typescript/component_libraries/retrieval-components/src/highlighted-truncated-string/index",["require","exports","tslib","classnames","react","spectrum/tooltip/index","typescript/component_libraries/retrieval-components/src/highlighted-truncated-string/em-string","typescript/component_libraries/retrieval-components/src/highlighted-truncated-string/text-highlights","typescript/component_libraries/retrieval-components/src/highlighted-truncated-string/em-string"],(function(e,t,s,i,a,r,o,n,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HighlightedTruncatedString=t.HighlightedTruncatedStringVariant=void 0,i=s.__importDefault(i),a=s.__importStar(a),Object.defineProperty(t,"HighlightedTruncatedStringVariant",{enumerable:!0,get:function(){return l.HighlightedTruncatedStringVariant}});t.HighlightedTruncatedString=({text:e,className:t,ariaLabel:s,highlightSpans:l,tooltipId:d,fontSize:u,availableWidth:p,tooltipPosition:g="above",cellBuffer:h=1,variant:_=o.HighlightedTruncatedStringVariant.HIGHLIGHTED_TRUNCATED_STRING_MIDDLE,isBold:m=!1})=>{const f=a.useRef(null),[S,v]=a.useState(e),[E,y]=a.useState(p),[T,w]=a.useState(!1);a.useEffect(()=>{f.current&&b()},[e,u,_,p]);const b=()=>{if(f.current){const t=f.current,s=p||t.getBoundingClientRect().width;s!==E&&y(s);const i=s/u-h,a=o.Emstring.em_snippet(e,i,.5,_);S!==a&&v(a),F(a,e)}},F=(e,t)=>{S&&t&&w(e!==t)};return a.createElement(r.Tooltip,{id:d,positioning:g,tooltipContent:l?(0,n.generateHighlightedTooltipSpans)((0,n.highlightSectionsFromHighlightSpans)(e,l)):e,showOnMouseMove:T,wrapperClassName:"rc-truncated-string__tooltip"},a.createElement("span",{className:(0,i.default)(t,"rc-hl-truncated-string__container",{"rc-hl-truncated-string__container-bold":m}),"aria-label":s,ref:f,style:{display:"block"}},l?c(S,e,l):S))},t.HighlightedTruncatedString.displayName="HighlightedTruncatedString";const c=(e,t,s)=>{const i=((e,t)=>{let s=0;for(;s<e.length&&e.charAt(s)===t.charAt(s);)++s;return s===e.length||"…"!==e.charAt(s)?[e]:[e.substring(0,s),e.substring(s+1)]})(e,t);if(1===i.length)return(0,n.highlightReactFromHighlightSpans)(e,s);const r=(0,n.highlightReactFromHighlightSpans)(t,s,0,i[0].length),o=(0,n.highlightReactFromHighlightSpans)(t,s,t.lastIndexOf(i[1])),l=(0,n.highlightEllipsisFromHighlightSpans)(i[0].length+1,t.lastIndexOf(i[1])-1,s);return a.createElement("span",null,r,l,o)}})),define("typescript/component_libraries/retrieval-components/src/highlighted-truncated-string/text-highlights",["require","exports","tslib","classnames","react"],(function(e,t,s,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.generateHighlightedTooltipSpans=t.highlightEllipsisFromHighlightSpans=t.highlightReactFromHighlightSpans=t.highlightSectionsFromHighlightSpans=void 0,i=s.__importDefault(i),a=s.__importStar(a);function r(e,t,s,i){if(s||(s=0),void 0===i&&(i=e.length),!t||!(function(e,t){const s=t.map(e=>e.string).join("");return e===s})(e,t))return[{isHighlighted:!1,text:e.substring(s,i)}];const a=[];let r=0;for(const o of t){const t=e.indexOf(o.string,r),n=t+o.string.length;if(r=n,!(t<s&&n<=s||t>=i)){let e=o.string;t<s&&(e=e.slice(s-t)),i<n&&(e=e.slice(0,-(n-i))),a.push({text:e,isHighlighted:o.isHighlighted})}}return a}function o(e,t,s){if(!s)return!1;let i=0;for(let a of s){const s=i+a.string.length-1;if(a.isHighlighted&&s>=e&&i<=t)return!0;i=s+1}return!1}t.highlightSectionsFromHighlightSpans=r,t.highlightReactFromHighlightSpans=function(e,t,s,o){return n=r(e,t,s,o),a.createElement("span",null,n.map((e,t)=>a.createElement("span",{className:(0,i.default)({"rc-hl-truncated-string__highlight":e.isHighlighted}),key:t},e.text)));var n},t.highlightEllipsisFromHighlightSpans=function(e,t,s){return a.createElement("span",{className:(0,i.default)({"rc-hl-truncated-string__highlight":o(e,t,s)})},"…")},t.generateHighlightedTooltipSpans=function(e){return a.createElement("span",null,e.map((e,t)=>a.createElement("span",{className:(0,i.default)({"rc-hl-truncated-string__tooltip-highlight":e.isHighlighted}),key:t},e.text)))}})),define("metaserver/static/js/dropbox/proto/pap_events/naming_conventions/select_ml_suggested_name",["require","exports","tslib","protobufjs/minimal","metaserver/static/js/dropbox/proto/pap_events/predefined_event"],(function(e,t,s,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.pap_events=void 0;(i=s.__importStar(i)).Reader,i.Writer,i.util;const a=i.roots.default||(i.roots.default={});var r,o;t.default=a,t.pap_events=a.pap_events=((r=a.pap_events||{}).naming_conventions=((o=r.naming_conventions||{}).Select_MlSuggestedName=(function(e){function e(e){if(e)for(let t=Object.keys(e),s=0;s<t.length;++s)null!=e[t[s]]&&(this[t[s]]=e[t[s]])}return e.prototype.actionSurface="",e.prototype.eventClass=0,e.prototype.mlSuggestedNamePredictionId="",e.create=function(t){return new e(t)},e.getTypeUrl=function(){return"type.googleapis.com/pap_events.naming_conventions.Select_MlSuggestedName"},e.EventClass=(function(){const e={},t=Object.create(e);return t[e[0]="NAMING_CONVENTIONS"]=0,t})(),e})(o.Select_MlSuggestedName||{}),o),r)})),define("metaserver/static/js/dropbox/proto/pap_events/naming_conventions/attempt_naming_convention",["require","exports","tslib","protobufjs/minimal","metaserver/static/js/dropbox/proto/pap_events/predefined_event"],(function(e,t,s,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.pap_events=void 0;(i=s.__importStar(i)).Reader,i.Writer,i.util;const a=i.roots.default||(i.roots.default={});var r,o;t.default=a,t.pap_events=a.pap_events=((r=a.pap_events||{}).naming_conventions=((o=r.naming_conventions||{}).Attempt_NamingConvention=(function(e){function e(e){if(e)for(let t=Object.keys(e),s=0;s<t.length;++s)null!=e[t[s]]&&(this[t[s]]=e[t[s]])}return e.prototype.actionSurface="",e.prototype.eventClass=0,e.prototype.namingConventionsOrigin=0,e.create=function(t){return new e(t)},e.getTypeUrl=function(){return"type.googleapis.com/pap_events.naming_conventions.Attempt_NamingConvention"},e.EventClass=(function(){const e={},t=Object.create(e);return t[e[0]="NAMING_CONVENTIONS"]=0,t})(),e.NamingConventionsOrigin=(function(){const e={},t=Object.create(e);return t[e[0]="UNKNOWN_NAMING_CONVENTIONS_ORIGIN"]=0,t[e[1]="FROM_HEURISTIC_RENAMING_BAR_NAMING_CONVENTIONS_ORIGIN"]=1,t[e[2]="FROM_EXISTING_NC_RENAMING_BAR_NAMING_CONVENTIONS_ORIGIN"]=2,t[e[3]="FROM_UPLOAD_RENAMING_BAR_NAMING_CONVENTIONS_ORIGIN"]=3,t[e[4]="FROM_NAMING_CONVENTIONS_MODAL_NAMING_CONVENTIONS_ORIGIN"]=4,t})(),e})(o.Attempt_NamingConvention||{}),o),r)})),define("metaserver/static/js/dropbox/proto/pap_events/naming_conventions/dismiss_renaming_bar",["require","exports","tslib","protobufjs/minimal","metaserver/static/js/dropbox/proto/pap_events/predefined_event"],(function(e,t,s,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.pap_events=void 0;(i=s.__importStar(i)).Reader,i.Writer,i.util;const a=i.roots.default||(i.roots.default={});var r,o;t.default=a,t.pap_events=a.pap_events=((r=a.pap_events||{}).naming_conventions=((o=r.naming_conventions||{}).Dismiss_RenamingBar=(function(e){function e(e){if(e)for(let t=Object.keys(e),s=0;s<t.length;++s)null!=e[t[s]]&&(this[t[s]]=e[t[s]])}return e.prototype.actionSurface="",e.prototype.eventClass=0,e.prototype.renamingBarType=0,e.prototype.mlSuggestedNamePredictionId="",e.create=function(t){return new e(t)},e.getTypeUrl=function(){return"type.googleapis.com/pap_events.naming_conventions.Dismiss_RenamingBar"},e.EventClass=(function(){const e={},t=Object.create(e);return t[e[0]="NAMING_CONVENTIONS"]=0,t})(),e.RenamingBarType=(function(){const e={},t=Object.create(e);return t[e[0]="UNKNOWN_RENAMING_BAR_TYPE"]=0,t[e[1]="HEURISTIC_RENAMING_BAR_TYPE"]=1,t[e[2]="EXISTING_NC_RENAMING_BAR_TYPE"]=2,t[e[3]="ML_SUGGESTED_NAME_RENAMING_BAR_TYPE"]=3,t[e[4]="UPLOAD_RENAMING_BAR_TYPE"]=4,t})(),e})(o.Dismiss_RenamingBar||{}),o),r)})),define("metaserver/static/js/dropbox/proto/pap_events/naming_conventions/shown_naming_conventions_modal",["require","exports","tslib","protobufjs/minimal","metaserver/static/js/dropbox/proto/pap_events/predefined_event"],(function(e,t,s,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.pap_events=void 0;(i=s.__importStar(i)).Reader,i.Writer,i.util;const a=i.roots.default||(i.roots.default={});var r,o;t.default=a,t.pap_events=a.pap_events=((r=a.pap_events||{}).naming_conventions=((o=r.naming_conventions||{}).Shown_NamingConventionsModal=(function(e){function e(e){if(e)for(let t=Object.keys(e),s=0;s<t.length;++s)null!=e[t[s]]&&(this[t[s]]=e[t[s]])}return e.prototype.actionSurface="",e.prototype.eventClass=0,e.prototype.namingConventionsOrigin=0,e.create=function(t){return new e(t)},e.getTypeUrl=function(){return"type.googleapis.com/pap_events.naming_conventions.Shown_NamingConventionsModal"},e.EventClass=(function(){const e={},t=Object.create(e);return t[e[0]="NAMING_CONVENTIONS"]=0,t})(),e.NamingConventionsOrigin=(function(){const e={},t=Object.create(e);return t[e[0]="UNKNOWN_NAMING_CONVENTIONS_ORIGIN"]=0,t[e[1]="FROM_HEURISTIC_RENAMING_BAR_NAMING_CONVENTIONS_ORIGIN"]=1,t[e[2]="FROM_EXISTING_NC_RENAMING_BAR_NAMING_CONVENTIONS_ORIGIN"]=2,t[e[3]="FROM_UPLOAD_RENAMING_BAR_NAMING_CONVENTIONS_ORIGIN"]=3,t[e[4]="FROM_NAMING_CONVENTIONS_MODAL_NAMING_CONVENTIONS_ORIGIN"]=4,t})(),e})(o.Shown_NamingConventionsModal||{}),o),r)})),define("metaserver/static/js/dropbox/proto/pap_events/naming_conventions/shown_renaming_bar",["require","exports","tslib","protobufjs/minimal","metaserver/static/js/dropbox/proto/pap_events/predefined_event"],(function(e,t,s,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.pap_events=void 0;(i=s.__importStar(i)).Reader,i.Writer,i.util;const a=i.roots.default||(i.roots.default={});var r,o;t.default=a,t.pap_events=a.pap_events=((r=a.pap_events||{}).naming_conventions=((o=r.naming_conventions||{}).Shown_RenamingBar=(function(e){function e(e){if(e)for(let t=Object.keys(e),s=0;s<t.length;++s)null!=e[t[s]]&&(this[t[s]]=e[t[s]])}return e.prototype.actionSurface="",e.prototype.eventClass=0,e.prototype.renamingBarType=0,e.prototype.mlSuggestedNamePredictionId="",e.create=function(t){return new e(t)},e.getTypeUrl=function(){return"type.googleapis.com/pap_events.naming_conventions.Shown_RenamingBar"},e.EventClass=(function(){const e={},t=Object.create(e);return t[e[0]="NAMING_CONVENTIONS"]=0,t})(),e.RenamingBarType=(function(){const e={},t=Object.create(e);return t[e[0]="UNKNOWN_RENAMING_BAR_TYPE"]=0,t[e[1]="HEURISTIC_RENAMING_BAR_TYPE"]=1,t[e[2]="EXISTING_NC_RENAMING_BAR_TYPE"]=2,t[e[3]="ML_SUGGESTED_NAME_RENAMING_BAR_TYPE"]=3,t[e[4]="UPLOAD_RENAMING_BAR_TYPE"]=4,t})(),e})(o.Shown_RenamingBar||{}),o),r)})),define("metaserver/static/js/file_uploader/file_uploader",["require","exports","tslib","react","metaserver/static/js/core/exception","metaserver/static/js/async/loadable"],(function(e,t,s,i,a,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FileUploaderController=t.resetLoadedModules=t.isModuleLoaded=void 0,i=s.__importDefault(i);const o=(0,r.Loadable)({loader:()=>new Promise((t,s)=>{e(["metaserver/static/js/file_uploader/clean/uploader_main"],t,s)}).then(s.__importStar).then(({FileUploaderFC:e})=>e),loading:()=>null});let n=null,l=new Set;t.isModuleLoaded=e=>l.has(e);t.resetLoadedModules=()=>l=new Set;class c extends i.default.Component{constructor(e){super(e),this.hasLoadedCore=!1,this.handleAllFileUploadsComplete=e=>{this.props.onAllFileUploadsComplete&&this.props.onAllFileUploadsComplete(e)},this.props.loadOnRender&&c.requireFileUploader({}),n?(0,a.reportStack)("Only one FileUploader component may be rendered to the page at any time.You have tried to instantiate multiple uploaders.",{severity:a.SEVERITY.CRITICAL}):n=this,e.shouldInitialize&&c.initialized()}static requireFileUploader({handleUploadButtonClick:t,folderUpload:i,source:a}){return new Promise((t,s)=>{e(["metaserver/static/js/file_uploader/clean/actions"],t,s)}).then(s.__importStar).then(({UploaderActions:e})=>{var s;s="metaserver/static/js/file_uploader/clean/actions",l.add(s),this.reduxUploaderActions=e,n&&(n.hasLoadedCore=!0,c.onInitialized.then(()=>{t&&c.handleUploadButtonClick(!!i,a)}))})}componentDidUpdate(e){!e.shouldInitialize&&this.props.shouldInitialize&&c.initialized()}componentWillUnmount(){n=null,(0,t.resetLoadedModules)()}static loadCoreComponent(){return s.__awaiter(this,void 0,void 0,(function*(){n&&n.hasLoadedCore||(yield c.requireFileUploader({}))}))}static isCoreComponentDefined(){return!(!n||!n.hasLoadedCore)}static setPathAndPermissions(e){var t;null===(t=null==c?void 0:c.reduxUploaderActions)||void 0===t||t.setPath(e)}static setPath(e){var t;null===(t=null==c?void 0:c.reduxUploaderActions)||void 0===t||t.setPath({path:e})}static handleUploadButtonClick(e,t,s){var i;n&&(n&&(null==c?void 0:c.reduxUploaderActions)?null===(i=null==c?void 0:c.reduxUploaderActions)||void 0===i||i.handleUploadButtonClick(e,n.props.uploadConsumerInterface,t,s):c.requireFileUploader({handleUploadButtonClick:!0,folderUpload:e,source:t}))}render(){const{autoTeamGroupId:e,isContentManager:t,getCMUriForFqPath:s,getBrowseContext:a,ajaxInterceptor:r,onFileUploadComplete:n,onModalDismissed:l,dragAndDropEnabled:c,shouldShowDestinationLink:d,uploaderPostTTIExperiments:u,chooseDestination:p,rootNSIDForCM:g,handleClickNewFolder:h,uploadConsumerInterface:_,shouldInitialize:m,isFirstTask:f,hideInlineSnackbar:S}=this.props;return m?i.default.createElement(o,{key:"file-uploader-redux",autoTeamGroupId:e,isContentManager:t,getCMUriForFqPath:s,getBrowseContext:a,ajaxInterceptor:r,onFileUploadComplete:n,onAllFileUploadsComplete:this.handleAllFileUploadsComplete,onModalDismissed:l,dragAndDropEnabled:c,shouldShowDestinationLink:d,uploaderPostTTIExperiments:u,chooseDestination:p,rootNSIDForCM:g,handleClickNewFolder:h,uploadConsumerInterface:_,useUploadKit:!0,isFirstTask:f,"data-testid":"file-uploader",hideInlineSnackbar:S}):null}}t.FileUploaderController=c,c.reduxUploaderActions=null,c.onInitialized=new Promise(e=>{c.initialized=()=>{e()}}),c.defaultProps={shouldInitialize:!0},c.displayName="FileUploaderController"})),define("metaserver/static/js/add_shared_folders/constants",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ActionState=t.ColumnId=t.SortingDirection=t.SnackbarVariant=t.RetryAction=t.WINDOW_WIDTH_THRESHOLD=t.SNACKBAR_TIMEOUT_DELAY_MS=t.ADD_SHARED_FOLDER_API_LIMIT=t.ADD_SHARED_FOLDERS_UI_DEFAULT_LIMIT=void 0,t.ADD_SHARED_FOLDERS_UI_DEFAULT_LIMIT=4,t.ADD_SHARED_FOLDER_API_LIMIT=20,t.SNACKBAR_TIMEOUT_DELAY_MS=5e3,t.WINDOW_WIDTH_THRESHOLD=1325,(function(e){e.MOUNT="mount",e.UNMOUNT="unmount"})(t.RetryAction||(t.RetryAction={})),(function(e){e.MOUNT_SUCCESS="mount_success",e.MOUNT_FAIL="mount_fail",e.UNMOUNT_SUCCESS="unmount_success",e.UNMOUNT_FAIL="unmount_fail"})(t.SnackbarVariant||(t.SnackbarVariant={})),(function(e){e.NEWEST_FIRST="newest_first",e.OLDEST_FIRST="oldest_first"})(t.SortingDirection||(t.SortingDirection={})),(function(e){e.SHARED_FOLDER_ICON="sharedFolderIcon",e.FOLDER_NAME="name",e.SHARED_DATE="sharedDate",e.ADD_HERE_BUTTON="addHereButton",e.DISMISS_BUTTON="dismissButton",e.MORE_BUTTON="moreButton"})(t.ColumnId||(t.ColumnId={})),(function(e){e.START="start",e.SUCCESS="success",e.FAILED="failed"})(t.ActionState||(t.ActionState={}))})),define("metaserver/static/js/files_view/file_jump",["require","exports","tslib","ts-key-enum","metaserver/static/js/core/dom"],(function(e,t,s,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.handleKeyPress=void 0,a=s.__importStar(a);const r=["/","\\",":","?","*","<",">","|"];let o=null;t.handleKeyPress=function(e,t,s,n){const l=e.key;Object.values(i.Key).includes(l)||r.includes(l)||!document.activeElement.closest(".brws-checkbox-cell")&&a.focus_in_input()||e.metaKey||e.altKey||e.altGraphKey||e.ctrlKey||" "===l&&!t()||(" "===l&&t()&&e.preventDefault(),s(l),null!=o&&clearTimeout(o),o=setTimeout(()=>{n()},1e3))}})),define("metaserver/static/js/files_view/file_list_empty_folder_table",["require","exports","tslib","immutable","lodash","react","typescript/component_libraries/dig-experimental/src/table/table","dig-components/combinations","metaserver/static/js/files_view/keyboard_shortcuts","metaserver/static/js/files_view/view_type","metaserver/static/js/modules/constants/web_experience_constants"],(function(e,t,s,i,a,r,o,n,l,c,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EmptyFolderTable=void 0,i=s.__importStar(i),a=s.__importStar(a),r=s.__importDefault(r);t.EmptyFolderTable=({subtitle:e,subtitleLink:t,subtitleOnClick:s,numRowsAbove:u=2,totalRows:p=14,title:g,onTTI:h,onFocusSearchBar:_=a.noop,onNavigateToParentFolder:m=a.noop,onOpenKeyboardShortcutModal:f=a.noop,onPasteFromClipboard:S=a.noop})=>{const v=r.default.useRef(null);r.default.useEffect(()=>(null==h||h(),(0,l.setupFilesViewKeyboardShortcuts)({viewType:c.ViewType.List,getIsGlobalEvent:(0,l.generateGetIsGlobalEventForRef)(v),getIsItemEvent:()=>!1,getSelectedFiles:()=>i.OrderedMap(),isCurrentPathWriteable:()=>!1,selectAllAction:a.noop,deselectAllAction:a.noop,onCopyToClipboard:a.noop,onCutToClipboard:a.noop,onDelete:a.noop,onFocusSearchBar:_,onNavigateToFileOrFolder:a.noop,onNavigateToParentFolder:m,onPasteFromClipboard:S,onShowRename:a.noop,scope:"EmptyFolderTable",onShowHelpMenu:()=>f()}),()=>{(0,l.resetFilesViewKeyboardShortcuts)("EmptyFolderTable")}),[]);const E=[];for(let e=0;e<u;e++)E.push(r.default.createElement(o.Table.Row,{key:-e-1},r.default.createElement(o.Table.Cell,null)));const y=[],T=Math.max(p-u-1,0);for(let e=0;e<T;e++)y.push(r.default.createElement(o.Table.Row,{key:e+1},r.default.createElement(o.Table.Cell,null)));const w=r.default.createElement("h3",{className:"u-font-strong empty-folder-table-title"},g);return"V1"===d.DEFAULT_DRAG_AND_DROP||"V2"===d.DEFAULT_DRAG_AND_DROP?null:r.default.createElement("div",{className:"empty-folder-container"},r.default.createElement(o.Table,{"aria-atomic":"true","aria-live":"polite"},r.default.createElement(o.Table.Header,null),r.default.createElement(o.Table.Body,null,E,r.default.createElement(o.Table.Row,{key:0},r.default.createElement(o.Table.Cell,null,r.default.createElement(n.LabelGroup,{withText:w,withSubtext:e&&t?r.default.createElement("a",{className:"empty-folder-table-subtitle empty-folder-table-link",href:t,onClick:s},e):e?r.default.createElement("span",{className:"empty-folder-table-subtitle"},e):void 0}))),y)))},t.EmptyFolderTable.displayName="EmptyFolderTable"})),define("metaserver/static/js/files_view/keyboard_shortcuts",["require","exports","tslib","keymaster","react-dom","metaserver/static/js/browse/action_logger","metaserver/static/js/files_view/file_jump","metaserver/static/js/files_view/view_type","metaserver/static/js/files_view/util","metaserver/static/js/clean/undo","metaserver/static/js/core/browser_detection","metaserver/static/js/core/i18n","metaserver/static/js/core/notify"],(function(e,t,s,i,a,r,o,n,l,c,d,u,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.resetFileJumpKeyboardShortcuts=t.setupFileJumpKeyboardShortcuts=t.setupFilesViewKeyboardShortcuts=t.getActionsAndAttachLogging=t.resetFilesViewKeyboardShortcuts=t.generateGetIsGlobalEventForRef=t.generateGetIsGlobalEvent=t.FILES_VIEW_TILE_GRID_SHORTCUTS=t.FILES_VIEW_LIST_SHORTCUTS=t.FILES_VIEW_SHORTCUTS=void 0,i=s.__importDefault(i),a=s.__importStar(a),o=s.__importStar(o),c=s.__importStar(c),d=s.__importStar(d),t.FILES_VIEW_SHORTCUTS=[{key:u.intl.formatMessage({id:"kOb587",defaultMessage:"/"}),desc:u.intl.formatMessage({id:"vOBkFB",defaultMessage:"Search"})},{windowsKey:u.intl.formatMessage({id:"JD6thv",defaultMessage:"Ctrl + a"}),macKey:u.intl.formatMessage({id:"vXQEej",defaultMessage:"⌘ + a"}),desc:u.intl.formatMessage({id:"n7drWm",defaultMessage:"Select all files"})},{windowsKey:u.intl.formatMessage({id:"yY9fAj",defaultMessage:"Esc"}),macKey:u.intl.formatMessage({id:"yIq4Am",defaultMessage:"esc"}),desc:u.intl.formatMessage({id:"m7zp3J",defaultMessage:"Deselect all files"})},{windowsKey:u.intl.formatMessage({id:"BmNZ7+",defaultMessage:"Ctrl + c"}),macKey:u.intl.formatMessage({id:"L/3I1a",defaultMessage:"⌘ + c"}),desc:u.intl.formatMessage({id:"jD02CF",defaultMessage:"Copy selected file(s)"})},{windowsKey:u.intl.formatMessage({id:"TeH7ne",defaultMessage:"Ctrl + x"}),macKey:u.intl.formatMessage({id:"Hjoc2x",defaultMessage:"⌘ + x"}),desc:u.intl.formatMessage({id:"JvfueH",defaultMessage:"Cut selected file(s)"})},{windowsKey:u.intl.formatMessage({id:"pApXZD",defaultMessage:"Ctrl + v"}),macKey:u.intl.formatMessage({id:"1MiQRb",defaultMessage:"⌘ + v"}),desc:u.intl.formatMessage({id:"ORvNm9",defaultMessage:"Paste selected file(s) into the current folder"})},{key:u.intl.formatMessage({id:"u3d9dU",defaultMessage:"F2"}),desc:u.intl.formatMessage({id:"GrOPDo",defaultMessage:"Rename selected file"})},{windowsKey:u.intl.formatMessage({id:"kHlg2I",defaultMessage:"Delete"}),macKey:u.intl.formatMessage({id:"ZZU2Yr",defaultMessage:"delete"}),desc:u.intl.formatMessage({id:"45XRF8",defaultMessage:"Delete selected file(s)"})},{windowsKey:u.intl.formatMessage({id:"8X8aMD",defaultMessage:"Ctrl + z"}),macKey:u.intl.formatMessage({id:"10+RMZ",defaultMessage:"⌘ + z"}),desc:u.intl.formatMessage({id:"HGnEOI",defaultMessage:"Undo recent move/copy/rename/delete"})},{key:u.intl.formatMessage({id:"YQJt5v",defaultMessage:"?"}),desc:u.intl.formatMessage({id:"mFXmY0",defaultMessage:"Show keyboard shortcuts"})}],t.FILES_VIEW_LIST_SHORTCUTS=[{key:u.intl.formatMessage({id:"lkVLik",defaultMessage:"↑"}),desc:u.intl.formatMessage({id:"Riu+zT",defaultMessage:"Select previous file (hold shift to select range)"})},{key:u.intl.formatMessage({id:"5ojTma",defaultMessage:"↓"}),desc:u.intl.formatMessage({id:"li5upG",defaultMessage:"Select next file (hold shift to select range)"})},{key:u.intl.formatMessage({id:"u6AlvH",defaultMessage:"←"}),desc:u.intl.formatMessage({id:"rJHa1d",defaultMessage:"Go up a folder"})},{key:u.intl.formatMessage({id:"LJ+WGg",defaultMessage:"→"}),desc:u.intl.formatMessage({id:"+WMBQW",defaultMessage:"Open folder"})},...t.FILES_VIEW_SHORTCUTS],t.FILES_VIEW_TILE_GRID_SHORTCUTS=[{key:u.intl.formatMessage({id:"lkVLik",defaultMessage:"↑"}),desc:u.intl.formatMessage({id:"Xg+zFf",defaultMessage:"Select file in previous row (hold shift to select range)"})},{key:u.intl.formatMessage({id:"5ojTma",defaultMessage:"↓"}),desc:u.intl.formatMessage({id:"erVlBC",defaultMessage:"Select file in next row (hold shift to select range)"})},{key:u.intl.formatMessage({id:"u6AlvH",defaultMessage:"←"}),desc:u.intl.formatMessage({id:"Riu+zT",defaultMessage:"Select previous file (hold shift to select range)"})},{key:u.intl.formatMessage({id:"LJ+WGg",defaultMessage:"→"}),desc:u.intl.formatMessage({id:"li5upG",defaultMessage:"Select next file (hold shift to select range)"})},...t.FILES_VIEW_SHORTCUTS];let g="";const h=new l.ScopedEventHandlers(document);function _(e,t){return s=>{e(s)&&(s.preventDefault(),"function"==typeof t&&t(s))}}function m({user:e,viewType:t,getSelectedFiles:s,isCurrentPathWriteable:i,onShowHelpMenu:a,onDelete:o,onShowRename:n,onFocusSearchBar:l,onNavigateToFileOrFolder:d,onNavigateToParentFolder:g,selectAllAction:h,onCopyToClipboard:_,onCutToClipboard:m,onPasteFromClipboard:f,deselectAllAction:S}){const v=()=>{const e=s(),t=e.some(e=>e.read_only);if(1===e.size)if(i()&&!t){const t=e.first();t.isDeleted?p.Notify.error(u.intl.formatMessage({id:"CCUrto",defaultMessage:"Deleted files can’t be renamed."})):n(t)}else p.Notify.warning(u.intl.formatMessage({id:"jXim1P",defaultMessage:"You don’t have permission to rename files in this folder."}))},E=()=>{const e=s(),t=e.some(e=>!!e.is_in_backup_folder||!!e.is_backup_folder);if(e.size){if(t)return;o(e)}},y=()=>{c.performUndo()},T=()=>{const e=s();1===e.size&&d(e.first())},w=()=>{const e=s(),t=e.first();1===e.size&&t.is_dir&&d(t)},b=(s,i)=>{(0,r.logKeyboardShortcutUsage)({user_id:e?e.id:null,view_type:t,keyboard_shortcut_type:s}),i()};return{renameFile:()=>{b("rename",v)},focusSearchBar:()=>{b("search",l)},showHelpMenu:()=>{b("help",a)},selectAll:()=>{b("select-all",h)},copyToClipboard:()=>{b("copy",_)},cutToClipboard:()=>{b("cut",m)},deleteFiles:()=>{b("delete",E)},pasteFromClipboard:()=>{b("paste",f)},undoAction:()=>{b("undo",y)},deselectFiles:()=>{b("deselect",S)},navigateToFileOrFolder:()=>{b("navigate-file-folder",T)},navigateToFolder:()=>{b("navigate-folder",w)},navigateToParent:()=>{b("navigate-parent",g)}}}t.generateGetIsGlobalEvent=function(e){return t=>!document.activeElement||document.activeElement===document.body||t.target instanceof Element&&a.findDOMNode(e).contains(t.target)},t.generateGetIsGlobalEventForRef=function(e){return t=>{var s;return!document.activeElement||document.activeElement===document.body||t.target instanceof Element&&(null===(s=e.current)||void 0===s?void 0:s.contains(t.target))||!1}},t.resetFilesViewKeyboardShortcuts=function(e){var t;t=e,i.default.clearScope(t),i.default.setScope(g),h.remove(e,"keydown"),h.remove(e,"keyup")},t.getActionsAndAttachLogging=m,t.setupFilesViewKeyboardShortcuts=function(e){const{scope:t,getIsItemEvent:s,getIsGlobalEvent:a}=e;g=i.default.getScope(),g!==t&&i.default.setScope(t);const r=m(e);(0,i.default)("f2",t,_(s,r.renameFile)),(0,i.default)("/",t,_(a,r.focusSearchBar)),(0,i.default)("shift+/",t,_(a,r.showHelpMenu)),(0,i.default)("escape",t,_(a,r.deselectFiles)),d.mac?((0,i.default)("command+a",t,_(a,r.selectAll)),(0,i.default)("command+c",t,_(s,r.copyToClipboard)),(0,i.default)("backspace",t,_(s,r.deleteFiles)),(0,i.default)("command+v",t,_(a,r.pasteFromClipboard)),(0,i.default)("command+x",t,_(s,r.cutToClipboard)),(0,i.default)("command+z",t,_(a,r.undoAction))):((0,i.default)("ctrl+a",t,_(a,r.selectAll)),(0,i.default)("ctrl+c",t,_(s,r.copyToClipboard)),(0,i.default)("delete",t,_(s,r.deleteFiles)),(0,i.default)("ctrl+v",t,_(a,r.pasteFromClipboard)),(0,i.default)("ctrl+x",t,_(s,r.cutToClipboard)),(0,i.default)("ctrl+z",t,_(a,r.undoAction))),e.viewType===n.ViewType.List&&((0,i.default)("right",t,_(s,r.navigateToFolder)),(0,i.default)("left",t,_(a,r.navigateToParent)))},t.setupFileJumpKeyboardShortcuts=function({scope:e,getIsFileJumping:t,onAddFileJumpKeyCode:s,onResetFileJump:a}){h.add(e,"keypress",r=>{i.default.getScope()===e&&o.handleKeyPress(r,t,s,a)})},t.resetFileJumpKeyboardShortcuts=function(e){h.remove(e,"keypress")}}));
//# sourceMappingURL=pkg-file-upload.min.js-vflB2q9fn.map