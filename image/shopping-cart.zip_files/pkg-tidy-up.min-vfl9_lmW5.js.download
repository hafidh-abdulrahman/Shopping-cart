define("metaserver/static/js/browse/actions",["require","exports","tslib","immutable","metaserver/static/js/file_actions/create-folder","metaserver/static/js/file_operations/notifications","js/filepath/filepath","metaserver/static/js/clean/history","metaserver/static/js/clean/ui/async_file_modal_controller","metaserver/static/js/browse/api","metaserver/static/js/browse/constants","metaserver/static/js/browse/data/action_creators/index","metaserver/static/js/browse/data/action_creators/file_actions","metaserver/static/js/browse/data/selectors","metaserver/static/js/browse/data/store","metaserver/static/js/files_view/types","metaserver/static/js/clean/ui/snackbar","metaserver/static/js/sharing/browse_exports","metaserver/static/js/core/i18n","metaserver/static/js/browse/model_types","metaserver/static/js/sync_everything/constants","metaserver/static/js/flows/utils/async_modal_launchers","metaserver/static/js/modules/constants/web_experience_constants"],(function(e,t,a,s,r,i,o,n,l,d,c,u,_,p,m,f,h,S,g,E,T,v,y){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.browseActions=void 0,s=a.__importStar(s),i=a.__importStar(i),o=a.__importStar(o),n=a.__importDefault(n),l=a.__importStar(l),d=a.__importStar(d),u=a.__importStar(u),_=a.__importStar(_),p=a.__importStar(p);t.browseActions=new class{constructor(){this.totalNumFiles=-1,this.initializeEverything=({path:t,files:r,paginatedTotalNumFiles:i,context:n,mountPoints:l,fqPathsToSelect:d,loadingState:c,teamFolders:_,currentFolderInfo:p})=>a.__awaiter(this,void 0,void 0,(function*(){this.reduxStore.dispatch(u.setPath({path:t})),this.reduxStore.dispatch(u.appendFiles({path:t,files:[...r,..._],currentFolderInfo:p})),y.WEBXP_PERF&&this.totalNumFiles==i||(this.totalNumFiles=i,this.reduxStore.dispatch(u.setPaginatedTotalNumFiles({paginatedTotalNumFiles:i}))),this.reduxStore.dispatch(u.setMountPoints({mountPoints:l})),this.reduxStore.dispatch(u.setLoadingState({loadingState:c,path:t})),c===f.LoadingState.LOADED?this.reduxStore.dispatch(u.selectFilesByFqPath({fqPathsToSelect:d})):this.reduxStore.dispatch(u.setFilePathsToSelectOnNextUpdate({filePathsToSelectOnNextUpdate:s.Set(d)})),this.reduxStore.dispatch(u.setContext({context:n})),this.reduxStore.dispatch(u.setCurrentFolderInfo({currentFolderInfo:p}));const m={path:t,hasPermissionToUploadToFolder:n.isCurrentPathWriteable(),isMovingIntoVault:n.isInsideVaultFolder};new Promise((t,a)=>{e(["metaserver/static/js/file_uploader/clean/data/slice"],t,a)}).then(a.__importStar).then(({uploadActionCreators:e})=>{this.reduxStore.dispatch(e.setPath(m))});const{ActionsAdapter:h}=yield new Promise((t,a)=>{e(["metaserver/static/js/file_uploader/actions_adapter"],t,a)}).then(a.__importStar);h.on("uploadComplete",({filesAdded:e})=>{if(!e||0===e.length)return;const t=e.map(e=>o.normalize(e.path)+o.normalize(e.name));this.selectFilesAfterUpload({fqPathsToSelect:t})})})),this.addFilesAndSetLoadingState=({path:e,loadingState:t,files:a,paginatedTotalNumFiles:s})=>{this.reduxStore.dispatch(u.appendFiles({path:e,files:a})),y.WEBXP_PERF&&this.totalNumFiles==s||(this.totalNumFiles=s,this.reduxStore.dispatch(u.setPaginatedTotalNumFiles({paginatedTotalNumFiles:s}))),this.reduxStore.dispatch(u.setLoadingState({loadingState:t,path:e}))},this.setUrl=({path:e,qargs:t,expandedBlade:a,forceExpandRightRail:s})=>{this.reduxStore.dispatch(u.setUrl({path:e,qargs:t,expandedBlade:a,forceExpandRightRail:s}))},this.nameNewFolder=()=>{this.reduxStore.dispatch(u.setNewFolderCreationState({newFolderCreationState:f.NewFolderCreationState.PENDING_INPUT}))},this.createFolderPending=()=>{(0,r.logCreateFolderPending)(),this.reduxStore.dispatch(u.setNewFolderCreationState({newFolderCreationState:f.NewFolderCreationState.SAVING_INPUT}))},this.cancelCreateFolder=e=>{(0,r.logCreateFolderCancel)(e),this.reduxStore.dispatch(u.setNewFolderCreationState({newFolderCreationState:f.NewFolderCreationState.CREATE_FOLDER_INACTIVE}))},this.createFolderComplete=()=>{(0,r.logCreateFolderSuccess)(),this.reduxStore.dispatch(u.setNewFolderCreationState({newFolderCreationState:f.NewFolderCreationState.CREATE_FOLDER_INACTIVE})),h.Snackbar.complete(g.intl.formatMessage({id:"a26imc",defaultMessage:"Folder created."}),"browse-action")},this.createFolder=e=>{this.reduxStore.dispatch(u.createFolder(e))},this.createFolderInNewFolderModal=({folderName:e,isConfidential:a,user:s,context:r,redirectOnSuccess:i,redirectOnCancel:o,fqPath:n,selectCreatedFolder:l,origin:d,shouldSuppressRedirectToBrowse:c,handleSuccessSharing:u,handleCancelSharing:_,shouldLaunchAutomationModal:p,defaultRecipientAccessLevel:m})=>{const f=r?r.currentFQPath:n,h=r?r.rootNSID:s.root_ns_id;if(a&&r&&!r.isInsideTeamFolderTree)(0,S.asyncShowNewFolderShareModal)({defaultBasePath:f,initialContentName:e,onCancel:_,onSuccessSharing:u,setUrl:this.setUrl,shouldSuppressRedirectToBrowse:c,user:s,automationOptionChecked:p,defaultRecipientAccessLevel:m});else{const n=(s.is_cdm_member||a)&&!!r&&r.isInsideTeamFolderTree;t.browseActions.createFolder({pathName:f,folderName:e,nsId:h,checkFSWs:!1,showShareModalOnSuccess:n?this.handleShowShareModal:null,redirectOnSuccess:i,redirectOnCancel:o,selectCreatedFolder:l,origin:d,user:s})}},this.handleNewFolderRedirectOnSuccess=e=>{this.setUrl({path:e})},this.handleNewFolderAutomationRedirect=(e,t,a,s)=>{this.setUrl({path:e}),(0,v.asyncLaunchAddOrEditAutoFolderModal)({fqPath:e,nsId:a,user:t,entryPoint:s,source:"add_from_folder_creation"})},this.doDeleteFilesWithModal=({files:e})=>{const t=p.user(this.reduxStore.getState()),s=p.context(this.reduxStore.getState());l.showDelete(t,e,s,o.filename(s.currentFQPath),()=>a.__awaiter(this,void 0,void 0,(function*(){this.reduxStore.dispatch(_.deleteFiles({files:[...e],checkFSWs:!0}))})))},this.openBackupDeleteDeviceFolderModal=e=>{const t=p.currentFolderBackupInfo(this.reduxStore.getState());l.showBackupDeleteDeviceFolderModal(t,e)},this.purgeSuccessCallback=e=>{t.browseActions.reloadCurrentPath()},this.onPurgeBatch=(t,s)=>{new Promise((t,a)=>{e(["metaserver/static/js/trash/actions"],t,a)}).then(a.__importStar).then(({purgeByPathBatch:e})=>{var a;const r=(0,T.isBackupBrowse)()?null===(a=p.context(this.reduxStore.getState()))||void 0===a?void 0:a.rootNSID:void 0;e(t,s,this.purgeSuccessCallback,void 0,null!=r?r:void 0)})},this.doPermanentDeleteWithModal=e=>{const t=p.user(this.reduxStore.getState()),a=p.context(this.reduxStore.getState());l.showPurgeModal({userId:t.id,context:a,files:e,onPurge:this.onPurgeBatch})},this.onRestore=(e,t,a,s)=>{d.restoreFiles({files:t,userId:e,onSuccess:()=>{i.notifyRestoreSuccess(t)},isSearchMode:a,rootNsId:s})},this.doRestoreFilesWithUnifiedTrashModal=({files:e})=>{const t=p.user(this.reduxStore.getState()),a=p.context(this.reduxStore.getState());l.showUnifiedTrashModal({userId:t.id,context:a,files:e,onRestore:(e,t)=>{var s;this.onRestore(e,t,!1,null!==(s=a.rootNSID)&&void 0!==s?s:void 0)}})},this.handleShowRewindPanel=()=>{n.default.update_query_param(c.BrowseQueryArg.rewind,"true"),this.reduxStore.dispatch(u.showRewind())},this.fetchFolderSizes=({file:e})=>a.__awaiter(this,void 0,void 0,(function*(){const t=p.user(this.reduxStore.getState());let a=c.MAX_FOLDER_SIZE_ITERATIONS;try{this.reduxStore.dispatch(u.requestFolderSizes({fqPath:e.fq_path}));const s=yield d.fetchSharedFolderSizes(t.id,{fq_path:e.fq_path});this.reduxStore.dispatch(u.setFolderSizesPending({fetchFolderSizesResp:s}));let r=[],i=yield this.fetchAndSetSameNamespaceFolderSize(t.id,e.file_id,{fq_path:e.fq_path,folder_limit:c.MAX_FOLDERS_PER_CALL});for(i.queue&&(r=[...r,...i.queue]);r.length>0&&a>0;){a--;const s=Math.min(c.MAX_FOLDER_SIZE_QUEUE_SIZE,r.length),o=r.splice(0,s);i=yield this.fetchAndSetSameNamespaceFolderSize(t.id,e.file_id,{fq_path:e.fq_path,folder_limit:c.MAX_FOLDERS_PER_CALL,queue:o}),i.queue&&r&&(r=[...r,...i.queue])}const o=0!==a&&i.queue&&0===i.queue.length?E.FetchFolderSizeState.COMPLETE:E.FetchFolderSizeState.ERROR;this.reduxStore.dispatch(u.completeFolderSizes({fetchFolderSizeState:o}))}catch(t){this.reduxStore.dispatch(u.setFolderSizesPending({fetchFolderSizesResp:{sizes_dict:[{fq_path:e.fq_path,size:0}],queue:[]}})),this.reduxStore.dispatch(u.completeFolderSizes({fetchFolderSizeState:E.FetchFolderSizeState.ERROR}))}})),this.fetchMultipleFolderSizes=({files:e})=>a.__awaiter(this,void 0,void 0,(function*(){for(const t of e.toArray())yield this.fetchFolderSizes({file:t})})),this.handleShowShareModal=(e,t,a=!1)=>{const s=p.user(this.reduxStore.getState()),r=p.context(this.reduxStore.getState());(0,S.asyncShowShareModal)(s,e,{browseContext:r,origin:t,automationOptionChecked:a},this.setUrl)},this.reduxStore=(0,m.getStoreForBrowse)()}reloadCurrentPath(){this.setUrl({path:p.path(this.reduxStore.getState()),qargs:{reload:!0}})}selectRowsFromBoltClient(e=[]){this.reduxStore.dispatch(u.setFilePathsToSelectOnNextUpdate({filePathsToSelectOnNextUpdate:s.Set(e.map(e=>e.fq_path))}))}selectFilesAfterUpload({fqPathsToSelect:e}){const t=p.unsortedFilesWithFolderSizes(this.reduxStore.getState());e.every(e=>t.has(e))?this.reduxStore.dispatch(u.selectFilesByFqPath({fqPathsToSelect:e})):this.reduxStore.dispatch(u.setFilePathsToSelectOnNextUpdate({filePathsToSelectOnNextUpdate:s.Set(e)}))}selectFilesByFqPath({fqPathsToSelect:e}){this.reduxStore.dispatch(u.selectFilesByFqPath({fqPathsToSelect:e}))}setShouldShowDeletedFiles({shouldShowDeletedFiles:e}){e?n.default.update_query_param(c.BrowseQueryArg.d,"1"):n.default.remove_query_param(c.BrowseQueryArg.d)}fetchAndSetSameNamespaceFolderSize(e,t,s){return a.__awaiter(this,void 0,void 0,(function*(){const a=p.user(this.reduxStore.getState()),{rootNSID:r}=p.context(this.reduxStore.getState()),i=!!r&&(0,T.isUnmountedBackupBrowse)(a,r)?yield d.fetchUnmountedBackupFolderSizes(e,t,s):yield d.fetchSameNamespaceFolderSizes(e,s);return this.reduxStore.dispatch(u.setFolderSizesPending({fetchFolderSizesResp:i})),i}))}}})),define("metaserver/static/js/browse/data/action_creators/file_actions",["require","exports","tslib","metaserver/static/js/file_actions/metrics","metaserver/static/js/file_actions/strings","js/filepath/filepath","metaserver/static/js/metrics/index","metaserver/static/js/clean/ui/async_file_modal_controller","metaserver/static/js/browse/action_logger","metaserver/static/js/browse/constants","metaserver/static/js/browse/data/action_creators/index","metaserver/static/js/browse/data/selectors","metaserver/static/js/browse/logger_util","metaserver/static/js/browse/models","metaserver/static/js/files_view/data/action_creators","metaserver/static/js/files_view/data/selectors/instance_selectors","metaserver/static/js/files_view/file_actions/api_v2","metaserver/static/js/files_view/file_actions/file_from_metadata","metaserver/static/js/files_view/file_actions/rollback","metaserver/static/js/files_view/file_actions/snackbars","metaserver/static/js/files_view/types","metaserver/static/js/tagging/data/action_creators","metaserver/static/js/clean/ui/snackbar","metaserver/static/js/clean/undo","metaserver/static/js/clean/web_user_action_events","metaserver/static/js/core/i18n","metaserver/static/js/sync_everything/hive_logger","metaserver/static/js/sync_everything/types","metaserver/static/js/campaigns/types","metaserver/static/js/campaigns/emitter"],(function(e,t,a,s,r,i,o,n,l,d,c,u,_,p,m,f,h,S,g,E,T,v,y,A,I,b,O,F,R,M){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.renameFile=t.renameUndo=t.deleteFiles=void 0,i=a.__importStar(i),n=a.__importStar(n),u=a.__importStar(u),_=a.__importStar(_),m=a.__importStar(m),f=a.__importStar(f),h=a.__importStar(h),E=a.__importStar(E),O=a.__importStar(O);const C=({state:e,eventName:t,num_files_selected:a,num_folders_selected:s,batch_success_count:r,batch_fail_count:i,lookup_error_type:o,error_summary:n})=>{(0,l.logBrowseAction)({uid:u.user(e).id,action:t,num_files_selected:a,num_folders_selected:s,view_type:f.selectViewType(e,{instanceId:d.BROWSE_FILES_VIEW_ID}),batch_success_count:r,batch_fail_count:i,lookup_error_type:o,error_summary:n})};t.deleteFiles=({files:e,checkFSWs:l})=>(d,m)=>a.__awaiter(void 0,void 0,void 0,(function*(){const f=u.user(m()),S=u.path(m()),T=u.shouldShowDeletedFiles(m()),v=(0,o.getMetricsReporter)(),w=0!==e.length?u.backupInfoByFile(m())(e[0]):void 0,D="cb"===(null==w?void 0:w.type)&&w.usesAnchors,P={surface:"browse",batchSizeBucket:(0,s.bucketForBatchSize)(e.length),contentType:(0,s.batchContentType)(e)},N=v.createTimer({ns:s.FILE_ACTIONS_AMP_NAMESPACE,name:"delete/batch/latency_total_ms"},P),L=Date.now(),U=v.createStats({ns:s.FILE_ACTIONS_AMP_NAMESPACE,name:"delete/batch/latency_average_ms"},P),j=v.createStats({ns:s.FILE_ACTIONS_AMP_NAMESPACE,name:"delete/batch/completed"},P);y.Snackbar.sync(b.intl.formatMessage(r.deleteSnackbarProgressMessage,{count:e.length}),!0,"browse-action"),1!==e.length||T||d((0,c.pushBoltIgnore)({removed:new Set([e[0].fq_path])})),C({state:m(),eventName:I.WebUserActionLogEvent.DELETE_REQUEST_ATTEMPT,num_files_selected:e.length,num_folders_selected:0}),D&&O.logEvent({action_surface:"browse_delete_modal",event:"click_delete",page_source:"browse",extra:{id:w.id,backup_type:F.BackupType.COMPUTER}});const k=yield h.deleteFiles(e,f.id,l);if(k.isError&&"path"===k.error[".tag"]&&"file_system_warnings"===k.error.path[".tag"])return void d((({files:e,details:s})=>(i,o)=>a.__awaiter(void 0,void 0,void 0,(function*(){y.Snackbar.close("browse-action"),n.showFileSystemWarningsModal({fsws:s,onFinalAccept:()=>{i((0,t.deleteFiles)({files:e,checkFSWs:!1}))},confirmText:b.intl.formatMessage(r.deleteFswConfirmText)})})))({files:e,details:k.error.path.details}));if(N.record(),U.record((Date.now()-L)/e.length),k.isError)return d((({files:e,result:t})=>(s,r)=>a.__awaiter(void 0,void 0,void 0,(function*(){const a=u.shouldShowDeletedFiles(r());1!==e.length||a||s((0,c.popBoltIgnore)({removed:new Set([e[0].fq_path])})),y.Snackbar.fail(E.deleteError(e.length,t.error),"browse-action");const i=u.selectedFiles(r()),{num_files_selected:o,num_folders_selected:n}=_.countFilesAndFolders(i);C({state:r(),eventName:I.WebUserActionLogEvent.DELETE_REQUEST_FAIL,num_files_selected:o,num_folders_selected:n,batch_success_count:0,batch_fail_count:e.length,error_summary:t.error_summary})})))({files:e,result:k})),void j.record(0);const x=k.result.entries.filter(e=>"success"===e[".tag"]);d((({pathAtRequestTime:e,successEntries:t})=>(s,r)=>a.__awaiter(void 0,void 0,void 0,(function*(){const a=u.shouldShowDeletedFiles(r());if(!i.paths_are_equal(u.path(r()),e))return;const o=t.map(e=>e.metadata.path_display),n=u.unsortedFiles(r()),l=o.reduce((e,t)=>{if(void 0===t)return e;const s=n.get(t);return a&&void 0!==s?e.set(t,new p.File(Object.assign(Object.assign({},s),{isDeleted:!0}))):e.delete(t)},n);s((0,c.setUnsortedFiles)({unsortedFiles:l}))})))({pathAtRequestTime:S,successEntries:x}));const B=((e,t)=>()=>a.__awaiter(void 0,void 0,void 0,(function*(){y.Snackbar.close("browse-action"),C({state:e,eventName:I.WebUserActionLogEvent.DELETE_UNDO,num_files_selected:t.result.changeset_data.length,num_folders_selected:0}),(0,g.rollback)({changeset_data:t.result.changeset_data,userId:u.user(e).id,onSuccess:()=>{y.Snackbar.complete(b.intl.formatMessage(r.deleteUndoSnackbarMessage),"browse-action"),C({state:e,eventName:I.WebUserActionLogEvent.DELETE_UNDO_REQUEST_SUCCESS,num_files_selected:t.result.changeset_data.length,num_folders_selected:0})}})})))(m(),k);(0,A.setHandleUndo)(B);const Y=k.result.entries.filter(h.isFailure),V=Y[0];let W,q;if(void 0!==V){const e=V.failure;W=e[".tag"],h.isPathLookupFailure(e)&&(q=e.path_lookup[".tag"])}const H=k.result.entries.filter(e=>h.isFailure(e)&&!h.isPathLookupFailure(e.failure)).length;j.record(H>0?0:1),(0,s.recordPathLookupErrors)(Y,"delete",P),Y.length===k.result.entries.length?(y.Snackbar.fail(E.deleteCompleteError(Y),"browse-action"),C({state:m(),eventName:I.WebUserActionLogEvent.DELETE_REQUEST_FAIL,num_files_selected:k.result.changeset_data.length,num_folders_selected:0,batch_success_count:k.result.entries.length-Y.length,batch_fail_count:Y.length,error_summary:W,lookup_error_type:q}),D&&O.logEvent({action_surface:"browse_delete_modal",event:"delete_failure",page_source:"browse",extra:{id:w.id,backup_type:F.BackupType.COMPUTER}})):((0,M.publishEvent)(R.CampaignEvents.DELETE_SUCCESS),y.Snackbar.completeWithUndo(E.deleteCompleteSuccess(e.length,x.length),B,"browse-action"),C({state:m(),eventName:I.WebUserActionLogEvent.DELETE_REQUEST_SUCCESS,num_files_selected:k.result.changeset_data.length,num_folders_selected:0,batch_success_count:k.result.entries.length,batch_fail_count:0,error_summary:W,lookup_error_type:q}),D&&O.logEvent({action_surface:"browse_delete_modal",event:"delete_success",page_source:"browse",extra:{id:w.id,backup_type:F.BackupType.COMPUTER}}))}));const w=(e,t,a,s)=>{const r=u.selectedFiles(e),{num_files_selected:i,num_folders_selected:o}=_.countFilesAndFolders(r);(0,l.logBrowseAction)({uid:u.user(e).id,action:t,num_files_selected:i,num_folders_selected:o,view_type:f.selectViewType(e,{instanceId:d.BROWSE_FILES_VIEW_ID}),result:a,error_summary:s})};t.renameUndo=({file:e,pathAtRequestTime:t,resultEntry:n,changeset:l})=>(d,_)=>a.__awaiter(void 0,void 0,void 0,(function*(){const a=u.user(_()),p=(0,S.fileFromMetadata)(e,n.success),m=(0,o.getMetricsReporter)(),f={surface:"browse",contentType:e.is_dir?"folders":"files",batchSizeBucket:"single"},g={latency:m.createTimer({ns:s.FILE_ACTIONS_AMP_NAMESPACE,name:"undo/latency_ms"},f),completed:m.createStats({ns:s.FILE_ACTIONS_AMP_NAMESPACE,name:"undo/completed"},f)};y.Snackbar.sync(b.intl.formatMessage(r.renameUndoSnackbarProgressMessage),!1,"browse-action"),d((0,c.pushBoltIgnore)({added:new Set([e.fq_path]),removed:new Set([p.fq_path])})),w(_(),I.WebUserActionLogEvent.RENAME_UNDO,e);const E=yield h.undo(l,a);E.isError?(y.Snackbar.fail(b.intl.formatMessage(r.renameUndoSnackbarErrorMessage),"browse-action"),d((0,c.popBoltIgnore)({added:new Set([e.fq_path]),removed:new Set([p.fq_path])})),w(_(),I.WebUserActionLogEvent.RENAME_UNDO_REQUEST_FAIL,e,E.error_summary),g.completed.record(0)):(y.Snackbar.complete(b.intl.formatMessage(r.renameUndoSnackbarSuccessMessage),"browse-action"),i.paths_are_equal(u.path(_()),t)&&(d((0,c.setUnsortedFiles)({unsortedFiles:u.unsortedFiles(_()).remove(p.fq_path).set(e.fq_path,e)})),d((0,c.refreshPinnedItems)())),d((0,c.selectFilesByFqPath)({fqPathsToSelect:[e.fq_path]})),w(_(),I.WebUserActionLogEvent.RENAME_UNDO_REQUEST_SUCCESS,e),g.completed.record(1)),g.latency.record()}));t.renameFile=({file:e,name:l,checkFSWs:d,onSuccessSnackbarClose:_})=>(p,f)=>a.__awaiter(void 0,void 0,void 0,(function*(){const g=u.user(f()),O=u.path(f()),F=(0,o.getMetricsReporter)(),R={surface:"browse",contentType:e.is_dir?"folders":"files"},M={latency:F.createTimer({ns:s.FILE_ACTIONS_AMP_NAMESPACE,name:"rename/latency_ms"},R),completed:F.createStats({ns:s.FILE_ACTIONS_AMP_NAMESPACE,name:"rename/completed"},R)};if(-1!==l.indexOf("/"))return y.Snackbar.fail(b.intl.formatMessage(r.renameErrorInvalidName),"browse-action"),void p(m.setFileRename({file:e,renameState:null}));p(m.setFileRename({file:e,renameState:T.RenameState.SAVING_INPUT})),y.Snackbar.sync(b.intl.formatMessage(r.renameSnackbarProgressMessage),!1,"browse-action");const C=yield h.renameFile(e.fq_path,l,g.id,{checkFSWs:d});if(C.isError&&"to"===C.error[".tag"]&&"file_system_warnings"===C.error.to[".tag"])return void p((({file:e,name:s,details:i})=>(o,l)=>a.__awaiter(void 0,void 0,void 0,(function*(){y.Snackbar.close("browse-action"),n.showFileSystemWarningsModal({fsws:i,onFinalAccept:()=>{o((0,t.renameFile)({file:e,name:s,checkFSWs:!1}))},onAbortAction:()=>{o(m.setFileRename({file:e,renameState:null})),o((0,c.pushBoltIgnore)({moved:new Set([e.fq_path])}))},confirmText:b.intl.formatMessage(r.renameFswConfirmText)})})))({file:e,name:l,details:C.error.to.details}));if(M.latency.record(),C.isError||"success"!==C.result.entries[0][".tag"]){const t=C.isError?C:h.createUndefinedRpcResult();return p((({file:e,result:t})=>(s,r)=>a.__awaiter(void 0,void 0,void 0,(function*(){s((0,c.pushBoltIgnore)({moved:new Set([e.fq_path])})),s(m.setFileRename({file:e,renameState:null})),y.Snackbar.fail(E.renameError(t.error,e.fq_path),"browse-action"),w(r(),I.WebUserActionLogEvent.RENAME_REQUEST_FAIL,e,t.error_summary)})))({file:e,result:t})),M.completed.record(0),void F.createStats({ns:s.FILE_ACTIONS_AMP_NAMESPACE,name:"rename/error"},Object.assign(Object.assign({},R),{error:t.error[".tag"]})).record(1)}const D=C.result.entries[0],P=(0,S.fileFromMetadata)(e,D.success);i.paths_are_equal(u.path(f()),O)&&(p((0,c.setUnsortedFiles)({unsortedFiles:u.unsortedFiles(f()).remove(e.fq_path).set(P.fq_path,P)})),p((0,v.fileRename)({file:e,newFile:P})),p((0,c.refreshPinnedItems)())),p((0,c.selectFilesByFqPath)({fqPathsToSelect:[P.fq_path]})),p(m.setFileRename({file:e,renameState:null})),M.completed.record(1);const N=()=>{p((0,t.renameUndo)({file:e,resultEntry:D,pathAtRequestTime:O,changeset:C.result.changeset_data}))};(0,A.setHandleUndo)(N),y.Snackbar.completeWithUndo(b.intl.formatMessage(r.renameSnackbarSuccessMessage),N,"browse-action",{onClosed:()=>{null==_||_(P)}}),w(f(),I.WebUserActionLogEvent.RENAME_REQUEST_SUCCESS,P)}))})),define("metaserver/static/js/browse/data/action_creators/index",["require","exports","tslib","lodash","immutable","typescript/dropbox/proto/hql_events/browse/web_browse_pb","typescript/component_libraries/spectrum-sharing/src/utils/sharing_constants","metaserver/static/js/file_actions/create-folder","js/filepath/filepath","metaserver/static/js/clean/filetypes","metaserver/static/js/flux/dispatcher","metaserver/static/js/clean/history","metaserver/static/js/tagging/experiments","metaserver/static/js/hql/index","metaserver/static/js/browse/action_logger","metaserver/static/js/browse/api","metaserver/static/js/extensions/data/store","metaserver/static/js/browse/constants","metaserver/static/js/browse/crypto_subtle_digest","metaserver/static/js/browse/data/folder_overview_selectors","metaserver/static/js/browse/data/helpers","metaserver/static/js/browse/data/selectors","metaserver/static/js/browse/data/types","metaserver/static/js/browse/logger_util","metaserver/static/js/browse/models","metaserver/static/js/browse/uri_helper","metaserver/static/js/files_view/data/action_creators","metaserver/static/js/files_view/data/selectors/instance_selectors","metaserver/static/js/files_view/file_actions/file_from_metadata","metaserver/static/js/files_view/types","metaserver/static/js/files_view/sort_types","metaserver/static/js/folder_overview/data/action_creators","metaserver/static/js/clean/ui/selection","metaserver/static/js/clean/ui/snackbar","metaserver/static/js/redux/tests/store","metaserver/static/js/tagging/experiments","metaserver/static/js/clean/web_user_action_events","metaserver/static/js/modules/constants/trademark","metaserver/static/js/modules/constants/web_experience_constants","metaserver/static/js/core/exception","metaserver/static/js/core/i18n","metaserver/static/js/core/uri","metaserver/static/js/browse/right_rail_preferences","metaserver/static/js/tagging/data/action_creators","metaserver/static/js/sync_everything/constants","metaserver/static/js/browse/api","metaserver/static/js/browse/shared_with/redux/store","metaserver/static/js/browse/shared_with/redux/slice"],(function(e,t,a,s,r,i,o,n,l,d,c,u,_,p,m,f,h,S,g,E,T,v,y,A,I,b,O,F,R,M,C,w,D,P,N,L,U,j,k,x,B,Y,V,W,q,H,G,K){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fetchLastBackupTime=t.setCreateMenuOpenRequest=t.setBackups=t.setOverflowMenuCloseRequest=t.setInlineOverflowMenuOpenRequest=t.setOverflowMenuCoordinates=t.setOverflowMenuOpenRequest=t.expandBlade=t.setFileHasAutomatedRuleMap=t.setRightRailIsCollapsed=t.setHideFilesAndSidebar=t.setViewType=t.setArePostTTIModulesLoaded=t.setIsFileViewerShown=t.appendFiles=t.applyBoltUpdates=t.completeFolderSizes=t.setFolderSizesPending=t.requestFolderSizes=t.setUnsortedFiles=t.setAndStoreSortOrder=t.setShouldShowDeletedFiles=t.clearSelection=t.setSelection=t.setPathData=t.setPath=t.setUrl=t.setPaginatedTotalNumFiles=t.setNewFolderCreationState=t.setMountPoints=t.setLoadingState=t.setFolderSizes=t.createFolder=t.refreshPinnedItems=t.toggleSpacesEntryPoint=t.hideFolderHistoryPanel=t.showFolderHistoryPanel=t.hideRewind=t.showRewind=t.setFolderMemberCounts=t.setIsRewindButtonEnabled=t.setFilePathsToSelectOnNextUpdate=t.resetFileJumpFilter=t.addFileJumpKeyCode=t.setBrowsePostTTIData=t.setBrowsePostTTIExperiments=t.setCurrentFolderInfo=t.setContext=t.pasteFilesFromClipboard=t.setFilesToClipboard=t.setCanDisplayFolderSizes=t.selectFilesByFqPath=t.popBoltIgnore=t.pushBoltIgnore=t.handleAppCleanup=t.appInit=void 0,s=a.__importStar(s),r=a.__importStar(r),i=a.__importStar(i),n=a.__importStar(n),l=a.__importStar(l),u=a.__importDefault(u),f=a.__importStar(f),E=a.__importStar(E),v=a.__importStar(v),A=a.__importStar(A),O=a.__importStar(O),F=a.__importStar(F),V=a.__importStar(V);const z=(0,G.getStoreForSharedWith)();t.appInit=({props:e,user:t,viewer:a})=>s=>{s({type:y.ActionTypes.APP_INIT,payload:{props:e,user:t,viewer:a}}),s(O.loadScopedSortOrders({user:t,defaultSort:{sortField:C.SortField.FILENAME,sortDirection:C.SortDirection.ASCENDING}}))};t.handleAppCleanup=()=>({type:y.ActionTypes.HANDLE_APP_CLEANUP});t.pushBoltIgnore=e=>({type:y.ActionTypes.PUSH_BOLT_IGNORE,payload:e});t.popBoltIgnore=e=>({type:y.ActionTypes.POP_BOLT_IGNORE,payload:e});t.selectFilesByFqPath=({fqPathsToSelect:e})=>({type:y.ActionTypes.SELECT_FILES_BY_FQ_PATH,payload:{fqPathsToSelect:e}});t.setCanDisplayFolderSizes=({canDisplayFolderSizes:e})=>({type:y.ActionTypes.SET_CAN_DISPLAY_FOLDER_SIZES,payload:{canDisplayFolderSizes:e}});const X=({clipboard:e})=>({type:y.ActionTypes.SET_CLIPBOARD_FILES,payload:{clipboard:e}});t.setFilesToClipboard=({clipboard:e})=>t=>{const{files:a}=e;a.length&&(a.some(e=>e.isDeleted||e.is_unmounted)?P.Snackbar.fail(B.intl.formatMessage({id:"jdnaZR",defaultMessage:"Deleted files cannot be added to the clipboard"}),"browse-clipboard-copy"):a.some(I.File.isTeamSharedFolder)||a.some(I.File.isTeamMemberFolder)?P.Snackbar.fail(B.intl.formatMessage({id:"0Nkg/N",defaultMessage:"Team Folders cannot be added to the clipboard"}),"browse-clipboard-copy"):a.some(I.File.isFamilySharedFolder)?P.Snackbar.fail(B.intl.formatMessage({id:"KMcV0/",defaultMessage:"Family shared folders cannot be added to the clipboard"}),"browse-clipboard-copy"):a.some(e=>e.type===d.FileTypes.VAULT_FOLDER)?P.Snackbar.fail(B.intl.formatMessage({id:"La991r",defaultMessage:"{TRADEMARK_VAULT} cannot be added to the clipboard"},{TRADEMARK_VAULT:j.TRADEMARK_VAULT}),"browse-clipboard-copy"):(P.Snackbar.complete(B.intl.formatMessage({id:"BvUPS9",defaultMessage:"{count, plural, one{Added {count} item to clipboard.} other{Added {count} items to clipboard.}}"},{count:a.length}),"browse-clipboard-copy"),t(X({clipboard:e}))))};t.pasteFilesFromClipboard=({copyFiles:e,moveFiles:t})=>(a,s)=>{const r=s(),i=v.user(r),{files:o,action:n}=v.clipboard(s()),d=v.path(s());o.length<=0||("cut"===n?(l.paths_are_equal(l.parent_dir(o[0].fq_path),d)||t({user:i,files:o,newPath:"/"===d?"":d,checkFSWs:!0}),a(X({clipboard:{files:[]}}))):e({user:i,files:o,newPath:d,checkFSWs:!0,isPasteAction:!0,onSuccess:e=>{}}))};t.setContext=({context:e})=>({type:y.ActionTypes.SET_CONTEXT,payload:{context:e}});t.setCurrentFolderInfo=({currentFolderInfo:e})=>({type:y.ActionTypes.SET_CURRENT_FOLDER_INFO,payload:{currentFolderInfo:e}});t.setBrowsePostTTIExperiments=({browsePostTTIExperiments:e})=>({type:y.ActionTypes.SET_BROWSE_POST_TTI_EXPERIMENTS,payload:{browsePostTTIExperiments:e}});t.setBrowsePostTTIData=({browsePostTTIData:e})=>{const t=Object.assign({},e);return Object.keys(t).forEach(e=>{void 0===t[e]&&delete t[e]}),{type:y.ActionTypes.SET_BROWSE_POST_TTI_DATA,payload:{browsePostTTIData:t}}};const Q=({fileJumpFilter:e})=>({type:y.ActionTypes.SET_FILE_JUMP_FILTER,payload:{fileJumpFilter:e}});t.addFileJumpKeyCode=({keyChar:e})=>(a,s)=>{const r=v.fileJumpFilter(s())+e.toLowerCase();a(Q({fileJumpFilter:r}));let i=null;const o=v.fileJumpIndex(s());for(const{fqPath:e,filename:t}of o)if(t>=r){i=e;break}null!=i&&a((0,t.selectFilesByFqPath)({fqPathsToSelect:[i]}))};t.resetFileJumpFilter=()=>(e,t)=>{(0,m.logKeyboardShortcutUsage)({user_id:v.user(t()).id,keyboard_shortcut_type:"jump",view_type:F.selectViewType(t(),{instanceId:S.BROWSE_FILES_VIEW_ID})}),e(Q({fileJumpFilter:""}))};t.setFilePathsToSelectOnNextUpdate=({filePathsToSelectOnNextUpdate:e})=>({type:y.ActionTypes.SET_FILE_PATHS_TO_SELECT_ON_NEXT_UPDATE,payload:{filePathsToSelectOnNextUpdate:e}});t.setIsRewindButtonEnabled=e=>(t,s)=>a.__awaiter(void 0,void 0,void 0,(function*(){const{path:a,userId:s,userSkuHasRewind:r}=e;if(!r)return void t({type:y.ActionTypes.SET_IS_REWIND_ENABLED,payload:{value:!0}});const i=yield f.isRewindButtonEnabled(a,s);t({type:y.ActionTypes.SET_IS_REWIND_ENABLED,payload:{value:!!i.can_rewind}})}));t.setFolderMemberCounts=e=>(t,s)=>a.__awaiter(void 0,void 0,void 0,(function*(){const{contentId:a,userId:r}=e;let i;i=v.isInsideBackupFolder(s())?1:yield f.getFolderMemberCounts(a,r),t({type:y.ActionTypes.SET_FOLDER_MEMBER_COUNTS,payload:{value:i}})}));t.showRewind=()=>({type:y.ActionTypes.SHOW_TIMELINE,payload:{timestamp:(new Date).getTime()}});t.hideRewind=()=>({type:y.ActionTypes.HIDE_TIMELINE,payload:{}});t.showFolderHistoryPanel=()=>({type:y.ActionTypes.SHOW_FOLDER_HISTORY_PANEL,payload:{timestamp:(new Date).getTime()}});t.hideFolderHistoryPanel=()=>({type:y.ActionTypes.HIDE_FOLDER_HISTORY_PANEL,payload:{}});t.toggleSpacesEntryPoint=({value:e})=>({type:y.ActionTypes.TOGGLE_SPACES_ENTRY_POINT,payload:{value:e}});t.refreshPinnedItems=()=>(e,t)=>a.__awaiter(void 0,void 0,void 0,(function*(){const a=E.folderOverviewFolderFileId(t());e((0,w.reloadContentReferences)({folderFileId:a,componentNamespace:S.BrowseFolderOverviewComponentNamespace}))}));t.createFolder=({pathName:e,folderName:s,user:r,checkFSWs:i,showShareModalOnSuccess:l,redirectOnSuccess:d,redirectOnCancel:c,selectCreatedFolder:u=!0,origin:_})=>(p,m)=>a.__awaiter(void 0,void 0,void 0,(function*(){p((0,t.setNewFolderCreationState)({newFolderCreationState:M.NewFolderCreationState.SAVING_INPUT}));const a=yield n.createFolder({destination:e,name:s,user:r,checkFsw:i,origin:_,surface:"browse"});if(p((0,t.setNewFolderCreationState)({newFolderCreationState:M.NewFolderCreationState.CREATE_FOLDER_INACTIVE})),"success"===a.type){const e=(0,R.folderFromFolderMetadata)(a.folder);u&&p((0,t.selectFilesByFqPath)({fqPathsToSelect:[e.fq_path]})),d&&d(e.fq_path),l&&l(e,o.SHARE_ACTION_ORIGIN_TYPE.BROWSE_NEW_FOLDER_MODAL)}else c&&c()}));t.setFolderSizes=({folderSizes:e})=>({type:y.ActionTypes.SET_FOLDER_SIZES,payload:{folderSizes:e}});t.setLoadingState=({loadingState:e,path:t})=>({type:y.ActionTypes.SET_LOADING_STATE,payload:{loadingState:e,path:t}});t.setMountPoints=({mountPoints:e})=>({type:y.ActionTypes.SET_MOUNT_POINTS,payload:{mountPoints:e}});t.setNewFolderCreationState=({newFolderCreationState:e})=>({type:y.ActionTypes.SET_NEW_FOLDER_CREATION_STATE,payload:{newFolderCreationState:e}});t.setPaginatedTotalNumFiles=({paginatedTotalNumFiles:e})=>({type:y.ActionTypes.SET_PAGINATED_TOTAL_NUM_FILES,payload:{paginatedTotalNumFiles:e}});t.setUrl=({path:e="",qargs:a,expandedBlade:r="info",forceExpandRightRail:i=!1})=>(o,n)=>{u.default.push_state(v.urlPrefix(n())+Y.URI.encode_parts(e),s.omitBy(Object.assign(Object.assign({},s.pick((0,b.getQueryArgs)(),["d"])),a),s.isUndefined)),o((0,t.clearSelection)({skipLogging:!0})),o((0,t.expandBlade)(r)),i&&o((0,t.setRightRailIsCollapsed)(!1))};t.setPath=({path:e})=>(t,s)=>a.__awaiter(void 0,void 0,void 0,(function*(){var a;t({type:y.ActionTypes.SET_PATH,payload:{path:e}});const r=v.backups(s()),i=yield(0,g.hashString)(e);if(i||(0,x.reportException)({err:new Error("hashString returned null"),tags:["browse"],severity:x.SEVERITY.NONCRITICAL}),t({type:y.ActionTypes.SET_VIEW_SCOPE,payload:{viewScope:i}}),e){const t=null===(a=null==r?void 0:r.find(t=>t.fqPath===e))||void 0===a?void 0:a.displayName;document.title=(0,q.isBackupBrowse)()?B.intl.formatMessage({id:"IePl0Y",defaultMessage:"{folder_name} - Dropbox Backup"},{folder_name:l.filename_without_extension(l.filename(r?null!=t?t:e:"",B.intl.formatMessage({id:"UwzCW9",defaultMessage:"Backups"})))}):B.intl.formatMessage({id:"dbYCaa",defaultMessage:"{folder_name} - Dropbox"},{folder_name:l.filename(e,B.intl.formatMessage({id:"bObFEu",defaultMessage:"Files"}))})}}));t.setPathData=({path:s,files:i,paginatedTotalNumFiles:o,context:n,currentFolderInfo:d})=>(u,_)=>{if(!l.paths_are_equal(s,v.path(_())))return;const p=r.Map(i.map(e=>[e.fq_path,e]));u((0,t.setContext)({context:n})),u((0,t.setCurrentFolderInfo)({currentFolderInfo:d})),(0,t.setUnsortedFiles)({unsortedFiles:p})(u,_,N.mockExtraArguments),u((0,t.setPaginatedTotalNumFiles)({paginatedTotalNumFiles:o})),u((0,t.clearSelection)({skipLogging:!0})),Z({unsortedFiles:p})(u,_,N.mockExtraArguments),(0,L.isFetchTagsOnBrowseEnabled)(v.manualTaggingVariant(_()))&&u((0,W.fetchTagsForFiles)({user:v.user(_()),files:d?[...i,d]:[...i],override:!0})),setTimeout(()=>{k.SHARED_WITH_REDUX?z.dispatch((0,K.pathLoaded)({path:s,files:i})):c.Dispatcher.dispatch({type:S.SharedWithActionType.BROWSE_FILES_LOADED,data:{parentPath:s,files:i}});const t={path:s,hasPermissionToUploadToFolder:n.isCurrentPathWriteable(),isMovingIntoVault:n.isInsideVaultFolder};new Promise((t,a)=>{e(["metaserver/static/js/file_uploader/clean/data/slice"],t,a)}).then(a.__importStar).then(({uploadActionCreators:e})=>{u(e.setPath(t))})},1)};t.setSelection=({selection:e,actionSource:t,skipLogging:a})=>(s,r)=>{if(!a){const a=r(),{event:s,itemId:o}=A.makeSelectionEvent(v.selection(a),e),n=v.selectFileByFullPath(a,{path:o}),{browseWebHqlPilot:l}=v.experiments(a);if(n){const{num_files_selected:o,num_folders_selected:d}=A.countFilesAndFolders(v.selectFilesForSelection(a,{selection:e}));l&&s===U.WebUserActionLogEvent.SELECT_ROW&&(0,p.logEvent)(new i.WebBrowseSelectRow({actionSource:t})),(0,m.logBrowseAction)({uid:v.user(a).id,action:s,action_source:t,num_files_selected:o,num_folders_selected:d,view_type:F.selectViewType(r(),{instanceId:S.BROWSE_FILES_VIEW_ID}),result:n,extra:{entity_type:n.is_dir?"folder":"file"}})}}s({type:y.ActionTypes.SET_SELECTION,payload:{selection:e,actionSource:t}}),J(s,r,e)};t.clearSelection=({actionSource:e,skipLogging:a}={})=>(0,t.setSelection)({actionSource:e,skipLogging:a,selection:(0,D.createSelection)()});t.setShouldShowDeletedFiles=({shouldShowDeletedFiles:e})=>({type:y.ActionTypes.SET_SHOULD_SHOW_DELETED_FILES,payload:{shouldShowDeletedFiles:e}});t.setAndStoreSortOrder=e=>(t,a)=>{const s=a(),r=v.user(s);(0,m.logSortRecords)({uid:r.id,sort_by:e.sortField,sort_direction:e.sortDirection,view_type:F.selectViewType(s,{instanceId:S.BROWSE_FILES_VIEW_ID})}),t(O.setSort({user:r,sort:e,viewScope:F.selectViewTypeScope(s,{instanceId:S.BROWSE_FILES_VIEW_ID}),updateGlobalScope:!0})),t((({sortOrder:e})=>({type:y.ActionTypes.SET_SORT_ORDER,payload:{sortOrder:e}}))({sortOrder:e}))};t.setUnsortedFiles=({unsortedFiles:e})=>(t,s)=>a.__awaiter(void 0,void 0,void 0,(function*(){const a=v.user(s());t({type:y.ActionTypes.SET_UNSORTED_FILES,payload:{unsortedFiles:e}}),(0,h.initializeStore)(a,e.toArray())}));t.requestFolderSizes=({fqPath:e})=>({type:y.ActionTypes.REQUEST_FOLDER_SIZES,payload:{fqPath:e}});t.setFolderSizesPending=({fetchFolderSizesResp:e})=>({type:y.ActionTypes.SET_FOLDER_SIZES_PENDING,payload:{fetchFolderSizesResp:e}});t.completeFolderSizes=({fetchFolderSizeState:e})=>({type:y.ActionTypes.COMPLETE_FOLDER_SIZES,payload:{fetchFolderSizeState:e}});t.applyBoltUpdates=({path:e,updates:a})=>(s,r)=>{const{parent_changes:i}=a,o=v.user(r());if(l.paths_are_equal(e,v.path(r()))){if(i&&i.change_to_fq_path)return(0,T.showUserNotificationForPathChange)(o,i),void(0,t.setUrl)({path:i.change_to_fq_path})(s,r,N.mockExtraArguments);(function(e,a,s){const{mount_points:r}=s,i=v.path(a()),[o,n]=(0,T.getMountPointUpdateForCurrentPath)(r,i,v.mountPoints(a()));!o||n||(0,q.isBackupBrowse)()||P.Snackbar.complete(B.intl.formatMessage({id:"QB9ZqK",defaultMessage:"The folder was unshared."}),"browse-unshare");const l=(0,T.getPathForNewMountPoint)(o,n,i);if(l)return void e((0,t.setPath)({path:l}));e((0,t.setMountPoints)({mountPoints:r}))})(s,r,a),(function(e,a,s){const{added:r,moved:i,removed:o}=s,n=v.path(a());let d=v.unsortedFiles(a()),u=v.folderSizes(a()),_=d.size;const p={added:new Set([]),moved:new Set([]),removed:new Set([])};e((0,t.popBoltIgnore)(p)),d=d.withMutations(e=>{u=u.withMutations(t=>{const a=t=>{(e=>l.paths_are_equal(l.parent_dir(e.fq_path),n))(t)&&(e.set(t.fq_path,I.File.fromServerObject(t)),_+=1)},s=(s,r)=>{const i=e.get(s);if(i&&i.sjid>=r.sjid&&s===r.fq_path)return;e.remove(s),_-=1,a(r);const o=t.get(s);o&&(t.remove(s),t.set(r.fq_path,o))},d=a=>{e.remove(a),t.remove(a),_-=1};for(const t of r)e.has(t.fq_path)?s(t.fq_path,t):a(t);for(const[t,r]of i)e.has(t)?s(t,r):e.has(r.fq_path)?s(r.fq_path,r):a(r);for(const t of o){const a=e.find(e=>e.fq_path.toLowerCase()===t.toLowerCase());a&&d(a.fq_path)}})}),d.size!==_&&(0,x.reportException)({err:new Error("applyBoltUpdates ended up with unexpected number of items"),tags:["browse_file_collections_mismatch"],severity:x.SEVERITY.NONCRITICAL,exc_extra:{expected_unsorted_files_size:_,actual_unsorted_files_size:d.size,is_deleted_files_on:v.shouldShowDeletedFiles(a()),filesAdded:r,filesRemoved:o,filesMove:i}});if(d!==v.unsortedFiles(a())){(0,t.setUnsortedFiles)({unsortedFiles:d})(e,a,N.mockExtraArguments);const s=d.toArray();k.SHARED_WITH_REDUX?z.dispatch((0,K.filesChanged)(n)):c.Dispatcher.dispatch({type:S.SharedWithActionType.BROWSE_FILES_UPDATED,data:{parentPath:n,files:s}})}u!==v.folderSizes(a())&&e((0,t.setFolderSizes)({folderSizes:u}));Z({unsortedFiles:d})(e,a,N.mockExtraArguments)})(s,r,a),(0,_.isTaggingEnabled)(v.manualTaggingVariant(r()))&&(function(e,t,a,s){if(0===a.moved.length)return;const r=[];for(const e of a.moved){const{fq_path:a}=e[1],s=v.selectFileByFullPath(t(),{path:a});void 0!==s&&r.push(s)}e((0,W.fetchTagsForFiles)({user:s,files:r}))})(s,r,a,o)}};const Z=({unsortedFiles:e})=>(a,s)=>{const i=v.filePathsToSelectOnNextUpdate(s()).toArray().map(e=>e.toLowerCase()),o=e.toArray().filter(e=>i.includes(e.fq_path.toLowerCase())).map(e=>e.fq_path.toLowerCase()),n=i.filter(e=>!o.includes(e.toLowerCase()));0!==o.length&&(a((0,t.selectFilesByFqPath)({fqPathsToSelect:o})),a((0,t.setFilePathsToSelectOnNextUpdate)({filePathsToSelectOnNextUpdate:r.Set(n)})))};t.appendFiles=({path:e,files:a,currentFolderInfo:s})=>(i,o)=>{if(!l.paths_are_equal(e,v.path(o())))return;const n=v.unsortedFiles(o()),d=n.size;let u=d;a.forEach(e=>{n.has(e.fq_path)||u++});const _=n.merge(r.Map(a.map(e=>[e.fq_path,e])));(0,t.setUnsortedFiles)({unsortedFiles:_})(i,o,N.mockExtraArguments),Z({unsortedFiles:_})(i,o,N.mockExtraArguments),(0,L.isFetchTagsOnBrowseEnabled)(v.manualTaggingVariant(o()))&&(s=null!=s?s:v.getCurrentFolderInfo(o()),i((0,W.fetchTagsForFiles)({user:v.user(o()),files:s?[...a,s]:[...a],override:0===d}))),k.BROWSE_SHARED_WITH_PERF?k.SHARED_WITH_REDUX?z.dispatch((0,K.loadSharedFileDataForPath)()):c.Dispatcher.dispatch({type:S.SharedWithActionType.LOAD_SHARED_FILE_DATA_FOR_PATH,data:{parentPath:e,files:a}}):k.SHARED_WITH_REDUX?z.dispatch((0,K.pathLoaded)({path:e,files:a})):c.Dispatcher.dispatch({type:S.SharedWithActionType.BROWSE_FILES_LOADED,data:{parentPath:e,files:a}}),_.size!==u&&(0,x.reportException)({err:new Error("appendFiles ended up with unexpected number of files."),tags:["browse_file_collections_mismatch"],severity:x.SEVERITY.NONCRITICAL,exc_extra:{previous_unsorted_files_size:d,incoming_files_size:a.length,expected_files_size:u,updated_unsorted_files_size:_.size,is_deleted_files_on:v.shouldShowDeletedFiles(o())}})};t.setIsFileViewerShown=({isShown:e})=>({type:y.ActionTypes.SET_IS_FILE_VIEWER_SHOWN,payload:{isShown:e}});t.setArePostTTIModulesLoaded=({arePostTTIModulesLoaded:e})=>({type:y.ActionTypes.SET_ARE_POST_TTI_MODULES_LOADED,payload:{arePostTTIModulesLoaded:e}});const J=(e,t,a)=>{if(!a||0===a.selected.count())return;const s=v.unsortedFiles(t()),r=null==s?void 0:s.filter(e=>a.selected.has(e.fq_path)&&!e.thumbnail_url_tmpl),i=[];if(null==r||r.forEach(e=>{i.push({file_id:e.file_id,sj_id:e.sjid,ns_id:e.ns_id})}),i.length>0){const a=v.user(t()).id;e(O.loadPreviewThumbnails(i,a,S.BROWSE_FILES_VIEW_ID))}};t.setViewType=e=>(t,a)=>{const s=a();t(O.setViewType({user:v.user(s),viewType:e,viewTypeScope:v.selectViewTypeScope(s),updateGlobalScope:!0}))};t.setHideFilesAndSidebar=({shouldHideFilesAndSidebar:e})=>({type:y.ActionTypes.SET_HIDE_FILES_AND_SIDEBAR,payload:{shouldHideFilesAndSidebar:e}});t.setRightRailIsCollapsed=e=>(t,a)=>{const s=v.user(a());t({type:y.ActionTypes.SET_RIGHTRAIL_IS_COLLAPSED,payload:{collapsed:e}}),V.setIsCollapsed(s.id,e)};t.setFileHasAutomatedRuleMap=({fileHasAutomatedRuleMap:e})=>({type:y.ActionTypes.SET_FILE_HAS_AUTOMATED_RULE_MAP,payload:{fileHasAutomatedRuleMap:e}});t.expandBlade=e=>({type:y.ActionTypes.SET_EXPANDED_BLADE,payload:{expandedBlade:e}});t.setOverflowMenuOpenRequest=e=>({type:y.ActionTypes.SET_OVERFLOW_MENU_OPEN_REQUEST,payload:{overflowMenuOpenRequest:e}});t.setOverflowMenuCoordinates=e=>({type:y.ActionTypes.SET_OVERFLOW_MENU_COORDINATES,payload:{overflowMenuCoordinates:e}});t.setInlineOverflowMenuOpenRequest=e=>({type:y.ActionTypes.SET_INLINE_OVERFLOW_MENU_OPEN_REQUEST,payload:{inlineOverflowMenuOpenRequest:e}});t.setOverflowMenuCloseRequest=e=>({type:y.ActionTypes.SET_OVERFLOW_MENU_CLOSE_REQUEST,payload:{overflowMenuCloseRequest:e}});t.setBackups=t=>(s,r)=>a.__awaiter(void 0,void 0,void 0,(function*(){if(null!==v.backups(r()))return;const{expEnableThirdPartyBackup:i}=v.browsePostTTIExperiments(r()),{fetchBackups:o}=yield new Promise((t,a)=>{e(["metaserver/static/js/sync_everything/api"],t,a)}).then(a.__importStar),n=yield o(t,{includeThirdPartyBackups:i});s({type:y.ActionTypes.SET_BACKUPS,payload:{backups:n}})}));t.setCreateMenuOpenRequest=e=>({type:y.ActionTypes.SET_CREATE_MENU_OPEN_REQUEST,payload:{createMenuOpenRequest:e}});t.fetchLastBackupTime=(e,t)=>(s,r)=>a.__awaiter(void 0,void 0,void 0,(function*(){var a,i;const o=v.lastBackupTimesSelector(r());if(e&&!o.has(e)){const o=v.user(r()),n=yield(0,H.fetchChronicleEventsApi)(o.id,e,0,{".tag":"past"},!1,[],t);(null===(i=null===(a=n.events)||void 0===a?void 0:a[0])||void 0===i?void 0:i.timestamp_us)&&s({type:y.ActionTypes.SET_LAST_BACKUP_TIMES,payload:{fqPath:e,lastBackupTime:n.events[0].timestamp_us}})}}))})),define("metaserver/static/js/browse/data/folder_overview_selectors",["require","exports","tslib","metaserver/static/js/browse/constants","metaserver/static/js/folder_overview/data/selectors","metaserver/static/js/browse/data/selectors","reselect","metaserver/static/js/files_view/types","js/filepath/filepath"],(function(e,t,a,s,r,i,o,n,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.shouldShowFamilyEmptyState=t.shouldShowVaultEmptyState=t.paginatedTotalNumFiles=t.folderOverviewPinnedItems=t.folderOverviewLoggingFileId=t.folderOverviewFolderFileId=t.hasFailedToLoad=t.haveAllComponentsLoaded=void 0,r=a.__importStar(r),l=a.__importStar(l);const d=r.makeHaveAllComponentsLoadedSelector(),c=r.makeHasFailedToLoadSelector(),u=r.makeFolderFileIdSelector(),_=r.makeLoggingFileIdSelector(),p=r.makePinnedItemsSelector();t.haveAllComponentsLoaded=e=>d(e,{componentNamespace:s.BrowseFolderOverviewComponentNamespace});t.hasFailedToLoad=e=>c(e,{componentNamespace:s.BrowseFolderOverviewComponentNamespace});t.folderOverviewFolderFileId=e=>u(e,{path:(0,i.path)(e)});t.folderOverviewLoggingFileId=e=>_(e,{path:(0,i.path)(e)});t.folderOverviewPinnedItems=e=>p(e,{path:(0,i.path)(e)});t.paginatedTotalNumFiles=e=>(0,i.browseLoadingState)(e)===n.LoadingState.LOADED?(0,i.sortedFiles)(e).count():(0,i.getBrowseState)(e).paginatedTotalNumFiles,t.shouldShowVaultEmptyState=(0,o.createSelector)(i.context,t.paginatedTotalNumFiles,(e,t)=>e.isInsideVaultFolder&&null!=e.currentNSPath&&l.paths_are_equal(e.currentNSPath,"")&&0===t),t.shouldShowFamilyEmptyState=(0,o.createSelector)(i.context,t.paginatedTotalNumFiles,i.experiments,(e,t,a)=>e.isInFamilySharedFolder&&null!=e.currentNSPath&&l.paths_are_equal(e.currentNSPath,"")&&0===t)})),define("metaserver/static/js/growth/ui/rich_snackbar_actions/types",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FeatureGrowthOrigin=t.SnackbarOrigin=void 0,(function(e){e.from_upload_snackbar="from_upload_snackbar",e.from_rename_snackbar="from_rename_snackbar",e.from_reengagement_upload_snackbar="from_reengagement_upload_snackbar",e.from_discovery_upload_snackbar="from_discovery_upload_snackbar",e.from_reengagement_rename_snackbar="from_reengagement_rename_snackbar",e.from_discovery_rename_snackbar="from_discovery_rename_snackbar"})(t.SnackbarOrigin||(t.SnackbarOrigin={})),(function(e){e.reengagement="reengagement",e.discovery="discovery"})(t.FeatureGrowthOrigin||(t.FeatureGrowthOrigin={}))})),define("metaserver/static/js/tidy_up/actions",["require","exports","tslib","react","metaserver/static/js/clean/ui/snackbar","metaserver/static/js/core/i18n","metaserver/static/js/tidy_up/modal/tidy_strings","metaserver/static/js/browse/data/store","metaserver/static/js/browse/data/action_creators/index","metaserver/static/js/tidy_up/api_v2","metaserver/static/js/tidy_up/utils","metaserver/static/js/tidy_up/modal/types","metaserver/static/js/browse/data/selectors","metaserver/static/js/clean/web_user_action_logger","metaserver/static/js/clean/web_user_action_events","metaserver/static/js/flows/lib/api","metaserver/static/js/flows/types","metaserver/static/js/pap/analytics_client","metaserver/static/js/dropbox/proto/pap_events/tidyup/attempt_tidyup","metaserver/static/js/dropbox/proto/pap_events/tidyup/undo_tidyup","metaserver/static/js/dropbox/proto/pap_events/tidyup/select_tidyup_automation","metaserver/static/js/dropbox/proto/pap_events/tidyup/remove_tidyup_automation","metaserver/static/js/dropbox/proto/pap_events/event_enums"],(function(e,t,a,s,r,i,o,n,l,d,c,u,_,p,m,f,h,S,g,E,T,v,y){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createFolder=t.retry=t.undo=t.asyncApplyTidyup=t.snackbarId=t.millisecondSnackbarTimeout10000=t.millisecondSnackbarTimeout8000=t.millisecondPendingMessageDelay=void 0,s=a.__importDefault(s),l=a.__importStar(l),d=a.__importStar(d),_=a.__importStar(_),f=a.__importStar(f),t.millisecondPendingMessageDelay=5e3,t.millisecondSnackbarTimeout8000=8e3,t.millisecondSnackbarTimeout10000=1e4,t.snackbarId="tidyup-apply-action";const A=(0,n.getStoreForBrowse)();t.asyncApplyTidyup=e=>a.__awaiter(void 0,void 0,void 0,(function*(){var a,n,l,u,_,p,m,f;const{currentUserId:h,targetPath:S,namespaceId:g,tidyParameters:E,actionSurface:T,openModalCallback:v,shouldApplyAutomation:y,shouldRemoveAutomation:A,previousAutomationRuleSet:F,sourceToDestinationPaths:D,onSuccess:P,onError:N,initialPendingTextOverride:L}=e;let U=!1;const j=A||y,k=null!=L?L:i.intl.formatMessage(o.TIDY_PENDING.PENDING_TEXT_1),x=i.intl.formatMessage(o.TIDY_PENDING.STILL_WORKING_TEXT_1);r.Snackbar.show(s.default.createElement(r.Snackbar,{id:t.snackbarId,title:k,variant:"sync"})),setTimeout(()=>{U||r.Snackbar.update(s.default.createElement(r.Snackbar,{id:t.snackbarId,title:x,variant:"sync"}))},t.millisecondPendingMessageDelay);const B=c.TidyConversions.tidyTypeToFlowsAPI(E);let Y=Promise.resolve(void 0),V=Promise.resolve(void 0);y?Y=I(h,S,T,B,"tidy_up"):A&&(V=b(h,S,T));const W=c.TidyConversions.tidyTypeToApiV2(E);let q;q=D?d.applyPreview(h,S,W,D):d.tidy(h,S,g,W);const[H,G,K]=yield Promise.all([q,Y,V]);if(U=!0,H.isError||H.result.entries.length>0&&H.result.entries.every(e=>"failure"===e[".tag"])){N&&N(H.error[".tag"]);const e=H.isError?-1:H.result.entries.length;return void R(S,E,T,y,A,v,h,e,g,!!G||!!K)}if(!1===G||!1===K)return void M(h,G,K,S,T,B);const z=H.result.entries,X=z.some(e=>"failure"===e[".tag"]),Q=(null!==(a=H.result.moved_files_changesets)&&void 0!==a?a:[]).length>0||(null!==(n=H.result.created_directories_changesets)&&void 0!==n?n:[]).length>0||(null!==(u=null===(l=H.result.renamed_directories)||void 0===l?void 0:l.changesets)&&void 0!==u?u:[]).length>0?(0,t.undo)(S,T,h,g,z,null!==(_=H.result.moved_files_changesets)&&void 0!==_?_:[],null!==(p=H.result.created_directories_changesets)&&void 0!==p?p:[],null!==(f=null===(m=H.result.renamed_directories)||void 0===m?void 0:m.changesets)&&void 0!==f?f:[],j?F:void 0):void 0;X?C(z.filter(e=>"failure"!==e[".tag"]).length,z.filter(e=>"failure"===e[".tag"]).length,S,E,T,y,A,v,h,g,Q):0===z.length?w():(P&&P(),O(z.length,S,E,T,y,A,h,g,Q))}));const I=(e,t,s,r,i)=>f.setupFolderRules(t,r).then(()=>a.__awaiter(void 0,void 0,void 0,(function*(){return U(e,t,s,i),!0})),()=>a.__awaiter(void 0,void 0,void 0,(function*(){return!1}))),b=(e,t,s)=>f.deleteFolderRules(t).then(()=>a.__awaiter(void 0,void 0,void 0,(function*(){return U(e,t,s,void 0),!0})),()=>a.__awaiter(void 0,void 0,void 0,(function*(){return!1}))),O=(e,a,n,l,d,_,f,h,E)=>{p.WebUserActionLog.log(f,m.WebUserActionLogEvent.TIDY_UP_RESULT_SUCCESS,{ns_id:h,apply_file_count:e,success_file_count:e});const{tidyUpRule:T,tidyUpSubrule:v}=c.TidyConversions.tidyTypeToPapType(n,g.pap_events.tidyup.Attempt_Tidyup.TidyupRule);(0,S.logEvent)(g.pap_events.tidyup.Attempt_Tidyup.create({actionSurface:l,eventState:y.pap_events.EventState.SUCCESS,tidyupRule:T,tidyupSubrule:v,tidyupAutomationAction:c.TidyConversions.tidyAutomationToPapType(d,_,g.pap_events.tidyup.Attempt_Tidyup.TidyupAutomationAction),tidyupExcludeCurrentSubrule:n.type===u.TidyUpType.by_month&&n.byMonthParams.excludeCurrentMonth||n.type===u.TidyUpType.by_year&&n.byYearParams.excludeCurrentYear,tidyupTimeInactiveSubrule:c.TidyConversions.tidyInactiveRangeToPapType(n.activityParams.inactiveSelection,g.pap_events.tidyup.Attempt_Tidyup.TidyupTimeInactiveSubrule),tidyupDateFormatSubrule:c.TidyConversions.tidyDateFormatToPapType(n.byMonthParams.dateFormatSelection,g.pap_events.tidyup.Attempt_Tidyup.TidyupDateFormatSubrule),tidyupSource:c.TidyConversions.tidySourceToPapType(l,g.pap_events.tidyup.Attempt_Tidyup.TidyupSource)}));const A=i.intl.formatMessage(o.TIDY_SUCCESS.SUCCESS_TEXT,{numFilesTidied:e});r.Snackbar.show(s.default.createElement(r.Snackbar,{actionButtonText:E?i.intl.formatMessage({id:"LfSqya",defaultMessage:"Undo"}):void 0,onActionClick:E,timeoutDelayMs:t.millisecondSnackbarTimeout10000,title:A,variant:"complete",id:t.snackbarId}))},F=(e,a)=>{r.Snackbar.show(s.default.createElement(r.Snackbar,{actionButtonText:i.intl.formatMessage({id:"3KMB1D",defaultMessage:"Retry"}),onActionClick:a,closeButtonText:i.intl.formatMessage(o.TIDY_UP_SNACKBAR_DISMISS_LABEL),timeoutDelayMs:t.millisecondSnackbarTimeout8000,title:e,variant:"fail",id:t.snackbarId}))},R=(e,a,s,r,n,l,d,_,f,h)=>{p.WebUserActionLog.log(d,m.WebUserActionLogEvent.TIDY_UP_RESULT_FAIL,{ns_id:f,apply_file_count:_,success_file_count:0});const{tidyUpRule:E,tidyUpSubrule:T}=c.TidyConversions.tidyTypeToPapType(a,g.pap_events.tidyup.Attempt_Tidyup.TidyupRule);(0,S.logEvent)(g.pap_events.tidyup.Attempt_Tidyup.create({actionSurface:s,eventState:y.pap_events.EventState.FAILED,tidyupRule:E,tidyupSubrule:T,tidyupAutomationAction:c.TidyConversions.tidyAutomationToPapType(r,n,g.pap_events.tidyup.Attempt_Tidyup.TidyupAutomationAction),tidyupExcludeCurrentSubrule:a.type===u.TidyUpType.by_month&&a.byMonthParams.excludeCurrentMonth||a.type===u.TidyUpType.by_year&&a.byYearParams.excludeCurrentYear,tidyupTimeInactiveSubrule:c.TidyConversions.tidyInactiveRangeToPapType(a.activityParams.inactiveSelection,g.pap_events.tidyup.Attempt_Tidyup.TidyupTimeInactiveSubrule),tidyupDateFormatSubrule:c.TidyConversions.tidyDateFormatToPapType(a.byMonthParams.dateFormatSelection,g.pap_events.tidyup.Attempt_Tidyup.TidyupDateFormatSubrule),tidyupSource:c.TidyConversions.tidySourceToPapType(s,g.pap_events.tidyup.Attempt_Tidyup.TidyupSource)}));const v=i.intl.formatMessage(h?o.TIDY_ERROR.MIXED_SUCCESS_AUTOMATION_SUCCESS:o.TIDY_ERROR.ERROR_TEXT);F(v,(0,t.retry)(e,l))},M=(e,t,a,s,r,n)=>{const l=i.intl.formatMessage(o.TIDY_ERROR.MIXED_SUCCESS_AUTOMATION_FAILURE);F(l,!1===t?()=>{L(e,s,r,n)}:()=>{N(e,s,r,n)})},C=(e,a,n,l,d,_,f,h,E,T,v)=>{p.WebUserActionLog.log(E,m.WebUserActionLogEvent.TIDY_UP_RESULT_PARTIAL_FAIL,{ns_id:T,apply_file_count:e+a,success_file_count:e});const{tidyUpRule:A,tidyUpSubrule:I}=c.TidyConversions.tidyTypeToPapType(l,g.pap_events.tidyup.Attempt_Tidyup.TidyupRule);(0,S.logEvent)(g.pap_events.tidyup.Attempt_Tidyup.create({actionSurface:d,eventState:y.pap_events.EventState.FAILED,tidyupRule:A,tidyupSubrule:I,tidyupAutomationAction:c.TidyConversions.tidyAutomationToPapType(_,f,g.pap_events.tidyup.Attempt_Tidyup.TidyupAutomationAction),tidyupExcludeCurrentSubrule:l.type===u.TidyUpType.by_month&&l.byMonthParams.excludeCurrentMonth||l.type===u.TidyUpType.by_year&&l.byYearParams.excludeCurrentYear,tidyupTimeInactiveSubrule:c.TidyConversions.tidyInactiveRangeToPapType(l.activityParams.inactiveSelection,g.pap_events.tidyup.Attempt_Tidyup.TidyupTimeInactiveSubrule),tidyupDateFormatSubrule:c.TidyConversions.tidyDateFormatToPapType(l.byMonthParams.dateFormatSelection,g.pap_events.tidyup.Attempt_Tidyup.TidyupDateFormatSubrule),tidyupSource:c.TidyConversions.tidySourceToPapType(d,g.pap_events.tidyup.Attempt_Tidyup.TidyupSource)}));const b=i.intl.formatMessage(o.TIDY_ERROR.PARTIAL_SUCCESS_TEXT_1,{numSucceeded:e}),O=i.intl.formatMessage(o.TIDY_ERROR.PARTIAL_SUCCESS_TEXT_2,{numFailed:a}),F=(0,t.retry)(n,h);r.Snackbar.show(s.default.createElement(r.Snackbar,{actionButtonText:v?i.intl.formatMessage({id:"su+IP9",defaultMessage:"Undo"}):void 0,onActionClick:v,closeButtonText:i.intl.formatMessage({id:"3KMB1D",defaultMessage:"Retry"}),onCloseClick:F,timeoutDelayMs:t.millisecondSnackbarTimeout10000,title:b+" "+O,variant:"warn",id:t.snackbarId}))},w=()=>{const e=i.intl.formatMessage(o.TIDY_ERROR.SNACKBAR_TEXT);r.Snackbar.show(s.default.createElement(r.Snackbar,{closeButtonText:i.intl.formatMessage(o.TIDY_UP_SNACKBAR_DISMISS_LABEL),timeoutDelayMs:t.millisecondSnackbarTimeout8000,title:e,variant:"fail",id:t.snackbarId}))};t.undo=(e,n,u,f,h,g,T,v,O)=>()=>a.__awaiter(void 0,void 0,void 0,(function*(){const a=h.filter(e=>"success"===e[".tag"]).length;p.WebUserActionLog.log(u,m.WebUserActionLogEvent.TIDY_UP_UNDO,{type:"precision",num_files_to_undo:a,ns_id:f}),(0,S.logEvent)(E.pap_events.tidyup.Undo_Tidyup.create({actionSurface:n,eventState:y.pap_events.EventState.START,numFilesToUndo:a,tidyupUndoType:E.pap_events.tidyup.Undo_Tidyup.TidyupUndoType.PRECISION_TIDYUP_UNDO_TYPE})),r.Snackbar.show(s.default.createElement(r.Snackbar,{id:t.snackbarId,title:i.intl.formatMessage(o.TIDY_UNDO.UNDO_PENDING),variant:"sync"}));const F=A.getState();(_.isCurrentPathRoot(F)?"":_.path(F))!==e&&A.dispatch(l.setUrl({path:e}));let R=Promise.resolve(void 0);if(void 0!==O){const t=c.AutomationConversions.automationRuleSetToRuleType(O);R=null!=t?I(u,e,n,O,t):b(u,e,n)}const[M,C]=yield Promise.all([d.undo(e,u,g,T,v),R]);M&&!1!==C||(p.WebUserActionLog.log(u,m.WebUserActionLogEvent.TIDY_UP_UNDO_FAIL,{ns_id:f,num_files_to_undo:a,undo_automation_failed:!1===C,undo_tidy_failed:!M}),(0,S.logEvent)(E.pap_events.tidyup.Undo_Tidyup.create({actionSurface:n,eventState:y.pap_events.EventState.FAILED,numFilesToUndo:a,tidyupUndoType:E.pap_events.tidyup.Undo_Tidyup.TidyupUndoType.PRECISION_TIDYUP_UNDO_TYPE}))),M?!1!==C?(p.WebUserActionLog.log(u,m.WebUserActionLogEvent.TIDY_UP_UNDO_SUCCESS,{ns_id:f,num_files_to_undo:a}),(0,S.logEvent)(E.pap_events.tidyup.Undo_Tidyup.create({actionSurface:n,eventState:y.pap_events.EventState.SUCCESS,numFilesToUndo:a,tidyupUndoType:E.pap_events.tidyup.Undo_Tidyup.TidyupUndoType.PRECISION_TIDYUP_UNDO_TYPE})),r.Snackbar.show(s.default.createElement(r.Snackbar,{closeButtonText:i.intl.formatMessage(o.TIDY_UP_SNACKBAR_DISMISS_LABEL),timeoutDelayMs:t.millisecondSnackbarTimeout8000,title:i.intl.formatMessage(o.TIDY_UNDO.UNDO_SUCCESS),variant:"complete",id:t.snackbarId}))):r.Snackbar.show(s.default.createElement(r.Snackbar,{closeButtonText:i.intl.formatMessage(o.TIDY_UP_SNACKBAR_DISMISS_LABEL),timeoutDelayMs:t.millisecondSnackbarTimeout8000,title:i.intl.formatMessage(o.TIDY_UNDO.UNDO_PARTIAL_ERROR_AUTOMATION_FAILURE),variant:"warn",id:t.snackbarId})):(e=>{const a=i.intl.formatMessage(e?o.TIDY_UNDO.UNDO_PARTIAL_ERROR_AUTOMATION_SUCCESS:o.TIDY_UNDO.UNDO_ERROR);r.Snackbar.show(s.default.createElement(r.Snackbar,{closeButtonText:i.intl.formatMessage(o.TIDY_UP_SNACKBAR_DISMISS_LABEL),timeoutDelayMs:t.millisecondSnackbarTimeout8000,title:a,variant:"warn",id:t.snackbarId}))})(!!C)}));t.retry=(e,a)=>()=>{r.Snackbar.close(t.snackbarId);const s=A.getState();(_.isCurrentPathRoot(s)?"":_.path(s))!==e&&A.dispatch(l.setUrl({path:e})),a()};const D=(e,a,n,l)=>{r.Snackbar.show(s.default.createElement(r.Snackbar,{actionButtonText:i.intl.formatMessage({id:"3KMB1D",defaultMessage:"Retry"}),onActionClick:l,closeButtonText:i.intl.formatMessage(o.TIDY_UP_SNACKBAR_DISMISS_LABEL),timeoutDelayMs:t.millisecondSnackbarTimeout8000,title:n,variant:"fail",id:t.snackbarId}))},P=e=>{r.Snackbar.show(s.default.createElement(r.Snackbar,{closeButtonText:i.intl.formatMessage(o.TIDY_UP_SNACKBAR_DISMISS_LABEL),timeoutDelayMs:t.millisecondSnackbarTimeout8000,title:e,variant:"complete",id:t.snackbarId}))},N=(e,n,l,d)=>a.__awaiter(void 0,void 0,void 0,(function*(){r.Snackbar.show(s.default.createElement(r.Snackbar,{id:t.snackbarId,title:i.intl.formatMessage(o.TIDY_PENDING.PENDING_AUTOMATION_REMOVAL),variant:"sync"})),yield f.removeFolderRules(n,d).then(()=>{U(e,n,l,void 0),P(i.intl.formatMessage(o.TIDY_SUCCESS.AUTOMATION_REMOVAL_SUCCESS_TEXT))},()=>{D(0,0,i.intl.formatMessage(o.TIDY_ERROR.AUTOMATION_REMOVAL_FAILURE),()=>{N(e,n,l,d)})})})),L=(e,n,l,d)=>a.__awaiter(void 0,void 0,void 0,(function*(){r.Snackbar.show(s.default.createElement(r.Snackbar,{id:t.snackbarId,title:i.intl.formatMessage(o.TIDY_PENDING.PENDING_AUTOMATION_APPLY),variant:"sync"})),yield f.setupFolderRules(n,d).then(()=>{U(e,n,l,"tidy_up"),P(i.intl.formatMessage(o.TIDY_SUCCESS.AUTOMATION_APPLY_SUCCESS_TEXT))},()=>{D(0,0,i.intl.formatMessage(o.TIDY_ERROR.AUTOMATION_APPLICATION_FAILURE),()=>{L(e,n,l,d)})})})),U=(e,t,a,s)=>{let r;A.dispatch(l.setFileHasAutomatedRuleMap({fileHasAutomatedRuleMap:(0,h.FlowsMap)({[t]:s})})),s?(r=m.WebUserActionLogEvent.TIDY_UP_AUTOMATION_SET,(0,S.logEvent)(T.pap_events.tidyup.Select_TidyupAutomation.create({actionSurface:a,tidyupSource:c.TidyConversions.tidySourceToPapType(a,g.pap_events.tidyup.Attempt_Tidyup.TidyupSource)}))):(r=m.WebUserActionLogEvent.TIDY_UP_AUTOMATION_REMOVED,(0,S.logEvent)(v.pap_events.tidyup.Remove_TidyupAutomation.create({actionSurface:a,tidyupSource:c.TidyConversions.tidySourceToPapType(a,g.pap_events.tidyup.Attempt_Tidyup.TidyupSource)}))),p.WebUserActionLog.log(e,r,{})};t.createFolder=e=>{A.dispatch(l.createFolder(e))}})),define("metaserver/static/js/tidy_up/api_v2",["require","exports","tslib","metaserver/static/js/api_v2/user_client","metaserver/static/js/tidy_up/utils","metaserver/static/js/tidy_up/constants","metaserver/static/js/tidy_up/modal/smart_preview_view/tidy_preview_types","js/filepath/filepath"],(function(e,t,a,s,r,i,o,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.shouldShowUploadSnackbar=t.shouldShowMoveSnackbar=t.dismissSnackbar=t.shouldShowSnackbar=t.getNumAddedFilesAndFolders=t.applySmartPreview=t.createRequestPreviewDataFn=t.getStoredFilters=t.submitFeedback=t.undo=t.getKeyphrases=t.preview=t.applyPreview=t.tidy=void 0,t.tidy=function(e,t,r,i){return a.__awaiter(this,void 0,void 0,(function*(){const a=new s.UserApiV2Client;return c(()=>a.ns("tidy_up").rpc("tidy",{request:i,source_path:t,ns_id:r,source:"web_modal"},{subjectUserId:e}),e,a)}))},t.applyPreview=function(e,t,r,i){return a.__awaiter(this,void 0,void 0,(function*(){const a=new s.UserApiV2Client;return c(()=>a.ns("tidy_up").rpc("apply_preview",{rule:r,source_path:t,entries_to_tidy:i,source:"web_modal"},{subjectUserId:e}),e,a)}))},t.preview=function(e,t,r){return a.__awaiter(this,void 0,void 0,(function*(){const a=new s.UserApiV2Client;try{return{result:yield a.ns("tidy_up").rpc("preview",{rule:r,source_path:(0,n.normalize)(t)},{subjectUserId:e})}}catch(e){return{isError:!0,error:e.error,error_summary:e.summary}}}))};const l=(e,t,a)=>a.ns("tidy_up").rpc("tidy/check",{async_job_id:e},{subjectUserId:t});function d(e){return Object.assign(Object.assign({},e),{ns_id_str:e.ns_id.toString()})}t.getKeyphrases=function(e,t){return a.__awaiter(this,void 0,void 0,(function*(){const a=new s.UserApiV2Client;try{return(yield a.ns("tidy_up").rpc("get_keyphrases",{path:t},{subjectUserId:e})).entries}catch(e){return[]}}))},t.undo=function(e,t,r,i,o){return a.__awaiter(this,void 0,void 0,(function*(){const a=new s.UserApiV2Client;try{const s=yield a.ns("tidy_up_api_proxy").rpc("undo",{source_path:e,moved_files_changesets:r.map(d),created_directories_changesets:i.map(d),renamed_directories_changesets:o.map(d)},{subjectUserId:t}),n=void 0!==s.files_result&&"success"===s.files_result[".tag"],l=!s.folders_result||"success"===s.folders_result[".tag"],c=!s.renamed_folders_result||"success"===s.renamed_folders_result[".tag"];return n&&l&&c}catch(e){return!1}}))},t.submitFeedback=function(e,t){return a.__awaiter(this,void 0,void 0,(function*(){const a=new s.UserApiV2Client;try{yield a.ns("tidy_up_api_proxy").rpc("submit_feedback",{feedback:t},{subjectUserId:e})}catch(e){}}))},t.getStoredFilters=function(e,t){return a.__awaiter(this,void 0,void 0,(function*(){const a=new s.UserApiV2Client;try{const s=yield a.ns("tidy_up_api_proxy").rpc("get_stored_custom_filters",{folder_path:t},{subjectUserId:e});let r=[];return void 0!==s.filters&&void 0!==s.filters.filters&&(r=s.filters.filters),r}catch(e){return[]}}))};const c=(e,t,s)=>a.__awaiter(void 0,void 0,void 0,(function*(){var a;try{const a=yield e();if("complete"===a[".tag"])return{isError:!1,result:a};if("other"===a[".tag"])return{isError:!0,error:{".tag":"undefined_error"},error_summary:"undefined_error"};let r=void 0;do{yield new Promise(e=>setTimeout(e,i.DEFAULT_TIME_BETWEEN_TIDY_POLL_MS)),r=yield l(a.async_job_id,t,s)}while(r&&"in_progress"===r[".tag"]);return"complete"===r[".tag"]?{isError:!1,result:r}:{isError:!0,error:{".tag":"undefined_error"},error_summary:"undefined_error"}}catch(e){return(null===(a=null==e?void 0:e.error)||void 0===a?void 0:a[".tag"])?{isError:!0,error:e.error,error_summary:e.summary}:{isError:!0,error:{".tag":"undefined_error"},error_summary:"undefined_error"}}}));t.createRequestPreviewDataFn=(e,t)=>{const i=t.replace(/\/$/,"");return n=>a.__awaiter(void 0,void 0,void 0,(function*(){var a,l,d,c,u,_,p,m,f;const h=new s.UserApiV2Client,S=[];try{let t=yield h.ns("files").rpc("list_folder",{path:i},{subjectUserId:e});for(S.push(...t.entries);t.has_more;)t=yield h.ns("files").rpc("list_folder/continue",{cursor:t.cursor},{subjectUserId:e}),S.push(...t.entries)}catch(e){return{error_tag:"list_files"}}const g={},E=[];for(const e of S)"file"===e[".tag"]&&(g[e.id]=e,E.push((0,o.getEntryId)(e.id)));if(0===E.length)return{error_tag:"no_files"};let T;null===(a=n.onPreviewDatafetchListfolderDone)||void 0===a||a.call(n);try{T=yield h.ns("tidy_up").rpc("smart_preview",{request:{".tag":"smart_move_request",entry_ids:E}},{subjectUserId:e})}catch(e){const t=null===(l=null==e?void 0:e.error)||void 0===l?void 0:l[".tag"];if(!t)return{error_tag:"other"};switch(t){case"path":return{error_tag:"path_not_found"};case"multiple_containing_folders":case"no_files":case"no_containing_folder":case"no_destinations":case"cannot_move_entry":case"list_files":return{error_tag:t};default:return{error_tag:"other"}}}const v={};for(const e of null!==(d=T.destinations)&&void 0!==d?d:[])e.name&&(v[e.id]={id:(0,o.getDestinationId)(e.id),folderName:e.name,path:`${t}/${e.name}`});const y=[];for(const e of null!==(c=T.entries)&&void 0!==c?c:[])(null===(u=g[e.id])||void 0===u?void 0:u.name)&&e.destination_ids&&e.suggested_destination_id&&y.push({id:(0,o.getEntryId)(e.id),filename:g[e.id].name,allowedDestinationIds:e.destination_ids.map(o.getDestinationId),suggestedDestinationId:(0,o.getDestinationId)(e.suggested_destination_id),isMlSuggestion:null!==(_=e.is_ml_suggestion)&&void 0!==_?_:null,predictId:null!==(p=e.prediction_id)&&void 0!==p?p:null,score:null!==(m=e.score)&&void 0!==m?m:null,suggestionConfidence:r.TidyConversions.confidenceLevelFromApi(e.confidence_interval),path:null!==(f=g[e.id].path_lower)&&void 0!==f?f:null});return{entries:y,destinations:v}}))};t.applySmartPreview=function(e,t,r,i=setTimeout){return a.__awaiter(this,void 0,void 0,(function*(){const a={};for(const e of r)a[e.id]=e;const o=new s.UserApiV2Client,n=Object.keys(t).map(e=>t[e]).filter(e=>{var t;return(null==e?void 0:e.isSelected)&&!!(null==e?void 0:e.selectedDestinationId)&&!!(null===(t=a[null==e?void 0:e.id])||void 0===t?void 0:t.filename)}).map(e=>({from_path:e.id,to_path:`${e.selectedDestinationId}/${a[e.id].filename}`}));let l;try{l=yield o.ns("files").rpc("move_batch_v2",{entries:n,autorename:!0},{subjectUserId:e})}catch(e){return{errorTag:"move"}}let d=null;for(;"complete"!==l[".tag"]&&"complete"!==(null==d?void 0:d[".tag"]);){yield new Promise(e=>i(e,2e3));try{d=yield o.ns("files").rpc("move_batch/check_v2",{async_job_id:l.async_job_id},{subjectUserId:e})}catch(e){return{errorTag:"check"}}}return{successTag:"response"}}))},t.getNumAddedFilesAndFolders=function(e,t){return a.__awaiter(this,void 0,void 0,(function*(){const a=new s.UserApiV2Client;try{return yield a.ns("tidy_up").rpc("get_num_added_files",{user_id:e,fq_path:t},{subjectUserId:e})}catch(e){return{num_added_files:-1,num_added_folders:-1}}}))},t.shouldShowSnackbar=function(e){return a.__awaiter(this,void 0,void 0,(function*(){const t=new s.UserApiV2Client;try{return(yield t.ns("tidy_up").rpc("feature_discovery/should_show_snackbar",void 0,{subjectUserId:e})).should_show}catch(e){return!1}}))},t.dismissSnackbar=function(e){(new s.UserApiV2Client).ns("tidy_up").rpc("feature_discovery/snackbar_dismissed",{reset_criteria:!1},{subjectUserId:e})},t.shouldShowMoveSnackbar=function(e,t,r){return a.__awaiter(this,void 0,void 0,(function*(){const a=new s.UserApiV2Client;try{const s=yield a.ns("tidy_up").rpc("feature_discovery/should_show_move_snackbar",{fq_path:t,num_moved_files:r},{subjectUserId:e});return{should_show:s.should_show,snackbar_type:s.snackbar_type}}catch(e){return{should_show:!1,snackbar_type:void 0}}}))},t.shouldShowUploadSnackbar=function(e,t){return a.__awaiter(this,void 0,void 0,(function*(){const a=new s.UserApiV2Client;try{const s=yield a.ns("tidy_up").rpc("feature_discovery/should_show_upload_snackbar",{fq_path:t},{subjectUserId:e});return{should_show:s.should_show,snackbar_type:s.snackbar_type}}catch(e){return{should_show:!1,snackbar_type:void 0}}}))}})),define("metaserver/static/js/tidy_up/constants",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FEATURE_GROWTH_SNACKBARS=t.DEFAULT_TIME_BETWEEN_TIDY_POLL_MS=void 0,t.DEFAULT_TIME_BETWEEN_TIDY_POLL_MS=1e3,(function(e){e.reengagement="reengagement",e.discovery="discovery"})(t.FEATURE_GROWTH_SNACKBARS||(t.FEATURE_GROWTH_SNACKBARS={}))})),define("metaserver/static/js/tidy_up/modal/options_view/tidy_radio_selection",["require","exports","tslib","react","dig-components/controls","dig-components/typography"],(function(e,t,a,s,r,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TidyUpSelection=void 0,s=a.__importDefault(s);t.TidyUpSelection=({isSelected:e,onSelect:t,value:a,label:o,subtext:n,children:l,name:d})=>s.default.createElement("div",{className:"tidy-up-view__radio-row",key:a},s.default.createElement(r.RadioButton,{id:a,value:a,checked:e,onChange:t,className:"tidy-up-view__radio-button",name:d}),s.default.createElement("span",{className:"tidy-up-view__radio-label-container"},s.default.createElement("span",{className:"tidy-up-view__radio-label"},s.default.createElement(i.Text,{tagName:"label",htmlFor:a},o)),s.default.createElement(i.Text,{size:"small",color:"faint"},n),e&&l)),t.TidyUpSelection.displayName="TidyUpSelection"})),define("metaserver/static/js/tidy_up/modal/smart_preview_view/tidy_preview_types",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ConfidenceLevel=t.getDestinationId=t.getEntryId=void 0,t.getEntryId=function(e){return e},t.getDestinationId=function(e){return e},(function(e){e[e.low=0]="low",e[e.medium=1]="medium",e[e.high=2]="high"})(t.ConfidenceLevel||(t.ConfidenceLevel={}))})),define("metaserver/static/js/tidy_up/modal/tidy_strings",["require","exports","react-intl"],(function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TIDY_FEATURE_GROWTH_STRINGS=t.TIDY_OPTION_STRINGS=t.TIDY_INACTIVE_OPTION=t.TIDY_MODAL_SUBTITLE=t.TIDY_MODAL_HEADER=t.TIDY_UNDO=t.TIDY_CONFIRMATION=t.TIDY_FEEDBACK=t.TidyTimeFrameFolderNamingDayLabels=t.TidyTimeFrameFolderNamingYearLabels=t.TidyTimeFrameFolderNamingMonthLabels=t.TidyTimeFrameFolderStructureLabels=t.TidyTimeFrameFolderDateRuleLabels=t.TIDY_TIME_FRAME_FILTER=t.TIDY_CUSTOM_FILTERS=t.TIDY_FOLDER_SELECTION=t.TIDY_KEYPHRASE=t.TIDY_SMART_PREVIEW=t.TIDY_PREVIEW=t.TIDY_ERROR=t.TIDY_SUCCESS=t.TIDY_PENDING=t.TIDY_OPTIONS=t.TIDY_UP_MODAL_PREVIEW_LABEL=t.TIDY_UP_SNACKBAR_DISMISS_LABEL=t.TIDY_UP_MODAL_BACK_LABEL=t.TIDY_UP_MODAL_APPLY_LABEL=t.TIDY_UP_MODAL_CANCEL_LABEL=t.TIDY_UP_MODAL_CLOSE_LABEL=t.TIDY_UP_MODAL_HEADER_LABEL=void 0,t.TIDY_UP_MODAL_HEADER_LABEL=(0,a.defineMessage)({id:"OC4T38",defaultMessage:"Tidy up"}),t.TIDY_UP_MODAL_CLOSE_LABEL=(0,a.defineMessage)({id:"FEI6xF",defaultMessage:"Close"}),t.TIDY_UP_MODAL_CANCEL_LABEL=(0,a.defineMessage)({id:"StgmB7",defaultMessage:"Cancel"}),t.TIDY_UP_MODAL_APPLY_LABEL=(0,a.defineMessage)({id:"03FNiv",defaultMessage:"Apply"}),t.TIDY_UP_MODAL_BACK_LABEL=(0,a.defineMessage)({id:"ndSchX",defaultMessage:"Back"}),t.TIDY_UP_SNACKBAR_DISMISS_LABEL=(0,a.defineMessage)({id:"PLME/5",defaultMessage:"Dismiss"}),t.TIDY_UP_MODAL_PREVIEW_LABEL=(0,a.defineMessage)({id:"7aGUDe",defaultMessage:"Preview"}),t.TIDY_OPTIONS=(0,a.defineMessages)({HEADER_LABEL:{id:"/IXzI6",defaultMessage:"Choose a rule"},BODY_TEXT:{id:"R7e8cr",defaultMessage:"Organize this content into folders grouped by:"},NEXT_LABEL:{id:"Z2Ie27",defaultMessage:"Next"},PREVIEW_LABEL:{id:"7aGUDe",defaultMessage:"Preview"},KEYPHRASE_LABEL:{id:"rHnW1g",defaultMessage:"Choose keyword"},FEEDBACK_LABEL:{id:"Z7UZ30",defaultMessage:"Give feedback"}}),t.TIDY_PENDING=(0,a.defineMessages)({PENDING_TEXT_1:{id:"3Cumks",defaultMessage:"Creating folders..."},PENDING_TEXT_2:{id:"rOHuZh",defaultMessage:"This may take a moment."},PENDING_AUTOMATION_REMOVAL:{id:"mK/eth",defaultMessage:"Removing automation..."},PENDING_AUTOMATION_APPLY:{id:"yvx6Ny",defaultMessage:"Applying automation..."},STILL_WORKING_TEXT_1:{id:"xDVihY",defaultMessage:"Moving files..."},STILL_WORKING_TEXT_2:{id:"Fw7phK",defaultMessage:"You can safely go about your work while we finish."}}),t.TIDY_SUCCESS=(0,a.defineMessages)({SUCCESS_TEXT:{id:"iszJTE",defaultMessage:"Successfully organized {numFilesTidied, plural, one{# file} other{# files}}."},AUTOMATION_REMOVAL_SUCCESS_TEXT:{id:"4DeEN2",defaultMessage:"Successfully removed automation."},AUTOMATION_APPLY_SUCCESS_TEXT:{id:"NfBNbr",defaultMessage:"Successfully applied automation."}}),t.TIDY_ERROR=(0,a.defineMessages)({ERROR_TEXT:{id:"9ma/3b",defaultMessage:"We werent able to organize your folder. Try again."},MIXED_SUCCESS_AUTOMATION_SUCCESS:{id:"n50m8S",defaultMessage:"Couldn't apply the rule. Successfully made changes to the automation."},MIXED_SUCCESS_AUTOMATION_FAILURE:{id:"WHUu5h",defaultMessage:"Couldn't make changes to the automation. Successfully applied rule."},AUTOMATION_REMOVAL_FAILURE:{id:"Uh39z5",defaultMessage:"Couldn't remove the automation."},AUTOMATION_APPLICATION_FAILURE:{id:"YoRCK6",defaultMessage:"Couldn't apply the automation."},PARTIAL_SUCCESS_TEXT_1:{id:"6V5H17",defaultMessage:"Organized {numSucceeded, plural, one{# file} other{# files}}."},PARTIAL_SUCCESS_TEXT_2:{id:"YKjtS3",defaultMessage:"{numFailed, plural, one{# file} other{# files}} couldnt be organized  give it another try."},ALL_CONTENT_ACTIVE_TEXT:{id:"/9yhnT",defaultMessage:"All of your content has been active recently."},ALL_CREATED_CURRENT_MONTH:{id:"yj7SqD",defaultMessage:"All of your content was added to Dropbox this month."},ALL_CREATED_CURRENT_YEAR:{id:"N73kL9",defaultMessage:"All of your content was added to Dropbox this year."},NO_MATCHING_KEYWORD:{id:"P/rv1f",defaultMessage:"We couldnt find any files containing this keyword."},EMPTY_KEYPHRASE_PREVIEW_BACK:{id:"UzL6C5",defaultMessage:"Try another keyword"},EMPTY_PREVIEW_BACK:{id:"FDsh/B",defaultMessage:"Try another rule"},EMPTY_CUSTOM_FITLER_PREVIEW_BACK:{id:"Yy0gyY",defaultMessage:"Modify filter rules"},NO_MATCHING_FILES_GENERIC:{id:"4zKt1i",defaultMessage:"We couldnt find any files to organize in this folder."},SNACKBAR_TEXT:{id:"cGFOIN",defaultMessage:"We couldnt find any files to organize in this folder. Try choosing a different rule."}}),t.TIDY_PREVIEW=(0,a.defineMessages)({MODAL_TITLE_LABEL:{id:"2/YiSD",defaultMessage:"Preview this rule"},MODAL_TITLE_ERROR_LABEL:{id:"mAFYum",defaultMessage:"Couldnt apply this rule"},DESCRIPTION_TEXT:{id:"dpAMYR",defaultMessage:"Youre about to make the following changes. Uncheck any items you want to exclude from this operation."},AUTOMATION_TOGGLE_LABEL:{id:"eY1+iP",defaultMessage:"Apply rule to every file added to this folder"},AUTOMATION_ON_LABEL:{id:"AXasyS",defaultMessage:"On"},AUTOMATION_OFF_LABEL:{id:"urtNrM",defaultMessage:"Off"}}),t.TIDY_SMART_PREVIEW=(0,a.defineMessages)({MODAL_TITLE_LABEL:{id:"NqyXrB",defaultMessage:"Smart move"},PREVIEW_PENDING_TEXT_1:{id:"kUAGn3",defaultMessage:"Analyzing folder for Smart Move..."},PREVIEW_PENDING_TEXT_2:{id:"ywWex0",defaultMessage:"This may take a moment."},APPLY_PENDING_TEXT:{id:"hSVEfh",defaultMessage:"Identifying folders..."},CONTENT_TITLE:{id:"+AvtU7",defaultMessage:"Content"},MOVE_TO_TITLE:{id:"LAd/7v",defaultMessage:"Move to:"},ADD_FEEDBACK:{id:"V0ezVH",defaultMessage:"Add feedback"},SHARE_FEEDBACK_PLACEHOLDER:{id:"y0XkHO",defaultMessage:"Share feedback with the team"},ERROR_PATH_NOT_FOUND:{id:"6JUT/e",defaultMessage:"Could not locate a file for organizing"},ERROR_MULTIPLE_CONTAINING_FOLDERS:{id:"gKBmyF",defaultMessage:"Cannot organize more than one folder at a time"},ERROR_NO_CONTAINING_FOLDER:{id:"AGMIp0",defaultMessage:"Cannot organize files without a containing folder"},ERROR_NO_DESTINATIONS_1:{id:"+7w7cI",defaultMessage:"Smart move needs at least one subfolder to suggest moving files into."},ERROR_NO_DESTINATIONS_2:{id:"yXlKn4",defaultMessage:"Create a subfolder or try another multi-file organize rule."},ERROR_CANNOT_MOVE_ENTRY:{id:"bNlw4b",defaultMessage:"Some files are read-only and cannot be moved"},ERROR_LIST_FILES:{id:"cLoDbN",defaultMessage:"There was a problem identifying files to organize"},ERROR_OTHER:{id:"CWZOOV",defaultMessage:"We werent able to organize your folder. Try again."},WARNING_TEXT:{id:"kDUNC8",defaultMessage:"This feature is for internal testing only. Be aware that moving files to a different folder may result in different access permissions."},HIGH_CONFIDENCE_SECTION_HEADER:{id:"MEt1EZ",defaultMessage:"Our suggested matches:"},POSSIBLE_MATCHES_SECTION_HEADER:{id:"ZUHtxO",defaultMessage:"Some possible matches:"},LOW_CONFIDENCE_ONLY_SECTION_HEADER:{id:"hl1h7f",defaultMessage:"Choose where you think these files should live:"},BODY_DESCRIPTION:{id:"X7XEUt",defaultMessage:"Here are the suggested locations for your files. Select the ones you want to move."},BODY_DESCRIPTION_NO_SUGGESTIONS:{id:"TJG7hj",defaultMessage:"We couldnt come up with any suggested matches, but you can choose the correct destination from the dropdowns."},CONTENT_COLUMN_HEADER:{id:"fZA951",defaultMessage:"Current content"},DESTINATIONS_COLUMN_HEADER:{id:"JGXTov",defaultMessage:"Move to"},DESTINATION_PLACEHOLDER:{id:"t0ARxk",defaultMessage:"Choose folder"},ERROR_BANNER:{id:"Ttmxyl",defaultMessage:"Selected files must have a folder destination."},PRIMARY_BUTTON_LABEL:{id:"TW19Cd",defaultMessage:"Move"}}),t.TIDY_KEYPHRASE=(0,a.defineMessages)({HEADER_LABEL:{id:"YBZvnw",defaultMessage:"Group by keyword"},PREVIEW_LABEL:{id:"7aGUDe",defaultMessage:"Preview"},INPUT_LABEL:{id:"p4yoHO",defaultMessage:"Keyword:"},INPUT_PLACEHOLDER:{id:"nW3umL",defaultMessage:"Type your keyword"},FOLDER_SELECTION_LABEL:{id:"6Zd09J",defaultMessage:"Destination:"}}),t.TIDY_FOLDER_SELECTION=(0,a.defineMessages)({dropdownPlaceholder:{id:"IJxA/7",defaultMessage:"Choose a subfolder"},noSubfolders:{id:"jOCQJ1",defaultMessage:"It seems like you dont have any existing subfolders. Try this again once you have at least one subfolder to choose from."},folderSelectionButtonLabel:{id:"mz8m9a",defaultMessage:"Choose folder"},title:{id:"ZXnd4e",defaultMessage:"Move items to"},defaultFolderSelectionButtonLabel:{id:"7SCfI3",defaultMessage:"Folder name"},folderCreationButtonLabel:{id:"i4621P",defaultMessage:"Create folder"},newFolderButtonLabel:{id:"sw1lp9",defaultMessage:"New folder"},newFolderInputPlaceholderText:{id:"6q3haJ",defaultMessage:"Folder name"},folderCreationTitleLabel:{id:"wduxmO",defaultMessage:"Move files to new folder"},folderNameLabel:{id:"CxQrI0",defaultMessage:"Name"},folderNameLengthError:{id:"FwD8fL",defaultMessage:"Folder name is too long."},folderNameInvalidCharacterError:{id:"FbwsTS",defaultMessage:"Folder names cant contain: \\ / :"}}),t.TIDY_CUSTOM_FILTERS=(0,a.defineMessages)({HEADER_LABEL:{id:"zyqr9m",defaultMessage:"Custom filters"},BODY_LABEL:{id:"TaNu8P",defaultMessage:"Create filters and configure rules to organize content. Filters will be applied to matching content in the order listed."},KEYWORD_EMPTY_INPUT_ERROR_LABEL:{id:"tQYcdG",defaultMessage:"Please enter a keyword."},KEYWORD_INVALID_CHARACTERS_ERROR_LABEL:{id:"0TvUJE",defaultMessage:"Please use letters (a-z), numbers (0-9), and underscores (_)."},KEYWORD_TOO_LONG_ERROR_LABEL:{id:"rlauM0",defaultMessage:"Maximum length for a keyword is 15 characters."},KEYWORD_ALREADY_EXISTS_ERROR_LABEL:{id:"K2iRBi",defaultMessage:"This keyword has already been added to the rule."},SIZE_INVALID_CHARACTERS_ERROR_LABEL:{id:"vjH8Ek",defaultMessage:"Please use numbers (0-9) only."},SIZE_TOO_LARGE_ERROR_LABEL:{id:"EdF6PB",defaultMessage:"Maximum value for a file size filter is 100 GB."},SIZE_INVALID_RANGE_ERROR_LABEL:{id:"wxq54e",defaultMessage:"Minimum value cannot exceed maximum."},FILES_GREATER_THAN_LABEL:{id:"nFLqkw",defaultMessage:"Files greater than"},FILES_SMALLER_THAN_LABEL:{id:"XbA6pf",defaultMessage:"Files smaller than"},ADD_RULE_LABEL:{id:"yjoU9B",defaultMessage:"Add rule"},CREATE_FILTER_LABEL:{id:"XXL0GB",defaultMessage:"Create new filter"},FOLDER_SELECTION_LABEL:{id:"lWzfli",defaultMessage:"Move files to:"},DELETE_FILTER_LABEL:{id:"qA0lf+",defaultMessage:"Delete filter"}}),t.TIDY_TIME_FRAME_FILTER=(0,a.defineMessages)({header_label:{id:"fSFcZF",defaultMessage:"Organize by time"},body_label:{id:"hcBEFs",defaultMessage:"Group files into subfolders based on the following folder structure."},time_frame_rule_selection_label:{id:"nvWpEL",defaultMessage:"Group by"},time_frame_date_rule_selection_label:{id:"YtpkZb",defaultMessage:"Using"},time_frame_date_date_rule_prompt_label:{id:"YUWPut",defaultMessage:"Date created is not always available for each file."},folder_naming_selection_label:{id:"v1bOOP",defaultMessage:"Folder naming"},year_folders_selection_label:{id:"nrRYNb",defaultMessage:"Year folders"},month_folders_selection_label:{id:"VNIPPz",defaultMessage:"Month folders"},day_folders_selection_label:{id:"PrfGFA",defaultMessage:"Day folders"},preview_label:{id:"7aGUDe",defaultMessage:"Preview"}}),t.TidyTimeFrameFolderDateRuleLabels=(0,a.defineMessages)({date_created:{id:"/z5QOK",defaultMessage:"Date created"},date_uploaded:{id:"hISSJo",defaultMessage:"Date uploaded"}}),t.TidyTimeFrameFolderStructureLabels=(0,a.defineMessages)({month:{id:"rMb/VK",defaultMessage:"Month"},year:{id:"LcewkZ",defaultMessage:"Year"},day:{id:"sHbORR",defaultMessage:"Day"}}),t.TidyTimeFrameFolderNamingMonthLabels=(0,a.defineMessages)({mm:{id:"GdmYyK",defaultMessage:"MM"},mm_yyyy:{id:"MkGMnE",defaultMessage:"MM-YYYY"},yyyy_mm:{id:"NPIdJZ",defaultMessage:"YYYY-MM"},month:{id:"rMb/VK",defaultMessage:"Month"},month_yyyy:{id:"xo2MT1",defaultMessage:"Month YYYY"}}),t.TidyTimeFrameFolderNamingYearLabels=(0,a.defineMessages)({yyyy:{id:"IqGaq/",defaultMessage:"YYYY"},yy:{id:"02jpeP",defaultMessage:"YY"}}),t.TidyTimeFrameFolderNamingDayLabels=(0,a.defineMessages)({dd:{id:"8URMRS",defaultMessage:"DD"},dd_day:{id:"Kr9xjy",defaultMessage:"DD Monday"},day:{id:"8Xmwl1",defaultMessage:"Monday"}}),t.TIDY_FEEDBACK=(0,a.defineMessages)({HEADER_LABEL:{id:"wihZud",defaultMessage:"Let us know what you think"},INPUT_PLACEHOLDER:{id:"u7sQJP",defaultMessage:"Anything goes here!"},MODAL_TEXT:{id:"4IQhQm",defaultMessage:"What can we do to make organizing your files easier?"},SUBMIT_LABEL:{id:"C/HKsS",defaultMessage:"Submit"}}),t.TIDY_CONFIRMATION=(0,a.defineMessages)({UPDATE_AUTOMATION_HEADER_LABEL:{id:"WvZUJv",defaultMessage:"Replace your existing automation?"},REMOVE_AUTOMATION_HEADER_LABEL:{id:"Mx+XRk",defaultMessage:"Remove your existing automation?"},UPDATE_CONFIRMATION_BODY_LABEL:{id:"R8WlLm",defaultMessage:"Automating this rule will replace this folders existing automation on an ongoing basis. Click <strong>{keepExistingButtonLabel}</strong> to apply this new rule only this one time."},REMOVE_CONFIRMATION_BODY_LABEL:{id:"kaTvx4",defaultMessage:"Updating this rule will remove this folders existing automation going forward. Click <strong>{keepExistingButtonLabel}</strong> to apply this rule without removing automation."},APPLY_WITHOUT_OVERRIDE_LABEL:{id:"raqLbh",defaultMessage:"Keep existing automation"},APPLY_AND_OVERRIDE_LABEL:{id:"sp7ooC",defaultMessage:"Replace"},APPLY_AND_REMOVE_LABEL:{id:"grjvza",defaultMessage:"Remove"}}),t.TIDY_UNDO=(0,a.defineMessages)({UNDO_PENDING:{id:"9yS73d",defaultMessage:"Undoing..."},UNDO_SUCCESS:{id:"vsXQtc",defaultMessage:"Undo successful  removed file grouping."},UNDO_ERROR:{id:"jwcStr",defaultMessage:"Couldnt remove file grouping."},UNDO_PARTIAL_ERROR_AUTOMATION_SUCCESS:{id:"wc6Thl",defaultMessage:"Undo successfully applied to the automation, but couldnt undo the file grouping."},UNDO_PARTIAL_ERROR_AUTOMATION_FAILURE:{id:"PQoKpp",defaultMessage:"Undo successfully applied to file grouping, but couldnt undo the automation."}}),t.TIDY_MODAL_HEADER=(0,a.defineMessage)({id:"rlhg66",defaultMessage:"Multi-file organize"}),t.TIDY_MODAL_SUBTITLE=(0,a.defineMessage)({id:"tZjTI1",defaultMessage:"Organize this content into folders grouped by:"}),t.TIDY_INACTIVE_OPTION=(0,a.defineMessages)({TITLE:{id:"VN2FV7",defaultMessage:"Organize inactive content"},SUBTITLE:{id:"mkBKo9",defaultMessage:"Group together content you haven't engaged with recently"},OPTION_LABEL:{id:"cN4D1q",defaultMessage:"Inactive for"},TIDY_UP_INACTIVE_THIRTY_DAYS:{id:"+7XcHy",defaultMessage:"30 days"},TIDY_UP_INACTIVE_NINETY_DAYS:{id:"XditG3",defaultMessage:"90 days"}}),t.TIDY_OPTION_STRINGS=(0,a.defineMessages)({CUSTOM_FILTER_TITLE:{id:"OhBogU",defaultMessage:"Custom filters"},CUSTOM_FILTER_SUBTITLE:{id:"ERkF8C",defaultMessage:"Group based on keywords and file types"},TIME_FRAME_TITLE:{id:"Rc8edF",defaultMessage:"Timeframe"},TIME_FRAME_SUBTITLE:{id:"BJUzKE",defaultMessage:"Group based on a specific timeframe"},INACTIVITY_TITLE:{id:"rxaX/E",defaultMessage:"Inactivity"},INACTIVITY_SUBTITLE:{id:"qd8Pdr",defaultMessage:"Group together content you havent engaged with recently"},SMART_MOVE_TITLE:{id:"xB+pkI",defaultMessage:"Smart move"},SMART_MOVE_SUBTITLE:{id:"ThRSey",defaultMessage:"Group files into existing subfolders based on our recommendations"},KEYPHRASE_FILTER_TITLE:{id:"rHq4Oa",defaultMessage:"Keyword"},KEYPHRASE_FILTER_SUBTITLE:{id:"WDRppN",defaultMessage:"Group by specific keywords"}}),t.TIDY_FEATURE_GROWTH_STRINGS=(0,a.defineMessages)({DISCOVERY_TITLE:{id:"4MKaZt",defaultMessage:"It looks like youve organized multiple files in this folder recently  organize them with our new folder organization tools."},REENGAGEMENT_TITLE:{id:"x+KNtZ",defaultMessage:"We updated multi-file organize with new custom filters."}})})),define("metaserver/static/js/tidy_up/modal/types",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DayRelatedFolderStructure=t.YearRelatedFolderStructure=t.MonthRelatedFolderStructure=t.TidyModalWidth=t.TidySpecificActionSurfaceLogValue=t.defaultTidyParameters=t.TidyTimeFrameDateRule=t.TidyTimeFrameFolderNamingDay=t.TidyTimeFrameFolderNamingYear=t.TidyTimeFrameFolderNamingMonth=t.TidyTimeFrameFolderStructure=t.TidyCustomFiltersType=t.TidyErrorType=t.initialTidyState=t.TidyStateType=t.DateFormatSelection=t.InactiveSelection=t.TidyUpType=t.toFileID=void 0;var a,s,r,i,o,n,l,d,c;t.toFileID=e=>e,(function(e){e.none="none",e.inactive="inactive",e.by_month="by_month",e.by_year="by_year",e.smart_move="smart_move",e.keyphrase="keyphrase",e.custom_filters="custom_filters",e.time_frame_filter="time_frame_filter"})(a=t.TidyUpType||(t.TidyUpType={})),(function(e){e.thirty_days="thirty_days",e.ninety_days="ninety_days"})(s=t.InactiveSelection||(t.InactiveSelection={})),(function(e){e[e.YYYY_MM=0]="YYYY_MM",e[e.YYYY_MM_Month=1]="YYYY_MM_Month",e[e.Month_YYYY=2]="Month_YYYY"})(t.DateFormatSelection||(t.DateFormatSelection={})),(function(e){e[e.Idle=0]="Idle",e[e.Preview=1]="Preview",e[e.SmartPreview=2]="SmartPreview",e[e.Keyphrase=3]="Keyphrase",e[e.KeyphrasePreview=4]="KeyphrasePreview",e[e.CustomFilters=5]="CustomFilters",e[e.CustomFilterPreview=6]="CustomFilterPreview",e[e.ConfirmOverrideAutomation=7]="ConfirmOverrideAutomation",e[e.ConfirmRemoveAutomation=8]="ConfirmRemoveAutomation",e[e.Feedback=9]="Feedback",e[e.TimeFrameFilter=10]="TimeFrameFilter",e[e.TimeFrameFilterPreview=11]="TimeFrameFilterPreview",e[e.InactivityFilter=12]="InactivityFilter",e[e.InactivityFilterPreview=13]="InactivityFilterPreview",e[e.CustomFilterFolderSelection=14]="CustomFilterFolderSelection"})(r=t.TidyStateType||(t.TidyStateType={})),t.initialTidyState={type:r.Idle},(function(e){e[e.Generic=0]="Generic",e[e.PartialSuccess=1]="PartialSuccess",e[e.NoMatchingFiles=2]="NoMatchingFiles"})(t.TidyErrorType||(t.TidyErrorType={})),(function(e){e.None="None",e.Keyword="Keyword",e.FileExtension="FileExtension",e.Size="Size"})(i=t.TidyCustomFiltersType||(t.TidyCustomFiltersType={})),(function(e){e.year="year",e.year_month="year_month",e.year_month_day="year_month_day",e.month="month",e.month_day="month_day",e.day="day"})(o=t.TidyTimeFrameFolderStructure||(t.TidyTimeFrameFolderStructure={})),(function(e){e.mm="mm",e.mm_yyyy="mm_yyyy",e.yyyy_mm="yyyy_mm",e.month="month",e.month_yyyy="month_yyyy"})(n=t.TidyTimeFrameFolderNamingMonth||(t.TidyTimeFrameFolderNamingMonth={})),(function(e){e.yyyy="yyyy",e.yy="yy"})(l=t.TidyTimeFrameFolderNamingYear||(t.TidyTimeFrameFolderNamingYear={})),(function(e){e.dd="dd",e.dd_day="dd_day",e.day="day"})(d=t.TidyTimeFrameFolderNamingDay||(t.TidyTimeFrameFolderNamingDay={})),(function(e){e.date_uploaded="date_uploaded",e.date_created="date_created"})(c=t.TidyTimeFrameDateRule||(t.TidyTimeFrameDateRule={})),t.defaultTidyParameters={type:a.none,activityParams:{inactiveSelection:s.thirty_days},byMonthParams:{excludeCurrentMonth:!1,dateFormatSelection:void 0},byYearParams:{excludeCurrentYear:!1},byKeyphraseParams:{keyphrase:void 0,keyphraseDestination:void 0},customFilterParams:{filters:[{id:Date.now(),rules:[{type:i.None}],actions:{destination:void 0}}]},byTimeFrameParams:{folderStructure:o.month,formatNaming:{monthFormat:n.yyyy_mm,yearFormat:l.yyyy,dayFormat:d.dd},date_rule:c.date_uploaded},previewData:void 0},(function(e){e.GROWTH_SNACKBAR_CTA="snackbar",e.MOVE_SNACKBAR_CTA="move_snackbar",e.DESKTOP_ENTRYPOINT="desktop",e.ORGANIZED_HOME_DESKTOP_ENTRYPOINT="desktop_organized_home",e.SNACKBAR_RETRY="from_retry",e.BROWSE_ACTIONS="browse_actions",e.ORGANIZE_WEB_ENTRYPOINT="web_organized_menu",e.IN_FOLDER_ACTIVATION="in_folder_activation",e.DISCOVERY_UPLOAD_SNACKBAR="discovery_upload_snackbar",e.REENGAGEMENT_UPLOAD_SNACKBAR="reengagement_upload_snackbar",e.DISCOVERY_MOVE_SNACKBAR="discovery_move_snackbar",e.REENGAGEMENT_MOVE_SNACKBAR="reengagement_move_snackbar"})(t.TidySpecificActionSurfaceLogValue||(t.TidySpecificActionSurfaceLogValue={})),(function(e){e.SMALL="small",e.STANDARD="standard",e.LARGE="large"})(t.TidyModalWidth||(t.TidyModalWidth={})),t.MonthRelatedFolderStructure=[o.month,o.year_month,o.month_day,o.year_month_day],t.YearRelatedFolderStructure=[o.year,o.year_month,o.year_month_day],t.DayRelatedFolderStructure=[o.day,o.month_day,o.year_month_day]})),define("metaserver/static/js/tidy_up/utils",["require","exports","tslib","metaserver/static/js/tidy_up/modal/types","js/filepath/filepath","metaserver/static/js/clean/ts_utils","metaserver/static/js/tidy_up/modal/smart_preview_view/tidy_preview_types","metaserver/static/js/pap/util","metaserver/static/js/clean/web_user_action_events","metaserver/static/js/clean/web_user_action_logger","metaserver/static/js/pap/analytics_client","metaserver/static/js/dropbox/proto/pap_events/tidyup/shown_tidyup_growth_snackbar","metaserver/static/js/tidy_up/constants"],(function(e,t,a,s,r,i,o,n,l,d,c,u,_){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.logTidyUpReengagementSnackbar=t.logTidyUpDiscoverySnackbar=t.TidyConversions=t.AutomationConversions=void 0,r=a.__importStar(r),t.AutomationConversions={automationRuleSetToRuleType(e){var t,a;if(!e.rules||0===e.rules.length||!(null===(a=null===(t=e.rules[0])||void 0===t?void 0:t.action)||void 0===a?void 0:a.action))return;const s=e.rules[0].action.action;return"other"!==s[".tag"]?s[".tag"]:void 0}},t.TidyConversions={tidyTypeToApiV2(e){const{type:a,activityParams:r,byMonthParams:i,byYearParams:o,byKeyphraseParams:n,customFilterParams:l,byTimeFrameParams:d}=e;switch(a){case s.TidyUpType.inactive:return{inactive_for:t.TidyConversions.inactiveTimespanToApiV2(r.inactiveSelection),".tag":"inactive_request"};case s.TidyUpType.by_month:return{exclude_current:i.excludeCurrentMonth,date_format:t.TidyConversions.dateFormatSelectionToApiV2(i.dateFormatSelection),".tag":"by_month_request"};case s.TidyUpType.by_year:return{exclude_current:o.excludeCurrentYear,".tag":"by_year_request"};case s.TidyUpType.keyphrase:return{phrase:n.keyphrase||"",destination:n.keyphraseDestination||"",".tag":"keyphrase_request"};case s.TidyUpType.smart_move:return{".tag":"smart_move_request"};case s.TidyUpType.custom_filters:return{".tag":"filter_request",filters:l.filters.map(t.TidyConversions.customFilterDefinitionToApiV2)};case s.TidyUpType.time_frame_filter:return{".tag":"by_time_frame_request",folder_structure:t.TidyConversions.byTimeFrameFilterParamsToApiV2(d),date_rule:{".tag":d.date_rule}};default:return{".tag":"other"}}},byTimeFrameFilterParamsToApiV2:e=>"month"===e.folderStructure?{".tag":"month",format:{".tag":e.formatNaming.monthFormat}}:"year"===e.folderStructure?{".tag":"year",format:{".tag":e.formatNaming.yearFormat}}:"day"===e.folderStructure?{".tag":"day",format:{".tag":e.formatNaming.dayFormat}}:"year_month"===e.folderStructure?{".tag":"year_month",month_format:{".tag":e.formatNaming.monthFormat},year_format:{".tag":e.formatNaming.yearFormat}}:"month_day"===e.folderStructure?{".tag":"month_day",month_format:{".tag":e.formatNaming.monthFormat},day_format:{".tag":e.formatNaming.dayFormat}}:{".tag":"year_month_day",month_format:{".tag":e.formatNaming.monthFormat},year_format:{".tag":e.formatNaming.yearFormat},day_format:{".tag":e.formatNaming.dayFormat}},customFilterRulesToApiV2:e=>({rules:e.map(e=>{var t,a,s;return"Keyword"===e.type?{rule:{".tag":"keyword_filter",keywords:null===(t=e.keywordRule)||void 0===t?void 0:t.keywords}}:"Size"===e.type?{rule:{".tag":"size_filter",sizes:null===(a=e.sizeRule)||void 0===a?void 0:a.sizes}}:{rule:{".tag":"file_type_filter",file_types:null===(s=e.fileExtensionRule)||void 0===s?void 0:s.fileExtensions}}})}),customFilterDefinitionToApiV2:e=>({filter_rules:t.TidyConversions.customFilterRulesToApiV2(e.rules),actions:{actions:[{action:{".tag":"move",destination:e.actions.destination,is_absolute_path:e.actions.is_absolute_path}}]}}),customFilterRulesFromApiV2(e){var t;return(null!==(t=e.rules)&&void 0!==t?t:[]).map(e=>{var t,a,r;return"keyword_filter"===(null===(t=e.rule)||void 0===t?void 0:t[".tag"])&&void 0!==e.rule.keywords?{type:s.TidyCustomFiltersType.Keyword,keywordRule:{keywords:e.rule.keywords}}:"file_type_filter"===(null===(a=e.rule)||void 0===a?void 0:a[".tag"])&&void 0!==e.rule.file_types?{type:s.TidyCustomFiltersType.FileExtension,fileExtensionRule:{fileExtensions:e.rule.file_types}}:"size_filter"===(null===(r=e.rule)||void 0===r?void 0:r[".tag"])&&void 0!==e.rule.sizes?{type:s.TidyCustomFiltersType.Size,sizeRule:{sizes:e.rule.sizes}}:{type:s.TidyCustomFiltersType.None}})},customFilterDefinitionFromApiV2(e){var a,s,r,i;const o=null!==(a=e.filter_rules)&&void 0!==a?a:{};let n=void 0,l=!1;return"move"===(null===(i=null===(r=null===(s=e.actions)||void 0===s?void 0:s.actions)||void 0===r?void 0:r[0].action)||void 0===i?void 0:i[".tag"])&&void 0!==e.actions.actions[0].action.destination&&(n=e.actions.actions[0].action.destination,l=!!e.actions.actions[0].action.is_absolute_path),{id:Date.now(),rules:t.TidyConversions.customFilterRulesFromApiV2(o),actions:{destination:n,is_absolute_path:l}}},sourceToDestinationPathFromApplyResult(e){var t;const a=[],s={};for(const t of e.entries)s[t.id]=t;for(const[r,i]of Object.entries(e.tidyPlan))if(i.isSelected&&null!==i.selectedDestinationId&&void 0!==i.selectedDestinationId&&(null===(t=e.destinations[i.selectedDestinationId])||void 0===t?void 0:t.path)&&s[r].filename){const t=s[r].path,o=`${e.destinations[i.selectedDestinationId].path}/${s[r].filename}`;t&&a.push({source_path:t,dest_path:o})}return a},tidyTypeFromApiV2(e){const a=JSON.parse(JSON.stringify(s.defaultTidyParameters));switch(e[".tag"]){case"by_month_request":return a.type=s.TidyUpType.by_month,a.byMonthParams.excludeCurrentMonth=e.exclude_current,a.byMonthParams.dateFormatSelection=t.TidyConversions.dateFormatSelectionFromApiV2(e.date_format),a;case"by_year_request":return a.type=s.TidyUpType.by_year,a.byYearParams.excludeCurrentYear=e.exclude_current,a;case"inactive_request":return a.type=s.TidyUpType.inactive,a.activityParams.inactiveSelection=t.TidyConversions.inactiveTimespanFromApiV2(e.inactive_for),a;case"keyphrase_request":return a.type=s.TidyUpType.keyphrase,a.byKeyphraseParams.keyphrase=e.phrase,a.byKeyphraseParams.keyphraseDestination=e.destination,a;case"smart_move_request":return a.type=s.TidyUpType.smart_move,a;case"filter_request":return a.type=s.TidyUpType.custom_filters,a.customFilterParams={filters:e.filters?e.filters.map(e=>t.TidyConversions.customFilterDefinitionFromApiV2(e)):[]},a;case"by_time_frame_request":return a.type=s.TidyUpType.time_frame_filter,a;default:return a}},tidyTypeToFlowsAPI(e){const a=t.TidyConversions.tidyTypeToApiV2(e);return{rules:[{enabled:!0,action:{action:{".tag":"tidy_up",args_json:JSON.stringify(a)}}}]}},tidyTypetoLoggingType(e){const{type:t,activityParams:a,byMonthParams:r,byYearParams:o}=e;let n="",l="";switch(t){case s.TidyUpType.inactive:l="inactive",n=a.inactiveSelection===s.InactiveSelection.thirty_days?"30d":"90d";break;case s.TidyUpType.by_month:l="month",r.excludeCurrentMonth&&(n="excl_current");break;case s.TidyUpType.by_year:l="year",o.excludeCurrentYear&&(n="excl_current");break;case s.TidyUpType.keyphrase:l="keyword";break;case s.TidyUpType.smart_move:l="smart_move";break;case s.TidyUpType.custom_filters:l="custom_filters";break;case s.TidyUpType.time_frame_filter:l="time_frame_filter";break;case s.TidyUpType.none:l="none";break;default:throw(0,i.enforceExhaustive)(t)}return{tidyUpRule:l,tidyUpSubRule:n}},inactiveTimespanToApiV2(e){switch(e){case s.InactiveSelection.thirty_days:return{".tag":"thirty_days"};case s.InactiveSelection.ninety_days:return{".tag":"ninety_days"};default:return{".tag":"other"}}},inactiveTimespanFromApiV2(e){switch(e[".tag"]){case"thirty_days":return s.InactiveSelection.thirty_days;case"ninety_days":return s.InactiveSelection.ninety_days;default:return s.InactiveSelection.thirty_days}},dateFormatSelectionToApiV2(e){switch(e){case s.DateFormatSelection.YYYY_MM:return{".tag":"yyyy_mm"};case s.DateFormatSelection.YYYY_MM_Month:return{".tag":"yyyy_mm_month"};case s.DateFormatSelection.Month_YYYY:return{".tag":"month_yyyy"};default:return}},dateFormatSelectionFromApiV2(e){if(void 0===e)return s.DateFormatSelection.YYYY_MM;switch(e[".tag"]){case"yyyy_mm":return s.DateFormatSelection.YYYY_MM;case"yyyy_mm_month":return s.DateFormatSelection.YYYY_MM_Month;case"month_yyyy":return s.DateFormatSelection.Month_YYYY;default:return s.DateFormatSelection.YYYY_MM}},previewSelectionToApiV2(e,t){const a=[];for(const s of e){if(s.isRenamed){if((t.get(s.id)||s.files.some(e=>!!t.get(e.id)))&&s.sourcePath&&s.destPath){const e={source_path:s.sourcePath,dest_path:s.destPath,is_folder:!0};a.push(e)}}for(const e of s.files)if(t.get(e.id)){const t={source_path:e.fqPathSrc,dest_path:e.fqPathDest};a.push(t)}}return a},apiV2ToPreviewSelection(e,t){const a={},i=[],o=[];function n(e,t){let a=[];for(let s=0;s<e.length;s++)if(e[s]!==t[s]){a=t.slice(s);break}return a.length>=1?a:t.slice(e.length)}for(const t of e){if(t.is_folder){o.push(t);continue}const e=r.parent_dir(t.dest_path),n=(0,s.toFileID)(t.dest_path),l={displayName:r.filename(t.dest_path),id:n,fqPathDest:t.dest_path,fqPathSrc:t.source_path};i.push(n),e in a?a[e].push(l):a[e]=[l]}const l=[];for(const[e,i]of Object.entries(a)){const a=r.parent_dir(i[0].fqPathSrc),o=r.parent_dir(i[0].fqPathDest),d=r.inSubDirectory(a,o)?n(a.split("/"),o.split("/")):o.split("/").filter(e=>0!==e.length);0===d.length&&d.push(t);const c={isDir:!0,displayName:d,fqPath:e,files:i,id:(0,s.toFileID)(e)};l.push(c)}for(const e of o){let t=!1;for(const a of l)if(a.fqPath===e.dest_path){a.isRenamed=!0,a.previousName=r.filename(e.source_path),a.newName=r.filename(e.dest_path),a.sourcePath=e.source_path,a.destPath=e.dest_path,t=!0;break}if(!t){const t=(0,s.toFileID)(e.dest_path),a={isDir:!0,displayName:[""],fqPath:e.dest_path,files:[],isRenamed:!0,previousName:r.filename(e.source_path),newName:r.filename(e.dest_path),sourcePath:e.source_path,destPath:e.dest_path,id:t};i.push(t),l.push(a)}}return{folderHierarchy:l,fileIds:i}},compareTidyRules:(e,t)=>"inactive_request"===e[".tag"]&&"inactive_request"===t[".tag"]?e.inactive_for===t.inactive_for:"by_month_request"===e[".tag"]&&"by_month_request"===t[".tag"]?e.exclude_current===t.exclude_current&&e.date_format===t.date_format:"by_year_request"===e[".tag"]&&"by_year_request"===t[".tag"]?e.exclude_current===t.exclude_current:"keyphrase_request"===e[".tag"]&&"keyphrase_request"===t[".tag"]&&(e.phrase===t.phrase&&e.destination===t.destination),doesCurrentSelectionMatchAutomation(e,a){if(!e)return!1;const s=t.TidyConversions.tidyTypeToApiV2(a);return"by_month_request"===s[".tag"]&&"by_month_request"===e[".tag"]||("filter_request"===s[".tag"]&&"filter_request"===e[".tag"]||("by_time_frame_request"===s[".tag"]&&"by_time_frame_request"===e[".tag"]||("keyphrase_request"===s[".tag"]&&"keyphrase_request"===e[".tag"]||t.TidyConversions.compareTidyRules(e,s))))},shouldSilentlyReplaceAutomation(e,a){if(!e)return!1;const s=t.TidyConversions.tidyTypeToApiV2(a);return!t.TidyConversions.compareTidyRules(e,s)&&("by_month_request"===s[".tag"]&&"by_month_request"===e[".tag"])},confidenceLevelFromApi(e){switch(null==e?void 0:e[".tag"]){case"high":return o.ConfidenceLevel.high;case"mid":return o.ConfidenceLevel.medium;default:return o.ConfidenceLevel.low}},confidenceLevelToApi(e){switch(e){case o.ConfidenceLevel.high:return{".tag":"high"};case o.ConfidenceLevel.medium:return{".tag":"mid"};case o.ConfidenceLevel.low:return{".tag":"low"};default:throw(0,i.enforceExhaustive)(e)}},tidyTypeToPapType(e,t){const{type:a,activityParams:r,byMonthParams:o,byYearParams:l}=e;let d=void 0,c="";switch(a){case s.TidyUpType.inactive:d=(0,n.getEnumValueForString)("INACTIVE_TIDYUP_RULE",t),c=r.inactiveSelection===s.InactiveSelection.thirty_days?"30d":"90d";break;case s.TidyUpType.by_month:d=(0,n.getEnumValueForString)("MONTH_TIDYUP_RULE",t),o.excludeCurrentMonth&&(c="excl_current");break;case s.TidyUpType.by_year:d=(0,n.getEnumValueForString)("YEAR_TIDYUP_RULE",t),l.excludeCurrentYear&&(c="excl_current");break;case s.TidyUpType.keyphrase:d=(0,n.getEnumValueForString)("KEYWORD_TIDYUP_RULE",t);break;case s.TidyUpType.smart_move:d=(0,n.getEnumValueForString)("SMART_MOVE_TIDYUP_RULE",t);break;case s.TidyUpType.custom_filters:d=(0,n.getEnumValueForString)("CUSTOM_FILTER_TIDYUP_RULE",t);break;case s.TidyUpType.time_frame_filter:d=(0,n.getEnumValueForString)("TIME_FRAME_FILTER_TIDYUP_RULE",t);break;case s.TidyUpType.none:break;default:throw(0,i.enforceExhaustive)(a)}return{tidyUpRule:d,tidyUpSubrule:c}},tidyInactiveRangeToPapType(e,t){let a=void 0;switch(e){case s.InactiveSelection.thirty_days:a=(0,n.getEnumValueForString)("THIRTY_DAYS_TIDYUP_TIME_INACTIVE_SUBRULE",t);break;case s.InactiveSelection.ninety_days:a=(0,n.getEnumValueForString)("NINETY_DAYS_TIDYUP_TIME_INACTIVE_SUBRULE",t);break;default:throw(0,i.enforceExhaustive)(e)}return a},tidyDateFormatToPapType(e,t){if(void 0===e)return(0,n.getEnumValueForString)("UNKNOWN_TIDYUP_DATE_FORMAT_SUBRULE",t);switch(e){case s.DateFormatSelection.YYYY_MM:return(0,n.getEnumValueForString)("YYYY_MM_TIDYUP_DATE_FORMAT_SUBRULE",t);case s.DateFormatSelection.YYYY_MM_Month:return(0,n.getEnumValueForString)("YYYY_MM_MONTH_TIDYUP_DATE_FORMAT_SUBRULE",t);case s.DateFormatSelection.Month_YYYY:return(0,n.getEnumValueForString)("MONTH_YYYY_TIDYUP_DATE_FORMAT_SUBRULE",t);default:throw(0,i.enforceExhaustive)(e)}},tidyAutomationToPapType:(e,t,a)=>t?(0,n.getEnumValueForString)("APPLY_TIDYUP_AUTOMATION_ACTION",a):e?(0,n.getEnumValueForString)("REMOVE_TIDYUP_AUTOMATION_ACTION",a):(0,n.getEnumValueForString)("NONE_TIDYUP_AUTOMATION_ACTION",a),tidySourceToPapType:(e,t)=>e===s.TidySpecificActionSurfaceLogValue.DESKTOP_ENTRYPOINT?(0,n.getEnumValueForString)("DESKTOP_MENU_TIDYUP_SOURCE",t):e===s.TidySpecificActionSurfaceLogValue.GROWTH_SNACKBAR_CTA||e==s.TidySpecificActionSurfaceLogValue.DISCOVERY_UPLOAD_SNACKBAR||e==s.TidySpecificActionSurfaceLogValue.REENGAGEMENT_UPLOAD_SNACKBAR?(0,n.getEnumValueForString)("UPLOAD_SNACKBAR_TIDYUP_SOURCE",t):e===s.TidySpecificActionSurfaceLogValue.MOVE_SNACKBAR_CTA||e==s.TidySpecificActionSurfaceLogValue.DISCOVERY_MOVE_SNACKBAR||e==s.TidySpecificActionSurfaceLogValue.REENGAGEMENT_MOVE_SNACKBAR?(0,n.getEnumValueForString)("MOVE_SNACKBAR_TIDYUP_SOURCE",t):e===s.TidySpecificActionSurfaceLogValue.SNACKBAR_RETRY?(0,n.getEnumValueForString)("RETRY_TIDYUP_SOURCE",t):e===s.TidySpecificActionSurfaceLogValue.ORGANIZED_HOME_DESKTOP_ENTRYPOINT?(0,n.getEnumValueForString)("DESKTOP_ORGANIZED_HOME_TIDYUP_SOURCE",t):(0,n.getEnumValueForString)("WEB_BROWSE_TIDYUP_SOURCE",t)};t.logTidyUpDiscoverySnackbar=(e,t,a)=>{d.WebUserActionLog.log(e,l.WebUserActionLogEvent.FEATURE_DISCOVERY_SNACKBAR_SHOW,{ns_id:t,origin:_.FEATURE_GROWTH_SNACKBARS.discovery,trigger:a,feature:"tidy_up"}),(0,c.logEvent)(u.pap_events.tidyup.Shown_TidyupGrowthSnackbar.create({actionSurface:l.ActionSurfaceLogValue.FEATURE_GROWTH,tidyupFeatureDiscoveryTrigger:u.pap_events.tidyup.Shown_TidyupGrowthSnackbar.TidyupFeatureDiscoveryTrigger.BULK_MOVE_TIDYUP_FEATURE_DISCOVERY_TRIGGER}))};t.logTidyUpReengagementSnackbar=(e,t,a)=>{d.WebUserActionLog.log(e,l.WebUserActionLogEvent.FEATURE_REENGAGEMENT_SNACKBAR_SHOW,{ns_id:t,origin:_.FEATURE_GROWTH_SNACKBARS.reengagement,trigger:a,feature:"tidy_up"}),(0,c.logEvent)(u.pap_events.tidyup.Shown_TidyupGrowthSnackbar.create({actionSurface:l.ActionSurfaceLogValue.FEATURE_GROWTH,tidyupFeatureReengagementTrigger:u.pap_events.tidyup.Shown_TidyupGrowthSnackbar.TidyupFeatureReengagementTrigger.BULK_MOVE_TIDYUP_FEATURE_REENGAGEMENT_TRIGGER}))}})),define("metaserver/static/js/tidy_up/feature_growth",["require","exports","tslib","metaserver/static/js/tidy_up/api_v2","metaserver/static/js/browse/data/selectors","metaserver/static/js/browse/data/selectors","metaserver/static/js/browse/data/store","metaserver/static/js/clean/ui/snackbar","metaserver/static/js/browse/data/action_creators/index","metaserver/static/js/core/i18n","react","metaserver/static/js/tidy_up/modal/types","metaserver/static/js/tidy_up/modal/tidy_strings","metaserver/static/js/tidy_up/utils","metaserver/static/js/tidy_up/constants","metaserver/static/js/clean/viewer"],(function(e,t,a,s,r,i,o,n,l,d,c,u,_,p,m,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.showTidyUpMoveSnackbar=t.openTidyUpModal=void 0,i=a.__importStar(i),l=a.__importStar(l),c=a.__importDefault(c);t.openTidyUpModal=(t,s,d,c)=>{n.Snackbar.close("tidyup-feature-growth");const u=(0,o.getStoreForBrowse)(),_=u.getState();i.path(_)!==t&&u.dispatch(l.setUrl({path:t}));const p=i.browsePostTTIExperiments(_);new Promise((t,a)=>{e(["metaserver/static/js/tidy_up/modal/tidy_up_modal"],t,a)}).then(a.__importStar).then(({showTidyUpModal:e})=>{const a=i.user(_);e({currentUserId:s,targetPath:t,namespaceId:d,actionSurface:c,features:p,subfolders:i.unsortedFiles(_).filter(e=>e.is_dir).toArray(),isInsideFlowsEligibleFolder:(0,r.isInsideFlowsEligibleFolder)(_),isPaidUser:!!a.paid||!!a.is_team,rootFolderDisplayName:f.Viewer.get_root_name(a)})})};const h=d.intl.formatMessage({id:"Kk24DX",defaultMessage:"Open multi-file organize"}),S=d.intl.formatMessage({id:"UArEyu",defaultMessage:"Close"});t.showTidyUpMoveSnackbar=(e,a,r,i)=>{if(void 0===e)return;let o;i&&i[".tag"]!==m.FEATURE_GROWTH_SNACKBARS.discovery?i[".tag"]===m.FEATURE_GROWTH_SNACKBARS.reengagement&&(o=d.intl.formatMessage(_.TIDY_FEATURE_GROWTH_STRINGS.REENGAGEMENT_TITLE),(0,p.logTidyUpReengagementSnackbar)(a,r,"bulk_move")):(o=d.intl.formatMessage(_.TIDY_FEATURE_GROWTH_STRINGS.DISCOVERY_TITLE),(0,p.logTidyUpDiscoverySnackbar)(a,r,"bulk_move"));const l=void 0!==i&&i[".tag"]===m.FEATURE_GROWTH_SNACKBARS.reengagement?u.TidySpecificActionSurfaceLogValue.REENGAGEMENT_MOVE_SNACKBAR:u.TidySpecificActionSurfaceLogValue.DISCOVERY_UPLOAD_SNACKBAR;n.Snackbar.show(c.default.createElement(n.Snackbar,{actionButtonText:h,onActionClick:()=>(0,t.openTidyUpModal)(e,a,r,l),closeButtonText:S,onCloseClick:()=>(0,s.dismissSnackbar)(a),timeoutDelayMs:1e4,title:o,variant:"generic",id:"tidyup-feature-growth"}))}})),define("typescript/dropbox/proto/hql_events/browse/web_browse_pb",["require","exports","@bufbuild/protobuf","../extensions_pb"],(function(e,t,a,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebBrowseSelectRow=void 0;class r extends a.Message{constructor(e){super(),this.actionSource="",a.proto3.util.initPartial(e,this)}static fromBinary(e,t){return(new r).fromBinary(e,t)}static fromJson(e,t){return(new r).fromJson(e,t)}static fromJsonString(e,t){return(new r).fromJsonString(e,t)}static equals(e,t){return a.proto3.util.equals(r,e,t)}}t.WebBrowseSelectRow=r,r.runtime=a.proto3,r.typeName="hql_events.WebBrowseSelectRow",r.fields=a.proto3.util.newFieldList(()=>[{no:1,name:"action_source",kind:"scalar",T:9},{no:2,name:"hql_metadata",kind:"message",T:s.HQLMetadata}])})),define("metaserver/static/js/dropbox/proto/pap_events/tidyup/shown_tidyup_growth_snackbar",["require","exports","tslib","protobufjs/minimal","metaserver/static/js/dropbox/proto/pap_events/predefined_event"],(function(e,t,a,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.pap_events=void 0;(s=a.__importStar(s)).Reader,s.Writer,s.util;const r=s.roots.default||(s.roots.default={});var i,o;t.default=r,t.pap_events=r.pap_events=((i=r.pap_events||{}).tidyup=((o=i.tidyup||{}).Shown_TidyupGrowthSnackbar=(function(e){function e(e){if(e)for(let t=Object.keys(e),a=0;a<t.length;++a)null!=e[t[a]]&&(this[t[a]]=e[t[a]])}return e.prototype.actionSurface="",e.prototype.eventClass=0,e.prototype.tidyupFeatureDiscoveryTrigger=0,e.prototype.tidyupFeatureReengagementTrigger=0,e.create=function(t){return new e(t)},e.getTypeUrl=function(){return"type.googleapis.com/pap_events.tidyup.Shown_TidyupGrowthSnackbar"},e.EventClass=(function(){const e={},t=Object.create(e);return t[e[0]="TIDYUP"]=0,t})(),e.TidyupFeatureDiscoveryTrigger=(function(){const e={},t=Object.create(e);return t[e[0]="UNKNOWN_TIDYUP_FEATURE_DISCOVERY_TRIGGER"]=0,t[e[1]="BULK_UPLOAD_TIDYUP_FEATURE_DISCOVERY_TRIGGER"]=1,t[e[2]="BULK_MOVE_TIDYUP_FEATURE_DISCOVERY_TRIGGER"]=2,t})(),e.TidyupFeatureReengagementTrigger=(function(){const e={},t=Object.create(e);return t[e[0]="UNKNOWN_TIDYUP_FEATURE_REENGAGEMENT_TRIGGER"]=0,t[e[1]="BULK_MOVE_TIDYUP_FEATURE_REENGAGEMENT_TRIGGER"]=1,t[e[2]="BULK_UPLOAD_TIDYUP_FEATURE_REENGAGEMENT_TRIGGER"]=2,t})(),e})(o.Shown_TidyupGrowthSnackbar||{}),o),i)})),define("metaserver/static/js/dropbox/proto/pap_events/tidyup/attempt_tidyup",["require","exports","tslib","protobufjs/minimal","metaserver/static/js/dropbox/proto/pap_events/predefined_event","metaserver/static/js/dropbox/proto/pap_events/event_enums"],(function(e,t,a,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.pap_events=void 0;(s=a.__importStar(s)).Reader,s.Writer,s.util;const r=s.roots.default||(s.roots.default={});var i,o;t.default=r,t.pap_events=r.pap_events=((i=r.pap_events||{}).tidyup=((o=i.tidyup||{}).Attempt_Tidyup=(function(e){function e(e){if(e)for(let t=Object.keys(e),a=0;a<t.length;++a)null!=e[t[a]]&&(this[t[a]]=e[t[a]])}return e.prototype.actionSurface="",e.prototype.eventClass=0,e.prototype.eventState=0,e.prototype.tidyupRule=0,e.prototype.tidyupSubrule="",e.prototype.tidyupFilesDeselected=0,e.prototype.tidyupAutomationAction=0,e.prototype.tidyupSource=0,e.prototype.tidyupDateFormatSubrule=0,e.prototype.tidyupExcludeCurrentSubrule=!1,e.prototype.tidyupTimeInactiveSubrule=0,e.prototype.tidyupAppliedFiltersCount=0,e.create=function(t){return new e(t)},e.getTypeUrl=function(){return"type.googleapis.com/pap_events.tidyup.Attempt_Tidyup"},e.EventClass=(function(){const e={},t=Object.create(e);return t[e[0]="TIDYUP"]=0,t})(),e.TidyupAutomationAction=(function(){const e={},t=Object.create(e);return t[e[0]="UNKNOWN_TIDYUP_AUTOMATION_ACTION"]=0,t[e[1]="NONE_TIDYUP_AUTOMATION_ACTION"]=1,t[e[2]="APPLY_TIDYUP_AUTOMATION_ACTION"]=2,t[e[3]="REMOVE_TIDYUP_AUTOMATION_ACTION"]=3,t})(),e.TidyupDateFormatSubrule=(function(){const e={},t=Object.create(e);return t[e[0]="UNKNOWN_TIDYUP_DATE_FORMAT_SUBRULE"]=0,t[e[1]="YYYY_MM_TIDYUP_DATE_FORMAT_SUBRULE"]=1,t[e[2]="YYYY_MM_MONTH_TIDYUP_DATE_FORMAT_SUBRULE"]=2,t[e[3]="MONTH_YYYY_TIDYUP_DATE_FORMAT_SUBRULE"]=3,t})(),e.TidyupRule=(function(){const e={},t=Object.create(e);return t[e[0]="UNKNOWN_TIDYUP_RULE"]=0,t[e[1]="MONTH_TIDYUP_RULE"]=1,t[e[2]="YEAR_TIDYUP_RULE"]=2,t[e[3]="KEYWORD_TIDYUP_RULE"]=3,t[e[4]="INACTIVE_TIDYUP_RULE"]=4,t[e[5]="SMART_MOVE_TIDYUP_RULE"]=5,t[e[6]="CUSTOM_FILTER_TIDYUP_RULE"]=6,t[e[7]="TIME_FRAME_TIDYUP_RULE"]=7,t})(),e.TidyupSource=(function(){const e={},t=Object.create(e);return t[e[0]="UNKNOWN_TIDYUP_SOURCE"]=0,t[e[1]="WEB_BROWSE_TIDYUP_SOURCE"]=1,t[e[2]="DESKTOP_MENU_TIDYUP_SOURCE"]=2,t[e[3]="RETRY_TIDYUP_SOURCE"]=3,t[e[4]="MOVE_SNACKBAR_TIDYUP_SOURCE"]=4,t[e[5]="UPLOAD_SNACKBAR_TIDYUP_SOURCE"]=5,t[e[6]="DESKTOP_ORGANIZED_HOME_TIDYUP_SOURCE"]=6,t[e[7]="WEB_ORGANIZED_MENU_TIDYUP_SOURCE"]=7,t})(),e.TidyupTimeInactiveSubrule=(function(){const e={},t=Object.create(e);return t[e[0]="UNKNOWN_TIDYUP_TIME_INACTIVE_SUBRULE"]=0,t[e[1]="THIRTY_DAYS_TIDYUP_TIME_INACTIVE_SUBRULE"]=1,t[e[2]="NINETY_DAYS_TIDYUP_TIME_INACTIVE_SUBRULE"]=2,t[e[3]="ONE_YEAR_TIDYUP_TIME_INACTIVE_SUBRULE"]=3,t})(),e})(o.Attempt_Tidyup||{}),o),i.EventState=(function(){const e={},t=Object.create(e);return t[e[0]="UNKNOWN_EVENT_STATE"]=0,t[e[1]="START"]=1,t[e[2]="SUCCESS"]=2,t[e[3]="FAILED"]=3,t[e[4]="CANCELED"]=4,t})(),i)})),define("metaserver/static/js/dropbox/proto/pap_events/tidyup/remove_tidyup_automation",["require","exports","tslib","protobufjs/minimal","metaserver/static/js/dropbox/proto/pap_events/predefined_event"],(function(e,t,a,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.pap_events=void 0;(s=a.__importStar(s)).Reader,s.Writer,s.util;const r=s.roots.default||(s.roots.default={});var i,o;t.default=r,t.pap_events=r.pap_events=((i=r.pap_events||{}).tidyup=((o=i.tidyup||{}).Remove_TidyupAutomation=(function(e){function e(e){if(e)for(let t=Object.keys(e),a=0;a<t.length;++a)null!=e[t[a]]&&(this[t[a]]=e[t[a]])}return e.prototype.actionSurface="",e.prototype.eventClass=0,e.prototype.tidyupSource=0,e.create=function(t){return new e(t)},e.getTypeUrl=function(){return"type.googleapis.com/pap_events.tidyup.Remove_TidyupAutomation"},e.EventClass=(function(){const e={},t=Object.create(e);return t[e[0]="TIDYUP"]=0,t})(),e.TidyupSource=(function(){const e={},t=Object.create(e);return t[e[0]="UNKNOWN_TIDYUP_SOURCE"]=0,t[e[1]="WEB_BROWSE_TIDYUP_SOURCE"]=1,t[e[2]="DESKTOP_MENU_TIDYUP_SOURCE"]=2,t[e[3]="RETRY_TIDYUP_SOURCE"]=3,t[e[4]="MOVE_SNACKBAR_TIDYUP_SOURCE"]=4,t[e[5]="UPLOAD_SNACKBAR_TIDYUP_SOURCE"]=5,t[e[6]="DESKTOP_ORGANIZED_HOME_TIDYUP_SOURCE"]=6,t[e[7]="WEB_ORGANIZED_MENU_TIDYUP_SOURCE"]=7,t})(),e})(o.Remove_TidyupAutomation||{}),o),i)})),define("metaserver/static/js/dropbox/proto/pap_events/tidyup/select_tidyup_automation",["require","exports","tslib","protobufjs/minimal","metaserver/static/js/dropbox/proto/pap_events/predefined_event"],(function(e,t,a,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.pap_events=void 0;(s=a.__importStar(s)).Reader,s.Writer,s.util;const r=s.roots.default||(s.roots.default={});var i,o;t.default=r,t.pap_events=r.pap_events=((i=r.pap_events||{}).tidyup=((o=i.tidyup||{}).Select_TidyupAutomation=(function(e){function e(e){if(e)for(let t=Object.keys(e),a=0;a<t.length;++a)null!=e[t[a]]&&(this[t[a]]=e[t[a]])}return e.prototype.actionSurface="",e.prototype.eventClass=0,e.prototype.tidyupSource=0,e.create=function(t){return new e(t)},e.getTypeUrl=function(){return"type.googleapis.com/pap_events.tidyup.Select_TidyupAutomation"},e.EventClass=(function(){const e={},t=Object.create(e);return t[e[0]="TIDYUP"]=0,t})(),e.TidyupSource=(function(){const e={},t=Object.create(e);return t[e[0]="UNKNOWN_TIDYUP_SOURCE"]=0,t[e[1]="WEB_BROWSE_TIDYUP_SOURCE"]=1,t[e[2]="DESKTOP_MENU_TIDYUP_SOURCE"]=2,t[e[3]="RETRY_TIDYUP_SOURCE"]=3,t[e[4]="MOVE_SNACKBAR_TIDYUP_SOURCE"]=4,t[e[5]="UPLOAD_SNACKBAR_TIDYUP_SOURCE"]=5,t[e[6]="DESKTOP_ORGANIZED_HOME_TIDYUP_SOURCE"]=6,t[e[7]="WEB_ORGANIZED_MENU_TIDYUP_SOURCE"]=7,t})(),e})(o.Select_TidyupAutomation||{}),o),i)})),define("metaserver/static/js/dropbox/proto/pap_events/tidyup/undo_tidyup",["require","exports","tslib","protobufjs/minimal","metaserver/static/js/dropbox/proto/pap_events/predefined_event","metaserver/static/js/dropbox/proto/pap_events/event_enums"],(function(e,t,a,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.pap_events=void 0;(s=a.__importStar(s)).Reader,s.Writer,s.util;const r=s.roots.default||(s.roots.default={});var i,o;t.default=r,t.pap_events=r.pap_events=((i=r.pap_events||{}).tidyup=((o=i.tidyup||{}).Undo_Tidyup=(function(e){function e(e){if(e)for(let t=Object.keys(e),a=0;a<t.length;++a)null!=e[t[a]]&&(this[t[a]]=e[t[a]])}return e.prototype.actionSurface="",e.prototype.eventClass=0,e.prototype.eventState=0,e.prototype.numFilesToUndo=0,e.prototype.tidyupUndoType=0,e.create=function(t){return new e(t)},e.getTypeUrl=function(){return"type.googleapis.com/pap_events.tidyup.Undo_Tidyup"},e.EventClass=(function(){const e={},t=Object.create(e);return t[e[0]="TIDYUP"]=0,t})(),e.TidyupUndoType=(function(){const e={},t=Object.create(e);return t[e[0]="UNKNOWN_TIDYUP_UNDO_TYPE"]=0,t[e[1]="PRECISION_TIDYUP_UNDO_TYPE"]=1,t[e[2]="REWIND_TIDYUP_UNDO_TYPE"]=2,t})(),e})(o.Undo_Tidyup||{}),o),i.EventState=(function(){const e={},t=Object.create(e);return t[e[0]="UNKNOWN_EVENT_STATE"]=0,t[e[1]="START"]=1,t[e[2]="SUCCESS"]=2,t[e[3]="FAILED"]=3,t[e[4]="CANCELED"]=4,t})(),i)})),define("metaserver/static/js/clean/ui/fileops_actions",["require","exports","tslib","react","dig-components/typography","typescript/component_libraries/spectrum-sharing/src/utils/sharing_constants","metaserver/static/js/clean/browse_uri_interface","metaserver/static/js/clean/em_string","metaserver/static/js/file_operations/notifications","js/filepath/filepath","metaserver/static/js/clean/ui/async_file_modal_controller","metaserver/static/js/browse/action_logger","metaserver/static/js/browse/api","metaserver/static/js/browse/data/action_creators/index","metaserver/static/js/browse/data/store","metaserver/static/js/browse/models","metaserver/static/js/files_view/file_actions/api_v2","metaserver/static/js/files_view/file_actions/file_from_metadata","metaserver/static/js/files_view/file_actions/rollback","metaserver/static/js/clean/ui/snackbar","metaserver/static/js/sharing/browse_exports","metaserver/static/js/clean/undo","metaserver/static/js/clean/viewer","metaserver/static/js/clean/web_user_action_events","metaserver/static/js/core/i18n","metaserver/static/js/core/notify","metaserver/static/js/core/browser","metaserver/static/js/browse/data/selectors","metaserver/static/js/tidy_up/api_v2","metaserver/static/js/tidy_up/feature_growth"],(function(e,t,a,s,r,i,o,n,l,d,c,u,_,p,m,f,h,S,g,E,T,v,y,A,I,b,O,F,R,M){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getMovePartialSuccessSnackbarText=t.getMoveSuccessSnackbarText=t.showBatchCompletedSnackbar=t.nestedNamespaceSnackbars=t.getBatchUndoHandler=t.moveFiles=t.moveFiles_LEGACY=t.copyFiles_v2=t.copyFiles=void 0,s=a.__importDefault(s),l=a.__importStar(l),d=a.__importStar(d),c=a.__importStar(c),_=a.__importStar(_),p=a.__importStar(p),h=a.__importStar(h),F=a.__importStar(F);const C="view_only_access_error",w="off_team_owner_error",D="owner_only_manage_membership_error",P="team_space_owner_only_manage_membership_error",N="team_space_only_on_team_sharing_error",L="ns_have_mounted_children_ns_error",U="action_nested_shared_folder_ownership_surrender",j="action_move_implicit_share";t.copyFiles=e=>e.useApiV2?Y(e):k(e);const k=e=>{const{files:a,newPath:s,checkFSWs:r,onSuccess:i,onRequestNotSent:o,onUndo:n,user:d,dataApi:u=_}=e;!u.copyFiles({files:a,newPath:s,checkFSWs:r,userId:d.id,onSuccess:({newFiles:r,changesets:o,failureDetails:u})=>{if(u){const a=()=>{(0,t.copyFiles)(Object.assign(Object.assign({},e),{checkFSWs:!1}))};c.showFileSystemWarningsModal({fsws:u,onFinalAccept:a,confirmText:I.intl.formatMessage({id:"r3T3xT",defaultMessage:"Copy"})})}else i&&i(r),l.notifyCopySuccess(a.length,d,o,s,()=>{n&&n()})}})&&o&&o()},x=(e,t)=>a=>s.default.createElement(r.Link,{hasNoUnderline:!0,inverse:!0,href:(0,o.browse_uri_for_fq_path)(e,t).toString()},s.default.createElement("strong",null,a));const B=({entries:e,loggingInfo:t,jobId:a,uid:s})=>{e.forEach(r=>{switch(r[".tag"]){case"failure":(0,u.logFileAction)({uid:s,action:t.failItemLogAction,num_files_selected:e.length,num_folders_selected:0,error_summary:r.failure[".tag"],error:r.failure[".tag"],jobId:a,extra:t.extra});break;case"other":(0,u.logFileAction)({uid:s,action:t.failItemLogAction,num_files_selected:e.length,num_folders_selected:0,error_summary:"other",error:"other",jobId:a,extra:t.extra});break;case"success":(0,u.logFileAction)({uid:s,action:t.successItemLogAction,num_files_selected:e.length,num_folders_selected:0,jobId:a,extra:t.extra,item_id:"file"===r.success[".tag"]||"folder"===r.success[".tag"]?r.success.id:void 0,item_size:"file"===r.success[".tag"]||"folder"===r.success[".tag"]?r.success.size:void 0,item_mime:"file"===r.success[".tag"]?r.success.mime_type:void 0})}})};function Y(e){return a.__awaiter(this,void 0,void 0,(function*(){const{files:a,newPath:s,onError:r,onUndo:i,onSuccess:o,user:n,isLockedVaultFolder:l,isPasteAction:c}=e;if(l)return void E.Snackbar.fail(V,"browse-action");const _=d.filename(s),p=x(n,s),m=c?{sync:e=>I.intl.formatMessage({id:"xegVmx",defaultMessage:"{count, plural, one{Pasting {count} item...} other{Pasting {count} items...}}"},{count:e}),undo:I.intl.formatMessage({id:"xkxhEq",defaultMessage:"Undoing paste..."}),undoFail:I.intl.formatMessage({id:"biijKe",defaultMessage:"Couldnt undo paste."}),undoComplete:I.intl.formatMessage({id:"gevTNB",defaultMessage:"Paste undone."}),failure:e=>I.intl.formatMessage({id:"fJ21+e",defaultMessage:"{count, plural, one{Couldnt paste {count} item.} other{Couldnt paste {count} items.}}"},{count:e}),partialSuccess:(e,t)=>I.intl.formatMessage({id:"o9R5u2",defaultMessage:"{count, plural, one{Pasted {succesfully_copied_files} out of {count} item.} other{Pasted {succesfully_copied_files} out of {count} items.}}"},{count:t,succesfully_copied_files:e}),success:e=>I.intl.formatMessage({id:"TIeF91",defaultMessage:"{count, plural, one{Pasted {count} item.} other{Pasted {count} items.}}"},{count:e})}:(function(e,t){return{sync:e=>I.intl.formatMessage({id:"Xq8RFm",defaultMessage:"{count, plural, one{Copying {count} item...} other{Copying {count} items...}}"},{count:e}),undo:I.intl.formatMessage({id:"X8FnSw",defaultMessage:"Undoing copy..."}),undoFail:I.intl.formatMessage({id:"oYs0zq",defaultMessage:"Couldnt undo copy."}),undoComplete:I.intl.formatMessage({id:"zgCNlD",defaultMessage:"Copy undone."}),failure:a=>I.intl.formatMessage({id:"0OnruC",defaultMessage:"{count, plural, one{Couldnt copy {count} item to <link>{folderName}</link>.} other{Couldnt copy {count} items to <link>{folderName}</link>.}}"},{count:a,folderName:e,link:t}),partialSuccess:(a,s)=>I.intl.formatMessage({id:"QA6Uk4",defaultMessage:"{count, plural, one{Copied {succesfully_copied_files} out of {count} item to <link>{folderName}</link>.} other{Copied {succesfully_copied_files} out of {count} items to <link>{folderName}</link>.}}"},{count:s,succesfully_copied_files:a,folderName:e,link:t}),success:a=>I.intl.formatMessage({id:"c5FpTz",defaultMessage:"{count, plural, one{Copied {count} item to <link>{folderName}</link>.} other{Copied {count} items to <link>{folderName}</link>.}}"},{count:a,folderName:e,link:t})}})(_,p);E.Snackbar.sync(m.sync(a.length),!0,"browse-action"),a.forEach(e=>{(0,u.logFileAction)({uid:n.id,action:A.WebUserActionLogEvent.COPY_ITEM_ATTEMPT,num_files_selected:a.length,num_folders_selected:0})});const f=yield h.copyFiles(a,s,n.id,{checkFSWs:!1}),S={attemptItemLogAction:A.WebUserActionLogEvent.COPY_ITEM_ATTEMPT,failItemLogAction:A.WebUserActionLogEvent.COPY_ITEM_FAIL,successItemLogAction:A.WebUserActionLogEvent.COPY_ITEM_SUCCESS,successLogAction:A.WebUserActionLogEvent.COPY_REQUEST_SUCCESS,failedLogAction:A.WebUserActionLogEvent.COPY_REQUEST_FAIL,undoingLogAction:A.WebUserActionLogEvent.COPY_UNDO,undoFailedLogAction:A.WebUserActionLogEvent.COPY_UNDO_REQUEST_FAIL,undoSuccessLogAction:A.WebUserActionLogEvent.COPY_UNDO_REQUEST_SUCCESS,undoingSnackbarText:m.undo,undoFailedSnackbarText:m.undoFail,undoSuccessSnackbarText:m.undoComplete,getFailureSnackbarText:m.failure,getPartialSuccessSnackbarText:m.partialSuccess,getSuccessSnackbarText:m.success};if(f.isError){E.Snackbar.close("browse-action"),r&&r();const e=()=>{E.Snackbar.fail(S.getFailureSnackbarText(a.length),"browse-action")};return H(n,f.error[".tag"],a,s,e),void(0,u.logFileAction)({uid:n.id,action:S.failedLogAction,num_files_selected:a.length,num_folders_selected:0,error_summary:f.error_summary,error:f.error[".tag"],jobId:f&&f.jobId,extra:S.extra})}const g=f.result.entries.filter(e=>"success"===e[".tag"]),T=g.length,v=a.length-T;B({entries:f.result.entries,loggingInfo:S,jobId:f.jobId,uid:n.id});const y=K(f,n,S,i);if((0,t.showBatchCompletedSnackbar)(a.length,T,v,S,y,{isNestedNamespaceError:f.result.entries.some(G)}),o){o([],q(g,a),T)}X(S.successLogAction,f.result,n.id,f.jobId,a.length,S.extra)}))}t.copyFiles_v2=Y;t.moveFiles_LEGACY=e=>{const{path:a,files:s,newPath:r,checkFSWs:i,onSuccess:o,onRequestNotSent:n,onUndo:d,user:u,dataApi:p=_}=e,m=({newFiles:a,changesets:i,failureDetails:n})=>{if(n){const a=()=>{(0,t.moveFiles_LEGACY)(Object.assign(Object.assign({},e),{checkFSWs:!1}))};c.showFileSystemWarningsModal({fsws:n,onFinalAccept:a,confirmText:I.intl.formatMessage({id:"ds25UH",defaultMessage:"Move"})})}else l.notifyMoveSuccess(s.length,u,i,r,()=>{d&&d()}),o&&o(a)};!p.moveFiles({path:a,files:s,newPath:r,checkFSWs:i,userId:u.id,onSuccess:m,onError:e=>{"This will result in losing ownership of these folders."===e?(b.Notify.clear(),c.showConfirmOwnershipTransferModal(()=>{p.moveFiles({path:a,files:s,newPath:r,userId:u.id,onSuccess:m,allowOwnershipTransfer:!0})})):H(u,e,s,r)},allowOwnershipTransfer:!1})&&n&&n()};const V=I.intl.formatMessage({id:"zYM4td",defaultMessage:"Please unlock your Vault before attempting to add to this folder."}),W=I.intl.formatMessage({id:"p2aC9a",defaultMessage:"Those files already exist in that folder."});const q=(e,t)=>{const a=[];return e.forEach(e=>{if("file"===e.success[".tag"]||"folder"===e.success[".tag"]){const s=e.success,r=t.find(e=>"file_id"in e?e.file_id===s.id:"id"in e&&e.id===s.id);if(r){const e=(0,S.fileFromMetadata)(r,s);a.push(e)}}}),a};function H(e,t,a,r,o){const l=y.Viewer.get_viewer().team_name;let u=!1;"is_cdm_member"in e&&e.is_cdm_member&&d.inSubDirectory(e.cdm_tmf_path,r)&&(u=!0);const _=(function(e,t,a,r,o){const l=I.intl.formatMessage({id:"gVzSq7",defaultMessage:"You dont have permission to move some of these items. Try moving items individually."});let d=null;const c=(e=>0===e.length?"":h.getFilenameFromActionInfo(e[0]))(r);t===w?d=1===r.length?null==a?I.intl.formatMessage({id:"eqzXgU",defaultMessage:"The owner of <strong>{file_name}</strong> is a member of another team."},{file_name:n.Emstring.em_snippet(c,i.SNIPPET_SIZES.FILENAME),strong:e=>s.default.createElement("strong",{style:{fontWeight:500}},e)}):I.intl.formatMessage({id:"F7A+9f",defaultMessage:"The owner of <strong>{file_name}</strong> isnt a member of {team_name}."},{team_name:a,file_name:n.Emstring.em_snippet(c,i.SNIPPET_SIZES.FILENAME),strong:e=>s.default.createElement("strong",{style:{fontWeight:500}},e)}):null==a?I.intl.formatMessage({id:"1mkOQ2",defaultMessage:"The owner of some of these shared folders is a member of another team."}):I.intl.formatMessage({id:"kXptr+",defaultMessage:"The owner of some of these shared folders isnt a member of {team_name}."},{team_name:a}):t===D?d=1===r.length?"is_cdm_member"in e&&e.is_cdm_member&&!o?I.intl.formatMessage({id:"rLKsQF",defaultMessage:"Only the owner of <strong>{file_name}</strong> can move it to the {team_name} team space."},{team_name:a,file_name:n.Emstring.em_snippet(c,i.SNIPPET_SIZES.FILENAME),strong:e=>s.default.createElement("strong",{style:{fontWeight:500}},e)}):I.intl.formatMessage({id:"Xkb8gG",defaultMessage:"Only the owner of <strong>{file_name}</strong> can move it to a team folder."},{file_name:n.Emstring.em_snippet(c,i.SNIPPET_SIZES.FILENAME),strong:e=>s.default.createElement("strong",{style:{fontWeight:500}},e)}):"is_cdm_member"in e&&e.is_cdm_member&&!o?I.intl.formatMessage({id:"Ic3QpQ",defaultMessage:"Only the owner can move some of these folders to the {team_name} team space."},{team_name:a}):I.intl.formatMessage({id:"AGXz3U",defaultMessage:"Only the owner can move some of these folders to a team folder."}):t===C?d=1===r.length?I.intl.formatMessage({id:"4nfaRz",defaultMessage:"You can only view <strong>{file_name}</strong>. Ask an owner or editor of the folder for access to edit it."},{file_name:n.Emstring.em_snippet(c,i.SNIPPET_SIZES.FILENAME),strong:e=>s.default.createElement("strong",{style:{fontWeight:500}},e)}):I.intl.formatMessage({id:"vSscn6",defaultMessage:"You cant edit some of these folders. Ask an owner or editor of the folders for access to edit them."}):t===P||t===N?d=1===r.length?I.intl.formatMessage({id:"xYXgy4",defaultMessage:"If you need to move <strong>{file_name}</strong>, ask your admin to move it for you."},{file_name:n.Emstring.em_snippet(c,i.SNIPPET_SIZES.FILENAME),strong:e=>s.default.createElement("strong",{style:{fontWeight:500}},e)}):l:t===L&&(d=1===r.length?I.intl.formatMessage({id:"sFivS0",defaultMessage:"<strong>{file_name}</strong> has other shared folders inside it. Try moving each shared folder individually."},{file_name:n.Emstring.em_snippet(c,i.SNIPPET_SIZES.FILENAME),strong:e=>s.default.createElement("strong",{style:{fontWeight:500}},e)}):l);return d})(e,t,l,a,u);if(null==_)return void(o&&o());b.Notify.clear();const S=t===P||t===N||t===L,g=(function(e,t,a,s,r){if(t)return 1===s?I.intl.formatMessage({id:"MHxxzk",defaultMessage:"Cant move out of the team space"}):I.intl.formatMessage({id:"XJI7dZ",defaultMessage:"Cant move {num_of_files} items"},{num_of_files:s});return"is_cdm_member"in e&&e.is_cdm_member&&!r?I.intl.formatMessage({id:"S+fFwb",defaultMessage:"{count, plural, one{Cant move shared folder to the {team_name} team space} other{Cant move shared folders to the {team_name} team space}}"},{count:s,team_name:n.Emstring.em_snippet(a,i.SNIPPET_SIZES.DISPLAY_NAME)}):I.intl.formatMessage({id:"thmzHN",defaultMessage:"{count, plural, one{Cant move shared folder to a team folder} other{Cant move shared folders to a team folder}}"},{count:s})})(e,S,l,a.length,u);let E="";E=S?"/help/business/team-space-overview#moveout":"/help/business/team-space-overview#movein";const v=1===a.length,A=a[0]instanceof f.File&&v&&!S?I.intl.formatMessage({id:"tHNeW4",defaultMessage:"See owner"}):void 0;c.showMoveErrorModal({title:g,content:_,learnMoreLink:E,buttonString:A,onClick:()=>{a[0]instanceof f.File&&(0,T.asyncShowShareModal)(e.id,a[0],{origin:i.SHARE_ACTION_ORIGIN_TYPE.BROWSE_FILE_ACTIONS},({path:e,qargs:t})=>(0,m.getStoreForBrowse)().dispatch(p.setUrl({path:e,qargs:t})))}})}function G(e){return"failure"===e[".tag"]&&"relocation_error"===e.failure[".tag"]&&"cant_nest_shared_folder"===e.failure.relocation_error[".tag"]}function K(e,t,s,r){return!e.isError&&e.result.changeset_data&&e.result.changeset_data.length>0?()=>a.__awaiter(this,void 0,void 0,(function*(){E.Snackbar.close("browse-action"),(0,u.logFileAction)({uid:t.id,action:s.undoingLogAction,num_files_selected:e.result.entries.length,num_folders_selected:0,extra:s.extra}),(0,g.rollback)({changeset_data:e.result.changeset_data,userId:t.id,onSuccess:()=>{E.Snackbar.complete(s.undoSuccessSnackbarText,"browse-action"),(0,u.logFileAction)({uid:t.id,action:s.undoSuccessLogAction,num_files_selected:e.result.entries.length,num_folders_selected:0}),r&&r(!0)}})})):void 0}function z(){(0,O.open_tab)("https://help.dropbox.com/files-folders/share/shared-folder-differences#move_shared_folder")}t.moveFiles=function e(s){var r,i;return a.__awaiter(this,void 0,void 0,(function*(){const{path:a,files:o,newPath:n,onError:l,onUndo:_,onSuccess:p,user:f,dataApiV2:S=h,checkFSWs:g,isLockedVaultFolder:T,extra:v,fswIDs:y=[]}=s;if(T)return void E.Snackbar.fail(V,"browse-action");if(d.paths_are_equal(a,n))return void E.Snackbar.fail(W,"browse-action");const b=(function(e,t,a){return{sync:e=>I.intl.formatMessage({id:"IE0PNM",defaultMessage:"{count, plural, one{Moving {count} item...} other{Moving {count} items...}}"},{count:e}),undo:I.intl.formatMessage({id:"XkY9GW",defaultMessage:"Undoing move..."}),undoFail:I.intl.formatMessage({id:"htZAqt",defaultMessage:"Couldnt undo move."}),undoComplete:I.intl.formatMessage({id:"rrCngs",defaultMessage:"Move undone."}),failure:(a,{isNestedNamespaceError:s}={})=>s?I.intl.formatMessage({id:"U2agKj",defaultMessage:"{count, plural, one{Couldnt move {count} item to <link>{folderName}</link>.} other{Couldnt move {count} items to <link>{folderName}</link>.}} Shared folders cant be moved to other shared folders."},{count:a,folderName:e,link:t}):I.intl.formatMessage({id:"aWWTan",defaultMessage:"{count, plural, one{Couldnt move {count} item to <link>{folderName}</link>.} other{Couldnt move {count} items to <link>{folderName}</link>.}}"},{count:a,folderName:e,link:t}),success:s=>Q({folderLinkCta:t,folderName:e,fswIDs:a,successActions:s}),partialSuccess:(s,r,{isNestedNamespaceError:i}={})=>Z({folderLinkCta:t,folderName:e,fswIDs:a,isNestedNamespaceError:i,successActions:s,totalActions:r})}})(d.filename(n),x(f,n),y);E.Snackbar.sync(b.sync(o.length),!0,"browse-action"),o.forEach(e=>{(0,u.logFileAction)({uid:f.id,action:A.WebUserActionLogEvent.MOVE_ITEM_ATTEMPT,num_files_selected:o.length,num_folders_selected:0})});const O=yield S.moveFiles(o,n,f.id,{allowOwnershipTransfer:y.includes(U),checkFSWs:g}),C={attemptItemLogAction:A.WebUserActionLogEvent.MOVE_ITEM_ATTEMPT,failItemLogAction:A.WebUserActionLogEvent.MOVE_ITEM_FAIL,successItemLogAction:A.WebUserActionLogEvent.MOVE_ITEM_SUCCESS,successLogAction:A.WebUserActionLogEvent.MOVE_REQUEST_SUCCESS,failedLogAction:A.WebUserActionLogEvent.MOVE_REQUEST_FAIL,undoingLogAction:A.WebUserActionLogEvent.MOVE_UNDO,undoFailedLogAction:A.WebUserActionLogEvent.MOVE_UNDO_REQUEST_FAIL,undoSuccessLogAction:A.WebUserActionLogEvent.MOVE_UNDO_REQUEST_SUCCESS,undoingSnackbarText:b.undo,undoFailedSnackbarText:b.undoFail,getPartialSuccessSnackbarText:b.partialSuccess,getSuccessSnackbarText:b.success,undoSuccessSnackbarText:b.undoComplete,getFailureSnackbarText:b.failure,extra:v};if(O.isError){if(E.Snackbar.close("browse-action"),l&&l(O),"to"===O.error[".tag"]&&"file_system_warnings"===O.error.to[".tag"]){const t=(null===(i=null===(r=O.error.to)||void 0===r?void 0:r.details)||void 0===i?void 0:i.map(({id:e})=>e))||[],a=()=>e(Object.assign(Object.assign({},s),{checkFSWs:!1,fswIDs:t}));return void c.showFileSystemWarningsModal({fsws:O.error.to.details,onFinalAccept:a,confirmText:I.intl.formatMessage({id:"ds25UH",defaultMessage:"Move"})})}const t=()=>{E.Snackbar.fail(C.getFailureSnackbarText(o.length),"browse-action")};return H(f,O.error[".tag"],o,n,t),void(0,u.logFileAction)({uid:f.id,action:C.failedLogAction,num_files_selected:o.length,num_folders_selected:0,error_summary:O.error_summary,error:O.error[".tag"],jobId:O&&O.jobId,extra:C.extra})}B({entries:O.result.entries,loggingInfo:C,jobId:O.jobId,uid:f.id});const w=O.result.entries.filter(e=>"success"===e[".tag"]),D=w.length,P=o.length-D,N=K(O,f,C,_);if((0,t.showBatchCompletedSnackbar)(o.length,D,P,C,N,{isNestedNamespaceError:O.result.entries.some(G)}),p){p([],q(w,o),D)}if(X(C.successLogAction,O.result,f.id,O.jobId,o.length,v),0===P&&D>0){const e=(0,m.getStoreForBrowse)().getState(),t=F.postTTIExperiments(e);if(t.expTidyMoveFeatureGrowth){n.substring(0,n.lastIndexOf("/"))===s.path&&(0,R.shouldShowMoveSnackbar)(f.id,n,D).then(a=>{if(a.should_show){const r=t.expTidyUpReengagement?a.snackbar_type:void 0;setTimeout(()=>{(0,M.showTidyUpMoveSnackbar)(s.path,f.id,F.context(e).currentNSID,r)},5e3)}})}}}))},t.getBatchUndoHandler=K,t.nestedNamespaceSnackbars={showPartialSuccess:(e,t)=>t?((0,v.setHandleUndo)(t),E.Snackbar.show(s.default.createElement(E.Snackbar,{title:e,variant:"complete",actionButtonText:I.intl.formatMessage({id:"OfxyEk",defaultMessage:"Undo"}),onActionClick:t,closeButtonText:I.intl.formatMessage({id:"N4y79U",defaultMessage:"Learn More"}),onCloseClick:z,timeoutDelayMs:5e3,id:"browse-action"}))):E.Snackbar.show(s.default.createElement(E.Snackbar,{closeButtonText:I.intl.formatMessage({id:"u/p3Pl",defaultMessage:"Close"}),actionButtonText:I.intl.formatMessage({id:"N4y79U",defaultMessage:"Learn More"}),onActionClick:z,timeoutDelayMs:5e3,title:e,variant:"complete",id:"browse-action"})),showFailure:e=>E.Snackbar.show(s.default.createElement(E.Snackbar,{closeButtonText:I.intl.formatMessage({id:"u/p3Pl",defaultMessage:"Close"}),actionButtonText:I.intl.formatMessage({id:"N4y79U",defaultMessage:"Learn More"}),onActionClick:z,timeoutDelayMs:5e3,title:e,variant:"fail",id:"browse-action"}))};function X(e,t,a,s,r,i){let o=r,n=0,l=void 0;const d=t.entries.filter(e=>"success"===e[".tag"]);d&&(o=d.filter(e=>"file"===e.success[".tag"]).length,n=d.filter(e=>"folder"===e.success[".tag"]).length);const c=t.entries.filter(e=>"failure"===e[".tag"]);c&&c.length>0&&(l=c[0].failure[".tag"]),(0,u.logFileAction)({uid:a,action:e,num_files_selected:o,num_folders_selected:n,jobId:s,error_summary:l,extra:i})}function Q({folderLinkCta:e,folderName:t,fswIDs:a,successActions:s}){return(null==a?void 0:a.includes(j))?I.intl.formatMessage({id:"P6vPej",defaultMessage:"{count, plural, one{{count} item moved and can now be accessed by everyone with access to {folderName}.} other{{count} items moved and can now be accessed by everyone with access to {folderName}.}}"},{count:s,folderName:t,link:e}):I.intl.formatMessage({id:"315R6Z",defaultMessage:"{count, plural, one{Moved {count} item to <link>{folderName}</link>.} other{Moved {count} items to <link>{folderName}</link>.}}"},{count:s,folderName:t,link:e})}function Z({folderLinkCta:e,folderName:t,fswIDs:a,isNestedNamespaceError:s,successActions:r,totalActions:i}){return(null==a?void 0:a.includes("action_move_implicit_share"))?I.intl.formatMessage({id:"FrPyCz",defaultMessage:"{successActions} of {totalActions} items moved and can now be accessed by everyone with access to {folderName}."},{successActions:r,totalActions:i,folderName:t,link:e}):s?I.intl.formatMessage({id:"v6wzJx",defaultMessage:"{count, plural, one{Moved {succesfully_moved_files} out of {count} item to <link>{folderName}</link>.} other{Moved {succesfully_moved_files} out of {count} items to <link>{folderName}</link>.}} Shared folders cant be moved to other shared folders."},{count:i,succesfully_moved_files:r,folderName:t,link:e}):I.intl.formatMessage({id:"VgRH6k",defaultMessage:"{count, plural, one{Moved {succesfully_moved_files} out of {count} item to <link>{folderName}</link>.} other{Moved {succesfully_moved_files} out of {count} items to <link>{folderName}</link>.}}"},{count:i,succesfully_moved_files:r,folderName:t,link:e})}t.showBatchCompletedSnackbar=(e,a,s,r,i,o={})=>{if(a>0&&s>0){const s=r.getPartialSuccessSnackbarText(a,e,o);o.isNestedNamespaceError?t.nestedNamespaceSnackbars.showPartialSuccess(s,i):i?((0,v.setHandleUndo)(i),E.Snackbar.completeWithUndo(s,i,"browse-action")):E.Snackbar.complete(s,"browse-action")}else if(a>0){const e=r.getSuccessSnackbarText(a);i?((0,v.setHandleUndo)(i),E.Snackbar.completeWithUndo(e,i,"browse-action")):E.Snackbar.complete(e,"browse-action")}else{const e=r.getFailureSnackbarText(s,o);o.isNestedNamespaceError?t.nestedNamespaceSnackbars.showFailure(e):E.Snackbar.fail(e,"browse-action")}},t.getMoveSuccessSnackbarText=Q,t.getMovePartialSuccessSnackbarText=Z})),define("metaserver/static/js/file_actions/create-folder",["require","exports","tslib","metaserver/static/js/file_actions/metrics","metaserver/static/js/file_actions/strings","metaserver/static/js/metrics/index","metaserver/static/js/clean/ui/async_file_modal_controller","metaserver/static/js/browse/action_logger","metaserver/static/js/files_view/file_actions/api_v2","metaserver/static/js/clean/ui/snackbar","metaserver/static/js/clean/web_user_action_events","metaserver/static/js/core/i18n","metaserver/static/js/user_survey/user_survey"],(function(e,t,a,s,r,i,o,n,l,d,c,u,_){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.logCreateFolderSuccess=t.logCreateFolderPending=t.logCreateFolderCancel=t.logCreateFolderError=t.logCreateFolder=t.createFolder=void 0,o=a.__importStar(o),l=a.__importStar(l);function p(e,t,a){(0,n.logWebUserAction)({event_name:c.WebUserActionLogEvent.CREATE_FOLDER_ERROR,extra:{error_summary:e||null,error:t||null,origin:a||null}})}function m(e){(0,n.logWebUserAction)({event_name:c.WebUserActionLogEvent.CREATE_FOLDER_CANCEL,extra:{origin:e||null}})}function f(e){(0,n.logWebUserAction)({event_name:c.WebUserActionLogEvent.CREATE_FOLDER_PENDING,extra:{origin:e||null}})}function h(e){(0,n.logWebUserAction)({event_name:c.WebUserActionLogEvent.CREATE_FOLDER_SUCCESS,extra:{origin:e||null}}),_.UserSurvey.trackEvent("create_item","browse")}t.createFolder=({user:e,name:n,destination:c,checkFsw:_,origin:S,surface:g})=>a.__awaiter(void 0,void 0,void 0,(function*(){const E=(0,i.getMetricsReporter)(),T={surface:g},v={latency:E.createTimer({ns:s.FILE_ACTIONS_AMP_NAMESPACE,name:"create-folder/latency_ms"},T),completed:E.createStats({ns:s.FILE_ACTIONS_AMP_NAMESPACE,name:"create-folder/completed"},T)};f(S),d.Snackbar.sync(u.intl.formatMessage(r.createFolderSnackbarProgress),!1,"browse-action");const y=yield l.createFolder(c,n,e,_);if(y.isError&&"path"===y.error[".tag"]&&"file_system_warnings"===y.error.path[".tag"]){return d.Snackbar.close("browse-action"),(yield(function(e){return a.__awaiter(this,void 0,void 0,(function*(){return new Promise(t=>{o.showFileSystemWarningsModal({fsws:e,onFinalAccept:()=>{t(!0)},onAbortAction:()=>{t(!1)},confirmText:u.intl.formatMessage(r.createFolderFswConfirmText)})})}))})(y.error.path.details))?yield(0,t.createFolder)({user:e,name:n,destination:c,checkFsw:!1,origin:S,surface:g}):(m(S),{type:"cancel"})}return v.latency.record(),y.isError?("path"===y.error[".tag"]&&"malformed_path"===y.error.path[".tag"]?(d.Snackbar.fail(u.intl.formatMessage(r.createFolderErrorMalformedPath),"browse-action"),v.completed.record(1)):(d.Snackbar.fail(u.intl.formatMessage(r.createFolderErrorGeneric),"browse-action"),v.completed.record(0)),p(y.error_summary,y.error[".tag"],S),{type:"error",summary:y.error_summary,error:y.error[".tag"]}):(d.Snackbar.complete(u.intl.formatMessage(r.createFolderSnackbarSuccess),"browse-action",void 0),h(S),v.completed.record(1),{type:"success",folder:y.result.metadata})})),t.logCreateFolder=function({uid:e,view_type:t,origin:a,source:s}){(0,n.logWebUserAction)({user_id:e,event_name:c.WebUserActionLogEvent.CREATE_FOLDER,view_type:t||null,extra:Object.assign({origin:a},s&&{source:s})})},t.logCreateFolderError=p,t.logCreateFolderCancel=m,t.logCreateFolderPending=f,t.logCreateFolderSuccess=h})),define("metaserver/static/js/flows/utils/async_modal_launchers",["require","exports","tslib","react","react-intl","react-redux","metaserver/static/js/core/i18n","metaserver/static/js/components/ui/modal","metaserver/static/js/browse/data/store"],(function(e,t,a,s,r,i,o,n,l){"use strict";function d(e,t){n.Modal.showInstance(s.default.createElement(i.Provider,{store:(0,l.getStoreForBrowse)()},s.default.createElement(r.RawIntlProvider,{value:o.intl},s.default.createElement(e,Object.assign({},t)))))}Object.defineProperty(t,"__esModule",{value:!0}),t.asyncLaunchWorkflowBuilder=t.asyncLaunchAddOrEditAutoFolderModal=t.asyncLaunchUnifiedAutomationEditModal=t.asyncLaunchUnifiedAutomationAddModal=t.asyncLaunchUnifiedAutomationCreateModal=t.showModalInstance=void 0,s=a.__importDefault(s),t.showModalInstance=d,t.asyncLaunchUnifiedAutomationCreateModal=function(t,s){new Promise((t,a)=>{e(["metaserver/static/js/flows/components/modals/browse_adapter"],t,a)}).then(a.__importStar).then(({BrowseCreateAutoFolderModal:e})=>{const a={parentFqPath:t,surface:"browse",user:s};d(e,Object.assign(Object.assign({},a),{onRetry:function(){d(e,Object.assign(Object.assign({},a),{entryPoint:"error_snackbar"}))}}))})},t.asyncLaunchUnifiedAutomationAddModal=function(t,s,r,i,o,n,l,c,u){new Promise((t,a)=>{e(["metaserver/static/js/flows/components/modals/browse_adapter"],t,a)}).then(a.__importStar).then(({BrowseAddAutoFolderModal:e})=>{const a={automation:o,actionData:n,currentFqPath:t,entryPoint:c,folderFqPath:s,initialScreen:l,nsId:i,user:r,source:u};d(e,Object.assign(Object.assign({},a),{onRetry:function(){d(e,Object.assign(Object.assign({},a),{entryPoint:"error_snackbar"}))}}))})},t.asyncLaunchUnifiedAutomationEditModal=function(t,s,r,i){return a.__awaiter(this,void 0,void 0,(function*(){const{getFolderRuleForFqPath:o,BrowseEditAutoFolderModal:n}=yield new Promise((t,a)=>{e(["metaserver/static/js/flows/components/modals/browse_adapter"],t,a)}).then(a.__importStar),l=yield o(t);if(null!=(null==l?void 0:l.folderRule)&&null!=(null==l?void 0:l.actionTag)){const e={folderRule:l.folderRule,fqPath:t,user:s,nsId:r,entryPoint:i};d(n,Object.assign(Object.assign({},e),{onRetry:function(){d(n,Object.assign(Object.assign({},e),{entryPoint:"error_snackbar"}))}}))}}))},t.asyncLaunchAddOrEditAutoFolderModal=function({fqPath:t,nsId:s,user:r,entryPoint:i,source:o}){return a.__awaiter(this,void 0,void 0,(function*(){const{getFolderRuleForFqPath:n,BrowseAddAutoFolderModal:l,BrowseEditAutoFolderModal:c}=yield new Promise((t,a)=>{e(["metaserver/static/js/flows/components/modals/browse_adapter"],t,a)}).then(a.__importStar),u=yield n(t);if(null!=(null==u?void 0:u.folderRule)&&null!=(null==u?void 0:u.actionTag)){const{folderRule:e,actionTag:a}=u,o={automation:a,entryPoint:i,folderRule:e,fqPath:t,nsId:s,user:r};function _(){d(c,Object.assign(Object.assign({},o),{entryPoint:"error_snackbar"}))}d(c,Object.assign(Object.assign({},o),{onRetry:_}))}else{const e={currentFqPath:t,entryPoint:i,folderFqPath:t,nsId:s,user:r,source:o};function _(){d(l,Object.assign(Object.assign({},e),{entryPoint:"error_snackbar"}))}d(l,Object.assign(Object.assign({},e),{onRetry:_}))}}))},t.asyncLaunchWorkflowBuilder=function({operation:t,folderFqPath:s,parentFqPath:r,surface:i,entryPoint:o}){return a.__awaiter(this,void 0,void 0,(function*(){const{WorkflowBuilderComponent:n}=yield new Promise((t,a)=>{e(["metaserver/static/js/flows/workflow_builder/workflow_builder"],t,a)}).then(a.__importStar);d(n,{operation:t,folderFqPath:s,parentFqPath:r,surface:i,entryPoint:o})}))}})),define("metaserver/static/js/folder_dialog/move_dialog",["require","exports","tslib","lodash","react","dig-components/buttons","dig-components/modal","dig-components/typography","spectrum/button/index","spectrum/dimensions/index","js/filepath/filepath","metaserver/static/js/logging/hive/schemas/web-modal-activity","metaserver/static/js/browse/actions","metaserver/static/js/browse/constants","metaserver/static/js/components/ui/css","metaserver/static/js/folder_dialog/constants","metaserver/static/js/folder_dialog/folder_picker_dig","metaserver/static/js/folder_dialog/utils","metaserver/static/js/sharing/browse_exports","metaserver/static/js/clean/viewer","metaserver/static/js/core/i18n","metaserver/static/js/dropins_v3/shared/search_input","metaserver/static/js/dropins_v3/shared/culled_list","metaserver/static/js/dropins_v3/shared/item_row","metaserver/static/js/dropins_v3/file_browser/loading"],(function(e,t,a,s,r,i,o,n,l,d,c,u,_,p,m,f,h,S,g,E,T,v,y,A,I){"use strict";var b;Object.defineProperty(t,"__esModule",{value:!0}),t.MoveDialog=t.MoveDialogComponent=t.MoverUiState=void 0,s=a.__importStar(s),r=a.__importDefault(r),(function(e){e[e.Browse=1]="Browse",e[e.Search=2]="Search",e[e.SearchLoading=3]="SearchLoading"})(b=t.MoverUiState||(t.MoverUiState={}));class O extends r.default.Component{constructor(e){super(e),this.handleSuccess=()=>{const e=this.state.selectedPath,t=this.state.containedNsID,a=this.state.selectedPredictionId;if(this.isPrimaryButtonDisabled())return;const{onSuccess:s,apiClient:r,onError:i,onPrimaryButtonClick:o}=this.props;o(e,a),r.moveToFolder(e,t,this.state.isLockedVaultFolder).then(s,i)},this.handleCancelClick=()=>{const{onCancel:e,onSecondaryButtonClick:t}=this.props;t(),e()},this.handleFolderSelected=(e,t,a,s,r)=>{const{onFolderSelected:i}=this.props;i&&i(e,!!r),this.setState({selectedPath:e,containedNsID:t,selectedPredictionId:a,isLockedVaultFolder:s})},this.shouldShowFolderSuggestion=()=>{const{apiClient:e,entries:t,operation:a,showFolderSuggestion:s}=this.props;return!!s&&!!e.getFolderSuggestion&&(a===f.Operation.COPY||a===f.Operation.MOVE)&&!!t&&t.length>0},this.fetchFolderSuggestion=e=>a.__awaiter(this,void 0,void 0,(function*(){const{apiClient:t,entries:a,operation:s}=this.props,r=a.map(e=>e.fq_path),i=s===f.Operation.MOVE?"MOVE":"COPY";return yield t.getFolderSuggestion(e,r,i)})),this.handleCreateNewFolderClick=()=>{const{selectedPath:e}=this.state;if(void 0===e)return;this.handleCancelClick();const t=this.props.user,a=e=>{this.showMoveDialog(e)},s=()=>{this.showMoveDialog(e)};(0,g.asyncShowCdmNewFolderModal)({handleCreateFolder:({folderName:r})=>{_.browseActions.createFolderInNewFolderModal({folderName:r,isConfidential:!1,user:t,context:null,redirectOnSuccess:a,redirectOnCancel:s,fqPath:e,selectCreatedFolder:!1,origin:p.CREATE_FOLDER_ACTION_ORIGIN_TYPE.BROWSE_MOVE_DIALOG})},user:t,context:null,shouldSyncDefault:!1,shouldDisplaySyncSettings:!1,shouldDisplayAudienceInput:!1,redirectOnCancel:s})},this.showMoveDialog=e=>{const{operation:t,entries:a,showMoveDialogOnRedirect:s}=this.props;s&&s(Object.assign(Object.assign({},this.props),{modalName:t===f.Operation.MOVE?u.ModalName.MOVE:u.ModalName.COPY,entries:a,initialFolderSelectionOnRedirect:e}))},this.isPrimaryButtonDisabled=()=>{if(void 0===this.state.selectedPath)return!0;if(this.props.operation!==f.Operation.MOVE)return!1;return!!s.filter(this.props.entries,e=>"fq_path"in e&&(!(!e.is_dir||this.props.operation!==f.Operation.MOVE||!(0,c.paths_are_equal)(e.fq_path,this.state.selectedPath))||(0,c.paths_are_equal)((0,c.parent_dir)(e.fq_path),this.state.selectedPath))).length},this.handleSearchQueryChange=s.debounce(e=>{""===e?this.setState({moverUiState:b.Browse,searchText:e,selectedSearchResult:""}):(this.setState({moverUiState:b.SearchLoading,searchText:e}),this.props.apiClient.search(this.props.user.id,e).then(e=>{this.setState({moverUiState:b.Search,searchResults:e.file_info})}))},1e3),this.renderSearchResultItem=e=>{const t=this.state.selectedSearchResult===e.fq_path,a=!!e.mount_access_perms&&0===e.mount_access_perms.length;return r.default.createElement("li",{key:e.fq_path,className:"dropins-mover-files-list-item"},r.default.createElement(A.ItemRow,{item:e,selected:t,disabled:a,showPath:!0,onClick:this.handleSearchResultSelected(e)}))},this.state={moverUiState:b.Browse,searchText:"",searchResults:[],selectedSearchResult:""}}handleSearchResultSelected(e){return()=>{this.setState({moverUiState:b.Browse,selectedSearchResult:e.fq_path})}}renderContent(){const{user:e,initialFolderSelection:t,webTimer:a,apiClient:s,onError:i,onDataLoaded:o,onBreadcrumbClicked:n,onRowClicked:l,onFetchFolderSuggestionSuccess:d,onFolderSuggestionClick:c,onFolderSuggestionLocationClick:u}=this.props,{moverUiState:_}=this.state,p=Object.assign(Object.assign({},s),{fetchFolderSuggestion:this.shouldShowFolderSuggestion()?this.fetchFolderSuggestion:void 0});return _===b.SearchLoading?r.default.createElement("div",{className:"dropins-mover-content"},r.default.createElement("div",{className:"dropins-mover-loading-container"},r.default.createElement(I.Loading,null))):_===b.Search?r.default.createElement(y.CulledList,{containerClassName:"dropins-mover-content",className:"dropins-mover-files-list",items:this.state.searchResults,listItemHeights:this.state.searchResults.map(()=>60),renderRow:this.renderSearchResultItem,webTimer:a}):r.default.createElement(h.FolderPicker,{user:e,apiClient:p,webTimer:a,initialPath:this.state.selectedSearchResult||t,rootName:E.Viewer.get_role_title(e)||T.intl.formatMessage({id:"rIir19",defaultMessage:"Dropbox"}),canSelectReadonly:!1,onFolderSelected:this.handleFolderSelected,onSuccess:this.handleSuccess,onError:i,showFolderSuggestion:this.shouldShowFolderSuggestion(),onFetchFolderSuggestionSuccess:d,onFolderSuggestionClick:c,onFolderSuggestionLocationClick:u,onDataLoaded:o,onBreadcrumbClicked:n,onRowClicked:l})}render(){const{apiClient:e,entries:t,operation:a,modalTitle:s,createNewFolderInMoveDialog:c,showFoldersOnly:u,useDigModal:_,showSearchBar:p,primaryButtonText:m}=this.props,{selectedPath:h}=this.state;if(_)return r.default.createElement(r.default.Fragment,null,!u&&r.default.createElement(o.Modal.Header,{hasBottomSpacing:"title-small"},r.default.createElement(n.Title,{size:"small"},(0,S.createFolderPickerDialogTitle)(t,a,s))),r.default.createElement(o.Modal.Body,{className:"folder-picker-container__fixed-height uxa-modal",id:this.props.modalId},this.renderContent()),!u&&r.default.createElement(o.Modal.Footer,null,c&&void 0!==h?r.default.createElement(i.Button,{onClick:this.handleCreateNewFolderClick,variant:"transparent",size:"small",id:"create-new-folder"},T.intl.formatMessage({id:"eXL9sz",defaultMessage:"Create new folder"})):null,r.default.createElement(i.Button,{variant:"opacity",onClick:this.handleCancelClick},T.intl.formatMessage({id:"d9/SE1",defaultMessage:"Cancel"})),r.default.createElement(i.Button,{variant:"primary",onClick:this.handleSuccess,disabled:this.isPrimaryButtonDisabled()},(0,S.createFolderPickerDialogButtonLabel)(a,m))));const g=r.default.createElement("div",{id:"move_dialog-header",key:"header",className:"move_dialog-header mc-util-modal-header"},(0,S.createFolderPickerDialogTitle)(t,a,s)),E=r.default.createElement("div",{key:"footer",className:"move_dialog-actions mc-util-modal-actions"},c&&void 0!==h?r.default.createElement("div",null,r.default.createElement("a",{role:"button",href:"#",onClick:this.handleCreateNewFolderClick,id:"create-new-folder"},T.intl.formatMessage({id:"eXL9sz",defaultMessage:"Create new folder"}))):r.default.createElement("div",null),r.default.createElement("div",{className:"mc-util-modal-actions-buttons"},r.default.createElement(l.Button,{variant:"secondary",onClick:this.handleCancelClick},T.intl.formatMessage({id:"d9/SE1",defaultMessage:"Cancel"})),r.default.createElement(l.Button,{variant:"primary",onClick:this.handleSuccess,disabled:this.isPrimaryButtonDisabled()},(0,S.createFolderPickerDialogButtonLabel)(a,m))));return r.default.createElement(d.Dimensions,{className:"move_dialog mc-util-modal"},({height:t})=>[u?null:g,p&&e.search?r.default.createElement("div",{key:"search-input",className:"dropins-mover-search-input-container"},r.default.createElement(v.SearchInput,{onQueryChange:this.handleSearchQueryChange})):null,t&&r.default.createElement("div",{key:"body",className:"move_dialog-body mc-util-modal-body",style:{height:t-(f.DIALOG_HEAD_HEIGHT+f.DIALOG_ACTIONS_HEIGHT+f.DIALOG_BODY_PADDING)}},this.renderContent()),u?null:E])}}t.MoveDialogComponent=O,O.defaultProps={onPrimaryButtonClick:s.noop,onSecondaryButtonClick:s.noop,onError:s.noop,showFoldersOnly:!1,showSearchBar:!1},O.displayName="MoveDialogComponent",t.MoveDialog=(0,m.requireCssWithComponent)(O,["/static/metaserver/static/css/react/move_dialog-vflt84lSc.css"])})),define("metaserver/static/js/folder_dialog/utils",["require","exports","metaserver/static/js/core/i18n","metaserver/static/js/folder_dialog/constants","js/filepath/filepath"],(function(e,t,a,s,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getInitialFolderSelection=t.getModalId=t.createFolderPickerDialogButtonLabel=t.createFolderPickerDialogTitle=void 0,t.createFolderPickerDialogTitle=function(e,t,r){if(void 0!==r)return r;if(!e||0===e.length){if(t===s.Operation.MOVE)return a.intl.formatMessage({id:"wKPvYZ",defaultMessage:"Move to"});if(t===s.Operation.COPY)return a.intl.formatMessage({id:"TCTlqi",defaultMessage:"Copy to"});if(t===s.Operation.UPLOAD)return a.intl.formatMessage({id:"dMKLu2",defaultMessage:"Upload to"});if(t===s.Operation.EXPORT_LEGAL_HOLD)return a.intl.formatMessage({id:"ra1icr",defaultMessage:"Export to"})}let i="";const o=e?e.length:0;return t===s.Operation.MOVE?i=a.intl.formatMessage({id:"qeRA7T",defaultMessage:"{count, plural, one{Move {count} item to} other{Move {count} items to}}"},{count:o}):t===s.Operation.COPY?i=a.intl.formatMessage({id:"N4rDe0",defaultMessage:"{count, plural, one{Copy {count} item to} other{Copy {count} items to}}"},{count:o}):t===s.Operation.UPLOAD&&(i=a.intl.formatMessage({id:"bWKJBF",defaultMessage:"{count, plural, one{Upload {count} item to} other{Upload {count} items to}}"},{count:o})),i},t.createFolderPickerDialogButtonLabel=function(e,t){return void 0!==t?t:e===s.Operation.COPY?a.intl.formatMessage({id:"r3T3xT",defaultMessage:"Copy"}):e===s.Operation.EXPORT_LEGAL_HOLD?a.intl.formatMessage({id:"8+T625",defaultMessage:"Export"}):a.intl.formatMessage({id:"ds25UH",defaultMessage:"Move"})},t.getModalId=function(e){switch(e){case s.Operation.MOVE:return"move-fileops-modal";case s.Operation.COPY:return"copy-fileops-modal";case s.Operation.UPLOAD:return"upload-fileops-modal";default:return""}},t.getInitialFolderSelection=function(e,t,a){if(void 0!==a)return a;if(e&&0!==e.length){const a=(0,r.parent_dir)(e[0].fq_path),s=e.length;for(let i=1;i<s;i++)if(a!==(0,r.parent_dir)(e[i].fq_path))return t;return a}return t}})),define("metaserver/static/js/folder_overview/api",["require","exports","metaserver/static/js/api_v2/types","metaserver/static/js/api_v2/user_client"],(function(e,t,a,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getUserAccount=t.isFormatVersionError=t.isConflictError=t.getLoggingFileId=t.getSharedFolderPath=t.getFolderAccess=t.addContentReferencesToPath=t.addContentReferences=t.removeContentReferences=t.getContentReferences=t.setDescription=t.getDescription=void 0;const r=new s.UserApiV2Client;class i extends s.UserApiV2Client{constructor(e,t){super(t),this.user=e}_headers(e){return this.user.is_cdm_member&&this.user.is_team_admin&&this.user.team_member_id?Object.assign({[a.ApiV2HeaderNames.DropboxApiSelectAdmin]:this.user.team_member_id},super._headers(e)):super._headers(e)}}t.getDescription=(e,t)=>r.ns("files").rpc("get_description_batch",{file_ids:[t]},{subjectUserId:e}).then(e=>{if(!e||!e.items||1!==e.items.length)throw new Error("Unexpected response from get_description_batch");return e.items[0]});t.setDescription=(e,t,a,s,r)=>new i(e).ns("files").rpc("set_description",{file_id:t,current_revision_id:a,text:s,format_version:r},{subjectUserId:e.id});t.getContentReferences=(e,t)=>r.ns("files").rpc("get_content_references_info",{file_id:t},{subjectUserId:e});t.removeContentReferences=(e,t,a)=>r.ns("files").rpc("remove_content_references",{anchor_file_id:t,return_roots_as_ns_ids:!0,file_ids:a},{subjectUserId:e});t.addContentReferences=(e,t,a)=>r.ns("files").rpc("add_content_references",{anchor_file_id:t,return_roots_as_ns_ids:!0,file_ids:a},{subjectUserId:e});t.addContentReferencesToPath=(e,t,a)=>r.ns("files").rpc("add_content_references_to_path",{path:t,return_roots_as_ns_ids:!0,file_ids:a},{subjectUserId:e});t.getFolderAccess=({userId:e,sharedFolderId:t,accountId:a,accountEmail:s})=>r.ns("files").rpc("has_folder_access",{shared_folder_id:t,account_id:a,account_email:s},{subjectUserId:e});t.getSharedFolderPath=({userId:e,sharedFolderId:t})=>r.ns("files").rpc("get_metadata",{path:`ns:${t}`},{subjectUserId:e}).then(e=>e.is_shareable?e.path_display:void 0);t.getLoggingFileId=({userId:e,path:t})=>r.ns("files").rpc("get_metadata",{path:t},{subjectUserId:e}).then(e=>e.id);t.isConflictError=e=>e.error&&e.error.status&&"conflict"===e.error.status[".tag"];t.isFormatVersionError=e=>e.error&&e.error.status&&"bad_format_version"===e.error.status[".tag"];t.getUserAccount=({userId:e,accountId:t})=>r.ns("users").rpc("get_account",{account_id:t},{subjectUserId:e})})),define("metaserver/static/js/folder_overview/constants",["require","exports","metaserver/static/js/core/i18n","react-intl"],(function(e,t,a,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CONFLICT_POPUP_BUTTON=t.CONFLICT_POPUP_CONTENT_YOU=t.CONFLICT_POPUP_CONTENT=t.CONFLICT_POPUP_TITLE_YOU=t.CONFLICT_POPUP_TITLE=t.DESCRIPTION_LAST_EDIT=t.DESCRIPTION_LAST_EDIT_YOU=t.DESCRIPTION_LAST_EDIT_EMPTY=t.DESCRIPTION_LAST_EDIT_EMPTY_YOU=t.PIN_TO_READ_ONLY_FOLDER=t.PIN_TO_FAILURE_PERMISSION_DENIED=t.PIN_TO_MODAL_TITLE_MULTIPLE=t.PIN_TO_MODAL_TITLE_SINGLE=t.DESCRIPTION_VERSION=t.SHARING_MODAL_MESSAGE_PARENT_FOLDER_NO_NAME=t.SHARING_MODAL_MESSAGE_SAME_FOLDER_NO_NAME=t.SHARING_MODAL_MESSAGE_PARENT_FOLDER=t.SHARING_MODAL_MESSAGE_SAME_FOLDER=t.FOLDER_OVERVIEW_EDITOR_EDITING=t.CMD_KEY=t.CTRL_KEY=t.ALT_KEY=t.OPT_KEY=t.DESCRIPTION_SAVE_ERROR_DELAY_MS=t.DESCRIPTION_SAVE_DELAY_MS=t.SNACKBAR_SHOW_BUTTON_TEXT=t.SNACKBAR_CLOSE_BUTTON_TEXT=t.UNPIN_FROM_SNACKBAR_MESSAGE=t.PIN_TO_SNACKBAR_MESSAGE=t.ERROR_SHARE_NO_PERMISSION=t.ERROR_SHARE_MEMBER_FOLDER=t.ERROR_SHARE_PERSONAL_FOLDER=t.ERROR_DESCRIPTION_SAVE=t.ERROR_DESCRIPTION_FORMAT_VERSION=t.ERROR_DESCRIPTION_CONFLICT=t.DESCRIPTION_PLACEHOLDER_RIGHT_RAIL=t.DATA_CACHE_TTL_MS=void 0,t.DATA_CACHE_TTL_MS=3e4,t.DESCRIPTION_PLACEHOLDER_RIGHT_RAIL=a.intl.formatMessage({id:"A5Lqjf",defaultMessage:"Add a few details about this folder here."}),t.ERROR_DESCRIPTION_CONFLICT=a.intl.formatMessage({id:"ssdefa",defaultMessage:"Cant save changes. Paste text elsewhere to save, then click Refresh."}),t.ERROR_DESCRIPTION_FORMAT_VERSION=a.intl.formatMessage({id:"5dt0hu",defaultMessage:"Cant save changes. Reload the page and try again."}),t.ERROR_DESCRIPTION_SAVE=a.intl.formatMessage({id:"PM6K+P",defaultMessage:"Cant save changes."}),t.ERROR_SHARE_PERSONAL_FOLDER=a.intl.formatMessage({id:"9C/lc5",defaultMessage:"Cant @mention someone in your Personal Dropbox."}),t.ERROR_SHARE_MEMBER_FOLDER=a.intl.formatMessage({id:"+dhj1b",defaultMessage:"Cant @mention someone in your member folder."}),t.ERROR_SHARE_NO_PERMISSION=a.intl.formatMessage({id:"b7//2e",defaultMessage:"You dont have permission to share this folder."}),t.PIN_TO_SNACKBAR_MESSAGE=(0,s.defineMessage)({id:"mjXnuX",defaultMessage:"Pinned to {folderName}"}),t.UNPIN_FROM_SNACKBAR_MESSAGE=(0,s.defineMessage)({id:"A1Fokf",defaultMessage:"Unpinned from {folderName}"}),t.SNACKBAR_CLOSE_BUTTON_TEXT=(0,s.defineMessage)({id:"Ww9LPX",defaultMessage:"Close"}),t.SNACKBAR_SHOW_BUTTON_TEXT=(0,s.defineMessage)({id:"8msMyU",defaultMessage:"Show"}),t.DESCRIPTION_SAVE_DELAY_MS=3e3,t.DESCRIPTION_SAVE_ERROR_DELAY_MS=10*t.DESCRIPTION_SAVE_DELAY_MS,t.OPT_KEY=a.intl.formatMessage({id:"HRXOjw",defaultMessage:"opt"}),t.ALT_KEY=a.intl.formatMessage({id:"RIxWSs",defaultMessage:"alt"}),t.CTRL_KEY=a.intl.formatMessage({id:"FL9yea",defaultMessage:"ctrl"}),t.CMD_KEY=a.intl.formatMessage({id:"NWv/3R",defaultMessage:""}),t.FOLDER_OVERVIEW_EDITOR_EDITING=a.intl.formatMessage({id:"Kud10T",defaultMessage:"Everyone in this folder can see notes, tasks, and pinned items"}),t.SHARING_MODAL_MESSAGE_SAME_FOLDER=(0,s.defineMessage)({id:"xkXFjI",defaultMessage:"Hi {user_name}, I @mentioned you in this folder. Take a look."}),t.SHARING_MODAL_MESSAGE_PARENT_FOLDER=(0,s.defineMessage)({id:"YzaJIx",defaultMessage:"Hi {user_name}, I @mentioned you in the {folder_name} folder. Take a look."}),t.SHARING_MODAL_MESSAGE_SAME_FOLDER_NO_NAME=a.intl.formatMessage({id:"sl5Fj7",defaultMessage:"I @mentioned you in this folder. Take a look."}),t.SHARING_MODAL_MESSAGE_PARENT_FOLDER_NO_NAME=(0,s.defineMessage)({id:"erm7J0",defaultMessage:"I @mentioned you in the {folder_name} folder. Take a look."}),t.DESCRIPTION_VERSION=[1,0,1],t.PIN_TO_MODAL_TITLE_SINGLE=(0,s.defineMessage)({id:"kh62rs",defaultMessage:"Pin {name} to..."}),t.PIN_TO_MODAL_TITLE_MULTIPLE=(0,s.defineMessage)({id:"oU0z79",defaultMessage:"Pin {num} items to..."}),t.PIN_TO_FAILURE_PERMISSION_DENIED=(0,s.defineMessage)({id:"BGyZpk",defaultMessage:"You do not have permission to pin to {path}"}),t.PIN_TO_READ_ONLY_FOLDER=(0,s.defineMessage)({id:"UD2+LM",defaultMessage:"Can't pin files or folders to a read-only folder"}),t.DESCRIPTION_LAST_EDIT_EMPTY_YOU=(0,s.defineMessage)({id:"PX5Hq1",defaultMessage:"Deleted {time_ago} by you"}),t.DESCRIPTION_LAST_EDIT_EMPTY=(0,s.defineMessage)({id:"7V5b6j",defaultMessage:"Deleted {time_ago} by {name}"}),t.DESCRIPTION_LAST_EDIT_YOU=(0,s.defineMessage)({id:"oA46AW",defaultMessage:"Updated {time_ago} by you"}),t.DESCRIPTION_LAST_EDIT=(0,s.defineMessage)({id:"MP7zas",defaultMessage:"Updated {time_ago} by {name}"}),t.CONFLICT_POPUP_TITLE=(0,s.defineMessage)({id:"PHRYz8",defaultMessage:"Your changes werent saved because you and {user} are editing at the same time."}),t.CONFLICT_POPUP_TITLE_YOU=a.intl.formatMessage({id:"tc/4YZ",defaultMessage:"Your changes werent saved because you are editing this description elsewhere."}),t.CONFLICT_POPUP_CONTENT=a.intl.formatMessage({id:"4aEgv5",defaultMessage:"Please wait until theyre done before making changes."}),t.CONFLICT_POPUP_CONTENT_YOU=a.intl.formatMessage({id:"oYSO1Z",defaultMessage:"Please save your other changes before making them here."}),t.CONFLICT_POPUP_BUTTON=a.intl.formatMessage({id:"nOO9Qi",defaultMessage:"OK"})})),define("metaserver/static/js/folder_overview/data/action_creators",["require","exports","tslib","react","js/filepath/filepath","metaserver/static/js/browse/data/selectors","metaserver/static/js/folder_overview/api","metaserver/static/js/folder_overview/constants","metaserver/static/js/folder_overview/data/selectors","metaserver/static/js/folder_overview/data/types","metaserver/static/js/folder_overview/errors","metaserver/static/js/folder_overview/live_update","metaserver/static/js/folder_overview/logging","metaserver/static/js/folder_overview/utils","metaserver/static/js/clean/ui/snackbar","metaserver/static/js/core/persistence/storage","metaserver/static/js/clean/viewer","metaserver/static/js/clean/web_user_action_events","metaserver/static/js/core/exception","metaserver/static/js/core/i18n"],(function(e,t,a,s,r,i,o,n,l,d,c,u,_,p,m,f,h,S,g,E){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.subscribeToBolt=t.fetchLoggingFileId=t.fetchAccountForUserId=t.fetchSharedFolderName=t.setDescriptionHasFocus=t.setRequiredComponents=t.updateFolderDataCache=t.removeContentReferences=t.addContentReferencesForPath=t.addContentReferences=t.reloadContentReferences=t.setContentReferencesData=t.saveDescriptionDraft=t.reloadDescription=t.setDescriptionData=t.setFailedToLoad=t.removeLoadedComponent=t.addLoadedComponent=t.saveFolderPreferences=t.loadFolderPreferences=t.handlePrefetch=t.fetchDataForFolder=void 0,s=a.__importStar(s),r=a.__importStar(r),i=a.__importStar(i),o=a.__importStar(o),l=a.__importStar(l),p=a.__importStar(p),g=a.__importStar(g);t.fetchDataForFolder=({path:e,nsId:s,componentNamespace:r,fetchContentReferences:i})=>(c,u)=>a.__awaiter(void 0,void 0,void 0,(function*(){let a,_=!1;const m=p.normalizePath(e),f=Date.now(),h=l.componentDataCache(u())[r];if(!h||0===h.requiredComponents.length){const e=i?["content_references","description","draftjs"]:["description","draftjs"];c((0,t.setRequiredComponents)({componentNamespace:r,requiredComponents:e}))}const S=[];try{const h=l.user(u()).id;a=l.fileIdCache(u())[m];const g=a||l.nsIdCache(u())[m]||s;if(!g)throw new Error("Unable to get file ID or NS ID for current folder");c((0,t.setFailedToLoad)({componentNamespace:r,hasFailedToLoad:!1}));let E=a?l.folderDataCache(u())[a]:void 0;E&&E.descriptionLastUpdated&&f-E.descriptionLastUpdated<n.DATA_CACHE_TTL_MS?(_=!!E.descriptionBaseRevision,c((0,t.addLoadedComponent)({componentNamespace:r,component:"description"})),S.push(Promise.resolve(null))):(c((0,t.removeLoadedComponent)({componentNamespace:r,component:"description"})),S.push(o.getDescription(h,g))),E&&E.contentReferencesLastUpdated&&f-E.contentReferencesLastUpdated<n.DATA_CACHE_TTL_MS?(c((0,t.addLoadedComponent)({componentNamespace:r,component:"content_references"})),S.push(Promise.resolve(null))):i&&(c((0,t.removeLoadedComponent)({componentNamespace:r,component:"content_references"})),S.push(o.getContentReferences(h,g)));const[T,v]=yield Promise.all(S);if(T&&(a=T.file_obj_id),!a)throw new Error("Did not get a file ID from the Sprinkle description payload");c({type:d.ActionTypes.UPDATE_FILE_ID_CACHE,payload:{fileIdCache:{[p.normalizePath(e)]:a}}}),_=!!T&&O(c,a,T,r,f),v&&F(c,a,v,_,r,f),E=l.folderDataCache(u())[a],E&&E.sharedFolderPath||c((0,t.fetchSharedFolderName)({path:e})),E&&E.loggingFileId||c((0,t.fetchLoggingFileId)({path:e})),c((0,t.loadFolderPreferences)({folderFileId:a}))}catch(a){g.reportException({err:a,severity:"non-critical",exc_extra:{path:e}}),c((0,t.setFailedToLoad)({componentNamespace:r,hasFailedToLoad:!0}))}}));t.handlePrefetch=({path:e,content_references:s,description:r,componentNamespace:i,ts:o=Date.now()})=>n=>a.__awaiter(void 0,void 0,void 0,(function*(){try{const t=r||{},a=s||{},l=t.file_obj_id;if(!l)throw new Error("Did not get a file ID from the Odyssey prefetch payload");n({type:d.ActionTypes.UPDATE_FILE_ID_CACHE,payload:{fileIdCache:{[p.normalizePath(e)]:l}}});const c=t&&O(n,l,t,i,o);a&&F(n,l,a,c,i,o)}catch(a){g.reportException({err:a,severity:"non-critical",exc_extra:{path:e}}),n((0,t.setFailedToLoad)({componentNamespace:i,hasFailedToLoad:!0}))}}));t.loadFolderPreferences=({folderFileId:e})=>(s,r)=>a.__awaiter(void 0,void 0,void 0,(function*(){const a=l.user(r()).id;f.UserLocalStorage.clearOtherUsers([a]);const i=f.UserLocalStorage.get(a,`folder-overview-${e}`);i&&s((0,t.updateFolderDataCache)({fileId:e,folderData:i}))}));t.saveFolderPreferences=({folderFileId:e})=>(t,s)=>a.__awaiter(void 0,void 0,void 0,(function*(){const t=l.user(s()).id;f.UserLocalStorage.clearOtherUsers([t]);const a=l.folderDataCache(s())[e];a&&f.UserLocalStorage.set(t,`folder-overview-${e}`,{isCollapsed:a.isCollapsed})}));t.addLoadedComponent=({componentNamespace:e,component:t})=>({type:d.ActionTypes.ADD_LOADED_COMPONENT,payload:{componentNamespace:e,component:t}});t.removeLoadedComponent=({componentNamespace:e,component:t})=>({type:d.ActionTypes.REMOVE_LOADED_COMPONENT,payload:{componentNamespace:e,component:t}});t.setFailedToLoad=({componentNamespace:e,hasFailedToLoad:t})=>({type:d.ActionTypes.SET_FAILED_TO_LOAD,payload:{componentNamespace:e,hasFailedToLoad:t}});t.setDescriptionData=(e,a,s)=>{const{text:r,latest_revision_id:i,file_obj_id:o,bolt_channel_state:n,format_version:l,last_modified_time:c,last_modified_user:u}=e;if(!o)throw new Error("Unexpected response from Sprinkle");const _=i||"";a((0,t.updateFolderDataCache)({fileId:o,folderData:{description:r,descriptionBaseRevision:_,descriptionDraft:void 0,descriptionSaveState:d.DescriptionSaveState.IDLE,descriptionFormatVersion:l,descriptionBoltChannelState:n,descriptionLastUpdated:Date.now()}})),a((0,t.addLoadedComponent)({componentNamespace:s,component:"description"})),a(I({folderFileId:o,modifiedInfo:{timestamp:c,userId:u},field:"description"})),(0,t.subscribeToBolt)("description",n)};t.reloadDescription=({folderFileId:e,componentNamespace:s})=>(r,i)=>a.__awaiter(void 0,void 0,void 0,(function*(){const a=l.user(i());try{const i=yield o.getDescription(a.id,e);r((0,t.updateFolderDataCache)({fileId:e,folderData:{descriptionBaseRevision:""}})),(0,t.setDescriptionData)(i,r,s)}catch(t){g.reportException({err:t,severity:g.SEVERITY.NONCRITICAL,tags:["browse","folder_overview"],exc_extra:{fileId:e,isReload:!0}})}}));t.saveDescriptionDraft=({folderFileId:e,componentNamespace:s})=>(r,i)=>a.__awaiter(void 0,void 0,void 0,(function*(){const a=l.user(i());try{const t=l.folderDataCache(i())[e];if(!t||!A(t))return;u({descriptionSaveState:d.DescriptionSaveState.SAVING});const r=yield o.setDescription(a,e,t.descriptionLatestRevision,t.descriptionDraft,n.DESCRIPTION_VERSION.join(".")),c=l.componentDataCache(i())[s];(null==c?void 0:c.descriptionHasFocus)||void 0===t.descriptionOpenedAtRevision||y(t);const{text:p,latest_revision_id:m,last_modified_time:f,last_modified_user:h}=r;u({description:p,descriptionSaveState:d.DescriptionSaveState.IDLE,descriptionLastModified:{timestamp:f,userId:h},descriptionBaseRevision:m,descriptionLatestRevision:m});const g="BROWSE"===s?S.ActionSurfaceLogValue.CENTER_PANE:S.ActionSurfaceLogValue.RIGHT_SIDEBAR,E="search-sidebar"===s?S.RetrievalSourceValue.SEARCH:S.RetrievalSourceValue.BROWSE;(0,_.logOverviewEdited)({folderFileId:e,action_surface:g,retrievalSource:E,loggingFileId:t.loggingFileId})}catch(t){o.isConflictError(t)?(u({descriptionSaveState:d.DescriptionSaveState.CONFLICT,descriptionLastModified:{userId:void 0}}),r(b({folderFileId:e}))):o.isFormatVersionError(t)?((0,c.showDescriptionFormatError)(),u({descriptionSaveState:d.DescriptionSaveState.ERROR})):((0,c.showDescriptionSaveError)(),u({descriptionSaveState:d.DescriptionSaveState.ERROR}))}function u(a){r((0,t.updateFolderDataCache)({fileId:e,folderData:a}))}}));t.setContentReferencesData=(e,a,s,r)=>{const i=a.content_references||[],o=a.latest_revision_id,n=a.last_modified_time,l=a.last_modified_user;s((0,t.updateFolderDataCache)({fileId:e,folderData:{contentReferences:i,contentReferencesRevision:o,contentReferencesBoltChannelState:a.bolt_channel_state,contentReferencesLastUpdated:Date.now()}})),s(I({folderFileId:e,modifiedInfo:{timestamp:n,userId:l},field:"contentReferences"})),s((0,t.addLoadedComponent)({componentNamespace:r,component:"content_references"})),(0,t.subscribeToBolt)("content_references",a.bolt_channel_state)};function T(e){m.Snackbar.complete(E.intl.formatMessage({id:"sz+AhS",defaultMessage:"{count, plural, one{Pinned {count} item.} other{Pinned {count} items.}}"},{count:e}),"folder-overview-pin-current-folder")}t.reloadContentReferences=({folderFileId:e,componentNamespace:s})=>(r,i)=>a.__awaiter(void 0,void 0,void 0,(function*(){const a=l.user(i());try{const i=yield o.getContentReferences(a.id,e);(0,t.setContentReferencesData)(e,i,r,s)}catch(t){g.reportException({err:t,severity:g.SEVERITY.NONCRITICAL,tags:["browse","folder_overview"],exc_extra:{fileId:e,isReload:!0}})}}));const v=({folderName:e,onShow:t})=>{m.Snackbar.show(s.createElement(m.Snackbar,{title:E.intl.formatMessage(n.PIN_TO_SNACKBAR_MESSAGE,{folderName:e}),timeoutDelayMs:5e3,actionButtonText:t?E.intl.formatMessage(n.SNACKBAR_SHOW_BUTTON_TEXT):void 0,closeButtonText:E.intl.formatMessage({id:"HBT96k",defaultMessage:"Close"}),onActionClick:t?()=>{m.Snackbar.close("folder-overview-pin"),t()}:void 0,id:"folder-overview-pin"}))};t.addContentReferences=({folderFileId:e,fileIds:s,componentNamespace:r,snackbarConfig:i})=>(n,d)=>a.__awaiter(void 0,void 0,void 0,(function*(){if(null===s||0===s.length)return;const a=l.user(d()).id;try{yield o.addContentReferences(a,e,s),i?v(i):T(s.length),n((0,t.reloadContentReferences)({folderFileId:e,componentNamespace:r}))}catch(e){g.reportException({err:e,severity:g.SEVERITY.NONCRITICAL,tags:["browse","folder_overview"]})}}));t.addContentReferencesForPath=({path:e,files:s,currentPath:i,snackbarConfig:d})=>(c,u)=>a.__awaiter(void 0,void 0,void 0,(function*(){const a=l.user(u());try{yield o.addContentReferencesToPath(a.id,e,s.map(p.fileToContentReferenceId)),d?v(d):i!==e?m.Snackbar.complete(E.intl.formatMessage({id:"Mflc9Z",defaultMessage:"{count, plural, one{Pinned {count} item to {folder}.} other{Pinned {count} items to {folder}.}}"},{count:s.length,folder:r.filename(e,h.Viewer.get_root_name(a))}),"folder-overview-pin"):T(s.length);const n=l.fileIdCache(u())[p.normalizePath(e)];n&&c((0,t.reloadContentReferences)({folderFileId:n,componentNamespace:"BROWSE"}))}catch(t){g.reportException({err:t,severity:g.SEVERITY.NONCRITICAL,tags:["browse","folder_overview"]});try{if("permission_denied"===t.error.status[".tag"]){const t=d?E.intl.formatMessage(n.PIN_TO_READ_ONLY_FOLDER):E.intl.formatMessage(n.PIN_TO_FAILURE_PERMISSION_DENIED,{path:r.filename(e,h.Viewer.get_root_name(a))});return void m.Snackbar.fail(t,"folder-overview-pin")}}catch(e){}m.Snackbar.fail(E.intl.formatMessage({id:"LYVKP8",defaultMessage:"{count, plural, one{Failed to pin {count} item to {folder}.} other{Failed to pin {count} items to {folder}.}}"},{count:s.length,folder:r.filename(e,h.Viewer.get_root_name(a))}),"folder-overview-pin")}}));t.removeContentReferences=({folderFileId:e,fileIds:r,componentNamespace:i,snackbarConfig:d})=>(c,u)=>a.__awaiter(void 0,void 0,void 0,(function*(){const a=l.user(u()).id;try{yield o.removeContentReferences(a,e,r),d?m.Snackbar.show(s.createElement(m.Snackbar,{title:E.intl.formatMessage(n.UNPIN_FROM_SNACKBAR_MESSAGE,{folderName:d.folderName}),variant:"complete",actionButtonText:E.intl.formatMessage({id:"GUtve/",defaultMessage:"Undo"}),closeButtonText:E.intl.formatMessage({id:"HBT96k",defaultMessage:"Close"}),onActionClick:()=>{m.Snackbar.close("folder-overview-unpin"),c((0,t.addContentReferences)({folderFileId:e,fileIds:r,componentNamespace:i,snackbarConfig:d}))},timeoutDelayMs:5e3,id:"folder-overview-unpin"})):m.Snackbar.generic(E.intl.formatMessage({id:"0bkx9E",defaultMessage:"{count, plural, one{Unpinned {count} item.} other{Unpinned {count} items.}}"},{count:r.length}),"folder-overview-unpin"),c((0,t.reloadContentReferences)({folderFileId:e,componentNamespace:i}))}catch(e){g.reportException({err:e,severity:g.SEVERITY.NONCRITICAL,tags:["browse","folder_overview"]})}}));t.updateFolderDataCache=({fileId:e,folderData:t})=>({type:d.ActionTypes.UPDATE_FOLDER_DATA_CACHE,payload:{fileId:e,folderData:t}});function y(e){const t=e.description?E.intl.formatMessage({id:"BV1uZg",defaultMessage:"Folder overview changed."}):E.intl.formatMessage({id:"MLktc7",defaultMessage:"Folder overview added."});m.Snackbar.generic(t,"folder-overview-change")}t.setRequiredComponents=({componentNamespace:e,requiredComponents:t})=>({type:d.ActionTypes.SET_REQUIRED_COMPONENTS,payload:{componentNamespace:e,requiredComponents:t}});t.setDescriptionHasFocus=({componentNamespace:e,descriptionHasFocus:a,folderFileId:s})=>(r,i)=>{const o=l.componentDataCache(i())[e];if(a&&o&&!o.descriptionHasFocus){const e=l.folderDataCache(i())[s].descriptionBaseRevision;r((0,t.updateFolderDataCache)({fileId:s,folderData:{descriptionLatestRevision:e,descriptionOpenedAtRevision:e}}))}else if(!a&&(null==o?void 0:o.descriptionHasFocus)){const e=l.folderDataCache(i())[s];e&&(null==e?void 0:e.descriptionOpenedAtRevision)!==(null==e?void 0:e.descriptionLatestRevision)&&(y(e),r((0,t.updateFolderDataCache)({fileId:s,folderData:{descriptionOpenedAtRevision:void 0}})))}r({type:d.ActionTypes.SET_DESCRIPTION_HAS_FOCUS,payload:{componentNamespace:e,descriptionHasFocus:a}})};const A=e=>!!e&&(e.descriptionSaveState!==d.DescriptionSaveState.CONFLICT&&(e.descriptionSaveState!==d.DescriptionSaveState.SAVING&&p.hasUnsavedDescriptionDraft(e)));t.fetchSharedFolderName=({path:e})=>(s,i)=>a.__awaiter(void 0,void 0,void 0,(function*(){if(r.paths_are_equal(e,"/"))return;const a=p.normalizePath(e),n=l.nsIdCache(i())[a];if(!n)return;const d=l.fileIdCache(i())[a],c=l.user(i()).id,u=p.extractSharedFolderId(n);if(u)try{const e=yield o.getSharedFolderPath({userId:c,sharedFolderId:u});s((0,t.updateFolderDataCache)({fileId:d,folderData:{sharedFolderPath:e}}))}catch(e){g.reportException({err:e,severity:g.SEVERITY.NONCRITICAL,tags:["browse","folder_overview"]})}}));t.fetchAccountForUserId=({accountId:e})=>(t,s)=>a.__awaiter(void 0,void 0,void 0,(function*(){const a=l.user(s());if(!e)return;if(e in l.accountCache(s()))return;if(e===a.account_id)return;const r=yield o.getUserAccount({userId:a.id,accountId:e});t({type:d.ActionTypes.UPDATE_ACCOUNT_CACHE,payload:{accountCache:{[e]:r}}})}));t.fetchLoggingFileId=({path:e})=>(s,n)=>a.__awaiter(void 0,void 0,void 0,(function*(){if(r.paths_are_equal(e,"/"))return;if(r.paths_are_equal(i.context(n()).currentFQPath,e)&&!i.context(n()).currentNSPath)return;const a=p.normalizePath(e),d=l.fileIdCache(n())[a],c=l.user(n()).id;try{const e=yield o.getLoggingFileId({userId:c,path:a});s((0,t.updateFolderDataCache)({fileId:d,folderData:{loggingFileId:e}}))}catch(e){g.reportException({err:e,severity:g.SEVERITY.NONCRITICAL,tags:["browse","folder_overview"]})}}));const I=({folderFileId:e,modifiedInfo:a,field:s})=>(r,i)=>{if(!a.timestamp||!a.userId)return;const o=l.folderDataCache(i())[e];if(!o)return;const n="contentReferences"===s?"contentReferencesLastModified":"descriptionLastModified",d=o[n];(null==d?void 0:d.timestamp)&&a.timestamp<d.timestamp||(r((0,t.updateFolderDataCache)({fileId:e,folderData:{[n]:a}})),r((0,t.fetchAccountForUserId)({accountId:a.userId})))};t.subscribeToBolt=(e,t)=>{if(void 0!==t)try{const{channel_id:a,revision:s,token:r}=t;if(void 0===a||void 0===s||void 0===r)return;const{unique_id:i,app_id:o}=a;if(void 0===i||void 0===o)return;u.folderOverviewLiveUpdateManager.setUpdateChannelForType(e,{uniqueId:i,appId:o,token:r,revision:`${s}`})}catch(e){g.reportException({err:e,severity:g.SEVERITY.NONCRITICAL,tags:["browse","folder_overview"]})}};const b=({folderFileId:e})=>(t,s)=>a.__awaiter(void 0,void 0,void 0,(function*(){const a=l.user(s()),{last_modified_time:r,last_modified_user:i}=yield o.getDescription(a.id,e);t(I({folderFileId:e,modifiedInfo:{timestamp:r,userId:i},field:"description"}))})),O=(e,a,s,r,i)=>s.latest_revision_id?((0,t.setDescriptionData)(s,e,r),!0):(e((0,t.addLoadedComponent)({componentNamespace:r,component:"description"})),e((0,t.updateFolderDataCache)({fileId:a,folderData:{descriptionBoltChannelState:s.bolt_channel_state,descriptionLastUpdated:i}})),(0,t.subscribeToBolt)("description",s.bolt_channel_state),!1),F=(e,a,s,r,i,o)=>s.latest_revision_id?((0,t.setContentReferencesData)(a,s,e,i),!0):(e((0,t.updateFolderDataCache)({fileId:a,folderData:{contentReferences:[],contentReferencesBoltChannelState:s.bolt_channel_state,contentReferencesLastUpdated:o}})),e((0,t.addLoadedComponent)({componentNamespace:i,component:"content_references"})),!1)})),define("metaserver/static/js/folder_overview/data/selectors",["require","exports","tslib","reselect","js/filepath/filepath","metaserver/static/js/folder_overview/constants","metaserver/static/js/folder_overview/data/reducer","metaserver/static/js/folder_overview/utils","typescript/libraries/comments2/src/components/folder_overview_utils/index","metaserver/static/js/redux/namespaces","metaserver/static/js/redux/selectors","metaserver/static/js/clean/user"],(function(e,t,a,s,r,i,o,n,l,d,c,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.makeDoesFolderOverviewExistSelector=t.makeIsFolderOverviewEmptySelector=t.makePinnedItemsSelector=t.makeDescriptionContentSelector=t.makeLoggingFileIdSelector=t.makeSharedFolderNameSelector=t.makeSharedFolderPathSelector=t.makeHasUnsavedDescriptionDraftSelector=t.makeDescriptionFormatValidSelector=t.makeDescriptionSaveStateSelector=t.makeLastModifiedUserSelector=t.makeLastModifiedUserIdSelector=t.makeLastModifiedTimeSelector=t.makeDescriptionBaseRevisionSelector=t.makeIsCollapsedSelector=t.descriptionAuthorSelector=t.makeSharedFolderIdSelector=t.makeFolderNsIdSelector=t.makeFolderFileIdSelector=t.makeDescriptionHasFocusSelector=t.makeHasFailedToLoadSelector=t.makeHaveAllComponentsLoadedSelector=t.makeLoadedComponentsSelector=t.user=t.componentDataCache=t.accountCache=t.nsIdCache=t.fileIdCache=t.folderDataCache=void 0,r=a.__importStar(r),n=a.__importStar(n);const _=[],p=e=>(0,c.getStateAtNamespace)(e,d.FOLDER_OVERVIEW_NAMESPACE_KEY)||o.defaultFolderOverviewState;t.folderDataCache=e=>p(e).folderDataCache;t.fileIdCache=e=>p(e).fileIdCache;const m=(e,a)=>(0,t.fileIdCache)(e)[n.normalizePath(a.path)];t.nsIdCache=e=>p(e).nsIdCache;const f=(e,a)=>(0,t.nsIdCache)(e)[n.normalizePath(a.path)];t.accountCache=e=>p(e).accountCache;t.componentDataCache=e=>p(e).componentDataCache;t.user=e=>e.BROWSE&&e.BROWSE.user||(0,u.mkUser)(e.SEARCH.user);const h=(e,a)=>(0,t.componentDataCache)(e)[a.componentNamespace],S=(e,a)=>{const s=m(e,a);return(0,t.folderDataCache)(e)[s]},g=(e,t)=>{const a=S(e,t);return a?a.sharedFolderPath||t.path:void 0},E=(e,t)=>{var a;const s=T(e,t);return null!==(a=null==s?void 0:s.userId)&&void 0!==a?a:void 0},T=(e,t)=>{const{descriptionLastModified:a}=S(e,t)||{};return a},v=(0,s.createSelector)(S,e=>e?e.descriptionFormatVersion:void 0),y=(0,s.createSelector)(S,e=>{if(e&&e.description)try{return JSON.parse(e.description)}catch(e){return}}),A=(0,s.createSelector)(S,e=>{if(void 0!==e&&void 0!==e.contentReferences)return 0===e.contentReferences.length?_:n.convertContentReferencesToSortedFiles(e.contentReferences)}),I=(0,s.createSelector)(y,l.isEmptyDescription);t.makeLoadedComponentsSelector=()=>(0,s.createSelector)(h,e=>e?e.loadedComponents:void 0);t.makeHaveAllComponentsLoadedSelector=()=>(0,s.createSelector)(h,e=>{if(!e||0===e.requiredComponents.length)return!1;return 0===e.requiredComponents.filter(t=>!e.loadedComponents.includes(t)).length});t.makeHasFailedToLoadSelector=()=>(0,s.createSelector)(h,e=>!!e&&e.hasFailedToLoad);t.makeDescriptionHasFocusSelector=()=>(0,s.createSelector)(h,e=>!!e&&e.descriptionHasFocus);t.makeFolderFileIdSelector=()=>(0,s.createSelector)(m,e=>e);t.makeFolderNsIdSelector=()=>(0,s.createSelector)(f,e=>e);t.makeSharedFolderIdSelector=()=>(0,s.createSelector)(f,e=>{if(e)return n.extractSharedFolderId(e)}),t.descriptionAuthorSelector=(0,s.createSelector)(t.user,n.convertDbxUserToIUser);t.makeIsCollapsedSelector=()=>(0,s.createSelector)(S,e=>!!e&&!!e.isCollapsed);t.makeDescriptionBaseRevisionSelector=()=>(0,s.createSelector)(S,e=>e?e.descriptionBaseRevision:void 0);t.makeLastModifiedTimeSelector=()=>(0,s.createSelector)(T,e=>{var t;return null!==(t=null==e?void 0:e.timestamp)&&void 0!==t?t:void 0});t.makeLastModifiedUserIdSelector=()=>(0,s.createSelector)(E,e=>e);t.makeLastModifiedUserSelector=()=>(0,s.createSelector)(E,t.accountCache,(e,t)=>e?t[e]:void 0);t.makeDescriptionSaveStateSelector=()=>(0,s.createSelector)(S,e=>e?e.descriptionSaveState:void 0);t.makeDescriptionFormatValidSelector=()=>(0,s.createSelector)(v,e=>{if(!e)return!0;const t=e.split(".").map(e=>parseInt(e,10));return!(t[0]>i.DESCRIPTION_VERSION[0])&&!(t[0]===i.DESCRIPTION_VERSION[0]&&t[1]>i.DESCRIPTION_VERSION[1])});t.makeHasUnsavedDescriptionDraftSelector=()=>(0,s.createSelector)(S,n.hasUnsavedDescriptionDraft);t.makeSharedFolderPathSelector=()=>(0,s.createSelector)(g,e=>e);t.makeSharedFolderNameSelector=()=>(0,s.createSelector)(g,e=>e?r.filename(e):void 0);t.makeLoggingFileIdSelector=()=>(0,s.createSelector)(S,e=>e?e.loggingFileId:void 0);t.makeDescriptionContentSelector=()=>(0,s.createSelector)(y,e=>e);t.makePinnedItemsSelector=()=>(0,s.createSelector)(A,e=>e);t.makeIsFolderOverviewEmptySelector=()=>(0,s.createSelector)(I,A,(e,t)=>e&&!(t&&t.length));t.makeDoesFolderOverviewExistSelector=()=>(0,s.createSelector)(S,e=>!!e&&(!!e.descriptionBaseRevision||!!e.contentReferencesRevision))})),define("metaserver/static/js/folder_overview/errors",["require","exports","metaserver/static/js/folder_overview/constants","metaserver/static/js/clean/ui/snackbar"],(function(e,t,a,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.showDescriptionSaveError=t.showDescriptionFormatError=void 0;t.showDescriptionFormatError=()=>{s.Snackbar.fail(a.ERROR_DESCRIPTION_FORMAT_VERSION,"folder-overview")};t.showDescriptionSaveError=()=>{s.Snackbar.fail(a.ERROR_DESCRIPTION_SAVE,"folder-overview")}})),define("metaserver/static/js/folder_overview/live_update",["require","exports","tslib","lodash","eventemitter3","metaserver/static/js/bolt/bolt_nodeps"],(function(e,t,a,s,r,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.folderOverviewLiveUpdateManager=t.FolderOverviewLiveUpdateManager=void 0,s=a.__importStar(s),r=a.__importDefault(r);class o extends r.default{constructor(){super(),this.setUpdateChannelForType=(e,t)=>{this.signedChannelStates[e]=new i.SignedChannelState(t.appId,t.uniqueId,t.revision,t.token),this.boltClient.update_states(s.values(this.signedChannelStates)),this.boltClient.start()},this.handleUpdate=e=>{const t=[];e.forEach(e=>{const a=s.findKey(this.signedChannelStates,{app_id:e.app_id,unique_id:e.unique_id});a&&!t.includes(a)&&(this.emit("update",{type:a}),t.push(a))})},this.handleRefresh=()=>{this.boltClient.update_states(s.values(this.signedChannelStates))},this.boltClient=new i.BoltClient([],this.handleUpdate,this.handleRefresh),this.signedChannelStates={}}stop(){this.boltClient.unsubscribe()}}t.FolderOverviewLiveUpdateManager=o,t.folderOverviewLiveUpdateManager=new o})),define("metaserver/static/js/folder_overview/logging",["require","exports","tslib","sjcl","immutable","js/filepath/filepath","metaserver/static/js/logging/hive/schemas/web-user-action","metaserver/static/js/logging/telemetry","metaserver/static/js/folder_overview/data/selectors","metaserver/static/js/folder_overview/data/store","metaserver/static/js/folder_overview/utils","metaserver/static/js/clean/web_user_action_events"],(function(e,t,a,s,r,i,o,n,l,d,c,u){"use strict";function _(e){return e.blocks.map(e=>e.text.length).reduce((e,t)=>e+t,0)}function p(e){let t=(0,r.OrderedSet)();return t=t.merge(e.blocks.map(e=>e.type).filter(e=>"unstyled"!==e)),e.blocks.forEach(e=>e.inlineStyleRanges.forEach(e=>{t=t.add(e.style)})),e.blocks.forEach(a=>a.entityRanges.forEach(a=>{t=t.add(e.entityMap[a.key].type)})),t.toArray().sort()}Object.defineProperty(t,"__esModule",{value:!0}),t.logFolderOverviewAction=t.logOverviewEdited=t.makeOverviewResourceExtras=t.makeEditedData=t.extractNsIdAndPath=t.hashPath=t.hiveLogger=void 0,s=a.__importStar(s),i=a.__importStar(i),n=a.__importStar(n),l=a.__importStar(l),t.hiveLogger=new n.HiveLogger;const m=(e,t)=>{const a=l.folderDataCache(t)[e];return a&&a.contentReferences||[]},f=e=>{if(!e)return"";const t=s.hash.sha256.hash(e.toLowerCase());return s.codec.hex.fromBits(t)};t.hashPath=e=>(e||"/").split("/").map(f).join("/");const h=e=>{const t=i.normalize(e).split("/");return f(t.pop())};t.extractNsIdAndPath=e=>e?{nsId:(0,c.extractSharedFolderId)(e),nsPath:(0,c.extractSharedFolderPath)(e)}:{};t.makeEditedData=({folderFileId:e,loggingFileId:a,action_surface:s,retrievalSource:r})=>{const i=(0,d.getStoreForFolderOverview)().getState(),o=(function(e){const t=(function(e){const t={all:0,checked:0};if(!e)return t;return e.blocks.forEach(e=>{"task-block"===e.type&&(t.all+=1,e.data&&e.data.checked&&(t.checked+=1))}),t})(e);return{length:e?_(e):0,features:e?p(e):[],tasks:t.all,checkedTasks:t.checked}})(((e,t)=>{const a=l.folderDataCache(t)[e];if(a&&a.descriptionDraft)try{return JSON.parse(a.descriptionDraft)}catch(e){return}})(e,i)),n=(0,t.makeOverviewResourceExtras)({folderFileId:e,loggingFileId:a,action_surface:s,retrievalSource:r});if(n)return Object.assign(Object.assign({},n),{length:o.length.toString(),formatting:JSON.stringify(o.features),tasks:o.tasks.toString(),checkedTasks:o.checkedTasks.toString(),pins:JSON.stringify(m(e,i).map(e=>({file_id:e.ns_path?e.file_id:e.ns_id,file_obj_id:e.file_id,resource:{resource_title:h(e.fq_path),resource_type:e.is_dir?"SFJ_FOLDER":"SFJ_FILE",ns_id:`${e.ns_id}`,resource_path:(0,t.hashPath)(e.fq_path),resource_namespace_path:(0,t.hashPath)(e.ns_path)}})))})};t.makeOverviewResourceExtras=({folderFileId:e,loggingFileId:a,action_surface:s,retrievalSource:r})=>{const i=(0,d.getStoreForFolderOverview)().getState(),o=((e,t)=>{const a=l.fileIdCache(t);for(const t in a)if(a[t]===e)return t})(e,i);if(void 0===o)return;const{nsId:n,nsPath:c}=(0,t.extractNsIdAndPath)(l.nsIdCache(i)[o]);return n?{resource_type:"SFJ_FOLDER",resource_title:h(o),ns_id:n,resource_path:(0,t.hashPath)(o),resource_namespace_path:(0,t.hashPath)(c),file_id:(c?a:n)||null,file_obj_id:e,is_offline:"false",action_surface:s,retrieval_source:r}:void 0};t.logOverviewEdited=({folderFileId:e,loggingFileId:a,action_surface:s,retrievalSource:r})=>{const i=(0,d.getStoreForFolderOverview)().getState();(0,t.logFolderOverviewAction)(u.WebUserActionLogEvent.FOLDER_OVERVIEW_EDITED,l.user(i).id,null,(0,t.makeEditedData)({folderFileId:e,loggingFileId:a,action_surface:s,retrievalSource:r}))};t.logFolderOverviewAction=(e,a,s,r={})=>{let n={user_id:a,event_name:e};s&&(n=Object.assign(Object.assign({},n),{file_nsid:s.ns_id,file_sjid:s.sjid,file_id:s.file_id,file_name:i.filename(s.fq_path),file_path:s.fq_path,file_extension:s.ext})),t.hiveLogger.log(new o.WebUserActionRow(Object.assign(Object.assign({},n),{extra:Object.assign({},r)})))}})),define("metaserver/static/js/dropins_v3/mover/api_client",["require","exports","tslib","metaserver/static/js/dropins_v3/shared/user_friendly_error","metaserver/static/js/clean/ui/fileops_actions","metaserver/static/js/cloud_docs/utils","metaserver/static/js/dropins_v3/shared/ajax_error"],(function(e,t,a,s,r,i,o){"use strict";function n(e){return void 0!==e.cloud_doc_id}function l(e){return void 0!==e.id}function d(t,s,r){return a.__awaiter(this,void 0,void 0,(function*(){const o=(0,i.replaceInvalidFilenameChars)(s.name);return(yield(function(){return a.__awaiter(this,void 0,void 0,(function*(){const{UserApiV2Client:t}=yield new Promise((t,a)=>{e(["metaserver/static/js/api_v2/user_client"],t,a)}).then(a.__importStar);return(new t).ns("cloud_docs")}))})()).rpc("alpha/dropin_move",{cloud_doc_id:s.cloud_doc_id,to_path:`${r}/${o}`},{subjectUserId:t.id})}))}function c(t,s){return a.__awaiter(this,void 0,void 0,(function*(){const r={"Dropbox-API-Path-Root":`{".tag": "root", "root": "${t.root_ns_id}"}`};return(yield(function(){return a.__awaiter(this,void 0,void 0,(function*(){const{UserApiV2Client:t}=yield new Promise((t,a)=>{e(["metaserver/static/js/api_v2/user_client"],t,a)}).then(a.__importStar);return(new t).ns("files")}))})()).rpc("get_metadata_batch",{paths:s.map(e=>e.id)},{subjectUserId:t.id,headers:r})}))}function u(e,t,a){return Promise.all(t.map(t=>d(e,t,a)))}function _(e,t,i){return a.__awaiter(this,void 0,void 0,(function*(){if(0===t.length)return Promise.resolve([]);const a=c(e,t),o=yield a.then(e=>e.entries.map((e,a)=>{if(void 0!==e.path_lower)return{fq_path:e.path_lower,is_dir:t[a].is_dir};throw new s.UserFriendlyError("path_lower is undefined","Oops! Seems like the file does not exist!")})),n={user:e,path:"",files:o,newPath:i,checkFSWs:!0};return new Promise((e,t)=>{r.moveFiles_LEGACY(Object.assign(Object.assign({},n),{onSuccess:e,onRequestNotSent:t}))})}))}Object.defineProperty(t,"__esModule",{value:!0}),t.search=t.moveEntriesToFolder=t.entryIsFile=t.entryIsCloudDoc=void 0,r=a.__importStar(r),t.entryIsCloudDoc=n,t.entryIsFile=l,t.moveEntriesToFolder=function(e,t,a){const s=t.filter(e=>n(e)),r=t.filter(e=>l(e));return Promise.all([u(e,s,a),_(e,r,a)]).then(()=>{})},t.search=function(t,s){return(function(t,s){return a.__awaiter(this,void 0,void 0,(function*(){const r=yield new Promise((t,a)=>{e(["metaserver/static/js/deprecated_ajax/ajax_jquery"],t,a)}).then(a.__importStar);return new Promise((e,a)=>{r.WebRequest({url:"/dropins/search",data:{query:s,include_files:!1},subject_user:t,success:e,error:(e,t,s)=>{a(s)}})}).then(JSON.parse,e=>Promise.reject(new o.AjaxError(e)))}))})(t,s)}})),define("metaserver/static/js/dropins_v3/mover/host_site",["require","exports","metaserver/static/js/dropins_v3/shared/host_site"],(function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HostSite=void 0;class s extends a.BaseHostSite{onSuccess(){this.sendMessage("success"),this.closeDialog()}onCancel(){this.sendMessage("cancel"),this.closeDialog()}onError(e){this.sendMessage("error",e.message),this.closeDialog()}onFolderSelected(e){this.sendMessage("folder_selected",{path:e})}}t.HostSite=s})),define("metaserver/static/js/dropins_v3/mover/mover_page",["require","exports","tslib","react","metaserver/static/js/components/ui/css","metaserver/static/js/folder_dialog/api","metaserver/static/js/dropins_v3/mover/api_client","metaserver/static/js/dropins_v3/mover/host_site","metaserver/static/js/clean/web_timing_logger","metaserver/static/js/core/notify","metaserver/static/js/dropins_v3/mover/mover_parent","metaserver/static/js/dropins_v3/shared/vortex_logger","metaserver/static/js/dropins_v3/shared/timeout","metaserver/static/js/clean/viewer"],(function(e,t,a,s,r,i,o,n,l,d,c,u,_,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MoverPage=void 0,s=a.__importDefault(s);class m extends s.default.Component{constructor(e){super(e),this.state={accountId:e.accountId,initialFolderSelection:e.initialFolderSelection,entries:null,showFoldersOnly:!!e.showFoldersOnly,showSearchBar:!!e.showSearchBar},this.vortexLogger=new u.VortexLogger(e.appKey,e.statPrefix),this.hostSite=new n.HostSite(e.origin,d.Notify),this.hostSite.listen({onState:e=>this.setState(e),onClose:()=>window.close()}),this.hostSite.ready()}render(){const e={moveEntriesToFolder:o.moveEntriesToFolder,getFolderContents:i.getFolderContents,search:o.search};return s.default.createElement("div",{className:"dropins-mover-page"},s.default.createElement(c.MoverParent,{viewer:p.Viewer.get_viewer(),hostSite:this.hostSite,apiClient:e,webTimer:(0,l.get_timer)(),vortexLogger:this.vortexLogger,timeout:_.timeout,accountId:this.state.accountId,entries:this.state.entries,initialFolderSelection:this.state.initialFolderSelection,showFoldersOnly:this.state.showFoldersOnly,showSearchBar:this.state.showSearchBar}))}}m.displayName="MoverPage",t.MoverPage=(0,r.requireCssWithComponent)(m,["/static/metaserver/static/css/dropins_v3/mover/mover-vfl7gzMIP.css","/static/metaserver/static/css/foundation-vflZkvt4R.css","/static/metaserver/static/css/notify-vfl4oJv2S.css"])})),define("metaserver/static/js/dropins_v3/mover/mover_parent",["require","exports","tslib","react","metaserver/static/js/components/ui/css","metaserver/static/js/dropins_v3/shared/vortex_logger","metaserver/static/js/folder_dialog/move_dialog","metaserver/static/js/folder_dialog/constants","metaserver/static/js/dropins_v3/mover/api_client"],(function(e,t,a,s,r,i,o,n,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MoverParent=void 0,s=a.__importDefault(s);class d extends s.default.Component{constructor(){super(...arguments),this.handleSuccess=()=>{const{hostSite:e,timeout:t,vortexLogger:a}=this.props;(0,i.logRateBeforeCallback)(a,t,"move_success",()=>{e.onSuccess()})},this.handleCancel=()=>{const{hostSite:e,timeout:t,vortexLogger:a}=this.props;(0,i.logRateBeforeCallback)(a,t,"move_cancel",()=>{e.onCancel()})},this.handleError=e=>{const{hostSite:t,timeout:a,vortexLogger:s}=this.props;(0,i.logRateBeforeCallback)(s,a,"move_error",()=>{t.onError(e)})},this.handleFolderSelected=(e,t)=>{const{hostSite:a,timeout:s,vortexLogger:r}=this.props;t||(0,i.logRateBeforeCallback)(r,s,"move_folder_selection",()=>{a.onFolderSelected(e)})}}componentDidMount(){this.props.webTimer.waitForTTI().then(()=>{this.props.vortexLogger&&this.props.vortexLogger.logRate("page_start",1)})}getDialogProps(e){const{apiClient:t,entries:a,showFoldersOnly:s,initialFolderSelection:r,webTimer:i,showSearchBar:o}=this.props,d=a&&a.map(e=>(0,l.entryIsCloudDoc)(e)?{is_dir:!1}:{is_dir:e.is_dir}),c={getFolderContents:t.getFolderContents,moveToFolder:()=>Promise.resolve(),search:t.search};if(a&&a.length>0){const s=a;c.moveToFolder=a=>t.moveEntriesToFolder(e,s,a)}return{apiClient:c,user:e,initialFolderSelection:r,operation:n.Operation.MOVE,entries:d,webTimer:i,onSuccess:this.handleSuccess,onCancel:this.handleCancel,onError:this.handleError,onFolderSelected:this.handleFolderSelected,showFoldersOnly:s,showSearchBar:o}}render(){const{accountId:e,hostSite:t,viewer:a}=this.props,r=(function(e){if("string"!=typeof e.accountId)return new Error("accountId must be provided, and it must be a string");if(null!==e.entries){if(!(e.entries instanceof Array))return new Error("entries must be provided, and they must be an array");for(const t of e.entries)if((0,l.entryIsCloudDoc)(t)){if("string"!=typeof t.cloud_doc_id)return new Error("cloud doc must have a cloud_doc_id of type string");if("string"!=typeof t.name)return new Error("cloud doc must have a name of type string")}else{if(!(0,l.entryIsFile)(t))return new Error("entry must be a file with field id or cloud doc with field cloud_doc_id");if("string"!=typeof t.id)return new Error("entry must have an id of type string");if("boolean"!=typeof t.is_dir)return new Error("file must have field is_dir of type boolean")}}if("string"!=typeof e.initialFolderSelection)return new Error("initialFolderSelection must be provided, and it must be a string");return null})(this.props);if(r)return this.props.hostSite.onError(r),null;const i=(function(e,t){const a=t.get_users(!1);for(const t of a)if(e===t.account_id)return t;return null})(e,a);return i?s.default.createElement("div",{className:"dropins-mover-parent"},s.default.createElement(o.MoveDialog,Object.assign({},this.getDialogProps(i)))):(t.onError(new Error("user with given accountId is not logged in")),null)}}d.displayName="Mover",t.MoverParent=(0,r.requireCssWithComponent)(d,["/static/metaserver/static/css/dropins_v3/mover/mover-vfl7gzMIP.css","/static/metaserver/static/css/foundation-vflZkvt4R.css","/static/metaserver/static/css/notify-vfl4oJv2S.css"])})),define("metaserver/static/js/redux/tests/store",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mockExtraArguments=void 0;t.mockExtraArguments=()=>({})})),define("metaserver/static/js/browse/shared_with/api",["require","exports","metaserver/static/js/deprecated_ajax/ajax_jquery","metaserver/static/js/api_v2/default_user_client","metaserver/static/js/sharing/api/client"],(function(e,t,a,s,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getSharedLinkExistsForFileIdOrPath=t.fetchIntegrationData=t.getSharedWithFolderData=void 0;t.getSharedWithFolderData=(e,t,s)=>{return r="/share_ajax/shared_with",i={max_results:s,fq_path_prefix:t,include_inherited:!0,sort_by_name:!0},o=!1,n=e,l=!0,new Promise((e,t)=>{(o?a.SilentBackgroundRequest:a.WebRequest)({url:r,type:"POST",dataType:"json",data:i,subject_user:n,skipNotifyError:l,success:e,error:(e,a,s)=>t(Error(`error: ${s}, status: ${a}`))})});var r,i,o,n,l};t.fetchIntegrationData=(e,t)=>(t?t():new s.DefaultUserApiV2Client(e)).ns("integrations").rpc("get_user_settings",{},{});t.getSharedLinkExistsForFileIdOrPath=(e,t)=>new r.FileShareApiClient({userId:t.id}).sharedLinkInfo({fileIdOrPath:e})})),define("metaserver/static/js/browse/shared_with/redux/initial_state",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.initialSharedWithState=void 0,t.initialSharedWithState={sharedFolderDataByTargetNamespaceId:{},hasSharedDataLoadedByParentPath:{},sharedLinkExistsByFileIdOrPath:{},sharedFileDataByFileId:{},integrationData:void 0}})),define("metaserver/static/js/browse/shared_with/redux/selectors",["require","exports","tslib","metaserver/static/js/redux/namespaces","metaserver/static/js/browse/shared_with/redux/initial_state","metaserver/static/js/redux/selectors","metaserver/static/js/browse/shared_with/types","metaserver/static/js/browse/data/selectors","lodash"],(function(e,t,a,s,r,i,o,n,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getIntegrationData=t.getDataForPath=t.getSharedLinkExistsByFile=t.getDataForFile=t.canFileBeShared=t.isSharedDataLoadedForBrowsePath=t.isSharedDataLoadedForParentPath=t.getSharedWithState=void 0,n=a.__importStar(n),l=a.__importStar(l);t.getSharedWithState=e=>(0,i.getStateAtNamespace)(e,s.BROWSE_SHARED_WITH_NAMESPACE_KEY)||r.initialSharedWithState;t.isSharedDataLoadedForParentPath=(e,a)=>{const s=(0,t.getSharedWithState)(e);return a in s.hasSharedDataLoadedByParentPath&&s.hasSharedDataLoadedByParentPath[a]};t.isSharedDataLoadedForBrowsePath=e=>{const a=n.path(e);return(0,t.isSharedDataLoadedForParentPath)(e,a)};t.canFileBeShared=e=>!(e.is_dir||e.isDeleted);t.getDataForFile=(e,a)=>{var s,r,i,o,d,c,u,_;const p=(0,t.getSharedWithState)(e),m=n.context(e);let f={};if(a&&!a.target_ns&&(0,t.canFileBeShared)(a)){const e=p.sharedFileDataByFileId[a.file_id||a.fq_path]||{},t=p.sharedFolderDataByTargetNamespaceId[m.currentNSID]||{};(null===(s=e.joinedMembers)||void 0===s?void 0:s.length)||(null===(r=e.groups)||void 0===r?void 0:r.length)||(null===(i=e.invitations)||void 0===i?void 0:i.length)||(f.audienceDescription=t.audienceDescription,f.accessTextData=t.accessTextData),f.groups=l.uniqBy(l.union(e.groups||[],t.groups||[]),e=>e.gid),f.invitations=l.uniqBy(l.union(e.invitations||[],t.invitations||[]),e=>e.email_or_fbname),f.joinedMembers=l.uniqBy(l.union(e.joinedMembers||[],t.joinedMembers||[]),e=>e.email),f.numUndisplayableUsersAndInvites=(e.numUndisplayableUsersAndInvites||0)+(t.numUndisplayableUsersAndInvites||0);let n=(null!==(d=null===(o=f.joinedMembers)||void 0===o?void 0:o.length)&&void 0!==d?d:0)+(null!==(u=null===(c=f.invitations)||void 0===c?void 0:c.length)&&void 0!==u?u:0)+(null!==(_=f.numUndisplayableUsersAndInvites)&&void 0!==_?_:0);null!=f.groups&&(n+=f.groups.map(e=>e.num_users||1).reduce((e,t)=>e+t,0)),f.memberCount=n}else f=(null==a?void 0:a.target_ns)?p.sharedFolderDataByTargetNamespaceId[a.target_ns]:p.sharedFolderDataByTargetNamespaceId[m.currentNSID];return f=Object.assign(Object.assign({},f),{sharedLinkExists:(0,t.getSharedLinkExistsByFile)(e,a)}),f.sharedLinkExists||delete f.sharedLinkExists,f};t.getSharedLinkExistsByFile=(e,a)=>{let s=!1;const r=(0,t.getSharedWithState)(e);return a&&(s=r.sharedLinkExistsByFileIdOrPath[a.fq_path]),s};t.getDataForPath=(e,a)=>{const s={},r=(0,t.getSharedWithState)(e).sharedLinkExistsByFileIdOrPath[a];return r&&(s.sharedLinkExists=r),s};t.getIntegrationData=e=>{var a;return null!==(a=(0,t.getSharedWithState)(e).integrationData)&&void 0!==a?a:o.defaultIntegrationData}})),define("metaserver/static/js/browse/shared_with/redux/slice",["require","exports","tslib","@reduxjs/toolkit","metaserver/static/js/redux/namespaces","metaserver/static/js/browse/shared_with/redux/initial_state","metaserver/static/js/browse/shared_with/api","metaserver/static/js/browse/data/selectors","metaserver/static/js/browse/shared_with/redux/selectors","metaserver/static/js/sharing/api/client","metaserver/static/js/sharing/avatar_info","metaserver/static/js/browse/shared_with/utils","metaserver/static/js/browse/shared_with/redux/selectors","metaserver/static/js/browse/shared_with/types","metaserver/static/js/core/user_i18n","metaserver/static/js/integrations/report_error"],(function(e,t,a,s,r,i,o,n,l,d,c,u,_,p,m,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SharedWithActions=t.reducer=t.loadSharedLinkDataForPath=t.sharedFileDataOutOfDate=t.sharedLinkDataOutOfDate=t.filesChanged=t.fetchIntegrationData=t.loadSharedFileDataForPath=t.pathLoaded=t.browseControllerLoaded=void 0,o=a.__importStar(o),n=a.__importStar(n),l=a.__importStar(l),m=a.__importStar(m);const h=e=>n.user(e);t.browseControllerLoaded=({path:e,files:a})=>(s,r)=>{const i=r();(0,_.isSharedDataLoadedForParentPath)(i,e)?(s(I(e)),s(t.SharedWithActions.clearSharedFileDataByFileId(null)),s(y())):s((0,t.pathLoaded)({path:e,files:a}))};t.pathLoaded=({path:e,files:a})=>a=>{a(I(e)),a(S(e)),a((0,t.loadSharedFileDataForPath)())};const S=e=>a=>{a(t.SharedWithActions.setHasSharedDataLoaded({path:e,isLoaded:!1})),a(E({parentPath:e,abortCurrentRequest:!0}))};let g=null;const E=({parentPath:e,abortCurrentRequest:t=!1})=>(a,s)=>{const r=s();t&&g&&g.abort(),n.isInsideBackupFolder(r)?a(T({parentPath:e})):a(v({parentPath:e}))},T=({parentPath:e})=>(a,s)=>{const r=s(),i=h(r),o=n.mountPoints(r),l={};o&&o.forEach((e,t)=>l[t]={memberCount:1,joinedMembers:[Object.assign(Object.assign({},i),{access_type:"owner",user_id:i.id,photo_url:i.photo_url,initials:m.getInitials(i.display_name)})]}),a(t.SharedWithActions.setSharedFolderData({parentPath:e,sharedFolderData:l}))},v=(0,s.createAsyncThunk)(`${r.BROWSE_SHARED_WITH_NAMESPACE_KEY}/fetchSharedWithData`,({parentPath:e},{getState:t,dispatch:s})=>a.__awaiter(void 0,void 0,void 0,(function*(){const a=t(),s=h(a);return yield o.getSharedWithFolderData(s,e,u.MAX_VISIBLE_AVATARS).then(t=>({sharedFolderData:(0,u.parseShareWithResponse)(t),parentPath:e})).finally(()=>g=null)})));t.loadSharedFileDataForPath=()=>e=>{e(t.SharedWithActions.clearSharedFileDataByFileId(null)),e(y())};const y=()=>(e,t)=>{const a=t(),s=l.getSharedWithState(a),r=n.sortedFiles(a).reduce((e,t)=>(!(0,_.canFileBeShared)(t)||t.file_id in s.sharedFileDataByFileId||e.push(t.file_id),e),[]);e(A(r))},A=(0,s.createAsyncThunk)(`${r.BROWSE_SHARED_WITH_NAMESPACE_KEY}/fetchSharedFileDataForFiles`,(e,{getState:t,dispatch:s,rejectWithValue:r})=>a.__awaiter(void 0,void 0,void 0,(function*(){const a=t(),i=h(a);if(!i.is_email_verified)return r("User's email is not verified.");const o=new d.FileShareApiClient({userId:i.id}),n=e.slice(0,100),l=e.slice(100);return yield o.listMembersBatch({contentIds:n,limit:u.MAX_VISIBLE_AVATARS}).then(e=>{const t={};return e.forEach((e,a)=>{t[a]={numUndisplayableUsersAndInvites:0,groups:e.groups.valueSeq().map(c.apiGroupMemberToAvatarInfo).toArray(),invitations:e.invitees.valueSeq().map(c.apiInviteeMemberToAvatarInfo).toArray(),joinedMembers:e.users.valueSeq().map(c.apiUserMemberToAvatarInfo).toArray()}}),(null==l?void 0:l.length)&&s(A(l)),{sharedFileData:t}})})));t.fetchIntegrationData=(0,s.createAsyncThunk)(`${r.BROWSE_SHARED_WITH_NAMESPACE_KEY}/fetchIntegrationData`,(e,{getState:t})=>a.__awaiter(void 0,void 0,void 0,(function*(){const e=t(),a=(0,_.getSharedWithState)(e);if(a.integrationData)return a.integrationData;const s=h(e);return yield o.fetchIntegrationData(s).then(e=>{const t=e.dismissed_prompts.find(e=>"tooltip_click_for_more_auto_display"===e[".tag"]);return Object.assign(Object.assign({},p.defaultIntegrationData),{autoDisplayTooltip:!t})})})));t.filesChanged=e=>(a,s)=>{const r=s();e===n.path(r)&&(a(t.SharedWithActions.clearSharedLinkExistsCache(null)),a(I(e)),a(E({parentPath:e})),a(t.SharedWithActions.clearSharedFileDataByFileId(null)),a(y()))};const I=(0,s.createAsyncThunk)(`${r.BROWSE_SHARED_WITH_NAMESPACE_KEY}/fetchSharedLinkExists`,(e,{getState:t})=>a.__awaiter(void 0,void 0,void 0,(function*(){const a=t(),s=n.user(a),r=new d.FileShareApiClient({userId:s.id});return yield r.sharedLinkInfo({fileIdOrPath:e}).then(t=>({fileIdOrPath:e,sharedLinkExists:(null==t?void 0:t.length)>0}))})));t.sharedLinkDataOutOfDate=e=>t=>{e.forEach(e=>t(I(e)))};t.sharedFileDataOutOfDate=e=>t=>{t(A(e))};t.loadSharedLinkDataForPath=e=>(t,a)=>{const s=a(),r=(0,_.getSharedWithState)(s);e in r.sharedLinkExistsByFileIdOrPath||t(I(e))};const b=(0,s.createSlice)({name:r.BROWSE_SHARED_WITH_NAMESPACE_KEY,initialState:i.initialSharedWithState,reducers:{clearSharedFileDataByFileId:(e,t)=>{e.sharedFileDataByFileId={}},clearSharedLinkExistsCache:(e,t)=>{e.sharedLinkExistsByFileIdOrPath={}},setHasSharedDataLoaded:(e,t)=>{const{payload:a}=t;e.hasSharedDataLoadedByParentPath[a.parentPath]=a.isLoaded},setSharedFolderData:(e,t)=>{const{payload:a}=t;e.hasSharedDataLoadedByParentPath[a.parentPath]=!0,e.sharedFolderDataByTargetNamespaceId=a.sharedFolderData},setNamespaceSharedWithData:(e,t)=>{const{payload:a}=t;e.sharedFolderDataByTargetNamespaceId=a.sharedFolderData,e.hasSharedDataLoadedByParentPath[a.parentPath]=!0}},extraReducers:e=>{e.addCase(v.fulfilled,(e,{payload:t})=>{const a=Object.assign({},e.hasSharedDataLoadedByParentPath);return a[t.parentPath]=!0,Object.assign(Object.assign({},e),{hasSharedDataLoadedByParentPath:a,sharedFolderDataByTargetNamespaceId:t.sharedFolderData})}).addCase(A.fulfilled,(e,{payload:t})=>Object.assign(Object.assign({},e),{sharedFileDataByFileId:Object.assign(Object.assign({},e.sharedFileDataByFileId),t.sharedFileData)})).addCase(t.fetchIntegrationData.fulfilled,(e,{payload:t})=>{e.integrationData=t}).addCase(t.fetchIntegrationData.rejected,(e,t)=>{(0,f.webReportError)(t.error,"non-critical",["ProfileCard"],{endpoint:"integrations/get_user_settings",entry_point:"browse page side bar"})}).addCase(I.fulfilled,(e,t)=>{e.sharedLinkExistsByFileIdOrPath[t.payload.fileIdOrPath]=t.payload.sharedLinkExists})}});t.reducer=b.reducer,t.SharedWithActions=b.actions})),define("metaserver/static/js/browse/shared_with/redux/store",["require","exports","metaserver/static/js/redux/namespaces","metaserver/static/js/redux/store","metaserver/static/js/browse/shared_with/redux/slice"],(function(e,t,a,s,r){"use strict";let i;Object.defineProperty(t,"__esModule",{value:!0}),t.getStoreForSharedWith=void 0;t.getStoreForSharedWith=()=>(i||(i=(0,s.getStoreAndRegisterReducers)({[a.BROWSE_SHARED_WITH_NAMESPACE_KEY]:r.reducer})),i)})),define("metaserver/static/js/browse/shared_with/types",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.defaultIntegrationData=void 0,t.defaultIntegrationData={autoDisplayTooltip:!1}})),define("metaserver/static/js/browse/shared_with/utils",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseShareWithResponse=t.MAX_VISIBLE_AVATARS=void 0,t.MAX_VISIBLE_AVATARS=5;t.parseShareWithResponse=e=>{const t={};for(const a of e)t[a.ns_id]={numUndisplayableUsersAndInvites:a.num_avatars_not_shown,groups:a.groups,invitations:a.invitations,joinedMembers:a.joined_members,audienceDescription:a.audience_description,memberCount:a.num_users_and_invites,accessTextData:{total_groups_and_users:a.total_groups_and_users,total_unique_inherited_members:a.total_unique_inherited_members,total_unique_users:a.total_unique_users,users_outside_team:a.users_outside_team,is_confidential:a.is_confidential,is_parent_tsd:a.is_parent_tsd,is_parent_namespace:a.is_parent_namespace,has_team_group:a.has_team_group,has_group:a.has_group}};return t}})),define("metaserver/static/js/file_actions/metrics",["require","exports","metaserver/static/js/metrics/index"],(function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.recordPathLookupErrors=t.batchContentType=t.bucketForBatchSize=t.FILE_ACTIONS_AMP_NAMESPACE=void 0,t.FILE_ACTIONS_AMP_NAMESPACE="web_file_actions",t.bucketForBatchSize=function(e){return 1===e?"single":e<=10?"small":e<=100?"medium":e<=1e3?"large":"massive"},t.batchContentType=function(e){return e.every(e=>e.is_dir)?"folders":e.every(e=>!e.is_dir)?"files":"mixed"};t.recordPathLookupErrors=function(e,s,r){const i={};e.forEach(e=>{if("path_lookup"===e.failure[".tag"]){const t=e.failure.path_lookup[".tag"];i[t]=(i[t]||0)+1}});for(const e in i)i.hasOwnProperty(e)&&(0,a.getMetricsReporter)().createStats({ns:t.FILE_ACTIONS_AMP_NAMESPACE,name:"common/failure/path_lookup"},Object.assign(Object.assign({},r),{lookupFailureType:e,operation:s})).record(i[e])}})),define("metaserver/static/js/file_operations/notifications",["require","exports","tslib","lodash","metaserver/static/js/clean/browse_interface","metaserver/static/js/clean/em_string","js/filepath/filepath","metaserver/static/js/browse/api","metaserver/static/js/clean/undo","metaserver/static/js/core/html","metaserver/static/js/core/i18n","metaserver/static/js/core/notify"],(function(e,t,a,s,r,i,o,n,l,d,c,u){"use strict";function _(e,t,a,s){l.notifyWithUndo(e,a,()=>n.rollbackChangeSets({changesets:a,userId:t.id,progressText:c.intl.formatMessage({id:"wKzr7W",defaultMessage:"Undoing"}),onSuccess:()=>{u.Notify.success(c.intl.formatMessage({id:"t6mPeQ",defaultMessage:"Undo complete."})),s&&s()}}))}function p(e,t){const a=r.browse_uri_for_fq_path(t,e),n=i.Emstring.em_snippet(o.filename(e),40);return{href:a,text:s.escape(n)}}Object.defineProperty(t,"__esModule",{value:!0}),t.notifyRestoreSuccess=t.notifyPurgeSuccess=t.notifyFolderCreationSuccess=t.notifyRenameSuccess=t.notifyDeleteSuccess=t.notifyMoveSuccess=t.notifyCopySuccess=void 0,s=a.__importStar(s),r=a.__importStar(r),o=a.__importStar(o),n=a.__importStar(n),l=a.__importStar(l),t.notifyCopySuccess=function(e,t,a,s,r){let i;if(s){const a=p(s,t);i=c.intl.formatMessage({id:"UZ+XVI",defaultMessage:"{count, plural, one{Copied {count} item to {dest}.} other{Copied {count} items to {dest}.}}"},{count:e,dest:`<a href="${a.href.toString()}">${a.text}</a>`}),i=new d.HTML(i)}else i=c.intl.formatMessage({id:"BDtFp+",defaultMessage:"{count, plural, one{Copied {count} item.} other{Copied {count} items.}}"},{count:e});_(i,t,a,r)},t.notifyMoveSuccess=function(e,t,a,s,r){let i;if(s){const a=p(s,t);i=c.intl.formatMessage({id:"GBu2Ic",defaultMessage:"{count, plural, one{Moved {count} item to {dest}.} other{Moved {count} items to {dest}.}}"},{count:e,dest:`<a href="${a.href.toString()}">${a.text}</a>`}),i=new d.HTML(i)}else i=c.intl.formatMessage({id:"tFGyx0",defaultMessage:"{count, plural, one{Moved {count} item.} other{Moved {count} items.}}"},{count:e});_(i,t,a,r)},t.notifyDeleteSuccess=function(e,t,a,s){_(c.intl.formatMessage({id:"THAbub",defaultMessage:"{count, plural, one{Deleted {count} item.} other{Deleted {count} items.}}"},{count:e}),t,a,s)},t.notifyRenameSuccess=function(e,t,a){_(c.intl.formatMessage({id:"sAZa2U",defaultMessage:"Rename complete."}),e,t,a)},t.notifyFolderCreationSuccess=function(e,t,a){_(c.intl.formatMessage({id:"ndMNx/",defaultMessage:"Created folder {folder_name}."},{folder_name:e}),t,a)},t.notifyPurgeSuccess=function(e){const t=c.intl.formatMessage({id:"jh+GyF",defaultMessage:"{count, plural, one{Permanently deleted {count} item.} other{Permanently deleted {count} items.}}"},{count:e});u.Notify.success(t)},t.notifyRestoreSuccess=function(e){let t;const a=e.length;if(1===a){const a=s.escape(o.filename(e[0].fq_path));t=c.intl.formatMessage({id:"TAukDw",defaultMessage:"Restored <strong>{filename}</strong>."},{strong:e=>`<strong>${e}</strong>`,filename:a}),t=new d.HTML(t)}else t=c.intl.formatMessage({id:"8N7KT8",defaultMessage:"{count, plural, one{Restored {count} file.} other{Restored {count} files.}}"},{count:a});u.Notify.success(t,30)}})),define("metaserver/static/js/files_view/file_actions/file_from_metadata",["require","exports","metaserver/static/js/browse/models"],(function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.folderFromFolderMetadata=t.fileFromMetadata=void 0;t.fileFromMetadata=(e,t)=>{if("file"===t[".tag"]){const s=t,r=Object.assign(Object.assign({},e),{fq_path:s.path_display||e.fq_path,icon:s.icon+"_32",revision_id:s.rev,file_id:s.id});return new a.File(r)}return"folder"===t[".tag"]?new a.File(Object.assign(Object.assign({},e),{fq_path:t.path_display||e.fq_path})):e};t.folderFromFolderMetadata=e=>new a.File({file_id:e.id,fq_path:e.path_display||"",icon:e.icon,is_dir:!0})})),define("metaserver/static/js/files_view/file_actions/rollback",["require","exports","tslib","metaserver/static/js/browse/api","metaserver/static/js/core/i18n"],(function(e,t,a,s,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.rollback=void 0,s=a.__importStar(s);t.rollback=({changeset_data:e,userId:t,onSuccess:a})=>{const i={};for(const{ns_id:t,op_id:a}of e){const e=parseInt(a.slice(6),10);i.hasOwnProperty(t)?i[t].push(e):i[t]=[e]}s.rollbackChangeSets({changesets:i,onSuccess:a,userId:t,progressText:r.intl.formatMessage({id:"wKzr7W",defaultMessage:"Undoing"})})}})),define("metaserver/static/js/folder_overview/data/reducer",["require","exports","metaserver/static/js/browse/data/types","metaserver/static/js/browse/models","metaserver/static/js/folder_overview/data/types","metaserver/static/js/folder_overview/utils","metaserver/static/js/search/single_page/data/types"],(function(e,t,a,s,r,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.folderOverviewReducer=t.defaultFolderOverviewState=void 0,t.defaultFolderOverviewState={folderDataCache:{},fileIdCache:{},accountCache:{},nsIdCache:{},componentDataCache:{}};const n=(e,t)=>{const a=e.componentDataCache[t];return a||{requiredComponents:[],loadedComponents:[],hasFailedToLoad:!1,descriptionHasFocus:!1}},l=e=>{const t={};return e.forEach(e=>{t[(0,i.normalizePath)(e.fq_path)]=e.target_ns?`ns:${e.target_ns}/`:`ns:${e.ns_id}/${e.ns_path}`}),t};t.folderOverviewReducer=function(e=t.defaultFolderOverviewState,d){switch(d.type){case r.ActionTypes.UPDATE_FOLDER_DATA_CACHE:return((e,{fileId:t,folderData:a})=>Object.assign(Object.assign({},e),{folderDataCache:Object.assign(Object.assign({},e.folderDataCache),{[t]:Object.assign(Object.assign({},e.folderDataCache[t]),a)})}))(e,d.payload);case r.ActionTypes.UPDATE_FILE_ID_CACHE:return((e,{fileIdCache:t})=>Object.assign(Object.assign({},e),{fileIdCache:Object.assign(Object.assign({},e.fileIdCache),t)}))(e,d.payload);case r.ActionTypes.UPDATE_ACCOUNT_CACHE:return((e,{accountCache:t})=>Object.assign(Object.assign({},e),{accountCache:Object.assign(Object.assign({},e.accountCache),t)}))(e,d.payload);case r.ActionTypes.SET_REQUIRED_COMPONENTS:return((e,{componentNamespace:t,requiredComponents:a})=>{const s=n(e,t);return Object.assign(Object.assign({},e),{componentDataCache:Object.assign(Object.assign({},e.componentDataCache),{[t]:Object.assign(Object.assign({},s),{requiredComponents:a})})})})(e,d.payload);case a.ActionTypes.SET_CONTEXT:return((e,{context:t})=>Object.assign(Object.assign({},e),{nsIdCache:Object.assign(Object.assign({},e.nsIdCache),{[(0,i.normalizePath)(t.currentFQPath)]:`ns:${t.currentNSID}/${t.currentNSPath}`})}))(e,d.payload);case r.ActionTypes.REMOVE_LOADED_COMPONENT:return((e,{componentNamespace:t,component:a})=>{const s=n(e,t),r=s.loadedComponents;return Object.assign(Object.assign({},e),{componentDataCache:Object.assign(Object.assign({},e.componentDataCache),{[t]:Object.assign(Object.assign({},s),{loadedComponents:r.filter(e=>e!==a)})})})})(e,d.payload);case r.ActionTypes.ADD_LOADED_COMPONENT:return((e,{componentNamespace:t,component:a})=>{const s=n(e,t),r=s.loadedComponents;return r.includes(a)?e:Object.assign(Object.assign({},e),{componentDataCache:Object.assign(Object.assign({},e.componentDataCache),{[t]:Object.assign(Object.assign({},s),{loadedComponents:[...r,a]})})})})(e,d.payload);case r.ActionTypes.SET_FAILED_TO_LOAD:return((e,{componentNamespace:t,hasFailedToLoad:a})=>{const s=n(e,t);return Object.assign(Object.assign({},e),{componentDataCache:Object.assign(Object.assign({},e.componentDataCache),{[t]:Object.assign(Object.assign({},s),{hasFailedToLoad:a})})})})(e,d.payload);case r.ActionTypes.SET_DESCRIPTION_HAS_FOCUS:return((e,{componentNamespace:t,descriptionHasFocus:a})=>{const s=n(e,t);return Object.assign(Object.assign({},e),{componentDataCache:Object.assign(Object.assign({},e.componentDataCache),{[t]:Object.assign(Object.assign({},s),{descriptionHasFocus:a})})})})(e,d.payload);case a.ActionTypes.SET_UNSORTED_FILES:return((e,{unsortedFiles:t})=>{const a=t.filter(e=>e.is_dir).toArray();return Object.assign(Object.assign({},e),{nsIdCache:Object.assign(Object.assign({},e.nsIdCache),l(a))})})(e,d.payload);case o.ActionTypes.SET_RESULTS:case o.ActionTypes.APPEND_RESULTS:return((e,{searchResults:t})=>{const a=t.results.filter(e=>e instanceof s.File&&e.is_dir);return Object.assign(Object.assign({},e),{nsIdCache:Object.assign(Object.assign({},e.nsIdCache),l(a))})})(e,d.payload)}return e}})),define("metaserver/static/js/folder_overview/data/store",["require","exports","metaserver/static/js/folder_overview/data/reducer","metaserver/static/js/redux/store","metaserver/static/js/redux/namespaces"],(function(e,t,a,s,r){"use strict";let i;Object.defineProperty(t,"__esModule",{value:!0}),t.getStoreForFolderOverview=void 0;t.getStoreForFolderOverview=()=>(i||(i=(0,s.getStoreAndRegisterReducers)({[r.FOLDER_OVERVIEW_NAMESPACE_KEY]:a.folderOverviewReducer})),i)})),define("metaserver/static/js/folder_overview/data/types",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DescriptionSaveState=t.ActionTypes=void 0,(function(e){e.UPDATE_FOLDER_DATA_CACHE="FOLDER_OVERVIEW/UPDATE_FOLDER_DATA_CACHE",e.UPDATE_FILE_ID_CACHE="FOLDER_OVERVIEW/UPDATE_FILE_ID_CACHE",e.REMOVE_LOADED_COMPONENT="FOLDER_OVERVIEW/REMOVE_LOADED_COMPONENT",e.ADD_LOADED_COMPONENT="FOLDER_OVERVIEW/ADD_LOADED_COMPONENT",e.SET_FAILED_TO_LOAD="FOLDER_OVERVIEW/SET_FAILED_TO_LOAD",e.SET_DESCRIPTION_HAS_FOCUS="FOLDER_OVERVIEW/SET_DESCRIPTION_HAS_FOCUS",e.UPDATE_ACCOUNT_CACHE="FOLDER_OVERVIEW/UPDATE_ACCOUNT_CACHE",e.SET_REQUIRED_COMPONENTS="FOLDER_OVERVIEW/SET_REQUIRED_COMPONENTS"})(t.ActionTypes||(t.ActionTypes={})),(function(e){e.IDLE="IDLE",e.SAVING="SAVING",e.CONFLICT="CONFLICT",e.ERROR="ERROR"})(t.DescriptionSaveState||(t.DescriptionSaveState={}))})),define("metaserver/static/js/folder_overview/utils",["require","exports","tslib","js/filepath/filepath","metaserver/static/js/browse/models","metaserver/static/js/core/i18n","typescript/libraries/comments2/src/components/folder_overview_utils/index"],(function(e,t,a,s,r,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.canEditOverviewForFile=t.userInitials=t.fileToContentReferenceId=t.pathFromSharingFolder=t.extractSharedFolderPath=t.extractSharedFolderId=t.getFileExtension=t.convertContentReferencesToSortedFiles=t.hasUnsavedDescriptionDraft=t.normalizePath=t.convertDbxUserToIUser=void 0,s=a.__importStar(s);t.convertDbxUserToIUser=e=>({id:e.id.toString(),name:{display:e.display_name,initials:[e.fname.substr(0,1),e.lname.substr(0,1)].join(""),public:e.familiar_name},photoUrl:e.initials_url});t.normalizePath=e=>s.normalize(e).toLowerCase();t.hasUnsavedDescriptionDraft=e=>{if(!e)return!1;try{const t=void 0===e.description||""===e.description||(0,o.isEmptyDescription)(JSON.parse(e.description)),a=void 0===e.descriptionDraft||""===e.descriptionDraft||(0,o.isEmptyDescription)(JSON.parse(e.descriptionDraft));if(t&&a)return!1}catch(e){}return e.description!==e.descriptionDraft&&void 0!==e.descriptionDraft};t.convertContentReferencesToSortedFiles=e=>{const a=[];e.forEach(e=>{const s={file_id:e.file_id,fq_path:e.fq_path,href:e.href,icon:e.icon,is_cloud_doc:e.is_cloud_doc,is_dir:e.is_dir,thumbnail_url_tmpl:e.thumbnail_url_tmpl,ns_id:e.ns_id,ns_path:e.ns_path,sjid:e.sjid,isDeleted:e.is_deleted,ext:(0,t.getFileExtension)(e.fq_path)},i=new r.File(s);a.push(i)});const s=(0,i.case_insensitive_comparator)(!0);return a.sort((e,t)=>s(r.File.getFilename(e),r.File.getFilename(t)))};t.getFileExtension=e=>{if(!e)return"";const t=s.file_extension(e);return t?`.${t}`:""};t.extractSharedFolderId=e=>{const t=/^ns:([0-9]+)\/?/.exec(e);return t?t[1]:void 0};t.extractSharedFolderPath=e=>{const t=/^ns:[0-9]+\/?(.*)/.exec(e);return t?t[1]:void 0};t.pathFromSharingFolder=(e,t)=>e.length>=t.length?s.filename(t):[s.filename(e),...t.substr(e.length).split("/").filter(e=>!!e)].join("  ");t.fileToContentReferenceId=e=>e.is_dir&&e.target_ns?`ns:${e.target_ns}`:e.file_id;t.userInitials=e=>(e=>"fname"in e)(e)?e.fname.substr(0,1)+e.lname.substr(0,1):e.name.given_name.substr(0,1)+e.name.surname.substr(0,1);t.canEditOverviewForFile=e=>(!e.is_dir||!e.isDeleted)&&(e.target_ns?!e._mount_access_perms||!(!e._mount_access_perms||!e._mount_access_perms.includes("can_edit")):!e.read_only)})),define("metaserver/static/js/search/single_page/data/types",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ActionTypes=void 0,(function(e){e.SET_VARIANT="SEARCH/SET_VARIANT",e.SET_USER="SEARCH/SET_USER",e.SET_EXPERIMENTS="SEARCH/SET_EXPERIMENTS",e.SET_PATH="SEARCH/SET_PATH",e.SET_QUERY="SEARCH/SET_QUERY",e.SET_FILE_CATEGORIES="SEARCH/SET_FILE_CATEGORIES",e.SET_RESULTS="SEARCH/SET_RESULTS",e.CLEAR_RESULTS="SEARCH/CLEAR_RESULTS",e.APPEND_RESULTS="SEARCH/APPEND_RESULTS",e.SET_LOADING_STATE="SEARCH/SET_LOADING_STATE",e.SET_TYPEAHEAD_SESSION_ID="SEARCH/SET_TYPEAHEAD_SESSION_ID",e.SET_SEARCH_SESSION_ID="SEARCH/SET_SEARCH_SESSION_ID",e.SET_SEARCH_SESSION_QUERY_ID="SEARCH/SET_SEARCH_SESSION_QUERY_ID",e.SET_PREVIOUS_SEARCH_SESSION_QUERY_ID="SEARCH/SET_PREVIOUS_SEARCH_SESSION_QUERY_ID",e.SET_REQUEST_ID="SEARCH/SET_REQUEST_ID",e.SET_SELECTION="SEARCH/SET_SELECTION",e.SET_PREVIEW_FILE_ID="SEARCH/SET_PREVIEW_FILE",e.SET_PREVIEW_COMMENTS_THREAD_ID="SEARCH/SET_PREVIEW_COMMENTS_THREAD_ID",e.SET_SORT_ORDER="SEARCH/SET_SORT_ORDER",e.CLEAR_TTI_COMPONENTS="SEARCH/CLEAR_TTI_COMPONENTS",e.SET_IMAGE_SUGGESTION="SEARCH/SET_IMAGE_SUGGESTION",e.UPDATE_FILE_IN_RESULTS="SEARCH/UPDATE_FILE_IN_RESULTS",e.UPDATE_RESULTS="SEARCH/UPDATE_RESULTS",e.REMOVE_RESULTS="SEARCH/REMOVE_RESULTS",e.RENAME_FILE="SEARCH/RENAME_FILE",e.DELETE_FILES="SEARCH/DELETE_FILES",e.PURGE_FILES="SEARCH/PURGE_FILES",e.RESTORE_FILES="SEARCH/RESTORE_FILES",e.SET_QUERY_HISTORY="SEARCH/SET_QUERY_HISTORY",e.SET_HIGHLIGHTED_ROW="SEARCH/SET_HIGHLIGHTED_ROW",e.UPDATE_QUERY_SUGGESTIONS_CACHE="SEARCH/UPDATE_QUERY_SUGGESTIONS_CACHE",e.SET_LAST_QUERY_WITH_QUERY_SUGGESTIONS_LOADED="SEARCH/SET_LAST_QUERY_WITH_QUERY_SUGGESTIONS_LOADED",e.SET_FILTERED_ACCOUNT_ID="SEARCH/SET_FILTERED_ACCOUNT_ID",e.SET_SUGGESTED_PEOPLE_FOR_FILTERS="SEARCH/SET_SUGGESTED_PEOPLE_FOR_FILTERS",e.UPDATE_PEOPLE_SUGGESTIONS_CACHE="SEARCH/UPDATE_PEOPLE_SUGGESTIONS_CACHE",e.SET_LAST_QUERY_WITH_PEOPLE_SUGGESTIONS_LOADED="SEARCH/SET_LAST_QUERY_WITH_PEOPLE_SUGGESTIONS_LOADED",e.SET_DWELL_TIME="SEARCH/SET_DWELL_TIME",e.SET_QUERY_START_TIME="SEARCH/SET_QUERY_START_TIME",e.SET_IS_CREATING_SHARED_LINK="SEARCH/SET_IS_CREATING_SHARED_LINK",e.UPDATE_TAGS_SUGGESTIONS_CACHE="SEARCH/UPDATE_TAGS_SUGGESTIONS_CACHE",e.SET_LAST_QUERY_WITH_TAGS_SUGGESTIONS_LOADED="SEARCH/SET_LAST_QUERY_WITH_TAGS_SUGGESTIONS_LOADED",e.SET_LAST_MODIFIED_DATE="SEARCH/SET_LAST_MODIFIED_DATE",e.SET_DATE_TAKEN="SEARCH/SET_DATE_TAKEN_VALUE",e.SET_SELECTED_DIMENSIONS="SEARCH/SET_SELECTED_DIMENSIONS",e.SET_MEDIA_DATA="SEARCH/SET_MEDIA_DATA",e.UPDATE_RESULT_SUGGESTIONS_CACHE="SEARCH/UPDATE_RESULT_SUGGESTIONS_CACHE",e.SET_EXPANDED_BLADE="SEARCH/SET_EXPANDED_BLADE",e.SET_IS_SEARCH_QUERY_UP_TO_DATE_WITH_FILTERS="SEARCH/SET_IS_SEARCH_QUERY_UP_TO_DATE_WITH_FILTERS",e.SET_IS_FILTERS_UP_TO_DATE_WITH_SEARCH_QUERY="SEARCH/SET_IS_FILTERS_UP_TO_DATE_WITH_SEARCH_QUERY"})(t.ActionTypes||(t.ActionTypes={}))})),define("metaserver/static/js/tagging/constants",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MAX_TAGS_PER_ITEM=void 0,t.MAX_TAGS_PER_ITEM=20})),define("metaserver/static/js/tagging/data/action_creators",["require","exports","tslib","lodash","metaserver/static/js/core/i18n","js/filepath/filepath","metaserver/static/js/clean/ui/snackbar","metaserver/static/js/tagging/data/selectors/index","metaserver/static/js/tagging/data/types","metaserver/static/js/tagging/api","metaserver/static/js/tagging/constants","metaserver/static/js/tagging/logger","metaserver/static/js/tagging/utils"],(function(e,t,a,s,r,i,o,n,l,d,c,u,_){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fetchAllTagsSuggestions=t.fetchTagsForFiles=t.setAllTags=t.fileRename=t.removeTagFromFiles=t.addTagToFiles=void 0,i=a.__importStar(i),n=a.__importStar(n),u=a.__importStar(u);const p=({fileToTags:e,override:t})=>({type:l.ActionTypes.SET_FILE_TO_TAGS_MAP,payload:{fileToTags:e,override:t}});t.addTagToFiles=function({user:e,files:t,tag:l,onPartialError:m,onSuccess:f,autoTagFolderContents:h,actionSurface:S}){return(g,E)=>a.__awaiter(this,void 0,void 0,(function*(){const a=n.selectTagsByFile(E()),T=(0,_.tagTextToTagUserGeneratedTag)(l),v=t[0];if(1!==t.length||h)try{o.Snackbar.sync(r.intl.formatMessage({id:"U2RxSG",defaultMessage:"Tagging"}),!0,"add-tag-bulk");let a=!1;if(h){const s=yield d.tagsApiClient.listFolder((0,_.getFileObjectNsIdAndPath)(v).nsPath,e);t=s.files,a=s.reachedLimit}const y=yield d.tagsApiClient.addTagBulk(e,l,t),A=t.filter(e=>-1===y.findIndex(t=>{const a=(0,_.getFileObjectNsIdAndPath)(e);return a.nsId===t.ns_id&&a.nsPath===t.ns_path})),I=y.length,b=A.length,O=t.filter(e=>{var t;return(null===(t=e.tags)||void 0===t?void 0:t.length)===c.MAX_TAGS_PER_ITEM}).length,F=t.filter(e=>!(0,_.fileHasEditPermissions)(e)).length,R=A.reduce((e,t)=>{const a=(0,_.getFileMapKey)(t),r=n.selectTagsByFile(E())[a],i=(0,s.uniq)([T,...null!=r?r:[]]);return Object.assign(Object.assign({},e),{[a]:i})},{});if(u.logAddTag(e,A,l,S),g(p({fileToTags:R})),0===y.length&&!a)return o.Snackbar.close(),void f(!0,b,h);if(m(A),a)return void o.Snackbar.complete(r.intl.formatMessage({id:"Y9TAaz",defaultMessage:"Tagged {numOfSuccesses} of the files in {folderName}."},{numOfSuccesses:b,folderName:i.filename(v.fq_path)}),"add-tag-bulk");if(O>0&&F>0)return void o.Snackbar.complete(r.intl.formatMessage({id:"Evli0B",defaultMessage:"Tagged {numOfSuccesses} items #{tag}. Couldnt tag {numOfFailures} files or folders."},{numOfSuccesses:b,tag:l,numOfFailures:I}),"add-tag-bulk");if(O>0)return void o.Snackbar.complete(r.intl.formatMessage({id:"jk4Wg3",defaultMessage:"Tagged {numOfSuccesses} items #{tag}. Couldnt tag {numOfFailures} items that dont have room for more tags."},{numOfSuccesses:b,tag:l,numOfFailures:I}),"add-tag-bulk");o.Snackbar.complete(r.intl.formatMessage({id:"JmcOdr",defaultMessage:"Tagged {numOfSuccesses} items #{tag}. Couldnt tag {numOfFailures} files or folders without editing access."},{numOfSuccesses:b,tag:l,numOfFailures:I}),"add-tag-bulk")}catch(s){g(p({fileToTags:a,override:!0})),u.logFailTag(e,t,l,S),o.Snackbar.fail(r.intl.formatMessage({id:"8bKaBW",defaultMessage:"Couldnt tag these files or folders."}),"add-tag-bulk")}else{const c=(0,_.getFileMapKey)(v),m=n.selectTagsByFile(E())[c],y=(0,s.uniq)([T,...null!=m?m:[]]);g(p({fileToTags:{[c]:y}}));try{yield d.tagsApiClient.addTag(e,l,v),u.logAddTag(e,t,l,S)}catch(s){return g(p({fileToTags:a,override:!0})),u.logFailTag(e,t,l,S),void o.Snackbar.fail(r.intl.formatMessage({id:"IibVuC",defaultMessage:"Couldnt add #{tag} to {fileName}."},{tag:l,fileName:i.filename(v.fq_path)}))}f(!1,1,h)}}))};t.removeTagFromFiles=function({user:t,files:s,tag:l,actionSurface:c}){return(m,f)=>a.__awaiter(this,void 0,void 0,(function*(){var h;const S=l.tag_text,g=n.selectTagsByFile(f());if(1===s.length){const e=(0,_.getFileMapKey)(s[0]),a=n.selectTagsByFile(f())[e],E=null!==(h=null==a?void 0:a.filter(e=>e.tag_text!==S))&&void 0!==h?h:[];m(p({fileToTags:{[e]:E}}));try{yield d.tagsApiClient.removeTag(t,S,s[0]),u.logRemoveTag(t,s,l,c)}catch(e){m(p({fileToTags:g,override:!0})),o.Snackbar.fail(r.intl.formatMessage({id:"zXNhaY",defaultMessage:"Couldnt remove #{tag} from {fileName}."},{tag:S,fileName:i.filename(s[0].fq_path)}))}return}const{showRemoveTagsModal:E}=yield new Promise((t,a)=>{e(["metaserver/static/js/tagging/components/remove_tags_modal"],t,a)}).then(a.__importStar);E({numOfFiles:s.length,tag:S,onRemoveClick:()=>a.__awaiter(this,void 0,void 0,(function*(){try{o.Snackbar.sync(r.intl.formatMessage({id:"FAj93H",defaultMessage:"Removing tags"}),!0,"remove-tag-bulk");const e=yield d.tagsApiClient.removeTagBulk(t,S,s),a=s.filter(t=>-1===e.findIndex(e=>{const a=(0,_.getFileObjectNsIdAndPath)(t);return a.nsId===e.ns_id&&a.nsPath===e.ns_path})),i=a.reduce((e,t)=>{var a;const s=(0,_.getFileMapKey)(t),r=n.selectTagsByFile(f())[s],i=null!==(a=null==r?void 0:r.filter(e=>e.tag_text!==S))&&void 0!==a?a:[];return Object.assign(Object.assign({},e),{[s]:i})},{});u.logRemoveTag(t,a,l,c),m(p({fileToTags:i})),o.Snackbar.complete(r.intl.formatMessage({id:"fXEVtA",defaultMessage:"Removed #{tag} from {numOfFiles} files."},{numOfFiles:a.length,tag:S}),"remove-tag-bulk")}catch(e){m(p({fileToTags:g,override:!0})),o.Snackbar.fail(r.intl.formatMessage({id:"YV4k+f",defaultMessage:"Couldnt remove #{tag}."},{tag:S}),"remove-tag-bulk")}}))})}))};t.fileRename=({file:e,newFile:t})=>({type:l.ActionTypes.FILE_RENAME,payload:{file:e,newFile:t}});t.setAllTags=({tags:e})=>({type:l.ActionTypes.SET_ALL_TAGS,payload:{tags:e}});t.fetchTagsForFiles=function({user:e,files:t,override:a=!1}){return(s,r)=>{0!==t.length&&d.tagsApiClient.getTags(e,t).then(e=>{s(p({fileToTags:e,override:a}))})}};t.fetchAllTagsSuggestions=function({user:e,onSuccess:a}){return(s,r)=>{void 0===n.selectAllTagsSuggestions(r())&&d.tagsApiClient.getAllTags(e).then(e=>{s((0,t.setAllTags)({tags:e})),null==a||a()})}}})),define("metaserver/static/js/tagging/api",["require","exports","tslib","metaserver/static/js/api_v2/default_user_client","metaserver/static/js/tagging/utils","metaserver/static/js/browse/models"],(function(e,t,a,s,r,i){"use strict";function o(e){const t=(0,r.getFileObjectNsIdAndPath)(e);return{ns_id:t.nsId,ns_path:t.nsPath}}Object.defineProperty(t,"__esModule",{value:!0}),t.tagsApiClient=t.TagsApiClient=void 0;const n=e=>new Promise(t=>setTimeout(t,e));class l{getTags(e,t){return a.__awaiter(this,void 0,void 0,(function*(){const a=new s.DefaultUserApiV2Client(e),i={content_ids:t.map(o)};return(yield a.ns("manual_tagging").rpc("tags/get",i,{})).tags_by_content_id.reduce((e,{content_id:{ns_id:t,ns_path:a},tags:s,typed_tags:i})=>(e[(0,r.getFileObjectNsIdAndPathKey)({nsId:t,nsPath:a})]=((e,t)=>t?t.filter(r.isTextTag):e.map(e=>({".tag":"user_generated_tag",tag_text:e})))(s,i),e),{})}))}getAllTags(e){return a.__awaiter(this,void 0,void 0,(function*(){const t=new s.DefaultUserApiV2Client(e);return(yield t.ns("manual_tagging").rpc("tags/get_viewable_tags",void 0,{})).tag_and_counts.map(e=>e.typed_tag).filter(r.isTextTag)}))}addTag(e,t,r){return a.__awaiter(this,void 0,void 0,(function*(){const a=new s.DefaultUserApiV2Client(e),i={tag:t,content_id:o(r)};return(yield a.ns("manual_tagging").rpc("tag/add",i,{})).hlc}))}addTagBulk(e,t,r){return a.__awaiter(this,void 0,void 0,(function*(){const i=new s.DefaultUserApiV2Client(e),l={tag:t,content_ids:r.map(o)},d=yield i.ns("manual_tagging").rpc("tag/add_bulk",l,{});if("complete"===d[".tag"])return d.failed;if("failed"===d[".tag"])throw new Error("tag/add_bulk failed");const{async_job_id:c}=d,u=()=>a.__awaiter(this,void 0,void 0,(function*(){return yield i.ns("manual_tagging").rpc("tag/add_bulk/check",{async_job_id:c},{})}));let _=yield u();for(;"in_progress"===_[".tag"];)yield n(1e3),_=yield u();if("failed"===_[".tag"]||"other"===_[".tag"])throw new Error("tag/add_bulk failed");return _.failed}))}removeTag(e,t,r){return a.__awaiter(this,void 0,void 0,(function*(){const a=new s.DefaultUserApiV2Client(e),i={tag:t,content_id:o(r)};return(yield a.ns("manual_tagging").rpc("tag/remove",i,{})).hlc}))}removeTagBulk(e,t,r){return a.__awaiter(this,void 0,void 0,(function*(){const i=new s.DefaultUserApiV2Client(e),l={tag:t,content_ids:r.map(o)},d=yield i.ns("manual_tagging").rpc("tag/remove_bulk",l,{});if("complete"===d[".tag"])return d.failed;if("failed"===d[".tag"])throw new Error("tag/remove_bulk failed");const{async_job_id:c}=d,u=()=>a.__awaiter(this,void 0,void 0,(function*(){return yield i.ns("manual_tagging").rpc("tag/remove_bulk/check",{async_job_id:c},{})}));let _=yield u();for(;"in_progress"===_[".tag"];)yield n(1e3),_=yield u();if("failed"===_[".tag"]||"other"===_[".tag"])throw new Error("tag/remove_bulk failed");return _.failed}))}listFolder(e,t){var r,o;return a.__awaiter(this,void 0,void 0,(function*(){try{"/"===e&&(e="");const a={fq_path:e,include_deleted:!1,sort_is_ascending:!1,sort_folders_first:!1,include_xattrs:!1,include_folder_overview:!1};let n=!1;const l=[],d=new s.DefaultUserApiV2Client(t);let c=yield d.ns("files").rpc("browse",a,{});for(null===(r=c.paginated_file_info)||void 0===r||r.forEach(e=>e.file_info&&l.push(e.file_info));c.has_more;){if(l.length>700){n=!0;break}c=yield d.ns("files").rpc("browse_continue",{cursor:c.next_request_voucher},{}),null===(o=c.paginated_file_info)||void 0===o||o.forEach(e=>e.file_info&&l.push(e.file_info))}return{files:l.map(e=>i.File.fromAnyFileObject(e)),reachedLimit:n}}catch(e){throw new Error("list_folder API error")}}))}}t.TagsApiClient=l,t.tagsApiClient=new l})),define("typescript/libraries/comments2/src/components/folder_overview_utils/index",["require","exports","typescript/libraries/comments2/src/components/folder_overview_utils/description_utils"],(function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isEmptyDescription=void 0,Object.defineProperty(t,"isEmptyDescription",{enumerable:!0,get:function(){return a.isEmptyDescription}})})),define("typescript/libraries/comments2/src/components/folder_overview_utils/description_utils",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isEmptyDescription=void 0;t.isEmptyDescription=e=>{if(!e)return!0;if(0===e.blocks.length)return!0;if(e.blocks.length>1)return!1;if("unstyled"!==e.blocks[0].type)return!1;return 0===e.blocks.map(e=>e.text).join("\n").replace(/%u200B/g,"").trim().length}})),define("metaserver/static/js/campaigns/campaigns_element_id_enum",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CampaignsElementIdEnum=void 0,(function(e){e.BROWSE_VIEW_LIST_HEAD="browse-view-list-head",e.BROWSE_VIEW_LIST_FILE="browse-view-list-file",e.BROWSE_VIEW_RIGHT_PANEL_SHARE_DROPDOWN_BUTTON="browse-view-right-panel-share-dropdown-button",e.BROWSE_VIEW_RIGHT_PANEL_SHARE_WITH_DROPBOX_BUTTON="browse-view-right-panel-share-with-dropbox-button",e.BROWSE_VIEW_RIGHT_PANEL_SEND_A_COPY_BUTTON="browse-view-right-panel-send-a-copy-button",e.PREVIEW_TIME_BASED_ANNOTATIONS_BUTTON="preview-time-based-annotations-button"})(t.CampaignsElementIdEnum||(t.CampaignsElementIdEnum={}))})),define("metaserver/static/js/browse/crypto_subtle_digest",["require","exports","tslib"],(function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.hashString=t.encryptArrayBuffer=t.windowHasCryptoSubtleDigest=void 0;function s(e){if((0,t.windowHasCryptoSubtleDigest)())return new Promise(t=>{window.crypto.subtle.digest("SHA-256",e).then(t)});throw new Error("window.crypto.subtle.digest not available")}t.windowHasCryptoSubtleDigest=()=>!!window.crypto.subtle&&!!window.crypto.subtle.digest,t.encryptArrayBuffer=s,t.hashString=function(e){return a.__awaiter(this,void 0,void 0,(function*(){if(!(0,t.windowHasCryptoSubtleDigest)()||void 0===window.TextEncoder||void 0===window.TextDecoder)return null;try{const t=yield s((new TextEncoder).encode(e));return new TextDecoder("utf-16").decode(t)}catch(e){return null}}))}})),define("metaserver/static/js/files_view/contexts/file_thumb_store",["require","exports","tslib","react","metaserver/static/js/photos/thumb_loading/buffered_thumb_store","metaserver/static/js/photos/thumb_loading/generic_thumb_store","metaserver/static/js/files_view/view_type","metaserver/static/js/browse/models","metaserver/static/js/files_view/files_view_hooks","metaserver/static/js/icon/file_folder_icon","metaserver/static/js/files_view/constants"],(function(e,t,a,s,r,i,o,n,l,d,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.withThumbStore=t.ThumbStoreContext=t.ThumbStoreProvider=void 0,s=a.__importDefault(s);t.ThumbStoreProvider=({shouldPrewarm:e,path:a,children:u,items:_})=>{const p=(0,l.useIsPostTTI)(),m=s.default.useMemo(()=>p?new i.GenericThumbStore:new r.BufferedThumbStore,[a]);return s.default.useEffect(()=>{if(!e)return;const t=[];return null==_||_.slice(0,100).forEach(e=>{if(e instanceof n.File||e instanceof n.FileSharedWithMe){const a=(0,d.getThumbnailUrlForItem)(e.thumbnail_url_tmpl,c.ViewTypeThumbnailSizes[o.ViewType.Grid]);if(a){const e=m.bind_url(a,{onSuccess:()=>{}});e&&t.push(e)}}}),()=>t.forEach(e=>m.unbind_url(e))},[a,_,m,e]),s.default.createElement(t.ThumbStoreContext.Provider,{value:m},u)},t.ThumbStoreProvider.displayName="ThumbStoreProvider",t.ThumbStoreContext=s.default.createContext(new i.GenericThumbStore);t.withThumbStore=e=>a=>s.default.createElement(t.ThumbStoreContext.Consumer,null,t=>s.default.createElement(e,Object.assign({},a,{thumbStore:t})))})),define("metaserver/static/js/files_view/contexts/override_context",["require","exports","tslib","react"],(function(e,t,a,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FilesViewOverrideContext=void 0,s=a.__importDefault(s),t.FilesViewOverrideContext=s.default.createContext({})})),define("metaserver/static/js/files_view/data/action_creators",["require","exports","tslib","lodash","immutable","metaserver/static/js/api_v2/user_client","metaserver/static/js/files_view/constants","metaserver/static/js/files_view/data/selectors/files_view_selectors","metaserver/static/js/files_view/data/selectors/instance_selectors","metaserver/static/js/files_view/data/types","lodash","metaserver/static/js/browse/action_logger","metaserver/static/js/clean/web_user_action_events","metaserver/static/js/files_view/view_preferences"],(function(e,t,a,s,r,i,o,n,l,d,c,u,_,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.loadScopedSortOrders=t.setSort=t.loadPreviewThumbnails=t.batchLoadPreviewThumbnails=t.openKeyboardShortcutsModal=t.filterOutColumns=t.markActiveInstance=t.deleteInstance=t.upsertInstance=t.resetScroll=t.updateNamingConventionsApplyStatus=t.updateFileRenameInput=t.setFileRename=t.loadViewTypeColumns=t.setColumns=t.loadViewTypes=t.setViewType=void 0,n=a.__importStar(n),l=a.__importStar(l),c=a.__importStar(c),p=a.__importStar(p);t.setViewType=({user:e,viewType:t,viewTypeScope:a=o.VIEW_TYPE_GLOBAL_SCOPE,updateGlobalScope:s=!1,isPlaceholder:r=!1,isPlaceholderEnabled:i=!1},n)=>l=>{const c=p.getViewTypes(e.id),u=!(null==c?void 0:c[a]),_=!r||i&&r&&u;if(null==n||n({viewType:t,isPlaceholder:r,isPlaceholderEnabled:i,placeholderWouldBeUsed:u,willSetViewType:_}),!_)return;const m=[a];s&&a!==o.VIEW_TYPE_GLOBAL_SCOPE&&m.push(o.VIEW_TYPE_GLOBAL_SCOPE),l({type:d.ActionTypes.SET_VIEW_TYPE,payload:{viewType:t,viewScopes:m}}),p.setViewType(e.id,m,t,r)};t.loadViewTypes=({user:e,defaultViewType:t})=>a=>{const s=((e,t)=>{const a=p.getViewTypes(e);return a||(t?{[o.VIEW_TYPE_GLOBAL_SCOPE]:t}:null)})(e.id,t);s&&a({type:d.ActionTypes.SET_VIEW_TYPES,payload:{viewTypes:s}})};t.setColumns=({columns:e,user:t,viewTypeScope:a=o.VIEW_TYPE_GLOBAL_SCOPE,updateGlobalScope:s=!1,numVisibleColumns:r})=>i=>{const n={};e.forEach((e,t)=>{n[t]=e.sortField});const l=[a];s&&a!==o.VIEW_TYPE_GLOBAL_SCOPE&&l.push(o.VIEW_TYPE_GLOBAL_SCOPE),i({type:d.ActionTypes.SET_COLUMNS_INDEX,payload:{viewScopes:l,columnsIndex:n,numVisibleColumns:r}}),p.setColumnsIndex(t.id,l,n),void 0!==r&&p.setNumVisibleColumns(t.id,l,r)};t.loadViewTypeColumns=({user:e})=>{const t=p.getScopedColumnsIndex(e.id),a=p.getScopedNumVisibleColumns(e.id);return{type:d.ActionTypes.SET_SCOPED_COLUMNS_INDEX,payload:{scopedColumnsIndex:t,scopedNumVisibleColumns:a}}};t.setFileRename=({file:e,renameState:t})=>({type:d.ActionTypes.SET_FILE_RENAME,payload:{file:e,renameState:t}});t.updateFileRenameInput=({renameInput:e})=>({type:d.ActionTypes.UPDATE_FILE_RENAME_INPUT,payload:{renameInput:e}});t.updateNamingConventionsApplyStatus=({isApplyClicked:e})=>({type:d.ActionTypes.UPDATE_NAMING_CONVENTION_APPLY_STATUS,payload:{isApplyClicked:e}});t.resetScroll=()=>({type:d.ActionTypes.SET_SCROLL,payload:{scrollTop:0}});t.upsertInstance=(e,t)=>(a,i)=>{var o,l;o=t,(!(l=n.selectInstances(i()).get(e))||Object.keys(o).some(e=>{const t=o[e],a=l[e];return!(!a&&!t||(r.Map.isMap(a)&&r.Map.isMap(t)?a.equals(t):r.List.isList(a)&&r.List.isList(t)?a.equals(t):"selection"===e?(0,r.is)(a,t):(0,s.isEqual)(t,a)))}))&&a({type:d.ActionTypes.UPSERT_INSTANCE,payload:{id:e,instance:t}})};t.deleteInstance=e=>({type:d.ActionTypes.DELETE_INSTANCE,payload:{id:e}});t.markActiveInstance=e=>({type:d.ActionTypes.MARK_ACTIVE_INSTANCE,payload:{id:e}});t.filterOutColumns=e=>({type:d.ActionTypes.FILTER_OUT_COLUMNS,payload:e});t.openKeyboardShortcutsModal=t=>(s,r)=>{(function(t){a.__awaiter(this,void 0,void 0,(function*(){const{showKeyboardShortcutsModal:s}=yield new Promise((t,a)=>{e(["metaserver/static/js/files_view/keyboard_shortcuts_modal"],t,a)}).then(a.__importStar);s(t)}))})(l.selectIsListView(r(),t))};t.batchLoadPreviewThumbnails=(e,t,s,r,o)=>a.__awaiter(void 0,void 0,void 0,(function*(){const a=n.previewThumbnailsToLoad(t()),c=l.selectViewType(t(),{instanceId:o});try{if(a.length>0){const t=new i.UserApiV2Client,o=yield t.ns("previews").rpc("get_preview_data_batch",{files:a},{subjectUserId:s}),n=[];o.results.forEach(e=>{var t;const a=null===(t=e.preview)||void 0===t?void 0:t.content,s=e.file.file_id;s&&a&&(a.hasOwnProperty("thumbnail_url_tmpl")?n.push({file_id:s,preview_url:a.thumbnail_url_tmpl}):a.hasOwnProperty("placeholder_image_url")&&n.push({file_id:s,preview_url:a.placeholder_image_url}))}),n.length>0&&(e((({preview_thumbnails:e})=>({type:d.ActionTypes.PREVIEW_THUMBNAILS_LOADED,payload:{preview_thumbnails:e}}))({preview_thumbnails:n})),p={view_type:c,userId:s,num_files_requested:a.length,num_files_retrieved:n.length,elapsed_ms:Date.now()-r},(0,u.logWebUserAction)({user_id:p.userId,event_name:_.WebUserActionLogEvent.PREVIEW_THUMBNAIL_SUCCESS,extra:{view_type:p.view_type,num_files_requested:p.num_files_requested.toString(),num_files_retrieved:p.num_files_retrieved.toString(),elapsed_ms:p.elapsed_ms.toString()}}))}}catch(t){e((({files:e})=>({type:d.ActionTypes.PREVIEW_THUMBNAILS_REMOVED,payload:{files:e}}))({files:a})),(e=>{(0,u.logWebUserAction)({user_id:e.userId,event_name:_.WebUserActionLogEvent.PREVIEW_THUMBNAIL_ERROR,extra:{view_type:e.view_type,error_summary:e.error_summary||"unknown"}})})({view_type:c,userId:s,error_summary:null==t?void 0:t.toString()})}var p}));const m=c.debounce((e,a,s,r,i)=>{(0,t.batchLoadPreviewThumbnails)(e,a,s,r,i)},300);t.loadPreviewThumbnails=(e,t,a)=>(s,r)=>{const i=n.previewThumbnails(r()),o=e.filter(e=>e.file_id&&!i.hasOwnProperty(e.file_id));o.length>0&&(s((({files:e})=>({type:d.ActionTypes.PREVIEW_THUMBNAILS_LOADING,payload:{files:e}}))({files:o})),m(s,r,t,Date.now(),a))};t.setSort=({user:e,sort:t,viewScope:a=o.VIEW_TYPE_GLOBAL_SCOPE,updateGlobalScope:s=!1})=>r=>{const i=[a];s&&a!==o.VIEW_TYPE_GLOBAL_SCOPE&&i.push(o.VIEW_TYPE_GLOBAL_SCOPE),r({type:d.ActionTypes.SET_SORT,payload:{sort:t,viewScopes:i}}),p.setSort(e.id,i,t)};t.loadScopedSortOrders=({user:e,defaultSort:t})=>({type:d.ActionTypes.SET_SCOPED_SORTS,payload:{scopedSorts:Object.assign({[o.VIEW_TYPE_GLOBAL_SCOPE]:t},p.getScopedSorts(e.id))}})})),define("metaserver/static/js/files_view/file_thumbnail",["require","exports","tslib","classnames","react","typescript/libraries/spectrum-content-icon-compatibility/src/index","metaserver/static/js/files_view/constants","metaserver/static/js/files_view/view_type","metaserver/static/js/icon/file_folder_icon","metaserver/static/js/icon/lock_badge","metaserver/static/js/user_education/react/user_education_effect","metaserver/static/js/files_view/contexts/file_thumb_store","metaserver/static/js/files_view/contexts/override_context"],(function(e,t,a,s,r,i,o,n,l,d,c,u,_){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FileThumbnail=t.FileThumbnailComponentForTests=t.FileThumbnailComponent=t.isExtensionThumbnailableByDefault=void 0,s=a.__importDefault(s),r=a.__importDefault(r);t.isExtensionThumbnailableByDefault=e=>o.IMAGE_THUMBNAIL_EXTENSIONS.includes(e);class p extends r.default.PureComponent{constructor(e){super(e),this._thumbRequestId=null,this.getThumbnailSize=()=>{var e,t;return null!==(t=null!==(e=this.props.thumbnailSize)&&void 0!==e?e:this.props.iconSize)&&void 0!==t?t:o.ViewTypeThumbnailSizes[n.ViewType.List]},this.getThumbnailSrcSet=()=>{const e=this.getThumbnailSize();return`${(0,l.getThumbnailUrlForItem)(this.props.file.thumbnail_url_tmpl,e)} 1x, ${(0,l.getThumbnailUrlForItem)(this.props.file.thumbnail_url_tmpl,2*e)} 2x`},this.isExtensionThumbnailable=e=>this.props.isExtensionThumbnailableFnOverride?this.props.isExtensionThumbnailableFnOverride(e):(0,t.isExtensionThumbnailableByDefault)(e),this.handleThumbnailError=()=>{this.setState({thumbnailSrc:null})};const{thumbStore:a,file:{thumbnail_url_tmpl:s}}=e;this.state={thumbnailSrc:s?a.get_thumb(s):null}}componentDidMount(){this.fetchThumbnail(this.props)}UNSAFE_componentWillReceiveProps(e){e.file.thumbnail_url_tmpl!==this.props.file.thumbnail_url_tmpl&&(this.unbindThumbnailIfNeeded(),this.fetchThumbnail(e))}componentWillUnmount(){this.unbindThumbnailIfNeeded()}fetchThumbnail({file:e,thumbStore:t}){const a=e.fq_path||e.filename||"",s=(0,i.getExtension)(a);if(!s||!this.isExtensionThumbnailable(s))return;const r=(0,l.getThumbnailUrlForItem)(e.thumbnail_url_tmpl,this.getThumbnailSize());r&&(this._thumbRequestId=t.bind_url(r,{onSuccess:()=>{this.setState({thumbnailSrc:t.get_thumb(r)})},onError:()=>{this.handleThumbnailError()}}))}unbindThumbnailIfNeeded(){const{thumbStore:e}=this.props;this._thumbRequestId&&(e.unbind_url(this._thumbRequestId),this._thumbRequestId=null),this.setState({thumbnailSrc:null})}render(){const{file:e,showCDMUserEducationEffects:t,iconSize:a,isRetinaThumbnailEnabled:i}=this.props,{thumbnailSrc:o}=this.state,n=e.fq_path||e.filename,l=i?this.getThumbnailSrcSet():void 0;return o?r.default.createElement(d.LockBadge,{file:this.props.file,variant:"preview-small"},r.default.createElement("img",{alt:n,draggable:!1,className:(0,s.default)("brws-file-name-cell-icon","brws-file-name-cell-thumb"),src:o,srcSet:l,onError:this.handleThumbnailError,"data-testid":"generated-file-thumbnail"})):r.default.createElement(m,{file:e,showCDMUserEducationEffects:t,iconSize:a})}}t.FileThumbnailComponent=p,p.displayName="FileThumbnailComponent";t.FileThumbnailComponentForTests=e=>{const t=r.default.useContext(_.FilesViewOverrideContext),a=Object.assign(Object.assign({},e),{isExtensionThumbnailableFnOverride:t.isExtensionThumbnailableFn,isRetinaThumbnailEnabled:t.isRetinaThumbnailEnabled});return r.default.createElement(p,Object.assign({},a))},t.FileThumbnail=(0,u.withThumbStore)(t.FileThumbnailComponentForTests);const m=({file:e,showCDMUserEducationEffects:t,iconSize:a})=>{const s=a?{height:a.toString(),width:a.toString()}:{},i=a&&a>=o.LISTVIEW_LARGE_ICON_SIZE_PX?"large":void 0,n=r.default.createElement(l.FileOrFolderIcon,Object.assign({className:"brws-file-name-cell-icon",file:e,showPreview:!1,"data-testid":"fallback-file-thumbnail",variant:i},s));return t?r.default.createElement(c.UserEducationEffect,{containerName:"FileItemRow",name:"TMFIcon",useSpan:!0},n):n};m.displayName="FileThumbnailFallback"})),define("metaserver/static/js/files_view/view_preferences",["require","exports","metaserver/static/js/core/persistence/storage"],(function(e,t,a){"use strict";function s(e){return Object.assign({},a.UserLocalStorage.get(e,t.VIEW_PREFERENCES_STORAGE_KEY))}function r(e,r,i,o=!1){const n=s(e),l=Object.assign(Object.assign({},i),{last_updated_ts:Date.now()});for(const e of r)n[e]=Object.assign(Object.assign({},n[e]),l);for(;Object.keys(n).length>t.VIEW_PREFERENCES_STORAGE_LIMIT;){const e=Object.keys(n).reduce((e,t)=>!e||n[t].last_updated_ts<n[e].last_updated_ts?t:e);delete n[e]}o||a.UserLocalStorage.set(e,t.VIEW_PREFERENCES_STORAGE_KEY,n)}function i(e,t){const a={},r=s(e);return Object.keys(r).forEach(e=>{const s=r[e][t];void 0!==s&&(a[e]=s)}),a}Object.defineProperty(t,"__esModule",{value:!0}),t.setNumVisibleColumns=t.getScopedNumVisibleColumns=t.setSort=t.getScopedSorts=t.setColumnsIndex=t.getScopedColumnsIndex=t.setViewType=t.getViewTypes=t.getPreferences=t.VIEW_PREFERENCES_STORAGE_LIMIT=t.VIEW_PREFERENCES_STORAGE_KEY=void 0,t.VIEW_PREFERENCES_STORAGE_KEY="files_view_preferences",t.VIEW_PREFERENCES_STORAGE_LIMIT=500,t.getPreferences=s,t.getViewTypes=function(e){const t=s(e);if(!t||0===Object.keys(t).length)return null;const a={};return Object.keys(t).forEach(e=>{const s=t[e].file_view_mode;s&&(a[e]=s)}),a},t.setViewType=function(e,t,a,s=!1){r(e,t,{file_view_mode:a},s)},t.getScopedColumnsIndex=function(e){return i(e,"columns_index")},t.setColumnsIndex=function(e,t,a){r(e,t,{columns_index:a})},t.getScopedSorts=function(e){return i(e,"sort_state")},t.setSort=function(e,t,a){r(e,t,{sort_state:a})},t.getScopedNumVisibleColumns=function(e){return i(e,"num_visible_columns")},t.setNumVisibleColumns=function(e,t,a){r(e,t,{num_visible_columns:a})}})),define("metaserver/static/js/tagging/logger",["require","exports","tslib","metaserver/static/js/logging/telemetry","metaserver/static/js/logging/hive/schemas/server-tag_actions","metaserver/static/js/tagging/utils"],(function(e,t,a,s,r,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.logAutoTagSnackbarAction=t.logTagClick=t.logFailTag=t.logAddTag=t.logStartTypingTag=t.logSelectTagBar=t.logRemoveTag=void 0,s=a.__importStar(s);const o=new s.HiveLogger;function n(t){return a.__awaiter(this,void 0,void 0,(function*(){const{LOGGING_ALLOWED_EXTS:s,LOGGING_UNALLOWED_EXT_PLACEHOLDER:r}=yield new Promise((t,a)=>{e(["typescript/libraries/file-viewer/src/file_extension/extension_constants"],t,a)}).then(a.__importStar);return s.includes(t.ext)?t.ext:r}))}t.logRemoveTag=function(e,t,s,l){return a.__awaiter(this,void 0,void 0,(function*(){yield Promise.all(t.map(t=>a.__awaiter(this,void 0,void 0,(function*(){o.log(new r.ServerTagActionsRow({tag_name:null,tag_type:(0,i.getTagType)(s),event_name:"remove_tag",action_surface:l,file_ext:yield n(t),file_nsid:t.ns_id.toString(),file_sjid:t.sjid.toString(),platform:"web",user_id:e.id,file_id:t.file_id}))}))))}))},t.logSelectTagBar=function(e,t,s){return a.__awaiter(this,void 0,void 0,(function*(){yield Promise.all(t.map(t=>a.__awaiter(this,void 0,void 0,(function*(){o.log(new r.ServerTagActionsRow({tag_name:null,tag_type:"na",event_name:"select_tag_bar",action_surface:s,file_ext:yield n(t),file_nsid:t.ns_id.toString(),file_sjid:t.sjid.toString(),platform:"web",user_id:e.id,file_id:t.file_id}))}))))}))},t.logStartTypingTag=function(e,t,s){return a.__awaiter(this,void 0,void 0,(function*(){yield Promise.all(t.map(t=>a.__awaiter(this,void 0,void 0,(function*(){o.log(new r.ServerTagActionsRow({tag_name:null,tag_type:"na",event_name:"start_typing_tag",action_surface:s,file_ext:yield n(t),file_nsid:t.ns_id.toString(),file_sjid:t.sjid.toString(),platform:"web",user_id:e.id,file_id:t.file_id}))}))))}))},t.logAddTag=function(e,t,s,i){return a.__awaiter(this,void 0,void 0,(function*(){yield Promise.all(t.map(t=>a.__awaiter(this,void 0,void 0,(function*(){o.log(new r.ServerTagActionsRow({tag_name:null,tag_type:"user_generated_tag",event_name:"add_tag",action_surface:i,file_ext:yield n(t),file_nsid:t.ns_id.toString(),file_sjid:t.sjid.toString(),platform:"web",user_id:e.id,file_id:t.file_id}))}))))}))},t.logFailTag=function(e,t,s,i){return a.__awaiter(this,void 0,void 0,(function*(){yield Promise.all(t.map(t=>a.__awaiter(this,void 0,void 0,(function*(){o.log(new r.ServerTagActionsRow({tag_name:null,tag_type:"user_generated_tag",event_name:"fail_tag",action_surface:i,file_ext:yield n(t),file_nsid:t.ns_id.toString(),file_sjid:t.sjid.toString(),platform:"web",user_id:e.id,file_id:t.file_id}))}))))}))},t.logTagClick=function(e,t,s,l){return a.__awaiter(this,void 0,void 0,(function*(){yield Promise.all(t.map(t=>a.__awaiter(this,void 0,void 0,(function*(){o.log(new r.ServerTagActionsRow({tag_name:null,tag_type:(0,i.getTagType)(l),event_name:"select_tag",action_surface:s,file_ext:yield n(t),file_nsid:t.ns_id.toString(),file_sjid:t.sjid.toString(),platform:"web",user_id:e.id,file_id:t.file_id}))}))))}))},t.logAutoTagSnackbarAction=function(e,t,s,i,l,d){return a.__awaiter(this,void 0,void 0,(function*(){o.log(new r.ServerTagActionsRow({tag_name:null,tag_type:"user_generated_tag",event_name:"auto_tag_snackbar_action",action_surface:d,file_ext:yield n(t),file_nsid:t.ns_id.toString(),file_sjid:t.sjid.toString(),platform:"web",user_id:e,file_id:t.file_id,snackbar_action:i,tagging_type:l}))}))}})),define("metaserver/static/js/logging/hive/schemas/server-tag_actions",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ServerTagActionsRow=void 0;t.ServerTagActionsRow=class{constructor(e){this.category="server-tag_actions",this.file_oid=0,this.session_id=null,this.team_id=null,this.user_id=e.user_id,this.tag_name=e.tag_name,this.tag_type=e.tag_type,this.platform=e.platform,this.event_name=e.event_name,this.file_ext=e.file_ext,this.file_nsid=e.file_nsid,this.file_sjid=e.file_sjid,e.hasOwnProperty("file_oid")&&void 0!==e.file_oid&&(this.file_oid=e.file_oid),this.action_surface=e.action_surface,e.hasOwnProperty("session_id")&&void 0!==e.session_id&&(this.session_id=e.session_id),e.hasOwnProperty("team_id")&&void 0!==e.team_id&&(this.team_id=e.team_id),e.hasOwnProperty("snackbar_action")&&void 0!==e.snackbar_action&&(this.snackbar_action=e.snackbar_action),e.hasOwnProperty("tagging_type")&&void 0!==e.tagging_type&&(this.tagging_type=e.tagging_type),this.file_id=e.file_id,Object.seal(this)}}})),define("metaserver/static/js/files_view/files_view_hooks",["require","exports","tslib","react","metaserver/static/js/core/cancelable_promise","metaserver/static/js/clean/web_timing_logger"],(function(e,t,a,s,r,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.useIsPostTTI=void 0,s=a.__importDefault(s),i=a.__importStar(i);t.useIsPostTTI=()=>{const[e,t]=s.default.useState(!!i.time_to_interactive);return s.default.useEffect(()=>{const e=(0,r.makeCancelable)(i.waitForTTI().then(()=>{t(!0)}));return()=>e.cancel()},[]),e}})),define("metaserver/static/js/sharing/browse_exports",["require","exports","tslib","metaserver/static/js/sharing/access_level","metaserver/static/js/sharing/async_share_modal_util","metaserver/static/js/sharing/wizard/async_wizard_modals"],(function(e,t,a,s,r,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.asyncShowShareAFolderWizardModal=t.asyncShowPrefilledShareModal=t.asyncShowNewFolderShareModal=t.asyncShowShareModal=t.asyncShowAppropriateNewFolderModalForCdmUser=t.asyncShowMultiFolderPermissionsAtUploadModal=t.asyncShowCdmNewFolderViaUploadModal=t.asyncShowCdmNewFolderModal=t.asyncMountSharedFolder=void 0,t.asyncMountSharedFolder=function(t){new Promise((t,a)=>{e(["metaserver/static/js/sharing/shared_content_link_mount_folder"],t,a)}).then(a.__importStar).then(({mountSharedFolder:e})=>{e(t)})},t.asyncShowCdmNewFolderModal=function({handleCreateFolder:t,user:s,context:r,shouldSyncDefault:i,shouldDisplaySyncSettings:o,shouldDisplayAudienceInput:n,shouldDisplayAutoFolderOption:l,defaultInputFolderName:d,autoTeamGroupDefaultAccessLevel:c,redirectOnCancel:u,useDigModal:_=!0,isConfidential:p=!1}){new Promise((t,a)=>{e(["metaserver/static/js/sharing/cdm_new_folder_modal"],t,a)}).then(a.__importStar).then(e=>{e.showCdmNewFolderModal(t,s,r,i,o,n,l,c,d,u,_,p)})},t.asyncShowCdmNewFolderViaUploadModal=function(t,r,i,o,n,l,d){return a.__awaiter(this,void 0,void 0,(function*(){(yield new Promise((t,a)=>{e(["metaserver/static/js/sharing/cdm_new_folder_modal"],t,a)}).then(a.__importStar)).showCdmNewFolderViaUploadModal(t,r,i,!0,s.ACCESS_LEVEL.WRITER,o,n,l,d)}))},t.asyncShowMultiFolderPermissionsAtUploadModal=function(t){return a.__awaiter(this,void 0,void 0,(function*(){(yield new Promise((t,a)=>{e(["metaserver/static/js/sharing/multifolder_permissions_at_upload/modal"],t,a)}).then(a.__importStar)).showMultiFolderPermissionsAtUploadModal(t)}))},t.asyncShowAppropriateNewFolderModalForCdmUser=function(t){return a.__awaiter(this,void 0,void 0,(function*(){(yield new Promise((t,a)=>{e(["metaserver/static/js/sharing/cdm_new_folder_modal_util"],t,a)}).then(a.__importStar)).showAppropriateNewFolderModalForCdmUser(t)}))},Object.defineProperty(t,"asyncShowShareModal",{enumerable:!0,get:function(){return r.asyncShowShareModal}}),Object.defineProperty(t,"asyncShowNewFolderShareModal",{enumerable:!0,get:function(){return r.asyncShowNewFolderShareModal}}),Object.defineProperty(t,"asyncShowPrefilledShareModal",{enumerable:!0,get:function(){return r.asyncShowPrefilledShareModal}}),Object.defineProperty(t,"asyncShowShareAFolderWizardModal",{enumerable:!0,get:function(){return i.asyncShowShareAFolderWizardModal}})}));
//# sourceMappingURL=pkg-tidy-up.min.js-vflScmXcz.map