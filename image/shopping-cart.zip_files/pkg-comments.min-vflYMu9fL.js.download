define("typescript/component_libraries/files_components/src/blades/comments/data/uuid",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.v4=void 0;const n=(()=>{let e,t;const n=[];for(e=0,t=e;e<=255;e++,t=e)n.push((t+256).toString(16).substr(1));return n})();function a(e){return e.map(e=>n[e]).join("")}t.v4=function(){const e=(function(){const e=new Uint8Array(16);return window.crypto&&window.crypto.getRandomValues(e),e})();e[6]=15&e[6]|64,e[8]=63&e[8]|128;const t=Array.prototype.slice.call(e);return[t.slice(0,4),t.slice(4,6),t.slice(6,8),t.slice(8,10),t.slice(10,16)].map(a).join("-")}})),define("typescript/component_libraries/files_components/src/blades/comments/component/meatball_menu",["require","exports","tslib","react","dig-components/icons/src","dig-components/icons","dig-components/badges","dig-components/buttons","dig-components/menu","react-redux","react-intl","typescript/component_libraries/files_components/src/blades/comments/data/actions","typescript/component_libraries/files_components/src/blades/comments/data/selectors","typescript/component_libraries/files_components/src/blades/comments/data/transform","typescript/libraries/api_v2/redux/comments2","typescript/component_libraries/files_components/src/blades/comments/data/types","typescript/component_libraries/flows/src/components/approval-forms/index","typescript/libraries/comments2/src/hooks/continuous_annotation_hook"],(function(e,t,n,a,o,s,r,i,c,d,l,m,u,p,g,b,f,_){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CommentsMeatball=void 0,a=n.__importStar(a);const y=(0,l.defineMessage)({id:"U75RtN",defaultMessage:"Hide resolved comments"}),v=(0,l.defineMessage)({id:"fKXJUR",defaultMessage:"Show resolved comments"}),A=(0,l.defineMessage)({id:"w904jy",defaultMessage:"Unsubscribe"}),h=(0,l.defineMessage)({id:"cnLKs9",defaultMessage:"Subscribe"}),C=(0,l.defineMessage)({id:"/XlCxM",defaultMessage:"Disable comments"}),O=(0,l.defineMessage)({id:"bppWf8",defaultMessage:"Enable comments"}),T=(0,l.defineMessage)({id:"0GnzQS",defaultMessage:"Enable continuous commenting"}),M=(0,l.defineMessage)({id:"oCFihF",defaultMessage:"Disable continuous commenting"});t.CommentsMeatball=a.default.memo(({className:e,fileId:t,sharedLinkURL:n,size:I,dragSectionAnnotationEnabled:S,approvalIOClient:E})=>{const j=(0,d.useDispatch)(),w=(0,l.useIntl)(),R=(0,p.createStreamFromFileOrSharedLink)(t,n),D=(0,b.createCommentFileIdentifier)(t,n),L=(0,d.useSelector)(e=>e.showResolvedComments),U=(0,d.useSelector)(e=>{var t;return null===(t=e.permissions[D])||void 0===t?void 0:t.can_enable_commenting}),x=(0,d.useSelector)(e=>(0,u.areCommentsEnabled)(e,D)),k=(0,d.useSelector)(e=>{var t;return null===(t=e.permissions[D])||void 0===t?void 0:t.can_subscribe}),F=(0,d.useSelector)(e=>(0,u.isUserSubscribed)(e,D)),N=(0,d.useSelector)(e=>(0,u.isSingularlyAnnotating)(e)),[B,P]=a.default.useState({showResolvedComments:L,inSingleAnnotatingMode:N}),q=(0,a.useCallback)(()=>{j((0,m.updateShowResolvedComments)(!L))},[L]),V=(0,a.useCallback)(()=>j((0,g.subscribeAction)({arg:{stream:R}})),[R]),H=(0,a.useCallback)(()=>j((0,g.unsubscribeAction)({arg:{stream:R}})),[R]),W=(0,a.useCallback)(()=>j((0,g.enableCommentingAction)({arg:{stream:R}})),[R]),z=(0,a.useCallback)(()=>j((0,g.disableCommentingAction)({arg:{stream:R}})),[R]),G=(0,a.useCallback)(()=>{E&&E.logger.logRequestApprovalClick("comments_meatball_menu",t),j((0,f.setApprovalForm)({[D]:{activeForm:"request",threadId:void 0}})),j((0,m.logApprovalAction)("request_approval","comments_meatball"))},[D,E]),[K,Q]=(0,_.useContinuousAnnotation)(),Y=(0,a.useCallback)(()=>{N?(j((0,m.updateAnnotationMode)(b.SectionAnnotationMode.continuous)),K||Q()):j((0,m.updateAnnotationMode)(b.SectionAnnotationMode.single))},[j,N]),J=a.default.useCallback(({isOpen:e})=>{e&&P({inSingleAnnotatingMode:N,showResolvedComments:L})},[N,L]);if(!x&&!U)return null;const X=null==E?void 0:E.getUserExperiments(),Z=X?X.flows_approval_flow_variant:"OFF",$=X?X.flows_approval_copy_experiment_variant:"OFF";return a.default.createElement(c.Menu.Wrapper,{className:e,onToggle:J},({getContentProps:e,getTriggerProps:t})=>a.default.createElement(a.default.Fragment,null,a.default.createElement(i.IconButton,Object.assign({variant:"transparent"},t(),{size:I,"aria-label":w.formatMessage({id:"OD3YF0",defaultMessage:"Other actions"})}),a.default.createElement(s.UIIcon,{src:o.MoreHorizontalLine,size:I})),a.default.createElement(c.Menu.Content,Object.assign({},e()),a.default.createElement(c.Menu.Segment,null,a.default.createElement(c.Menu.ActionItem,{value:B.showResolvedComments?"hide-resolve-comments":"show-resolve-comments",onClick:q,disabled:!x},B.showResolvedComments?w.formatMessage(y):w.formatMessage(v)),k?a.default.createElement(c.Menu.ActionItem,{value:F?"unsubscribe":"subscribe",onClick:F?H:V,disabled:!x},F?w.formatMessage(A):w.formatMessage(h)):null,U?a.default.createElement(c.Menu.ActionItem,{value:F?"enableComments":"disableComments",onClick:x?z:W},x?w.formatMessage(C):w.formatMessage(O)):null,(0,f.isApprovalEnabled)(Z)&&a.default.createElement(c.Menu.ActionItem,{value:"requestApproval",onClick:G,withTitle:a.default.createElement(a.default.Fragment,null,w.formatMessage((0,f.approvalCopyExperimentString)($)),a.default.createElement(r.AccessoryBadge,{style:{marginLeft:4}},w.formatMessage({id:"VgsgAq",defaultMessage:"New"})))}),S&&a.default.createElement(c.Menu.ActionItem,{onClick:Y,disabled:!x},B.inSingleAnnotatingMode?w.formatMessage(T):w.formatMessage(M))))))}),t.CommentsMeatball.displayName="CommentsMeatball"})),define("typescript/component_libraries/files_components/src/blades/comments/data/transform",["require","exports","typescript/component_libraries/files_components/src/blades/comments/data/uuid"],(function(e,t,n){"use strict";function a(e){return{type:{".tag":"file"},identifier:{".tag":"file_path_or_id",file_path_or_id:e}}}function o(e){return{type:{".tag":"file"},identifier:{".tag":"shared_link_details",url:e}}}Object.defineProperty(t,"__esModule",{value:!0}),t.createStreamFromFileOrSharedLink=t.createStreamFromSharedLink=t.createStreamFromFileId=t.newCommentFromICommentContent=t.accountToCommentStreamUser=void 0,t.accountToCommentStreamUser=function(e){return{id:e.account_id,name:{display:e.name.display_name,initials:e.name.abbreviated_name,public:e.name.display_name},photoUrl:e.profile_photo_url}},t.newCommentFromICommentContent=function({content:e,threadId:t,author:a}){const o=new Date;return{id:(0,n.v4)(),timestamp:o,threadId:t,author:a,content:e,userPermissions:{canDelete:!1,canEdit:!1},revisionInfo:{isCurrent:!0,timestamp:o}}},t.createStreamFromFileId=a,t.createStreamFromSharedLink=o,t.createStreamFromFileOrSharedLink=function(e,t){return t?o(t):a(e)}})),define("typescript/component_libraries/files_components/src/blades/comments/data/logging_middleware",["require","exports","typescript/libraries/api_v2/redux/comments2","typescript/component_libraries/files_components/src/blades/comments/data/actions","typescript/component_libraries/files_components/src/blades/comments/data/types"],(function(e,t,n,a,o){"use strict";var s;Object.defineProperty(t,"__esModule",{value:!0}),t.createCommentsBladeLoggingMiddleware=t.CommentsEventName=void 0,(function(e){e.ADD_COMMENT="add_comment",e.DELETE_COMMENT="delete_comment",e.REPLY_COMMENT="reply_comment",e.EDIT_COMMENT="edit_comment",e.RESOLVE_COMMENT="resolve_comment",e.UNRESOLVE_COMMENT="unresolve_comment",e.SUBSCRIBE_COMMENTS="subscribe_comments",e.UNSUBSCRIBE_COMMENTS="unsubscribe_comments",e.DISABLE_COMMENTS="disable_comments",e.ENABLE_COMMENTS="enable_comments",e.SHOW_RESOLVED_COMMENTS="show_resolved_comments",e.HIDE_RESOLVED_COMMENTS="hide_resolved_comments",e.SORT_COMMENTS="sort_comments",e.REQUEST_APPROVAL="request_approval",e.ENABLE_CONTINUOUS_ANNOTATIONS="enable_continuous_annotations",e.DISABLE_CONTINUOUS_ANNOTATIONS="disable_continuous_annotations"})(s=t.CommentsEventName||(t.CommentsEventName={}));const r=e=>{if(!e)return!1;if("document"===e.type&&"rectangle"===e.regionType&&1===e.regions.length){const t=e.regions[0];if(0===t.x&&0===t.y&&1===t.height&&1===t.width)return!1}return!0};t.createCommentsBladeLoggingMiddleware=e=>({getState:t})=>i=>c=>{var d,l;switch(c.type){case n.Action.AddCommentResult:const i=Boolean(c.payload.arg.thread_id);e({event:i?s.REPLY_COMMENT:s.ADD_COMMENT,extra:{hasAnnotation:String(r(null===(d=c.meta)||void 0===d?void 0:d.annotation)),annotationMode:t().annotationSettings.mode,isSticker:(!!(null===(l=c.payload.arg.comment.metadata)||void 0===l?void 0:l.sticker)).toString()}});break;case n.Action.DeleteCommentResult:e({event:s.DELETE_COMMENT,extra:{annotationMode:t().annotationSettings.mode}});break;case n.Action.EditCommentResult:e({event:s.EDIT_COMMENT,extra:{annotationMode:t().annotationSettings.mode}});break;case n.Action.UnsubscribeResult:e({event:s.UNSUBSCRIBE_COMMENTS,extra:{annotationMode:t().annotationSettings.mode}});break;case n.Action.SubscribeResult:e({event:s.SUBSCRIBE_COMMENTS,extra:{annotationMode:t().annotationSettings.mode}});break;case n.Action.DisableCommentingResult:e({event:s.DISABLE_COMMENTS,extra:{annotationMode:t().annotationSettings.mode}});break;case n.Action.EnableCommentingResult:e({event:s.ENABLE_COMMENTS,extra:{annotationMode:t().annotationSettings.mode}});break;case n.Action.ResolveThreadResult:e({event:s.RESOLVE_COMMENT,extra:{annotationMode:t().annotationSettings.mode}});break;case n.Action.UnresolveThreadResult:e({event:s.UNRESOLVE_COMMENT,extra:{annotationMode:t().annotationSettings.mode}});break;case a.Action.UpdateShowResolvedComments:e({event:c.payload.showResolvedComments?s.SHOW_RESOLVED_COMMENTS:s.HIDE_RESOLVED_COMMENTS,extra:{annotationMode:t().annotationSettings.mode}});break;case a.Action.SortComments:e({event:s.SORT_COMMENTS,extra:{annotationMode:t().annotationSettings.mode}});break;case a.Action.LogApprovalAction:"request_approval"===c.payload.action&&e({event:s.REQUEST_APPROVAL,extra:{context:c.payload.context,annotationMode:t().annotationSettings.mode}});break;case a.Action.UpdateAnnotationMode:e({event:c.payload.updatedAnnotationMode===o.SectionAnnotationMode.continuous?s.ENABLE_CONTINUOUS_ANNOTATIONS:s.DISABLE_CONTINUOUS_ANNOTATIONS})}return i(c)}})),define("typescript/component_libraries/files_components/src/blades/comments/data/bolt_middleware",["require","exports","typescript/component_libraries/files_components/src/blades/comments/data/actions","typescript/libraries/api_v2/redux/comments2"],(function(e,t,n,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.middleware=void 0;t.middleware=function(e){return({dispatch:t,getState:o})=>(e.onSignal(e=>{e.updatedChannels.filter(e=>"comments2"===e.channelId.appId).map(e=>{const n=o().boltInfo.boltUniqueIdToStream[e.channelId.uniqueId];n&&t((0,a.listCommentsAction)({arg:{include_permissions:!0,stream:n}}))})}),t=>a=>{switch(a.type){case n.Action.BoltSubscribe:e.subscribe(a.payload.map(e=>({channelId:{appId:e.app_id,uniqueId:e.unique_id},revisionInfo:{revision:+e.revision,token:e.token}})));break;case n.Action.BoltUnsubscribe:e.unsubscribe(a.payload.map(e=>({channelId:{appId:e.app_id,uniqueId:e.unique_id},revisionInfo:{revision:+e.revision,token:e.token}})))}return t(a)})}})),define("typescript/libraries/comments2/src/mentions/middleware",["require","exports","typescript/libraries/comments2/src/mentions/actions"],(function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.middleware=void 0,t.middleware=function(e){return({dispatch:t})=>a=>o=>{let s=a(o);if(o.type===n.MentionsAction.SearchContacts){const a=e();try{a.search(o.payload,e=>{t((0,n.searchContactsResult)({query:o.payload,result:e[o.payload]}))})}catch(e){}}else o.type===n.MentionsAction.WarmContacts&&e();return s}}})),define("typescript/libraries/comments2/src/mentions/actions",["require","exports"],(function(e,t){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.searchContactsResult=t.searchContacts=t.warmContacts=t.MentionsAction=void 0,(function(e){e.WarmContacts="@@contacts/warm",e.SearchContacts="@@contacts/search",e.SearchContactsResult="@@contacts/searchResult"})(n=t.MentionsAction||(t.MentionsAction={})),t.warmContacts=function(e){return{type:n.WarmContacts,payload:e}},t.searchContacts=function(e){return{type:n.SearchContacts,payload:e}},t.searchContactsResult=function(e){return{type:n.SearchContactsResult,payload:e}}})),define("typescript/component_libraries/files_components/src/blades/comments/data/actions",["require","exports"],(function(e,t){"use strict";var n,a;Object.defineProperty(t,"__esModule",{value:!0}),t.setHasLoggedCaptureImpression=t.logApprovalAction=t.updateAnnotationMode=t.updateShowResolvedComments=t.resolveNavigationToActiveThreadAnnotation=t.focusEditor=t.editorDidFocus=t.deleteAndCommitThread=t.deleteAndCommitComment=t.editAndCommitComment=t.addAndCommitComment=t.sortComments=t.cancelAnnotating=t.confirmDraftAnnotation=t.startAnnotating=t.clearDraftAnnotation=t.updateDraftAnnotation=t.focusThread=t.hoverThread=t.boltUnsubscribe=t.boltSubscribe=t.deactivateAllThreads=t.activateInitialThread=t.activateThread=t.CaptureExperimentActions=t.Action=void 0,(function(e){e.ActivateThread="@@comments/activateThread",e.ActivateInitialThread="@@comments/activateInitialThread",e.DeactivateAllThreads="@@comments/deactivateThread",e.FocusThread="@@comments/focusThread",e.HoverThread="@@comments/hoverThread",e.BoltSubscribe="@@comments/bolt/subscribe",e.BoltUnsubscribe="@@comments/bolt/unsubscribe",e.UpdateDraftAnnotation="@@comments/updateDraftAnnotation",e.ClearDraftAnnotation="@@comments/clearDraftAnnotation",e.FocusEditor="@@comments/focusEditor",e.EditorDidFocus="@@comments/editorDidFocus",e.ResolveNavigationToActiveThreadAnnotation="@@comments/resolveNavigationToActiveThreadAnnotation",e.UpdateShowResolvedComments="@@comments/updateShowResolvedComments",e.UpdateAnnotationMode="@@comments/UpdateCurrentAnnotationMode",e.StartAnnotating="@@comments/startAnnotating",e.ConfirmDraftAnnotation="@@comments/confirmDraftAnnotation",e.CancelAnnotating="@@comments/cancelAnnotating",e.AddAndCommitComment="@@comments/addAndCommitComment",e.EditAndCommitComment="@@comments/editAndCommitComment",e.DeleteAndCommitComment="@@comments/deleteAndCommitComment",e.DeleteAndCommitThread="@@comments/deleteAndCommitThread",e.SortComments="@@comments/sortComments",e.LogApprovalAction="@@comments.logApprovalAction"})(n=t.Action||(t.Action={})),(function(e){e.LoggedImpressionForCaptureExperiment="@@comments/loggedImpressionForCaptureExperiment"})(a=t.CaptureExperimentActions||(t.CaptureExperimentActions={})),t.activateThread=function(e){return{type:n.ActivateThread,payload:e}},t.activateInitialThread=function(e){return{type:n.ActivateInitialThread,payload:e}},t.deactivateAllThreads=function(e){return{type:n.DeactivateAllThreads,payload:e}},t.boltSubscribe=function(e){return{type:n.BoltSubscribe,payload:e}},t.boltUnsubscribe=function(e){return{type:n.BoltUnsubscribe,payload:e}},t.hoverThread=function(e,t){return{type:n.HoverThread,payload:{fileViewerId:e,threadId:t}}},t.focusThread=function(e,t){return{type:n.FocusThread,payload:{fileViewerId:e,threadId:t}}},t.updateDraftAnnotation=function(e,t){return{type:n.UpdateDraftAnnotation,payload:{fileViewerId:e,annotation:t}}},t.clearDraftAnnotation=function(e){return{type:n.ClearDraftAnnotation,payload:{fileViewerId:e}}},t.startAnnotating=function(e,t){return{type:n.StartAnnotating,payload:{fileViewerId:e,accessible:t}}},t.confirmDraftAnnotation=function(e){return{type:n.ConfirmDraftAnnotation,payload:{fileViewerId:e}}},t.cancelAnnotating=function(e){return{type:n.CancelAnnotating,payload:{fileViewerId:e}}},t.sortComments=function(){return{type:n.SortComments,payload:{}}},t.addAndCommitComment=function(e,t,a,o){return{type:n.AddAndCommitComment,payload:{author:e,content:a,fileIdentifier:t,threadId:o}}},t.editAndCommitComment=function(e,t,a,o,s){return{type:n.EditAndCommitComment,payload:{author:e,content:s,fileIdentifier:t,threadId:a,commentId:o}}},t.deleteAndCommitComment=function(e,t,a,o){return{type:n.DeleteAndCommitComment,payload:{author:e,fileIdentifier:t,threadId:a,commentId:o}}},t.deleteAndCommitThread=function(e,t,a){return{type:n.DeleteAndCommitThread,payload:{author:e,fileIdentifier:t,threadId:a}}},t.editorDidFocus=function(e){return{type:n.EditorDidFocus,payload:{fileViewerId:e}}},t.focusEditor=function(e){return{type:n.FocusEditor,payload:{fileViewerId:e}}},t.resolveNavigationToActiveThreadAnnotation=function(e){return{type:n.ResolveNavigationToActiveThreadAnnotation,payload:{fileViewerId:e}}},t.updateShowResolvedComments=function(e){return{type:n.UpdateShowResolvedComments,payload:{showResolvedComments:e}}},t.updateAnnotationMode=function(e){return{type:n.UpdateAnnotationMode,payload:{updatedAnnotationMode:e}}},t.logApprovalAction=function(e,t){return{type:n.LogApprovalAction,payload:{action:e,context:t}}},t.setHasLoggedCaptureImpression=function(e){return{type:a.LoggedImpressionForCaptureExperiment,payload:{hasLoggedImpression:e}}}})),define("typescript/component_libraries/files_components/src/blades/comments/data/read_thread_middleware",["require","exports","tslib","typescript/libraries/api_v2/redux/comments2","typescript/component_libraries/files_components/src/blades/comments/data/actions","typescript/component_libraries/files_components/src/blades/comments/data/transform","typescript/component_libraries/files_components/src/blades/comments/data/types"],(function(e,t,n,a,o,s,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createMiddleware=void 0;t.createMiddleware=()=>({dispatch:e,getState:t})=>i=>c=>n.__awaiter(void 0,void 0,void 0,(function*(){const n=i(c);if(c.type===o.Action.ActivateThread||c.type===o.Action.ActivateInitialThread){const{threadId:o,fileId:i,sharedLinkURL:d}=c.payload,l=t().threads[(0,r.createCommentFileIdentifier)(i,d)];if(null==l)return n;const m=l[o];if(m&&!m.read&&!m.readonly){const t=(0,s.createStreamFromFileOrSharedLink)(i,d);e((0,a.markThreadReadAction)({arg:{id:m.id,stream:t}}))}}return n}))})),define("typescript/component_libraries/files_components/src/blades/comments/data/reducer",["require","exports","typescript/component_libraries/files_components/src/blades/comments/data/actions","typescript/libraries/comments2/src/mentions/index","typescript/libraries/comments2/src/transforms/index","typescript/component_libraries/files_components/src/blades/comments/data/transform","redux","typescript/component_libraries/files_components/src/blades/comments/data/types","typescript/libraries/api_v2/redux/stickers","typescript/libraries/api_v2/redux/comments2","typescript/libraries/api_v2/redux/media_addon","typescript/component_libraries/flows/src/components/approval-forms/reducer","typescript/component_libraries/files_components/src/blades/comments/data/uuid"],(function(e,t,n,a,o,s,r,i,c,d,l,m,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.reducer=t.reducers=t.DEFAULT_STATE=t.Status=void 0;var p;(function(e){e[e.Disabled=0]="Disabled",e[e.ReadOnly=1]="ReadOnly",e[e.FullyEnabled=2]="FullyEnabled"})(p=t.Status||(t.Status={})),t.DEFAULT_STATE={threads:{},supportedEnhancements:{},boltInfo:{fileIdentifierToBoltMap:{},boltUniqueIdToStream:{}},activeThreadID:{},focusedThreadID:{},hoverThreadID:{},mentionsSearchResult:{currentQuery:"",result:[]},draftAnnotation:{},permissions:{},editorFocusRequest:{},pendingNavigationToActiveThreadAnnotation:{},status:{},thirdPartySource:{},mediaAddonFeatures:null,subscriptionStatus:{},enableCommentStatus:{},showResolvedComments:!1,approvalFormStatus:{},annotationSettings:{state:null,mode:i.SectionAnnotationMode.single},stickerPacks:null,captureExperiment:{hasLoggedImpression:!1}};const g=e=>{const{payload:{arg:{stream:t}}}=e;return b(t)};function b(e){return"file_path_or_id"===e.identifier[".tag"]?e.identifier.file_path_or_id:"shared_link_details"===e.identifier[".tag"]?e.identifier.url:void 0}function f(e){const{stream:t,id:n}=e.payload.arg;return"file_path_or_id"===t.identifier[".tag"]?{fileIdOrUrl:t.identifier.file_path_or_id,threadId:n}:"shared_link_details"===t.identifier[".tag"]?{fileIdOrUrl:t.identifier.url,threadId:n}:{}}function _(e){var t;const{payload:{arg:{id:n,stream:{identifier:a}}}}=e,o=null===(t=e.meta)||void 0===t?void 0:t.threadId;return"file_path_or_id"===a[".tag"]?{fileIdOrUrl:a.file_path_or_id,commentId:n,threadId:o}:"shared_link_details"===a[".tag"]?{fileIdOrUrl:a.url,commentId:n,threadId:o}:{}}function y(e,t,n,a){return Object.assign(Object.assign({},e),{[t]:n,pending:{action:a,originalValue:e[t],pendingValue:n}})}function v(e,t,n,a,o){const{comments:s}=e,r=s.findIndex(e=>e.id===t),i=s[r];if(!i)return e;const c=Object.assign(Object.assign({},i),{[n]:a}),d=[...s];return d.splice(r,1,c),y(e,"comments",d,o)}function A(e,t,n){return Object.assign(Object.assign({},e),{[t]:n?e.pending.originalValue:e[t],pending:void 0})}t.reducers={boltInfo:(e=t.DEFAULT_STATE.boltInfo,n)=>{if(n.type===d.Action.ListCommentsResult){const{payload:{arg:t,result:a}}=n,o=b(t.stream);if(o&&a)return{fileIdentifierToBoltMap:Object.assign(Object.assign({},e.fileIdentifierToBoltMap),{[o]:a.bolt_info}),boltUniqueIdToStream:Object.assign(Object.assign({},e.boltUniqueIdToStream),{[a.bolt_info.unique_id]:t.stream})}}return e},threads:(e=t.DEFAULT_STATE.threads,a)=>{const o=!!a.error;switch(a.type){case d.Action.AddComment:return h(e,a);case d.Action.AddCommentResult:return C(e,a,o);case d.Action.MarkThreadRead:case d.Action.MarkThreadUnread:return O(e,a);case d.Action.MarkThreadReadResult:case d.Action.MarkThreadUnreadResult:return T(e,a,o);case d.Action.ResolveThread:case d.Action.UnresolveThread:return M(e,a);case d.Action.ResolveThreadResult:case d.Action.UnresolveThreadResult:return I(e,a,o);case d.Action.EditComment:return S(e,a);case d.Action.EditCommentResult:return E(e,a,o);case d.Action.DeleteComment:return j(e,a);case d.Action.DeleteCommentResult:return w(e,a,o);case d.Action.ListCommentsResult:case d.Action.LoggedOutListCommentsResult:return R(e,a);case n.Action.AddAndCommitComment:return x(e,a);case n.Action.EditAndCommitComment:return U(e,a);case n.Action.DeleteAndCommitComment:return k(e,a);case n.Action.DeleteAndCommitThread:return F(e,a);default:return e}},supportedEnhancements:(e={},t)=>{var n;if(t.type===d.Action.ListCommentsResult){const{payload:{arg:a,result:o}}=t,s=b(a.stream);if(null!=s&&null!=o)return Object.assign(Object.assign({},e),{[s]:null!==(n=o.supported_enhancements)&&void 0!==n?n:{}})}return e},activeThreadID:(e=t.DEFAULT_STATE.activeThreadID,a)=>{switch(a.type){case n.Action.ActivateThread:case n.Action.ActivateInitialThread:return Object.assign(Object.assign({},e),{[a.payload.fileViewerId]:a.payload.threadId});case n.Action.DeactivateAllThreads:return Object.assign(Object.assign({},e),{[a.payload.fileViewerId]:""});case d.Action.AddComment:if(a.meta&&a.meta.tempThreadId)return Object.assign(Object.assign({},e),{[a.meta.fileViewerId]:a.meta.tempThreadId});break;case d.Action.AddCommentResult:const{meta:t,payload:{result:o}}=a;if(o&&t&&t.tempThreadId===e[t.fileViewerId])return Object.assign(Object.assign({},e),{[t.fileViewerId]:o.id})}return e},focusedThreadID:(e=t.DEFAULT_STATE.hoverThreadID,{type:a,payload:o})=>{if(a===n.Action.FocusThread){const t=Object.assign({},e);return null==o.threadId?delete t[o.fileViewerId]:t[o.fileViewerId]=o.threadId,t}return e},hoverThreadID:(e=t.DEFAULT_STATE.hoverThreadID,{type:a,payload:o})=>{if(a===n.Action.HoverThread){const t=Object.assign({},e);return null==o.threadId?delete t[o.fileViewerId]:t[o.fileViewerId]=o.threadId,t}return e},mentionsSearchResult:(e=t.DEFAULT_STATE.mentionsSearchResult,n)=>{switch(n.type){case a.MentionsAction.SearchContacts:return Object.assign(Object.assign({},e),{currentQuery:n.payload});case a.MentionsAction.SearchContactsResult:if(n.payload.query===e.currentQuery)return Object.assign(Object.assign({},e),{result:n.payload.result})}return e},permissions:(e=t.DEFAULT_STATE.permissions,n)=>{if(n.type!==d.Action.ListCommentsResult&&n.type!==d.Action.LoggedOutListCommentsResult)return e;const{payload:{arg:a,result:o}}=n,s=b(a.stream);if(!s||!o)return e;const r=o.permissions;return Object.assign(Object.assign({},e),{[s]:r})},draftAnnotation:(e=t.DEFAULT_STATE.draftAnnotation,a)=>{switch(a.type){case n.Action.UpdateDraftAnnotation:{const{fileViewerId:t,annotation:n}=a.payload;return n===e[t]?e:Object.assign(Object.assign({},e),{[t]:n})}case n.Action.CancelAnnotating:case n.Action.ClearDraftAnnotation:{const{fileViewerId:t}=a.payload;if(!(t in e))return e;const n=Object.assign({},e);return delete n[t],n}case d.Action.AddComment:if(null!=a.meta){const{fileViewerId:t}=a.meta;if(!(t in e))return e;const n=Object.assign({},e);return delete n[t],n}}return e},annotationSettings:(e=t.DEFAULT_STATE.annotationSettings,a)=>{var o;switch(a.type){case n.Action.CancelAnnotating:case d.Action.DisableCommentingResult:return Object.assign(Object.assign({},e),{state:null});case d.Action.AddComment:return e.mode===i.SectionAnnotationMode.single?Object.assign(Object.assign({},e),{state:null}):Object.assign(Object.assign({},e),{state:"annotating"});case n.Action.ActivateThread:case n.Action.ActivateInitialThread:return null===e.state?Object.assign(Object.assign({},e),{state:"viewing"}):"viewing"!==e.state?Object.assign(Object.assign({},e),{state:null}):e;case n.Action.DeactivateAllThreads:return"viewing"===e.state?Object.assign(Object.assign({},e),{state:null}):e;case n.Action.StartAnnotating:return a.payload.accessible?Object.assign(Object.assign({},e),{state:"annotating-ax"}):Object.assign(Object.assign({},e),{state:"annotating"});case n.Action.UpdateAnnotationMode:return"continuous"===a.payload.updatedAnnotationMode?{mode:a.payload.updatedAnnotationMode,state:null!==(o=e.state)&&void 0!==o?o:"annotating"}:{mode:a.payload.updatedAnnotationMode,state:null};case n.Action.ConfirmDraftAnnotation:return Object.assign(Object.assign({},e),{state:"commenting"})}return e},editorFocusRequest:(e=t.DEFAULT_STATE.editorFocusRequest,{type:a,payload:o})=>{if(a===n.Action.ConfirmDraftAnnotation&&!e[o.fileViewerId])return Object.assign(Object.assign({},e),{[o.fileViewerId]:!0});if(a===n.Action.FocusEditor&&!e[o.fileViewerId])return Object.assign(Object.assign({},e),{[o.fileViewerId]:!0});if(a===n.Action.EditorDidFocus&&e[o.fileViewerId]){const t=Object.assign({},e);return delete t[o.fileViewerId],t}return e},pendingNavigationToActiveThreadAnnotation:(e=t.DEFAULT_STATE.pendingNavigationToActiveThreadAnnotation,{type:a,payload:o})=>{if(a===n.Action.ActivateThread||a===n.Action.ActivateInitialThread)return Object.assign({[o.fileViewerId]:!0},e);if(a===n.Action.ResolveNavigationToActiveThreadAnnotation){const t=Object.assign({},e);return delete t[o.fileViewerId],t}return e},status:(e=t.DEFAULT_STATE.status,n)=>{if(n.type===d.Action.ListCommentsResult){const{payload:{arg:t,result:a}}=n,o=b(t.stream);if(o&&a)switch(a.status[".tag"]){case"disabled":return Object.assign(Object.assign({},e),{[o]:p.Disabled});case"enabled":return Object.assign(Object.assign({},e),{[o]:p.FullyEnabled});case"readonly":return Object.assign(Object.assign({},e),{[o]:p.ReadOnly})}}if(n.type===d.Action.LoggedOutListCommentsResult){const{payload:{arg:t}}=n,a=b(t.stream);if(a)return Object.assign(Object.assign({},e),{[a]:p.FullyEnabled})}return e},thirdPartySource:(e=t.DEFAULT_STATE.thirdPartySource,n)=>{if(n.type!==d.Action.ListCommentsResult)return e;const{payload:{arg:a,result:s}}=n,r=b(a.stream);if(!r||!s)return e;const i=s.supported_enhancements&&s.supported_enhancements.third_party_source;return Object.assign(Object.assign({},e),{[r]:i?(0,o.thirdPartySourceToIThirdPartySource)(i):void 0})},mediaAddonFeatures:(e=null,t)=>{var n;return t.type===l.Action.GetFeaturesResult?null!==(n=t.payload.result)&&void 0!==n?n:null:e},subscriptionStatus:(e=t.DEFAULT_STATE.subscriptionStatus,n)=>{if(n.type!==d.Action.SubscribeResult&&n.type!==d.Action.UnsubscribeResult)return e;const a=g(n);if(void 0===a)return e;switch(n.type){case d.Action.SubscribeResult:return Object.assign(Object.assign({},e),{[a]:{isSubscribed:!0,canSubscribe:!0}});case d.Action.UnsubscribeResult:return Object.assign(Object.assign({},e),{[a]:{isSubscribed:!1,canSubscribe:!0}});default:return e}},enableCommentStatus:(e=t.DEFAULT_STATE.enableCommentStatus,n)=>{var a;if(n.type!==d.Action.EnableCommentingResult&&n.type!==d.Action.DisableCommentingResult&&n.type!==d.Action.ListCommentsResult&&n.type!==d.Action.LoggedOutListCommentsResult)return e;const o=g(n);if(void 0===o)return e;switch(n.type){case d.Action.EnableCommentingResult:return Object.assign(Object.assign({},e),{[o]:{commentsEnabled:!0,canEnableCommenting:!0}});case d.Action.DisableCommentingResult:return Object.assign(Object.assign({},e),{[o]:{commentsEnabled:!1,canEnableCommenting:!0}});case d.Action.ListCommentsResult:case d.Action.LoggedOutListCommentsResult:const t=n.payload.result;return t?Object.assign(Object.assign({},e),{[o]:{commentsEnabled:!("disabled"===t.status[".tag"]),canEnableCommenting:!!(null===(a=t.permissions)||void 0===a?void 0:a.can_enable_commenting)}}):e;default:return e}},showResolvedComments:(e=t.DEFAULT_STATE.showResolvedComments,a)=>{switch(a.type){case n.Action.UpdateShowResolvedComments:return a.payload.showResolvedComments;default:return e}},approvalFormStatus:m.approvalReducer,stickerPacks:(e=t.DEFAULT_STATE.stickerPacks,n)=>{var a,o,s;return n.type===c.Action.GetStickersResult?null!==(s=null===(o=null===(a=n.payload.result)||void 0===a?void 0:a.sticker_sets)||void 0===o?void 0:o.map(e=>Object.assign(Object.assign({},e),{id:e.set_id})))&&void 0!==s?s:null:e},captureExperiment:(e=t.DEFAULT_STATE.captureExperiment,a)=>{const{payload:o,type:s}=a;return s===n.CaptureExperimentActions.LoggedImpressionForCaptureExperiment?{hasLoggedImpression:o.hasLoggedImpression}:e}};const h=(e,t)=>{const{payload:{arg:{thread_id:n,stream:a}}}=t,o=b(a);if(!o||!t.meta)return e;const r=e[o],{content:i,author:c,annotation:d}=t.meta;if(n){const a=r[n],{comments:l}=a,m=Object.assign(Object.assign({},a),{comments:[...l,(0,s.newCommentFromICommentContent)({content:i,threadId:n,author:c})],annotation:d||a.annotation});return Object.assign(Object.assign({},e),{[o]:Object.assign(Object.assign({},r),{[n]:Object.assign(Object.assign({},m),{pending:{action:t.type,originalValue:a,newValue:m}})})})}const{tempThreadId:l}=t.meta;if(l){const n=(0,s.newCommentFromICommentContent)({threadId:l,author:c,content:i}),a={id:l,timestamp:new Date,read:!0,readonly:!0,resolved:!1,comments:[n],annotation:d,isThirdParty:!1},m=Object.assign(Object.assign({},a),{pending:{action:t.type,originalValue:void 0,pendingValue:a}});return Object.assign(Object.assign({},e),{[o]:Object.assign(Object.assign({},r),{[l]:m})})}return e},C=(e,t,n)=>{const{payload:{arg:{thread_id:a,stream:o}}}=t,s=b(o);if(!s||!t.meta)return e;const r=e[s];if(a){const t=Object.assign({},r[a]),{originalValue:o}=t.pending;return t.pending=void 0,Object.assign(Object.assign({},e),{[s]:Object.assign(Object.assign({},r),{[a]:n?o:t})})}const{tempThreadId:i}=t.meta;let c=r;if(!n&&i in r&&t.payload.result){c=Object.assign({},r),delete c[i];const e=r[i],{id:n}=t.payload.result;e.readonly=!1,e.id=n,c[n]=Object.assign(Object.assign({},e),{pending:void 0})}return Object.assign(Object.assign({},e),{[s]:c})},O=(e,t)=>{const{fileIdOrUrl:n,threadId:a}=f(t);if(!n||!a)return e;const o=e[n];return Object.assign(Object.assign({},e),{[n]:Object.assign(Object.assign({},o),{[a]:y(o[a],"read",t.type===d.Action.MarkThreadRead,t.type)})})},T=(e,t,n)=>{const{fileIdOrUrl:a,threadId:o}=f(t);if(!a||!o)return e;const s=e[a];return Object.assign(Object.assign({},e),{[a]:Object.assign(Object.assign({},s),{[o]:A(s[o],"read",n)})})},M=(e,t)=>{const{fileIdOrUrl:n,threadId:a}=f(t);if(!n||!a)return e;const o=e[n];return Object.assign(Object.assign({},e),{[n]:Object.assign(Object.assign({},o),{[a]:y(o[a],"resolved",t.type===d.Action.ResolveThread,t.type)})})},I=(e,t,n)=>{const{fileIdOrUrl:a,threadId:o}=f(t);if(!a||!o)return e;const s=e[a];return Object.assign(Object.assign({},e),{[a]:Object.assign(Object.assign({},s),{[o]:A(s[o],"resolved",n)})})},S=(e,t)=>{const{fileIdOrUrl:n,threadId:a,commentId:o}=_(t);if(!(n&&a&&o&&t.meta))return e;const s=e[n],{content:r}=t.meta;return Object.assign(Object.assign({},e),{[n]:Object.assign(Object.assign({},s),{[a]:v(s[a],o,"content",r,t.type)})})},E=(e,t,n)=>{const{fileIdOrUrl:a,threadId:o,commentId:s}=_(t);if(!a||!o||!s)return e;const r=e[a];return Object.assign(Object.assign({},e),{[a]:Object.assign(Object.assign({},r),{[o]:A(r[o],"comments",n)})})},j=(e,t)=>{const{fileIdOrUrl:n,threadId:a,commentId:o}=_(t);if(!n||!a||!o)return e;const s=e[n];return Object.assign(Object.assign({},e),{[n]:Object.assign(Object.assign({},s),{[a]:v(s[a],o,"deleted",!0,t.type)})})},w=(e,t,n)=>{const{fileIdOrUrl:a,threadId:o,commentId:s}=_(t);if(!a||!o||!s)return e;const r=e[a];return Object.assign(Object.assign({},e),{[a]:Object.assign(Object.assign({},r),{[o]:A(r[o],"comments",n)})})},R=(e,t)=>{const{payload:{arg:n,result:a}}=t,s=b(n.stream);return s&&a?Object.assign(Object.assign({},e),{[s]:(0,o.threadsToIThreadMap)(a.threads,(0,o.usersToIUserMap)(a.users))}):e};function D(e,t,n){return Object.assign(Object.assign({},e),{[t]:n})}function L(e,t,n,a){const{comments:o}=e,s=o.findIndex(e=>e.id===t),r=o[s];if(!r)return e;const i=Object.assign(Object.assign({},r),{[n]:a}),c=[...o];return c.splice(s,1,i),D(e,"comments",c)}t.reducer=(0,r.combineReducers)(t.reducers);const U=(e,t)=>{const{payload:{content:n,threadId:a,fileIdentifier:o,commentId:s}}=t,r=e[o],i=r[a];return i?Object.assign(Object.assign({},e),{[o]:Object.assign(Object.assign({},r),{[a]:L(i,s,"content",n)})}):e},x=(e,t)=>{const{payload:{author:n,content:a,threadId:o,fileIdentifier:r}}=t,i=e[r];if(o){const t=i[o];if(!t)return e;const{comments:c}=t,d=Object.assign(Object.assign({},t),{comments:[...c,(0,s.newCommentFromICommentContent)({content:a,threadId:o,author:n})]});return Object.assign(Object.assign({},e),{[r]:Object.assign(Object.assign({},i),{[o]:Object.assign({},d)})})}{const t=(0,u.v4)(),o=(0,s.newCommentFromICommentContent)({threadId:t,author:n,content:a}),c={id:t,timestamp:new Date,read:!0,readonly:!0,resolved:!1,comments:[o],isThirdParty:!1};return Object.assign(Object.assign({},e),{[r]:Object.assign(Object.assign({},i),{[t]:c})})}},k=(e,t)=>{const{payload:{threadId:n,fileIdentifier:a,commentId:o}}=t;if(!a||!n||!o)return e;const s=e[a],r=s[n];return r?Object.assign(Object.assign({},e),{[a]:Object.assign(Object.assign({},s),{[n]:L(r,o,"deleted",!0)})}):e},F=(e,t)=>{const{payload:{threadId:n,fileIdentifier:a}}=t;if(!a||!n)return e;const o=e[a],s=o[n];return s?Object.assign(Object.assign({},e),{[a]:Object.assign(Object.assign({},o),{[n]:D(s,"comments",s.comments.map(e=>Object.assign(Object.assign({},e),{deleted:!0})))})}):e}})),define("typescript/component_libraries/files_components/src/blades/comments/data/selectors",["require","exports","typescript/component_libraries/files_components/src/blades/comments/data/types"],(function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isSingularlyAnnotating=t.getUnreadThreadCount=t.getAnnotationType=t.isUserSubscribed=t.areCommentsEnabled=void 0;t.areCommentsEnabled=(e,t)=>{var n;const a=e.permissions[t],o=e.enableCommentStatus[t];return Boolean(null!==(n=null==o?void 0:o.commentsEnabled)&&void 0!==n?n:null==a?void 0:a.can_see_comment_editor)};t.isUserSubscribed=(e,t)=>{var n;const a=e.permissions[t],o=e.subscriptionStatus[t];return Boolean(null!==(n=null==o?void 0:o.isSubscribed)&&void 0!==n?n:null==a?void 0:a.is_subscribed)};t.getAnnotationType=(e,t)=>{var n;const a=e.threads[t],o=a?Object.values(a).find(e=>void 0!==e.annotation):void 0;return null===(n=null==o?void 0:o.annotation)||void 0===n?void 0:n.type};t.getUnreadThreadCount=(e,t)=>{const n=e.threads[t];return n?Object.values(n).filter(e=>!e.read&&e.comments.some(e=>!e.deleted)).length:0};t.isSingularlyAnnotating=e=>e.annotationSettings.mode===n.SectionAnnotationMode.single})),define("typescript/component_libraries/files_components/src/blades/comments/component/comments_blade",["require","exports","tslib","react","react-intl","dig-components/icons","dig-components/icons/src","dig-components/badges","typescript/component_libraries/files_components/src/right-rail/right_rail","typescript/component_libraries/files_components/src/right-rail/hooks","typescript/component_libraries/files_components/src/blades/comments/component/meatball_menu","react-redux","typescript/component_libraries/files_components/src/blades/comments/data/selectors","typescript/component_libraries/files_components/src/blades/comments/data/types","dig-components/typography","typescript/component_libraries/files_components/src/blades/comments/component/index.module.css"],(function(e,t,n,a,o,s,r,i,c,d,l,m,u,p,g,b){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CollapsedCommentsBladeButton=t.CommentsBlade=void 0,a=n.__importStar(a),b=n.__importDefault(b);const f=(0,o.defineMessage)({id:"5PJLxb",defaultMessage:"{unreadCount} unread"}),_=(0,o.defineMessage)({id:"ZKwnCD",defaultMessage:"An error occurred."}),y=e=>(0,m.useSelector)(t=>e?(0,u.getUnreadThreadCount)(t,e):0);class v extends a.PureComponent{constructor(){super(...arguments),this.state={hasError:!1}}static getDerivedStateFromError(){return{hasError:!0}}render(){const{intl:e}=this.props;return this.state.hasError?a.createElement(g.Text,null,e.formatMessage(_)):this.props.children}}v.displayName="CommentsBladeErrorBoundary";const A=({fileId:e,sharedLinkURL:t,showOverflowMenu:n,dragSectionAnnotationEnabled:s,approvalIOClient:r})=>{const c=y((0,p.createCommentFileIdentifier)(e,t)),d=(0,o.useIntl)();return a.createElement("div",{className:b.default.commentsBladeHeaderAccessoryWrapper},c>0?a.createElement("div",{className:"comments-blade-header-badge"},a.createElement(i.NotificationBadge,{status:"attention"},d.formatMessage(f,{unreadCount:c}))):null,n&&a.createElement("div",{className:b.default.commentsBladeHeaderMenu},a.createElement(l.CommentsMeatball,{fileId:e,sharedLinkURL:t,size:"small",dragSectionAnnotationEnabled:s,approvalIOClient:r})))};A.displayName="CommentsBladeRightAccessory";t.CommentsBlade=({id:e,intl:t,children:n,fileId:i,sharedLinkURL:l,dragSectionAnnotationEnabled:m,approvalIOClient:u})=>{const p=(0,d.useIsExpanded)(e);return a.createElement(o.RawIntlProvider,{value:t},a.createElement(c.RightRail.Blade,{withTitle:t.formatMessage({id:"TxGYML",defaultMessage:"Comments"}),withIcon:a.createElement(s.UIIcon,{src:r.CommentLine}),id:e,withTitleRightAccessory:a.createElement(A,{fileId:i,sharedLinkURL:l,showOverflowMenu:p,dragSectionAnnotationEnabled:m,approvalIOClient:u}),headerTooltipDataAttribute:"right-rail-comments-blade-header"},a.createElement(v,{intl:t},n)))},t.CommentsBlade.displayName="CommentsBlade";t.CollapsedCommentsBladeButton=({id:e,intl:t,fileId:n,sharedLinkURL:o})=>{const i=y(n?(0,p.createCommentFileIdentifier)(n,o):void 0);return a.createElement(c.RightRail.CollapsedBladeIcon,{id:e,withIcon:a.createElement(s.UIIcon,{src:r.CommentLine,"aria-label":t.formatMessage({id:"JrjHYo",defaultMessage:"Open comments panel"})}),tooltip:t.formatMessage({id:"GSZlCi",defaultMessage:"Comments"}),withNotificationBadge:i})},t.CollapsedCommentsBladeButton.displayName="CollapsedCommentsBladeButton"})),define("typescript/component_libraries/files_components/src/blades/comments/component/index.module.css",["require","exports","css!typescript/component_libraries/files_components/src/blades/comments/component/index.module.out.css"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.commentsBladeLoadingSpinnerContainer=t.commentsBladeHeaderMenu=t.commentsBladeHeaderAccessoryWrapper=t.commentStreamMeatballIcon=t.scThreadEditorIsFocused=t.scThread=t.scCommentStreamEditor=t.scCommentStream=t.baseCommentsPaneBlade=void 0,t.baseCommentsPaneBlade="_base-comments-pane-blade_1gy19_1",t.scCommentStream="_sc-comment-stream_1gy19_5",t.scCommentStreamEditor="_sc-comment-stream-editor_1gy19_9",t.scThread="_sc-thread_1gy19_14",t.scThreadEditorIsFocused="_sc-thread-editor-is-focused_1gy19_19",t.commentStreamMeatballIcon="_comment-stream-meatball-icon_1gy19_23",t.commentsBladeHeaderAccessoryWrapper="_comments-blade-header-accessory-wrapper_1gy19_28",t.commentsBladeHeaderMenu="_comments-blade-header-menu_1gy19_34",t.commentsBladeLoadingSpinnerContainer="_comments-blade-loading-spinner-container_1gy19_38";t.default={baseCommentsPaneBlade:"_base-comments-pane-blade_1gy19_1",scCommentStream:"_sc-comment-stream_1gy19_5",scCommentStreamEditor:"_sc-comment-stream-editor_1gy19_9",scThread:"_sc-thread_1gy19_14",scThreadEditorIsFocused:"_sc-thread-editor-is-focused_1gy19_19",commentStreamMeatballIcon:"_comment-stream-meatball-icon_1gy19_23",commentsBladeHeaderAccessoryWrapper:"_comments-blade-header-accessory-wrapper_1gy19_28",commentsBladeHeaderMenu:"_comments-blade-header-menu_1gy19_34",commentsBladeLoadingSpinnerContainer:"_comments-blade-loading-spinner-container_1gy19_38"}})),define("typescript/libraries/comments2/src/components/utils/thread_utils",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.findCommentThread=void 0,t.findCommentThread=function(e,t){for(const n of e){const e=n.comments;for(const a of e)if(a.id===t)return{comment:a,thread:n}}return null}})),define("typescript/libraries/file-viewer/src/comments2/plugin/comment_markers",["require","exports","tslib","typescript/component_libraries/files_components/src/blades/comments/index","react","react-dom","react-redux","lodash","typescript/libraries/file-viewer/src/hooks/useStabilizedCallback","typescript/libraries/file-viewer/src/toolbar/audio_video_markers","typescript/libraries/file-viewer/src/core/logging/video","typescript/component_libraries/files_components/src/blades/comments/data/types"],(function(e,t,n,a,o,s,r,i,c,d,l,m){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CommentMarkers=void 0,o=n.__importStar(o);const u=({file:e,duration:t,fileViewerId:n,audioVideoMetadata:s,logVideoAction:u})=>{const p=(0,m.createCommentFileIdentifier)(e.file_id,e.url),g=(0,r.useDispatch)(),b=(0,r.useSelector)(e=>e.threads[p]||{}),f=(0,c.useStabilizedCallback)(t=>{g((0,a.activateThread)({fileId:e.file_id,fileViewerId:n,isThirdParty:t.isThirdParty,threadId:t.id}))}),_="video"===(null==s?void 0:s[".tag"])?null==s?void 0:s.thumb_scrubber_vtt_url:void 0,y=(0,o.useCallback)((0,i.once)(e=>{u(e?l.VideoPreviewEvent.ScrubberThumbnailsLoaded:l.VideoPreviewEvent.ScrubberThumbnailsFailed)}),[u]);return o.default.createElement(d.AudioVideoMarkersComponent,{threads:b,vttUrl:_,onScrubberThumbnailsLoaded:y,duration:t,openThreadInRightRail:f})};u.displayName="CommentMarkersComponent";t.CommentMarkers=e=>{var{container:t}=e,a=n.__rest(e,["container"]);return(0,s.createPortal)(o.default.createElement(u,Object.assign({},a)),t)},t.CommentMarkers.displayName="CommentMarkers",t.CommentMarkers.displayName="CommentMarkers"})),define("typescript/component_libraries/files_components/src/blades/comments/data/types",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SectionAnnotationMode=t.createCommentFileIdentifier=void 0;t.createCommentFileIdentifier=(e,t)=>t||e,(function(e){e.continuous="continuous",e.single="single"})(t.SectionAnnotationMode||(t.SectionAnnotationMode={}))})),define("typescript/libraries/file-viewer/src/comments2/plugin/navigation_middleware",["require","exports","typescript/component_libraries/files_components/src/blades/comments/data/actions","typescript/component_libraries/files_components/src/blades/comments/data/types","typescript/libraries/api_v2/redux/comments2","typescript/libraries/file-viewer/src/core/logging/constants"],(function(e,t,n,a,o,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createMiddleware=void 0;t.createMiddleware=e=>({getState:t,dispatch:r})=>i=>c=>{var d;switch(i(c),c.type){case n.Action.ResolveNavigationToActiveThreadAnnotation:return;case n.Action.ActivateInitialThread:case n.Action.ActivateThread:case o.Action.ListCommentsResult:{const o=t();for(const t of Object.getOwnPropertyNames(o.pendingNavigationToActiveThreadAnnotation)){if(t===e.fileViewerId){const{file:i,navigation:c}=e.getPluginData();if(null!=i){const e=(0,a.createCommentFileIdentifier)(i.fileId,i.url),l=o.activeThreadID[t],m=null===(d=o.threads[e])||void 0===d?void 0:d[l];if(m&&m.annotation){const e=m.annotation;"document"===e.type&&"navigateToPage"in c&&c.navigateToPage((e.regions[0].page||1)-1,s.UserActionContext.RightRail),("audio"===e.type||"video"===e.type)&&"seek"in c&&c.seek(e.time),r((0,n.resolveNavigationToActiveThreadAnnotation)(t))}}}return}}}}})),define("typescript/libraries/file-viewer/src/comments2/logging_middleware",["require","exports","typescript/libraries/api_v2/redux/comments2","typescript/component_libraries/files_components/src/blades/comments/data/actions","typescript/component_libraries/files_components/src/blades/comments/data/transform"],(function(e,t,n,a,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.middleware=void 0;function s({event:e,stream:t,thread_id:a,comment_id:o,is_third_party:s,error:r}){return(0,n.logEventAction)({arg:{event:r?{".tag":"comment_error"}:e,stream:t,thread_id:a,comment_id:o,is_third_party:s,oref:"dfv",product_surface:{".tag":"file_preview"},product_surface_context:{".tag":"file_preview"},error_message:r?r.message:void 0}})}t.middleware=({dispatch:e})=>t=>r=>{const i=t(r);if(r.type===n.Action.AddCommentResult)e(s({event:r.payload.arg.thread_id?{".tag":"reply_to_comment"}:{".tag":"new_comment"},stream:r.payload.arg.stream,thread_id:r.payload.arg.thread_id,error:r.error}));else if(r.type===n.Action.MarkThreadReadResult)e(s({event:{".tag":"mark_thread_as_read"},stream:r.payload.arg.stream,thread_id:r.payload.arg.id,error:r.error}));else if(r.type===n.Action.MarkThreadUnreadResult)e(s({event:{".tag":"mark_thread_as_unread"},stream:r.payload.arg.stream,thread_id:r.payload.arg.id,error:r.error}));else if(r.type===n.Action.ResolveThreadResult)e(s({event:{".tag":"resolve_thread"},stream:r.payload.arg.stream,thread_id:r.payload.arg.id,error:r.error}));else if(r.type===n.Action.UnresolveThreadResult)e(s({event:{".tag":"unresolve_thread"},stream:r.payload.arg.stream,thread_id:r.payload.arg.id,error:r.error}));else if(r.type===n.Action.DeleteCommentResult)e(s({event:{".tag":"delete_comment"},stream:r.payload.arg.stream,thread_id:r.meta?r.meta.threadId:void 0,comment_id:r.payload.arg.id,error:r.error}));else if(r.type===n.Action.EditCommentResult)e(s({event:{".tag":"edit_comment"},stream:r.payload.arg.stream,thread_id:r.meta?r.meta.threadId:void 0,comment_id:r.payload.arg.id,error:r.error}));else if(r.type===a.Action.ActivateThread){const{fileId:t,isThirdParty:n,threadId:a}=r.payload,i=(0,o.createStreamFromFileId)(t);e(s({event:{".tag":"activate_thread"},stream:i,thread_id:a,is_third_party:n}))}return i}})),define("typescript/component_libraries/files_components/src/blades/comments/data/store",["require","exports","typescript/libraries/api_v2/redux/comments2","typescript/libraries/api_v2/redux/files","typescript/libraries/api_v2/redux/media_addon","typescript/libraries/api_v2/redux/stickers","typescript/component_libraries/files_components/src/blades/comments/data/bolt_middleware","typescript/libraries/comments2/src/mentions/index","redux","typescript/component_libraries/files_components/src/blades/comments/data/reducer","typescript/component_libraries/files_components/src/blades/comments/data/read_thread_middleware","typescript/component_libraries/files_components/src/blades/comments/data/logging_middleware"],(function(e,t,n,a,o,s,r,i,c,d,l,m){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.makeStore=void 0,t.makeStore=function({apiv2ClientBase:e,boltIOClient:t,mentionsIOClient:u,logger:p},g){const b=[(0,a.middleware)(e.ns("files")),(0,n.middleware)(e.ns("comments2")),(0,o.middleware)(e.ns("media_addon")),(0,s.middleware)(e.ns("stickers")),(0,r.middleware)(t),(0,l.createMiddleware)()];u&&b.push((0,i.middleware)(u)),p&&b.push((0,m.createCommentsBladeLoggingMiddleware)(p)),g&&b.push(...g);const f=(0,c.applyMiddleware)(...b),_=window.__REDUX_DEVTOOLS_EXTENSION__,y=null==_?f:(0,c.compose)(f,_({name:"FVSDK Comments2 Plugin"}));return(0,c.createStore)(d.reducer,y)}})),define("typescript/libraries/comments2/src/mentions/index",["require","exports","typescript/libraries/comments2/src/mentions/actions","typescript/libraries/comments2/src/mentions/middleware"],(function(e,t,n,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MentionsIOClient=t.middleware=t.SearchContactsResultAction=t.SearchContactsAction=t.searchContactsResult=t.searchContacts=t.MentionsAction=void 0,Object.defineProperty(t,"MentionsAction",{enumerable:!0,get:function(){return n.MentionsAction}}),Object.defineProperty(t,"searchContacts",{enumerable:!0,get:function(){return n.searchContacts}}),Object.defineProperty(t,"searchContactsResult",{enumerable:!0,get:function(){return n.searchContactsResult}}),Object.defineProperty(t,"SearchContactsAction",{enumerable:!0,get:function(){return n.SearchContactsAction}}),Object.defineProperty(t,"SearchContactsResultAction",{enumerable:!0,get:function(){return n.SearchContactsResultAction}}),Object.defineProperty(t,"middleware",{enumerable:!0,get:function(){return a.middleware}}),Object.defineProperty(t,"MentionsIOClient",{enumerable:!0,get:function(){return a.MentionsIOClient}})})),define("typescript/libraries/file-viewer/src/comments2/plugin/annotation_banner",["require","exports","tslib","react","react-redux","react-intl","dig-components/banner","typescript/component_libraries/files_components/src/blades/comments/data/actions","dig-components/buttons","typescript/libraries/file-viewer/src/ui/header.module.css","typescript/libraries/file-viewer/src/core/types/preview_type","typescript/component_libraries/files_components/src/blades/comments/data/types","typescript/component_libraries/files_components/src/blades/comments/data/selectors","typescript/libraries/comments2/src/hooks/continuous_annotation_hook"],(function(e,t,n,a,o,s,r,i,c,d,l,m,u,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AnnotationBanner=void 0,a=n.__importStar(a);const g=(0,s.defineMessage)({id:"IKrBL8",defaultMessage:"Highlight a section to comment on"}),b=(0,s.defineMessage)({id:"Dm5bk9",defaultMessage:"Highlight an area to comment on"}),f=(0,s.defineMessage)({id:"VYvI4T",defaultMessage:"Using the arrow keys, select an area to comment on, then hit enter."}),_=(0,s.defineMessage)({id:"gO661I",defaultMessage:"Enable continuous commenting?"}),y=(0,s.defineMessage)({id:"pCmwyu",defaultMessage:"Now, add your comment in the comments pane"}),v=(0,s.defineMessage)({id:"8UKHBA",defaultMessage:"Using the arrow keys, select a timestamp to comment on, then hit enter"}),A=(0,s.defineMessage)({id:"DeTJfa",defaultMessage:"Add your comment in the comments pane"}),h=(0,s.defineMessage)({id:"55kTfU",defaultMessage:"Cancel"}),C=(0,s.defineMessage)({id:"+Guzmf",defaultMessage:"Enable"});t.AnnotationBanner=a.memo(({fileViewerId:e,previewType:t,dragSectionAnnotationEnabled:n})=>{const O=(0,o.useSelector)(e=>e.annotationSettings.state),T=(0,o.useDispatch)(),M=(0,s.useIntl)(),[I,S]=(0,p.useContinuousAnnotation)(),E=(0,o.useSelector)(u.isSingularlyAnnotating),j=n&&!I&&"annotating"===O?()=>{T((0,i.updateAnnotationMode)(m.SectionAnnotationMode.continuous)),S()}:()=>{T((0,i.cancelAnnotating)(e))};let w,R=M.formatMessage(h),D=void 0;if(t===l.PreviewType.Audio||t===l.PreviewType.Video)if("commenting"===O)w=M.formatMessage(A);else{if("annotating-ax"!==O)return null;w=M.formatMessage(v)}else if(!I&&n&&E&&"annotating"===O)w=M.formatMessage(_),R=M.formatMessage(C),D=M.formatMessage({id:"LwqLT7",defaultMessage:"Close"});else if("annotating"===O)w=t===l.PreviewType.Image?M.formatMessage(b):M.formatMessage(g);else if("annotating-ax"===O)w=M.formatMessage(f);else{if("commenting"!==O)return null;w=M.formatMessage(y)}return a.createElement("div",{className:d.floatingHeader},a.createElement(r.Banner,{type:"attention",withLeftIcon:!1,onRequestClose:()=>{S()},withCloseButton:D},a.createElement(r.Banner.Message,null,w),a.createElement(r.Banner.Actions,null,a.createElement(c.Button,{variant:"transparent",onClick:j},R))))}),t.AnnotationBanner.displayName="AnnotationBanner",t.AnnotationBanner.displayName="AnnotationBanner"})),define("typescript/component_libraries/files_components/src/blades/comments/index",["require","exports","tslib","typescript/component_libraries/files_components/src/blades/comments/component/comments_blade","typescript/component_libraries/files_components/src/blades/comments/data/selectors","typescript/component_libraries/files_components/src/blades/comments/data/reducer","typescript/component_libraries/files_components/src/blades/comments/data/read_thread_middleware","typescript/component_libraries/files_components/src/blades/comments/data/store","typescript/component_libraries/files_components/src/blades/comments/data/actions"],(function(e,t,n,a,o,s,r,i,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.__exportStar(a,t),n.__exportStar(o,t),n.__exportStar(s,t),n.__exportStar(r,t),n.__exportStar(i,t),n.__exportStar(c,t)})),define("typescript/libraries/file-viewer/src/comments2/plugin/loader/eager",["require","exports","tslib","typescript/libraries/file-viewer/src/comments2/plugin/types","typescript/libraries/file-viewer/src/comments2/plugin/comment_plugin"],(function(e,t,n,a,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.makeLoader=void 0,t.makeLoader=function(e,t,s={},r){return{pluginId:a.COMMENTS_PLUGIN_ID,load:(a,i)=>n.__awaiter(this,void 0,void 0,(function*(){return new o.Comments2Plugin(a,i,s,e,t,r)}))}}})),define("typescript/libraries/comments2/src/components/utils/approval_utils",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getApprovers=t.canRespondToApproval=t.findActionableApprovalCommentId=t.getApprovalRequestsSubtext=t.getApprovalRequestCounts=t.isApprovalRequester=t.isApprovalThread=t.getApprovalMetadata=void 0;t.getApprovalMetadata=e=>{for(const t of e)if("approval"===t.type)return t};t.isApprovalThread=e=>!!(0,t.getApprovalMetadata)(e.comments[e.comments.length-1].content.metadata);t.isApprovalRequester=e=>{const n=(0,t.getApprovalMetadata)(e.comments[e.comments.length-1].content.metadata);return"requester"===(null==n?void 0:n.actor)};const n=e=>{const n=(0,t.getApprovalMetadata)(e.comments[e.comments.length-1].content.metadata),a=null==n?void 0:n.approvers,o=null==n?void 0:n.requires_all;let s=0;if(!a)return 0;for(const e of a)if("approved"!==e.overall_status)s++;else if(!o)return 0;return o?s:1};t.getApprovalRequestCounts=e=>{let a=0,o=0;for(const s of e){const e=n(s);0!==e&&(a+=e),(0,t.isApprovalThread)(s)&&o++}return[a,o]};t.getApprovalRequestsSubtext=(e,t)=>t.formatMessage({id:"sj45d1",defaultMessage:"{openRequestsCount} {openRequestsCount, plural, one {approval request} other {approval requests}} open"},{openRequestsCount:e});t.findActionableApprovalCommentId=e=>{const n=e.comments.filter(e=>!e.deleted),a=(0,t.getApprovalMetadata)(n[0].content.metadata),o=null==a?void 0:a.actor;if("requester"===o){const e=n[n.length-1],a=(0,t.getApprovalMetadata)(e.content.metadata);if("request"===(null==a?void 0:a.approval_type))return e.id;for(let e=n.length-1;e>=0;e--){const a=n[e],o=(0,t.getApprovalMetadata)(a.content.metadata);if("request"===(null==o?void 0:o.approval_type))return;if("response"===(null==o?void 0:o.approval_type)&&"rejected"===(null==o?void 0:o.status))return a.id}}if("approver"===o)for(let e=n.length-1;e>=0;e--){const a=n[e],o=(0,t.getApprovalMetadata)(a.content.metadata),s=n[e].userPermissions.canEdit;if("request"===(null==o?void 0:o.approval_type))return a.id;if("response"===(null==o?void 0:o.approval_type)&&s)return a.id}};t.canRespondToApproval=e=>{const n=(0,t.getApprovalMetadata)(e.content.metadata);return"request"===(null==n?void 0:n.approval_type)&&"approver"===(null==n?void 0:n.actor)&&!e.userPermissions.canEdit&&!e.userPermissions.canDelete};t.getApprovers=e=>{const n=(0,t.getApprovalMetadata)(e.comments[e.comments.length-1].content.metadata);return null==n?void 0:n.approvers}}));
//# sourceMappingURL=pkg-comments.min.js-vflwwf6nj.map