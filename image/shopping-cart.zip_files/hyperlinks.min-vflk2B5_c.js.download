define(["require","exports","tslib","typescript/libraries/comments2/src/components/folder_overview_editor/components/link_span_component","typescript/libraries/comments2/src/components/comment_editor/core/class_decorators","typescript/libraries/comments2/src/components/comment_editor/core/types/index","typescript/libraries/comments2/src/components/comment_editor/layers/scaffold","draft-js","typescript/libraries/comments2/src/components/comment_editor/draft_utils","typescript/libraries/comments2/src/components/utils/url_utils"],(function(t,e,n,r,o,i,s,a,c,p){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.createLinkInEditorState=e.HyperlinkLayer=void 0;const l=t=>{(0,p.safeWindowOpen)(t,!0)};class d extends i.BaseLayer{addDecorators(t){return[...t.innerProps.value,{strategy:function(t,e,n){t.findEntityRanges((function(t){const e=t.getEntity();return null!==e&&"hyperlink"===n.getEntity(e).getType()}),e)},props:{readOnly:t.status.draft.readOnly,onOpenLink:l},component:r.LinkSpanComponent}]}initHyperlinks(t){const{value:e,evt:n}=t.innerProps,{hyperlinks:r}=this.splitHyperlinks(n.metadata);return a.EditorState.createWithContent(r.reduce((t,e)=>{const n=t.createEntity("hyperlink","MUTABLE",{url:e.url}),r=n.getLastCreatedEntityKey(),o=(0,c.locationToSelection)(e.location,n);return a.Modifier.applyEntity(t,o,r)},e.getCurrentContent()))}postHyperlinks(t){const{evt:e,value:n}=t.innerProps,r=this.getHyperlinkMetadata((0,a.convertToRaw)(e.getCurrentContent())),{other:o}=this.splitHyperlinks(n.metadata);return{...n,metadata:[...o,...r]}}getHyperlinkMetadata(t){const{blocks:e}=t,{metadata:n}=e.reduce((e,n)=>{const{metadata:r,pos:o}=e;return{metadata:[...r,...n.entityRanges.filter((function(e){return"hyperlink"===t.entityMap[e.key].type})).map((function(e){return{type:"hyperlink",url:t.entityMap[e.key].data.url,location:{start:o+e.offset,end:o+e.offset+e.length}}}))],pos:o+(0,c.decodeUnicode)(n.text).length}},{metadata:[],pos:0});return n}splitHyperlinks(t){return t.reduce((t,e)=>"hyperlink"===e.type?{hyperlinks:[...t.hyperlinks,e],other:t.other}:{hyperlinks:t.hyperlinks,other:[...t.other,e]},{hyperlinks:[],other:[]})}}n.__decorate([(0,o.plug)(s.into.draft.on.init.update.decorators)],d.prototype,"addDecorators",null),n.__decorate([(0,o.plug)(s.into.draft.on.populateWithComment.update.editorState)],d.prototype,"initHyperlinks",null),n.__decorate([(0,o.plug)(s.into.comment.on.post.update.content)],d.prototype,"postHyperlinks",null),e.HyperlinkLayer=d,e.createLinkInEditorState=function({url:t,editorState:e}){let n=e.getCurrentContent(),r=e.getSelection();n=a.Modifier.insertText(n,r,t),r=r.merge({focusOffset:r.getStartOffset()+t.length});const o=n.createEntity("hyperlink","MUTABLE",{url:t}),i=o.getLastCreatedEntityKey(),s=a.EditorState.set(e,{currentContent:o});let c=a.RichUtils.toggleLink(s,r,i),p=c.getSelection();const l=p.getFocusOffset()<p.getAnchorOffset()?p.getAnchorOffset():p.getFocusOffset();return p=p.merge({anchorOffset:l,focusOffset:l}),c=a.EditorState.forceSelection(c,p),c}}));
//# sourceMappingURL=hyperlinks.min.js-vflHB6zpX.map