define(["require","exports","tslib","metaserver/static/js/core/exception_info","metaserver/static/js/core/xhr"],(function(e,t,r,i,o){"use strict";var c;Object.defineProperty(t,"__esModule",{value:!0}),t._clearReportedException=t.sendExceptionReport=void 0,(function(e){e.Reported="reported",e.ForceReported="force",e.Duplicate="duplicate",e.Ignored="ignored"})(c||(c={}));function n(t,i){return r.__awaiter(this,void 0,void 0,(function*(){try{const{getMetricsReporter:o}=yield new Promise((t,r)=>{e(["metaserver/static/js/metrics/index"],t,r)}).then(r.__importStar),c={rollup_format:"off"},n=o().child(c).createCounter({ns:"js_exception",name:"count"},{which:t,severity:i||"undefined"});n.increment(),n.record()}catch(e){0}}))}let s=0;let a=void 0;t.sendExceptionReport=function(e){if(e.reported)return void n(c.Duplicate,e.severity);if(a&&!e.force&&!window._REPORT_ALL_JS_EXCEPTIONS_ENABLED)return void n(c.Ignored,e.severity);if(e.severity||(e.severity=i.SEVERITY.NONCRITICAL,e.tags=e.tags||[],e.tags.push("undefined_severity")),!e.stack_frames){const[t,r]=(0,i.collectExceptionStack)(e);e.stack_frames=t.reverse(),e.context_tb=r.reverse()}var t;e.tags=(0,i.collectExceptionTags)(e),e.excExtra=(0,i.collectExceptionExtra)(e),t=e.excExtra,s+=1,t.exception_number=s,window.DB_FRAME_BUST&&(e.severity=i.SEVERITY.USER_ERROR);const r={e:e.message,loc:window.location.href,ref:document.referrer,stack:JSON.stringify(e.stack_frames),context_tb:JSON.stringify(e.context_tb),tags:JSON.stringify(e.tags),exc_extra:JSON.stringify(e.excExtra||{}),sev:e.severity||""};(0,o.sendXhr)("/jse",r),a&&e.force?n(c.ForceReported,e.severity):n(c.Reported,e.severity),a=e.message,e.reported=!0},t._clearReportedException=function(){a=void 0}}));
//# sourceMappingURL=exception_reporter.min.js-vflnayOls.map