define("metaserver/static/js/growth/smb_funnel/smb_funnel_logger",["require","exports","metaserver/static/js/metrics/index","metaserver/static/js/core/exception","typescript/libraries/shared/apex-metrics/src/index"],(function(e,t,r,s,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SMBFunnelLogger=t.SMBFunnelLoggerSingleton=t.Platform=void 0,(function(e){e.WEB="web",e.DESKTOP_SSCV="desktop_sscv",e.MOBILE_WEB="mobile_web"})(t.Platform||(t.Platform={}));const i=["platform","variant","isJoiner"],a=e=>{const t={};return Object.keys(e).forEach(r=>{i.indexOf(r)>=0&&(t[r]=e[r])}),t};class n{constructor(e={}){this.setCommonTags=e=>{const t=a(e);Object.keys(t).forEach(t=>{this.commonTags[t]&&this.commonTags[t]!==e[t]&&(0,s.reportStack)(`Attempting to change ${t} after it was already set`,{severity:s.SEVERITY.NONCRITICAL,tags:["activation-targeted","smb-funnel"]})}),this.commonTags=t},this.log=(e,t={})=>{const r=Object.assign(Object.assign({},this.commonTags),t),s=this.metricsReporter.createCounter({ns:"smb_funnel",name:e},r);s.increment(),s.record()},this.logDuration=(e,t,r={})=>{const s=Object.assign(Object.assign({},this.commonTags),r);this.metricsReporter.createStats({ns:"smb_funnel",name:e},s).recordDuration(t,o.TimeUnit.MILLISECONDS)},this.commonTags=a(e),this.metricsReporter=(0,r.getMetricsReporter)()}}t.SMBFunnelLoggerSingleton=n,t.SMBFunnelLogger=new n})),define("metaserver/static/js/admin/ui/teams/onboarding/web/constants",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ContUrl=t.FlowId=t.AMPMetrics=t.Platform=t.BackgroundColors=t.StepStatus=t.Steps=t.MODULE_NAME=t.FRAMEWORK=void 0,t.FRAMEWORK="team_setup_essential",t.MODULE_NAME="smooth_transitions",(function(e){e.VERIFICATION="verification",e.RIGHTSIZING="rightsizing",e.TEAM_INFO="team_info",e.MOVE_FOLDERS="move_folders",e.CONFIRM_FOLDERS="confirm_folders",e.RESULTS_FOLDERS="results_folders",e.INVITE_MEMBERS="invite_members",e.SUGGESTED_INVITE_MEMBERS="suggested_invite_members",e.INVITE_MOBILE="invite_mobile",e.INSTALL="install",e.INSTALL_MOBILE="install_mobile",e.IMPORT_CONTACTS="import_contacts",e.ROLE="role",e.COLLABORATION="collaboration",e.LOADING_SCREEN="loading_screen",e.PAIR="team_install_page_pair",e.OPEN="team_install_page_open",e.DOWNLOAD="team_install_page_download",e.DOWNLOAD_COMPLETE="download_complete",e.MOBILE_INSTALL="mobile_install",e.DOCSEND_ONBOARD="docsend_onboard",e.JOIN_ACCEPT="join_accept",e.JOIN_LOGIN="join_login",e.JOIN_MOVE_FILES="join_move_files",e.JOIN_PRIVACY_QUESTION="privacy_question",e.JOIN_TWO_ACCOUNT_SUGGESTION="two_account_suggestion",e.JOIN_ONE_ACCOUNT_SUGGESTION="one_account_suggestion",e.JOIN_CREATE_NEW_PERSONAL="create_new_personal",e.JOIN_PERSONAL_VERIFICATION="personal_verification",e.HELP_US_HELP_YOU="help_us_help_you"})(t.Steps||(t.Steps={})),(function(e){e.Inactive="inactive",e.Active="active",e.Completed="completed"})(t.StepStatus||(t.StepStatus={})),(function(e){e.CELADON="celadon",e.CLOUD="cloud",e.NAVY="navy",e.ORCHID="orchid",e.SAPPHIRE="sapphire",e.SAND="sand",e.VANILLA="vanilla",e.WHITE="white"})(t.BackgroundColors||(t.BackgroundColors={})),(function(e){e.DESKTOP_WEB="desktop_web",e.DESKTOP_SSCV="desktop_sscv",e.MOBILE_WEB="mobile_web"})(t.Platform||(t.Platform={})),(function(e){e.SETUP_START="setup/start",e.SETUP_FINISH="setup/finish",e.SETUP_STEP_START="setup/step/start",e.SETUP_STEP_FINISH="setup/step/finish",e.SETUP_STEP_ERROR="setup/step/error",e.SETUP_STEP_INTERRUPT="setup/step/interrupt",e.SETUP_STEP_CTA="setup/step/cta",e.SETUP_STEP_FETCH="setup/step/fetch",e.ACTIVATION_IMM_VIEW="activation/imm/view",e.ACTIVATION_IMM_ADD_MEMBERS="activation/imm/add_members",e.ACTIVATION_DESKTOP_ICON_OPEN="activation/desktop_icon/open",e.ACTIVATION_EMPTY_STATE_VIEW="activation/empty_state/view",e.ACTIVATION_EMPTY_STATE_CLICK_UPLOAD_CTA="activation/empty_state/click_browse_upload_cta",e.ACTIVATION_SUGGESTED_FOLDER_CREATE="activation/suggested_folder/create",e.ACTIVATION_SUGGESTED_FOLDER_DISMISS="activation/suggested_folder/dismiss",e.ACTIVATION_SUGGESTED_FOLDER_TOGGLE="activation/suggested_folder/toggle",e.ACTIVATION_QUICK_ACTIONS_PANEL_VIEW="activation/quick_actions_panel/view",e.ACTIVATION_QUICK_ACTION_CREATE_CF="activation/quick_action/create_cf",e.ACTIVATION_QUICK_ACTION_REDIRECT="activation/quick_action/redirect",e.ACTIVATION_QUICK_ACTION_SEE_SF="activation/quick_action/see_sf",e.ACTIVATION_QUICK_ACTION_DISMISS="activation/quick_action/dismiss",e.ACTIVATION_COLLECTION_FOLDER_VIEW="activation/collection_folder/view",e.ACTIVATION_COLLECTIONS_ACTION_REDIRECT="activation/collections_action/redirect",e.ACTIVATION_COLLECTIONS_ACTION_UPLOAD="activation/collections_action/upload",e.ACTIVATION_COLLECTIONS_ACTION_CREATE="activation/collections_action/create",e.ACTIVATION_COLLECTIONS_ACTION_PAPER="activation/collections_action/paper",e.ACTIVATION_COLLECTIONS_ACTION_OPEN_DESKTOP="activation/collections_action/open_desktop",e.ACTIVATION_COLLECTIONS_ACTION_OPEN_SETTINGS="activation/collections_action/open_settings",e.ACTIVATION_INVITE_LINK_CREATE="activation/invite_link/create",e.ACTIVATION_MOBILE_LINK_SEND="activation/mobile_link/send",e.ACTIVATION_DESKTOP_LINK_DISMISS="activation/desktop_link/dismiss",e.ACTIVATION_DESKTOP_LINK_INIT="activation/desktop_link/init",e.ACTIVATION_DESKTOP_LINK_SEND="activation/desktop_link/send",e.ACTIVATION_SUGGESTED_ITEMS_TO_MOVE_START_MOVE="activation/suggested_items_to_move/start_move",e.ACTIVATION_SUGGESTED_ITEMS_TO_MOVE_END_MOVE="activation/suggested_items_to_move/end_move",e.ACTIVATION_IN_FOLDER_OPEN_DESKTOP="activation/in_folder/open_desktop"})(t.AMPMetrics||(t.AMPMetrics={})),(function(e){e[e.ESSENTIAL_SETUP=1]="ESSENTIAL_SETUP",e[e.TEAM_JOINER_FLOW=9]="TEAM_JOINER_FLOW"})(t.FlowId||(t.FlowId={})),(function(e){e.DEFAULT="",e.WORK="/work",e.ESSENTIAL_SETUP="/team/setup/essential",e.ESSENTIAL_JOIN="/team/join/essential"})(t.ContUrl||(t.ContUrl={}))})),define("metaserver/static/js/folder_subscriptions/data/types",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ActionTypes=t.FolderSubscriptionState=t.RequestFlightStatus=t.Frequencies=t.FOLLOW_MODAL_QUERY_PARAM=void 0,t.FOLLOW_MODAL_QUERY_PARAM="manage_folder_subscription",t.Frequencies={INSTANT:{".tag":"instant"},DAILY:{".tag":"daily"}},(function(e){e.IDLE="idle",e.READY="ready",e.INFLIGHT="inflight",e.ERROR="error"})(t.RequestFlightStatus||(t.RequestFlightStatus={})),(function(e){e.FOLLOWING="FOLLOWING",e.FOLLOWING_PARENT="FOLLOWING_PARENT",e.NOT_FOLLOWING="NOT_FOLLOWING"})(t.FolderSubscriptionState||(t.FolderSubscriptionState={})),(function(e){e.FETCHING_FOLDER_SUBSCRIPTION="FOLDER_SUBSCRIPTION/FETCHING_FOLDER_SUBSCRIPTION",e.OPTIMISTIC_SET_FOLDER_SUBSCRIPTION="FOLDER_SUBSCRIPTION/OPTIMISTIC_SET_FOLDER_SUBSCRIPTION",e.CONFIRM_FOLDER_SUBSCRIPTION="FOLDER_SUBSCRIPTION/CONFIRM_FOLDER_SUBSCRIPTION",e.ERROR_FOLDER_SUBSCRIPTION="FOLDER_SUBSCRIPTION/ERROR_FOLDER_SUBSCRIPTION"})(t.ActionTypes||(t.ActionTypes={}))})),define("metaserver/static/js/folder_subscriptions/data/action_creators",["require","exports","tslib","metaserver/static/js/browse/action_logger","metaserver/static/js/browse/constants","metaserver/static/js/browse/data/selectors","metaserver/static/js/browse/logger_util","metaserver/static/js/files_view/data/selectors/instance_selectors","metaserver/static/js/folder_subscriptions/data/api","metaserver/static/js/folder_subscriptions/data/selectors","metaserver/static/js/folder_subscriptions/data/types","metaserver/static/js/folder_subscriptions/follow/snackbar","metaserver/static/js/clean/web_user_action_events"],(function(e,t,r,s,o,i,a,n,l,c,_,d,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.editFolderSubscription=t.deleteFolderSubscriptionFromEmail=t.deleteFolderSubscription=t.createFolderSubscription=t.logAction=t.FolderSubscriptionOrigin=t.fetchFolderSubscription=void 0,i=r.__importStar(i),a=r.__importStar(a),n=r.__importStar(n),l=r.__importStar(l),c=r.__importStar(c);const p=(e,t,r)=>{e({type:_.ActionTypes.CONFIRM_FOLDER_SUBSCRIPTION,payload:{folderSubscription:r,path:t,timestamp:new Date}})},E=(e,t,r)=>{e({type:_.ActionTypes.ERROR_FOLDER_SUBSCRIPTION,payload:{folderSubscription:r,path:t}})};var S;t.fetchFolderSubscription=e=>(t,s)=>r.__awaiter(void 0,void 0,void 0,(function*(){const r=s(),o=i.user(r).id;c.getRequestState(r,e).status!==_.RequestFlightStatus.INFLIGHT&&(((e,t)=>{e({type:_.ActionTypes.FETCHING_FOLDER_SUBSCRIPTION,payload:{path:t}})})(t,e),l.getFolderSubscription(e,o).then(r=>p(t,e,r),()=>E(t,e)))})),(function(e){e.Email="email",e.SideMenu="side_menu",e.Thumbnail="thumbnail"})(S=t.FolderSubscriptionOrigin||(t.FolderSubscriptionOrigin={}));t.logAction=(e,t,r,l)=>{var _,d;const u=i.user(t).id,p=i.selectedFiles(t),{num_files_selected:E,num_folders_selected:S}=a.countFilesAndFolders(p),f=c.folderSubscription(t,r),m=null===(_=null==f?void 0:f.settings)||void 0===_?void 0:_.activity_types;(0,s.logBrowseAction)({action:e,uid:u,num_files_selected:E,num_folders_selected:S,view_type:n.selectViewType(t,{instanceId:o.BROWSE_FILES_VIEW_ID}),extra:{ns_id:l.ns_id.toString(),origin:l.origin||null,frequency:(null===(d=null==f?void 0:f.settings)||void 0===d?void 0:d.frequency[".tag"])||null,file_add:m?m.file_added.toString():null,file_delete:m?m.file_deleted.toString():null}})};const f=({dispatch:e,getState:r,path:s,newValue:o,apiUpdate:i,onSuccess:a,onError:n})=>{const l=r(),d=c.folderSubscription(l,s);return((e,t,r)=>{e({type:_.ActionTypes.OPTIMISTIC_SET_FOLDER_SUBSCRIPTION,payload:{folderSubscription:r,path:t}})})(e,s,o),i().then(t=>{p(e,s,o),a(t)},()=>{E(e,s,d),e((0,t.fetchFolderSubscription)(s)),n()})};t.createFolderSubscription=(e,r,s)=>(o,a)=>{const n=a(),p=i.user(n).id;if(c.folderSubscriptionState(n,e)===_.FolderSubscriptionState.NOT_FOLLOWING)return f({dispatch:o,getState:a,path:e,newValue:{subscriptionState:_.FolderSubscriptionState.FOLLOWING,followingPath:e,settings:r},apiUpdate:()=>l.createFolderSubscription(e,r,p),onSuccess:()=>{(0,d.showSetOptionsConfirmationSnackbar)(e),(0,t.logAction)(u.WebUserActionLogEvent.FOLLOW_FOLDER,a(),e,s)},onError:()=>(0,d.showSetOptionsErrorSnackbar)(e)})};t.deleteFolderSubscription=(e,r)=>(s,o)=>{const a=o(),n=i.user(a).id;if(c.folderSubscriptionState(a,e)===_.FolderSubscriptionState.FOLLOWING)return f({dispatch:s,getState:o,path:e,newValue:{subscriptionState:_.FolderSubscriptionState.NOT_FOLLOWING},apiUpdate:()=>l.deleteFolderSubscription(e,n),onSuccess:()=>{(0,d.showUnfollowConfirmationSnackbar)(e),(0,t.logAction)(u.WebUserActionLogEvent.UNFOLLOW_FOLDER,o(),e,r)},onError:()=>(0,d.showUnfollowErrorSnackbar)(e)})};t.deleteFolderSubscriptionFromEmail=(e,r)=>(s,o)=>{const a=o(),n=i.user(a).id;return l.deleteFolderSubscription(e,n).then(()=>{(0,d.showUnfollowConfirmationSnackbar)(e),(0,t.logAction)(u.WebUserActionLogEvent.UNFOLLOW_FOLDER,a,e,{ns_id:r,origin:S.Email})},()=>(0,d.showUnfollowErrorSnackbar)(e))};t.editFolderSubscription=(e,r,s)=>(o,a)=>{const n=a(),p=i.user(n).id;if(c.folderSubscriptionState(n,e)===_.FolderSubscriptionState.FOLLOWING)return f({dispatch:o,getState:a,path:e,newValue:{subscriptionState:_.FolderSubscriptionState.FOLLOWING,followingPath:e,settings:r},apiUpdate:()=>l.editFolderSubscription(e,r,p),onSuccess:()=>{(0,d.showSetOptionsConfirmationSnackbar)(e),(0,t.logAction)(u.WebUserActionLogEvent.EDIT_FOLDER_FOLLOW_SETTINGS,a(),e,s)},onError:()=>(0,d.showSetOptionsErrorSnackbar)(e)})}})),define("metaserver/static/js/folder_subscriptions/data/api",["require","exports","tslib","metaserver/static/js/api_v2/user_client","metaserver/static/js/folder_subscriptions/data/types"],(function(e,t,r,s,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.editFolderSubscription=t.deleteFolderSubscription=t.createFolderSubscription=t.getFolderSubscription=void 0;t.getFolderSubscription=function(e,t){return r.__awaiter(this,void 0,void 0,(function*(){return(new s.UserApiV2Client).ns("awareness_subscriptions").rpc("folder_subscriptions/get",{identifier:e},{subjectUserId:t}).then((r=e,({subscription:e})=>{if(!e)return{subscriptionState:o.FolderSubscriptionState.NOT_FOLLOWING};const t=e.fq_path;return t!==r?{subscriptionState:o.FolderSubscriptionState.FOLLOWING_PARENT,followingPath:t}:{subscriptionState:o.FolderSubscriptionState.FOLLOWING,followingPath:t,settings:e.settings}}));var r}))},t.createFolderSubscription=function(e,t,o){return r.__awaiter(this,void 0,void 0,(function*(){return(new s.UserApiV2Client).ns("awareness_subscriptions").rpc("folder_subscriptions/create",{identifier:e,settings:t},{subjectUserId:o})}))},t.deleteFolderSubscription=function(e,t){return r.__awaiter(this,void 0,void 0,(function*(){return(new s.UserApiV2Client).ns("awareness_subscriptions").rpc("folder_subscriptions/delete",{identifier:e},{subjectUserId:t})}))},t.editFolderSubscription=function(e,t,o){return r.__awaiter(this,void 0,void 0,(function*(){return(new s.UserApiV2Client).ns("awareness_subscriptions").rpc("folder_subscriptions/edit",{identifier:e,settings:t},{subjectUserId:o})}))}})),define("metaserver/static/js/folder_subscriptions/data/reducer",["require","exports","tslib","immutable","metaserver/static/js/folder_subscriptions/data/types"],(function(e,t,r,s,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.folderSubscriptionsReducer=t.defaultFolderSubscriptionsState=void 0,s=r.__importStar(s),t.defaultFolderSubscriptionsState={requests:s.Map(),folderSubscriptions:s.Map()},t.folderSubscriptionsReducer=function(e=t.defaultFolderSubscriptionsState,r){switch(r.type){case o.ActionTypes.OPTIMISTIC_SET_FOLDER_SUBSCRIPTION:return(function(e,t){const{path:r,folderSubscription:s}=t.payload;return Object.assign(Object.assign({},e),{requests:e.requests.set(r,{status:o.RequestFlightStatus.INFLIGHT}),folderSubscriptions:e.folderSubscriptions.set(r,s)})})(e,r);case o.ActionTypes.FETCHING_FOLDER_SUBSCRIPTION:return(function(e,t){const{path:r}=t.payload;return Object.assign(Object.assign({},e),{requests:e.requests.set(r,{status:o.RequestFlightStatus.INFLIGHT})})})(e,r);case o.ActionTypes.CONFIRM_FOLDER_SUBSCRIPTION:return(function(e,t){const{path:r,folderSubscription:s,timestamp:i}=t.payload;return Object.assign(Object.assign({},e),{requests:e.requests.set(r,{status:o.RequestFlightStatus.READY,lastUpdated:i}),folderSubscriptions:e.folderSubscriptions.set(r,s)})})(e,r);case o.ActionTypes.ERROR_FOLDER_SUBSCRIPTION:return(function(e,t){const{path:r,folderSubscription:s}=t.payload;return Object.assign(Object.assign({},e),{requests:e.requests.set(r,{status:o.RequestFlightStatus.ERROR}),folderSubscriptions:s?e.folderSubscriptions.set(r,s):e.folderSubscriptions})})(e,r)}return e}})),define("metaserver/static/js/folder_subscriptions/data/selectors",["require","exports","metaserver/static/js/redux/selectors","metaserver/static/js/redux/namespaces","metaserver/static/js/folder_subscriptions/data/types","metaserver/static/js/folder_subscriptions/data/reducer"],(function(e,t,r,s,o,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.folderSubscriptions=t.folderSubscription=t.folderSubscriptionState=t.getRequestState=t.getFolderSubscriptionsState=void 0;t.getFolderSubscriptionsState=e=>(0,r.getStateAtNamespace)(e,s.FOLDER_SUBSCRIPTIONS_NAMESPACE_KEY)||i.defaultFolderSubscriptionsState;t.getRequestState=(e,r)=>(0,t.getFolderSubscriptionsState)(e).requests.get(r,{status:o.RequestFlightStatus.IDLE});t.folderSubscriptionState=(e,r)=>{var s;return null===(s=(0,t.folderSubscription)(e,r))||void 0===s?void 0:s.subscriptionState};t.folderSubscription=(e,r)=>(0,t.folderSubscriptions)(e).get(r);t.folderSubscriptions=e=>(0,t.getFolderSubscriptionsState)(e).folderSubscriptions})),define("metaserver/static/js/folder_subscriptions/data/store",["require","exports","metaserver/static/js/folder_subscriptions/data/reducer","metaserver/static/js/redux/store","metaserver/static/js/redux/namespaces"],(function(e,t,r,s,o){"use strict";let i;Object.defineProperty(t,"__esModule",{value:!0}),t.getStoreForFolderSubscriptions=void 0;t.getStoreForFolderSubscriptions=()=>(i||(i=(0,s.getStoreAndRegisterReducers)({[o.FOLDER_SUBSCRIPTIONS_NAMESPACE_KEY]:r.folderSubscriptionsReducer})),i)})),define("metaserver/static/js/folder_subscriptions/follow/snackbar",["require","exports","tslib","react","js/filepath/filepath","metaserver/static/js/clean/ui/snackbar","metaserver/static/js/core/i18n"],(function(e,t,r,s,o,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.showFollowFailedSnackbar=t.showUnfollowErrorSnackbar=t.showUnfollowConfirmationSnackbar=t.showSetOptionsErrorSnackbar=t.showSetOptionsConfirmationSnackbar=t.showFolderSubscriptionSnackbar=void 0,s=r.__importDefault(s);const n=a.intl.formatMessage({id:"JBINyn",defaultMessage:"Close"}),l=a.intl.formatMessage({id:"Wzr+Eu",defaultMessage:"Unfollow"});function c({callToActionFn:e,isSuccess:t,message:r}){const o=t?"complete":"fail",a=t&&e?l:void 0,c=t?e:void 0,_=t&&e?void 0:n,d=s.default.createElement(i.Snackbar,{title:r,variant:o,actionButtonText:a,onActionClick:c,closeButtonText:_,timeoutDelayMs:5e3,id:"browse-action"});i.Snackbar.show(d)}t.showFolderSubscriptionSnackbar=c,t.showSetOptionsConfirmationSnackbar=function(e){c({isSuccess:!0,message:a.intl.formatMessage({id:"74emIA",defaultMessage:'Notification options for "{folderName}" have been set'},{folderName:(0,o.filename)(e)})})},t.showSetOptionsErrorSnackbar=function(e){c({isSuccess:!1,message:a.intl.formatMessage({id:"fwZe/f",defaultMessage:'Couldn\'t set options for "{folderName}"'},{folderName:(0,o.filename)(e)})})},t.showUnfollowConfirmationSnackbar=function(e){c({isSuccess:!0,message:a.intl.formatMessage({id:"nQncys",defaultMessage:'You’ll no longer get notifications about "{folderName}"'},{folderName:(0,o.filename)(e)})})},t.showUnfollowErrorSnackbar=function(e){c({isSuccess:!1,message:a.intl.formatMessage({id:"/QEApB",defaultMessage:'Unable to unfollow "{folderName}"'},{folderName:(0,o.filename)(e)})})},t.showFollowFailedSnackbar=function(e){c({isSuccess:!1,message:a.intl.formatMessage({id:"0G1Llb",defaultMessage:'Unable to follow "{folderName}"'},{folderName:e})})}})),define("metaserver/static/js/browse/api",["require","exports","tslib","lodash","metaserver/static/js/deprecated_ajax/ajax","metaserver/static/js/api_v2/user_client","js/filepath/filepath","metaserver/static/js/browse/models","metaserver/static/js/core/assert","metaserver/static/js/core/html","metaserver/static/js/core/i18n","metaserver/static/js/core/notify","metaserver/static/js/core/uri","metaserver/static/js/sharing/api/client","metaserver/static/js/sync_everything/constants"],(function(e,t,r,s,o,i,a,n,l,c,_,d,u,p,E){"use strict";function S(e){try{return JSON.parse(e)}catch(e){if(!(e instanceof SyntaxError))throw e}return null}function f(e){if(void 0===e)return{};const t={};for(const r of e)void 0!==r.ns_id&&void 0!==r.mount_point&&(t[r.ns_id]=r.mount_point);return t}Object.defineProperty(t,"__esModule",{value:!0}),t.fetchChronicleEventsApi=t.getFolderMemberCounts=t.fetchUnmountedBackupFolderSizes=t.fetchSameNamespaceFolderSizes=t.fetchSharedFolderSizes=t.getChangesForDirectory=t.createCloudDoc=t.rollbackChangeSets=t.restoreFiles=t.moveFiles=t.isRewindButtonEnabled=t.copyFiles=t.loadPath2Continue=t.loadPath2=void 0,s=r.__importStar(s),o=r.__importStar(o),a=r.__importStar(a),t.loadPath2=function(e){var t,s,o,a;return r.__awaiter(this,void 0,void 0,(function*(){const{userId:r,rootNsId:c,path:_,sortType:d,sortIsAscending:u,includeDeleted:p}=e,E=new i.UserApiV2Client,S=yield E.ns("files").rpc("browse",{root_ns_id:c,fq_path:_,include_deleted:p,sort_type:d,sort_is_ascending:u,sort_folders_first:!0,include_xattrs:!0,include_folder_overview:!0},{subjectUserId:r});return(0,l.assert)(void 0!==S.context,"context is undefined"),(0,l.assert)(void 0!==S.paginated_file_info,"paginated_file_info is undefined"),(0,l.assert)(void 0!==S.total_count,"total_count is undefined"),{folderOverview:null!==(t=S.folder_overview)&&void 0!==t?t:null,mountPoints:f(S.context.ns_id_infos),context:n.BrowseContext.fromApiV2Object(S.context),items:S.paginated_file_info.map(e=>e.file_info),hasMore:null!==(s=S.has_more)&&void 0!==s&&s,nextRequestVoucher:null!==(o=S.next_request_voucher)&&void 0!==o?o:null,paginatedTotalNumFiles:S.total_count,currentFolderInfo:null===(a=S.folder_info)||void 0===a?void 0:a.file_info}}))},t.loadPath2Continue=function(e,t){return(new i.UserApiV2Client).ns("files").rpc("browse_continue",{cursor:e},{subjectUserId:t})},t.copyFiles=function(e){const{files:t,newPath:r,userId:s,onSuccess:i,checkFSWs:a}=e,l=t.map(e=>e.fq_path);return l.includes(r)?(d.Notify.error(_.intl.formatMessage({id:"wWiDtY",defaultMessage:"You can’t copy a folder into itself."})),!1):(o.WebProgressRequest({url:"/cmd/copy",data:{files:l,to_path:r,fsw_request:a?"check":void 0},dataType:"text",subject_user:s,progress_text:_.intl.formatMessage({id:"AZPIG5",defaultMessage:"Copying files..."}),success(e,t){try{const e=JSON.parse(t),s=e.new_browse_files?e.new_browse_files.map(n.File.fromServerObject):[];i({newFiles:s,destinationPath:r,changesets:e.changesets,failureDetails:e.failure_details})}catch(e){}}}),!0)},t.isRewindButtonEnabled=function(e,t){return r.__awaiter(this,void 0,void 0,(function*(){try{return"/"===e&&(e=""),(new i.UserApiV2Client).ns("chronicle").rpc("can_rewind",{path:e,version:2},{subjectUserId:t})}catch(e){return{can_rewind:!1}}}))},t.moveFiles=function(e){const{path:t,files:r,newPath:s,userId:i,onSuccess:l,allowOwnershipTransfer:u,checkFSWs:p}=e;if(void 0!==t&&a.paths_are_equal(t,s))return d.Notify.error(_.intl.formatMessage({id:"V6/bVk",defaultMessage:"Those files already exist in that folder."})),!1;const E=r.map(e=>e.fq_path);return E.includes(s)?(d.Notify.error(_.intl.formatMessage({id:"blAaiJ",defaultMessage:"You can’t move a folder into itself."})),!1):(o.WebProgressRequest({url:"/cmd/move",data:{files:E,to_path:s,allow_ownership_transfer:u,fsw_request:p?"check":void 0},dataType:"text",subject_user:i,progress_text:_.intl.formatMessage({id:"FdTkAn",defaultMessage:"Moving files..."}),skipNotifyError:!u,success(e,r){try{const e=JSON.parse(r),o=e.new_browse_files?e.new_browse_files.map(n.File.fromServerObject):[];l({path:t,destinationPath:s,newFiles:o,changesets:e.changesets,failureDetails:e.failure_details})}catch(e){}},error:(t,r,s)=>{d.Notify.error(new c.HTML(s.message)),e.onError&&e.onError(s.message)}}),!0)},t.restoreFiles=function(e){const{files:t,userId:r,onSuccess:s,isSearchMode:i,rootNsId:a}=e;o.WebProgressRequest({url:"/cmd/restore",data:{files:t.map(e=>e.fq_path),source:i?"search":"browse",backup_ns_id:(0,E.isBackupBrowse)()&&a?a:void 0},dataType:"text",subject_user:r,progress_text:_.intl.formatMessage({id:"kBkLSN",defaultMessage:"Restoring…"}),success(){s()}})},t.rollbackChangeSets=function(e){const{userId:t,changesets:r=null,progressText:s,onSuccess:i}=e;o.WebProgressRequest({url:"/cmd/rollback",data:{ns_to_cs:JSON.stringify(r)},dataType:"text",subject_user:t,progress_text:s,success(){i()}})},t.createCloudDoc=function(e){const{pathName:t,title:r,documentType:s,userId:i,onSuccess:a,onError:l,checkFSWs:c,actionSource:_}=e,d=`${t}/${r}.${s}`.replace("//","/");o.WebRequest({url:new u.URI({path:"/cmd/create_cloud_doc"}).toString(),subject_user:i,data:{to_path:d,title:r,fsw_request:c?"check":void 0,action_source:_},dataType:"text",success(e,t){const r=S(t);if(r){const e=r.new_browse_files?n.File.fromServerObject(r.new_browse_files[0]):null;a({changesets:null,createdFile:e,failureDetails:r.failure_details})}},error(e,t,r){l(r.message)},skipNotifyError:!0})},t.getChangesForDirectory=function(e){const{path:t,userId:r,namespaceToJournalIdMap:i,onSuccess:a,onComplete:n,includeDeletedFiles:l,limitScope:c,rootNamespaceIdentifier:_}=e,d={fq_dir:"/"===t?"":t,ns_map:s.map(i,(e,t)=>`${t}_${e}`).join(","),show_deleted:!!l,limit_scope:c};null!=_&&(d.ns_id=_);const u=new AbortController;return o.SilentBackgroundRequest({url:"/update/list_dir",subject_user:r,data:d,dataType:"text",signal:u.signal,success(e,t){const r=S(t);r&&a(r)},complete:n}),u},t.fetchSharedFolderSizes=function(e,t){return(new i.UserApiV2Client).ns("folders").rpc("get_shared_subfolder_sizes",t,{subjectUserId:e})},t.fetchSameNamespaceFolderSizes=function(e,t){return(new i.UserApiV2Client).ns("folders").rpc("get_subfolder_sizes_in_same_namespace",t,{subjectUserId:e})},t.fetchUnmountedBackupFolderSizes=function(e,t,r){return(new i.UserApiV2Client).ns("folders_info").rpc("get_folder_sizes",{paths:[t],allow_unmounted_ns:!0},{subjectUserId:e}).then(({folder_sizes:e})=>({sizes_dict:e.map(({size:e})=>({fq_path:r.fq_path,size:e})),queue:[]}))},t.getFolderMemberCounts=function(e,t){return r.__awaiter(this,void 0,void 0,(function*(){try{const r=new p.FolderShareApiClient({userId:t,client:new i.UserApiV2Client}),s=yield r.getMemberCounts({contentId:e});return s?s.total_unique_users:0}catch(e){return 0}}))},t.fetchChronicleEventsApi=function(e,t,s,o,a,n,l){return r.__awaiter(this,void 0,void 0,(function*(){const r={path:t,version:2,direction:o,timestamp:s,filter:{only_rewindable:a,op_type_filters:n},ns_id:l};return yield(new i.UserApiV2Client).ns("chronicle").rpc("list_events",r,{subjectUserId:e})}))}})),define("metaserver/static/js/file_uploader/action_logger",["require","exports","tslib","js/filepath/filepath","metaserver/static/js/file_uploader/constants","metaserver/static/js/file_uploader/types","metaserver/static/js/file_uploader/web_upload_action_logger","metaserver/static/js/clean/web_user_action_logger","metaserver/static/js/file_uploader/web_upload_action_events","metaserver/static/js/clean/web_user_action_events","metaserver/static/js/modules/constants/global_file_upload","metaserver/static/js/modules/constants/web_experience_constants","metaserver/static/js/core/browser","metaserver/static/js/file_uploader/utils","metaserver/static/js/core/exception","metaserver/static/js/pap/analytics_client","metaserver/static/js/dropbox/proto/pap_events/manual_upload/upload_file","metaserver/static/js/pap/util"],(function(e,t,r,s,o,i,a,n,l,c,_,d,u,p,E,S,f,m){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setMethodForFileUpload=t.logUploadAction=void 0,s=r.__importStar(s),u=r.__importStar(u);const O=f.pap_events.manual_upload.Upload_File;function T(){const e=u.get_pathname();return"/h"===e?"HOME":"/recents"===e?"RECENTS":"/starred"===e?"STARRED":e.startsWith("/share")?"SHARED":"/requests"===e?"FILE_REQUESTS":"/deleted_files"===e?"DELETED_FILES":"BROWSE"}function R(e){return e&&!!e.uploadId}function h(e){return e&&!!e.batchId}function I(e){var t;return null!==(t=(0,m.getEnumValueForString)(`${e.toUpperCase()}_FILE_TYPE`,O.FileType))&&void 0!==t?t:O.FileType.UNKNOWN_FILE_TYPE}function A(e){var t;return null!==(t=(0,m.getEnumValueForString)(e,f.pap_events.EventState))&&void 0!==t?t:f.pap_events.EventState.UNKNOWN_EVENT_STATE}t.logUploadAction=function({action:e,upload:t,chooser_type:r,upload_method:i,num_files:f,num_dirs:m,errorType:g,extra:v,batchId:b,user:L,uploadPath:C,useUploadKit:P,source:F,dropzoneArea:U}){let w={num_files:f,num_dirs:m,chooser_type:r,upload_method:i,extra:Object.assign({origin:T(),use_upload_kit:P?"true":"false",uploader:(0,p.shouldUseHybridUploader)()?"hybrid_uploader":"legacy_uploader",upload_precheck_optimizations:_.UPLOAD_PRECHECK_OPTIMIZATIONS?"true":"false",use_upload_prevent_sleep:_.UPLOAD_PREVENT_SLEEP?"true":"false",use_persistent_upload:_.PERSISTENT_UPLOAD?"true":"false",use_autoretry_optimization:_.UPLOAD_AUTORETRY_OPTIMIZATION?"true":"false",default_drag_and_drop:d.DEFAULT_DRAG_AND_DROP,dropzone_area:U||""},F&&{source:F})};if(R(t)){const r=t,i=e===l.WebUploadActionEvent.UPLOAD_FAILURE?r.errorType===o.UploadErrorType.GENERIC&&g?g:r.errorType:void 0;w=Object.assign(Object.assign({},w),{upload_id:r.uploadId,file_size:r.size,file_extension:s.file_extension(r.name),failure_reason:i,batch_id:r.batchId,upload_destination:r.dest,current_path:u.get_pathname(),file_name:r.name,upload_method:N(r.uploadId)})}else if(h(t)){const e=t;w=Object.assign(Object.assign({},w),{file_size:e.size,file_extension:s.file_extension(e.name),batch_id:e.batchId})}if(!w.chooser_type&&t&&"chooserType"in t&&t.chooserType&&(w.chooser_type=t.chooserType),b&&(w.batch_id=b),C&&(w.batch_dest_folder_level=(0,p.getFolderLevel)(C),L&&(w.member_folder=(0,p.isInMemberFolder)(L,C))),v&&(w.extra=Object.assign(Object.assign({},w.extra),v)),L){let r;const o=v&&v.targetSurface;if((function(e){return e===c.WebUserActionLogEvent.UPLOAD_BUTTON_CLICK||e===c.WebUserActionLogEvent.ADD_MORE_FILES_CLICK||e===c.WebUserActionLogEvent.VIEW_DETAILS_CLICK||e===c.WebUserActionLogEvent.CLOSE_MODAL_CLICK||e===c.WebUserActionLogEvent.UPLOAD_FILES_CLICK||e===c.WebUserActionLogEvent.UPLOAD_FOLDER_CLICK||e===c.WebUserActionLogEvent.CANCEL_UPLOAD_CLICK})(e)){if(e===c.WebUserActionLogEvent.CANCEL_UPLOAD_CLICK){const e=A("CANCELED");if(R(t)||h(t)){const i=t,a=I(s.file_extension(i.name));r={eventState:e,actionSurface:o,cancelTime:Math.round(Date.now()/1e3),fileSize:i.size,fileType:a}}else r={eventState:e,actionSurface:o,cancelTime:Math.round(Date.now()/1e3)};(0,S.logEvent)(O.create(r))}return void n.WebUserActionLog.log(L.id,e,w)}if(e=e,w.client_timestamp=Math.round(Date.now()/1e3),a.WebUploadActionLog.log(L.id,e,w),R(t)||h(t)){const i=t,a=I(s.file_extension(i.name));if(e===l.WebUploadActionEvent.UPLOAD_ATTEMPT&&(r={eventState:A("START"),fileType:a,startTime:w.client_timestamp,uploadMethod:N(i.uploadId),actionSurface:o,fileSize:i.size},(0,S.logEvent)(O.create(r))),e===l.WebUploadActionEvent.UPLOAD_FAILURE){const e=v&&v.errorMessage,t=v&&v.fswData,s=v&&v.errorCode;r={eventState:A("FAILED"),fileType:a,fileSize:i.size,errorMessage:e,actionSurface:o,fileSystemWarning:t,errorCode:Number(s),uploadMethod:N(i.uploadId)},(0,S.logEvent)(O.create(r))}if(e===l.WebUploadActionEvent.UPLOAD_SUCCESS){const e={eventState:A("SUCCESS"),fileType:a,fileSize:i.size,actionSurface:o,uploadMethod:N(i.uploadId)};(0,S.logEvent)(O.create(e))}}}else(0,E.reportStack)("Trying to log web upload event but user is null",{severity:E.SEVERITY.NONCRITICAL})};const g={},N=e=>e&&g[e]||i.UploadMethod.CHOOSER;t.setMethodForFileUpload=(e,t)=>{g[e]=t}})),define("metaserver/static/js/file_uploader/constants",["require","exports","tslib","immutable"],(function(e,t,r,s){"use strict";var o,i;Object.defineProperty(t,"__esModule",{value:!0}),t.ValidChunkSizeStrings=t.FileUpload=t.OverQuotaStatusType=t.isUploadTypeError=t.UploadErrorType=t.TeamAccessLevel=t.FileStatusType=t.UploaderActionType=t.MAX_FILE_SIZE=t.ChooserType=void 0,s=r.__importStar(s),(function(e){e.FILE="file",e.FOLDER="folder",e.FILE_FOLDER="file_folder",e.UNKNOWN="unknown"})(t.ChooserType||(t.ChooserType={})),t.MAX_FILE_SIZE=524288e5,(function(e){e.ALL_UPLOADS_COMPLETE="ALL_UPLOADS_COMPLETE",e.SET_PATH="UPLOADER_SET_PATH",e.SET_FOLDER_NS_ID="UPLOADER_SET_FOLDER_NS_ID",e.SET_USER="UPLOADER_SET_USER",e.SET_NUM_DRAGGING_FILES="SET_NUM_DRAGGING_FILES",e.READY_UPLOADS="READY_UPLOADS",e.QUEUE_UPLOADS="QUEUE_UPLOADS",e.START_UPLOAD="START_UPLOAD",e.COMPLETE_UPLOAD="COMPLETE_UPLOAD",e.CANCEL_UPLOADS="CANCEL_UPLOADS",e.SET_CURRENT_UPLOAD_PROGRESS="SET_CURRENT_UPLOAD_PROGRESS",e.UPLOAD_ERROR="UPLOAD_ERROR",e.SET_IS_UPLOAD_MODAL_OPEN="SET_IS_UPLOAD_MODAL_OPEN",e.SET_INLINE_STATUS_SHOULD_BE_DISMISSED="SET_INLINE_STATUS_SHOULD_BE_DISMISSED",e.ADD_NEW_FAILED_FILE="ADD_NEW_FAILED_FILE",e.CONFIRM_FSW="CONFIRM_FSW",e.ADD_FILES_TO_PLU="ADD_FILES_TO_PLU",e.ADD_DIRECTORIES_TO_PLU="ADD_DIRECTORIES_TO_PLU",e.REMOVE_FILES="REMOVE_FILES",e.SET_HAS_OVERQUOTA_ERROR="SET_HAS_OVERQUOTA_ERROR",e.SET_IS_PERMISSIONS_AT_UPLOAD_MODAL_OPEN="SET_IS_PERMISSIONS_AT_UPLOAD_MODAL_OPEN",e.ADD_TEAM_ACCESS_LEVEL="ADD_TEAM_ACCESS_LEVEL",e.RESET_TEAM_ACCESS_LEVELS="RESET_TEAM_ACCESS_LEVELS",e.SET_UPLOAD_PROGRESS="SET_UPLOAD_PROGRESS",e.SET_FILE_UPLOAD_TIME_LEFT="SET_FILE_UPLOAD_TIME_LEFT",e.SET_DROPZONE_ACTIVE="SET_DROPZONE_ACTIVE"})(t.UploaderActionType||(t.UploaderActionType={})),(function(e){e.SET_PERMISSIONS="SET_PERMISSIONS",e.PENDING="PENDING",e.UPLOADING="UPLOADING",e.COMPLETE="COMPLETE",e.CANCELLED="CANCELLED",e.FAILED="FAILED"})(o=t.FileStatusType||(t.FileStatusType={})),(function(e){e.WRITER="WRITER",e.READER="READER",e.NO_ACCESS="NO_ACCESS",e.INHERIT="INHERIT"})(t.TeamAccessLevel||(t.TeamAccessLevel={})),(function(e){e.FILE_SIZE_ERROR="FILE_SIZE_ERROR",e.HTTP_ERROR="HTTP_ERROR",e.CONNECTION_ERROR="CONNECTION_ERROR",e.OVER_QUOTA_ERROR="OVER_QUOTA_ERROR",e.LOCKED_TEAM_ERROR="LOCKED_TEAM_ERROR",e.IGNORED="IGNORED",e.INVALID_EXTENSION="INVALID_EXTENSION",e.EMPTY_OR_FOLDER="EMPTY_OR_FOLDER",e.FOLDER_SAFARI="FOLDER_SAFARI",e.PACKAGE_FILE="PACKAGE_FILE",e.GENERIC="GENERIC",e.BLOCKS_MISSING_ERROR="BLOCKS_MISSING_ERROR",e.COMMIT_HTTP_ERROR="COMMIT_HTTP_ERROR",e.COMMIT_INVALID_ARGS="COMMIT_INVALID_ARGS",e.UPLOAD_BLOCK_ERROR="UPLOAD_BLOCK_ERROR",e.CHUNKS_NOT_ENABLED_ERROR="CHUNKS_NOT_ENABLED_ERROR",e.SERVER_RESPONSE_ERROR="SERVER_RESPONSE_ERROR",e.SERVER_TOKEN_EMPTY_ERROR="SERVER_TOKEN_EMPTY_ERROR",e.SERVER_TOKENS_MISSING_ERROR="SERVER_TOKENS_MISSING_ERROR",e.SERVER_HASH_RESPONSE_ERROR="SERVER_HASH_RESPONSE_ERROR",e.BLOCK_RUNTIME_ID_MISSING_ERROR="BLOCK_RUNTIME_ID_MISSING",e.CLIENT_HASH_EMPTY_ERROR="CLIENT_HASH_EMPTY_ERROR",e.SERVER_HASH_EMPTY_ERROR="SERVER_HASH_EMPTY_ERROR",e.HASHES_NOT_EQUAL_ERROR="HASHES_NOT_EQUAL_ERROR",e.BLOCK_INDEX_ERROR="BLOCK_INDEX_ERROR",e.BLOCK_EMPTY_ERROR="BLOCK_EMPTY_ERROR",e.BLOB_EMPTY_ERROR="BLOB_EMPTY_ERROR",e.BLOB_MISSING_ERROR="BLOB_MISSING_ERROR",e.CLIENT_HASH_DIGEST_ERROR="CLIENT_HASH_DIGEST_ERROR",e.FILE_READER_NULL_RESULT_ERROR="FILE_READER_NULL_RESULT_ERROR",e.COMMIT_READINESS_ERROR="COMMIT_READINESS_ERROR",e.UPLOAD_PRECHECK_ERROR="UPLOAD_PRECHECK_ERROR",e.UPLOAD_PRECHECK_INVALID_CHAR_ERROR="UPLOAD_PRECHECK_INVALID_CHAR_ERROR",e.PERMISSIONS_AT_UPLOAD_ERROR="PERMISSIONS_AT_UPLOAD_ERROR",e.START_UPLOAD_SESSION_ERROR="START_UPLOAD_SESSION_ERROR",e.APPEND_BLOCK_MISSING_PARAMS="APPEND_BLOCK_MISSING_PARAMS"})(i=t.UploadErrorType||(t.UploadErrorType={})),t.isUploadTypeError=function(e){return-1!==Object.values(i).indexOf(e)},(function(e){e.NONE="NONE",e.BASIC_OVER_QUOTA="BASIC_OVER_QUOTA",e.BASIC_NEAR_QUOTA="BASIC_NEAR_QUOTA",e.LIMITED_TEAM_USER_OVER_QUOTA="LIMITED_TEAM_USER_OVER_QUOTA",e.LIMITED_TEAM_TSD_OVER_QUOTA="LIMITED_TEAM_TSD_OVER_QUOTA",e.LOCKED_TEAM_USER_OVER_QUOTA="LOCKED_TEAM_USER_OVER_QUOTA"})(t.OverQuotaStatusType||(t.OverQuotaStatusType={}));class a extends(s.Record({uploadId:void 0,dest:"",ns_id:null,ns_path:null,userId:null,name:"",size:0,percentUploaded:0,status:o.SET_PERMISSIONS,errorType:i.GENERIC,errorMessage:"",batchId:void 0,chooserType:void 0,numSecondsLeft:0},"FileUpload")){}t.FileUpload=a,(function(e){e[e["4mb"]=0]="4mb",e[e["8mb"]=1]="8mb"})(t.ValidChunkSizeStrings||(t.ValidChunkSizeStrings={}))})),define("metaserver/static/js/file_uploader/utils",["require","exports","tslib","react","dig-components/tooltips","metaserver/static/js/modules/constants/global_file_upload","metaserver/static/js/clean/base64","js/filepath/filepath","metaserver/static/js/clean/ui/async_file_modal_controller","metaserver/static/js/file_uploader/constants","metaserver/static/js/upload_kit/lib/types","metaserver/static/js/core/browser","metaserver/static/js/core/i18n","metaserver/static/js/clean/ui/snackbar","metaserver/static/js/clean/viewer","metaserver/static/js/clean/em_string","metaserver/static/js/user_survey/user_survey","typescript/libraries/file-viewer/src/file_extension/extension_constants"],(function(e,t,r,s,o,i,a,n,l,c,_,d,u,p,E,S,f,m){"use strict";function O(){let e="";for(let t=0;t<16;++t)e+=String.fromCharCode(Math.floor(256*Math.random()));let t=a.encode(e);return t=t.replace(/\+/g,"-"),t=t.replace(/\//g,"_"),t=t.replace(/\=*$/,""),t}Object.defineProperty(t,"__esModule",{value:!0}),t.getFilePathForUploadkit=t.shouldUseSessionUploadForFile=t.shouldUseHybridUploader=t.uploadSuccessEmitEventIsOn=t.uploadFailureEmitEventIsOn=t.precheckOptimizationIsOn=t.logMediaFileToUserSurvey=t.makeUploadSnippet=t.showCannotUploadLinksSnackbar=t.showCannotUploadEmptyFolderSnackbar=t.newPromiseWithRetries=t.legacyPromiseWithRetries=t.folderModalTitle=t.getDestinationDir=t.showInvalidFileWarning=t.getFolderLevel=t.getFileUploadsWithStatus=t.isUploadInTmf=t.uploadContainsFolder=t.isMultifolderUpload=t.getRootDests=t.getRootDest=t.getFSWMetadataToLog=t.PERMISSION_FSW_IDS=t.getUploadLocationMetadataToLog=t.isInMemberFolder=t.getOQmodalOQALocationCode=t.getNsId=t.calculateSizeOfUploads=t.generateBatchId=t.generateUploadId=void 0,s=r.__importDefault(s),a=r.__importStar(a),n=r.__importStar(n),l=r.__importStar(l),d=r.__importStar(d),t.generateUploadId=function(){return O()},t.generateBatchId=function(){return"batch-"+O()},t.calculateSizeOfUploads=function(e,t){let r=0;return e.forEach(e=>{-1!==t.indexOf(e.status)&&(r+=e.size)}),r},t.getNsId=function(e,t,r){let s=t,o=0;return e.forEach((e,t)=>{let i=0;const a=e.split("/"),n=r.split("/");for(;i<a.length&&i<n.length&&a[i]===n[i];)i++;i===a.length&&i>1&&i>o&&(o=i,s=Number(t))}),s};function T(e,t){return!e.is_team||!e.is_cdm_member||""!==n.normalize(t)&&(n.paths_are_equal(e.cdm_tmf_path,t)||n.inSubDirectory(e.cdm_tmf_path,t))}function R(e,t){let r=e.dest;const s=I(t);for(;I(r)-1>s;)r=n.parent_dir(r);return r}function h(e,t){const r=e.toArray().map(e=>R(e,t));return Array.from(new Set(r))}function I(e){return(n.normalize(e).match(/\//g)||[]).length+1}function A(e){switch(e){case _.UploadErrorType.EmptyFile:return u.intl.formatMessage({id:"KZETkM",defaultMessage:"Empty files cannot be uploaded."});case _.UploadErrorType.OverMaxFileSize:return u.intl.formatMessage({id:"Hg3ZgC",defaultMessage:"File is too large to be uploaded."});default:return u.intl.formatMessage({id:"WQDOGQ",defaultMessage:"This file is not supported by Dropbox and cannot be uploaded."})}}t.getOQmodalOQALocationCode=e=>"/h"===(e||d.get_uri().path)?"ho":"fb",t.isInMemberFolder=T,t.getUploadLocationMetadataToLog=function(e,t){return{root_folder:""===n.normalize(t),member_folder:T(e,t),folder_level:n.normalize(t).split("/").length}},t.PERMISSION_FSW_IDS=["action_commit_to_tsd_root","action_missing_parent"],t.getFSWMetadataToLog=function(e){return{has_permissions:e.includes("action_commit_to_tsd_root"),has_permissions_nonroot:e.includes("action_missing_parent"),has_other:e.some(e=>!t.PERMISSION_FSW_IDS.includes(e))}},t.getRootDest=R,t.getRootDests=h,t.isMultifolderUpload=function(e,t){const r=h(e.filter(e=>c.FileStatusType.SET_PERMISSIONS===e.status),t);return!r.every(e=>e===r[0])},t.uploadContainsFolder=function(e,t){const r=e.filter(e=>c.FileStatusType.SET_PERMISSIONS===e.status),s=I(t);return h(r,t).some(e=>I(e)>s)},t.isUploadInTmf=function(e,t){if(!t.cdm_tmf_path)return!1;const r=e.filter(e=>c.FileStatusType.SET_PERMISSIONS===e.status),s=n.normalize(t.cdm_tmf_path);return r.some(e=>e.dest===s||n.inSubDirectory(s,e.dest))},t.getFileUploadsWithStatus=function(e,t){return e.valueSeq().toArray().filter(e=>t.includes(e.status))},t.getFolderLevel=I,t.showInvalidFileWarning=function(e,t,r){return new Promise((s,o)=>{if(e.length){const{title:i,text:a}=(function(e){if(1===e.length){const{name:t,validationError:r}=e[0];return{title:u.intl.formatMessage({id:"uQF0D4",defaultMessage:"Unable to upload {file}"},{file:t}),text:A(r)}}{const t=u.intl.formatMessage({id:"Chf30m",defaultMessage:"Unable to upload one or more files"}),r=e.map(({name:e})=>e);if(e.length<=3)return{title:t,text:u.intl.formatMessage({id:"fKAsp7",defaultMessage:"The following files are not supported by Dropbox and cannot be uploaded: {files}"},{files:r.join(", ")})};const s=r.length-3;return{title:t,text:u.intl.formatMessage({id:"z9swUK",defaultMessage:"{count, plural, one{The following files are not supported by Dropbox and cannot be uploaded: {files} and {count} more} other{The following files are not supported by Dropbox and cannot be uploaded: {files} and {count} more}}"},{files:r.slice(0,3).join(", "),count:s})}}})(e),n=e.some(({validationError:e})=>e===_.UploadErrorType.CloudDoc)?"https://www.dropbox.com/help/syncing-uploads/web-based-files":"https://help.dropbox.com/installs-integrations/sync-uploads/files-not-syncing";l.showFileSystemWarningsModal({confirmText:u.intl.formatMessage({id:"Bmo28B",defaultMessage:"{count, plural, one{Skip this file} other{Skip these files}}"},{count:e.length}),fsws:[{id:"action_upload_invalid_extension",blocking:t,title:i,text:a,learn_more:n}],onFinalAccept:s,onAbortAction:r?o:void 0})}else s()})},t.getDestinationDir=function(e,t){const r=n.normalize(e),s=n.parent_dir(t);return""===r?"/"===s?"/":"/"+s:"/"===s?r:r+"/"+s},t.folderModalTitle=s.default.createElement(s.default.Fragment,null,u.intl.formatMessage({id:"2sJoAc",defaultMessage:"Upload file in..."}),s.default.createElement(o.Toggletip,{"aria-label":"More information",iconButtonSize:"standard",title:u.intl.formatMessage({id:"Grmp0v",defaultMessage:"Choose a folder you have access to"})}));const g=e=>r.__awaiter(void 0,void 0,void 0,(function*(){return new Promise(t=>setTimeout(t,e))}));t.legacyPromiseWithRetries=(e,t)=>r.__awaiter(void 0,void 0,void 0,(function*(){let r=0,s=yield e();for(;s.isError&&r<t;)r++,yield g(5**r),s=yield e();return{response:s,retryCount:r}}));class N{constructor(){this.isSnackbarShown=!1}hideSnackbar(){this.isSnackbarShown&&(p.Snackbar.close("upload_network_warning_snackbar"),this.isSnackbarShown=!1)}showSnackbar(){this.isSnackbarShown||(this.isSnackbarShown=!0,p.Snackbar.warn(N.warningText,"upload_network_warning_snackbar",!0,{timeoutDelayMs:void 0}))}}N.warningText=u.intl.formatMessage({id:"hCYxpM",defaultMessage:"You seem to be having internet issues. Hang tight and we’ll resume your upload once you reconnect."});const v=new N;t.newPromiseWithRetries=(e,t=5)=>r.__awaiter(void 0,void 0,void 0,(function*(){let r=0,s=yield e();const o=(i=t)+Math.random()*(i/2);for(var i;s.isError;){const{isRetriable:t=!0,maxRetries:i=3,isNetworkError:a}=s;if(a?v.showSnackbar():v.hideSnackbar(),!t||i&&r>i)break;r++;const n=Math.min(o**r,1e4);yield g(n),s=yield e()}return s.isError||v.hideSnackbar(),{response:s,retryCount:r}}));t.showCannotUploadEmptyFolderSnackbar=()=>{p.Snackbar.fail(u.intl.formatMessage({id:"j0CgUw",defaultMessage:"Can’t upload empty file or folder."}),"upload-error-empty-dir",!0)};t.showCannotUploadLinksSnackbar=()=>{p.Snackbar.fail(u.intl.formatMessage({id:"VRES4Y",defaultMessage:"Can’t upload links. To save a link, go to Create > More > Shortcut."}),"upload-error-no-links",!0)};t.makeUploadSnippet=(e,t,r)=>{const s=E.Viewer.get_viewer();let o;return s.is_paired&&t.is_team&&(o=s.team_name),s.is_paired?t.is_team?b(r,e,o):L(r,e):C(r,e)};const b=(e,t,r)=>{const s=S.Emstring.em_snippet(n.filename(e),t);return"/"===e?u.intl.formatMessage({id:"hem9Id",defaultMessage:"upload to your {team_name} Dropbox"},{team_name:r}):u.intl.formatMessage({id:"dFFTlY",defaultMessage:"upload to the folder ‘{folder}’ in your {team_name} Dropbox"},{folder:s,team_name:r})},L=(e,t)=>{const r=S.Emstring.em_snippet(n.filename(e),t);return"/"===e?u.intl.formatMessage({id:"2iuZ56",defaultMessage:"upload to your personal Dropbox"}):u.intl.formatMessage({id:"ezK+EU",defaultMessage:"upload to the folder ‘{folder}’ in your personal Dropbox"},{folder:r})},C=(e,t)=>{const r=S.Emstring.em_snippet(n.filename(e),t);return"/"===e?u.intl.formatMessage({id:"te1cSD",defaultMessage:"upload to your Dropbox"}):u.intl.formatMessage({id:"bgpbuT",defaultMessage:"upload to the folder ‘{folder}’"},{folder:r})};t.logMediaFileToUserSurvey=e=>{const t=e.lastIndexOf(".");if(-1===t)return;const r=e.slice(t);m.AUDIO_EXTS.includes(r)?f.UserSurvey.trackEvent("upload_audio_item","browse"):m.PHOTO_EXTS.includes(r)?f.UserSurvey.trackEvent("upload_photo_item","browse"):m.TRANSCODE_VIDEO_EXTS.includes(r)&&f.UserSurvey.trackEvent("upload_video_item","browse")};t.precheckOptimizationIsOn=()=>"ON"===i.UPLOAD_PRECHECK_OPTIMIZATIONS||"GA"===i.UPLOAD_PRECHECK_OPTIMIZATIONS;t.uploadFailureEmitEventIsOn=()=>i.UPLOAD_FAILURE_EMIT_EVENT;t.uploadSuccessEmitEventIsOn=()=>i.UPLOAD_SUCCESS_EMIT_EVENT;t.shouldUseHybridUploader=()=>"V1"===i.UPLOAD_HYBRID_MIGRATION;t.shouldUseSessionUploadForFile=e=>e>67108864;t.getFilePathForUploadkit=({name:e,dest:t})=>""===t||"/"===t?e:`${t.slice(1)}/${e}`})),define("metaserver/static/js/files_view/file_actions/api_v2",["require","exports","tslib","metaserver/static/js/api_v2/user_client","js/filepath/filepath","metaserver/static/js/core/exception"],(function(e,t,r,s,o,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isPathLookupFailure=t.isFailure=t.createFolder=t.deleteFiles=t.copyFiles=t.moveAndRenameFolder=t.moveFiles=t.renameFile=t.undo=t.getFilenameFromActionInfo=t.fileInfoIsFqPathBased=t.createUndefinedRpcResult=t.EXCLOG_TAG=void 0,o=r.__importStar(o);t.EXCLOG_TAG="file_actions_client_error";t.createUndefinedRpcResult=e=>({isError:!0,error:{".tag":"undefined_error"},error_summary:"undefined_error",jobId:e});const a=(e,r)=>{(0,i.reportStack)(JSON.stringify("error"in r?r.error:r),{severity:i.SEVERITY.NON_CRITICAL,silent:!0,tags:[t.EXCLOG_TAG,`${t.EXCLOG_TAG}_${e}`]})};function n(e){return Boolean("fq_path"in e?e:null)}function l(e){return n(e)?o.filename(e.fq_path):e.name}t.fileInfoIsFqPathBased=n,t.getFilenameFromActionInfo=l,t.undo=function(e,o){return r.__awaiter(this,void 0,void 0,(function*(){const r=new s.UserApiV2Client;try{return{isError:!1,result:yield r.ns("files").rpc("undo_batch",{entries:e},{subjectUserId:o.id})}}catch(e){return a("undo_batch",e),e&&e.error&&e.error[".tag"]?{isError:!0,error:e.error,error_summary:e.summary}:(0,t.createUndefinedRpcResult)()}}))},t.renameFile=function(e,t,i,a){return r.__awaiter(this,void 0,void 0,(function*(){const r=o.parent_dir(e),n=o.normalize(r)+"/"+t,l=new s.UserApiV2Client,{checkFSWs:c}=a;try{const t=yield l.ns("files").rpc("move_v2",{from_path:e,to_path:n,autorename:!0,allow_ownership_transfer:!1,fsw_request:c?{".tag":"check"}:void 0},{subjectUserId:i});return{isError:!1,result:{changeset_data:t.changeset_data,entries:[{".tag":"success",success:t.metadata}]}}}catch(e){return p(e)}}))};const c=(e,t,r,s,o)=>()=>e.ns("files").rpc("move_batch_v2",{entries:r,autorename:!0,allow_ownership_transfer:!!s,fsw_request:o?{".tag":"check"}:void 0},{subjectUserId:t}),_=(e,t)=>r=>e.ns("files").rpc("move_batch/check_v2",{async_job_id:r},{subjectUserId:t});function d(e,s){return r.__awaiter(this,void 0,void 0,(function*(){try{const r=yield e();if("complete"===r[".tag"])return E("relocation_batch",r),{isError:!1,result:r};{let e=void 0;do{yield new Promise(e=>setTimeout(e,1e3)),e=yield s(r.async_job_id)}while(e&&"in_progress"===e[".tag"]);if("complete"===e[".tag"]){const t=e;for(const e of t.entries){const t=u(e,r.async_job_id);if(t)return t}return E("relocation_batch",t),{isError:!1,result:t,jobId:r.async_job_id}}return a("relocation_batch_poll",e),(0,t.createUndefinedRpcResult)(r.async_job_id)}}catch(e){return a("relocation_batch_poll",e),e&&e.error&&e.error[".tag"]?{isError:!0,error:e.error,error_summary:e.error[".tag"]}:(0,t.createUndefinedRpcResult)()}}))}function u(e,t){return"failure"===e[".tag"]&&"relocation_error"===e.failure[".tag"]&&"to"===e.failure.relocation_error[".tag"]&&"file_system_warnings"===e.failure.relocation_error.to[".tag"]?{isError:!0,error:e.failure.relocation_error,error_summary:"file_system_warnings",jobId:t}:"failure"===e[".tag"]&&"relocation_error"===e.failure[".tag"]&&"internal_error"===e.failure.relocation_error[".tag"]?{isError:!0,error:e.failure.relocation_error,error_summary:"internal_error",jobId:t}:void 0}function p(e){var r;if(null===(r=null==e?void 0:e.error)||void 0===r?void 0:r[".tag"]){const t={".tag":"failure",failure:{".tag":"relocation_error",relocation_error:e.error}},r=u(t,void 0);return void 0!==r?r:{isError:!1,result:{changeset_data:[],entries:[t]}}}return(0,t.createUndefinedRpcResult)()}t.moveFiles=function(e,t,o,i={}){return r.__awaiter(this,void 0,void 0,(function*(){const r=new s.UserApiV2Client,{allowOwnershipTransfer:a,checkFSWs:u}=i,E=e=>{const r=`${t}/${l(e)}`;return n(e)?{from_path:e.fq_path,to_path:r}:{from_path:e.id,to_path:r}};if(1===e.length&&n(e[0])&&!e[0].is_dir)try{const t=yield r.ns("files").rpc("move_v2",Object.assign(Object.assign({},E(e[0])),{allow_ownership_transfer:!!a,fsw_request:u?{".tag":"check"}:void 0}),{subjectUserId:o});return{isError:!1,result:{changeset_data:t.changeset_data,entries:[{".tag":"success",success:t.metadata}]}}}catch(e){return p(e)}const S=c(r,o,e.map(E),a,u),f=_(r,o);return yield d(S,f)}))},t.moveAndRenameFolder=function(e,t,o,i,a={}){return r.__awaiter(this,void 0,void 0,(function*(){const r=new s.UserApiV2Client,{allowOwnershipTransfer:l,checkFSWs:u}=a,p=c(r,i,[(e=>{const r=`${t}/${o}`;return n(e)?{from_path:e.fq_path,to_path:r}:{from_path:e.id,to_path:r}})(e)],l,u),E=_(r,i);return yield d(p,E)}))},t.copyFiles=function(e,t,i,a={}){var n;return r.__awaiter(this,void 0,void 0,(function*(){const r=new s.UserApiV2Client,{checkFSWs:l}=a;if(1===e.length&&!e[0].is_dir)try{const s=yield r.ns("files").rpc("copy_v2",{from_path:null!==(n=e[0].file_id)&&void 0!==n?n:e[0].fq_path,to_path:`${t}/${o.filename(e[0].fq_path)}`,autorename:!0,fsw_request:l?{".tag":"check"}:void 0},{subjectUserId:i});return{isError:!1,result:{changeset_data:s.changeset_data,entries:[{".tag":"success",success:s.metadata}]}}}catch(e){return p(e)}return yield d(()=>r.ns("files").rpc("copy_batch_v2",{entries:e.map(e=>{var r;return{from_path:null!==(r=e.file_id)&&void 0!==r?r:e.fq_path,to_path:`${t}/${o.filename(e.fq_path)}`}}),autorename:!0,fsw_request:l?{".tag":"check"}:void 0},{subjectUserId:i}),e=>r.ns("files").rpc("copy_batch/check_v2",{async_job_id:e},{subjectUserId:i}))}))},t.deleteFiles=function(e,o,i){var n;return r.__awaiter(this,void 0,void 0,(function*(){const l=new s.UserApiV2Client,c=e=>"file_id"in e?e.file_id:e.fq_path;if(1===e.length&&!e[0].is_dir)try{const t=yield l.ns("files").rpc("delete_v2",{path:c(e[0]),fsw_request:i?{".tag":"check"}:void 0},{subjectUserId:o});return{isError:!1,result:{changeset_data:t.changeset_data,entries:[{".tag":"success",metadata:t.metadata}]}}}catch(e){return(0,t.isPathLookupFailure)(e)||a("delete_v2",e),(null===(n=null==e?void 0:e.error)||void 0===n?void 0:n[".tag"])?{isError:!1,result:{changeset_data:[],entries:[{".tag":"failure",failure:e.error}]}}:(0,t.createUndefinedRpcResult)()}return yield(function(e,s){return r.__awaiter(this,void 0,void 0,(function*(){try{const r=yield e();if("complete"===r[".tag"])return E("delete_batch",r),{isError:!1,result:r};if("other"===r[".tag"])return a("delete_batch",r),(0,t.createUndefinedRpcResult)();{let e=void 0;do{yield new Promise(e=>setTimeout(e,1e3)),e=yield s(r.async_job_id)}while(e&&"in_progress"===e[".tag"]);return"complete"===e[".tag"]?(E("delete_batch",e),{isError:!1,result:e,jobId:r.async_job_id}):(a("delete_batch_poll",e),(0,t.createUndefinedRpcResult)(r.async_job_id))}}catch(e){return a("delete_batch",e),e&&e.error&&e.error[".tag"]?{isError:!0,error:e.error,error_summary:e.summary}:(0,t.createUndefinedRpcResult)()}}))})(()=>l.ns("files").rpc("delete_batch",{entries:e.map(e=>({path:c(e)})),fsw_request:i?{".tag":"check"}:void 0},{subjectUserId:o}),e=>l.ns("files").rpc("delete_batch/check",{async_job_id:e},{subjectUserId:o}))}))};const E=(e,t)=>{t.entries.forEach(t=>{".tag"in t&&"failure"===t[".tag"]&&a(e,t.failure)})};t.createFolder=function(e,i,n,l){return r.__awaiter(this,void 0,void 0,(function*(){const r=new s.UserApiV2Client;try{return{isError:!1,result:yield r.ns("files").rpc("create_folder_v2",{path:o.normalize(e)+"/"+i,autorename:!0,fsw_request:l?{".tag":"check"}:void 0},{subjectUserId:n.id})}}catch(e){return a("create_folder",e),e&&e.error&&e.error[".tag"]?{isError:!0,error:e.error,error_summary:e.summary}:(0,t.createUndefinedRpcResult)()}}))};t.isFailure=e=>"failure"===e[".tag"];t.isPathLookupFailure=e=>"path_lookup"===e[".tag"]})),define("metaserver/static/js/folder_dialog/async",["require","exports","tslib","react","metaserver/static/js/components/ui/modal_controller","metaserver/static/js/css/css"],(function(e,t,r,s,o,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.prewarmFolderDialog=t.showFolderDialog=void 0,s=r.__importDefault(s),t.showFolderDialog=function(t){new Promise((t,r)=>{e(["metaserver/static/js/folder_dialog/folder_dialog"],t,r)}).then(r.__importStar).then(({FolderDialog:e})=>{(0,o.mountModal)(s.default.createElement(e,Object.assign({},t)))})},t.prewarmFolderDialog=function(){new Promise((t,r)=>{e(["metaserver/static/js/folder_dialog/folder_dialog"],t,r)}).then(r.__importStar).then(()=>{(0,i.require_css)("/static/metaserver/static/css/react/folder_picker-vflhBHl9O.css")})}})),define("metaserver/static/js/new_file_menu/new_file_icon",["require","exports","tslib","react","spectrum/icon_partners/index","metaserver/static/js/clean/static_urls"],(function(e,t,r,s,o,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NewFileIcon=void 0,s=r.__importDefault(s);const a={dropbox_form:(0,i.static_url)("/static/metaserver/static/images/dropbox_form-vfl1f-v2W.svg")};t.NewFileIcon=({iconName:e,displayName:t})=>{const r=a[e];return r?s.default.createElement("img",{alt:t,src:r,width:"24px",height:"24px"}):s.default.createElement(o.IconPartners,{name:e,width:"24px",height:"24px"})},t.NewFileIcon.displayName="NewFileIcon"})),define("metaserver/static/js/new_file_menu/new_file_menu",["require","exports","tslib","classnames","react","dig-components/buttons","dig-components/typography","dig-components/menu","metaserver/static/js/cloud_docs/constants","metaserver/static/js/cloud_docs/create_api","metaserver/static/js/browse/action_logger","metaserver/static/js/components/ui/css","metaserver/static/js/clean/web_user_action_events","metaserver/static/js/modules/constants/page_load","metaserver/static/js/new_file_menu/new_file_icon","metaserver/static/js/new_file_menu/new_file_util","metaserver/static/js/dropbox/proto/pap_events/organize/finish_browse_time_to_success","metaserver/static/js/browse_tts/browse_tts"],(function(e,t,r,s,o,i,a,n,l,c,_,d,u,p,E,S,f,m){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NewFileMenu=t.NewFileTypeRow=t.handleNewFileSelection=void 0,s=r.__importDefault(s),o=r.__importDefault(o),p=r.__importStar(p);var O=f.pap_events.organize.Finish_BrowseTimeToSuccess.BrowseTtsEventName;const T=new Map([[l.GoogleFileTypes.GOOGLE_DSS_DOC,O.CREATE_DOCUMENT_BROWSE_TTS_EVENT_NAME],[l.MicrosoftFileTypes.WORD,O.CREATE_DOCUMENT_BROWSE_TTS_EVENT_NAME],[l.GoogleFileTypes.GOOGLE_DSS_SLIDES,O.CREATE_PRESENTATION_BROWSE_TTS_EVENT_NAME],[l.MicrosoftFileTypes.POWERPOINT,O.CREATE_PRESENTATION_BROWSE_TTS_EVENT_NAME],[l.GoogleFileTypes.GOOGLE_DSS_SHEET,O.CREATE_SPREADSHEET_BROWSE_TTS_EVENT_NAME],[l.MicrosoftFileTypes.EXCEL,O.CREATE_SPREADSHEET_BROWSE_TTS_EVENT_NAME]]);t.handleNewFileSelection=e=>{e.handleClick()};class R extends o.default.Component{render(){return o.default.createElement(n.Menu.ActionItem,{key:this.props.item.displayName,value:this.props.item,className:this.props.item.className,withLeftAccessory:o.default.createElement(E.NewFileIcon,{displayName:this.props.item.displayName,iconName:this.props.item.iconName})},o.default.createElement(a.Text,null,this.props.item.displayName))}}t.NewFileTypeRow=R,R.displayName="NewFileTypeRow";class h extends o.default.Component{constructor(){super(...arguments),this.handleCreateNewFile=(e,t)=>()=>{var r;const s=null!==(r=T.get(e))&&void 0!==r?r:O.CREATE_SOMETHING_ELSE_BROWSE_TTS_EVENT_NAME;(0,m.logBrowseTTS)(s);const{selection_mode:o,empty_folder:i}=this.props,a=t=>{(0,c.showAsyncFolderDialog)({user:this.props.user,source:this.props.source,documentType:e,selection_mode:o,empty_folder:i,handleClickNewFolder:this.props.handleClickNewFolder?this.props.handleClickNewFolder(this.props.user,a):void 0,initialPath:t})};t&&t(e),(0,_.logFileCreateClick)({uid:this.props.user.id,source:this.props.source,action:(0,S.newFileTypeToLogEvent)(e),depth_folder_selected:this.props.path?(0,c.getDepthFromPath)(this.props.path):void 0,selection_mode:o,empty_folder:i}),this.props.path?(0,c.createNewFile)({user:this.props.user,path:this.props.path,documentType:e,source:this.props.source,selection_mode:o,empty_folder:i}):a()},this.logTriggerClick=()=>{const{empty_folder:e,selection_mode:t,path:r,user:s,source:o}=this.props;(0,_.logFileCreateClick)({uid:s.id,source:o,action:u.WebUserActionLogEvent.FILE_CREATE_OPEN_MENU,depth_folder_selected:r?(0,c.getDepthFromPath)(r):void 0,selection_mode:t,empty_folder:e})}}getNewFileTypeSections(){const e=[],t=[];this.props.showPaper&&(t.push({displayName:S.NewPaperDocLabel,iconName:"dropbox_paper",className:"action-create-file-paper-doc",handleClick:this.handleCreateNewFile(l.PaperNewFileTypes.PAPER,this.props.logClickEvent)}),t.push({displayName:S.NewPaperTemplateLabel,iconName:"dropbox_paper_template",className:"action-create-file-paper-template",handleClick:this.handleCreateNewFile(l.PaperNewFileTypes.PAPER_TEMPLATE,this.props.logClickEvent)})),this.props.showBinder&&t.push({displayName:S.NewPaperBinderDocLabel,iconName:"dropbox_paper_binder",className:"action-create-file-paper-binder",handleClick:this.handleCreateNewFile(l.PaperNewFileTypes.PAPER_BINDER,this.props.logClickEvent)}),t.push({displayName:S.NewSimplePointerLabel,iconName:"shortcut",className:"action-create-simple-pointer",handleClick:this.handleCreateNewFile(l.PointerFileTypes.SIMPLE_POINTER,this.props.logClickEvent)}),t.length>0&&e.push(t);const r=[];r.push({displayName:S.NewMicrosoftWordDocLabel,iconName:"microsoft_docx",className:"action-create-file-word",handleClick:this.handleCreateNewFile(l.MicrosoftFileTypes.WORD,this.props.logClickEvent)}),r.push({displayName:S.NewMicrosoftExcelWorkbookLabel,iconName:"microsoft_xlsx",className:"action-create-file-excel",handleClick:this.handleCreateNewFile(l.MicrosoftFileTypes.EXCEL,this.props.logClickEvent)}),r.push({displayName:S.NewMicrosoftPowerPointPresentationLabel,iconName:"microsoft_pptx",className:"action-create-file-powerpoint",handleClick:this.handleCreateNewFile(l.MicrosoftFileTypes.POWERPOINT,this.props.logClickEvent)}),e.push(r);const s=[];return s.push({displayName:S.NewGoogleDocsLabel,iconName:"google_gdoc",className:"action-create-file-google-doc",handleClick:this.handleCreateNewFile(l.GoogleFileTypes.GOOGLE_DSS_DOC,this.props.logClickEvent)}),s.push({displayName:S.NewGoogleSheetsLabel,iconName:"google_gsheet",className:"action-create-file-google-sheet",handleClick:this.handleCreateNewFile(l.GoogleFileTypes.GOOGLE_DSS_SHEET,this.props.logClickEvent)}),s.push({displayName:S.NewGoogleSlidesLabel,iconName:"google_gslides",className:"action-create-file-google-slides",handleClick:this.handleCreateNewFile(l.GoogleFileTypes.GOOGLE_DSS_SLIDES,this.props.logClickEvent)}),e.push(s),e}renderTrigger(e){const t=0===p.USER_LOCALE.indexOf("en")||this.props.forceLongLabel?S.LongNewFileCreateLabel:S.ShortNewFileCreateLabel,r=Object.assign(Object.assign({},e),{disabled:this.props.disabled,className:(0,s.default)("primary-action-menu__button","action-create-file"),variant:"primary"});return o.default.createElement(i.Button,Object.assign({key:S.LongNewFileCreateLabel,withDropdownIcon:!0},r),t)}renderSection(e,t){return o.default.createElement(n.Menu.Segment,{key:t},e.map(e=>o.default.createElement(R,{item:e,key:e.displayName})))}render(){const e=this.getNewFileTypeSections();return o.default.createElement(n.Menu.Wrapper,{onToggle:this.logTriggerClick,onSelection:t.handleNewFileSelection},({getContentProps:t,getTriggerProps:r})=>o.default.createElement(o.default.Fragment,null,this.renderTrigger(r()),o.default.createElement(n.Menu.Content,Object.assign({},t()),e.map(this.renderSection))))}}h.defaultProps={},h.displayName="NewFileMenu";const I=(0,d.requireCssWithComponent)(h,["/static/metaserver/static/css/dig-components/index.web-vflD7DS1H.css","/static/metaserver/static/css/cloud_docs/create_pointer_modal-vflATc8Dt.css"]);t.NewFileMenu=I})),define("metaserver/static/js/new_file_menu/new_file_util",["require","exports","metaserver/static/js/cloud_docs/constants","metaserver/static/js/clean/web_user_action_events","metaserver/static/js/core/i18n"],(function(e,t,r,s,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.newFileTypeToLogEvent=t.NewSimplePointerLabel=t.NewPaperBinderDocLabel=t.NewPaperTemplateLabel=t.NewPaperDocLabel=t.NewMicrosoftWordDocLabel=t.NewMicrosoftPowerPointPresentationLabel=t.NewMicrosoftExcelWorkbookLabel=t.NewGoogleSlidesLabel=t.NewGoogleSheetsLabel=t.NewGoogleDocsLabel=t.ShortNewFileCreateLabel=t.LongNewFileCreateLabel=void 0,t.LongNewFileCreateLabel=o.intl.formatMessage({id:"8/w9ir",defaultMessage:"Create new file"}),t.ShortNewFileCreateLabel=o.intl.formatMessage({id:"o96TiK",defaultMessage:"Create"}),t.NewGoogleDocsLabel=o.intl.formatMessage({id:"+HsOFj",defaultMessage:"Google Docs"}),t.NewGoogleSheetsLabel=o.intl.formatMessage({id:"cpuRML",defaultMessage:"Google Sheets"}),t.NewGoogleSlidesLabel=o.intl.formatMessage({id:"PcJCVL",defaultMessage:"Google Slides"}),t.NewMicrosoftExcelWorkbookLabel=o.intl.formatMessage({id:"0rYKaW",defaultMessage:"Excel Workbook"}),t.NewMicrosoftPowerPointPresentationLabel=o.intl.formatMessage({id:"e9uLbL",defaultMessage:"PowerPoint Presentation"}),t.NewMicrosoftWordDocLabel=o.intl.formatMessage({id:"yY5byF",defaultMessage:"Word Document"}),t.NewPaperDocLabel=o.intl.formatMessage({id:"neBk7u",defaultMessage:"Dropbox Paper"}),t.NewPaperTemplateLabel=o.intl.formatMessage({id:"Rvv7NR",defaultMessage:"Dropbox Paper Template"}),t.NewPaperBinderDocLabel=o.intl.formatMessage({id:"sbO30Y",defaultMessage:"Dropbox Binder (Beta)"}),t.NewSimplePointerLabel=o.intl.formatMessage({id:"4gEt6j",defaultMessage:"Shortcut"});t.newFileTypeToLogEvent=e=>{switch(e){case r.MicrosoftFileTypes.WORD:return s.WebUserActionLogEvent.FILE_CREATE_WORD;case r.MicrosoftFileTypes.EXCEL:return s.WebUserActionLogEvent.FILE_CREATE_EXCEL;case r.MicrosoftFileTypes.POWERPOINT:return s.WebUserActionLogEvent.FILE_CREATE_POWERPOINT;case r.GoogleFileTypes.GOOGLE_DSS_DOC:return s.WebUserActionLogEvent.FILE_CREATE_GOOGLE_DOC;case r.GoogleFileTypes.GOOGLE_DSS_SHEET:return s.WebUserActionLogEvent.FILE_CREATE_GOOGLE_SHEET;case r.GoogleFileTypes.GOOGLE_DSS_SLIDES:return s.WebUserActionLogEvent.FILE_CREATE_GOOGLE_SLIDES;case r.PaperNewFileTypes.PAPER:return s.WebUserActionLogEvent.FILE_CREATE_PAPER;case r.PaperNewFileTypes.PAPER_TEMPLATE:return s.WebUserActionLogEvent.FILE_CREATE_PAPER_TEMPLATE;case r.PaperNewFileTypes.PAPER_BINDER:return s.WebUserActionLogEvent.FILE_CREATE_BINDER;case r.PointerFileTypes.SIMPLE_POINTER:return s.WebUserActionLogEvent.FILE_CREATE_SIMPLE_POINTER}}})),define("metaserver/static/js/share_download/ui/api",["require","exports","tslib","metaserver/static/js/deprecated_ajax/ajax_as_promised_jquery"],(function(e,t,r,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fetchDownloadUrl=t.testDownload=t.TooLargeError=t.DownloadError=void 0,s=r.__importStar(s);class o extends class{constructor(e){this.message=e}}{}t.DownloadError=o;class i extends o{}t.TooLargeError=i,t.testDownload=function(e,t){return r.__awaiter(this,void 0,void 0,(function*(){let r;try{r=yield s.SilentBackgroundRequest({url:e,data:{rlkey:t}})}catch(e){throw new o}if("OK"!==r)throw 0===r.indexOf("err:")?new i:new o}))},t.fetchDownloadUrl=function(e,t,r){return s.SilentBackgroundRequest({url:"/sharing/fetch_user_content_link",data:{url:e,rlkey:t,origin:r}})}})),define("metaserver/static/js/file_uploader/web_upload_action_logger",["require","exports","tslib","metaserver/static/js/deprecated_ajax/ajax_jquery"],(function(e,t,r,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebUploadActionLogClass=t.WebUploadActionLog=t.MAX_ERRORS=void 0,s=r.__importStar(s),t.MAX_ERRORS=3;class o{constructor(){this.errorCount=0,this.lastError=Date.now(),this.shouldReport=!0}log(e,r,o){return o=Object.assign(Object.assign(Object.assign({},o),o.extra),{extra:void 0}),this.shouldReport&&(this.errorCount<t.MAX_ERRORS||Date.now()-this.lastError>6e5)?new Promise((i,a)=>{s.SilentBackgroundRequest({url:"/log/web_upload_action",data:{_subject_uid:e,event_type:r,extra_params:JSON.stringify(o)},error:e=>{429===e.status?this.errorCount=t.MAX_ERRORS:this.errorCount++,this.lastError=Date.now(),a(e)},success:e=>{try{const t=JSON.parse(e);t&&!t.continue_sending&&(this.shouldReport=!1),this.errorCount=0,i(e)}catch(e){throw this.errorCount++,this.lastError=Date.now(),a(e),e}}})}):Promise.resolve({})}}t.WebUploadActionLog=new o,t.WebUploadActionLogClass=o})),define("metaserver/static/js/core/custom_protocol",["require","exports","tslib","metaserver/static/js/core/browser_detection"],(function(e,t,r,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.canLaunchUri=t.launchUriForMicrosoftBrowsers=t.launchUriByIframe=t.launchUri=void 0;const o=(s=r.__importStar(s)).chrome?1e3:2e3;function i(e){const t=document.createElement("iframe");t.src=e,t.setAttribute("style","display: none;"),document.body.appendChild(t)}function a(e,t,r){const s=window.navigator;s&&s.msLaunchUri?s.msLaunchUri(e,t,r):r()}t.launchUri=function(e){let t=null;return new Promise((r,n)=>{function l(){window.removeEventListener("blur",l),null!==t&&clearTimeout(t),r()}window.addEventListener("blur",l),t=setTimeout(()=>{window.removeEventListener("blur",l),n()},o),s.chromium()?window.location.assign(e):s.mozilla||s.safari?i(e):(s.msie||s.edge)&&a(e,r,n)})},t.launchUriByIframe=i,t.launchUriForMicrosoftBrowsers=a,t.canLaunchUri=function(){return s.msie?s.windowsInfo.win8OrHigher:!!(s.mozilla||s.safari||s.chrome)}})),define("metaserver/static/js/vault/constants",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ENCRYPTED_DOWNLOAD_ARGS_QUERY_PARAM_KEY=t.ENCRYPTED_OWNER_QUERY_PARAM_KEY=t.VAULT_OWNER_DISPLAY_NAME_QUERY_PARAM_KEY=t.VAULT_OWNER_FNAME_QUERY_PARAM_KEY=t.CONNECTED_APPS_PATH=t.SECURITY_CHECKUP_RELATIVE_URL=t.VAULT_STYLESHEETS=t.VAULT_NAME=t.VAULT_HASH_MODAL_KEY=t.VAULT_HASH_TAB_KEY=t.VAULT_URL=void 0,t.VAULT_URL="/vault",t.VAULT_HASH_TAB_KEY="tab",t.VAULT_HASH_MODAL_KEY="modal",t.VAULT_NAME="Vault",t.VAULT_STYLESHEETS=["/static/metaserver/static/css/spectrum/index.web-vflJy4G-t.css","/static/metaserver/static/css/dig-components/index.web-vflD7DS1H.css","/static/typescript/component_libraries/vault/src/index.web-vfljKwJih.css","/static/metaserver/static/css/vault/vault-vflbqmnaC.css"],t.SECURITY_CHECKUP_RELATIVE_URL="/security_checkup",t.CONNECTED_APPS_PATH="/account/connected_apps",t.VAULT_OWNER_FNAME_QUERY_PARAM_KEY="vo_fn",t.VAULT_OWNER_DISPLAY_NAME_QUERY_PARAM_KEY="vo_dn",t.ENCRYPTED_OWNER_QUERY_PARAM_KEY="vo",t.ENCRYPTED_DOWNLOAD_ARGS_QUERY_PARAM_KEY="enc"})),define("metaserver/static/js/search/unified_search/portaling",["require","exports","tslib","react","react-dom","metaserver/static/js/search/unified_search/search_window_state"],(function(e,t,r,s,o,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PortalTarget=t.PortalSource=void 0,s=r.__importStar(s);t.PortalSource=({portalType:e,children:t,className:r})=>{const[a,n]=(0,s.useState)((0,i.getLastDiv)(e));return(0,s.useEffect)(()=>((0,i.setRefListener)(e,e=>{var t;n(null!==(t=null==e?void 0:e.current)&&void 0!==t?t:null)}),()=>{(0,i.setRefListener)(e,null)}),[]),a?(r&&a.classList.add(...r.split(" ")),(0,o.createPortal)(t,a)):s.default.createElement(s.default.Fragment,null)};t.PortalTarget=({portalType:e})=>{const t=(0,s.createRef)();return(0,s.useEffect)(()=>((0,i.getRefListener)(e)(t),()=>{const t=(0,i.getRefListener)(e);t&&t(null)}),[]),s.default.createElement("div",{ref:t,"data-testid":`${e}-portal-target`})}})),define("metaserver/static/js/search/unified_search/renderer",["require","exports","tslib","classnames","react","metaserver/static/js/search/single_page/input/wrapper","metaserver/static/js/search/unified_search/portaling"],(function(e,t,r,s,o,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SearchInputRenderer=void 0,s=r.__importDefault(s),o=r.__importDefault(o);t.SearchInputRenderer=({user:e,searchInputProps:t})=>{var r;const n=null!==(r=null==t?void 0:t.inputBoxRef)&&void 0!==r?r:o.default.createRef();return o.default.createElement("div",{"data-testid":"search-input-portal"},o.default.createElement(a.PortalSource,{portalType:"search-input",className:(0,s.default)({"global-header__search":!0,"global-header__search--active":!!(null==t?void 0:t.isActive)})},o.default.createElement(i.SearchInput,Object.assign({},t,{user:e,inputBoxRef:n,variant:"full-page",shouldNotRenderGlobalHeaderClasses:!0}))))},t.SearchInputRenderer.displayName="SearchInputRenderer"})),define("metaserver/static/js/search/unified_search/search_provider",["require","exports","tslib","react","metaserver/static/js/search/unified_search/renderer","metaserver/static/js/search/unified_search/search_state_provider","metaserver/static/js/search/unified_search/utils","metaserver/static/js/clean/viewer"],(function(e,t,r,s,o,i,a,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SearchProvider=void 0,s=r.__importStar(s);t.SearchProvider=({children:e,userId:t,searchInputProps:r})=>{const l=(0,s.useMemo)(()=>n.Viewer.get_viewer().get_user_by_id(t),[t]);return s.default.createElement(i.SearchStateProvider,{user:l},(0,a.shouldUseSearchInputPortal)()&&s.default.createElement(o.SearchInputRenderer,{user:l,searchInputProps:r}),e)},t.SearchProvider.displayName="SearchProvider"})),define("metaserver/static/js/search/unified_search/search_state_provider",["require","exports","tslib","react"],(function(e,t,r,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.useSearchState=t.SearchStateContext=t.SearchStateProvider=void 0,s=r.__importStar(s);t.SearchStateProvider=({children:e,user:r})=>s.default.createElement(t.SearchStateContext.Provider,{value:{user:r}},e),t.SearchStateProvider.displayName="SearchStateProvider",t.SearchStateContext=(0,s.createContext)({});t.useSearchState=()=>(0,s.useContext)(t.SearchStateContext)})),define("metaserver/static/js/search/unified_search/search_window_state",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getLastDiv=t.getRefListener=t.setRefListener=void 0;const r=()=>{const e=window;if(e.unifiedSearch)return e.unifiedSearch;const t={refListeners:{},lastDivs:{}};return window.unifiedSearch=t,t};t.setRefListener=(e,t)=>{r().refListeners[e]=t};t.getRefListener=e=>t=>{var s,o,i;r().lastDivs[e]=null!==(s=null==t?void 0:t.current)&&void 0!==s?s:null,null===(i=(o=r().refListeners)[e])||void 0===i||i.call(o,t)};t.getLastDiv=e=>{var t;return null!==(t=r().lastDivs[e])&&void 0!==t?t:null}})),define("metaserver/static/js/search/unified_search/utils",["require","exports","metaserver/static/js/modules/constants/search"],(function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.shouldUseReactQuery=t.shouldUseFullPageVariantOnDeletedFiles=t.shouldUseFullPageVariantOnAccount=t.shouldUseSearchInputPortalInGlobalHeader=t.shouldUseSearchInputPortal=t.isUnifiedSearchEnabled=t.UNIFIED_SEARCH_VARIANTS=t.SEARCH_REACT_QUERY_VARIANT=t.SEARCH_INPUT_PORTAL_GH_VARIANT=t.SEARCH_INPUT_PORTAL_VARIANT=void 0,t.SEARCH_INPUT_PORTAL_VARIANT="SEARCH_INPUT_PORTAL",t.SEARCH_INPUT_PORTAL_GH_VARIANT="SEARCH_INPUT_PORTAL_GH",t.SEARCH_REACT_QUERY_VARIANT="SEARCH_REACT_QUERY",t.UNIFIED_SEARCH_VARIANTS=[t.SEARCH_INPUT_PORTAL_VARIANT,t.SEARCH_INPUT_PORTAL_GH_VARIANT,t.SEARCH_REACT_QUERY_VARIANT];t.isUnifiedSearchEnabled=()=>Object.values(t.UNIFIED_SEARCH_VARIANTS).includes(r.UNIFIED_SEARCH_VARIANT);t.shouldUseSearchInputPortal=()=>[t.SEARCH_INPUT_PORTAL_VARIANT,t.SEARCH_INPUT_PORTAL_GH_VARIANT].includes(r.UNIFIED_SEARCH_VARIANT);t.shouldUseSearchInputPortalInGlobalHeader=(e,s)=>!(r.UNIFIED_SEARCH_VARIANT!==t.SEARCH_INPUT_PORTAL_GH_VARIANT||"full-page"!==e.searchVariant&&!s||!window.RUNNING_IN_EDISON);t.shouldUseFullPageVariantOnAccount=e=>"ON"===e&&r.UNIFIED_SEARCH_ACCOUNT_USE_FULL_PAGE_VARIANT;t.shouldUseFullPageVariantOnDeletedFiles=()=>r.UNIFIED_SEARCH_DELETED_FILES_USE_FULL_PAGE_VARIANT;t.shouldUseReactQuery=()=>r.UNIFIED_SEARCH_VARIANT==t.SEARCH_REACT_QUERY_VARIANT})),define("metaserver/static/js/search/utils",["require","exports","metaserver/static/js/core/exception"],(function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.assertOnceQuietly=void 0;const s={};t.assertOnceQuietly=(e,t)=>{s[e]||(s[e]=!0,(0,r.reportStack)(...t))}}));
//# sourceMappingURL=pkg-browse.min.js-vflCw6Iz6.map