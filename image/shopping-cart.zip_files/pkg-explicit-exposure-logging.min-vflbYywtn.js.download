define("metaserver/static/js/stormcrow/constants",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AMP_STORMCROW_EXPOSURE_METRIC_NAME=t.AMP_STORMCROW_WEB_NAMESPACE=void 0,t.AMP_STORMCROW_WEB_NAMESPACE="web_stormcrow",t.AMP_STORMCROW_EXPOSURE_METRIC_NAME="stormcrow_exposure"})),define("metaserver/static/js/stormcrow/explicit_exposure_logging",["require","exports","tslib","metaserver/static/js/stormcrow/gating_factory","metaserver/static/js/core/exception","react"],(function(e,t,r,s,o,n){"use strict";function i(e,t){return r.__awaiter(this,void 0,void 0,(function*(){const r={features:e};try{const e=yield(0,s.getGatingClientSingleton)().getVariant(r,t);return null==e?void 0:e.variantInfos}catch(e){return void o.reportException({err:e,severity:o.SEVERITY.CRITICAL,force:!0})}}))}function a(e){try{return(0,s.getGatingClientSingleton)().logExposure({stormcrowVariantInfo:e}),!0}catch(e){return o.reportException({err:e,severity:o.SEVERITY.CRITICAL,force:!0}),!1}}Object.defineProperty(t,"__esModule",{value:!0}),t.useLogExposureOnce=t.logExposure=t.getVariantInfos=t.getVariantAndLogExposure=void 0,o=r.__importStar(o),n=r.__importDefault(n),t.getVariantAndLogExposure=function(e,t,r){i([e],r).then(r=>{var s;a({feature:e,variant:t,metadata:null===(s=null==r?void 0:r[0])||void 0===s?void 0:s.metadata})})},t.getVariantInfos=i,t.logExposure=a,t.useLogExposureOnce=function(e){const t=n.default.useRef({});n.default.useEffect(()=>{(null==e?void 0:e.feature)&&(null==e?void 0:e.variant)&&t.current[e.feature]!==(null==e?void 0:e.variant)&&a(e)&&(t.current[e.feature]=null==e?void 0:e.variant)},[e])}})),define("metaserver/static/js/stormcrow/gating_factory",["require","exports","metaserver/static/js/api_v2/user_client","metaserver/static/js/api_v2/noauth_client","metaserver/static/js/stormcrow/stormcrow_with_pap_gating_client"],(function(e,t,r,s,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getGatingClientSingleton=t.GatingFactory=void 0;class n{constructor(e,t){this.userApiV2Client=e,this.noAuthAPIV2Client=t}getGatingClient(){return new o.StormcrowWithPAPGatingClient(this.userApiV2Client,this.noAuthAPIV2Client)}}let i,a;t.GatingFactory=n,t.getGatingClientSingleton=function(){if(!i){const e=new r.UserApiV2Client,t=new s.NoAuthApiV2Client;i=new n(e,t)}return a||(a=i.getGatingClient()),a}})),define("metaserver/static/js/stormcrow/stormcrow_gating_client",["require","exports","metaserver/static/js/stormcrow/types/log_exposure","metaserver/static/js/stormcrow/utils"],(function(e,t,r,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StormcrowGatingClient=void 0;t.StormcrowGatingClient=class{constructor(e,t){this.userApiV2Client=e,this.noAuthAPIV2Client=t}getVariant(e,t){const r=this.mapToAPIV2GetAssignmentsRequest(e);let s;return s=t?this.userApiV2Client.ns("stormcrow_servicer").rpc("get_assignments",r,{subjectUserId:t}):this.noAuthAPIV2Client.ns("stormcrow_servicer").rpc("get_assignments",r,{}),s.then(e=>this.mapToGetVariantResult(e))}legacyLogExposure(e,t,o){const n=this.mapToAPIV2LogExposuresRequest(e,t);let i;i=o?this.userApiV2Client.ns("stormcrow_servicer").rpc("log_exposures",n,{subjectUserId:o}):this.noAuthAPIV2Client.ns("stormcrow_servicer").rpc("log_exposures",n,{});const a=e.stormcrowVariantInfo.feature?e.stormcrowVariantInfo.feature:"unknown",u=e.stormcrowVariantInfo.variant?e.stormcrowVariantInfo.variant:"unknown";return i.then(e=>((0,s.reportExposureToAmp)(a,u,r.ClientLogStatus.LOG_SUCCESS),this.mapToLogExposureResult(e))).catch(e=>{throw(0,s.reportExposureToAmp)(a,u,r.ClientLogStatus.LOG_FAILURE),e})}mapToLogExposureResult(e){return{status:e.status}}mapToGetVariantResult(e){if(e.assignments){return{variantInfos:e.assignments.map(e=>({feature:e.feature,variant:e.variant,metadata:e.metadata,status:e.status}))}}return null}mapToAPIV2GetAssignmentsRequest(e){return{request_params:{request_ip:e.request_ip,locales:e.locales,user_agent:e.user_agent},features:e.features.map(e=>({feature:e}))}}mapToAPIV2LogExposuresRequest(e,t){return t||(t=Date.now()),{exposures:[{feature:e.stormcrowVariantInfo.feature,variant:e.stormcrowVariantInfo.variant,metadata:e.stormcrowVariantInfo.metadata,timestamp:t}]}}}})),define("metaserver/static/js/stormcrow/stormcrow_with_pap_gating_client",["require","exports","metaserver/static/js/stormcrow/stormcrow_gating_client","metaserver/static/js/pap/analytics_client"],(function(e,t,r,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StormcrowWithPAPGatingClient=void 0;class o extends r.StormcrowGatingClient{logExposure(e){this.createAndLogPAPEvent(e)}createAndLogPAPEvent(e){var t,r,o,n,i;const a=null===(r=null===(t=e.stormcrowVariantInfo.metadata)||void 0===t?void 0:t.metadata)||void 0===r?void 0:r.population_id,u=null===(n=null===(o=e.stormcrowVariantInfo.metadata)||void 0===o?void 0:o.metadata)||void 0===n?void 0:n.identity_gid,l=null===(i=e.stormcrowVariantInfo.metadata)||void 0===i?void 0:i.metadata;let c=void 0;null!=l&&(c=JSON.stringify(l)),(0,s.logExposureEvent)(e.stormcrowVariantInfo.feature,e.stormcrowVariantInfo.variant,a,u,c)}}t.StormcrowWithPAPGatingClient=o})),define("metaserver/static/js/stormcrow/types/log_exposure",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ClientLogStatus=t.LogExposureResult=t.LogExposureRequest=void 0;t.LogExposureRequest=class{};t.LogExposureResult=class{},(function(e){e.LOG_SUCCESS="log_success",e.LOG_FAILURE="log_failure"})(t.ClientLogStatus||(t.ClientLogStatus={}))})),define("metaserver/static/js/stormcrow/utils",["require","exports","metaserver/static/js/metrics/index","metaserver/static/js/stormcrow/constants"],(function(e,t,r,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.reportExposureToAmp=void 0,t.reportExposureToAmp=function(e,t,o){(0,r.getMetricsReporter)().createStats({ns:s.AMP_STORMCROW_WEB_NAMESPACE,name:s.AMP_STORMCROW_EXPOSURE_METRIC_NAME},{feature:e,variant:t,client_log_status:o}).record(1)}})),define("metaserver/static/js/clean/ui/bubble_menu",["require","exports","tslib","classnames","react","react-dom","prop-types","lodash","jquery","ts-key-enum","metaserver/static/js/clean/ui/bubble_dropdown_v2"],(function(e,t,r,s,o,n,i,a,u,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BubbleMenu=t.BubbleMenuItem=void 0,s=r.__importDefault(s),o=r.__importDefault(o),n=r.__importStar(n),i=r.__importDefault(i),a=r.__importStar(a),u=r.__importDefault(u);const p={DEFAULT:1,CHECKBOX:2,RADIO:3};class d extends o.default.Component{constructor(){super(...arguments),this._handleMouseEnter=e=>{if(null!=this.refs.item)return(0,u.default)(n.findDOMNode(this.refs.item)).closest(".bubble-menu").removeClass("bubble-menu--keyboard"),this.props.onMouseEnter(e)},this._handleClick=e=>this.props.disabled?(e.preventDefault(),e.stopPropagation()):"#"===this.props.href&&(e.preventDefault(),this.props.onClick(e),this.props.closeOnClick)?this.props.closeFunc():void 0,this._getRole=()=>{switch(this.props.itemType){case p.CHECKBOX:return"menuitemcheckbox";case p.RADIO:return"menuitemradio";default:return"menuitem"}},this._getAriaChecked=()=>{switch(this.props.itemType){case p.CHECKBOX:case p.RADIO:return this.props.checked||!1;default:return null}},this.renderContents=()=>{const e={"bubble-menu-item":!0,"bubble-menu-item--disabled":this.props.disabled,"bubble-menu-item--checked":this.props.checked};return o.default.createElement("a",{ref:"item",role:this._getRole(),className:(0,s.default)(e),href:this.props.href,target:this.props.target,onClick:this._handleClick,onMouseEnter:this._handleMouseEnter,onMouseLeave:this.props.onMouseLeave,"aria-disabled":this.props.disabled,"aria-checked":this._getAriaChecked()},this.props.children)}}render(){return o.default.createElement("li",{role:"presentation",className:(0,s.default)("bubble-menu-item-wrapper",this.props.className)},this.renderContents())}}t.BubbleMenuItem=d,d.displayName="BubbleMenuItem",d.propTypes={onClick:i.default.func,href:i.default.string,target:i.default.string,disabled:i.default.bool,closeOnClick:i.default.bool,closeFunc:i.default.func,className:i.default.string,onMouseEnter:i.default.func,onMouseLeave:i.default.func,itemType:i.default.oneOf(a.values(p)),checked:i.default.bool},d.defaultProps={onClick:a.noop,href:"#",target:null,disabled:!1,closeOnClick:!0,closeFunc:a.noop,className:null,onMouseEnter:a.noop,onMouseLeave:a.noop,itemType:p.DEFAULT,checked:null},d.TYPES=p;class m extends o.default.Component{constructor(){super(...arguments),this.showMenu=()=>{var e,t;return null===(t=null===(e=this.refs.bubble)||void 0===e?void 0:e.getWrappedComponent())||void 0===t?void 0:t.showDropdown()},this.hideMenu=()=>{var e,t;return null===(t=null===(e=this.refs.bubble)||void 0===e?void 0:e.getWrappedComponent())||void 0===t?void 0:t.hideDropdown()},this._onShowBubbleMenu=()=>{if(null!=this.refs.menu&&null!=this.refs.bubble)return this.$menu=(0,u.default)(n.findDOMNode(this.refs.menu)),this.$menuitems=this.$menu.find('*[role="menuitem"],*[role="menuitemcheckbox"],*[role="menuitemradio"]'),this.$menu.addClass("bubble-menu--keyboard"),"function"==typeof this.props.onShowDropdown?this.props.onShowDropdown():void 0},this._onKeyDown=e=>(this.$menu.addClass("bubble-menu--keyboard"),e.key===l.Key.ArrowDown?(this._focusNext(e.target),e.preventDefault(),e.stopPropagation()):e.key===l.Key.ArrowUp?(this._focusPrevious(e.target),e.preventDefault(),e.stopPropagation()):void 0),this._onKeyPress=e=>{this.$menu.addClass("bubble-menu--keyboard");const t=e.key.toLowerCase();return(()=>{var r,s;const o=[];for(let n=0;n<this.$menuitems.length;n++){const i=this.$menuitems[n];if((null===(s=null===(r=i.textContent)||void 0===r?void 0:r[0])||void 0===s?void 0:s.toLowerCase())===t&&n>this.$menuitems.index(e.target)){i.focus(),e.stopPropagation();break}o.push(void 0)}return o})()},this._focusPrevious=e=>{let t=this.$menuitems.index(e);return t=[-1,0].includes(t)?this.$menuitems.length-1:t-1,this.$menuitems.get(t).focus()},this._focusNext=e=>{let t=this.$menuitems.index(e);return t=[-1,this.$menuitems.length-1].includes(t)?0:t+1,this.$menuitems.get(t).focus()}}render(){let e;return this.props.targetButton&&(e=o.default.createElement(f,{ref:"targetButton",childProps:{"aria-haspopup":!0}},this.props.targetButton)),o.default.createElement(c.BubbleDropdown,Object.assign({},a.assignIn({},this.props,{ref:"bubble",shouldTrapKeyboardFocus:!0,onShowDropdown:this._onShowBubbleMenu,targetButton:e})),o.default.createElement("div",null,this.props.headerContent),o.default.createElement("ul",{role:"menu",ref:"menu",className:"bubble-menu",onKeyDown:this._onKeyDown,onKeyPress:this._onKeyPress},Array.from(this.props.items).map((e,t)=>o.default.cloneElement(e,{closeFunc:this.hideMenu,key:null!=e.key?e.key:t}))))}}t.BubbleMenu=m,m.displayName="BubbleMenu",m.propTypes=a.assignIn({},c.BubbleDropdown.propTypes,{headerContent:i.default.element,items:i.default.arrayOf((function(e,t,r){const s=e[t].type;if(![d].includes(s)){const r=(null!=s?s.displayName:void 0)||e[t];return new Error(`Expected menu items to be instances of BubbleMenuItem, not ${r}.`)}return null})).isRequired,onShowDropdown:i.default.func,targetButton(e,t,r){if("button"!==(null!=e.targetButton?e.targetButton.type:void 0))return new Error(`BubbleDropdown's targetButton must be a \`<button>\`, found: ${e[t].type}`)}});class f extends o.default.Component{render(){return o.default.cloneElement(this.props.children,this.props.childProps)}}f.displayName="BubbleMenuTargetButtonWrapper",f.propTypes={childProps:i.default.object}})),define("metaserver/static/js/clean/browse_interface",["require","exports","metaserver/static/js/clean/viewer","metaserver/static/js/core/i18n","metaserver/static/js/core/uri","metaserver/static/js/clean/browse_uri_interface","metaserver/static/js/clean/browse_uri_interface"],(function(e,t,r,s,o,n,i){"use strict";function a(e){return r.Viewer.get_viewer().is_paired?r.Viewer.get_root_name(e):s.intl.formatMessage({id:"bObFEu",defaultMessage:"Files"})}Object.defineProperty(t,"__esModule",{value:!0}),t.getFileHistoryUrlForNsPath=t.getFileHistoryUrl=t.get_all_browse_roots=t.get_browse_root_name=t.browse_uri_for_fq_path=t.preview_uri_for_fq_path=t.href_for_file=t.get_browse_root=void 0,Object.defineProperty(t,"get_browse_root",{enumerable:!0,get:function(){return n.get_browse_root}}),Object.defineProperty(t,"href_for_file",{enumerable:!0,get:function(){return n.href_for_file}}),Object.defineProperty(t,"preview_uri_for_fq_path",{enumerable:!0,get:function(){return n.preview_uri_for_fq_path}}),Object.defineProperty(t,"browse_uri_for_fq_path",{enumerable:!0,get:function(){return n.browse_uri_for_fq_path}}),t.get_browse_root_name=a,t.get_all_browse_roots=function(){return r.Viewer.get_viewer().get_users().map(e=>({name:a(e),path:(0,i.get_browse_root)(e)}))},t.getFileHistoryUrl=function({fqPath:e,userId:t},r){const s=Object.assign(Object.assign({},null==r?{}:r),{undelete:"1",_subject_uid:String(t)});return e=e.replace(/^[/]/,""),new o.URI({path:`/history/${e}`}).updateQuery(s).toString()},t.getFileHistoryUrlForNsPath=function({nsPath:e,nsId:t,userId:r},s){const n=Object.assign(Object.assign({},null!=s?s:{}),{ns_id:`${t}`,undelete:"1",_subject_uid:String(r)});return e=e.replace(/^[/]/,""),new o.URI({path:`/history/${e}`}).updateQuery(n).toString()}}));
//# sourceMappingURL=pkg-explicit-exposure-logging.min.js-vflKZQSry.map