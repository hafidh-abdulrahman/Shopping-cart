define("metaserver/static/js/dropbox/proto/pap_events/manual_upload/upload_file",["require","exports","tslib","protobufjs/minimal","metaserver/static/js/dropbox/proto/pap_events/predefined_event","metaserver/static/js/dropbox/proto/pap_events/event_enums"],(function(e,t,s,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.pap_events=void 0;(i=s.__importStar(i)).Reader,i.Writer,i.util;const r=i.roots.default||(i.roots.default={});var o,a;t.default=r,t.pap_events=r.pap_events=((o=r.pap_events||{}).manual_upload=((a=o.manual_upload||{}).Upload_File=(function(e){function e(e){if(e)for(let t=Object.keys(e),s=0;s<t.length;++s)null!=e[t[s]]&&(this[t[s]]=e[t[s]])}return e.prototype.actionSurface="",e.prototype.eventClass=0,e.prototype.eventState=0,e.prototype.errorCode=0,e.prototype.startTime=0,e.prototype.cancelTime=0,e.prototype.totalUploadTimeMs=0,e.prototype.fileType=0,e.prototype.fileSize=0,e.prototype.uploadMethod="",e.prototype.fileSystemWarning="",e.prototype.errorMessage="",e.prototype.extension="",e.prototype.actionSource="",e.prototype.actionScreen="",e.prototype.actionElement="",e.create=function(t){return new e(t)},e.getTypeUrl=function(){return"type.googleapis.com/pap_events.manual_upload.Upload_File"},e.EventClass=(function(){const e={},t=Object.create(e);return t[e[0]="MANUAL_UPLOAD"]=0,t})(),e.FileType=(function(){const e={},t=Object.create(e);return t[e[0]="UNKNOWN_FILE_TYPE"]=0,t[e[1]="DOCX_FILE_TYPE"]=1,t[e[2]="PDF_FILE_TYPE"]=2,t[e[3]="XLS_FILE_TYPE"]=3,t[e[4]="JPG_FILE_TYPE"]=4,t[e[5]="PNG_FILE_TYPE"]=5,t[e[6]="HEIC_FILE_TYPE"]=6,t[e[7]="MP4_FILE_TYPE"]=7,t[e[8]="MOV_FILE_TYPE"]=8,t[e[9]="TXT_FILE_TYPE"]=9,t[e[10]="MP3_FILE_TYPE"]=10,t[e[11]="M4A_FILE_TYPE"]=11,t[e[12]="WEBP_FILE_TYPE"]=12,t[e[13]="XLSX_FILE_TYPE"]=13,t[e[14]="PAGES_FILE_TYPE"]=14,t[e[15]="ZIP_FILE_TYPE"]=15,t[e[16]="GIF_FILE_TYPE"]=16,t[e[17]="URL_FILE_TYPE"]=17,t[e[18]="NUMBERS_FILE_TYPE"]=18,t[e[19]="WAV_FILE_TYPE"]=19,t[e[20]="EPUB_FILE_TYPE"]=20,t[e[21]="DNG_FILE_TYPE"]=21,t[e[22]="OPUS_FILE_TYPE"]=22,t[e[23]="CR2_FILE_TYPE"]=23,t[e[24]="ARW_FILE_TYPE"]=24,t[e[25]="PPTX_FILE_TYPE"]=25,t[e[26]="PSD_FILE_TYPE"]=26,t[e[27]="DOC_FILE_TYPE"]=27,t[e[28]="AMR_FILE_TYPE"]=28,t[e[29]="CSV_FILE_TYPE"]=29,t[e[30]="CLIP_FILE_TYPE"]=30,t[e[31]="NEF_FILE_TYPE"]=31,t[e[32]="KDBX_FILE_TYPE"]=32,t[e[33]="TIFF_FILE_TYPE"]=33,t[e[34]="SVG_FILE_TYPE"]=34,t[e[35]="APK_FILE_TYPE"]=35,t[e[36]="KEY_FILE_TYPE"]=36,t[e[37]="GPX_FILE_TYPE"]=37,t[e[38]="AAC_FILE_TYPE"]=38,t[e[39]="PROCREATE_FILE_TYPE"]=39,t[e[40]="WEBM_FILE_TYPE"]=40,t[e[41]="TORRENT_FILE_TYPE"]=41,t[e[42]="IPV_FILE_TYPE"]=42,t[e[43]="CR3_FILE_TYPE"]=43,t[e[44]="HTML_FILE_TYPE"]=44,t[e[45]="XML_FILE_TYPE"]=45,t[e[46]="VCF_FILE_TYPE"]=46,t[e[47]="RAR_FILE_TYPE"]=47,t[e[48]="PVT_FILE_TYPE"]=48,t[e[49]="ODT_FILE_TYPE"]=49,t[e[50]="MD_FILE_TYPE"]=50,t[e[51]="WEB_FILE_TYPE"]=51,t[e[52]="GSLIDES_FILE_TYPE"]=52,t[e[53]="GDOC_FILE_TYPE"]=53,t[e[54]="GSHEET_FILE_TYPE"]=54,t[e[55]="BINDER_FILE_TYPE"]=55,t[e[56]="PAPERT_FILE_TYPE"]=56,t[e[57]="PAPER_FILE_TYPE"]=57,t[e[58]="WEBSITE_FILE_TYPE"]=58,t[e[59]="JPEG_FILE_TYPE"]=59,t[e[60]="JSON_FILE_TYPE"]=60,t})(),e})(a.Upload_File||{}),a),o.EventState=(function(){const e={},t=Object.create(e);return t[e[0]="UNKNOWN_EVENT_STATE"]=0,t[e[1]="START"]=1,t[e[2]="SUCCESS"]=2,t[e[3]="FAILED"]=3,t[e[4]="CANCELED"]=4,t})(),o)})),define("metaserver/static/js/browse/components/file_breadcrumb",["require","exports","tslib","react","dig-components/breadcrumb","js/filepath/filepath","metaserver/static/js/clean/viewer","metaserver/static/js/clean/browse_uri_interface","metaserver/static/js/pnm/utils"],(function(e,t,s,i,r,o,a,n,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FileBreadcrumb=void 0,i=s.__importStar(i),o=s.__importStar(o),t.FileBreadcrumb=i.memo(e=>{var{path:t,size:c,user:d,useFullPath:u,isForCurrentPath:_,setUrl:p}=e,m=s.__rest(e,["path","size","user","useFullPath","isForCurrentPath","setUrl"]);const h=o.normalize(t),f=a.Viewer.get_root_name(d),E=o.parent_dirs(h).reverse();return E.unshift(""),u&&""!==h&&E.push(h),i.createElement(r.Breadcrumb,Object.assign({size:c,isRootOverflow:!0},m),E.map((e,t)=>{const s=_&&t===E.length-1,a=s?void 0:(0,n.browse_uri_for_fq_path)(d,e).toString(),c=s?void 0:(function(e,t){return s=>{0===s.button&&(s.altKey||s.ctrlKey||s.metaKey||s.shiftKey)||(s.preventDefault(),t(e))}})(e,p);return i.createElement(r.Breadcrumb.Link,{key:o.filename(e,f),href:a,isCurrentPath:s,onClick:c,className:"file-breadcrumb-link"},(0,l.getDisplayedFilename)(o.filename(e,f)))}))}),t.FileBreadcrumb.displayName="FileBreadcrumb"})),define("metaserver/static/js/sync_everything/components/backup_breadcrumb",["require","exports","tslib","react","react-intl","dig-components/breadcrumb","js/filepath/filepath","metaserver/static/js/clean/browse_uri_interface","metaserver/static/js/pnm/utils","metaserver/static/js/core/browser","react-redux","metaserver/static/js/browse/data/selectors"],(function(e,t,s,i,r,o,a,n,l,c,d,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BackupBreadcrumb=void 0,i=s.__importStar(i),a=s.__importStar(a),c=s.__importStar(c),u=s.__importStar(u);const _="https://www.dropbox.com/backup/all?_source=breadcrumb";function p(e,t){return s=>{0===s.button&&(s.altKey||s.ctrlKey||s.metaKey||s.shiftKey)||(s.preventDefault(),t(e))}}t.BackupBreadcrumb=i.memo(e=>{var{basePath:t,path:m,size:h,user:f,useFullPath:E,isForCurrentPath:g,setUrl:y}=e,S=s.__rest(e,["basePath","path","size","user","useFullPath","isForCurrentPath","setUrl"]);const b=(0,d.useSelector)(u.backups);if(!t&&!(null!==b))return null;const v=t?a.normalize(a.parent_dir(t)):"",T=a.normalize(m).replace(v,""),I=a.parent_dirs(T).reverse().map(e=>v+e);return E&&""!==T&&I.push(v+T),i.createElement(o.Breadcrumb,Object.assign({size:h,isRootOverflow:!0},S),i.createElement(o.Breadcrumb.Link,{key:"breadcrumb-backup",href:_,isCurrentPath:!1,onClick:p(_,c.redirect),className:"file-breadcrumb-link"},i.createElement(r.FormattedMessage,{id:"96Ymix",defaultMessage:"Backups"})),I.map((e,t)=>{var s;const r=g&&t===I.length-1,c=r?void 0:(0,n.browse_uri_for_fq_path)(f,e).toString(),d=r?void 0:p(e,y),u=null===(s=null==b?void 0:b.find(t=>t.fqPath===e))||void 0===s?void 0:s.displayName;return i.createElement(o.Breadcrumb.Link,{key:a.filename(e),href:c,isCurrentPath:r,onClick:d,className:"file-breadcrumb-link","data-testid":"file-breadcrumb-link"},null!=u?u:(0,l.getDisplayedFilename)(a.filename(e)))}))}),t.BackupBreadcrumb.displayName="BackupBreadcrumb"})),define("metaserver/static/js/naming_conventions/types",["require","exports"],(function(e,t){"use strict";var s,i,r,o;Object.defineProperty(t,"__esModule",{value:!0}),t.WhenToShowError=t.ErrorType=t.dateFormatStrToEnum=t.ruleStrToEnum=t.TextDataState=t.LearnMoreLink=t.NamingConventionModal=t.NamingConventionOrigin=t.defaultNamingConventionParameters2WithSenderNameRule=t.defaultNamingConventionsParametersDataWithSenderNameRule=t.defaultNamingConventionParameters2=t.defaultNamingConventionsParametersData=t.emptyNamingConventionParameters=t.defaultNamingConventionParameters=t.ConsistentSeparatorSelection=t.FolderScopeOptions=t.DateFormatSelection=t.NamingConventionML=t.NamingConventionAutomation=t.NamingConventionType=t.APIRequestState=void 0,(function(e){e[e.IN_PROGRESS=0]="IN_PROGRESS",e[e.FAILED=1]="FAILED",e[e.SUCCEEDED=2]="SUCCEEDED"})(t.APIRequestState||(t.APIRequestState={})),(function(e){e.none="none",e.upload_date="upload_date",e.parent_folder_name="include_parent_folder_name",e.sender_name="sender_name",e.keyword="keyword",e.capture_date="capture_date",e.camera_make="camera_make",e.camera_model="camera_model",e.dimensions="dimensions",e.dots_per_inch="dots_per_inch",e.lens_model="lens_model",e.dots_per_cm="dots_per_cm",e.original_snippet="original_snippet",e.capitalize_all_initials="capitalize_all_initials",e.consistent_separators="change_all_separators",e.renaming_bar_enabled="renaming_bar_enabled"})(s=t.NamingConventionType||(t.NamingConventionType={})),t.NamingConventionAutomation="automation",t.NamingConventionML="ml",(function(e){e.yyyy_mm="yyyy_mm",e.yyyy_mm_dd="yyyy_mm_dd",e.yyyymmdd="yyyymmdd",e.yyyy_abbr_dd="yyyy_abbr_dd",e.yyyy_mm_hh_mm="yyyy_mm_hh_mm",e.yyyy_mm_dd_hh_mm="yyyy_mm_dd_hh_mm",e.yyyy_abbr_dd_hh_mm="yyyy_abbr_dd_hh_mm",e.yyyymmdd_hh_mm="yyyymmdd_hh_mm"})(i=t.DateFormatSelection||(t.DateFormatSelection={})),(function(e){e.THIS_FOLDER_ONLY="this_folder_only",e.THIS_FOLDER_AND_SUBFOLDERS="this_folder_and_subfolders"})(r=t.FolderScopeOptions||(t.FolderScopeOptions={})),(function(e){e.spaces="spaces",e.dashes="dashes",e.underscores="underscores"})(o=t.ConsistentSeparatorSelection||(t.ConsistentSeparatorSelection={})),t.defaultNamingConventionParameters={selectedRules:[s.upload_date],dateFormatSelection:i.yyyy_mm_dd,consistentSeparatorSelection:o.spaces,mlFilenameParsing:!1,data:{keyword:""},subfolderOption:r.THIS_FOLDER_ONLY},t.emptyNamingConventionParameters={selectedRules:[],dateFormatSelection:i.yyyy_mm_dd,consistentSeparatorSelection:o.spaces,mlFilenameParsing:!1,data:{keyword:""},subfolderOption:r.THIS_FOLDER_ONLY},t.defaultNamingConventionsParametersData={dateInfo:[{mlFilenameParsing:!1,dateFormatSelection:i.yyyy_mm_dd},{mlFilenameParsing:!1,dateFormatSelection:i.yyyy_mm_dd}],consistentSeparatorSelection:o.spaces,keywords:["",""]},t.defaultNamingConventionParameters2={componentList:[s.none,s.original_snippet],capitalizeAllInitials:!1,changeAllSeparators:!1,renamingBarEnabled:!0,data:t.defaultNamingConventionsParametersData,subfolderOption:r.THIS_FOLDER_ONLY},t.defaultNamingConventionsParametersDataWithSenderNameRule={dateInfo:[{mlFilenameParsing:!1,dateFormatSelection:i.yyyy_mm_dd},{mlFilenameParsing:!1,dateFormatSelection:i.yyyy_mm_dd}],consistentSeparatorSelection:o.spaces,keywords:["",""]},t.defaultNamingConventionParameters2WithSenderNameRule={componentList:[s.original_snippet,s.sender_name],capitalizeAllInitials:!1,changeAllSeparators:!1,renamingBarEnabled:!0,data:t.defaultNamingConventionsParametersDataWithSenderNameRule,subfolderOption:r.THIS_FOLDER_ONLY},(function(e){e.from_desktop="from_desktop",e.from_menu="from_menu",e.from_upload_snackbar="from_upload_snackbar",e.from_rename_snackbar="from_rename_snackbar",e.from_reengagement_open_snackbar="from_reengagement_open_snackbar",e.from_discovery_open_snackbar="from_discovery_open_snackbar",e.from_reengagement_upload_snackbar="from_reengagement_upload_snackbar",e.from_discovery_upload_snackbar="from_discovery_upload_snackbar",e.from_reengagement_rename_snackbar="from_reengagement_rename_snackbar",e.from_discovery_rename_snackbar="from_discovery_rename_snackbar",e.from_file_request="from_file_request",e.from_automation="from_automation",e.from_heuristic_renaming_bar="from_heuristic_renaming_bar",e.from_existing_nc_renaming_bar="from_existing_nc_renaming_bar",e.from_upload_renaming_bar="from_upload_renaming_bar",e.from_desktop_organized_home="from_desktop_organized_home",e.from_web_organized_menu="from_web_organized_menu",e.from_in_folder_activation="from_in_folder_activation",e.from_unknown_nc_origin="from_unknown_nc_origin"})(t.NamingConventionOrigin||(t.NamingConventionOrigin={})),(function(e){e.rule_selection_page="rule_selection_page",e.automation_change_warning_page="automation_change_warning_page",e.automation_delete_warning_page="automation_delete_warning_page"})(t.NamingConventionModal||(t.NamingConventionModal={})),(function(e){e.ml="https://help.dropbox.com/en-us/files-folders/sort-preview/naming-conventions"})(t.LearnMoreLink||(t.LearnMoreLink={})),(function(e){e.empty="empty",e.invalid="invalid",e.valid="valid",e.lengthError="lengthError"})(t.TextDataState||(t.TextDataState={})),t.ruleStrToEnum=new Map([["upload_date",s.upload_date],["include_parent_folder_name",s.parent_folder_name],["sender_name",s.sender_name],["keyword",s.keyword],["capture_date",s.capture_date],["camera_make",s.camera_make],["camera_model",s.camera_model],["dimensions",s.dimensions],["dots_per_inch",s.dots_per_inch],["lens_model",s.lens_model],["dots_per_cm",s.dots_per_cm],["renaming_bar_enabled",s.renaming_bar_enabled]]),t.dateFormatStrToEnum=new Map([["yyyy_mm",i.yyyy_mm],["yyyy_mm_dd",i.yyyy_mm_dd],["yyyy_abbr_dd",i.yyyy_abbr_dd],["yyyymmdd",i.yyyymmdd],["yyyy_mm_hh_mm",i.yyyy_mm_hh_mm],["yyyy_mm_dd_hh_mm",i.yyyy_mm_dd_hh_mm],["yyyy_abbr_dd_hh_mm",i.yyyy_abbr_dd_hh_mm],["yyyymmdd_hh_mm",i.yyyymmdd_hh_mm]]),(function(e){e[e.TEXT_ERROR=0]="TEXT_ERROR",e[e.RULE_ERROR=1]="RULE_ERROR"})(t.ErrorType||(t.ErrorType={})),(function(e){e[e.IMMEDIATELY=0]="IMMEDIATELY",e[e.WHEN_BUTTON_CLICKED=1]="WHEN_BUTTON_CLICKED"})(t.WhenToShowError||(t.WhenToShowError={}))})),define("metaserver/static/js/business_space/api/internal_client",["require","exports","metaserver/static/js/api_v2/default_user_client"],(function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BusinessSpaceClient=void 0;t.BusinessSpaceClient=class{constructor(e){this.apiV2Client=new s.DefaultUserApiV2Client(e)}create_file_request(e,t){const s={title:t,destination:e};return this.apiV2Client.ns("file_requests").rpc("create",s,{})}enable_client_upload(e,t){const s={business_space_xgid:e,file_request_id:t};return this.apiV2Client.ns("business_space").rpc("uploads/enable_client_upload",s,{})}disable_client_upload(e){const t={business_space_xgid:e};return this.apiV2Client.ns("business_space").rpc("uploads/disable_client_upload",t,{})}upload_status_by_xgid(e){const t={business_space_xgid:e};return this.apiV2Client.ns("business_space").rpc("uploads/uploads_status_by_xgid",t,{})}browse_find(e="/"){const t={full_path:e};return this.apiV2Client.ns("business_space").rpc("browse/find",t,{})}create_business_space(e,t){const s={name:e,full_path:t};return this.apiV2Client.ns("business_space").rpc("create_business_space",s,{})}delete_business_space(e,t=!1){const s={business_space_xgid:e,skip_if_active:t};return this.apiV2Client.ns("business_space").rpc("delete",s,{})}get_loginless_link(e){const t={business_space_xgid:e};return this.apiV2Client.ns("business_space").rpc("get_loginless_link",t,{})}recreate_loginless_link(e,t){const s={business_space_xgid:e,space_xid:t};return this.apiV2Client.ns("business_space").rpc("recreate_loginless_link",s,{})}get_objects_visibility(e="",t={".tag":"unknown_object_visibility_type"},s=[]){const i={business_space_xgid:e,parent_visibility:t,full_paths:s};return this.apiV2Client.ns("business_space").rpc("browse/get_objects_visibility",i,{})}update_object_visibility(e,t,s){const i={business_space_xgid:e,shared_object:{identifier:{".tag":"fq_path",fq_path:t}},is_shared:s};return this.apiV2Client.ns("business_space").rpc("update_object_visibility",i,{})}delete_check(e){const t={async_job_id:e};return this.apiV2Client.ns("business_space").rpc("delete/check",t,{})}update_object_visibility_check(e){const t={async_job_id:e};return this.apiV2Client.ns("business_space").rpc("update_object_visibility/check",t,{})}}})),define("metaserver/static/js/plusplus/file_actions",["require","exports","tslib","metaserver/static/js/pnm/constants","metaserver/static/js/pnm/utils","metaserver/static/js/plusplus/constants","metaserver/static/js/core/browser"],(function(e,t,s,i,r,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getLinkNodeEventObject=t.handleLinkNodeAction=t.openPasswords=void 0,a=s.__importStar(a);t.openPasswords=()=>{a.redirect(o.PASSWORDS_POST_SETUP_URL)};t.handleLinkNodeAction=(o,a)=>s.__awaiter(void 0,void 0,void 0,(function*(){const{openBackupsModal:n,setupPasswords:l,setupVault:c}=yield new Promise((t,s)=>{e(["metaserver/static/js/plusplus/setup_actions"],t,s)}).then(s.__importStar);switch((0,r.getLinkNodeAction)(o)){case i.BACKUP_PRE_SETUP_ACTION:null==a||a("backup_set_up"),n();break;case i.PASSWORDS_PRE_SETUP_ACTION:null==a||a("passwords_set_up"),l();break;case i.PASSWORDS_POST_SETUP_ACTION:null==a||a("passwords_open"),(0,t.openPasswords)();break;case i.VAULT_PRE_SETUP_ACTION:null==a||a("vault_set_up"),c()}})),t.getLinkNodeEventObject=function(e){switch((0,r.getLinkNodeAction)()){case i.BACKUP_PRE_SETUP_ACTION:return"backup_set_up";case i.PASSWORDS_PRE_SETUP_ACTION:return"passwords_set_up";case i.PASSWORDS_POST_SETUP_ACTION:return"passwords_open";case i.VAULT_PRE_SETUP_ACTION:return"vault_set_up"}return null}})),define("metaserver/static/js/browse/naming_conventions_actions",["require","exports","tslib","react","metaserver/static/js/clean/ui/snackbar","metaserver/static/js/core/i18n","metaserver/static/js/clean/web_user_action_logger","metaserver/static/js/clean/web_user_action_events","metaserver/static/js/browse/data/selectors","metaserver/static/js/browse/data/store","react-intl","metaserver/static/js/browse/data/action_creators/index","metaserver/static/js/naming_conventions/types","metaserver/static/js/growth/ui/rich_snackbar_actions/types"],(function(e,t,s,i,r,o,a,n,l,c,d,u,_,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.openNamingConventionsModal=t.showSnackbar=t.promptNamingConventions=t.snackbarCloseActionButtonText=t.snackbarActionButtonText=t.snackbarId=t.millisecondSnackbarTimeout=void 0,i=s.__importDefault(i),l=s.__importStar(l),u=s.__importStar(u),t.millisecondSnackbarTimeout=1e4,t.snackbarId="naming-conventions-feature-growth",t.snackbarActionButtonText=o.intl.formatMessage({id:"ghdSnP",defaultMessage:"Show me"}),t.snackbarCloseActionButtonText=o.intl.formatMessage({id:"3ps1+a",defaultMessage:"Dismiss"}),t.promptNamingConventions=function(i,r,o){return s.__awaiter(this,void 0,void 0,(function*(){const{shouldShowSnackbar:d,snackbarDismissed:u}=yield new Promise((t,s)=>{e(["metaserver/static/js/naming_conventions/api_v2"],t,s)}).then(s.__importStar),m={".tag":"date_open",source_path:r},E=yield d(i,m),g=E.should_show,y=E.snackbar_type;if(!g)return!1;const S=(0,c.getStoreForBrowse)().getState();if(l.path(S)===r){let e,s;const c=y&&"reengagement"===y[".tag"];c&&l.uploaderPostTTIExperiments(S).expNamingConventionsReengagement?(e=f,s=_.NamingConventionOrigin.from_reengagement_open_snackbar):(e=h,s=_.NamingConventionOrigin.from_discovery_open_snackbar),a.WebUserActionLog.log(i,n.WebUserActionLogEvent.FEATURE_DISCOVERY_SNACKBAR_SHOW,{ns_id:o,trigger:"folder_open_with_dates",feature:"naming_conventions",origin:c?p.FeatureGrowthOrigin.reengagement:p.FeatureGrowthOrigin.discovery});const d=()=>(0,t.openNamingConventionsModal)(r,i,o,s),m=()=>u(i);return(0,t.showSnackbar)(d,m,e),!0}return!1}))};const m=(0,d.defineMessages)({DEFAULT:{id:"MsPjEI",defaultMessage:"This folder has some files with dates in them. Did you know you can set up naming conventions in Dropbox?"},REENGAGEMENT:{id:"fy5RJ8",defaultMessage:"We updated naming conventions with new customizable rules and richer metadata options."}}),h=o.intl.formatMessage(m.DEFAULT),f=o.intl.formatMessage(m.REENGAGEMENT);t.showSnackbar=(e,s,o)=>{r.Snackbar.show(i.default.createElement(r.Snackbar,{actionButtonText:t.snackbarActionButtonText,onActionClick:e,closeButtonText:t.snackbarCloseActionButtonText,onCloseClick:s,timeoutDelayMs:t.millisecondSnackbarTimeout,title:o,variant:"complete",id:t.snackbarId}))};t.openNamingConventionsModal=(i,o,d,_)=>{r.Snackbar.close(t.snackbarId);const p=(0,c.getStoreForBrowse)(),m=p.getState(),{expNamingConventionsPositioning:h}=l.browsePostTTIExperiments(m);l.path(m)!==i&&p.dispatch(u.setUrl({path:i})),a.WebUserActionLog.log(o,n.WebUserActionLogEvent.NAMING_CONVENTIONS_OPEN_MODAL,{ns_id:d,origin:_,positioning:h?1:0}),new Promise((t,s)=>{e(["metaserver/static/js/naming_conventions/naming_conventions_modal"],t,s)}).then(s.__importStar).then(({showNamingConventionsModal:e})=>e({currentUserId:o,targetPath:i,namespaceId:d,origin:_}))}})),define("metaserver/static/js/browse/tidy_up_actions",["require","exports","tslib","react","metaserver/static/js/clean/ui/snackbar","metaserver/static/js/core/i18n","metaserver/static/js/tidy_up/modal/tidy_strings","metaserver/static/js/tidy_up/utils","metaserver/static/js/tidy_up/constants"],(function(e,t,s,i,r,o,a,n,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.promptTidyUp=t.snackbarCloseActionButtonText=t.snackbarActionButtonText=t.snackbarId=t.millisecondSnackbarTimeout=void 0,i=s.__importDefault(i);t.millisecondSnackbarTimeout=1e4,t.snackbarId="tidyup-feature-growth",t.snackbarActionButtonText=o.intl.formatMessage({id:"V4/4Hh",defaultMessage:"Open Organize"}),t.snackbarCloseActionButtonText=o.intl.formatMessage({id:"cK/p7/",defaultMessage:"Dismiss"}),t.promptTidyUp=function(t,i,r,o){return s.__awaiter(this,void 0,void 0,(function*(){const{dismissSnackbar:a,getNumAddedFilesAndFolders:n,shouldShowSnackbar:d,shouldShowUploadSnackbar:u}=yield new Promise((t,s)=>{e(["metaserver/static/js/tidy_up/api_v2"],t,s)}).then(s.__importStar),{openTidyUpModal:_}=yield new Promise((t,s)=>{e(["metaserver/static/js/tidy_up/feature_growth"],t,s)}).then(s.__importStar),{TidySpecificActionSurfaceLogValue:p}=yield new Promise((t,s)=>{e(["metaserver/static/js/tidy_up/modal/types"],t,s)}).then(s.__importStar);let m,h=!1;if(o){const e=yield u(t,i);h=e.should_show,e.snackbar_type&&(m=e.snackbar_type[".tag"])}else{const e=yield d(t),s=yield n(t,i);e&&(s.num_added_files>=5||s.num_added_folders>=2)&&(m=l.FEATURE_GROWTH_SNACKBARS.discovery,h=!0)}const f=m===l.FEATURE_GROWTH_SNACKBARS.discovery?p.DISCOVERY_UPLOAD_SNACKBAR:p.REENGAGEMENT_UPLOAD_SNACKBAR;if(!h)return!1;return c(t,r,()=>_(i,t,r,f),()=>a(t),m),!0}))};const c=(e,c,d,u,_)=>s.__awaiter(void 0,void 0,void 0,(function*(){let s;_===l.FEATURE_GROWTH_SNACKBARS.discovery?(s=o.intl.formatMessage(a.TIDY_FEATURE_GROWTH_STRINGS.DISCOVERY_TITLE),(0,n.logTidyUpDiscoverySnackbar)(e,c,"bulk_upload")):_===l.FEATURE_GROWTH_SNACKBARS.reengagement&&(s=o.intl.formatMessage(a.TIDY_FEATURE_GROWTH_STRINGS.REENGAGEMENT_TITLE),(0,n.logTidyUpReengagementSnackbar)(e,c,"bulk_upload")),r.Snackbar.show(i.default.createElement(r.Snackbar,{actionButtonText:t.snackbarActionButtonText,onActionClick:d,closeButtonText:t.snackbarCloseActionButtonText,onCloseClick:u,timeoutDelayMs:t.millisecondSnackbarTimeout,title:s,variant:"generic",id:t.snackbarId}))}))})),define("metaserver/static/js/file_uploader/upload_hybrid_scheduler",["require","exports","tslib","metaserver/static/js/upload_kit/scheduler/types","metaserver/static/js/file_uploader/utils"],(function(e,t,s,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FileChunkReader=t.UploadHybridScheduler=t.CHUNK_SIZE=t.MAX_FINISH_BATCH_SIZE=t.MAX_LEGACY_COMMIT_BATCH_SIZE=t.MAX_PARALLEL_FINISH_REQUESTS=t.MAX_PARALLEL_BLOCK_UPLOAD_REQUESTS=void 0,t.MAX_PARALLEL_BLOCK_UPLOAD_REQUESTS=6,t.MAX_PARALLEL_FINISH_REQUESTS=1,t.MAX_LEGACY_COMMIT_BATCH_SIZE=100,t.MAX_FINISH_BATCH_SIZE=1e3,t.CHUNK_SIZE=4194304;class o extends i.UploadHybridScheduler{constructor(e){super(e),this.itemQueue=new Map,this.commitQueue=[],this.availableBlockRequests=t.MAX_PARALLEL_BLOCK_UPLOAD_REQUESTS,this.availableFinishRequests=t.MAX_PARALLEL_FINISH_REQUESTS,this.onCompleteSubscribers=[],this.handleUploadBlocks=e.handleUploadBlocks,this.handleCommitBlocks=e.handleCommitBlocks,this.handleAppend=e.handleAppend,this.handleFinish=e.handleFinish,this.handleProgress=e.handleProgress,this.handleItemExit=e.handleItemExit,this.currentItemState=null}itemExit(e,t){const s=this.itemQueue.get(e);s&&(s.status=t,this.itemQueue.delete(e),this.handleItemExit(s.info,t))}dispenseChunkData(){if(null===this.currentItemState||this.currentItemState.fileChunkReader.isEmpty()||!this.isItemUploading(this.currentItemState.item.destPath)){const e=Array.from(this.itemQueue.values()).find(e=>"Queued"===e.status&&e.file.size>0);if(!e)return null;const t=(0,r.shouldUseSessionUploadForFile)(e.file.size)?4:1;this.currentItemState={item:e,fileChunkReader:new a(e.file,t)},e.status="Uploading"}const e=this.currentItemState.fileChunkReader.getNextChunks();if(!e)return null;const s=this.currentItemState.item,i=s.blockIndex;return s.blockIndex+=Math.ceil(e.size/t.CHUNK_SIZE),{item:s,chunk:e,blockIndex:i}}commitLegacyItems(e){return s.__awaiter(this,void 0,void 0,(function*(){const t=[],s=[];e.forEach(e=>{const{info:i,destPath:r,blockTokens:o}=e;o&&t.push({info:i,tokens:o}),s.push(r)});try{(yield this.handleCommitBlocks(t)).forEach(e=>{this.itemExit(e.filePath,e.success?"Completed":"Error")})}catch(e){s.forEach(e=>{this.itemExit(e,"Error")})}}))}finishApiV2Items(e){return s.__awaiter(this,void 0,void 0,(function*(){const t=[],s=[];e.forEach(e=>{const{info:i,destPath:r}=e;t.push({info:i}),s.push(r)});try{(yield this.handleFinish(t)).forEach(e=>{this.itemExit(e.filePath,e.success?"Completed":"Error")})}catch(e){s.forEach(e=>{this.itemExit(e,"Error")})}}))}commitNext(){return s.__awaiter(this,void 0,void 0,(function*(){if(0===this.availableFinishRequests)return;if(0===this.commitQueue.length)return void(this.isUploading()||this.fireComplete());this.availableFinishRequests--;const e=[];this.commitQueue.forEach(t=>{const s=this.itemQueue.get(t);s&&e.push(s)});const s=e.filter(e=>!(0,r.shouldUseSessionUploadForFile)(e.file.size)).slice(0,t.MAX_LEGACY_COMMIT_BATCH_SIZE),i=e.filter(e=>(0,r.shouldUseSessionUploadForFile)(e.file.size)).slice(0,t.MAX_FINISH_BATCH_SIZE);s.forEach(e=>{const t=this.commitQueue.indexOf(e.destPath);this.commitQueue.splice(t)}),i.forEach(e=>{const t=this.commitQueue.indexOf(e.destPath);this.commitQueue.splice(t)});const o=s.length>0?this.commitLegacyItems(s):void 0,a=i.length>0?this.finishApiV2Items(i):void 0;yield Promise.all([o,a]),this.availableFinishRequests++,this.commitNext()}))}queueCommit(e){this.commitQueue.push(e),this.commitNext()}uploadNextBlock(){return s.__awaiter(this,void 0,void 0,(function*(){if(this.availableBlockRequests<=0)return;const e=this.dispenseChunkData();if(!e)return void(this.isUploading()||this.fireComplete());const{item:t,chunk:s,blockIndex:i}=e;let o=0;const a=e=>{if(this.isItemUploading(t.destPath)){const i=Math.min(s.size,t.file.size),r=Math.min(e,i),a=Math.max(r-o,0);o+=a;const n=Math.min(t.visualBytesUploaded+a,t.file.size);t.visualBytesUploaded=n,this.handleProgress(t.info,n)}};this.availableBlockRequests--;try{let e;(0,r.shouldUseSessionUploadForFile)(t.file.size)?yield this.handleAppend(t.info,s,i,a):e=yield this.handleUploadBlocks(t.info,s,a),t.confirmedBytesUploaded+=s.size,this.isItemUploading(t.destPath)&&(e&&t.blockTokens&&(t.blockTokens[i]=e),n(t)&&(t.status="Committing",this.queueCommit(t.destPath)))}catch(e){this.itemExit(t.destPath,"Error")}this.availableBlockRequests++,this.uploadNextBlock()}))}addFile(e,t,i){return s.__awaiter(this,void 0,void 0,(function*(){this.itemQueue.set(t,{file:e,destPath:t,status:"Queued",bytesUploaded:0,info:i,visualBytesUploaded:0,confirmedBytesUploaded:0,blockIndex:0,blockTokens:[]}),this.isUploading()&&this.startUploading()}))}startUploading(){return s.__awaiter(this,void 0,void 0,(function*(){const e=this.onComplete(),t=this.availableBlockRequests;for(let e=0;e<t;e++)this.uploadNextBlock();return e}))}cancelFile(e){return s.__awaiter(this,void 0,void 0,(function*(){const t=this.itemQueue.get(e);t&&!n(t)&&this.itemExit(e,"Cancelled")}))}stopUploading(){this.itemQueue.forEach(({destPath:e})=>{this.cancelFile(e)})}isQueueEmpty(){return 0===this.itemQueue.size}isItemUploading(e){const t=this.itemQueue.get(e);return Boolean(t&&"Uploading"===t.status)}isUploading(){return this.availableBlockRequests<t.MAX_PARALLEL_BLOCK_UPLOAD_REQUESTS||this.availableFinishRequests<t.MAX_PARALLEL_FINISH_REQUESTS}fireComplete(){for(;this.onCompleteSubscribers.length>0;){const e=this.onCompleteSubscribers.shift();e&&e()}}onComplete(){return new Promise(e=>{this.onCompleteSubscribers.push(e)})}}t.UploadHybridScheduler=o;class a{constructor(e,t){this.currentOffset=0,this.file=e,this.chunkCount=t}getNextChunks(){const e=this.file.size-this.currentOffset;if(e<=0)return null;const s=Math.floor(e/t.CHUNK_SIZE);let i;i=s<1?e:s<this.chunkCount?s*t.CHUNK_SIZE:this.chunkCount*t.CHUNK_SIZE;const r=this.file.slice(this.currentOffset,i+this.currentOffset);return this.currentOffset+=i,r}isEmpty(){return this.file.size<=this.currentOffset}}t.FileChunkReader=a;const n=({confirmedBytesUploaded:e,file:t})=>e>=t.size})),define("metaserver/static/js/file_uploader/upload_session_scheduler",["require","exports","tslib","metaserver/static/js/upload_kit/scheduler/types","metaserver/static/js/modules/constants/global_file_upload"],(function(e,t,s,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FileChunkReader=t.UploadSessionScheduler=t.CHUNK_SIZE=t.COMMIT_REQUEST_BATCH_SIZE=t.MAX_PARALLEL_FINISH_REQUESTS=t.MAX_PARALLEL_BLOCK_UPLOAD_REQUESTS=void 0,t.MAX_PARALLEL_BLOCK_UPLOAD_REQUESTS=6,t.MAX_PARALLEL_FINISH_REQUESTS=1,t.COMMIT_REQUEST_BATCH_SIZE=100,t.CHUNK_SIZE=4194304;const o=parseInt(r.UPLOAD_CHUNK_COUNT)||1;class a extends i.UploadSessionScheduler{constructor(e){super(e),this.itemQueue=new Map,this.commitQueue=[],this.availableBlockRequests=t.MAX_PARALLEL_BLOCK_UPLOAD_REQUESTS,this.availableFinishRequests=t.MAX_PARALLEL_FINISH_REQUESTS,this.onCompleteSubscribers=[],this.handleAppend=e.handleAppend,this.handleFinish=e.handleFinish,this.handleProgress=e.handleProgress,this.handleItemExit=e.handleItemExit,this.currentItemState=null}itemExit(e,t){const s=this.itemQueue.get(e);s&&(s.status=t,this.itemQueue.delete(e),this.handleItemExit(s.info,t))}dispenseChunkData(){if(null===this.currentItemState||this.currentItemState.fileChunkReader.isEmpty()||!this.isItemUploading(this.currentItemState.item.destPath)){const e=Array.from(this.itemQueue.values()).find(e=>"Queued"===e.status&&e.file.size>0);if(!e)return null;this.currentItemState={item:e,fileChunkReader:new n(e.file,o)},e.status="Uploading"}const e=this.currentItemState.fileChunkReader.getNextChunks();if(!e)return null;const s=this.currentItemState.item,i=s.blockIndex;return s.blockIndex+=Math.ceil(e.size/t.CHUNK_SIZE),{item:s,chunk:e,blockIndex:i}}commitNext(){return s.__awaiter(this,void 0,void 0,(function*(){if(0===this.availableFinishRequests)return;if(0===this.commitQueue.length)return void(this.isUploading()||this.fireComplete());this.availableFinishRequests--;const e=[],s=[];let i=t.COMMIT_REQUEST_BATCH_SIZE;for(;i>0&&this.commitQueue.length>0;){const t=this.commitQueue.shift(),r=this.itemQueue.get(t);if(!r)continue;const{info:o,destPath:a}=r;e.push({info:o}),s.push(a),i--}try{(yield this.handleFinish(e)).forEach(e=>{this.itemExit(e.filePath,e.success?"Completed":"Error")})}catch(e){s.forEach(e=>{this.itemExit(e,"Error")})}this.availableFinishRequests++,this.commitNext()}))}queueCommit(e){this.commitQueue.push(e),this.commitNext()}uploadNextBlock(){return s.__awaiter(this,void 0,void 0,(function*(){if(this.availableBlockRequests<=0)return;const e=this.dispenseChunkData();if(!e)return void(this.isUploading()||this.fireComplete());const{item:t,chunk:s,blockIndex:i}=e;let r=0;const o=e=>{if(this.isItemUploading(t.destPath)){const i=Math.min(s.size,t.file.size),o=Math.min(e,i),a=Math.max(o-r,0);r+=a;const n=Math.min(t.visualBytesUploaded+a,t.file.size);t.visualBytesUploaded=n,this.handleProgress(t.info,n)}};this.availableBlockRequests--;try{yield this.handleAppend(t.info,s,i,o),t.confirmedBytesUploaded+=s.size,this.isItemUploading(t.destPath)&&(o(s.size),l(t)&&(t.status="Committing",this.queueCommit(t.destPath)))}catch(e){this.itemExit(t.destPath,"Error")}this.availableBlockRequests++,this.uploadNextBlock()}))}addFile(e,t,i){return s.__awaiter(this,void 0,void 0,(function*(){this.itemQueue.set(t,{file:e,destPath:t,status:"Queued",bytesUploaded:0,info:i,visualBytesUploaded:0,confirmedBytesUploaded:0,blockIndex:0}),this.isUploading()&&this.startUploading()}))}startUploading(){return s.__awaiter(this,void 0,void 0,(function*(){const e=this.onComplete(),t=this.availableBlockRequests;for(let e=0;e<t;e++)this.uploadNextBlock();return e}))}cancelFile(e){return s.__awaiter(this,void 0,void 0,(function*(){const t=this.itemQueue.get(e);t&&!l(t)&&this.itemExit(e,"Cancelled")}))}stopUploading(){this.itemQueue.forEach(({destPath:e})=>{this.cancelFile(e)})}isQueueEmpty(){return 0===this.itemQueue.size}isItemUploading(e){const t=this.itemQueue.get(e);return Boolean(t&&"Uploading"===t.status)}isUploading(){return this.availableBlockRequests<t.MAX_PARALLEL_BLOCK_UPLOAD_REQUESTS||this.availableFinishRequests<t.MAX_PARALLEL_FINISH_REQUESTS}fireComplete(){for(;this.onCompleteSubscribers.length>0;){const e=this.onCompleteSubscribers.shift();e&&e()}}onComplete(){return new Promise(e=>{this.onCompleteSubscribers.push(e)})}}t.UploadSessionScheduler=a;class n{constructor(e,t){this.currentOffset=0,this.file=e,this.chunkCount=t}getNextChunks(){const e=this.file.size-this.currentOffset;if(e<=0)return null;const s=Math.floor(e/t.CHUNK_SIZE);let i;i=s<1?e:s<this.chunkCount?s*t.CHUNK_SIZE:this.chunkCount*t.CHUNK_SIZE;const r=this.file.slice(this.currentOffset,i+this.currentOffset);return this.currentOffset+=i,r}isEmpty(){return this.file.size<=this.currentOffset}}t.FileChunkReader=n;const l=({confirmedBytesUploaded:e,file:t})=>e>=t.size})),define("metaserver/static/js/file_uploader/parallel_scheduler_with_batch_commit",["require","exports","tslib","metaserver/static/js/upload_kit/scheduler/types"],(function(e,t,s,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ParallelUploadSchedulerWithBatchCommit=t.CHUNK_SIZE=t.COMMIT_REQUEST_BATCH_SIZE=t.MAX_PARALLEL_COMMIT_REQUESTS=t.MAX_PARALLEL_BLOCK_UPLOAD_REQUESTS=void 0,t.MAX_PARALLEL_BLOCK_UPLOAD_REQUESTS=8,t.MAX_PARALLEL_COMMIT_REQUESTS=1,t.COMMIT_REQUEST_BATCH_SIZE=100,t.CHUNK_SIZE=4194304;class r extends i.UploadScheduler{constructor(e){super(e),this.itemQueue=new Map,this.commitQueue=[],this.availableBlockRequests=t.MAX_PARALLEL_BLOCK_UPLOAD_REQUESTS,this.availableCommitRequests=t.MAX_PARALLEL_COMMIT_REQUESTS,this.onCompleteSubscribers=[],this.handleUploadBlocks=e.handleUploadBlocks,this.handleCommitBlocks=e.handleCommitBlocks,this.handleProgress=e.handleProgress,this.handleItemExit=e.handleItemExit}itemExit(e,t){const s=this.itemQueue.get(e);s&&(s.status=t,this.itemQueue.delete(e),this.handleItemExit(s.info,t))}dispenseChunkData(){if(!this.currentFileChunkReader||this.currentFileChunkReader.isEmpty()||!this.isItemUploading(this.currentFileChunkReader.item.destPath)){const e=Array.from(this.itemQueue.values()).find(e=>"Queued"===e.status&&e.file.size>0);if(!e)return null;this.currentFileChunkReader=new o(e),e.status="Uploading"}const e=this.currentFileChunkReader.getNextChunk();if(!e)return null;const t=this.currentFileChunkReader.item,s=t.blockTokens.length;return t.blockTokens.push(""),{item:t,chunk:e,blockIndex:s}}commitNext(){return s.__awaiter(this,void 0,void 0,(function*(){if(0===this.availableCommitRequests)return;if(0===this.commitQueue.length)return void(this.isUploading()||this.fireComplete());this.availableCommitRequests--;const e=[],s=[];let i=t.COMMIT_REQUEST_BATCH_SIZE;for(;i>0&&this.commitQueue.length>0;){const t=this.commitQueue.shift(),r=this.itemQueue.get(t);if(!r)continue;const{info:o,blockTokens:a,destPath:n}=r;e.push({info:o,tokens:a}),s.push(n),i--}try{(yield this.handleCommitBlocks(e)).forEach(e=>{this.itemExit(e.filePath,e.success?"Completed":"Error")})}catch(e){s.forEach(e=>{this.itemExit(e,"Error")})}this.availableCommitRequests++,this.commitNext()}))}queueCommit(e){this.commitQueue.push(e),this.commitNext()}uploadNextBlock(){return s.__awaiter(this,void 0,void 0,(function*(){if(this.availableBlockRequests<=0)return;const e=this.dispenseChunkData();if(!e)return void(this.isUploading()||this.fireComplete());const{item:t,chunk:s,blockIndex:i}=e;let r=0;const o=e=>{if(this.isItemUploading(t.destPath)){const i=Math.min(s.size,t.file.size),o=Math.min(e,i),a=Math.max(o-r,0);r+=a;const n=Math.min(t.totalBytesUploaded+a,t.file.size);t.totalBytesUploaded=n,this.handleProgress(t.info,n)}};this.availableBlockRequests--;try{const e=yield this.handleUploadBlocks(t.info,s,o);this.isItemUploading(t.destPath)&&(o(s.size),t.blockTokens[i]=e,a(t)&&(t.status="Committing",this.queueCommit(t.destPath)))}catch(e){this.itemExit(t.destPath,"Error")}this.availableBlockRequests++,this.uploadNextBlock()}))}addFile(e,t,i){return s.__awaiter(this,void 0,void 0,(function*(){this.itemQueue.set(t,{file:e,destPath:t,status:"Queued",bytesUploaded:0,info:i,blockTokens:[],totalBytesUploaded:0}),this.isUploading()&&this.startUploading()}))}startUploading(){return s.__awaiter(this,void 0,void 0,(function*(){const e=this.onComplete(),t=this.availableBlockRequests;for(let e=0;e<t;e++)this.uploadNextBlock();return e}))}cancelFile(e){return s.__awaiter(this,void 0,void 0,(function*(){const t=this.itemQueue.get(e);t&&!a(t)&&this.itemExit(e,"Cancelled")}))}stopUploading(){this.itemQueue.forEach(({destPath:e})=>{this.cancelFile(e)})}isQueueEmpty(){return 0===this.itemQueue.size}isItemUploading(e){const t=this.itemQueue.get(e);return Boolean(t&&"Uploading"===t.status)}isUploading(){return this.availableBlockRequests<t.MAX_PARALLEL_BLOCK_UPLOAD_REQUESTS||this.availableCommitRequests<t.MAX_PARALLEL_COMMIT_REQUESTS}fireComplete(){for(;this.onCompleteSubscribers.length>0;){const e=this.onCompleteSubscribers.shift();e&&e()}}onComplete(){return new Promise(e=>{this.onCompleteSubscribers.push(e)})}}t.ParallelUploadSchedulerWithBatchCommit=r;class o{constructor(e){this.currentOffset=0,this.item=e}getNextChunk(){if(this.isEmpty())return null;const e=this.item.file.slice(this.currentOffset,t.CHUNK_SIZE+this.currentOffset);return this.currentOffset+=t.CHUNK_SIZE,e}isEmpty(){return this.item.file.size<=this.currentOffset}}const a=({blockTokens:e,file:s})=>{if(e.every(e=>""!==e)){const i=Math.ceil(s.size/t.CHUNK_SIZE);return e.length===i}return!1}})),define("metaserver/static/js/browse/actions_navigate",["require","exports","tslib","metaserver/static/js/cloud_docs/open_with_utils","metaserver/static/js/cloud_docs/preferred_editor_utils","metaserver/static/js/cloud_docs/types","metaserver/static/js/file_operations/notifications","metaserver/static/js/clean/filetypes","metaserver/static/js/clean/ui/async_file_modal_controller","metaserver/static/js/browse/api","metaserver/static/js/browse/constants","metaserver/static/js/browse/data/action_creators/index","metaserver/static/js/browse/data/selectors","metaserver/static/js/browse/data/selectors","metaserver/static/js/browse/data/store","metaserver/static/js/browse/models","metaserver/static/js/file_viewer/async_controller","metaserver/static/js/file_viewer/toggle_browse_elements_util","metaserver/static/js/pnm/utils","metaserver/static/js/plusplus/logging","metaserver/static/js/plusplus/file_actions","metaserver/static/js/vault/constants","metaserver/static/js/file_viewer/constants","metaserver/static/js/core/browser","metaserver/static/js/browse/tidy_up_actions","metaserver/static/js/clean/history_singleton","metaserver/static/js/files_view/util","metaserver/static/js/browse/naming_conventions_actions","metaserver/static/js/browse/data/helpers","metaserver/static/js/sync_everything/constants","metaserver/static/js/sync_everything/hive_logger","typescript/libraries/file-viewer/src/file_extension/extension_constants"],(function(e,t,s,i,r,o,a,n,l,c,d,u,_,p,m,h,f,E,g,y,S,b,v,T,I,k,P,C,A,F,R,U){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.browseNavigateActions=void 0,a=s.__importStar(a),l=s.__importStar(l),c=s.__importStar(c),u=s.__importStar(u),p=s.__importStar(p),T=s.__importStar(T),R=s.__importStar(R);t.browseNavigateActions=new class{constructor(){this.setUrl=({path:e,qargs:t,expandedBlade:s,forceExpandRightRail:i})=>{this.reduxStore.dispatch(u.setUrl({path:e,qargs:t,expandedBlade:s,forceExpandRightRail:i}))},this.onRestore=(e,t,s)=>{c.restoreFiles({files:t,userId:e,onSuccess:()=>{a.notifyRestoreSuccess(t)},isSearchMode:s})},this.doRestoreFilesWithUnifiedTrashModal=({files:e})=>{const t=p.user(this.reduxStore.getState()),s=p.context(this.reduxStore.getState());l.showUnifiedTrashModal({userId:t.id,context:s,files:e,onRestore:(e,t)=>{this.onRestore(e,t,!1)}})},this.reduxStore=(0,m.getStoreForBrowse)()}reloadCurrentPath(){this.setUrl({path:p.path(this.reduxStore.getState()),qargs:{reload:!0}})}navigateToFileOrFolder({file:e,shouldFocusComment:t=!1,activeCommentThreadId:s,onFileViewerUnmount:i,fileViewOrigin:o=v.FileViewOriginType.BROWSE,skipFileViewerRouting:a=!1,performSpaRouting:c=!1,href:d,middleClick:u=!1}){var _;const f=p.user(this.reduxStore.getState()),E=p.context(this.reduxStore.getState()),k=p.browsePostTTIExperiments((0,m.getStoreForBrowse)().getState());if(e.isDeleted)this.doRestoreFilesWithUnifiedTrashModal({files:[e]});else{if((0,g.isSupportedLinkNodeClickAction)(e.per_node_metadata))return void(0,S.handleLinkNodeAction)(e.per_node_metadata,e=>{(0,y.logProductAnalytics)(f.id,"web","select",e,"files_main_bar")});if(e.is_dir)if(e.type===n.FileTypes.VAULT_FOLDER)T.redirect(b.VAULT_URL);else if((0,A.isBackupFolder)(e)&&k.expEnableBackupWeb&&!(0,F.isBackupBrowse)()){const t=(0,F.backupUrlForFqPath)(e.fq_path);R.logEvent({event:"click_backup",page_source:"browse",action_surface:"file_list"}),T.open_tab(t)}else if(h.File.isNoAccessSharedFolder(e))l.showNoAccess(f,e.fq_path,E);else{const t="V1"===k.expOEXNamingConventionsGrowth,s=k.expTidyUpReengagement;E.isCurrentPathWriteable()&&setTimeout(()=>{p.context(this.reduxStore.getState()).currentFQPath===e.fq_path&&(t?0===Math.floor(2*Math.random())?(0,I.promptTidyUp)(f.id,e.fq_path,e.ns_id,s).then(t=>{!1===t&&(0,C.promptNamingConventions)(f.id,e.fq_path,e.ns_id)}):(0,C.promptNamingConventions)(f.id,e.fq_path,e.ns_id).then(t=>{!1===t&&(0,I.promptTidyUp)(f.id,e.fq_path,e.ns_id)}):(0,I.promptTidyUp)(f.id,e.fq_path,e.ns_id,s))},5e3),(0,F.isBackupBrowse)()&&R.logEvent({page_source:"browse",action_surface:"file_list",event:(null===(_=e.per_node_metadata)||void 0===_?void 0:_.suppress_delete)?"click_system_folder":"click_folder"}),this.setUrl({path:e.fq_path})}else{const n=()=>{d&&u?T.open_tab(d):this.openPreviewForBrowseFile({file:e,shouldFocusComment:t,activeCommentThreadId:s,user:f,fileViewOrigin:o,onFileViewerUnmount:i,skipFileViewerRouting:a,performSpaRouting:c})},{preferredEditors:l}=p.browsePostTTIData(this.reduxStore.getState());!t&&l&&(0,r.hasPreferredEditorSupport)(e)?(0,r.openInPreferredEditor)(f,e,l,n,{fileViewOrigin:o}):n()}}}openPreviewForBrowseFile({file:e,shouldFocusComment:t,activeCommentThreadId:s,user:r,fileViewOrigin:a,onFileViewerUnmount:n,shouldFocusApproval:l,skipFileViewerRouting:c,performSpaRouting:h}){const g=p.context(this.reduxStore.getState()),{isOverFreeQuota:y,hasExcludedNsIds:S}=p.browsePostTTIData(this.reduxStore.getState());let b=(0,_.getIndexOfFile)(e,this.reduxStore.getState());const T=b<0?[e]:p.sortedFilesWithFolderSizes(this.reduxStore.getState()).toArray();if(b<0?b=0:T[b]=e,p.browsePostTTIExperiments((0,m.getStoreForBrowse)().getState()).expCloudDocsWebShortcutPreviews?e.is_cloud_doc&&!U.POINTER_CLOUD_DOC_EXTS.includes(e.ext):e.is_cloud_doc)(0,i.openCloudDoc)(e,r,o.WebBrowseSource);else{let i;const o=()=>{(0,E.showElementsBehindFileViewer)(),this.reduxStore.dispatch(u.setIsFileViewerShown({isShown:!1})),n&&n(),i&&i.focus()},_=()=>{i=document.querySelector(":focus"),(0,E.hideElementsBehindFileViewer)(),this.reduxStore.dispatch(u.setIsFileViewerShown({isShown:!0}))},p=c?()=>{const e=(0,k.getBrowserHistory)(),{location:t}=e,s=new URLSearchParams(t.search);s.delete("preview"),e.replace(`${t.pathname}?${s.toString()}`)}:void 0,m="browse_previews";(0,f.initializeAjaxPreviewTiming)(m,!0),(0,f.asyncOpenPreview)({containerId:d.BROWSE_FILE_VIEWER_ELEMENT_ID,files:T,indexOfPreviewFile:b,shouldFocusComment:t,activeCommentThreadId:s,user:r,onFileViewerDidMount:_,onFileViewerUnmount:o,fileViewOrigin:a,fileViewTarget:v.FileViewTargetType.PRIVATE,browseContext:g,browseExceptions:{hasExcludedNsIds:S,isOverFreeQuota:y},shouldFocusApproval:l,skipFileViewerRouting:c,onCloseViewer:p,ajaxTimerName:m}).then(()=>{if(h){const t=(0,k.getBrowserHistory)(),{location:s}=t,i=new URLSearchParams(s.search);i.append("preview",(0,P.getFilename)(e)),t.push(`${s.pathname}?${i.toString()}`)}})}}}})),define("metaserver/static/js/file_uploader/upload_kit_provider",["require","exports","tslib","react","metaserver/static/js/browse/crypto_subtle_digest","js/filepath/filepath","metaserver/static/js/file_uploader/api_v2_client","metaserver/static/js/file_uploader/api_helper","metaserver/static/js/browse/crypto_subtle_digest","js/filepath/filepath","metaserver/static/js/file_uploader/actions_adapter","metaserver/static/js/file_uploader/api","metaserver/static/js/file_uploader/constants","metaserver/static/js/file_uploader/parallel_scheduler_with_batch_commit","metaserver/static/js/file_uploader/upload_session_scheduler","metaserver/static/js/file_uploader/upload_hybrid_scheduler","metaserver/static/js/file_uploader/processors","metaserver/static/js/file_uploader/clean/data/store","metaserver/static/js/file_uploader/clean/data/selectors","metaserver/static/js/file_uploader/utils","metaserver/static/js/upload_kit/uploader/context","metaserver/static/js/modules/constants/global_file_upload","metaserver/static/js/file_uploader/api"],(function(e,t,s,i,r,o,a,n,l,c,d,u,_,p,m,h,f,E,g,y,S,b,v){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UploadKitProvider=void 0,i=s.__importDefault(i),a=s.__importStar(a),c=s.__importStar(c),u=s.__importStar(u),h=s.__importStar(h);class T extends i.default.Component{constructor(){super(...arguments),this.allProcessedFiles=[],this.onBeforeUpload=e=>new Promise(t=>{d.ActionsAdapter.emit("beforeUpload",{uploadItems:e,beforeUploadComplete:({items:e})=>{t(e)}})}),this.onFilesAdded=(e,t)=>new Promise(s=>{d.ActionsAdapter.emit("filesAdded",{uploadItems:e,allUploadItems:t,filesAddedComplete:s,chooseDestination:this.props.chooseDestination})}),this.processFiles=(e,t)=>s.__awaiter(this,void 0,void 0,(function*(){let s,i;t.forEach(({item:e,error:t})=>{d.ActionsAdapter.emit("error",{user:this.props.user,uploadItem:e,errorType:(0,d.convertValidationError)(t),loggingOnly:!0})});try{s=this.props.processFiles?yield this.props.processFiles(e,t):yield(0,f.processFiles)(e,t)}catch(e){s=[]}const r=(0,y.shouldUseHybridUploader)()&&s.some(e=>(0,y.shouldUseSessionUploadForFile)(e.bytes));if(r&&(0,y.precheckOptimizationIsOn)()&&(i=(0,f.startUploadSessions)(this.props.user.id,s)),this.allProcessedFiles=[...this.allProcessedFiles,...s],s=yield this.onFilesAdded(s,this.allProcessedFiles),s=yield this.onBeforeUpload(s),this.allProcessedFiles=[],r&&!(0,y.precheckOptimizationIsOn)()&&(i=(0,f.startUploadSessions)(this.props.user.id,s)),r&&i){const e=yield i;if(e.isError)s.forEach(t=>{d.ActionsAdapter.emit("error",{user:this.props.user,uploadItem:t,errorType:_.UploadErrorType.START_UPLOAD_SESSION_ERROR,errorMessage:e.error[".tag"]})});else{const t=e.result;s.forEach((e,s)=>{e.cursor={session_id:t[s],offset:0}})}}return{items:s,errors:t}})),this.nsIdForRouting=e=>{if(this.props.nsIdForRouting)return this.props.nsIdForRouting(e);const t=(0,E.getStoreForUpload)().getState(),s=(0,g.getPath)(t),i=(0,g.getFolderNsId)(t);return""===c.normalize(s)?this.props.user.root_ns_id:null!==i?i:this.props.user.root_ns_id},this.appendBlock=(e,t,i,o)=>s.__awaiter(this,void 0,void 0,(function*(){if(!e.cursor||void 0===i)throw d.ActionsAdapter.emit("error",{uploadItem:e,errorType:_.UploadErrorType.APPEND_BLOCK_MISSING_PARAMS,user:this.props.user}),new Error;let s;if(d.ActionsAdapter.emit("blockUploadStart",{blob:t,uploadItem:e}),(0,l.windowHasCryptoSubtleDigest)()){const i=yield(0,n.hashBlobForAppend)(t,r.encryptArrayBuffer);i.isError?d.ActionsAdapter.emit("error",{uploadItem:e,errorType:_.UploadErrorType.CLIENT_HASH_DIGEST_ERROR,user:this.props.user}):s=i.result.hash}const c=t=>{o(t.loaded),d.ActionsAdapter.emit("uploadProgress",{uploadItem:e})},u=4194304*i+t.size>=e.bytes,p={cursor:{session_id:e.cursor.session_id,offset:4194304*i},close:u,content_hash:s};let m,h=0;if(b.UPLOAD_AUTORETRY_OPTIMIZATION){const{response:e,retryCount:s}=yield(0,y.newPromiseWithRetries)(()=>a.uploadSessionAppend(p,t,this.props.user.id,c));h+=s,m=e}else{const{response:e,retryCount:s}=yield(0,y.legacyPromiseWithRetries)(()=>a.uploadSessionAppend(p,t,this.props.user.id,c),3);h+=s,m=e}if(m.isError)throw d.ActionsAdapter.emit("error",{uploadItem:e,errorType:_.UploadErrorType.UPLOAD_BLOCK_ERROR,user:this.props.user,totalRetryCount:h,errorMessage:m.error[".tag"]}),new Error;d.ActionsAdapter.emit("uploadProgress",{uploadItem:e}),d.ActionsAdapter.emit("blockUploadEnd",{blob:t,totalRetryCount:h,uploadItem:e})})),this.uploadBlock=(e,t,i,r)=>s.__awaiter(this,void 0,void 0,(function*(){const s=t=>{i&&i(t.loaded),d.ActionsAdapter.emit("uploadProgress",{uploadItem:e})};d.ActionsAdapter.emit("blockUploadStart",{blob:t,uploadItem:e});let r,o=0;if(b.UPLOAD_AUTORETRY_OPTIMIZATION){const{response:i,retryCount:a}=yield(0,y.newPromiseWithRetries)(()=>u.uploadBlock(this.props.user.id,this.nsIdForRouting(e),e.bytes,t,s));o+=a,r=i}else{const{response:i,retryCount:a}=yield(0,y.legacyPromiseWithRetries)(()=>u.uploadBlock(this.props.user.id,this.nsIdForRouting(e),e.bytes,t,s),3);o+=a,r=i}if(r.isError)throw d.ActionsAdapter.emit("error",{uploadItem:e,errorType:r.error.type,user:this.props.user,errorMessage:r.error.message,errorMethodSource:r.error.method,totalRetryCount:o}),new Error;return d.ActionsAdapter.emit("blockUploadEnd",{blob:t,totalRetryCount:o,uploadItem:e}),r.result.token})),this.finishBatch=e=>s.__awaiter(this,void 0,void 0,(function*(){d.ActionsAdapter.emit("filesCommitting",{uploadItems:e.map(e=>e.info)});const t=[],s=[],i=[];let r,n;if(e.forEach(e=>{e.info.cursor&&(s.push({cursor:e.info.cursor,commit:{path:(0,o.normalize)((0,y.getDestinationDir)(e.info.parentPath||"",e.info.destPath))+(0,o.normalize)(c.filename(e.info.destPath))}}),i.push(e))}),b.UPLOAD_AUTORETRY_OPTIMIZATION){const{response:e,retryCount:t}=yield(0,y.newPromiseWithRetries)(()=>a.uploadSessionFinishBatch({entries:s},this.props.user.id));r=e,n=t}else{const{response:e,retryCount:t}=yield(0,y.legacyPromiseWithRetries)(()=>a.uploadSessionFinishBatch({entries:s},this.props.user.id),3);r=e,n=t}return r.isError?(e.map(({info:e})=>{d.ActionsAdapter.emit("error",{uploadItem:e,errorType:_.UploadErrorType.COMMIT_HTTP_ERROR,user:this.props.user,totalRetryCount:n,useBatchCommit:!0}),t.push({filePath:e.destPath,success:!1})}),t):(r.result.entries.forEach((e,s)=>{const r=i[s];"failure"===e[".tag"]?(d.ActionsAdapter.emit("error",{uploadItem:r.info,errorType:_.UploadErrorType.COMMIT_HTTP_ERROR,user:this.props.user,totalRetryCount:n,useBatchCommit:!0}),t.push({filePath:r.info.destPath,success:!1})):(d.ActionsAdapter.emit("fileUploaded",{uploadItem:r.info,totalRetryCount:n,useBatchCommit:!0}),t.push({filePath:r.info.destPath,success:!0}))}),t)})),this.commitBlocksBatchAPIV2=e=>s.__awaiter(this,void 0,void 0,(function*(){if(d.ActionsAdapter.emit("filesCommitting",{uploadItems:e.map(e=>e.info)}),e.length>3){const t=e.map(({info:e,tokens:t})=>({file_name:c.filename(e.destPath),destination:(0,y.getDestinationDir)(e.parentPath||"",e.destPath),file_size:e.bytes,block_tokens:t,local_identifier:e.id}));let s,i=0;if(b.UPLOAD_AUTORETRY_OPTIMIZATION){const{response:r,retryCount:o}=yield(0,y.newPromiseWithRetries)(()=>u.commitBlocksBatch(this.props.user.id,t,e.map(e=>e.info)));i+=o,s=r}else{const{response:r,retryCount:o}=yield(0,y.legacyPromiseWithRetries)(()=>u.commitBlocksBatch(this.props.user.id,t,e.map(e=>e.info)),3);i+=o,s=r}const r=[];return s.isError?e.map(({info:e,tokens:t})=>{d.ActionsAdapter.emit("error",{uploadItem:e,errorType:s.error.type,user:this.props.user,errorMessage:s.error.message,errorMethodSource:s.error.method,totalRetryCount:i,useBatchCommit:!0}),r.push({filePath:e.destPath,success:!1})}):s.result.forEach(e=>{e.status.isError?(d.ActionsAdapter.emit("error",{uploadItem:e.uploadItem,errorType:e.status.error.type,user:this.props.user,errorMessage:e.status.error.message,errorMethodSource:e.status.error.method,totalRetryCount:i,useBatchCommit:!0}),r.push({filePath:e.uploadItem.destPath,success:!1})):(d.ActionsAdapter.emit("fileUploaded",{uploadItem:e.uploadItem,totalRetryCount:i,useBatchCommit:!0}),r.push({filePath:e.uploadItem.destPath,success:!0}))}),Promise.resolve(r)}{const t=[];for(const{info:s,tokens:i}of e){let e,r=0;if(b.UPLOAD_AUTORETRY_OPTIMIZATION){const{response:t,retryCount:o}=yield(0,y.newPromiseWithRetries)(()=>u.commitBlocks(this.props.user.id,(0,y.getDestinationDir)(s.parentPath||"",s.destPath),c.filename(s.destPath),s.bytes,i,this.props.user.root_ns_id,(0,v.convertFileTimestampIfExists)(s)));r+=o,e=t}else{const{response:t,retryCount:o}=yield(0,y.legacyPromiseWithRetries)(()=>u.commitBlocks(this.props.user.id,(0,y.getDestinationDir)(s.parentPath||"",s.destPath),c.filename(s.destPath),s.bytes,i,this.props.user.root_ns_id,(0,v.convertFileTimestampIfExists)(s)),3);r+=o,e=t}e.isError?(d.ActionsAdapter.emit("error",{uploadItem:s,errorType:e.error.type,user:this.props.user,errorMessage:e.error.message,errorMethodSource:e.error.method,totalRetryCount:r,useBatchCommit:!0}),t.push({filePath:s.destPath,success:!1})):(d.ActionsAdapter.emit("fileUploaded",{uploadItem:s,totalRetryCount:r,useBatchCommit:!0}),t.push({filePath:s.destPath,success:!0}))}return Promise.resolve(t)}}))}render(){m.UploadSessionScheduler,this.appendBlock,this.finishBatch;const e={schedulerType:"hybrid",Scheduler:h.UploadHybridScheduler,append:this.appendBlock,finish:this.finishBatch,uploadBlock:this.uploadBlock,commitBlocksBatch:this.commitBlocksBatchAPIV2},t={schedulerType:"token",Scheduler:p.ParallelUploadSchedulerWithBatchCommit,uploadBlock:this.uploadBlock,commitBlocksBatch:this.commitBlocksBatchAPIV2};return i.default.createElement(S.UploadProvider,{userId:this.props.user.id,selectMultiple:!0,onChoose:this.props.onChoose,onChooseDropboxFile:this.props.onChooseDropboxFile,processFiles:this.processFiles,maxFileSize:(0,y.shouldUseHybridUploader)()?375809638400:524288e5,startUploadOnAdd:!0,scheduler:(0,y.shouldUseHybridUploader)()?e:t},this.props.children)}}t.UploadKitProvider=T,T.displayName="UploadKitProvider"})),define("metaserver/static/js/file_uploader/api",["require","exports","tslib","metaserver/static/js/clean/csrf","metaserver/static/js/browse/crypto_subtle_digest","metaserver/static/js/file_uploader/constants","metaserver/static/js/core/uri","metaserver/static/js/file_uploader/api_v2_client","metaserver/static/js/file_uploader/api_helper","metaserver/static/js/file_uploader/result_type"],(function(e,t,s,i,r,o,a,n,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.convertFileTimestampIfExists=t.uploadBlock=t.commitBlocksBatch=t.commitBlocks=void 0,t.commitBlocks=function(e,t,s,r,n,d,u){return new Promise((_,p)=>{try{const p={_subject_uid:e.toString(),dest:t,name:s,overwrite:"1",reported_total_size:r.toString(),t:(0,i.readCsrfToken)()||"",client_root_ns_id:d.toString()};u>0&&(p.last_modified=u.toString());const m=new a.URI({scheme:"https",authority:"www.dropbox.com",path:"/commit_web_upload_by_token",query:p}),h=new XMLHttpRequest;h.withCredentials=!0;const f=()=>{let e;return e=507===h.status?(0,l.getErrorOnStatus507)(h):0===h.status?o.UploadErrorType.CONNECTION_ERROR:o.UploadErrorType.COMMIT_HTTP_ERROR,{type:e}};return h.onreadystatechange=()=>{if(h.readyState===XMLHttpRequest.DONE)if(200===h.status){const e=JSON.parse(h.responseText);"complete"===e.status?_((0,c.ok)({})):_((0,c.error)({type:o.UploadErrorType.HTTP_ERROR,message:e.error,method:"commitBlocks/request.onreadystatechange"}))}else{const e=f().type===o.UploadErrorType.CONNECTION_ERROR,t=e?1/0:3;_((0,c.error)(f(),{isRetriable:!0,maxRetries:t,isNetworkError:e}))}},h.open("POST",m.toString(),!0),h.setRequestHeader("Content-Type","application/octet-stream"),h.send(JSON.stringify(n)),h}catch(e){return void _((0,c.error)({type:o.UploadErrorType.HTTP_ERROR,message:e.message,method:"commitBlocks/try-catch"}))}})},t.commitBlocksBatch=function(e,t,s){return new Promise((i,r)=>{const a={};s.map(e=>{a[e.id]=e});const l=[];(0,n.commitWebUploadTokenBatch)(e,t).then(e=>{var t,s;null===(t=e.completed)||void 0===t||t.forEach(e=>{l.push({uploadItem:a[e.local_identifier],status:{isError:!1}})}),null===(s=e.failed)||void 0===s||s.forEach(e=>{const t=e.status.status;let s=o.UploadErrorType.COMMIT_HTTP_ERROR;if("failure"===t[".tag"]){s=(function(e){var t;switch(null===(t=e.failure_reason)||void 0===t?void 0:t[".tag"]){case"invalid_argument":return o.UploadErrorType.COMMIT_INVALID_ARGS;case"too_large_file":case"too_many_blocks":return o.UploadErrorType.FILE_SIZE_ERROR;case"no_write_permission":return o.UploadErrorType.PERMISSIONS_AT_UPLOAD_ERROR;case"insufficient_quota":return o.UploadErrorType.OVER_QUOTA_ERROR;case"file_ignored":return o.UploadErrorType.IGNORED;case"others":default:return o.UploadErrorType.COMMIT_HTTP_ERROR}})(t)}l.push({uploadItem:a[e.local_identifier],status:{isError:!0,error:{type:s,method:"commitWebUploadTokenBatch"}}})}),i((0,c.ok)(l))}).catch(e=>{var t;0!==(null===(t=e.raw)||void 0===t?void 0:t.status)?i((0,c.error)({type:o.UploadErrorType.HTTP_ERROR,message:e.toString(),method:"commitWebUploadTokenBatch/try-catch"})):i((0,c.error)({type:o.UploadErrorType.CONNECTION_ERROR,message:e.toString(),method:"commitWebUploadTokenBatch/try-catch"},{isRetriable:!0,maxRetries:1/0,isNetworkError:!0}))})})};t.uploadBlock=(e,t,n,d,u)=>new Promise(_=>s.__awaiter(void 0,void 0,void 0,(function*(){try{let s;if((0,r.windowHasCryptoSubtleDigest)()){const e=yield(0,l.hashBlob)(d);if(e.isError)return _(e);s=e.result.hash}const p=new a.URI({scheme:"https",authority:"dl-web.dropbox.com",path:"/put_block_returning_token",query:{owner_id:e.toString(),_subject_uid:e.toString(),t:(0,i.readCsrfToken)()||"",reported_block_size:d.size.toString(),num_blocks:Math.ceil(n/d.size).toString(),ns_id_for_routing:t.toString()}}),m=new XMLHttpRequest;m.withCredentials=!0;const h=()=>{let e;return e=507===m.status?(0,l.getErrorOnStatus507)(m):0===m.status?o.UploadErrorType.CONNECTION_ERROR:o.UploadErrorType.UPLOAD_BLOCK_ERROR,{type:e}};return m.onreadystatechange=()=>{if(m.readyState!==XMLHttpRequest.DONE)return;if(0!==m.status&&200!==m.status)return _((0,c.error)({type:o.UploadErrorType.HTTP_ERROR,message:`request status was ${m.status}`,method:"uploadBlock/request.onreadystatechange"}));const e=JSON.parse(m.responseText);return e.token?(0,r.windowHasCryptoSubtleDigest)()&&e.block_hash!==s?_((0,c.error)({type:o.UploadErrorType.HASHES_NOT_EQUAL_ERROR})):void _((0,c.ok)({token:e.token})):_((0,c.error)({type:o.UploadErrorType.HTTP_ERROR,message:`no token in response, block hash:${e.block_hash}, request status:${m.status}`,method:"uploadBlock/request.onreadystatechange"}))},m.onerror=()=>{const e=h();e.type!==o.UploadErrorType.CONNECTION_ERROR?_((0,c.error)(e)):_((0,c.error)(e,{isRetriable:!0,maxRetries:1/0,isNetworkError:!0}))},m.upload&&(m.upload.onprogress=u),m.onload=()=>{m.status>=400&&_((0,c.error)(h()))},m.open("POST",p.toString(),!0),m.setRequestHeader("Content-Type","application/octet-stream"),m.send(d),m}catch(e){return void _((0,c.error)({type:o.UploadErrorType.HTTP_ERROR,message:e.message,method:"uploadBlock/try-catch"}))}})));t.convertFileTimestampIfExists=e=>{var t;if(!(e.file&&e.file instanceof File))return 0;const s=Date.now()+864e5,i=null!==(t=e.file.lastModified)&&void 0!==t?t:0;return i.toString().length>=12&&i<s?Math.round(i/1e3):0}})),define("metaserver/static/js/business_space/browse/data/action_creators",["require","exports","metaserver/static/js/business_space/browse/data/types"],(function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getActionForSetSplitShareButtonFileLoginlessLink=t.getActionForSetContextMenuFileBusinessSpaceInfo=t.getActionForSetSelectedFileLoginlessLink=t.getActionForSetSelectedFileBusinessSpaceInfo=t.getActionForSetVisibility=t.getActionForSetVisibilities=t.getActionForSetClientUploadsEnabled=t.getActionForSetLoginlessLink=t.getActionForSetBusinessSpaceInfo=void 0;t.getActionForSetBusinessSpaceInfo=({found:e,business_space_xgid:t,is_business_space_root:i,business_space_name:r,space_xid:o=""})=>({type:s.ActionTypes.SET_BUSINESS_SPACE_INFO,payload:{found:e,business_space_xgid:t,is_business_space_root:i,business_space_name:r,space_xid:o}});t.getActionForSetLoginlessLink=({client_portal_url:e,space_xid:t})=>({type:s.ActionTypes.SET_LOGINLESS_LINK,payload:{client_portal_url:e,space_xid:t}});t.getActionForSetClientUploadsEnabled=({client_uploads_enabled:e})=>({type:s.ActionTypes.SET_CLIENT_UPLOADS_ENABLED,payload:{client_uploads_enabled:e}});t.getActionForSetVisibilities=({objects_visibility:e})=>({type:s.ActionTypes.SET_VISIBILITIES,payload:{objects_visibility:e}});t.getActionForSetVisibility=({fileFqPath:e,newObjectVisibility:t})=>({type:s.ActionTypes.SET_VISIBILITY,payload:{fileFqPath:e,newObjectVisibility:t}});t.getActionForSetSelectedFileBusinessSpaceInfo=({found:e,business_space_xgid:t,is_business_space_root:i,business_space_name:r,space_xid:o="",client_portal_url:a=""})=>({type:s.ActionTypes.SET_SELECTED_FILE_BUSINESS_SPACE_INFO,payload:{found:e,business_space_xgid:t,is_business_space_root:i,business_space_name:r,space_xid:o,client_portal_url:a}});t.getActionForSetSelectedFileLoginlessLink=({client_portal_url:e,space_xid:t})=>({type:s.ActionTypes.SET_SELECTED_FILE_LOGINLESS_LINK,payload:{client_portal_url:e,space_xid:t}});t.getActionForSetContextMenuFileBusinessSpaceInfo=({found:e,business_space_xgid:t,is_business_space_root:i,business_space_name:r,space_xid:o="",client_portal_url:a=""})=>({type:s.ActionTypes.SET_SPLIT_SHARE_BUTTON_FILE_BUSINESS_SPACE_INFO,payload:{found:e,business_space_xgid:t,is_business_space_root:i,business_space_name:r,space_xid:o,client_portal_url:a}});t.getActionForSetSplitShareButtonFileLoginlessLink=({client_portal_url:e,space_xid:t})=>({type:s.ActionTypes.SET_SPLIT_SHARE_BUTTON_FILE_LOGINLESS_LINK,payload:{client_portal_url:e,space_xid:t}})})),define("typescript/component_libraries/files_components/src/icons/file_icon_extensions",["require","exports","typescript/libraries/spectrum-content-icon-compatibility/src/index","typescript/libraries/spectrum-content-icon-compatibility/src/index"],(function(e,t,s,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getIconNameFromFile=t.FolderIconToSpectrumIcon=t.iconNameWithoutSize=void 0;const r=s.EXTENSION_ICONS;function o(e){const t=e.length,s=e.lastIndexOf("_",t);return parseInt(e.substr(s+1,t),10)?e.substr(0,s):e}t.iconNameWithoutSize=o,t.FolderIconToSpectrumIcon={folder_user:"folder_shared",folder_user_gray:"folder_shared",folder_team:"folder_team",folder_team_gray:"folder_team",folder_team_locked:"folder_team_read_only",folder_team_locked_gray:"folder_team_read_only",folder_user_locked:"folder_shared_read_only",folder_user_locked_gray:"folder_shared_read_only",folder:"folder",folder_gray:"folder",folder_team_member:"folder_team_member",folder_user_no_access:"folder_confidential",folder_app:"folder_app",package:"pkg",folder_camera:"folder_camera_upload",dropbox:"folder_dropbox",folder_user_no_access_admin_view:"folder_confidential_admin_view",folder_space:"folder_space",folder_space_read_only:"folder_space_read_only"};t.getIconNameFromFile=({isFolder:e,extension:s="",icon:a=""})=>{if(a&&`${a}-large`in i.ICONS)return a;if(e){const e=o(a);return t.FolderIconToSpectrumIcon[e]||"folder"}return r[s]||"unknown"}})),define("typescript/component_libraries/files_components/src/icons/file_icon",["require","exports","tslib","react","classnames","typescript/libraries/spectrum-content-icon-compatibility/src/index","typescript/component_libraries/files_components/src/icons/file_icon_extensions","typescript/component_libraries/files_components/src/icons/index.module.css"],(function(e,t,s,i,r,o,a,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FolderIcon=t.FileIcon=void 0,i=s.__importStar(i),r=s.__importDefault(r),n=s.__importDefault(n);t.FileIcon=({file:e,size:t="small"})=>{const s=(0,r.default)(n.default.ikeaFileIcon,{[n.default.ikeaFileIconXsmall]:"xsmall"===t,[n.default.ikeaFileIconSmall]:"small"===t,[n.default.ikeaFileIconLarge]:"large"===t}),l="xsmall"===t?"small":t;return i.createElement("div",{className:s},i.createElement(o.IconContent,{name:`${(0,a.getIconNameFromFile)(e)}-${l}`,"aria-hidden":"true"}))},t.FileIcon.displayName="FileIcon";t.FolderIcon=({icon:e,size:t="small"})=>{const s=(0,a.iconNameWithoutSize)(e),r=a.FolderIconToSpectrumIcon[s]||"folder",n="xsmall"===t?"small":t;return i.createElement(o.IconContent,{name:`${r}-${n}`,"aria-hidden":"true"})}})),define("typescript/component_libraries/files_components/src/icons/index.module.css",["require","exports","css!typescript/component_libraries/files_components/src/icons/index.module.out.css"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ikeaFileIconLarge=t.ikeaFileIconSmall=t.ikeaFileIconXsmall=t.ikeaFileIcon=void 0,t.ikeaFileIcon="_ikea-file-icon_1quko_1",t.ikeaFileIconXsmall="_ikea-file-icon--xsmall_1quko_8",t.ikeaFileIconSmall="_ikea-file-icon--small_1quko_14",t.ikeaFileIconLarge="_ikea-file-icon--large_1quko_20";t.default={ikeaFileIcon:"_ikea-file-icon_1quko_1",ikeaFileIconXsmall:"_ikea-file-icon--xsmall_1quko_8",ikeaFileIconSmall:"_ikea-file-icon--small_1quko_14",ikeaFileIconLarge:"_ikea-file-icon--large_1quko_20"}})),define("typescript/component_libraries/files_components/src/table/columns/file_name_column",["require","exports","tslib","react","typescript/component_libraries/files_components/src/icons/file_icon","dig-components/combinations","react-intl","dig-components/typography"],(function(e,t,s,i,r,o,a,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FileNameColumn=t.getLabelIDFromRowIndex=t.FileNameCell=void 0,i=s.__importStar(i);function l(e){return`files-table-label-${e}`}t.FileNameCell=({file:e,labelID:t,subTitle:s=""})=>{const a=e.url?i.createElement(n.Link,{id:t,"data-testid":"files-filename",href:e.url},e.title):i.createElement("span",{id:t,"data-testid":"files-filename"},e.title);return i.createElement(i.Fragment,null,i.createElement(o.LabelGroup,{withLeftAccessory:i.createElement(r.FileIcon,{file:e}),withText:a,withSubtext:s}))},t.FileNameCell.displayName="FileNameCell",t.getLabelIDFromRowIndex=l,t.FileNameColumn={id:"filename",Header:()=>i.createElement(i.Fragment,null,i.createElement("div",{style:{width:"48px"}})," ",(0,a.useIntl)().formatMessage(c)),Cell:({row:e})=>i.createElement(t.FileNameCell,{file:e.original,labelID:l(e.index)}),accessor:e=>e.title,width:300};const c=(0,a.defineMessage)({id:"A2npVi",defaultMessage:"Name"})})),define("metaserver/static/js/file_actions/strings",["require","exports","react-intl"],(function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.unstarSnackbarError=t.starSnackbarError=t.unstarSnackbarSuccess=t.starSnackbarSuccess=t.createFolderSnackbarSuccess=t.createFolderFswConfirmText=t.createFolderErrorGeneric=t.createFolderErrorMalformedPath=t.createFolderSnackbarProgress=t.renameSnackbarSuccessMessage=t.renameUndoSnackbarSuccessMessage=t.renameUndoSnackbarErrorMessage=t.renameUndoSnackbarProgressMessage=t.renameFswConfirmText=t.renameSnackbarProgressMessage=t.renameErrorInvalidName=t.deleteUndoSnackbarMessage=t.deleteFswConfirmText=t.deleteSnackbarProgressMessage=void 0,t.deleteSnackbarProgressMessage=(0,s.defineMessage)({id:"z7/sbf",defaultMessage:"{count, plural, one{Deleting {count} item...} other{Deleting {count} items...}}"}),t.deleteFswConfirmText=(0,s.defineMessage)({id:"da2lvf",defaultMessage:"Delete"}),t.deleteUndoSnackbarMessage=(0,s.defineMessage)({id:"hCpZct",defaultMessage:"Delete undone."}),t.renameErrorInvalidName=(0,s.defineMessage)({id:"KYHY0Z",defaultMessage:"Name was invalid."}),t.renameSnackbarProgressMessage=(0,s.defineMessage)({id:"8j6sBp",defaultMessage:"Renaming"}),t.renameFswConfirmText=(0,s.defineMessage)({id:"NYv8Vp",defaultMessage:"Rename"}),t.renameUndoSnackbarProgressMessage=(0,s.defineMessage)({id:"deJ8cD",defaultMessage:"Undoing rename..."}),t.renameUndoSnackbarErrorMessage=(0,s.defineMessage)({id:"n4o67d",defaultMessage:"Undo failed."}),t.renameUndoSnackbarSuccessMessage=(0,s.defineMessage)({id:"6RXx/7",defaultMessage:"Rename undone."}),t.renameSnackbarSuccessMessage=(0,s.defineMessage)({id:"NqCfwG",defaultMessage:"Renamed 1 item."}),t.createFolderSnackbarProgress=(0,s.defineMessage)({id:"U3y3i9",defaultMessage:"Creating folder..."}),t.createFolderErrorMalformedPath=(0,s.defineMessage)({id:"HOb8Zp",defaultMessage:'The following characters are not allowed: angle brackets \\ / : ? * " |'}),t.createFolderErrorGeneric=(0,s.defineMessage)({id:"qZTFM0",defaultMessage:"Cant create folder."}),t.createFolderFswConfirmText=(0,s.defineMessage)({id:"VDjS9+",defaultMessage:"Create folder"}),t.createFolderSnackbarSuccess=(0,s.defineMessage)({id:"1zC4ih",defaultMessage:"Folder created."}),t.starSnackbarSuccess=(0,s.defineMessage)({id:"m96IvY",defaultMessage:"Starred {itemName}."}),t.unstarSnackbarSuccess=(0,s.defineMessage)({id:"Yn2gx1",defaultMessage:"Unstarred {itemName}."}),t.starSnackbarError=(0,s.defineMessage)({id:"LdcLnn",defaultMessage:"There was a problem starring {itemName}"}),t.unstarSnackbarError=(0,s.defineMessage)({id:"t8Eqso",defaultMessage:"There was a problem unstarring {itemName}"})}));
//# sourceMappingURL=pkg-file-upload-pap-logging.min.js-vflMVza83.map